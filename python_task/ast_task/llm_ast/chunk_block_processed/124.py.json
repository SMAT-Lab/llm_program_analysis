{
    "type": "module",
    "start_token": 0,
    "end_token": 81,
    "label": "import hashlib\nimport hmac\nimport logging\n\nimport requests\nfrom fastapi import HTTPException, Request\nfrom strenum import StrEnum\n\nfrom backend.data import integrations\nfrom backend.data.model import Credentials\nfrom backend.integrations.providers import ProviderName\n\nfrom ._base import BaseWebhooksManager\n\nlogger = logging.getLogger(__name__)\n\n\n# --8<-- [start:GithubWebhooksManager]",
    "children": [
        {
            "type": "import_statement",
            "start_token": 0,
            "end_token": 1,
            "label": "import hashlib",
            "children": []
        },
        {
            "type": "import_statement",
            "start_token": 3,
            "end_token": 4,
            "label": "import hmac",
            "children": []
        },
        {
            "type": "import_statement",
            "start_token": 6,
            "end_token": 7,
            "label": "import logging",
            "children": []
        },
        {
            "type": "import_statement",
            "start_token": 10,
            "end_token": 11,
            "label": "import requests",
            "children": []
        },
        {
            "type": "import_from_statement",
            "start_token": 13,
            "end_token": 19,
            "label": "from fastapi import HTTPException, Request\n",
            "children": []
        },
        {
            "type": "import_from_statement",
            "start_token": 20,
            "end_token": 23,
            "label": "from strenum import StrEnum",
            "children": []
        },
        {
            "type": "import_from_statement",
            "start_token": 26,
            "end_token": 31,
            "label": "from backend.data import integrations",
            "children": []
        },
        {
            "type": "import_from_statement",
            "start_token": 33,
            "end_token": 41,
            "label": "from backend.data.model import Credentials\n",
            "children": []
        },
        {
            "type": "import_from_statement",
            "start_token": 42,
            "end_token": 49,
            "label": "from backend.integrations.providers import ProviderName",
            "children": []
        },
        {
            "type": "import_from_statement",
            "start_token": 52,
            "end_token": 56,
            "label": "from ._base import BaseWebhooksManager",
            "children": []
        },
        {
            "type": "assignment",
            "start_token": 59,
            "end_token": 66,
            "label": "logger = logging.getLogger(__name__)",
            "children": [
                {
                    "type": "attribute",
                    "start_token": 61,
                    "end_token": 63,
                    "label": "logging.getLogger",
                    "children": []
                },
                {
                    "type": "argument_list",
                    "start_token": 64,
                    "end_token": 66,
                    "label": "(__name__)",
                    "children": []
                }
            ]
        },
        {
            "type": "comment",
            "start_token": 70,
            "end_token": 81,
            "label": "# --8<-- [start:GithubWebhooksManager]",
            "children": []
        },
        {
            "type": "class_definition",
            "start_token": 83,
            "end_token": 93,
            "label": "class GithubWebhookType(StrEnum):\n    REPO = \"repo\"\n",
            "children": [
                {
                    "type": "identifier",
                    "start_token": 83,
                    "end_token": 83,
                    "label": "class",
                    "children": []
                },
                {
                    "type": "identifier",
                    "start_token": 84,
                    "end_token": 84,
                    "label": "GithubWebhookType",
                    "children": []
                },
                {
                    "type": "argument_list",
                    "start_token": 85,
                    "end_token": 87,
                    "label": "(StrEnum)",
                    "children": [
                        {
                            "type": "identifier",
                            "start_token": 86,
                            "end_token": 86,
                            "label": "StrEnum",
                            "children": []
                        }
                    ]
                },
                {
                    "type": "block",
                    "start_token": 88,
                    "end_token": 92,
                    "label": ":\n    REPO = \"repo\"",
                    "children": [
                        {
                            "type": "assignment",
                            "start_token": 90,
                            "end_token": 92,
                            "label": "REPO = \"repo\"",
                            "children": [
                                {
                                    "type": "identifier",
                                    "start_token": 90,
                                    "end_token": 90,
                                    "label": "REPO",
                                    "children": []
                                },
                                {
                                    "type": "string",
                                    "start_token": 92,
                                    "end_token": 92,
                                    "label": "\"repo\"",
                                    "children": []
                                }
                            ]
                        }
                    ]
                }
            ],
            "name": "GithubWebhookType",
            "start_line": 19,
            "end_line": 20
        },
        {
            "type": "class_placeholder",
            "name": "GithubWebhooksManager",
            "start_line": 23,
            "end_line": 166,
            "start_token": 96,
            "end_token": 928,
            "label": "class GithubWebhooksManager(BaseWebhooksManager):\n    PROVIDER_NAME = ProviderName.GITHUB\n\n    WebhookType = GithubWebhookType\n\n    GITHUB_API_URL = \"https://api.github.com\"\n    GITHUB_API_DEFAULT_HEADERS = {\"Accept\": \"application/vnd.github.v3+json\"}\n\n    @classmethod\n    async def validate_payload(\n        cls, webhook: integrations.Webhook, request: Request\n    ) -> tuple[dict, str]:\n        if not (event_type := request.headers.get(\"X-GitHub-Event\")):\n            raise HTTPException(\n                status_code=400, detail=\"X-GitHub-Event header is missing!\"\n            )\n\n        if not (signature_header := request.headers.get(\"X-Hub-Signature-256\")):\n            raise HTTPException(\n                status_code=403, detail=\"X-Hub-Signature-256 header is missing!\"\n            )\n\n        payload_body = await request.body()\n        hash_object = hmac.new(\n            webhook.secret.encode(\"utf-8\"), msg=payload_body, digestmod=hashlib.sha256\n        )\n        expected_signature = \"sha256=\" + hash_object.hexdigest()\n\n        if not hmac.compare_digest(expected_signature, signature_header):\n            raise HTTPException(\n                status_code=403, detail=\"Request signatures didn't match!\"\n            )\n\n        payload = await request.json()\n        if action := payload.get(\"action\"):\n            event_type += f\".{action}\"\n\n        return payload, event_type\n\n    async def trigger_ping(\n        self, webhook: integrations.Webhook, credentials: Credentials | None\n    ) -> None:\n        if not credentials:\n            raise ValueError(\"Credentials are required but were not passed\")\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n\n        repo, github_hook_id = webhook.resource, webhook.provider_webhook_id\n        ping_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{github_hook_id}/pings\"\n\n        response = requests.post(ping_url, headers=headers)\n\n        if response.status_code != 204:\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to ping GitHub webhook: {error_msg}\")\n\n    async def _register_webhook(\n        self,\n        credentials: Credentials,\n        webhook_type: GithubWebhookType,\n        resource: str,\n        events: list[str],\n        ingress_url: str,\n        secret: str,\n    ) -> tuple[str, dict]:\n        if webhook_type == self.WebhookType.REPO and resource.count(\"/\") > 1:\n            raise ValueError(\"Invalid repo format: expected 'owner/repo'\")\n\n        # Extract main event, e.g. `pull_request.opened` -> `pull_request`\n        github_events = list({event.split(\".\")[0] for event in events})\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n        webhook_data = {\n            \"name\": \"web\",\n            \"active\": True,\n            \"events\": github_events,\n            \"config\": {\n                \"url\": ingress_url,\n                \"content_type\": \"json\",\n                \"insecure_ssl\": \"0\",\n                \"secret\": secret,\n            },\n        }\n\n        response = requests.post(\n            f\"{self.GITHUB_API_URL}/repos/{resource}/hooks\",\n            headers=headers,\n            json=webhook_data,\n        )\n\n        if response.status_code != 201:\n            error_msg = extract_github_error_msg(response)\n            if \"not found\" in error_msg.lower():\n                error_msg = (\n                    f\"{error_msg} \"\n                    \"(Make sure the GitHub account or API key has 'repo' or \"\n                    f\"webhook create permissions to '{resource}')\"\n                )\n            raise ValueError(f\"Failed to create GitHub webhook: {error_msg}\")\n\n        webhook_id = response.json()[\"id\"]\n        config = response.json()[\"config\"]\n\n        return str(webhook_id), config\n\n    async def _deregister_webhook(\n        self, webhook: integrations.Webhook, credentials: Credentials\n    ) -> None:\n        webhook_type = self.WebhookType(webhook.webhook_type)\n        if webhook.credentials_id != credentials.id:\n            raise ValueError(\n                f\"Webhook #{webhook.id} does not belong to credentials {credentials.id}\"\n            )\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n\n        if webhook_type == self.WebhookType.REPO:\n            repo = webhook.resource\n            delete_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{webhook.provider_webhook_id}\"  # noqa\n        else:\n            raise NotImplementedError(\n                f\"Unsupported webhook type '{webhook.webhook_type}'\"\n            )\n\n        response = requests.delete(delete_url, headers=headers)\n\n        if response.status_code not in [204, 404]:\n            # 204 means successful deletion, 404 means the webhook was already deleted\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to delete GitHub webhook: {error_msg}\")\n\n        # If we reach here, the webhook was successfully deleted or didn't exist\n\n\n# --8<-- [end:GithubWebhooksManager]\n\n\ndef extract_github_error_msg(response: requests.Response) -> str:\n    error_msgs = []\n    resp = response.json()\n    if resp.get(\"message\"):\n        error_msgs.append(resp[\"message\"])\n    if resp.get(\"errors\"):\n        error_msgs.extend(f\"* {err.get('",
            "children": [
                {
                    "type": "module",
                    "start_token": 96,
                    "end_token": 743,
                    "label": "class GithubWebhooksManager(BaseWebhooksManager):\n    PROVIDER_NAME = ProviderName.GITHUB\n\n    WebhookType = GithubWebhookType\n\n    GITHUB_API_URL = \"https://api.github.com\"\n    GITHUB_API_DEFAULT_HEADERS = {\"Accept\": \"application/vnd.github.v3+json\"}\n\n    @classmethod\n    async def validate_payload(\n        cls, webhook: integrations.Webhook, request: Request\n    ) -> tuple[dict, str]:\n        if not (event_type := request.headers.get(\"X-GitHub-Event\")):\n            raise HTTPException(\n                status_code=400, detail=\"X-GitHub-Event header is missing!\"\n            )\n\n        if not (signature_header := request.headers.get(\"X-Hub-Signature-256\")):\n            raise HTTPException(\n                status_code=403, detail=\"X-Hub-Signature-256 header is missing!\"\n            )\n\n        payload_body = await request.body()\n        hash_object = hmac.new(\n            webhook.secret.encode(\"utf-8\"), msg=payload_body, digestmod=hashlib.sha256\n        )\n        expected_signature = \"sha256=\" + hash_object.hexdigest()\n\n        if not hmac.compare_digest(expected_signature, signature_header):\n            raise HTTPException(\n                status_code=403, detail=\"Request signatures didn't match!\"\n            )\n\n        payload = await request.json()\n        if action := payload.get(\"action\"):\n            event_type += f\".{action}\"\n\n        return payload, event_type\n\n    async def trigger_ping(\n        self, webhook: integrations.Webhook, credentials: Credentials | None\n    ) -> None:\n        if not credentials:\n            raise ValueError(\"Credentials are required but were not passed\")\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n\n        repo, github_hook_id = webhook.resource, webhook.provider_webhook_id\n        ping_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{github_hook_id}/pings\"\n\n        response = requests.post(ping_url, headers=headers)\n\n        if response.status_code != 204:\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to ping GitHub webhook: {error_msg}\")\n\n    async def _register_webhook(\n        self,\n        credentials: Credentials,\n        webhook_type: GithubWebhookType,\n        resource: str,\n        events: list[str],\n        ingress_url: str,\n        secret: str,\n    ) -> tuple[str, dict]:\n        if webhook_type == self.WebhookType.REPO and resource.count(\"/\") > 1:\n            raise ValueError(\"Invalid repo format: expected 'owner/repo'\")\n\n        # Extract main event, e.g. `pull_request.opened` -> `pull_request`\n        github_events = list({event.split(\".\")[0] for event in events})\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n        webhook_data = {\n            \"name\": \"web\",\n            \"active\": True,\n            \"events\": github_events,\n            \"config\": {\n                \"url\": ingress_url,\n                \"content_type\": \"json\",\n                \"insecure_ssl\": \"0\",\n                \"secret\": secret,\n            },\n        }\n\n        response = requests.post(\n            f\"{self.GITHUB_API_URL}/repos/{resource}/hooks\",\n            headers=headers,\n            json=webhook_data,\n        )\n\n        if response.status_code != 201:\n            error_msg = extract_github_error_msg(response)\n            if \"not found\" in error_msg.lower():\n                error_msg = (\n                    f\"{error_msg} \"\n                    \"(Make sure the GitHub account or API key has 'repo' or \"\n                    f\"webhook create permissions to '{resource}')\"\n                )\n            raise ValueError(f\"Failed to create GitHub webhook: {error_msg}\")\n\n        webhook_id = response.json()[\"id\"]\n        config = response.json()[\"config\"]\n\n        return str(webhook_id), config\n\n",
                    "children": [
                        {
                            "type": "class_definition",
                            "start_token": 96,
                            "end_token": 126,
                            "label": "class GithubWebhooksManager(BaseWebhooksManager):\n    PROVIDER_NAME = ProviderName.GITHUB\n\n    WebhookType = GithubWebhookType\n\n    GITHUB_API_URL = \"https://api.github.com\"\n    GITHUB_API_DEFAULT_HEADERS = {\"Accept\": \"application/vnd.github.v3+json\"}\n",
                            "children": [
                                {
                                    "type": "identifier",
                                    "start_token": 97,
                                    "end_token": 97,
                                    "label": "GithubWebhooksManager",
                                    "children": []
                                },
                                {
                                    "type": "argument_list",
                                    "start_token": 98,
                                    "end_token": 100,
                                    "label": "(BaseWebhooksManager)",
                                    "children": [
                                        {
                                            "type": "identifier",
                                            "start_token": 99,
                                            "end_token": 99,
                                            "label": "BaseWebhooksManager",
                                            "children": []
                                        }
                                    ]
                                },
                                {
                                    "type": "block",
                                    "start_token": 101,
                                    "end_token": 126,
                                    "label": ":\n    PROVIDER_NAME = ProviderName.GITHUB\n\n    WebhookType = GithubWebhookType\n\n    GITHUB_API_URL = \"https://api.github.com\"\n    GITHUB_API_DEFAULT_HEADERS = {\"Accept\": \"application/vnd.github.v3+json\"}\n",
                                    "children": [
                                        {
                                            "type": "assignment",
                                            "start_token": 103,
                                            "end_token": 107,
                                            "label": "PROVIDER_NAME = ProviderName.GITHUB",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 103,
                                                    "end_token": 103,
                                                    "label": "PROVIDER_NAME",
                                                    "children": []
                                                },
                                                {
                                                    "type": "attribute",
                                                    "start_token": 105,
                                                    "end_token": 107,
                                                    "label": "ProviderName.GITHUB",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 105,
                                                            "end_token": 105,
                                                            "label": "ProviderName",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 107,
                                                            "end_token": 107,
                                                            "label": "GITHUB",
                                                            "children": []
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 110,
                                            "end_token": 112,
                                            "label": "WebhookType = GithubWebhookType",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 110,
                                                    "end_token": 110,
                                                    "label": "WebhookType",
                                                    "children": []
                                                },
                                                {
                                                    "type": "identifier",
                                                    "start_token": 112,
                                                    "end_token": 112,
                                                    "label": "GithubWebhookType",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 115,
                                            "end_token": 117,
                                            "label": "GITHUB_API_URL = \"https://api.github.com\"",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 115,
                                                    "end_token": 115,
                                                    "label": "GITHUB_API_URL",
                                                    "children": []
                                                },
                                                {
                                                    "type": "string",
                                                    "start_token": 117,
                                                    "end_token": 117,
                                                    "label": "\"https://api.github.com\"",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 119,
                                            "end_token": 125,
                                            "label": "GITHUB_API_DEFAULT_HEADERS = {\"Accept\": \"application/vnd.github.v3+json\"}",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 119,
                                                    "end_token": 119,
                                                    "label": "GITHUB_API_DEFAULT_HEADERS",
                                                    "children": []
                                                },
                                                {
                                                    "type": "dictionary",
                                                    "start_token": 121,
                                                    "end_token": 125,
                                                    "label": "{\"Accept\": \"application/vnd.github.v3+json\"}",
                                                    "children": [
                                                        {
                                                            "type": "pair",
                                                            "start_token": 122,
                                                            "end_token": 124,
                                                            "label": "\"Accept\": \"application/vnd.github.v3+json\"",
                                                            "children": [
                                                                {
                                                                    "type": "string",
                                                                    "start_token": 122,
                                                                    "end_token": 122,
                                                                    "label": "\"Accept\"",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "string",
                                                                    "start_token": 124,
                                                                    "end_token": 124,
                                                                    "label": "\"application/vnd.github.v3+json\"",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "type": "decorated_definition",
                            "start_token": 128,
                            "end_token": 130,
                            "label": "@classmethod\n",
                            "children": [
                                {
                                    "type": "decorator",
                                    "start_token": 128,
                                    "end_token": 128,
                                    "label": "@",
                                    "children": []
                                },
                                {
                                    "type": "class_definition",
                                    "start_token": 129,
                                    "end_token": 130,
                                    "label": "classmethod\n",
                                    "children": []
                                }
                            ]
                        },
                        {
                            "type": "function_definition",
                            "start_token": 131,
                            "end_token": 330,
                            "label": "async def validate_payload(\n        cls, webhook: integrations.Webhook, request: Request\n    ) -> tuple[dict, str]:\n        if not (event_type := request.headers.get(\"X-GitHub-Event\")):\n            raise HTTPException(\n                status_code=400, detail=\"X-GitHub-Event header is missing!\"\n            )\n\n        if not (signature_header := request.headers.get(\"X-Hub-Signature-256\")):\n            raise HTTPException(\n                status_code=403, detail=\"X-Hub-Signature-256 header is missing!\"\n            )\n\n        payload_body = await request.body()\n        hash_object = hmac.new(\n            webhook.secret.encode(\"utf-8\"), msg=payload_body, digestmod=hashlib.sha256\n        )\n        expected_signature = \"sha256=\" + hash_object.hexdigest()\n\n        if not hmac.compare_digest(expected_signature, signature_header):\n            raise HTTPException(\n                status_code=403, detail=\"Request signatures didn't match!\"\n            )\n\n        payload = await request.json()\n        if action := payload.get(\"action\"):\n            event_type += f\".{action}\"\n\n        return payload, event_type\n",
                            "children": [
                                {
                                    "type": "identifier",
                                    "start_token": 133,
                                    "end_token": 133,
                                    "label": "validate_payload",
                                    "children": []
                                },
                                {
                                    "type": "parameters",
                                    "start_token": 134,
                                    "end_token": 148,
                                    "label": "(\n        cls, webhook: integrations.Webhook, request: Request\n    )",
                                    "children": [
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 136,
                                            "end_token": 139,
                                            "label": "cls, webhook:",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 136,
                                                    "end_token": 136,
                                                    "label": "cls",
                                                    "children": []
                                                },
                                                {
                                                    "type": "dotted_name",
                                                    "start_token": 140,
                                                    "end_token": 142,
                                                    "label": "integrations.Webhook",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 140,
                                                            "end_token": 140,
                                                            "label": "integrations",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 142,
                                                            "end_token": 142,
                                                            "label": "Webhook",
                                                            "children": []
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 144,
                                            "end_token": 146,
                                            "label": "request: Request",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 144,
                                                    "end_token": 144,
                                                    "label": "request",
                                                    "children": []
                                                },
                                                {
                                                    "type": "type",
                                                    "start_token": 146,
                                                    "end_token": 146,
                                                    "label": "Request",
                                                    "children": []
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "type": "generic_type",
                                    "start_token": 150,
                                    "end_token": 156,
                                    "label": "> tuple[dict, str]",
                                    "children": [
                                        {
                                            "type": "type",
                                            "start_token": 151,
                                            "end_token": 156,
                                            "label": "tuple[dict, str]",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 153,
                                                    "end_token": 153,
                                                    "label": "dict",
                                                    "children": []
                                                },
                                                {
                                                    "type": "identifier",
                                                    "start_token": 155,
                                                    "end_token": 155,
                                                    "label": "str",
                                                    "children": []
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "type": "block",
                                    "start_token": 159,
                                    "end_token": 330,
                                    "label": "if not (event_type := request.headers.get(\"X-GitHub-Event\")):\n            raise HTTPException(\n                status_code=400, detail=\"X-GitHub-Event header is missing!\"\n            )\n\n        if not (signature_header := request.headers.get(\"X-Hub-Signature-256\")):\n            raise HTTPException(\n                status_code=403, detail=\"X-Hub-Signature-256 header is missing!\"\n            )\n\n        payload_body = await request.body()\n        hash_object = hmac.new(\n            webhook.secret.encode(\"utf-8\"), msg=payload_body, digestmod=hashlib.sha256\n        )\n        expected_signature = \"sha256=\" + hash_object.hexdigest()\n\n        if not hmac.compare_digest(expected_signature, signature_header):\n            raise HTTPException(\n                status_code=403, detail=\"Request signatures didn't match!\"\n            )\n\n        payload = await request.json()\n        if action := payload.get(\"action\"):\n            event_type += f\".{action}\"\n\n        return payload, event_type\n",
                                    "children": [
                                        {
                                            "type": "if_statement",
                                            "start_token": 159,
                                            "end_token": 188,
                                            "label": "if not (event_type := request.headers.get(\"X-GitHub-Event\")):\n            raise HTTPException(\n                status_code=400, detail=\"X-GitHub-Event header is missing!\"\n            )",
                                            "children": [
                                                {
                                                    "type": "not_operator",
                                                    "start_token": 160,
                                                    "end_token": 173,
                                                    "label": "not (event_type := request.headers.get(\"X-GitHub-Event\"))",
                                                    "children": [
                                                        {
                                                            "type": "call",
                                                            "start_token": 169,
                                                            "end_token": 172,
                                                            "label": "get(\"X-GitHub-Event\")",
                                                            "children": [
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 165,
                                                                    "end_token": 168,
                                                                    "label": "request.headers.",
                                                                    "children": [
                                                                        {
                                                                            "type": "attribute",
                                                                            "start_token": 165,
                                                                            "end_token": 166,
                                                                            "label": "request.",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 165,
                                                                                    "end_token": 165,
                                                                                    "label": "request",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 166,
                                                                                    "end_token": 166,
                                                                                    "label": ".",
                                                                                    "children": []
                                                                                }
                                                                            ]
                                                                        },
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 168,
                                                                            "end_token": 168,
                                                                            "label": ".",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    "type": "string",
                                                                    "start_token": 171,
                                                                    "end_token": 171,
                                                                    "label": "\"X-GitHub-Event\"",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "raise_statement",
                                                    "start_token": 176,
                                                    "end_token": 188,
                                                    "label": "raise HTTPException(\n                status_code=400, detail=\"X-GitHub-Event header is missing!\"\n            )",
                                                    "children": [
                                                        {
                                                            "type": "call",
                                                            "start_token": 177,
                                                            "end_token": 188,
                                                            "label": "HTTPException(\n                status_code=400, detail=\"X-GitHub-Event header is missing!\"\n            )",
                                                            "children": [
                                                                {
                                                                    "type": "keyword_argument",
                                                                    "start_token": 180,
                                                                    "end_token": 182,
                                                                    "label": "status_code=400",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "keyword_argument",
                                                                    "start_token": 184,
                                                                    "end_token": 186,
                                                                    "label": "detail=\"X-GitHub-Event header is missing!\"",
                                                                    "children": [
                                                                        {
                                                                            "type": "string",
                                                                            "start_token": 186,
                                                                            "end_token": 186,
                                                                            "label": "\"X-GitHub-Event header is missing!\"",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "if_statement",
                                            "start_token": 191,
                                            "end_token": 220,
                                            "label": "if not (signature_header := request.headers.get(\"X-Hub-Signature-256\")):\n            raise HTTPException(\n                status_code=403, detail=\"X-Hub-Signature-256 header is missing!\"\n            )",
                                            "children": [
                                                {
                                                    "type": "not_operator",
                                                    "start_token": 192,
                                                    "end_token": 205,
                                                    "label": "not (signature_header := request.headers.get(\"X-Hub-Signature-256\"))",
                                                    "children": [
                                                        {
                                                            "type": "call",
                                                            "start_token": 201,
                                                            "end_token": 204,
                                                            "label": "get(\"X-Hub-Signature-256\")",
                                                            "children": [
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 198,
                                                                    "end_token": 200,
                                                                    "label": ".headers.",
                                                                    "children": [
                                                                        {
                                                                            "type": "attribute",
                                                                            "start_token": 198,
                                                                            "end_token": 199,
                                                                            "label": ".headers",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 198,
                                                                                    "end_token": 198,
                                                                                    "label": ".",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 199,
                                                                                    "end_token": 199,
                                                                                    "label": "headers",
                                                                                    "children": []
                                                                                }
                                                                            ]
                                                                        },
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 200,
                                                                            "end_token": 200,
                                                                            "label": ".",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    "type": "string",
                                                                    "start_token": 203,
                                                                    "end_token": 203,
                                                                    "label": "\"X-Hub-Signature-256\"",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "raise_statement",
                                                    "start_token": 208,
                                                    "end_token": 220,
                                                    "label": "raise HTTPException(\n                status_code=403, detail=\"X-Hub-Signature-256 header is missing!\"\n            )",
                                                    "children": [
                                                        {
                                                            "type": "call",
                                                            "start_token": 209,
                                                            "end_token": 220,
                                                            "label": "HTTPException(\n                status_code=403, detail=\"X-Hub-Signature-256 header is missing!\"\n            )",
                                                            "children": [
                                                                {
                                                                    "type": "keyword_argument",
                                                                    "start_token": 212,
                                                                    "end_token": 214,
                                                                    "label": "status_code=403",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "keyword_argument",
                                                                    "start_token": 216,
                                                                    "end_token": 218,
                                                                    "label": "detail=\"X-Hub-Signature-256 header is missing!\"",
                                                                    "children": [
                                                                        {
                                                                            "type": "string",
                                                                            "start_token": 218,
                                                                            "end_token": 218,
                                                                            "label": "\"X-Hub-Signature-256 header is missing!\"",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 223,
                                            "end_token": 230,
                                            "label": "payload_body = await request.body()",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 223,
                                                    "end_token": 223,
                                                    "label": "payload_body",
                                                    "children": []
                                                },
                                                {
                                                    "type": "await",
                                                    "start_token": 225,
                                                    "end_token": 230,
                                                    "label": "await request.body()",
                                                    "children": [
                                                        {
                                                            "type": "call",
                                                            "start_token": 226,
                                                            "end_token": 230,
                                                            "label": "request.body()",
                                                            "children": [
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 226,
                                                                    "end_token": 228,
                                                                    "label": "request.body",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 226,
                                                                            "end_token": 226,
                                                                            "label": "request",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 228,
                                                                            "end_token": 228,
                                                                            "label": "body",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 232,
                                            "end_token": 258,
                                            "label": "hash_object = hmac.new(\n            webhook.secret.encode(\"utf-8\"), msg=payload_body, digestmod=hashlib.sha256\n        )",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 232,
                                                    "end_token": 232,
                                                    "label": "hash_object",
                                                    "children": []
                                                },
                                                {
                                                    "type": "call",
                                                    "start_token": 237,
                                                    "end_token": 258,
                                                    "label": "(\n            webhook.secret.encode(\"utf-8\"), msg=payload_body, digestmod=hashlib.sha256\n        )",
                                                    "children": [
                                                        {
                                                            "type": "attribute",
                                                            "start_token": 234,
                                                            "end_token": 236,
                                                            "label": "hmac.new",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 234,
                                                                    "end_token": 234,
                                                                    "label": "hmac",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 236,
                                                                    "end_token": 236,
                                                                    "label": "new",
                                                                    "children": []
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "keyword_argument",
                                                            "start_token": 239,
                                                            "end_token": 247,
                                                            "label": "webhook.secret.encode(\"utf-8\"),",
                                                            "children": [
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 239,
                                                                    "end_token": 245,
                                                                    "label": "webhook.secret.encode(\"utf-8\"",
                                                                    "children": [
                                                                        {
                                                                            "type": "attribute",
                                                                            "start_token": 239,
                                                                            "end_token": 241,
                                                                            "label": "webhook.secret",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 239,
                                                                                    "end_token": 239,
                                                                                    "label": "webhook",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 241,
                                                                                    "end_token": 241,
                                                                                    "label": "secret",
                                                                                    "children": []
                                                                                }
                                                                            ]
                                                                        },
                                                                        {
                                                                            "type": "call",
                                                                            "start_token": 243,
                                                                            "end_token": 245,
                                                                            "label": "encode(\"utf-8\"",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 243,
                                                                                    "end_token": 243,
                                                                                    "label": "encode",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "string",
                                                                                    "start_token": 245,
                                                                                    "end_token": 245,
                                                                                    "label": "\"utf-8\"",
                                                                                    "children": []
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "keyword_argument",
                                                            "start_token": 249,
                                                            "end_token": 251,
                                                            "label": "=payload_body,",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 250,
                                                                    "end_token": 250,
                                                                    "label": "payload_body",
                                                                    "children": []
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "dotted_name",
                                                            "start_token": 254,
                                                            "end_token": 256,
                                                            "label": "hashlib.sha256",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 254,
                                                                    "end_token": 254,
                                                                    "label": "hashlib",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 256,
                                                                    "end_token": 256,
                                                                    "label": "sha256",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 260,
                                            "end_token": 269,
                                            "label": "expected_signature = \"sha256=\" + hash_object.hexdigest()\n",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 260,
                                                    "end_token": 260,
                                                    "label": "expected_signature",
                                                    "children": []
                                                },
                                                {
                                                    "type": "concatenated_string",
                                                    "start_token": 262,
                                                    "end_token": 264,
                                                    "label": "\"sha256=\" + hash_object",
                                                    "children": [
                                                        {
                                                            "type": "string",
                                                            "start_token": 262,
                                                            "end_token": 262,
                                                            "label": "\"sha256=\"",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "attribute",
                                                            "start_token": 264,
                                                            "end_token": 266,
                                                            "label": "hash_object.hexdigest",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 264,
                                                                    "end_token": 264,
                                                                    "label": "hash_object",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "call",
                                                                    "start_token": 267,
                                                                    "end_token": 268,
                                                                    "label": "()",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "if_statement",
                                            "start_token": 271,
                                            "end_token": 295,
                                            "label": "if not hmac.compare_digest(expected_signature, signature_header):\n            raise HTTPException(\n                status_code=403, detail=\"Request signatures didn't match!\"\n            )",
                                            "children": [
                                                {
                                                    "type": "not_operator",
                                                    "start_token": 272,
                                                    "end_token": 280,
                                                    "label": "not hmac.compare_digest(expected_signature, signature_header)",
                                                    "children": [
                                                        {
                                                            "type": "call",
                                                            "start_token": 276,
                                                            "end_token": 280,
                                                            "label": "(expected_signature, signature_header)",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 275,
                                                                    "end_token": 275,
                                                                    "label": "compare_digest",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 277,
                                                                    "end_token": 277,
                                                                    "label": "expected_signature",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 279,
                                                                    "end_token": 279,
                                                                    "label": "signature_header",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "raise_statement",
                                                    "start_token": 283,
                                                    "end_token": 295,
                                                    "label": "raise HTTPException(\n                status_code=403, detail=\"Request signatures didn't match!\"\n            )",
                                                    "children": [
                                                        {
                                                            "type": "call",
                                                            "start_token": 284,
                                                            "end_token": 295,
                                                            "label": "HTTPException(\n                status_code=403, detail=\"Request signatures didn't match!\"\n            )",
                                                            "children": [
                                                                {
                                                                    "type": "keyword_argument",
                                                                    "start_token": 287,
                                                                    "end_token": 289,
                                                                    "label": "status_code=403",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "keyword_argument",
                                                                    "start_token": 291,
                                                                    "end_token": 293,
                                                                    "label": "detail=\"Request signatures didn't match!\"",
                                                                    "children": [
                                                                        {
                                                                            "type": "string",
                                                                            "start_token": 293,
                                                                            "end_token": 293,
                                                                            "label": "\"Request signatures didn't match!\"",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 298,
                                            "end_token": 305,
                                            "label": "payload = await request.json()",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 298,
                                                    "end_token": 298,
                                                    "label": "payload",
                                                    "children": []
                                                },
                                                {
                                                    "type": "await",
                                                    "start_token": 300,
                                                    "end_token": 305,
                                                    "label": "await request.json()",
                                                    "children": [
                                                        {
                                                            "type": "call",
                                                            "start_token": 301,
                                                            "end_token": 305,
                                                            "label": "request.json()",
                                                            "children": [
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 301,
                                                                    "end_token": 303,
                                                                    "label": "request.json",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 301,
                                                                            "end_token": 301,
                                                                            "label": "request",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 303,
                                                                            "end_token": 303,
                                                                            "label": "json",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "if_statement",
                                            "start_token": 307,
                                            "end_token": 324,
                                            "label": "if action := payload.get(\"action\"):\n            event_type += f\".{action}\"\n",
                                            "children": [
                                                {
                                                    "type": "named_expression",
                                                    "start_token": 308,
                                                    "end_token": 316,
                                                    "label": "action := payload.get(\"action\")",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 308,
                                                            "end_token": 308,
                                                            "label": "action",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "call",
                                                            "start_token": 314,
                                                            "end_token": 316,
                                                            "label": "(\"action\")",
                                                            "children": []
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "augmented_assignment",
                                                    "start_token": 319,
                                                    "end_token": 323,
                                                    "label": "event_type += f\".{action}\"",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 319,
                                                            "end_token": 319,
                                                            "label": "event_type",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "concatenated_string",
                                                            "start_token": 322,
                                                            "end_token": 323,
                                                            "label": "f\".{action}\"",
                                                            "children": [
                                                                {
                                                                    "type": "string",
                                                                    "start_token": 322,
                                                                    "end_token": 323,
                                                                    "label": "f\".{action}\"",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "return_statement",
                                            "start_token": 326,
                                            "end_token": 329,
                                            "label": "return payload, event_type",
                                            "children": [
                                                {
                                                    "type": "expression_list",
                                                    "start_token": 327,
                                                    "end_token": 329,
                                                    "label": "payload, event_type",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 327,
                                                            "end_token": 327,
                                                            "label": "payload",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 329,
                                                            "end_token": 329,
                                                            "label": "event_type",
                                                            "children": []
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ],
                            "name": "validate_payload",
                            "start_line": 32,
                            "end_line": 60
                        },
                        {
                            "type": "function_placeholder",
                            "name": "trigger_ping",
                            "start_line": 62,
                            "end_line": 81,
                            "start_token": 332,
                            "end_token": 447,
                            "label": "async def trigger_ping(\n        self, webhook: integrations.Webhook, credentials: Credentials | None\n    ) -> None:\n        if not credentials:\n            raise ValueError(\"Credentials are required but were not passed\")\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n\n        repo, github_hook_id = webhook.resource, webhook.provider_webhook_id\n        ping_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{github_hook_id}/pings\"\n\n        response = requests.post(ping_url, headers=headers)\n\n        if response.status_code != 204:\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to ping GitHub webhook: {error_msg}\")\n\n",
                            "children": [
                                {
                                    "type": "module",
                                    "start_token": 332,
                                    "end_token": 445,
                                    "label": "async def trigger_ping(\n        self, webhook: integrations.Webhook, credentials: Credentials | None\n    ) -> None:\n        if not credentials:\n            raise ValueError(\"Credentials are required but were not passed\")\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n\n        repo, github_hook_id = webhook.resource, webhook.provider_webhook_id\n        ping_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{github_hook_id}/pings\"\n\n        response = requests.post(ping_url, headers=headers)\n\n        if response.status_code != 204:\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to ping GitHub webhook: {error_msg}\")",
                                    "children": [
                                        {
                                            "type": "decorated_definition",
                                            "start_token": 332,
                                            "end_token": 354,
                                            "label": "async def trigger_ping(\n        self, webhook: integrations.Webhook, credentials: Credentials | None\n    ) -> None",
                                            "children": [
                                                {
                                                    "type": "function_definition",
                                                    "start_token": 332,
                                                    "end_token": 354,
                                                    "label": "async def trigger_ping(\n        self, webhook: integrations.Webhook, credentials: Credentials | None\n    ) -> None",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 333,
                                                            "end_token": 333,
                                                            "label": "def",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 334,
                                                            "end_token": 334,
                                                            "label": "trigger_ping",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "parameters",
                                                            "start_token": 335,
                                                            "end_token": 351,
                                                            "label": "(\n        self, webhook: integrations.Webhook, credentials: Credentials | None\n    )",
                                                            "children": [
                                                                {
                                                                    "type": "typed_parameter",
                                                                    "start_token": 337,
                                                                    "end_token": 337,
                                                                    "label": "self",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "typed_parameter",
                                                                    "start_token": 339,
                                                                    "end_token": 343,
                                                                    "label": "webhook: integrations.Webhook",
                                                                    "children": [
                                                                        {
                                                                            "type": "type",
                                                                            "start_token": 341,
                                                                            "end_token": 343,
                                                                            "label": "integrations.Webhook",
                                                                            "children": [
                                                                                {
                                                                                    "type": "dotted_name",
                                                                                    "start_token": 341,
                                                                                    "end_token": 343,
                                                                                    "label": "integrations.Webhook",
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "identifier",
                                                                                            "start_token": 341,
                                                                                            "end_token": 341,
                                                                                            "label": "integrations",
                                                                                            "children": []
                                                                                        },
                                                                                        {
                                                                                            "type": "identifier",
                                                                                            "start_token": 343,
                                                                                            "end_token": 343,
                                                                                            "label": "Webhook",
                                                                                            "children": []
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    "type": "typed_default_parameter",
                                                                    "start_token": 345,
                                                                    "end_token": 349,
                                                                    "label": "credentials: Credentials | None",
                                                                    "children": [
                                                                        {
                                                                            "type": "type",
                                                                            "start_token": 347,
                                                                            "end_token": 347,
                                                                            "label": "Credentials",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "none",
                                                                            "start_token": 349,
                                                                            "end_token": 349,
                                                                            "label": "None",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "none",
                                                            "start_token": 354,
                                                            "end_token": 354,
                                                            "label": "None",
                                                            "children": []
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "block",
                                            "start_token": 356,
                                            "end_token": 445,
                                            "label": "\n        if not credentials:\n            raise ValueError(\"Credentials are required but were not passed\")\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n\n        repo, github_hook_id = webhook.resource, webhook.provider_webhook_id\n        ping_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{github_hook_id}/pings\"\n\n        response = requests.post(ping_url, headers=headers)\n\n        if response.status_code != 204:\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to ping GitHub webhook: {error_msg}\")",
                                            "children": [
                                                {
                                                    "type": "if_statement",
                                                    "start_token": 357,
                                                    "end_token": 366,
                                                    "label": "if not credentials:\n            raise ValueError(\"Credentials are required but were not passed\")",
                                                    "children": [
                                                        {
                                                            "type": "not_operator",
                                                            "start_token": 358,
                                                            "end_token": 359,
                                                            "label": "not credentials",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 359,
                                                                    "end_token": 359,
                                                                    "label": "credentials",
                                                                    "children": []
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "block",
                                                            "start_token": 360,
                                                            "end_token": 366,
                                                            "label": ":\n            raise ValueError(\"Credentials are required but were not passed\")",
                                                            "children": [
                                                                {
                                                                    "type": "raise_statement",
                                                                    "start_token": 362,
                                                                    "end_token": 366,
                                                                    "label": "raise ValueError(\"Credentials are required but were not passed\")",
                                                                    "children": [
                                                                        {
                                                                            "type": "call",
                                                                            "start_token": 363,
                                                                            "end_token": 366,
                                                                            "label": "ValueError(\"Credentials are required but were not passed\")",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 363,
                                                                                    "end_token": 363,
                                                                                    "label": "ValueError",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "argument_list",
                                                                                    "start_token": 364,
                                                                                    "end_token": 366,
                                                                                    "label": "(\"Credentials are required but were not passed\")",
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "string",
                                                                                            "start_token": 365,
                                                                                            "end_token": 365,
                                                                                            "label": "\"Credentials are required but were not passed\"",
                                                                                            "children": []
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "assignment",
                                                    "start_token": 369,
                                                    "end_token": 389,
                                                    "label": "headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 369,
                                                            "end_token": 369,
                                                            "label": "headers",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "dictionary",
                                                            "start_token": 371,
                                                            "end_token": 389,
                                                            "label": "{\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }",
                                                            "children": [
                                                                {
                                                                    "type": "dictionary_splat",
                                                                    "start_token": 373,
                                                                    "end_token": 378,
                                                                    "label": "**self.GITHUB_API_DEFAULT_HEADERS,",
                                                                    "children": [
                                                                        {
                                                                            "type": "attribute",
                                                                            "start_token": 375,
                                                                            "end_token": 378,
                                                                            "label": "self.GITHUB_API_DEFAULT_HEADERS,",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 375,
                                                                                    "end_token": 375,
                                                                                    "label": "self",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 377,
                                                                                    "end_token": 378,
                                                                                    "label": "GITHUB_API_DEFAULT_HEADERS,",
                                                                                    "children": []
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    "type": "pair",
                                                                    "start_token": 380,
                                                                    "end_token": 387,
                                                                    "label": "\"Authorization\": credentials.bearer(),",
                                                                    "children": [
                                                                        {
                                                                            "type": "string",
                                                                            "start_token": 380,
                                                                            "end_token": 380,
                                                                            "label": "\"Authorization\"",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "call",
                                                                            "start_token": 382,
                                                                            "end_token": 386,
                                                                            "label": "credentials.bearer()",
                                                                            "children": [
                                                                                {
                                                                                    "type": "attribute",
                                                                                    "start_token": 383,
                                                                                    "end_token": 384,
                                                                                    "label": ".bearer",
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "identifier",
                                                                                            "start_token": 383,
                                                                                            "end_token": 383,
                                                                                            "label": ".",
                                                                                            "children": []
                                                                                        },
                                                                                        {
                                                                                            "type": "identifier",
                                                                                            "start_token": 384,
                                                                                            "end_token": 384,
                                                                                            "label": "bearer",
                                                                                            "children": []
                                                                                        }
                                                                                    ]
                                                                                },
                                                                                {
                                                                                    "type": "argument_list",
                                                                                    "start_token": 385,
                                                                                    "end_token": 386,
                                                                                    "label": "()",
                                                                                    "children": []
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "assignment",
                                                    "start_token": 392,
                                                    "end_token": 403,
                                                    "label": "repo, github_hook_id = webhook.resource, webhook.provider_webhook_id\n",
                                                    "children": [
                                                        {
                                                            "type": "expression_list",
                                                            "start_token": 392,
                                                            "end_token": 394,
                                                            "label": "repo, github_hook_id",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 392,
                                                                    "end_token": 392,
                                                                    "label": "repo",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 394,
                                                                    "end_token": 394,
                                                                    "label": "github_hook_id",
                                                                    "children": []
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "expression_list",
                                                            "start_token": 396,
                                                            "end_token": 402,
                                                            "label": "webhook.resource, webhook.provider_webhook_id",
                                                            "children": [
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 397,
                                                                    "end_token": 398,
                                                                    "label": ".resource",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 397,
                                                                            "end_token": 397,
                                                                            "label": ".",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 398,
                                                                            "end_token": 398,
                                                                            "label": "resource",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 401,
                                                                    "end_token": 402,
                                                                    "label": ".provider_webhook_id",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 401,
                                                                            "end_token": 401,
                                                                            "label": ".",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 402,
                                                                            "end_token": 402,
                                                                            "label": "provider_webhook_id",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "assignment",
                                                    "start_token": 404,
                                                    "end_token": 407,
                                                    "label": "ping_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{github_hook_id}/pings\"",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 404,
                                                            "end_token": 404,
                                                            "label": "ping_url",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "concatenated_string",
                                                            "start_token": 406,
                                                            "end_token": 407,
                                                            "label": "f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{github_hook_id}/pings\"",
                                                            "children": [
                                                                {
                                                                    "type": "string",
                                                                    "start_token": 407,
                                                                    "end_token": 407,
                                                                    "label": "\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{github_hook_id}/pings\"",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "assignment",
                                                    "start_token": 410,
                                                    "end_token": 421,
                                                    "label": "response = requests.post(ping_url, headers=headers)",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 410,
                                                            "end_token": 410,
                                                            "label": "response",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "call",
                                                            "start_token": 412,
                                                            "end_token": 421,
                                                            "label": "requests.post(ping_url, headers=headers)",
                                                            "children": [
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 412,
                                                                    "end_token": 414,
                                                                    "label": "requests.post",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 412,
                                                                            "end_token": 412,
                                                                            "label": "requests",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 414,
                                                                            "end_token": 414,
                                                                            "label": "post",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    "type": "argument_list",
                                                                    "start_token": 415,
                                                                    "end_token": 421,
                                                                    "label": "(ping_url, headers=headers)",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 416,
                                                                            "end_token": 416,
                                                                            "label": "ping_url",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "keyword_argument",
                                                                            "start_token": 418,
                                                                            "end_token": 420,
                                                                            "label": "headers=headers",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 418,
                                                                                    "end_token": 418,
                                                                                    "label": "headers",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 420,
                                                                                    "end_token": 420,
                                                                                    "label": "headers",
                                                                                    "children": []
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "if_statement",
                                                    "start_token": 424,
                                                    "end_token": 445,
                                                    "label": "if response.status_code != 204:\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to ping GitHub webhook: {error_msg}\")",
                                                    "children": [
                                                        {
                                                            "type": "comparison_operator",
                                                            "start_token": 426,
                                                            "end_token": 430,
                                                            "label": ".status_code != 204",
                                                            "children": [
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 425,
                                                                    "end_token": 427,
                                                                    "label": "response.status_code",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 425,
                                                                            "end_token": 425,
                                                                            "label": "response",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 427,
                                                                            "end_token": 427,
                                                                            "label": "status_code",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    "type": "integer",
                                                                    "start_token": 430,
                                                                    "end_token": 430,
                                                                    "label": "204",
                                                                    "children": []
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "block",
                                                            "start_token": 431,
                                                            "end_token": 445,
                                                            "label": ":\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to ping GitHub webhook: {error_msg}\")",
                                                            "children": [
                                                                {
                                                                    "type": "assignment",
                                                                    "start_token": 433,
                                                                    "end_token": 438,
                                                                    "label": "error_msg = extract_github_error_msg(response)",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 433,
                                                                            "end_token": 433,
                                                                            "label": "error_msg",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "call",
                                                                            "start_token": 435,
                                                                            "end_token": 438,
                                                                            "label": "extract_github_error_msg(response)",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 435,
                                                                                    "end_token": 435,
                                                                                    "label": "extract_github_error_msg",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "argument_list",
                                                                                    "start_token": 436,
                                                                                    "end_token": 438,
                                                                                    "label": "(response)",
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "identifier",
                                                                                            "start_token": 437,
                                                                                            "end_token": 437,
                                                                                            "label": "response",
                                                                                            "children": []
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    "type": "raise_statement",
                                                                    "start_token": 440,
                                                                    "end_token": 445,
                                                                    "label": "raise ValueError(f\"Failed to ping GitHub webhook: {error_msg}\")",
                                                                    "children": [
                                                                        {
                                                                            "type": "call",
                                                                            "start_token": 441,
                                                                            "end_token": 445,
                                                                            "label": "ValueError(f\"Failed to ping GitHub webhook: {error_msg}\")",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 441,
                                                                                    "end_token": 441,
                                                                                    "label": "ValueError",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "argument_list",
                                                                                    "start_token": 442,
                                                                                    "end_token": 445,
                                                                                    "label": "(f\"Failed to ping GitHub webhook: {error_msg}\")",
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "concatenated_string",
                                                                                            "start_token": 443,
                                                                                            "end_token": 444,
                                                                                            "label": "f\"Failed to ping GitHub webhook: {error_msg}\"",
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "string",
                                                                                                    "start_token": 444,
                                                                                                    "end_token": 444,
                                                                                                    "label": "\"Failed to ping GitHub webhook: {error_msg}\"",
                                                                                                    "children": []
                                                                                                }
                                                                                            ]
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "type": "function_definition",
                            "start_token": 448,
                            "end_token": 742,
                            "label": "async def _register_webhook(\n        self,\n        credentials: Credentials,\n        webhook_type: GithubWebhookType,\n        resource: str,\n        events: list[str],\n        ingress_url: str,\n        secret: str,\n    ) -> tuple[str, dict]:\n        if webhook_type == self.WebhookType.REPO and resource.count(\"/\") > 1:\n            raise ValueError(\"Invalid repo format: expected 'owner/repo'\")\n\n        # Extract main event, e.g. `pull_request.opened` -> `pull_request`\n        github_events = list({event.split(\".\")[0] for event in events})\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n        webhook_data = {\n            \"name\": \"web\",\n            \"active\": True,\n            \"events\": github_events,\n            \"config\": {\n                \"url\": ingress_url,\n                \"content_type\": \"json\",\n                \"insecure_ssl\": \"0\",\n                \"secret\": secret,\n            },\n        }\n\n        response = requests.post(\n            f\"{self.GITHUB_API_URL}/repos/{resource}/hooks\",\n            headers=headers,\n            json=webhook_data,\n        )\n\n        if response.status_code != 201:\n            error_msg = extract_github_error_msg(response)\n            if \"not found\" in error_msg.lower():\n                error_msg = (\n                    f\"{error_msg} \"\n                    \"(Make sure the GitHub account or API key has 'repo' or \"\n                    f\"webhook create permissions to '{resource}')\"\n                )\n            raise ValueError(f\"Failed to create GitHub webhook: {error_msg}\")\n\n        webhook_id = response.json()[\"id\"]\n        config = response.json()[\"config\"]\n\n        return str(webhook_id), config\n",
                            "children": [
                                {
                                    "type": "identifier",
                                    "start_token": 449,
                                    "end_token": 449,
                                    "label": "def",
                                    "children": []
                                },
                                {
                                    "type": "parameters",
                                    "start_token": 451,
                                    "end_token": 489,
                                    "label": "(\n        self,\n        credentials: Credentials,\n        webhook_type: GithubWebhookType,\n        resource: str,\n        events: list[str],\n        ingress_url: str,\n        secret: str,\n    )",
                                    "children": [
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 453,
                                            "end_token": 453,
                                            "label": "self",
                                            "children": []
                                        },
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 456,
                                            "end_token": 458,
                                            "label": "credentials: Credentials",
                                            "children": []
                                        },
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 461,
                                            "end_token": 463,
                                            "label": "webhook_type: GithubWebhookType",
                                            "children": []
                                        },
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 466,
                                            "end_token": 468,
                                            "label": "resource: str",
                                            "children": []
                                        },
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 471,
                                            "end_token": 476,
                                            "label": "events: list[str]",
                                            "children": []
                                        },
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 479,
                                            "end_token": 481,
                                            "label": "ingress_url: str",
                                            "children": []
                                        },
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 484,
                                            "end_token": 486,
                                            "label": "secret: str",
                                            "children": []
                                        }
                                    ]
                                },
                                {
                                    "type": "generic_type",
                                    "start_token": 492,
                                    "end_token": 497,
                                    "label": "tuple[str, dict]",
                                    "children": []
                                },
                                {
                                    "type": "block",
                                    "start_token": 499,
                                    "end_token": 742,
                                    "label": "\n        if webhook_type == self.WebhookType.REPO and resource.count(\"/\") > 1:\n            raise ValueError(\"Invalid repo format: expected 'owner/repo'\")\n\n        # Extract main event, e.g. `pull_request.opened` -> `pull_request`\n        github_events = list({event.split(\".\")[0] for event in events})\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n        webhook_data = {\n            \"name\": \"web\",\n            \"active\": True,\n            \"events\": github_events,\n            \"config\": {\n                \"url\": ingress_url,\n                \"content_type\": \"json\",\n                \"insecure_ssl\": \"0\",\n                \"secret\": secret,\n            },\n        }\n\n        response = requests.post(\n            f\"{self.GITHUB_API_URL}/repos/{resource}/hooks\",\n            headers=headers,\n            json=webhook_data,\n        )\n\n        if response.status_code != 201:\n            error_msg = extract_github_error_msg(response)\n            if \"not found\" in error_msg.lower():\n                error_msg = (\n                    f\"{error_msg} \"\n                    \"(Make sure the GitHub account or API key has 'repo' or \"\n                    f\"webhook create permissions to '{resource}')\"\n                )\n            raise ValueError(f\"Failed to create GitHub webhook: {error_msg}\")\n\n        webhook_id = response.json()[\"id\"]\n        config = response.json()[\"config\"]\n\n        return str(webhook_id), config\n",
                                    "children": [
                                        {
                                            "type": "boolean_operator",
                                            "start_token": 500,
                                            "end_token": 518,
                                            "label": "if webhook_type == self.WebhookType.REPO and resource.count(\"/\") > 1:",
                                            "children": [
                                                {
                                                    "type": "comparison_operator",
                                                    "start_token": 501,
                                                    "end_token": 508,
                                                    "label": "webhook_type == self.WebhookType.REPO",
                                                    "children": [
                                                        {
                                                            "type": "attribute",
                                                            "start_token": 504,
                                                            "end_token": 508,
                                                            "label": "self.WebhookType.REPO",
                                                            "children": []
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "comparison_operator",
                                                    "start_token": 510,
                                                    "end_token": 517,
                                                    "label": "resource.count(\"/\") > 1",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "raise_statement",
                                            "start_token": 520,
                                            "end_token": 524,
                                            "label": "raise ValueError(\"Invalid repo format: expected 'owner/repo'\")",
                                            "children": [
                                                {
                                                    "type": "call",
                                                    "start_token": 521,
                                                    "end_token": 524,
                                                    "label": "ValueError(\"Invalid repo format: expected 'owner/repo'\")",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "comment",
                                            "start_token": 527,
                                            "end_token": 527,
                                            "label": "#",
                                            "children": []
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 547,
                                            "end_token": 566,
                                            "label": "github_events = list({event.split(\".\")[0] for event in events})",
                                            "children": [
                                                {
                                                    "type": "list_comprehension",
                                                    "start_token": 549,
                                                    "end_token": 565,
                                                    "label": "list({event.split(\".\")[0] for event in events}",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 569,
                                            "end_token": 589,
                                            "label": "headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }",
                                            "children": [
                                                {
                                                    "type": "dictionary_splat",
                                                    "start_token": 573,
                                                    "end_token": 578,
                                                    "label": "**self.GITHUB_API_DEFAULT_HEADERS,",
                                                    "children": []
                                                },
                                                {
                                                    "type": "pair",
                                                    "start_token": 580,
                                                    "end_token": 585,
                                                    "label": "\"Authorization\": credentials.bearer(",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 591,
                                            "end_token": 637,
                                            "label": "webhook_data = {\n            \"name\": \"web\",\n            \"active\": True,\n            \"events\": github_events,\n            \"config\": {\n                \"url\": ingress_url,\n                \"content_type\": \"json\",\n                \"insecure_ssl\": \"0\",\n                \"secret\": secret,\n            },\n        }",
                                            "children": [
                                                {
                                                    "type": "dictionary",
                                                    "start_token": 593,
                                                    "end_token": 637,
                                                    "label": "{\n            \"name\": \"web\",\n            \"active\": True,\n            \"events\": github_events,\n            \"config\": {\n                \"url\": ingress_url,\n                \"content_type\": \"json\",\n                \"insecure_ssl\": \"0\",\n                \"secret\": secret,\n            },\n        }",
                                                    "children": [
                                                        {
                                                            "type": "pair",
                                                            "start_token": 595,
                                                            "end_token": 598,
                                                            "label": "\"name\": \"web\",",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "pair",
                                                            "start_token": 600,
                                                            "end_token": 602,
                                                            "label": "\"active\": True",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "pair",
                                                            "start_token": 605,
                                                            "end_token": 607,
                                                            "label": "\"events\": github_events",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "pair",
                                                            "start_token": 610,
                                                            "end_token": 634,
                                                            "label": "\"config\": {\n                \"url\": ingress_url,\n                \"content_type\": \"json\",\n                \"insecure_ssl\": \"0\",\n                \"secret\": secret,\n            }",
                                                            "children": [
                                                                {
                                                                    "type": "dictionary",
                                                                    "start_token": 612,
                                                                    "end_token": 634,
                                                                    "label": "{\n                \"url\": ingress_url,\n                \"content_type\": \"json\",\n                \"insecure_ssl\": \"0\",\n                \"secret\": secret,\n            }",
                                                                    "children": [
                                                                        {
                                                                            "type": "pair",
                                                                            "start_token": 614,
                                                                            "end_token": 616,
                                                                            "label": "\"url\": ingress_url",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "pair",
                                                                            "start_token": 619,
                                                                            "end_token": 621,
                                                                            "label": "\"content_type\": \"json\"",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "pair",
                                                                            "start_token": 624,
                                                                            "end_token": 626,
                                                                            "label": "\"insecure_ssl\": \"0\"",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "pair",
                                                                            "start_token": 629,
                                                                            "end_token": 631,
                                                                            "label": "\"secret\": secret",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "call",
                                            "start_token": 640,
                                            "end_token": 661,
                                            "label": "response = requests.post(\n            f\"{self.GITHUB_API_URL}/repos/{resource}/hooks\",\n            headers=headers,\n            json=webhook_data,\n        )",
                                            "children": [
                                                {
                                                    "type": "f_string",
                                                    "start_token": 647,
                                                    "end_token": 649,
                                                    "label": "f\"{self.GITHUB_API_URL}/repos/{resource}/hooks\",",
                                                    "children": []
                                                },
                                                {
                                                    "type": "pair",
                                                    "start_token": 651,
                                                    "end_token": 653,
                                                    "label": "headers=headers",
                                                    "children": []
                                                },
                                                {
                                                    "type": "pair",
                                                    "start_token": 655,
                                                    "end_token": 658,
                                                    "label": "\n            json=webhook_data",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "boolean_operator",
                                            "start_token": 664,
                                            "end_token": 671,
                                            "label": "if response.status_code != 201:",
                                            "children": [
                                                {
                                                    "type": "comparison_operator",
                                                    "start_token": 665,
                                                    "end_token": 670,
                                                    "label": "response.status_code != 201",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 673,
                                            "end_token": 678,
                                            "label": "error_msg = extract_github_error_msg(response)",
                                            "children": [
                                                {
                                                    "type": "call",
                                                    "start_token": 675,
                                                    "end_token": 678,
                                                    "label": "extract_github_error_msg(response)",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "boolean_operator",
                                            "start_token": 680,
                                            "end_token": 687,
                                            "label": "if \"not found\" in error_msg.lower()",
                                            "children": [
                                                {
                                                    "type": "comparison_operator",
                                                    "start_token": 682,
                                                    "end_token": 687,
                                                    "label": "in error_msg.lower()",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 690,
                                            "end_token": 701,
                                            "label": "error_msg = (\n                    f\"{error_msg} \"\n                    \"(Make sure the GitHub account or API key has 'repo' or \"\n                    f\"webhook create permissions to '{resource}')\"\n",
                                            "children": [
                                                {
                                                    "type": "f_string",
                                                    "start_token": 692,
                                                    "end_token": 701,
                                                    "label": "(\n                    f\"{error_msg} \"\n                    \"(Make sure the GitHub account or API key has 'repo' or \"\n                    f\"webhook create permissions to '{resource}')\"\n",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "raise_statement",
                                            "start_token": 704,
                                            "end_token": 709,
                                            "label": "raise ValueError(f\"Failed to create GitHub webhook: {error_msg}\")",
                                            "children": [
                                                {
                                                    "type": "call",
                                                    "start_token": 705,
                                                    "end_token": 709,
                                                    "label": "ValueError(f\"Failed to create GitHub webhook: {error_msg}\")",
                                                    "children": [
                                                        {
                                                            "type": "f_string",
                                                            "start_token": 707,
                                                            "end_token": 709,
                                                            "label": "f\"Failed to create GitHub webhook: {error_msg}\")",
                                                            "children": []
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 712,
                                            "end_token": 721,
                                            "label": "webhook_id = response.json()[\"id\"]",
                                            "children": [
                                                {
                                                    "type": "subscript",
                                                    "start_token": 714,
                                                    "end_token": 721,
                                                    "label": "response.json()[\"id\"]",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 723,
                                            "end_token": 732,
                                            "label": "config = response.json()[\"config\"]",
                                            "children": [
                                                {
                                                    "type": "subscript",
                                                    "start_token": 725,
                                                    "end_token": 732,
                                                    "label": "response.json()[\"config\"]",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "return_statement",
                                            "start_token": 735,
                                            "end_token": 741,
                                            "label": "return str(webhook_id), config",
                                            "children": [
                                                {
                                                    "type": "tuple",
                                                    "start_token": 736,
                                                    "end_token": 741,
                                                    "label": "str(webhook_id), config",
                                                    "children": []
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ],
                            "name": "_register_webhook",
                            "start_line": 82,
                            "end_line": 132
                        },
                        {
                            "type": "function_definition",
                            "start_token": 744,
                            "end_token": 928,
                            "label": "async def _deregister_webhook(\n        self, webhook: integrations.Webhook, credentials: Credentials\n    ) -> None:\n        webhook_type = self.WebhookType(webhook.webhook_type)\n        if webhook.credentials_id != credentials.id:\n            raise ValueError(\n                f\"Webhook #{webhook.id} does not belong to credentials {credentials.id}\"\n            )\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n\n        if webhook_type == self.WebhookType.REPO:\n            repo = webhook.resource\n            delete_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{webhook.provider_webhook_id}\"  # noqa\n        else:\n            raise NotImplementedError(\n                f\"Unsupported webhook type '{webhook.webhook_type}'\"\n            )\n\n        response = requests.delete(delete_url, headers=headers)\n\n        if response.status_code not in [204, 404]:\n            # 204 means successful deletion, 404 means the webhook was already deleted\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to delete GitHub webhook: {error_msg}\")\n\n        # If we reach here, the webhook was successfully deleted or didn't exist\n\n\n# --8<-- [end:GithubWebhooksManager]\n\n\ndef extract_github_error_msg(response: requests.Response) -> str:\n    error_msgs = []\n    resp = response.json()\n    if resp.get(\"message\"):\n        error_msgs.append(resp[\"message\"])\n    if resp.get(\"errors\"):\n        error_msgs.extend(f\"* {err.get('",
                            "children": [
                                {
                                    "type": "keyword",
                                    "start_token": 744,
                                    "end_token": 744,
                                    "label": "async",
                                    "children": []
                                },
                                {
                                    "type": "keyword",
                                    "start_token": 745,
                                    "end_token": 745,
                                    "label": "def",
                                    "children": []
                                },
                                {
                                    "type": "identifier",
                                    "start_token": 746,
                                    "end_token": 746,
                                    "label": "_deregister_webhook",
                                    "children": []
                                },
                                {
                                    "type": "parameters",
                                    "start_token": 747,
                                    "end_token": 761,
                                    "label": "(\n        self, webhook: integrations.Webhook, credentials: Credentials\n    )",
                                    "children": [
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 749,
                                            "end_token": 755,
                                            "label": "self, webhook: integrations.Webhook",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 749,
                                                    "end_token": 749,
                                                    "label": "self",
                                                    "children": []
                                                },
                                                {
                                                    "type": "type",
                                                    "start_token": 752,
                                                    "end_token": 755,
                                                    "label": ": integrations.Webhook",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 753,
                                                            "end_token": 755,
                                                            "label": "integrations.Webhook",
                                                            "children": []
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "typed_parameter",
                                            "start_token": 757,
                                            "end_token": 759,
                                            "label": "credentials: Credentials",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 757,
                                                    "end_token": 757,
                                                    "label": "credentials",
                                                    "children": []
                                                },
                                                {
                                                    "type": "type",
                                                    "start_token": 758,
                                                    "end_token": 759,
                                                    "label": ": Credentials",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 759,
                                                            "end_token": 759,
                                                            "label": "Credentials",
                                                            "children": []
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "type": "type",
                                    "start_token": 763,
                                    "end_token": 764,
                                    "label": "> None",
                                    "children": []
                                },
                                {
                                    "type": "block",
                                    "start_token": 765,
                                    "end_token": 928,
                                    "label": ":\n        webhook_type = self.WebhookType(webhook.webhook_type)\n        if webhook.credentials_id != credentials.id:\n            raise ValueError(\n                f\"Webhook #{webhook.id} does not belong to credentials {credentials.id}\"\n            )\n\n        headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }\n\n        if webhook_type == self.WebhookType.REPO:\n            repo = webhook.resource\n            delete_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{webhook.provider_webhook_id}\"  # noqa\n        else:\n            raise NotImplementedError(\n                f\"Unsupported webhook type '{webhook.webhook_type}'\"\n            )\n\n        response = requests.delete(delete_url, headers=headers)\n\n        if response.status_code not in [204, 404]:\n            # 204 means successful deletion, 404 means the webhook was already deleted\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to delete GitHub webhook: {error_msg}\")\n\n        # If we reach here, the webhook was successfully deleted or didn't exist\n\n\n# --8<-- [end:GithubWebhooksManager]\n\n\ndef extract_github_error_msg(response: requests.Response) -> str:\n    error_msgs = []\n    resp = response.json()\n    if resp.get(\"message\"):\n        error_msgs.append(resp[\"message\"])\n    if resp.get(\"errors\"):\n        error_msgs.extend(f\"* {err.get('",
                                    "children": [
                                        {
                                            "type": "assignment",
                                            "start_token": 767,
                                            "end_token": 776,
                                            "label": "webhook_type = self.WebhookType(webhook.webhook_type)",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 767,
                                                    "end_token": 767,
                                                    "label": "webhook_type",
                                                    "children": []
                                                },
                                                {
                                                    "type": "attribute",
                                                    "start_token": 769,
                                                    "end_token": 776,
                                                    "label": "self.WebhookType(webhook.webhook_type)",
                                                    "children": [
                                                        {
                                                            "type": "attribute",
                                                            "start_token": 769,
                                                            "end_token": 771,
                                                            "label": "self.WebhookType",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 769,
                                                                    "end_token": 769,
                                                                    "label": "self",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 771,
                                                                    "end_token": 771,
                                                                    "label": "WebhookType",
                                                                    "children": []
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "call",
                                                            "start_token": 772,
                                                            "end_token": 776,
                                                            "label": "(webhook.webhook_type)",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 772,
                                                                    "end_token": 776,
                                                                    "label": "(webhook.webhook_type)",
                                                                    "children": [
                                                                        {
                                                                            "type": "attribute",
                                                                            "start_token": 774,
                                                                            "end_token": 776,
                                                                            "label": ".webhook_type)",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 774,
                                                                                    "end_token": 774,
                                                                                    "label": ".",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 776,
                                                                                    "end_token": 776,
                                                                                    "label": ")",
                                                                                    "children": []
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "if_statement",
                                            "start_token": 778,
                                            "end_token": 797,
                                            "label": "if webhook.credentials_id != credentials.id:\n            raise ValueError(\n                f\"Webhook #{webhook.id} does not belong to credentials {credentials.id}\"\n            )\n",
                                            "children": [
                                                {
                                                    "type": "comparison_operator",
                                                    "start_token": 778,
                                                    "end_token": 787,
                                                    "label": "if webhook.credentials_id != credentials.id:",
                                                    "children": [
                                                        {
                                                            "type": "attribute",
                                                            "start_token": 779,
                                                            "end_token": 781,
                                                            "label": "webhook.credentials_id",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 779,
                                                                    "end_token": 779,
                                                                    "label": "webhook",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 781,
                                                                    "end_token": 781,
                                                                    "label": "credentials_id",
                                                                    "children": []
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 782,
                                                            "end_token": 784,
                                                            "label": "!= credentials",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "attribute",
                                                            "start_token": 785,
                                                            "end_token": 787,
                                                            "label": ".id:",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 785,
                                                                    "end_token": 785,
                                                                    "label": ".",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 787,
                                                                    "end_token": 787,
                                                                    "label": ":",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "raise_statement",
                                                    "start_token": 789,
                                                    "end_token": 796,
                                                    "label": "raise ValueError(\n                f\"Webhook #{webhook.id} does not belong to credentials {credentials.id}\"\n            )",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 790,
                                                            "end_token": 790,
                                                            "label": "ValueError",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "call",
                                                            "start_token": 791,
                                                            "end_token": 796,
                                                            "label": "(\n                f\"Webhook #{webhook.id} does not belong to credentials {credentials.id}\"\n            )",
                                                            "children": [
                                                                {
                                                                    "type": "concatenated_string",
                                                                    "start_token": 793,
                                                                    "end_token": 795,
                                                                    "label": "f\"Webhook #{webhook.id} does not belong to credentials {credentials.id}\"\n",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 799,
                                            "end_token": 819,
                                            "label": "headers = {\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 799,
                                                    "end_token": 799,
                                                    "label": "headers",
                                                    "children": []
                                                },
                                                {
                                                    "type": "dictionary",
                                                    "start_token": 801,
                                                    "end_token": 819,
                                                    "label": "{\n            **self.GITHUB_API_DEFAULT_HEADERS,\n            \"Authorization\": credentials.bearer(),\n        }",
                                                    "children": [
                                                        {
                                                            "type": "dictionary_splat",
                                                            "start_token": 803,
                                                            "end_token": 808,
                                                            "label": "**self.GITHUB_API_DEFAULT_HEADERS,",
                                                            "children": [
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 805,
                                                                    "end_token": 808,
                                                                    "label": "self.GITHUB_API_DEFAULT_HEADERS,",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 805,
                                                                            "end_token": 805,
                                                                            "label": "self",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 808,
                                                                            "end_token": 808,
                                                                            "label": ",",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "pair",
                                                            "start_token": 810,
                                                            "end_token": 817,
                                                            "label": "\"Authorization\": credentials.bearer(),",
                                                            "children": [
                                                                {
                                                                    "type": "string",
                                                                    "start_token": 810,
                                                                    "end_token": 810,
                                                                    "label": "\"Authorization\"",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "attribute",
                                                                    "start_token": 812,
                                                                    "end_token": 815,
                                                                    "label": "credentials.bearer(",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 812,
                                                                            "end_token": 812,
                                                                            "label": "credentials",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 815,
                                                                            "end_token": 815,
                                                                            "label": "(",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "if_statement",
                                            "start_token": 822,
                                            "end_token": 856,
                                            "label": "if webhook_type == self.WebhookType.REPO:\n            repo = webhook.resource\n            delete_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{webhook.provider_webhook_id}\"  # noqa\n        else:\n            raise NotImplementedError(\n                f\"Unsupported webhook type '{webhook.webhook_type}'\"\n            )",
                                            "children": [
                                                {
                                                    "type": "comparison_operator",
                                                    "start_token": 822,
                                                    "end_token": 831,
                                                    "label": "if webhook_type == self.WebhookType.REPO:",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 823,
                                                            "end_token": 823,
                                                            "label": "webhook_type",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 825,
                                                            "end_token": 826,
                                                            "label": "= self",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "attribute",
                                                            "start_token": 827,
                                                            "end_token": 830,
                                                            "label": ".WebhookType.REPO",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 827,
                                                                    "end_token": 827,
                                                                    "label": ".",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 830,
                                                                    "end_token": 830,
                                                                    "label": "REPO",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "assignment",
                                                    "start_token": 833,
                                                    "end_token": 837,
                                                    "label": "repo = webhook.resource",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 833,
                                                            "end_token": 833,
                                                            "label": "repo",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "attribute",
                                                            "start_token": 835,
                                                            "end_token": 837,
                                                            "label": "webhook.resource",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 835,
                                                                    "end_token": 835,
                                                                    "label": "webhook",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 837,
                                                                    "end_token": 837,
                                                                    "label": "resource",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "assignment",
                                                    "start_token": 839,
                                                    "end_token": 844,
                                                    "label": "delete_url = f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{webhook.provider_webhook_id}\"  # noqa",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 839,
                                                            "end_token": 839,
                                                            "label": "delete_url",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "concatenated_string",
                                                            "start_token": 841,
                                                            "end_token": 842,
                                                            "label": "f\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{webhook.provider_webhook_id}\"",
                                                            "children": [
                                                                {
                                                                    "type": "interpolation",
                                                                    "start_token": 842,
                                                                    "end_token": 842,
                                                                    "label": "\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{webhook.provider_webhook_id}\"",
                                                                    "children": [
                                                                        {
                                                                            "type": "attribute",
                                                                            "start_token": 842,
                                                                            "end_token": 842,
                                                                            "label": "\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{webhook.provider_webhook_id}\"",
                                                                            "children": [
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 842,
                                                                                    "end_token": 842,
                                                                                    "label": "\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{webhook.provider_webhook_id}\"",
                                                                                    "children": []
                                                                                },
                                                                                {
                                                                                    "type": "identifier",
                                                                                    "start_token": 842,
                                                                                    "end_token": 842,
                                                                                    "label": "\"{self.GITHUB_API_URL}/repos/{repo}/hooks/{webhook.provider_webhook_id}\"",
                                                                                    "children": []
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "else_clause",
                                            "start_token": 846,
                                            "end_token": 856,
                                            "label": "else:\n            raise NotImplementedError(\n                f\"Unsupported webhook type '{webhook.webhook_type}'\"\n            )",
                                            "children": [
                                                {
                                                    "type": "raise_statement",
                                                    "start_token": 849,
                                                    "end_token": 856,
                                                    "label": "raise NotImplementedError(\n                f\"Unsupported webhook type '{webhook.webhook_type}'\"\n            )",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 850,
                                                            "end_token": 850,
                                                            "label": "NotImplementedError",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "call",
                                                            "start_token": 851,
                                                            "end_token": 856,
                                                            "label": "(\n                f\"Unsupported webhook type '{webhook.webhook_type}'\"\n            )",
                                                            "children": [
                                                                {
                                                                    "type": "concatenated_string",
                                                                    "start_token": 853,
                                                                    "end_token": 854,
                                                                    "label": "f\"Unsupported webhook type '{webhook.webhook_type}'\"",
                                                                    "children": [
                                                                        {
                                                                            "type": "interpolation",
                                                                            "start_token": 854,
                                                                            "end_token": 854,
                                                                            "label": "\"Unsupported webhook type '{webhook.webhook_type}'\"",
                                                                            "children": [
                                                                                {
                                                                                    "type": "attribute",
                                                                                    "start_token": 854,
                                                                                    "end_token": 854,
                                                                                    "label": "\"Unsupported webhook type '{webhook.webhook_type}'\"",
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "identifier",
                                                                                            "start_token": 854,
                                                                                            "end_token": 854,
                                                                                            "label": "\"Unsupported webhook type '{webhook.webhook_type}'\"",
                                                                                            "children": []
                                                                                        },
                                                                                        {
                                                                                            "type": "identifier",
                                                                                            "start_token": 854,
                                                                                            "end_token": 854,
                                                                                            "label": "\"Unsupported webhook type '{webhook.webhook_type}'\"",
                                                                                            "children": []
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "assignment",
                                            "start_token": 859,
                                            "end_token": 870,
                                            "label": "response = requests.delete(delete_url, headers=headers)",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 859,
                                                    "end_token": 859,
                                                    "label": "response",
                                                    "children": []
                                                },
                                                {
                                                    "type": "call",
                                                    "start_token": 861,
                                                    "end_token": 870,
                                                    "label": "requests.delete(delete_url, headers=headers)",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 862,
                                                            "end_token": 863,
                                                            "label": ".delete",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "argument_list",
                                                            "start_token": 864,
                                                            "end_token": 870,
                                                            "label": "(delete_url, headers=headers)",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 865,
                                                                    "end_token": 865,
                                                                    "label": "delete_url",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "keyword_argument",
                                                                    "start_token": 867,
                                                                    "end_token": 869,
                                                                    "label": "headers=headers",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 868,
                                                                            "end_token": 869,
                                                                            "label": "=headers",
                                                                            "children": []
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "if_statement",
                                            "start_token": 873,
                                            "end_token": 912,
                                            "label": "if response.status_code not in [204, 404]:\n            # 204 means successful deletion, 404 means the webhook was already deleted\n            error_msg = extract_github_error_msg(response)\n            raise ValueError(f\"Failed to delete GitHub webhook: {error_msg}\")",
                                            "children": [
                                                {
                                                    "type": "boolean_operator",
                                                    "start_token": 874,
                                                    "end_token": 883,
                                                    "label": "response.status_code not in [204, 404]",
                                                    "children": [
                                                        {
                                                            "type": "attribute",
                                                            "start_token": 874,
                                                            "end_token": 876,
                                                            "label": "response.status_code",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 874,
                                                                    "end_token": 874,
                                                                    "label": "response",
                                                                    "children": []
                                                                },
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 876,
                                                                    "end_token": 876,
                                                                    "label": "status_code",
                                                                    "children": []
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "comparison_operator",
                                                            "start_token": 875,
                                                            "end_token": 878,
                                                            "label": ".status_code not in",
                                                            "children": [
                                                                {
                                                                    "type": "integer",
                                                                    "start_token": 878,
                                                                    "end_token": 878,
                                                                    "label": "in",
                                                                    "children": []
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "integer",
                                                            "start_token": 880,
                                                            "end_token": 881,
                                                            "label": "204,",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "integer",
                                                            "start_token": 882,
                                                            "end_token": 883,
                                                            "label": "404]",
                                                            "children": []
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "block",
                                                    "start_token": 886,
                                                    "end_token": 899,
                                                    "label": "# 204 means successful deletion, 404 means the webhook was already deleted\n",
                                                    "children": [
                                                        {
                                                            "type": "comment",
                                                            "start_token": 886,
                                                            "end_token": 899,
                                                            "label": "# 204 means successful deletion, 404 means the webhook was already deleted\n",
                                                            "children": [
                                                                {
                                                                    "type": "string_content",
                                                                    "start_token": 886,
                                                                    "end_token": 899,
                                                                    "label": "# 204 means successful deletion, 404 means the webhook was already deleted\n",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "assignment",
                                                    "start_token": 900,
                                                    "end_token": 905,
                                                    "label": "error_msg = extract_github_error_msg(response)",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 900,
                                                            "end_token": 900,
                                                            "label": "error_msg",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "call",
                                                            "start_token": 902,
                                                            "end_token": 905,
                                                            "label": "extract_github_error_msg(response)",
                                                            "children": [
                                                                {
                                                                    "type": "identifier",
                                                                    "start_token": 903,
                                                                    "end_token": 904,
                                                                    "label": "(response",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "type": "raise_statement",
                                                    "start_token": 907,
                                                    "end_token": 912,
                                                    "label": "raise ValueError(f\"Failed to delete GitHub webhook: {error_msg}\")",
                                                    "children": [
                                                        {
                                                            "type": "identifier",
                                                            "start_token": 908,
                                                            "end_token": 908,
                                                            "label": "ValueError",
                                                            "children": []
                                                        },
                                                        {
                                                            "type": "call",
                                                            "start_token": 909,
                                                            "end_token": 912,
                                                            "label": "(f\"Failed to delete GitHub webhook: {error_msg}\")",
                                                            "children": [
                                                                {
                                                                    "type": "concatenated_string",
                                                                    "start_token": 910,
                                                                    "end_token": 911,
                                                                    "label": "f\"Failed to delete GitHub webhook: {error_msg}\"",
                                                                    "children": []
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "comment",
                                            "start_token": 915,
                                            "end_token": 928,
                                            "label": "# If we reach here, the webhook was successfully deleted or didn't exist\n\n\n# --8<-- [end:GithubWebhooksManager]\n\n\ndef extract_github_error_msg(response: requests.Response) -> str:\n    error_msgs = []\n    resp = response.json()\n    if resp.get(\"message\"):\n        error_msgs.append(resp[\"message\"])\n    if resp.get(\"errors\"):\n        error_msgs.extend(f\"* {err.get('",
                                            "children": [
                                                {
                                                    "type": "string_content",
                                                    "start_token": 915,
                                                    "end_token": 928,
                                                    "label": "# If we reach here, the webhook was successfully deleted or didn't exist\n\n\n# --8<-- [end:GithubWebhooksManager]\n\n\ndef extract_github_error_msg(response: requests.Response) -> str:\n    error_msgs = []\n    resp = response.json()\n    if resp.get(\"message\"):\n        error_msgs.append(resp[\"message\"])\n    if resp.get(\"errors\"):\n        error_msgs.extend(f\"* {err.get('",
                                                    "children": []
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ],
                            "name": "_deregister_webhook",
                            "start_line": 134,
                            "end_line": 164
                        }
                    ]
                }
            ]
        },
        {
            "type": "function_placeholder",
            "name": "extract_github_error_msg",
            "start_line": 169,
            "end_line": 181,
            "start_token": 929,
            "end_token": 957,
            "label": "message', err)}\" for err in resp[\"errors\"])\n    if resp.get(\"error\"):\n        if isinstance(resp[\"error\"], dict):\n            error_msgs.append(resp[\"error\"].get(\"message\", resp[\"error\"]))\n        else:\n            error_msgs.append(resp[\"error\"])\n    return \"\\n\".join(error_msgs)\n",
            "children": [
                {
                    "type": "module",
                    "start_token": 929,
                    "end_token": 957,
                    "label": "message', err)}\" for err in resp[\"errors\"])\n    if resp.get(\"error\"):\n        if isinstance(resp[\"error\"], dict):\n            error_msgs.append(resp[\"error\"].get(\"message\", resp[\"error\"]))\n        else:\n            error_msgs.append(resp[\"error\"])\n    return \"\\n\".join(error_msgs)\n",
                    "children": [
                        {
                            "type": "if_statement",
                            "start_token": 937,
                            "end_token": 948,
                            "label": "\"])\n    if resp.get(\"error\"):\n        if isinstance(resp[\"error\"], dict):\n            error_msgs.append(resp[\"error\"].get(\"message\", resp[\"error\"]))\n        else:\n            error_msgs.append(resp[\"error",
                            "children": [
                                {
                                    "type": "if_clause",
                                    "start_token": 937,
                                    "end_token": 948,
                                    "label": "\"])\n    if resp.get(\"error\"):\n        if isinstance(resp[\"error\"], dict):\n            error_msgs.append(resp[\"error\"].get(\"message\", resp[\"error\"]))\n        else:\n            error_msgs.append(resp[\"error",
                                    "children": [
                                        {
                                            "type": "call",
                                            "start_token": 937,
                                            "end_token": 939,
                                            "label": "\"])\n    if resp.get(\"error\"):\n        if isinstance(resp[\"",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 937,
                                                    "end_token": 937,
                                                    "label": "\"])\n    if resp.get(\"",
                                                    "children": []
                                                },
                                                {
                                                    "type": "argument_list",
                                                    "start_token": 937,
                                                    "end_token": 939,
                                                    "label": "\"])\n    if resp.get(\"error\"):\n        if isinstance(resp[\"",
                                                    "children": [
                                                        {
                                                            "type": "string",
                                                            "start_token": 938,
                                                            "end_token": 938,
                                                            "label": "error",
                                                            "children": []
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "type": "block",
                                            "start_token": 939,
                                            "end_token": 948,
                                            "label": "\"):\n        if isinstance(resp[\"error\"], dict):\n            error_msgs.append(resp[\"error\"].get(\"message\", resp[\"error\"]))\n        else:\n            error_msgs.append(resp[\"error",
                                            "children": [
                                                {
                                                    "type": "if_statement",
                                                    "start_token": 939,
                                                    "end_token": 947,
                                                    "label": "\"):\n        if isinstance(resp[\"error\"], dict):\n            error_msgs.append(resp[\"error\"].get(\"message\", resp[\"error\"]))\n        else:\n            error_msgs.append(resp[\"",
                                                    "children": [
                                                        {
                                                            "type": "if_clause",
                                                            "start_token": 939,
                                                            "end_token": 941,
                                                            "label": "\"):\n        if isinstance(resp[\"error\"], dict):\n            error_msgs.append(resp[\"",
                                                            "children": [
                                                                {
                                                                    "type": "call",
                                                                    "start_token": 939,
                                                                    "end_token": 941,
                                                                    "label": "\"):\n        if isinstance(resp[\"error\"], dict):\n            error_msgs.append(resp[\"",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 939,
                                                                            "end_token": 939,
                                                                            "label": "\"):\n        if isinstance(resp[\"",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "argument_list",
                                                                            "start_token": 939,
                                                                            "end_token": 941,
                                                                            "label": "\"):\n        if isinstance(resp[\"error\"], dict):\n            error_msgs.append(resp[\"",
                                                                            "children": [
                                                                                {
                                                                                    "type": "subscript",
                                                                                    "start_token": 940,
                                                                                    "end_token": 940,
                                                                                    "label": "error",
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "identifier",
                                                                                            "start_token": 940,
                                                                                            "end_token": 940,
                                                                                            "label": "error",
                                                                                            "children": []
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "type": "block",
                                                            "start_token": 941,
                                                            "end_token": 947,
                                                            "label": "\"], dict):\n            error_msgs.append(resp[\"error\"].get(\"message\", resp[\"error\"]))\n        else:\n            error_msgs.append(resp[\"",
                                                            "children": [
                                                                {
                                                                    "type": "call",
                                                                    "start_token": 941,
                                                                    "end_token": 945,
                                                                    "label": "\"], dict):\n            error_msgs.append(resp[\"error\"].get(\"message\", resp[\"",
                                                                    "children": [
                                                                        {
                                                                            "type": "identifier",
                                                                            "start_token": 941,
                                                                            "end_token": 941,
                                                                            "label": "\"], dict):\n            error_msgs.append(resp[\"",
                                                                            "children": []
                                                                        },
                                                                        {
                                                                            "type": "argument_list",
                                                                            "start_token": 941,
                                                                            "end_token": 945,
                                                                            "label": "\"], dict):\n            error_msgs.append(resp[\"error\"].get(\"message\", resp[\"",
                                                                            "children": [
                                                                                {
                                                                                    "type": "call",
                                                                                    "start_token": 942,
                                                                                    "end_token": 944,
                                                                                    "label": "error\"].get(\"message",
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "subscript",
                                                                                            "start_token": 942,
                                                                                            "end_token": 942,
                                                                                            "label": "error",
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "identifier",
                                                                                                    "start_token": 942,
                                                                                                    "end_token": 942,
                                                                                                    "label": "error",
                                                                                                    "children": []
                                                                                                }
                                                                                            ]
                                                                                        },
                                                                                        {
                                                                                            "type": "argument_list",
                                                                                            "start_token": 942,
                                                                                            "end_token": 944,
                                                                                            "label": "error\"].get(\"message",
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "string",
                                                                                                    "start_token": 943,
                                                                                                    "end_token": 943,
                                                                                                    "label": "\"].get(\"",
                                                                                                    "children": []
                                                                                                },
                                                                                                {
                                                                                                    "type": "subscript",
                                                                                                    "start_token": 943,
                                                                                                    "end_token": 943,
                                                                                                    "label": "\"].get(\"",
                                                                                                    "children": [
                                                                                                        {
                                                                                                            "type": "identifier",
                                                                                                            "start_token": 943,
                                                                                                            "end_token": 943,
                                                                                                            "label": "\"].get(\"",
                                                                                                            "children": []
                                                                                                        }
                                                                                                    ]
                                                                                                }
                                                                                            ]
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "type": "return_statement",
                            "start_token": 949,
                            "end_token": 956,
                            "label": "\"])\n    return \"\\n\".join(error_msgs)",
                            "children": [
                                {
                                    "type": "call",
                                    "start_token": 952,
                                    "end_token": 956,
                                    "label": ".join(error_msgs)",
                                    "children": [
                                        {
                                            "type": "attribute",
                                            "start_token": 952,
                                            "end_token": 953,
                                            "label": ".join",
                                            "children": [
                                                {
                                                    "type": "string",
                                                    "start_token": 951,
                                                    "end_token": 951,
                                                    "label": "\"",
                                                    "children": []
                                                },
                                                {
                                                    "type": "identifier",
                                                    "start_token": 953,
                                                    "end_token": 953,
                                                    "label": "join",
                                                    "children": []
                                                }
                                            ]
                                        },
                                        {
                                            "type": "argument_list",
                                            "start_token": 953,
                                            "end_token": 955,
                                            "label": "join(error_msgs",
                                            "children": [
                                                {
                                                    "type": "identifier",
                                                    "start_token": 955,
                                                    "end_token": 955,
                                                    "label": "error_msgs",
                                                    "children": []
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}