[
  {
    "decl_name": "GlobalBlock",
    "start_line": 0,
    "end_line": 4,
    "children": [],
    "code": "import pytest\n\nfrom backend.util.request import validate_url\n\n\n",
    "cfg": {
      "nodes": [
        {
          "id": "GlobalBlock_1",
          "code": "import pytest\n"
        },
        {
          "id": "GlobalBlock_2",
          "code": "from backend.util.request import validate_url\n"
        }
      ],
      "edges": [
        {
          "from": "GlobalBlock_1",
          "to": "GlobalBlock_2"
        }
      ]
    }
  },
  {
    "decl_name": "test_validate_url",
    "start_line": 5,
    "end_line": 78,
    "children": [],
    "code": "def test_validate_url():\n    # Rejected IP ranges\n    with pytest.raises(ValueError):\n        validate_url(\"localhost\", [])\n\n    with pytest.raises(ValueError):\n        validate_url(\"192.168.1.1\", [])\n\n    with pytest.raises(ValueError):\n        validate_url(\"127.0.0.1\", [])\n\n    with pytest.raises(ValueError):\n        validate_url(\"0.0.0.0\", [])\n\n    # Normal URLs\n    assert validate_url(\"google.com/a?b=c\", []) == \"http://google.com/a?b=c\"\n    assert validate_url(\"github.com?key=!@!@\", []) == \"http://github.com?key=!@!@\"\n\n    # Scheme Enforcement\n    with pytest.raises(ValueError):\n        validate_url(\"ftp://example.com\", [])\n    with pytest.raises(ValueError):\n        validate_url(\"file://example.com\", [])\n\n    # International domain that converts to punycode - should be allowed if public\n    assert validate_url(\"http://xn--exmple-cua.com\", []) == \"http://xn--exmple-cua.com\"\n    # If the domain fails IDNA encoding or is invalid, it should raise an error\n    with pytest.raises(ValueError):\n        validate_url(\"http://exa◌mple.com\", [])\n\n    # IPv6 Addresses\n    with pytest.raises(ValueError):\n        validate_url(\"::1\", [])  # IPv6 loopback should be blocked\n    with pytest.raises(ValueError):\n        validate_url(\"http://[::1]\", [])  # IPv6 loopback in URL form\n\n    # Suspicious Characters in Hostname\n    with pytest.raises(ValueError):\n        validate_url(\"http://example_underscore.com\", [])\n    with pytest.raises(ValueError):\n        validate_url(\"http://exa mple.com\", [])  # Space in hostname\n\n    # Malformed URLs\n    with pytest.raises(ValueError):\n        validate_url(\"http://\", [])  # No hostname\n    with pytest.raises(ValueError):\n        validate_url(\"://missing-scheme\", [])  # Missing proper scheme\n\n    # Trusted Origins\n    trusted = [\"internal-api.company.com\", \"10.0.0.5\"]\n    assert (\n        validate_url(\"internal-api.company.com\", trusted)\n        == \"http://internal-api.company.com\"\n    )\n    assert validate_url(\"10.0.0.5\", [\"10.0.0.5\"]) == \"http://10.0.0.5\"\n\n    # Special Characters in Path or Query\n    assert (\n        validate_url(\"example.com/path%20with%20spaces\", [])\n        == \"http://example.com/path%20with%20spaces\"\n    )\n\n    # Backslashes should be replaced with forward slashes\n    assert (\n        validate_url(\"http://example.com\\\\backslash\", [])\n        == \"http://example.com/backslash\"\n    )\n\n    # Check defaulting scheme behavior for valid domains\n    assert validate_url(\"example.com\", []) == \"http://example.com\"\n    assert validate_url(\"https://secure.com\", []) == \"https://secure.com\"\n\n    # Non-ASCII Characters in Query/Fragment\n    assert validate_url(\"example.com?param=äöü\", []) == \"http://example.com?param=äöü\"\n",
    "cfg": {
      "nodes": [
        {
          "id": "test_validate_url_1",
          "code": "def test_validate_url():\n"
        },
        {
          "id": "test_validate_url_2",
          "code": "    # Rejected IP ranges\n"
        },
        {
          "id": "test_validate_url_3",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"localhost\", [])\n"
        },
        {
          "id": "test_validate_url_4",
          "code": "\n"
        },
        {
          "id": "test_validate_url_5",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"192.168.1.1\", [])\n"
        },
        {
          "id": "test_validate_url_6",
          "code": "\n"
        },
        {
          "id": "test_validate_url_7",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"127.0.0.1\", [])\n"
        },
        {
          "id": "test_validate_url_8",
          "code": "\n"
        },
        {
          "id": "test_validate_url_9",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"0.0.0.0\", [])\n"
        },
        {
          "id": "test_validate_url_10",
          "code": "\n"
        },
        {
          "id": "test_validate_url_11",
          "code": "    # Normal URLs\n"
        },
        {
          "id": "test_validate_url_12",
          "code": "    assert validate_url(\"google.com/a?b=c\", []) == \"http://google.com/a?b=c\"\n    assert validate_url(\"github.com?key=!@!@\", []) == \"http://github.com?key=!@!@\"\n"
        },
        {
          "id": "test_validate_url_13",
          "code": "\n"
        },
        {
          "id": "test_validate_url_14",
          "code": "    # Scheme Enforcement\n"
        },
        {
          "id": "test_validate_url_15",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"ftp://example.com\", [])\n"
        },
        {
          "id": "test_validate_url_16",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"file://example.com\", [])\n"
        },
        {
          "id": "test_validate_url_17",
          "code": "\n"
        },
        {
          "id": "test_validate_url_18",
          "code": "    # International domain that converts to punycode - should be allowed if public\n"
        },
        {
          "id": "test_validate_url_19",
          "code": "    assert validate_url(\"http://xn--exmple-cua.com\", []) == \"http://xn--exmple-cua.com\"\n"
        },
        {
          "id": "test_validate_url_20",
          "code": "    # If the domain fails IDNA encoding or is invalid, it should raise an error\n"
        },
        {
          "id": "test_validate_url_21",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"http://exa◌mple.com\", [])\n"
        },
        {
          "id": "test_validate_url_22",
          "code": "\n"
        },
        {
          "id": "test_validate_url_23",
          "code": "    # IPv6 Addresses\n"
        },
        {
          "id": "test_validate_url_24",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"::1\", [])  # IPv6 loopback should be blocked\n"
        },
        {
          "id": "test_validate_url_25",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"http://[::1]\", [])  # IPv6 loopback in URL form\n"
        },
        {
          "id": "test_validate_url_26",
          "code": "\n"
        },
        {
          "id": "test_validate_url_27",
          "code": "    # Suspicious Characters in Hostname\n"
        },
        {
          "id": "test_validate_url_28",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"http://example_underscore.com\", [])\n"
        },
        {
          "id": "test_validate_url_29",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"http://exa mple.com\", [])  # Space in hostname\n"
        },
        {
          "id": "test_validate_url_30",
          "code": "\n"
        },
        {
          "id": "test_validate_url_31",
          "code": "    # Malformed URLs\n"
        },
        {
          "id": "test_validate_url_32",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"http://\", [])  # No hostname\n"
        },
        {
          "id": "test_validate_url_33",
          "code": "    with pytest.raises(ValueError):\n        validate_url(\"://missing-scheme\", [])  # Missing proper scheme\n"
        },
        {
          "id": "test_validate_url_34",
          "code": "\n"
        },
        {
          "id": "test_validate_url_35",
          "code": "    # Trusted Origins\n"
        },
        {
          "id": "test_validate_url_36",
          "code": "    trusted = [\"internal-api.company.com\", \"10.0.0.5\"]\n"
        },
        {
          "id": "test_validate_url_37",
          "code": "    assert (\n        validate_url(\"internal-api.company.com\", trusted)\n        == \"http://internal-api.company.com\"\n    )\n"
        },
        {
          "id": "test_validate_url_38",
          "code": "    assert validate_url(\"10.0.0.5\", [\"10.0.0.5\"]) == \"http://10.0.0.5\"\n"
        },
        {
          "id": "test_validate_url_39",
          "code": "\n"
        },
        {
          "id": "test_validate_url_40",
          "code": "    # Special Characters in Path or Query\n"
        },
        {
          "id": "test_validate_url_41",
          "code": "    assert (\n        validate_url(\"example.com/path%20with%20spaces\", [])\n        == \"http://example.com/path%20with%20spaces\"\n    )\n"
        },
        {
          "id": "test_validate_url_42",
          "code": "\n"
        },
        {
          "id": "test_validate_url_43",
          "code": "    # Backslashes should be replaced with forward slashes\n"
        },
        {
          "id": "test_validate_url_44",
          "code": "    assert (\n        validate_url(\"http://example.com\\\\backslash\", [])\n        == \"http://example.com/backslash\"\n    )\n"
        },
        {
          "id": "test_validate_url_45",
          "code": "\n"
        },
        {
          "id": "test_validate_url_46",
          "code": "    # Check defaulting scheme behavior for valid domains\n"
        },
        {
          "id": "test_validate_url_47",
          "code": "    assert validate_url(\"example.com\", []) == \"http://example.com\"\n    assert validate_url(\"https://secure.com\", []) == \"https://secure.com\"\n"
        },
        {
          "id": "test_validate_url_48",
          "code": "\n"
        },
        {
          "id": "test_validate_url_49",
          "code": "    # Non-ASCII Characters in Query/Fragment\n"
        },
        {
          "id": "test_validate_url_50",
          "code": "    assert validate_url(\"example.com?param=äöü\", []) == \"http://example.com?param=äöü\"\n"
        }
      ],
      "edges": [
        {
          "from": "test_validate_url_1",
          "to": "test_validate_url_2"
        },
        {
          "from": "test_validate_url_2",
          "to": "test_validate_url_3"
        },
        {
          "from": "test_validate_url_3",
          "to": "test_validate_url_4"
        },
        {
          "from": "test_validate_url_4",
          "to": "test_validate_url_5"
        },
        {
          "from": "test_validate_url_5",
          "to": "test_validate_url_6"
        },
        {
          "from": "test_validate_url_6",
          "to": "test_validate_url_7"
        },
        {
          "from": "test_validate_url_7",
          "to": "test_validate_url_8"
        },
        {
          "from": "test_validate_url_8",
          "to": "test_validate_url_9"
        },
        {
          "from": "test_validate_url_9",
          "to": "test_validate_url_10"
        },
        {
          "from": "test_validate_url_10",
          "to": "test_validate_url_11"
        },
        {
          "from": "test_validate_url_11",
          "to": "test_validate_url_12"
        },
        {
          "from": "test_validate_url_12",
          "to": "test_validate_url_13"
        },
        {
          "from": "test_validate_url_13",
          "to": "test_validate_url_14"
        },
        {
          "from": "test_validate_url_14",
          "to": "test_validate_url_15"
        },
        {
          "from": "test_validate_url_15",
          "to": "test_validate_url_16"
        },
        {
          "from": "test_validate_url_16",
          "to": "test_validate_url_17"
        },
        {
          "from": "test_validate_url_17",
          "to": "test_validate_url_18"
        },
        {
          "from": "test_validate_url_18",
          "to": "test_validate_url_19"
        },
        {
          "from": "test_validate_url_19",
          "to": "test_validate_url_20"
        },
        {
          "from": "test_validate_url_20",
          "to": "test_validate_url_21"
        },
        {
          "from": "test_validate_url_21",
          "to": "test_validate_url_22"
        },
        {
          "from": "test_validate_url_22",
          "to": "test_validate_url_23"
        },
        {
          "from": "test_validate_url_23",
          "to": "test_validate_url_24"
        },
        {
          "from": "test_validate_url_24",
          "to": "test_validate_url_25"
        },
        {
          "from": "test_validate_url_25",
          "to": "test_validate_url_26"
        },
        {
          "from": "test_validate_url_26",
          "to": "test_validate_url_27"
        },
        {
          "from": "test_validate_url_27",
          "to": "test_validate_url_28"
        },
        {
          "from": "test_validate_url_28",
          "to": "test_validate_url_29"
        },
        {
          "from": "test_validate_url_29",
          "to": "test_validate_url_30"
        },
        {
          "from": "test_validate_url_30",
          "to": "test_validate_url_31"
        },
        {
          "from": "test_validate_url_31",
          "to": "test_validate_url_32"
        },
        {
          "from": "test_validate_url_32",
          "to": "test_validate_url_33"
        },
        {
          "from": "test_validate_url_33",
          "to": "test_validate_url_34"
        },
        {
          "from": "test_validate_url_34",
          "to": "test_validate_url_35"
        },
        {
          "from": "test_validate_url_35",
          "to": "test_validate_url_36"
        },
        {
          "from": "test_validate_url_36",
          "to": "test_validate_url_37"
        },
        {
          "from": "test_validate_url_37",
          "to": "test_validate_url_38"
        },
        {
          "from": "test_validate_url_38",
          "to": "test_validate_url_39"
        },
        {
          "from": "test_validate_url_39",
          "to": "test_validate_url_40"
        },
        {
          "from": "test_validate_url_40",
          "to": "test_validate_url_41"
        },
        {
          "from": "test_validate_url_41",
          "to": "test_validate_url_42"
        },
        {
          "from": "test_validate_url_42",
          "to": "test_validate_url_43"
        },
        {
          "from": "test_validate_url_43",
          "to": "test_validate_url_44"
        },
        {
          "from": "test_validate_url_44",
          "to": "test_validate_url_45"
        },
        {
          "from": "test_validate_url_45",
          "to": "test_validate_url_46"
        },
        {
          "from": "test_validate_url_46",
          "to": "test_validate_url_47"
        },
        {
          "from": "test_validate_url_47",
          "to": "test_validate_url_48"
        },
        {
          "from": "test_validate_url_48",
          "to": "test_validate_url_49"
        },
        {
          "from": "test_validate_url_49",
          "to": "test_validate_url_50"
        }
      ]
    }
  }
]