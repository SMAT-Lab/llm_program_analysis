{
  "name": "157.py",
  "type": "CFG",
  "blocks": [
    {
      "id": 1,
      "label": "#1\nimport logging\nimport os\nfrom dotenv import load_dotenv\nfrom redis import Redis\nfrom redis.asyncio import Redis as AsyncRedis\nfrom backend.util.retry import conn_retry\nload_dotenv()\nHOST = os.getenv('REDIS_HOST', 'localhost')\nPORT = int(os.getenv('REDIS_PORT', '6379'))\nPASSWORD = os.getenv('REDIS_PASSWORD', 'password')\nlogger = logging.getLogger(__name__)\nconnection: Redis | None = None\nconnection_async: AsyncRedis | None = None",
      "successors": []
    }
  ],
  "functions": [
    {
      "name": "connect",
      "type": "CFG",
      "blocks": [
        {
          "id": 3,
          "label": "#3\nglobal connection\nif connection:",
          "successors": [
            {
              "id": 4,
              "label": "#4\nreturn connection",
              "successors": []
            },
            {
              "id": 5,
              "label": "#5\nc = Redis(host=HOST, port=PORT, password=PASSWORD, decode_responses=True)\nc.ping()\nconnection = c\nreturn connection",
              "successors": []
            }
          ]
        }
      ],
      "functions": [],
      "classes": []
    },
    {
      "name": "disconnect",
      "type": "CFG",
      "blocks": [
        {
          "id": 10,
          "label": "#10\nglobal connection\nif connection:",
          "successors": [
            {
              "id": 11,
              "label": "#11\nconnection.close()",
              "successors": [
                {
                  "id": 12,
                  "label": "#12\nconnection = None",
                  "successors": []
                }
              ]
            }
          ]
        }
      ],
      "functions": [],
      "classes": []
    },
    {
      "name": "get_redis",
      "type": "CFG",
      "blocks": [
        {
          "id": 15,
          "label": "#15\nif connection:",
          "successors": [
            {
              "id": 16,
              "label": "#16\nreturn connection",
              "successors": []
            },
            {
              "id": 17,
              "label": "#17\nif auto_connect:",
              "successors": [
                {
                  "id": 19,
                  "label": "#19\nreturn connect()",
                  "successors": []
                },
                {
                  "id": 20,
                  "label": "#20\nraise RuntimeError('Redis connection is not established')",
                  "successors": []
                }
              ]
            }
          ]
        }
      ],
      "functions": [],
      "classes": []
    },
    {
      "name": "connect_async",
      "type": "CFG",
      "blocks": [
        {
          "id": 25,
          "label": "#25\nglobal connection_async\nif connection_async:",
          "successors": [
            {
              "id": 26,
              "label": "#26\nreturn connection_async",
              "successors": []
            },
            {
              "id": 27,
              "label": "#27\nc = AsyncRedis(host=HOST, port=PORT, password=PASSWORD, decode_responses=True)\nawait c.ping()",
              "successors": [
                {
                  "id": 29,
                  "label": "#29\nconnection_async = c\nreturn connection_async",
                  "successors": []
                }
              ]
            }
          ]
        }
      ],
      "functions": [],
      "classes": []
    },
    {
      "name": "disconnect_async",
      "type": "CFG",
      "blocks": [
        {
          "id": 33,
          "label": "#33\nglobal connection_async\nif connection_async:",
          "successors": [
            {
              "id": 34,
              "label": "#34\nawait connection_async.close()",
              "successors": [
                {
                  "id": 35,
                  "label": "#35\nconnection_async = None",
                  "successors": []
                }
              ]
            }
          ]
        }
      ],
      "functions": [],
      "classes": []
    },
    {
      "name": "get_redis_async",
      "type": "CFG",
      "blocks": [
        {
          "id": 39,
          "label": "#39\nif connection_async:",
          "successors": [
            {
              "id": 40,
              "label": "#40\nreturn connection_async",
              "successors": []
            },
            {
              "id": 41,
              "label": "#41\nif auto_connect:",
              "successors": [
                {
                  "id": 43,
                  "label": "#43\nreturn await connect_async()",
                  "successors": []
                },
                {
                  "id": 44,
                  "label": "#44\nraise RuntimeError('AsyncRedis connection is not established')",
                  "successors": []
                }
              ]
            }
          ]
        }
      ],
      "functions": [],
      "classes": []
    }
  ],
  "classes": []
}