{
  "name": "147.cj",
  "type": "File",
  "blocks": [],
  "functions": [],
  "classes": [
    {
      "name": "_DEFAULT_CANG_CLASS",
      "type": "Class",
      "blocks": [],
      "functions": [],
      "classes": []
    },
    {
      "name": "Maker",
      "type": "Class",
      "blocks": [],
      "functions": [
        {
          "name": "constructor",
          "type": "Function",
          "blocks": [
            {
              "id": 133924152953920,
              "label": "",
              "successors": [
                {
                  "id": 133924139320992,
                  "label": "this.srcHandle = try {\n            let f = File(srcFile, OpenOption.Open(true, false))\n            if (!f.canRead()) {\n                throw Exception(\"file can not read\")\n            }\n            f\n        } catch (e: Exception) {\n            throw Exception(\"open source file `${srcFile}`: ${e.toString()}\")\n        }",
                  "successors": [
                    {
                      "id": 133924139321040,
                      "label": "this.dstHandle = try {\n            let f = File(dstFile, OpenOption.CreateOrTruncate(true))\n            if (!f.canWrite()) {\n                throw Exception(\"file can not write\")\n            }\n            f\n        } catch (e: Exception) {\n            throw Exception(\"open target file `${dstFile}`: ${e.toString()}\")\n        }",
                      "successors": [
                        {
                          "id": 133924139321088,
                          "label": "this.indexPolicy = indexPolicy",
                          "successors": [
                            {
                              "id": 133924139321136,
                              "label": "this.header = Header(UInt16(VersionNo), this.indexPolicy, UInt32(DateTime.now().toUnixTimeStamp().toSeconds()),\n            0, 0)",
                              "successors": [
                                {
                                  "id": 133924139321184,
                                  "label": "this.initDbHeader()",
                                  "successors": [
                                    {
                                      "id": 133924152953968,
                                      "label": "return",
                                      "successors": []
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "functions": [],
          "classes": []
        },
        {
          "name": "initDbHeader",
          "type": "Function",
          "blocks": [
            {
              "id": 133924152954400,
              "label": "",
              "successors": [
                {
                  "id": 133924139321280,
                  "label": "this.dstHandle.seek(Begin(0))",
                  "successors": [
                    {
                      "id": 133924139321328,
                      "label": "this.header.writeTo(this.dstHandle)",
                      "successors": [
                        {
                          "id": 133924152954448,
                          "label": "return",
                          "successors": []
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "functions": [],
          "classes": []
        },
        {
          "name": "loadSegments",
          "type": "Function",
          "blocks": [
            {
              "id": 133924152954976,
              "label": "",
              "successors": [
                {
                  "id": 133924139321472,
                  "label": "let segments = ArrayList<Segment>()",
                  "successors": [
                    {
                      "id": 133924139321520,
                      "label": "let last: Box<?Segment> = Box<?Segment>(None)",
                      "successors": [
                        {
                          "id": 133924139321568,
                          "label": "iterateSegments(\n            this.srcHandle,\n            None,\n            {\n                seg =>\n                seg.afterCheck(last.value)\n                segments.append(seg)\n                last.value = seg\n            }\n        )",
                          "successors": [
                            {
                              "id": 133924139321616,
                              "label": "this.segments = segments.toArray()",
                              "successors": [
                                {
                                  "id": 133924152955024,
                                  "label": "return",
                                  "successors": []
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "functions": [],
          "classes": []
        },
        {
          "name": "setVectorIndex",
          "type": "Function",
          "blocks": [
            {
              "id": 133924152955696,
              "label": "",
              "successors": [
                {
                  "id": 133924139321808,
                  "label": "let il0 = (ip >> 24) & 0xFF",
                  "successors": [
                    {
                      "id": 133924139321856,
                      "label": "let il1 = (ip >> 16) & 0xFF",
                      "successors": [
                        {
                          "id": 133924139321904,
                          "label": "let idx = Int64(il0 * UInt32(VectorIndexCols) * UInt32(VectorIndexSize) + il1 * UInt32(VectorIndexSize))",
                          "successors": [
                            {
                              "id": 133924139321952,
                              "label": "let sPtr = littleEndianUInt32(this.vectorIndex[idx..(idx + 4)])",
                              "successors": [
                                {
                                  "id": 133924139322000,
                                  "label": "if (sPtr == 0 )",
                                  "successors": [
                                    {
                                      "id": 133924139322384,
                                      "label": "littleEndianPutUInt32(this.vectorIndex[idx..(idx + 4)], ptr)",
                                      "successors": [
                                        {
                                          "id": 133924139322432,
                                          "label": "littleEndianPutUInt32(this.vectorIndex[(idx + 4)..(idx + 8)], ptr + UInt32(SegmentIndexBlockSize))",
                                          "successors": [
                                            {
                                              "id": 133924152955744,
                                              "label": "return",
                                              "successors": []
                                            }
                                          ]
                                        }
                                      ]
                                    },
                                    {
                                      "id": 133924139322576,
                                      "label": "littleEndianPutUInt32(this.vectorIndex[(idx + 4)..(idx + 8)], ptr + UInt32(SegmentIndexBlockSize))",
                                      "successors": [
                                        {
                                          "id": 133924152955744
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "functions": [],
          "classes": []
        },
        {
          "name": "start",
          "type": "Function",
          "blocks": [
            {
              "id": 133924152957136,
              "label": "",
              "successors": [
                {
                  "id": 133924139322144,
                  "label": "this.loadSegments()",
                  "successors": [
                    {
                      "id": 133924139322192,
                      "label": "if (this.segments.size == 0 )",
                      "successors": [
                        {
                          "id": 133924139322864,
                          "label": "throw Exception(\"empty segment list\")",
                          "successors": [
                            {
                              "id": 133924139322624,
                              "label": "try",
                              "successors": [
                                {
                                  "id": 133924139323056,
                                  "label": "this.dstHandle.seek(Begin(HeaderInfoLength + VectorIndexLength))",
                                  "successors": [
                                    {
                                      "id": 133924139323248,
                                      "label": "for (seg in this.segments )",
                                      "successors": [
                                        {
                                          "id": 133924139323632,
                                          "label": "if (this.regionPool.contains(seg.region) )",
                                          "successors": [
                                            {
                                              "id": 133924139323248
                                            },
                                            {
                                              "id": 133924139323968,
                                              "label": "continue",
                                              "successors": [
                                                {
                                                  "id": 133924139323728,
                                                  "label": "let region = seg.region.toArray()",
                                                  "successors": [
                                                    {
                                                      "id": 133924139323776,
                                                      "label": "if (region.size > 0xFFFF )",
                                                      "successors": [
                                                        {
                                                          "id": 133924139324256,
                                                          "label": "throw Exception(\"too long region info `${seg.region}`: should be less than ${0xFFFF} bytes\")",
                                                          "successors": [
                                                            {
                                                              "id": 133924139324016,
                                                              "label": "let pos = try {\n                this.dstHandle.seek(Current(0))\n            } catch (e: Exception) {\n                throw Exception(\"seek to current ptr: ${e.toString()}\")\n            }",
                                                              "successors": [
                                                                {
                                                                  "id": 133924139324064,
                                                                  "label": "try",
                                                                  "successors": [
                                                                    {
                                                                      "id": 133924139324496,
                                                                      "label": "this.dstHandle.write(region)",
                                                                      "successors": [
                                                                        {
                                                                          "id": 133924139324688,
                                                                          "label": "this.regionPool[seg.region] = UInt32(pos)",
                                                                          "successors": [
                                                                            {
                                                                              "id": 133924139323248
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "id": 133924139324544,
                                                                      "label": "catch( ( e: Exception )",
                                                                      "successors": [
                                                                        {
                                                                          "id": 133924139324736,
                                                                          "label": "throw Exception(\"write region '${seg.region}': ${e.toString()}\")",
                                                                          "successors": [
                                                                            {
                                                                              "id": 133924139324448,
                                                                              "label": "",
                                                                              "successors": []
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "id": 133924139324016
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "id": 133924139323392,
                                          "label": "let indexBuff = Array<UInt8>(SegmentIndexBlockSize, item: 0)",
                                          "successors": [
                                            {
                                              "id": 133924139323440,
                                              "label": "var (counter, startIndexPtr, endIndexPtr) = (0, -1, -1)",
                                              "successors": [
                                                {
                                                  "id": 133924139323584,
                                                  "label": "for (seg in this.segments )",
                                                  "successors": [
                                                    {
                                                      "id": 133924139325072,
                                                      "label": "if (!this.regionPool.contains(seg.region) )",
                                                      "successors": [
                                                        {
                                                          "id": 133924139325408,
                                                          "label": "throw Exception(\"missing ptr cache for region `${seg.region}`\")",
                                                          "successors": [
                                                            {
                                                              "id": 133924139325168,
                                                              "label": "let dataLen = seg.region.size",
                                                              "successors": [
                                                                {
                                                                  "id": 133924139325216,
                                                                  "label": "if (dataLen == 0 )",
                                                                  "successors": [
                                                                    {
                                                                      "id": 133924139325696,
                                                                      "label": "throw Exception(\"empty region info for segment '${seg}'\")",
                                                                      "successors": [
                                                                        {
                                                                          "id": 133924139325456,
                                                                          "label": "let dataPtr = this.regionPool[seg.region]",
                                                                          "successors": [
                                                                            {
                                                                              "id": 133924139325504,
                                                                              "label": "let segList = seg.split()",
                                                                              "successors": [
                                                                                {
                                                                                  "id": 133924139325648,
                                                                                  "label": "for (s in segList )",
                                                                                  "successors": [
                                                                                    {
                                                                                      "id": 133924139325984,
                                                                                      "label": "let pos = try {\n                    this.dstHandle.seek(Current(0))\n                } catch (e: Exception) {\n                    throw Exception(\"seek to segment index block: ${e.toString()}\")\n                }",
                                                                                      "successors": [
                                                                                        {
                                                                                          "id": 133924139326032,
                                                                                          "label": "littleEndianPutUInt32(indexBuff[0..4], s.startIP)",
                                                                                          "successors": [
                                                                                            {
                                                                                              "id": 133924139326080,
                                                                                              "label": "littleEndianPutUInt32(indexBuff[4..8], s.endIP)",
                                                                                              "successors": [
                                                                                                {
                                                                                                  "id": 133924139326128,
                                                                                                  "label": "littleEndianPutUInt16(indexBuff[8..10], UInt16(dataLen))",
                                                                                                  "successors": [
                                                                                                    {
                                                                                                      "id": 133924139326176,
                                                                                                      "label": "littleEndianPutUInt32(indexBuff[10..14], dataPtr)",
                                                                                                      "successors": [
                                                                                                        {
                                                                                                          "id": 133924139326224,
                                                                                                          "label": "try",
                                                                                                          "successors": [
                                                                                                            {
                                                                                                              "id": 133924139326512,
                                                                                                              "label": "this.dstHandle.write(indexBuff)",
                                                                                                              "successors": [
                                                                                                                {
                                                                                                                  "id": 133924139326704,
                                                                                                                  "label": "this.setVectorIndex(s.startIP, UInt32(pos))",
                                                                                                                  "successors": [
                                                                                                                    {
                                                                                                                      "id": 133924139326800,
                                                                                                                      "label": "counter++",
                                                                                                                      "successors": [
                                                                                                                        {
                                                                                                                          "id": 133924139326848,
                                                                                                                          "label": "if (startIndexPtr == -1 )",
                                                                                                                          "successors": [
                                                                                                                            {
                                                                                                                              "id": 133924139327184,
                                                                                                                              "label": "startIndexPtr = pos",
                                                                                                                              "successors": [
                                                                                                                                {
                                                                                                                                  "id": 133924139326944,
                                                                                                                                  "label": "endIndexPtr = pos",
                                                                                                                                  "successors": [
                                                                                                                                    {
                                                                                                                                      "id": 133924139325648
                                                                                                                                    }
                                                                                                                                  ]
                                                                                                                                }
                                                                                                                              ]
                                                                                                                            },
                                                                                                                            {
                                                                                                                              "id": 133924139326944
                                                                                                                            }
                                                                                                                          ]
                                                                                                                        }
                                                                                                                      ]
                                                                                                                    }
                                                                                                                  ]
                                                                                                                }
                                                                                                              ]
                                                                                                            },
                                                                                                            {
                                                                                                              "id": 133924139326560,
                                                                                                              "label": "catch( ( e: Exception )",
                                                                                                              "successors": [
                                                                                                                {
                                                                                                                  "id": 133924139326752,
                                                                                                                  "label": "throw Exception(\"write segment index for '${s}': ${e.toString()}\")",
                                                                                                                  "successors": [
                                                                                                                    {
                                                                                                                      "id": 133924139326464,
                                                                                                                      "label": "",
                                                                                                                      "successors": []
                                                                                                                    }
                                                                                                                  ]
                                                                                                                }
                                                                                                              ]
                                                                                                            }
                                                                                                          ]
                                                                                                        }
                                                                                                      ]
                                                                                                    }
                                                                                                  ]
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          ]
                                                                                        }
                                                                                      ]
                                                                                    },
                                                                                    {
                                                                                      "id": 133924139323584
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              ]
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "id": 133924139325456
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "id": 133924139325168
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "id": 133924139324832,
                                                      "label": "try",
                                                      "successors": [
                                                        {
                                                          "id": 133924139327136,
                                                          "label": "this.dstHandle.seek(Begin(HeaderInfoLength))",
                                                          "successors": [
                                                            {
                                                              "id": 133924139327376,
                                                              "label": "try",
                                                              "successors": [
                                                                {
                                                                  "id": 133924139327712,
                                                                  "label": "this.dstHandle.write(this.vectorIndex)",
                                                                  "successors": [
                                                                    {
                                                                      "id": 133924139327904,
                                                                      "label": "try",
                                                                      "successors": [
                                                                        {
                                                                          "id": 133924139328240,
                                                                          "label": "this.dstHandle.seek(Begin(8))",
                                                                          "successors": [
                                                                            {
                                                                              "id": 133924139328432,
                                                                              "label": "littleEndianPutUInt32(indexBuff[0..4], UInt32(startIndexPtr))",
                                                                              "successors": [
                                                                                {
                                                                                  "id": 133924139328528,
                                                                                  "label": "littleEndianPutUInt32(indexBuff[4..8], UInt32(endIndexPtr))",
                                                                                  "successors": [
                                                                                    {
                                                                                      "id": 133924139328576,
                                                                                      "label": "try",
                                                                                      "successors": [
                                                                                        {
                                                                                          "id": 133924139328864,
                                                                                          "label": "this.dstHandle.write(indexBuff[0..8])",
                                                                                          "successors": [
                                                                                            {
                                                                                              "id": 133924152957184,
                                                                                              "label": "return",
                                                                                              "successors": []
                                                                                            }
                                                                                          ]
                                                                                        },
                                                                                        {
                                                                                          "id": 133924139328912,
                                                                                          "label": "catch( ( e: Exception )",
                                                                                          "successors": [
                                                                                            {
                                                                                              "id": 133924139329104,
                                                                                              "label": "throw Exception(\"write segment index ptr: ${e.toString()}\")",
                                                                                              "successors": [
                                                                                                {
                                                                                                  "id": 133924139328816,
                                                                                                  "label": "",
                                                                                                  "successors": []
                                                                                                }
                                                                                              ]
                                                                                            }
                                                                                          ]
                                                                                        }
                                                                                      ]
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              ]
                                                                            }
                                                                          ]
                                                                        },
                                                                        {
                                                                          "id": 133924139328288,
                                                                          "label": "catch( ( e: Exception )",
                                                                          "successors": [
                                                                            {
                                                                              "id": 133924139328480,
                                                                              "label": "throw Exception(\"seek segment index ptr: ${e.toString()}\")",
                                                                              "successors": [
                                                                                {
                                                                                  "id": 133924139328192,
                                                                                  "label": "",
                                                                                  "successors": []
                                                                                }
                                                                              ]
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "id": 133924139327760,
                                                                  "label": "catch( ( e: Exception )",
                                                                  "successors": [
                                                                    {
                                                                      "id": 133924139327952,
                                                                      "label": "throw Exception(\"write vector index: ${e.toString()}\")",
                                                                      "successors": [
                                                                        {
                                                                          "id": 133924139327664,
                                                                          "label": "",
                                                                          "successors": []
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "id": 133924139327232,
                                                          "label": "catch( ( e: Exception )",
                                                          "successors": [
                                                            {
                                                              "id": 133924139327424,
                                                              "label": "throw Exception(\"seek vector index first ptr: ${e.toString()}\")",
                                                              "successors": [
                                                                {
                                                                  "id": 133924139326992,
                                                                  "label": "",
                                                                  "successors": []
                                                                }
                                                              ]
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "id": 133924139323104,
                                  "label": "catch( ( e: Exception )",
                                  "successors": [
                                    {
                                      "id": 133924139323296,
                                      "label": "throw Exception(\"seek to data first ptr: ${e.toString()}\")",
                                      "successors": [
                                        {
                                          "id": 133924139323008,
                                          "label": "",
                                          "successors": []
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "id": 133924139322624
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "functions": [],
          "classes": []
        },
        {
          "name": "end",
          "type": "Function",
          "blocks": [
            {
              "id": 133924152957760,
              "label": "",
              "successors": [
                {
                  "id": 133924139329200,
                  "label": "this.dstHandle.close()",
                  "successors": [
                    {
                      "id": 133924139329248,
                      "label": "this.srcHandle.close()",
                      "successors": [
                        {
                          "id": 133924152957808,
                          "label": "return",
                          "successors": []
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "functions": [],
          "classes": []
        }
      ],
      "classes": []
    }
  ]
}