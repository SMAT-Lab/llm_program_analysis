{
  "type": "file",
  "name": "28.ts",
  "label": "28.ts",
  "start_line": -1,
  "end_line": 127,
  "classes": [
    {
      "type": "class",
      "name": "%dflt",
      "label": "%dflt",
      "start_line": -1,
      "end_line": 79,
      "functions": [
        {
          "type": "function",
          "name": "%dflt",
          "label": "%dflt",
          "start_line": -1,
          "end_line": 79,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: %dflt\nTAG = 'BatchDeleteMenuOperation'\nreturn",
              "start_line": 1,
              "end_line": 79,
              "successors": []
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": ""
        }
      ],
      "classes": [],
      "blocks": [],
      "simplified_code": ""
    },
    {
      "type": "class",
      "name": "BatchDeleteMenuOperation",
      "label": "BatchDeleteMenuOperation",
      "start_line": 1,
      "end_line": 127,
      "functions": [
        {
          "type": "function",
          "name": "constructor",
          "label": "constructor",
          "start_line": 1,
          "end_line": 79,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "instanceinvoke this.<@ts_files/28.ts: BatchDeleteMenuOperation.%instInit()>()\nmenuContext = parameter0: MenuContext\nthis = this: @ts_files/28.ts: BatchDeleteMenuOperation\nstaticinvoke <@%unk/%unk: .super()>(menuContext)\nreturn",
              "start_line": 1,
              "end_line": 79,
              "successors": []
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "constructor(menuContext: MenuContext) {\n    super(menuContext);\n  }"
        },
        {
          "type": "function",
          "name": "doAction",
          "label": "doAction",
          "start_line": 1,
          "end_line": 32,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: BatchDeleteMenuOperation\ninstanceinvoke Log.<@%unk/%unk: .info()>(TAG, 'delete doAction')\n%0 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\nif %0 == null",
              "start_line": 1,
              "end_line": 1,
              "successors": [
                {
                  "type": "block",
                  "name": "Block?",
                  "label": "instanceinvoke Log.<@%unk/%unk: .warn()>(TAG, 'menuContext is null, return')\nreturn",
                  "start_line": 1,
                  "end_line": 79,
                  "successors": []
                },
                {
                  "type": "block",
                  "name": "Block?",
                  "label": "%1 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\ndataSource = %1.<@%unk/%unk: .dataSource>\nif dataSource == null",
                  "start_line": 1,
                  "end_line": 1,
                  "successors": [
                    {
                      "type": "block",
                      "name": "Block?",
                      "label": "%2 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%3 = %2.<@%unk/%unk: .items>\n%4 = %3.<@%unk/%unk: .length>\nthis.<@ts_files/28.ts: BatchDeleteMenuOperation.count> = %4",
                      "start_line": 1,
                      "end_line": 1,
                      "successors": [
                        {
                          "type": "block",
                          "name": "Block?",
                          "label": "%6 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.count>\nif %6 <= 0",
                          "start_line": 1,
                          "end_line": 1,
                          "successors": [
                            {
                              "type": "block",
                              "name": "Block?",
                              "label": "instanceinvoke Log.<@%unk/%unk: .warn()>(TAG, 'count <= 0, return')\nreturn",
                              "start_line": 1,
                              "end_line": 79,
                              "successors": []
                            },
                            {
                              "type": "block",
                              "name": "Block?",
                              "label": "this.<@ts_files/28.ts: BatchDeleteMenuOperation.confirmCallback> = %AM0$doAction\nthis.<@ts_files/28.ts: BatchDeleteMenuOperation.cancelCallback> = %AM1$doAction\nresource = instanceinvoke this.<@ts_files/28.ts: BatchDeleteMenuOperation.getDeleteMessageResource(ItemDataSource)>(dataSource)\n%7 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%8 = %7.<@%unk/%unk: .albumId>\n%9 = MediaConstants.<@%unk/%unk: .ALBUM_ID_RECYCLE>\nif %8 === %9",
                              "start_line": 1,
                              "end_line": 1,
                              "successors": [
                                {
                                  "type": "block",
                                  "name": "Block?",
                                  "label": "deleteResource = staticinvoke <@%unk/%unk: .$r()>('app.string.dialog_recycle')",
                                  "start_line": 1,
                                  "end_line": 1,
                                  "successors": [
                                    {
                                      "type": "block",
                                      "name": "Block?",
                                      "label": "%11 = BroadcastConstants.<@%unk/%unk: .SHOW_DELETE_DIALOG>\n%12 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.confirmCallback>\n%13 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.cancelCallback>\n%14 = newarray (Resource|Resource|unknown)[4]\n%14[0] = resource\n%14[1] = deleteResource\n%14[2] = %12\n%14[3] = %13\n%15 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%16 = %15.<@%unk/%unk: .broadCast>\ninstanceinvoke %16.<@%unk/%unk: .emit()>(%11, %14)\nreturn",
                                      "start_line": 1,
                                      "end_line": 79,
                                      "successors": []
                                    }
                                  ]
                                },
                                {
                                  "type": "block",
                                  "name": "Block?",
                                  "label": "deleteResource = staticinvoke <@%unk/%unk: .$r()>('app.string.dialog_delete')",
                                  "start_line": 1,
                                  "end_line": 1,
                                  "successors": [
                                    {
                                      "type": "blockRef",
                                      "label": "(RepeatedBlock)"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "block",
                      "name": "Block?",
                      "label": "%5 = instanceinvoke dataSource.<@%unk/%unk: .getSelectedCount()>()\nthis.<@ts_files/28.ts: BatchDeleteMenuOperation.count> = %5",
                      "start_line": 1,
                      "end_line": 1,
                      "successors": [
                        {
                          "type": "blockRef",
                          "label": "(RepeatedBlock)"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "doAction(): void {\n    Log.info(TAG, 'delete doAction');\n    if (this.menuContext == null) {\n      Log.warn(TAG, 'menuContext is null, return');\n      return;\n    }\n\n    let dataSource: ItemDataSource = this.menuContext.dataSource;\n    if (dataSource == null) {\n      this.count = this.menuContext.items.length;\n    } else {\n      this.count = dataSource.getSelectedCount();\n    }\n    if (this.count <= 0) {\n      Log.warn(TAG, 'count <= 0, return');\n      return;\n    }\n\n    this.confirmCallback = (): void => this.confirmCallbackBindImpl();\n    this.cancelCallback = (): void => this.cancelCallbackBindImpl();\n\n    let resource: Resource = this.getDeleteMessageResource(dataSource);\n    let deleteResource: Resource = this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.dialog_recycle') : $r('app.string.dialog_delete');\n    this.menuContext.broadCast.emit(BroadcastConstants.SHOW_DELETE_DIALOG, [resource, deleteResource, this.confirmCallback, this.cancelCallback]);\n  }"
        },
        {
          "type": "function",
          "name": "getResourceFromBrowser",
          "label": "getResourceFromBrowser",
          "start_line": 1,
          "end_line": 58,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: BatchDeleteMenuOperation\n%0 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%1 = %0.<@%unk/%unk: .albumId>\n%2 = MediaConstants.<@%unk/%unk: .ALBUM_ID_RECYCLE>\nif %1 === %2",
              "start_line": 1,
              "end_line": 1,
              "successors": [
                {
                  "type": "block",
                  "name": "Block?",
                  "label": "%3 = staticinvoke <@%unk/%unk: .$r()>('app.string.recycle_single_file_tips')",
                  "start_line": 1,
                  "end_line": 1,
                  "successors": [
                    {
                      "type": "block",
                      "name": "Block?",
                      "label": "return %3",
                      "start_line": 1,
                      "end_line": 1,
                      "successors": []
                    }
                  ]
                },
                {
                  "type": "block",
                  "name": "Block?",
                  "label": "%3 = staticinvoke <@%unk/%unk: .$r()>('app.string.delete_single_file_tips')",
                  "start_line": 1,
                  "end_line": 1,
                  "successors": [
                    {
                      "type": "blockRef",
                      "label": "(RepeatedBlock)"
                    }
                  ]
                }
              ]
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "getResourceFromBrowser(): Resource {\n    return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_single_file_tips') : $r('app.string.delete_single_file_tips');\n  }"
        },
        {
          "type": "function",
          "name": "getResourceFromGrid",
          "label": "getResourceFromGrid",
          "start_line": 1,
          "end_line": 62,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "dataSource = parameter0: ItemDataSource\nthis = this: @ts_files/28.ts: BatchDeleteMenuOperation\n%0 = dataSource != null\n%1 = instanceinvoke dataSource.<@%unk/%unk: .isSelect()>()\n%2 = %0 && %1\nif %2 != false",
              "start_line": 1,
              "end_line": 1,
              "successors": [
                {
                  "type": "block",
                  "name": "Block?",
                  "label": "%7 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.count>\nif %7 === 1",
                  "start_line": 1,
                  "end_line": 1,
                  "successors": [
                    {
                      "type": "block",
                      "name": "Block?",
                      "label": "%8 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%9 = %8.<@%unk/%unk: .albumId>\n%10 = MediaConstants.<@%unk/%unk: .ALBUM_ID_RECYCLE>\nif %9 === %10",
                      "start_line": 1,
                      "end_line": 1,
                      "successors": [
                        {
                          "type": "block",
                          "name": "Block?",
                          "label": "%11 = staticinvoke <@%unk/%unk: .$r()>('app.string.recycle_single_file_tips')",
                          "start_line": 1,
                          "end_line": 1,
                          "successors": [
                            {
                              "type": "block",
                              "name": "Block?",
                              "label": "return %11",
                              "start_line": 1,
                              "end_line": 1,
                              "successors": []
                            }
                          ]
                        },
                        {
                          "type": "block",
                          "name": "Block?",
                          "label": "%11 = staticinvoke <@%unk/%unk: .$r()>('app.string.delete_single_file_tips')",
                          "start_line": 1,
                          "end_line": 1,
                          "successors": [
                            {
                              "type": "blockRef",
                              "label": "(RepeatedBlock)"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "block",
                      "name": "Block?",
                      "label": "%12 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%13 = %12.<@%unk/%unk: .albumId>\n%14 = MediaConstants.<@%unk/%unk: .ALBUM_ID_RECYCLE>\nif %13 === %14",
                      "start_line": 1,
                      "end_line": 1,
                      "successors": [
                        {
                          "type": "block",
                          "name": "Block?",
                          "label": "%15 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.count>\n%16 = staticinvoke <@%unk/%unk: .$r()>('app.string.recycle_files_tips', %15)",
                          "start_line": 1,
                          "end_line": 1,
                          "successors": [
                            {
                              "type": "block",
                              "name": "Block?",
                              "label": "return %16",
                              "start_line": 1,
                              "end_line": 1,
                              "successors": []
                            }
                          ]
                        },
                        {
                          "type": "block",
                          "name": "Block?",
                          "label": "%17 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.count>\n%16 = staticinvoke <@%unk/%unk: .$r()>('app.string.delete_files_tips', %17)",
                          "start_line": 1,
                          "end_line": 1,
                          "successors": [
                            {
                              "type": "blockRef",
                              "label": "(RepeatedBlock)"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "block",
                  "name": "Block?",
                  "label": "%3 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%4 = %3.<@%unk/%unk: .albumId>\n%5 = MediaConstants.<@%unk/%unk: .ALBUM_ID_RECYCLE>\nif %4 === %5",
                  "start_line": 1,
                  "end_line": 1,
                  "successors": [
                    {
                      "type": "block",
                      "name": "Block?",
                      "label": "%6 = staticinvoke <@%unk/%unk: .$r()>('app.string.recycle_all_files_tips')",
                      "start_line": 1,
                      "end_line": 1,
                      "successors": [
                        {
                          "type": "block",
                          "name": "Block?",
                          "label": "return %6",
                          "start_line": 1,
                          "end_line": 1,
                          "successors": []
                        }
                      ]
                    },
                    {
                      "type": "block",
                      "name": "Block?",
                      "label": "%6 = staticinvoke <@%unk/%unk: .$r()>('app.string.delete_all_files_tips')",
                      "start_line": 1,
                      "end_line": 1,
                      "successors": [
                        {
                          "type": "blockRef",
                          "label": "(RepeatedBlock)"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "getResourceFromGrid(dataSource: ItemDataSource): Resource {\n    if (dataSource != null && dataSource.isSelect()) {\n      return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_all_files_tips') : $r('app.string.delete_all_files_tips');\n    } else if (this.count === 1) {\n      return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_single_file_tips') : $r('app.string.delete_single_file_tips');\n    } else {\n      return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_files_tips', this.count) : $r('app.string.delete_files_tips', this.count);\n    }\n  }"
        },
        {
          "type": "function",
          "name": "getDeleteMessageResource",
          "label": "getDeleteMessageResource",
          "start_line": 1,
          "end_line": 72,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "dataSource = parameter0: ItemDataSource\nthis = this: @ts_files/28.ts: BatchDeleteMenuOperation\nresource = undefined\n%0 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%1 = %0.<@%unk/%unk: .deletePageFromType>\n%2 = BroadcastConstants.<@%unk/%unk: .DELETE_FROM_BROWSER>\nif %1 === %2",
              "start_line": 1,
              "end_line": 1,
              "successors": [
                {
                  "type": "block",
                  "name": "Block?",
                  "label": "resource = instanceinvoke this.<@ts_files/28.ts: BatchDeleteMenuOperation.getResourceFromBrowser()>()",
                  "start_line": 1,
                  "end_line": 1,
                  "successors": [
                    {
                      "type": "block",
                      "name": "Block?",
                      "label": "return resource",
                      "start_line": 79,
                      "end_line": 79,
                      "successors": []
                    }
                  ]
                },
                {
                  "type": "block",
                  "name": "Block?",
                  "label": "resource = instanceinvoke this.<@ts_files/28.ts: BatchDeleteMenuOperation.getResourceFromGrid(ItemDataSource)>(dataSource)",
                  "start_line": 1,
                  "end_line": 1,
                  "successors": [
                    {
                      "type": "blockRef",
                      "label": "(RepeatedBlock)"
                    }
                  ]
                }
              ]
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "getDeleteMessageResource(dataSource: ItemDataSource): Resource {\n    let resource: Resource;\n    if (this.menuContext.deletePageFromType === BroadcastConstants.DELETE_FROM_BROWSER) {\n      resource = this.getResourceFromBrowser();\n    } else {\n      resource = this.getResourceFromGrid(dataSource);\n    }\n    return resource;\n  }"
        },
        {
          "type": "function",
          "name": "confirmCallback",
          "label": "confirmCallback",
          "start_line": 1,
          "end_line": 82,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: BatchDeleteMenuOperation\ninstanceinvoke this.<@ts_files/28.ts: BatchDeleteMenuOperation.confirmCallbackBindImpl()>()\nreturn",
              "start_line": 1,
              "end_line": 79,
              "successors": []
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "confirmCallback(): void {\n    this.confirmCallbackBindImpl();\n  }"
        },
        {
          "type": "function",
          "name": "confirmCallbackBindImpl",
          "label": "confirmCallbackBindImpl",
          "start_line": 1,
          "end_line": 86,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: BatchDeleteMenuOperation\ninstanceinvoke Log.<@%unk/%unk: .info()>(TAG, 'Batch delete confirm')\ninstanceinvoke AppStorage.<@%unk/%unk: .SetOrCreate()>('isDelete', 1)\n%0 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%1 = %0.<@%unk/%unk: .onOperationEnd>\nthis.<@ts_files/28.ts: BatchDeleteMenuOperation.onOperationEnd> = %1\n%2 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\nonOperationStart = %2.<@%unk/%unk: .onOperationStart>\nif onOperationStart != null",
              "start_line": 1,
              "end_line": 1,
              "successors": [
                {
                  "type": "block",
                  "name": "Block?",
                  "label": "staticinvoke <@%unk/%unk: .onOperationStart()>()",
                  "start_line": 1,
                  "end_line": 1,
                  "successors": [
                    {
                      "type": "block",
                      "name": "Block?",
                      "label": "%3 = BroadcastConstants.<@%unk/%unk: .DELETE_PROGRESS_DIALOG>\n%4 = staticinvoke <@%unk/%unk: .$r()>('app.string.action_delete')\n%5 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.count>\n%6 = newarray (unknown)[2]\n%6[0] = %4\n%6[1] = %5\n%7 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%8 = %7.<@%unk/%unk: .broadCast>\ninstanceinvoke %8.<@%unk/%unk: .emit()>(%3, %6)\n%9 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\ndataSource = %9.<@%unk/%unk: .dataSource>\nif dataSource == null",
                      "start_line": 1,
                      "end_line": 1,
                      "successors": [
                        {
                          "type": "block",
                          "name": "Block?",
                          "label": "%10 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%11 = %10.<@%unk/%unk: .items>\nthis.<@ts_files/28.ts: BatchDeleteMenuOperation.items> = %11",
                          "start_line": 1,
                          "end_line": 1,
                          "successors": [
                            {
                              "type": "block",
                              "name": "Block?",
                              "label": "instanceinvoke this.<@%unk/%unk: .processOperation()>()\nreturn",
                              "start_line": 1,
                              "end_line": 79,
                              "successors": []
                            }
                          ]
                        },
                        {
                          "type": "block",
                          "name": "Block?",
                          "label": "%12 = instanceinvoke dataSource.<@%unk/%unk: .getSelectedItems()>()\nthis.<@ts_files/28.ts: BatchDeleteMenuOperation.items> = %12",
                          "start_line": 1,
                          "end_line": 1,
                          "successors": [
                            {
                              "type": "blockRef",
                              "label": "(RepeatedBlock)"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "blockRef",
                  "label": "(RepeatedBlock)"
                }
              ]
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "protected confirmCallbackBindImpl(): void {\n    Log.info(TAG, 'Batch delete confirm');\n    AppStorage.SetOrCreate<number>('isDelete', 1);\n\n    // 1. Variable initialization\n    this.onOperationEnd = this.menuContext.onOperationEnd;\n\n    // 2. onDeleteStart exit selection mode\n    let onOperationStart: Function = this.menuContext.onOperationStart;\n    if (onOperationStart != null) {\n      onOperationStart();\n    }\n\n    this.menuContext.broadCast.emit(BroadcastConstants.DELETE_PROGRESS_DIALOG,\n      [$r('app.string.action_delete'), this.count]);\n\n    // 3. selectManager gets the URI of the data and starts processing deletion in the callback\n    let dataSource: ItemDataSource = this.menuContext.dataSource;\n    if (dataSource == null) {\n      this.items = this.menuContext.items;\n    } else {\n      this.items = dataSource.getSelectedItems();\n    }\n    this.processOperation();\n  }"
        },
        {
          "type": "function",
          "name": "requestOneBatchOperation",
          "label": "requestOneBatchOperation",
          "start_line": 1,
          "end_line": 112,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: BatchDeleteMenuOperation\n%0 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.items>\n%1 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.currentBatch>\n%2 = %0.<@%unk/%unk: .%1>\nitem = <UserFileDataItem>%2\nif item != null",
              "start_line": 1,
              "end_line": 1,
              "successors": [
                {
                  "type": "block",
                  "name": "Block?",
                  "label": "%3 = instanceinvoke item.<@%unk/%unk: .onDelete()>()\ninstanceinvoke %3.<@%unk/%unk: .then()>(%AM2$requestOneBatchOperation)",
                  "start_line": 1,
                  "end_line": 1,
                  "successors": [
                    {
                      "type": "block",
                      "name": "Block?",
                      "label": "return",
                      "start_line": 35,
                      "end_line": 79,
                      "successors": []
                    }
                  ]
                },
                {
                  "type": "blockRef",
                  "label": "(RepeatedBlock)"
                }
              ]
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            },
            {
              "type": "blockRef",
              "label": "(RepeatedBlock)"
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "requestOneBatchOperation(): void {\n    let item = this.items[this.currentBatch] as UserFileDataItem;\n    if (item != null) {\n      item.onDelete().then<void, void>((): void => {\n        this.currentBatch++;\n        this.menuContext.broadCast.emit(BroadcastConstants.UPDATE_PROGRESS, [this.getExpectProgress(), this.currentBatch]);\n        this.cyclicOperation();\n      })\n    }\n  }"
        },
        {
          "type": "function",
          "name": "cancelCallback",
          "label": "cancelCallback",
          "start_line": 1,
          "end_line": 123,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: BatchDeleteMenuOperation\ninstanceinvoke this.<@ts_files/28.ts: BatchDeleteMenuOperation.cancelCallbackBindImpl()>()\nreturn",
              "start_line": 1,
              "end_line": 79,
              "successors": []
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "cancelCallback(): void {\n    this.cancelCallbackBindImpl();\n  }"
        },
        {
          "type": "function",
          "name": "cancelCallbackBindImpl",
          "label": "cancelCallbackBindImpl",
          "start_line": 1,
          "end_line": 127,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: BatchDeleteMenuOperation\ninstanceinvoke Log.<@%unk/%unk: .info()>(TAG, 'Batch delete cancel')\nreturn",
              "start_line": 1,
              "end_line": 79,
              "successors": []
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "protected cancelCallbackBindImpl(): void {\n    Log.info(TAG, 'Batch delete cancel');\n  }"
        },
        {
          "type": "function",
          "name": "%AM0$doAction",
          "label": "%AM0$doAction",
          "start_line": 1,
          "end_line": 50,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: BatchDeleteMenuOperation\n%0 = instanceinvoke this.<@ts_files/28.ts: BatchDeleteMenuOperation.confirmCallbackBindImpl()>()\nreturn %0",
              "start_line": 1,
              "end_line": 1,
              "successors": []
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "(): void => this.confirmCallbackBindImpl()"
        },
        {
          "type": "function",
          "name": "%AM1$doAction",
          "label": "%AM1$doAction",
          "start_line": 1,
          "end_line": 51,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: BatchDeleteMenuOperation\n%0 = instanceinvoke this.<@ts_files/28.ts: BatchDeleteMenuOperation.cancelCallbackBindImpl()>()\nreturn %0",
              "start_line": 1,
              "end_line": 1,
              "successors": []
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "(): void => this.cancelCallbackBindImpl()"
        },
        {
          "type": "function",
          "name": "%AM2$requestOneBatchOperation",
          "label": "%AM2$requestOneBatchOperation",
          "start_line": 1,
          "end_line": 115,
          "blocks": [
            {
              "type": "block",
              "name": "Block?",
              "label": "this = this: @ts_files/28.ts: BatchDeleteMenuOperation\n%0 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.currentBatch>\n%0 = %0 + 1\n%1 = BroadcastConstants.<@%unk/%unk: .UPDATE_PROGRESS>\n%2 = instanceinvoke this.<@%unk/%unk: .getExpectProgress()>()\n%3 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.currentBatch>\n%4 = newarray (unknown)[2]\n%4[0] = %2\n%4[1] = %3\n%5 = this.<@ts_files/28.ts: BatchDeleteMenuOperation.menuContext>\n%6 = %5.<@%unk/%unk: .broadCast>\ninstanceinvoke %6.<@%unk/%unk: .emit()>(%1, %4)\ninstanceinvoke this.<@%unk/%unk: .cyclicOperation()>()\nreturn",
              "start_line": 1,
              "end_line": 79,
              "successors": []
            }
          ],
          "functions": [],
          "classes": [],
          "simplified_code": "(): void => {\n        this.currentBatch++;\n        this.menuContext.broadCast.emit(BroadcastConstants.UPDATE_PROGRESS, [this.getExpectProgress(), this.currentBatch]);\n        this.cyclicOperation();\n      }"
        }
      ],
      "classes": [],
      "blocks": [],
      "simplified_code": "export class BatchDeleteMenuOperation extends ProcessMenuOperation {\n\n  constructor(menuContext: MenuContext) {\n    super(menuContext);\n  }\n\n  doAction(): void {\n    Log.info(TAG, 'delete doAction');\n    if (this.menuContext == null) {\n      Log.warn(TAG, 'menuContext is null, return');\n      return;\n    }\n\n    let dataSource: ItemDataSource = this.menuContext.dataSource;\n    if (dataSource == null) {\n      this.count = this.menuContext.items.length;\n    } else {\n      this.count = dataSource.getSelectedCount();\n    }\n    if (this.count <= 0) {\n      Log.warn(TAG, 'count <= 0, return');\n      return;\n    }\n\n    this.confirmCallback = (): void => this.confirmCallbackBindImpl();\n    this.cancelCallback = (): void => this.cancelCallbackBindImpl();\n\n    let resource: Resource = this.getDeleteMessageResource(dataSource);\n    let deleteResource: Resource = this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.dialog_recycle') : $r('app.string.dialog_delete');\n    this.menuContext.broadCast.emit(BroadcastConstants.SHOW_DELETE_DIALOG, [resource, deleteResource, this.confirmCallback, this.cancelCallback]);\n  }\n\n  getResourceFromBrowser(): Resource {\n    return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_single_file_tips') : $r('app.string.delete_single_file_tips');\n  }\n\n  getResourceFromGrid(dataSource: ItemDataSource): Resource {\n    if (dataSource != null && dataSource.isSelect()) {\n      return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_all_files_tips') : $r('app.string.delete_all_files_tips');\n    } else if (this.count === 1) {\n      return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_single_file_tips') : $r('app.string.delete_single_file_tips');\n    } else {\n      return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_files_tips', this.count) : $r('app.string.delete_files_tips', this.count);\n    }\n  }\n\n  getDeleteMessageResource(dataSource: ItemDataSource): Resource {\n    let resource: Resource;\n    if (this.menuContext.deletePageFromType === BroadcastConstants.DELETE_FROM_BROWSER) {\n      resource = this.getResourceFromBrowser();\n    } else {\n      resource = this.getResourceFromGrid(dataSource);\n    }\n    return resource;\n  }\n\n  confirmCallback(): void {\n    this.confirmCallbackBindImpl();\n  }\n\n  protected confirmCallbackBindImpl(): void {\n    Log.info(TAG, 'Batch delete confirm');\n    AppStorage.SetOrCreate<number>('isDelete', 1);\n\n    // 1. Variable initialization\n    this.onOperationEnd = this.menuContext.onOperationEnd;\n\n    // 2. onDeleteStart exit selection mode\n    let onOperationStart: Function = this.menuContext.onOperationStart;\n    if (onOperationStart != null) {\n      onOperationStart();\n    }\n\n    this.menuContext.broadCast.emit(BroadcastConstants.DELETE_PROGRESS_DIALOG,\n      [$r('app.string.action_delete'), this.count]);\n\n    // 3. selectManager gets the URI of the data and starts processing deletion in the callback\n    let dataSource: ItemDataSource = this.menuContext.dataSource;\n    if (dataSource == null) {\n      this.items = this.menuContext.items;\n    } else {\n      this.items = dataSource.getSelectedItems();\n    }\n    this.processOperation();\n  }\n\n  requestOneBatchOperation(): void {\n    let item = this.items[this.currentBatch] as UserFileDataItem;\n    if (item != null) {\n      item.onDelete().then<void, void>((): void => {\n        this.currentBatch++;\n        this.menuContext.broadCast.emit(BroadcastConstants.UPDATE_PROGRESS, [this.getExpectProgress(), this.currentBatch]);\n        this.cyclicOperation();\n      })\n    }\n  }\n\n  cancelCallback(): void {\n    this.cancelCallbackBindImpl();\n  }\n\n  protected cancelCallbackBindImpl(): void {\n    Log.info(TAG, 'Batch delete cancel');\n  }\n}"
    }
  ],
  "functions": [],
  "blocks": [],
  "simplified_code": "/*\n * Copyright (c) 2023 Shenzhen Kaihong Digital Industry Development Co., Ltd.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Log } from '../utils/Log';\nimport { ItemDataSource } from '../common/ItemDataSource';\nimport { MenuContext } from './MenuContext';\nimport { BroadcastConstants } from '../constants/BroadcastConstants';\nimport { ProcessMenuOperation } from './ProcessMenuOperation';\nimport { UserFileDataItem } from '../base/UserFileDataItem';\nimport { MediaConstants } from '../constants/MediaConstants';\n\nconst TAG = 'BatchDeleteMenuOperation';\n\nexport class BatchDeleteMenuOperation extends ProcessMenuOperation {\n\n  constructor(menuContext: MenuContext) {\n    super(menuContext);\n  }\n\n  doAction(): void {\n    Log.info(TAG, 'delete doAction');\n    if (this.menuContext == null) {\n      Log.warn(TAG, 'menuContext is null, return');\n      return;\n    }\n\n    let dataSource: ItemDataSource = this.menuContext.dataSource;\n    if (dataSource == null) {\n      this.count = this.menuContext.items.length;\n    } else {\n      this.count = dataSource.getSelectedCount();\n    }\n    if (this.count <= 0) {\n      Log.warn(TAG, 'count <= 0, return');\n      return;\n    }\n\n    this.confirmCallback = (): void => this.confirmCallbackBindImpl();\n    this.cancelCallback = (): void => this.cancelCallbackBindImpl();\n\n    let resource: Resource = this.getDeleteMessageResource(dataSource);\n    let deleteResource: Resource = this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.dialog_recycle') : $r('app.string.dialog_delete');\n    this.menuContext.broadCast.emit(BroadcastConstants.SHOW_DELETE_DIALOG, [resource, deleteResource, this.confirmCallback, this.cancelCallback]);\n  }\n\n  getResourceFromBrowser(): Resource {\n    return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_single_file_tips') : $r('app.string.delete_single_file_tips');\n  }\n\n  getResourceFromGrid(dataSource: ItemDataSource): Resource {\n    if (dataSource != null && dataSource.isSelect()) {\n      return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_all_files_tips') : $r('app.string.delete_all_files_tips');\n    } else if (this.count === 1) {\n      return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_single_file_tips') : $r('app.string.delete_single_file_tips');\n    } else {\n      return this.menuContext.albumId === MediaConstants.ALBUM_ID_RECYCLE ? $r('app.string.recycle_files_tips', this.count) : $r('app.string.delete_files_tips', this.count);\n    }\n  }\n\n  getDeleteMessageResource(dataSource: ItemDataSource): Resource {\n    let resource: Resource;\n    if (this.menuContext.deletePageFromType === BroadcastConstants.DELETE_FROM_BROWSER) {\n      resource = this.getResourceFromBrowser();\n    } else {\n      resource = this.getResourceFromGrid(dataSource);\n    }\n    return resource;\n  }\n\n  confirmCallback(): void {\n    this.confirmCallbackBindImpl();\n  }\n\n  protected confirmCallbackBindImpl(): void {\n    Log.info(TAG, 'Batch delete confirm');\n    AppStorage.SetOrCreate<number>('isDelete', 1);\n\n    // 1. Variable initialization\n    this.onOperationEnd = this.menuContext.onOperationEnd;\n\n    // 2. onDeleteStart exit selection mode\n    let onOperationStart: Function = this.menuContext.onOperationStart;\n    if (onOperationStart != null) {\n      onOperationStart();\n    }\n\n    this.menuContext.broadCast.emit(BroadcastConstants.DELETE_PROGRESS_DIALOG,\n      [$r('app.string.action_delete'), this.count]);\n\n    // 3. selectManager gets the URI of the data and starts processing deletion in the callback\n    let dataSource: ItemDataSource = this.menuContext.dataSource;\n    if (dataSource == null) {\n      this.items = this.menuContext.items;\n    } else {\n      this.items = dataSource.getSelectedItems();\n    }\n    this.processOperation();\n  }\n\n  requestOneBatchOperation(): void {\n    let item = this.items[this.currentBatch] as UserFileDataItem;\n    if (item != null) {\n      item.onDelete().then<void, void>((): void => {\n        this.currentBatch++;\n        this.menuContext.broadCast.emit(BroadcastConstants.UPDATE_PROGRESS, [this.getExpectProgress(), this.currentBatch]);\n        this.cyclicOperation();\n      })\n    }\n  }\n\n  cancelCallback(): void {\n    this.cancelCallbackBindImpl();\n  }\n\n  protected cancelCallbackBindImpl(): void {\n    Log.info(TAG, 'Batch delete cancel');\n  }\n}\n"
}