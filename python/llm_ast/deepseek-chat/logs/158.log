2025-01-08 10:22:40,181 - INFO - Processing sample 158
2025-01-08 10:22:40,181 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 10:22:50,389 - INFO - Successfully split code into 15 top-level declarations
2025-01-08 10:22:50,394 - INFO - Processing chunk #0 (size=218 chars, start_index=0)
2025-01-08 10:22:50,394 - INFO - Processing chunk with 218 chars starting at index 0
2025-01-08 10:22:50,394 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,394 - INFO - Tokenized code into 54 tokens
2025-01-08 10:22:50,394 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,396 - INFO - Processing chunk #1 (size=308 chars, start_index=54)
2025-01-08 10:22:50,402 - INFO - Processing chunk with 308 chars starting at index 54
2025-01-08 10:22:50,402 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,403 - INFO - Tokenized code into 48 tokens
2025-01-08 10:22:50,403 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,404 - INFO - Processing chunk #2 (size=438 chars, start_index=102)
2025-01-08 10:22:50,404 - INFO - Processing chunk with 438 chars starting at index 102
2025-01-08 10:22:50,404 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,404 - INFO - Tokenized code into 81 tokens
2025-01-08 10:22:50,404 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,414 - INFO - Processing chunk #3 (size=666 chars, start_index=183)
2025-01-08 10:22:50,415 - INFO - Processing chunk with 666 chars starting at index 183
2025-01-08 10:22:50,415 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,415 - INFO - Tokenized code into 121 tokens
2025-01-08 10:22:50,415 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,421 - INFO - Processing chunk #4 (size=591 chars, start_index=304)
2025-01-08 10:22:50,421 - INFO - Processing chunk with 591 chars starting at index 304
2025-01-08 10:22:50,422 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,422 - INFO - Tokenized code into 114 tokens
2025-01-08 10:22:50,422 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,427 - INFO - Processing chunk #5 (size=675 chars, start_index=418)
2025-01-08 10:22:50,428 - INFO - Processing chunk with 675 chars starting at index 418
2025-01-08 10:22:50,428 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,428 - INFO - Tokenized code into 129 tokens
2025-01-08 10:22:50,428 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,434 - INFO - Processing chunk #6 (size=608 chars, start_index=547)
2025-01-08 10:22:50,434 - INFO - Processing chunk with 608 chars starting at index 547
2025-01-08 10:22:50,434 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,435 - INFO - Tokenized code into 107 tokens
2025-01-08 10:22:50,435 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,437 - INFO - Processing chunk #7 (size=560 chars, start_index=654)
2025-01-08 10:22:50,437 - INFO - Processing chunk with 560 chars starting at index 654
2025-01-08 10:22:50,437 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,437 - INFO - Tokenized code into 119 tokens
2025-01-08 10:22:50,437 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,450 - INFO - Processing chunk #8 (size=549 chars, start_index=773)
2025-01-08 10:22:50,450 - INFO - Processing chunk with 549 chars starting at index 773
2025-01-08 10:22:50,450 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,451 - INFO - Tokenized code into 116 tokens
2025-01-08 10:22:50,451 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,453 - INFO - Processing chunk #9 (size=444 chars, start_index=889)
2025-01-08 10:22:50,453 - INFO - Processing chunk with 444 chars starting at index 889
2025-01-08 10:22:50,453 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,454 - INFO - Tokenized code into 83 tokens
2025-01-08 10:22:50,454 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,456 - INFO - Processing chunk #10 (size=432 chars, start_index=972)
2025-01-08 10:22:50,466 - INFO - Processing chunk with 432 chars starting at index 972
2025-01-08 10:22:50,467 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,467 - INFO - Tokenized code into 82 tokens
2025-01-08 10:22:50,467 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,472 - INFO - Processing chunk #11 (size=454 chars, start_index=1054)
2025-01-08 10:22:50,473 - INFO - Processing chunk with 454 chars starting at index 1054
2025-01-08 10:22:50,473 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,473 - INFO - Tokenized code into 82 tokens
2025-01-08 10:22:50,473 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,483 - INFO - Processing chunk #12 (size=446 chars, start_index=1136)
2025-01-08 10:22:50,483 - INFO - Processing chunk with 446 chars starting at index 1136
2025-01-08 10:22:50,483 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,483 - INFO - Tokenized code into 82 tokens
2025-01-08 10:22:50,483 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,488 - INFO - Processing chunk #13 (size=491 chars, start_index=1218)
2025-01-08 10:22:50,489 - INFO - Processing chunk with 491 chars starting at index 1218
2025-01-08 10:22:50,489 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,489 - INFO - Tokenized code into 97 tokens
2025-01-08 10:22:50,489 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:50,494 - INFO - Processing chunk #14 (size=447 chars, start_index=1315)
2025-01-08 10:22:50,497 - INFO - Processing chunk with 447 chars starting at index 1315
2025-01-08 10:22:50,497 - INFO - Starting main AST analysis flow
2025-01-08 10:22:50,497 - INFO - Tokenized code into 89 tokens
2025-01-08 10:22:50,497 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:52,843 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_png_success', 'range': [889, 971], 'children': []}
2025-01-08 10:22:52,843 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:52,857 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_webm_success', 'range': [1136, 1217], 'children': []}
2025-01-08 10:22:52,857 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:52,863 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_file_too_large', 'range': [654, 772], 'children': []}
2025-01-08 10:22:52,863 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:52,897 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_invalid_type', 'range': [304, 417], 'children': []}
2025-01-08 10:22:52,897 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:53,043 - INFO - Step 1 result: {'type': 'Program', 'name': 'mock_settings', 'range': [59, 101], 'children': []}
2025-01-08 10:22:53,043 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:53,051 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_video_type', 'range': [547, 653], 'children': []}
2025-01-08 10:22:53,051 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:53,058 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_success', 'range': [183, 303], 'children': []}
2025-01-08 10:22:53,058 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:53,094 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_mismatched_signature', 'range': [1218, 1314], 'children': []}
2025-01-08 10:22:53,095 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:53,127 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_invalid_signature', 'range': [1315, 1403], 'children': []}
2025-01-08 10:22:53,127 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:53,131 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_file_read_error', 'range': [773, 888], 'children': []}
2025-01-08 10:22:53,131 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:53,332 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_webp_success', 'range': [1054, 1135], 'children': []}
2025-01-08 10:22:53,333 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:53,428 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_gif_success', 'range': [972, 1053], 'children': []}
2025-01-08 10:22:53,428 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:53,526 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [102, 182], 'children': [{'type': 'FunctionDeclaration', 'name': 'mock_storage_client', 'range': [107, 182], 'children': []}]}
2025-01-08 10:22:53,526 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:58,129 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 53], 'children': [{'type': 'ImportDeclaration', 'name': 'io', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': 'unittest.mock', 'range': [3, 7], 'children': []}, {'type': 'ImportDeclaration', 'name': 'fastapi', 'range': [9, 11], 'children': []}, {'type': 'ImportDeclaration', 'name': 'pytest', 'range': [12, 14], 'children': []}, {'type': 'ImportDeclaration', 'name': 'starlette.datastructures', 'range': [15, 19], 'children': []}, {'type': 'ImportDeclaration', 'name': 'backend.server.v2.store.exceptions', 'range': [21, 31], 'children': []}, {'type': 'ImportDeclaration', 'name': 'backend.server.v2.store.media', 'range': [32, 42], 'children': []}, {'type': 'ImportDeclaration', 'name': 'Settings', 'range': [43, 51], 'children': []}]}
2025-01-08 10:22:58,129 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:58,766 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_upload_media_missing_credentials', 'range': [418, 546], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_missing_credentials', 'range': [418, 546], 'children': [{'type': 'VariableDeclaration', 'name': 'settings', 'range': [426, 430], 'children': []}, {'type': 'AssignmentExpression', 'name': '', 'range': [432, 446], 'children': []}, {'type': 'AssignmentExpression', 'name': '', 'range': [440, 446], 'children': []}, {'type': 'CallExpression', 'name': 'monkeypatch.setattr', 'range': [448, 457], 'children': []}, {'type': 'VariableDeclaration', 'name': 'test_file', 'range': [460, 506], 'children': []}, {'type': 'WithStatement', 'name': '', 'range': [509, 545], 'children': [{'type': 'CallExpression', 'name': 'pytest.raises', 'range': [510, 525], 'children': []}, {'type': 'AwaitExpression', 'name': '', 'range': [528, 544], 'children': []}]}]}]}
2025-01-08 10:22:58,767 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:23:12,260 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_success', 'range': [183, 303], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_success', 'range': [183, 303], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [186, 190], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [187, 187], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [189, 189], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [192, 303], 'children': [{'type': 'Comment', 'name': 'Create test JPEG data with valid signature', 'range': [193, 201], 'children': []}, {'type': 'VariableDeclaration', 'name': 'test_data', 'range': [202, 209], 'children': [{'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [204, 205], 'children': []}, {'type': 'Literal', 'name': 'b"test data"', 'range': [207, 208], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'test_file', 'range': [211, 250], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [213, 249], 'children': [{'type': 'Argument', 'name': 'filename="laptop.jpeg"', 'range': [218, 220], 'children': []}, {'type': 'Argument', 'name': 'file=io.BytesIO(test_data)', 'range': [223, 230], 'children': []}, {'type': 'Argument', 'name': 'headers=starlette.datastructures.Headers({"content-type": "image/jpeg"})', 'range': [233, 246], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'result', 'range': [252, 271], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [255, 270], 'children': [{'type': 'Argument', 'name': '"test-user"', 'range': [267, 267], 'children': []}, {'type': 'Argument', 'name': 'test_file', 'range': [269, 269], 'children': []}]}]}, {'type': 'AssertStatement', 'name': 'assert result == "http://test-url/media/laptop.jpeg"', 'range': [273, 278], 'children': []}, {'type': 'VariableDeclaration', 'name': 'mock_bucket', 'range': [279, 286], 'children': [{'type': 'MemberExpression', 'name': 'mock_storage_client.bucket.return_value', 'range': [281, 285], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'mock_blob', 'range': [287, 294], 'children': [{'type': 'MemberExpression', 'name': 'mock_bucket.blob.return_value', 'range': [289, 293], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob.upload_from_string.assert_called_once()', 'range': [295, 302], 'children': []}]}]}]}
2025-01-08 10:23:12,261 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:12,858 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_file_read_error', 'range': [773, 888], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_file_read_error', 'range': [773, 888], 'children': [{'type': 'ParameterList', 'name': '', 'range': [776, 780], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [777, 777], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [779, 779], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [781, 888], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [783, 831], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [784, 831], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [785, 831], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [788, 831], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [790, 792], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [795, 803], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [815, 828], 'children': []}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [833, 850], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [834, 850], 'children': [{'type': 'MemberExpression', 'name': 'read', 'range': [834, 835], 'children': []}, {'type': 'CallExpression', 'name': 'AsyncMock', 'range': [837, 849], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [842, 849], 'children': [{'type': 'KeywordArgument', 'name': 'side_effect', 'range': [843, 848], 'children': []}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [852, 888], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [853, 868], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [856, 868], 'children': [{'type': 'Identifier', 'name': 'FileReadError', 'range': [867, 867], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [869, 888], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [871, 888], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [871, 887], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [872, 887], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [883, 887], 'children': [{'type': 'StringLiteral', 'name': 'test-user', 'range': [884, 884], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [886, 886], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:23:12,859 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:13,066 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_webm_success', 'range': [1136, 1217], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_webm_success', 'range': [1136, 1217], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1139, 1143], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1140, 1140], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1142, 1142], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1144, 1217], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1146, 1189], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1147, 1189], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1148, 1189], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1151, 1189], 'children': [{'type': 'Argument', 'name': 'filename', 'range': [1153, 1155], 'children': []}, {'type': 'Argument', 'name': 'file', 'range': [1158, 1166], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1160, 1166], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1163, 1166], 'children': [{'type': 'Argument', 'name': 'b', 'range': [1164, 1165], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'headers', 'range': [1173, 1186], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1175, 1186], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1180, 1186], 'children': [{'type': 'Argument', 'name': '', 'range': [1181, 1185], 'children': []}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [1192, 1210], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1193, 1210], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [1194, 1210], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1195, 1210], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1206, 1210], 'children': [{'type': 'Argument', 'name': '"test-user"', 'range': [1207, 1207], 'children': []}, {'type': 'Argument', 'name': 'test_file', 'range': [1209, 1209], 'children': []}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'assert', 'range': [1212, 1216], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1213, 1216], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1213, 1213], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1215, 1216], 'children': []}]}]}]}]}]}
2025-01-08 10:23:13,066 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:13,153 - INFO - Step 2 result: {'type': 'Program', 'name': 'mock_settings', 'range': [59, 101], 'children': [{'type': 'FunctionDeclaration', 'name': 'mock_settings', 'range': [59, 101], 'children': [{'type': 'Parameter', 'name': 'monkeypatch', 'range': [62, 62], 'children': []}, {'type': 'BlockStatement', 'range': [64, 101], 'children': [{'type': 'VariableDeclaration', 'name': 'settings', 'range': [66, 70], 'children': [{'type': 'AssignmentExpression', 'range': [67, 70], 'children': [{'type': 'NewExpression', 'name': 'Settings', 'range': [68, 70], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [72, 78], 'children': [{'type': 'AssignmentExpression', 'range': [77, 78], 'children': [{'type': 'MemberExpression', 'range': [72, 76], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [72, 72], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [74, 74], 'children': []}, {'type': 'Identifier', 'name': 'media_gcs_bucket_name', 'range': [76, 76], 'children': []}]}, {'type': 'Literal', 'value': 'test-bucket', 'range': [78, 78], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [80, 86], 'children': [{'type': 'AssignmentExpression', 'range': [85, 86], 'children': [{'type': 'MemberExpression', 'range': [80, 84], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [80, 80], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [82, 82], 'children': []}, {'type': 'Identifier', 'name': 'google_application_credentials', 'range': [84, 84], 'children': []}]}, {'type': 'Literal', 'value': 'test-credentials', 'range': [86, 86], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [88, 97], 'children': [{'type': 'CallExpression', 'range': [90, 97], 'children': [{'type': 'MemberExpression', 'range': [88, 90], 'children': [{'type': 'Identifier', 'name': 'monkeypatch', 'range': [88, 88], 'children': []}, {'type': 'Identifier', 'name': 'setattr', 'range': [90, 90], 'children': []}]}, {'type': 'Literal', 'value': 'backend.server.v2.store.media.Settings', 'range': [92, 92], 'children': []}, {'type': 'ArrowFunctionExpression', 'range': [94, 97], 'children': [{'type': 'BlockStatement', 'range': [96, 97], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [96, 96], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'range': [99, 100], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [100, 100], 'children': []}]}]}]}]}
2025-01-08 10:23:13,153 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:14,189 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_invalid_signature', 'range': [1315, 1403], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_invalid_signature', 'range': [1315, 1403], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [1318, 1322], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1319, 1319], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1321, 1321], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [1324, 1403], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1325, 1364], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1326, 1364], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1327, 1364], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1330, 1364], 'children': [{'type': 'Argument', 'name': 'filename', 'range': [1332, 1334], 'children': []}, {'type': 'Argument', 'name': 'file', 'range': [1337, 1345], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1339, 1345], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1342, 1345], 'children': [{'type': 'Argument', 'name': 'b', 'range': [1343, 1344], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'headers', 'range': [1348, 1361], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1350, 1361], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1355, 1361], 'children': [{'type': 'ObjectExpression', 'name': 'headers', 'range': [1356, 1360], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1357, 1359], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': 'with', 'range': [1367, 1403], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [1368, 1383], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1371, 1383], 'children': [{'type': 'Argument', 'name': 'InvalidFileTypeError', 'range': [1372, 1382], 'children': []}]}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [1385, 1403], 'children': [{'type': 'ExpressionStatement', 'name': 'await', 'range': [1386, 1402], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1387, 1402], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1398, 1402], 'children': [{'type': 'Argument', 'name': 'test-user', 'range': [1399, 1399], 'children': []}, {'type': 'Argument', 'name': 'test_file', 'range': [1401, 1401], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:23:14,190 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:14,659 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_mismatched_signature', 'range': [1218, 1314], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_mismatched_signature', 'range': [1218, 1314], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1221, 1225], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1222, 1222], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1224, 1224], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1226, 1314], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1228, 1274], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1229, 1274], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1230, 1274], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1233, 1274], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [1235, 1237], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [1240, 1248], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1242, 1248], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1245, 1248], 'children': [{'type': 'Literal', 'name': 'b"\\x89PNG\\r\\n\\x1a\\n"', 'range': [1246, 1247], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [1258, 1271], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1260, 1271], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1265, 1271], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1266, 1270], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1267, 1269], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [1277, 1313], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [1278, 1293], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1281, 1293], 'children': [{'type': 'MemberExpression', 'name': 'InvalidFileTypeError', 'range': [1282, 1292], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [1294, 1313], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [1296, 1312], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [1296, 1312], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1297, 1312], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1308, 1312], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [1309, 1309], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1311, 1311], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:23:14,659 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:15,188 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_webp_success', 'range': [1054, 1135], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_webp_success', 'range': [1054, 1135], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1057, 1061], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1058, 1058], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1060, 1060], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1062, 1135], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1064, 1107], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1065, 1107], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1066, 1107], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1069, 1107], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [1071, 1073], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [1076, 1084], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1078, 1084], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1081, 1084], 'children': [{'type': 'Literal', 'name': 'b"RIFF\\x00\\x00\\x00\\x00WEBP"', 'range': [1082, 1083], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [1091, 1104], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1093, 1104], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1098, 1104], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [1099, 1103], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1100, 1102], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1110, 1129], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1111, 1129], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [1112, 1129], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1113, 1129], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1124, 1129], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [1125, 1125], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1127, 1127], 'children': []}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1130, 1135], 'children': [{'type': 'AssertStatement', 'name': 'assert', 'range': [1130, 1135], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1131, 1134], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1131, 1131], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1134, 1134], 'children': []}]}]}]}]}]}]}
2025-01-08 10:23:15,188 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:17,849 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [0, 53], 'children': [{'type': 'ImportDeclaration', 'name': 'io', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'io', 'range': [0, 2], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'unittest.mock', 'range': [3, 7], 'children': [{'type': 'ImportSpecifier', 'name': 'unittest', 'range': [3, 4], 'children': []}, {'type': 'ImportSpecifier', 'name': 'mock', 'range': [5, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'fastapi', 'range': [9, 11], 'children': [{'type': 'ImportSpecifier', 'name': 'fastapi', 'range': [9, 11], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'pytest', 'range': [12, 14], 'children': [{'type': 'ImportSpecifier', 'name': 'pytest', 'range': [12, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'starlette.datastructures', 'range': [15, 19], 'children': [{'type': 'ImportSpecifier', 'name': 'starlette', 'range': [15, 16], 'children': []}, {'type': 'ImportSpecifier', 'name': 'datastructures', 'range': [17, 19], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'backend.server.v2.store.exceptions', 'range': [21, 31], 'children': [{'type': 'ImportSpecifier', 'name': 'backend', 'range': [21, 22], 'children': []}, {'type': 'ImportSpecifier', 'name': 'server', 'range': [23, 24], 'children': []}, {'type': 'ImportSpecifier', 'name': 'v2', 'range': [25, 26], 'children': []}, {'type': 'ImportSpecifier', 'name': 'store', 'range': [27, 28], 'children': []}, {'type': 'ImportSpecifier', 'name': 'exceptions', 'range': [29, 31], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'backend.server.v2.store.media', 'range': [32, 42], 'children': [{'type': 'ImportSpecifier', 'name': 'backend', 'range': [32, 33], 'children': []}, {'type': 'ImportSpecifier', 'name': 'server', 'range': [34, 35], 'children': []}, {'type': 'ImportSpecifier', 'name': 'v2', 'range': [36, 37], 'children': []}, {'type': 'ImportSpecifier', 'name': 'store', 'range': [38, 39], 'children': []}, {'type': 'ImportSpecifier', 'name': 'media', 'range': [40, 42], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'Settings', 'range': [43, 51], 'children': [{'type': 'ImportSpecifier', 'name': 'backend', 'range': [43, 44], 'children': []}, {'type': 'ImportSpecifier', 'name': 'util', 'range': [45, 46], 'children': []}, {'type': 'ImportSpecifier', 'name': 'settings', 'range': [47, 48], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Settings', 'range': [49, 51], 'children': []}]}]}
2025-01-08 10:23:17,850 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:20,358 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [102, 182], 'children': [{'type': 'FunctionDeclaration', 'name': 'mock_storage_client', 'range': [107, 182], 'children': [{'type': 'VariableDeclaration', 'name': 'mock_client', 'range': [114, 122], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [115, 122], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [116, 122], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'mock_bucket', 'range': [124, 132], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [125, 132], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [126, 132], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'mock_blob', 'range': [134, 142], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [135, 142], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [136, 142], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [145, 152], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [150, 152], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [146, 149], 'children': [{'type': 'Identifier', 'name': 'mock_client', 'range': [145, 146], 'children': []}, {'type': 'Identifier', 'name': 'bucket', 'range': [147, 148], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [149, 149], 'children': []}]}, {'type': 'Identifier', 'name': 'mock_bucket', 'range': [151, 152], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [153, 160], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [158, 160], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [154, 157], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [153, 154], 'children': []}, {'type': 'Identifier', 'name': 'blob', 'range': [155, 156], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [157, 157], 'children': []}]}, {'type': 'Identifier', 'name': 'mock_blob', 'range': [159, 160], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [161, 166], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [164, 166], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [162, 163], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [161, 162], 'children': []}, {'type': 'Identifier', 'name': 'public_url', 'range': [163, 163], 'children': []}]}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [165, 166], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [168, 178], 'children': [{'type': 'CallExpression', 'name': 'patch', 'range': [170, 178], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [169, 170], 'children': [{'type': 'Identifier', 'name': 'mocker', 'range': [168, 169], 'children': []}, {'type': 'Identifier', 'name': 'patch', 'range': [170, 170], 'children': []}]}, {'type': 'Literal', 'name': '"google.cloud.storage.Client"', 'range': [172, 173], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [175, 176], 'children': [{'type': 'Identifier', 'name': 'return_value', 'range': [174, 175], 'children': []}, {'type': 'Identifier', 'name': 'mock_client', 'range': [176, 176], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [180, 182], 'children': [{'type': 'Identifier', 'name': 'mock_client', 'range': [181, 182], 'children': []}]}]}]}
2025-01-08 10:23:20,358 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:21,377 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_video_type', 'range': [547, 653], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_video_type', 'range': [547, 653], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [550, 554], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [551, 551], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [553, 553], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [555, 653], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [557, 600], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [558, 600], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [559, 600], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [562, 600], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [564, 566], 'children': [{'type': 'StringLiteral', 'name': '"test.mp4"', 'range': [566, 566], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'file', 'range': [569, 577], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [571, 577], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [574, 577], 'children': [{'type': 'BytesLiteral', 'name': 'b"\\x00\\x00\\x00\\x18ftypmp42"', 'range': [575, 576], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [584, 597], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [586, 597], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [591, 597], 'children': [{'type': 'ObjectLiteral', 'name': '{"content-type":"video/mp4"}', 'range': [592, 596], 'children': []}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [603, 622], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [604, 622], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [605, 622], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [606, 622], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [617, 622], 'children': [{'type': 'StringLiteral', 'name': '"test-user"', 'range': [618, 618], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [620, 620], 'children': []}]}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [624, 629], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [626, 628], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [625, 625], 'children': []}, {'type': 'StringLiteral', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [628, 628], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_bucket', 'range': [630, 637], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [631, 637], 'children': [{'type': 'MemberExpression', 'name': 'mock_storage_client.bucket.return_value', 'range': [632, 636], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob', 'range': [638, 645], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [639, 645], 'children': [{'type': 'MemberExpression', 'name': 'mock_bucket.blob.return_value', 'range': [640, 644], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob.upload_from_string.assert_called_once', 'range': [646, 653], 'children': [{'type': 'CallExpression', 'name': 'assert_called_once', 'range': [648, 653], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [651, 653], 'children': []}]}]}]}]}]}
2025-01-08 10:23:21,378 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:22,846 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_missing_credentials', 'range': [418, 546], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_missing_credentials', 'range': [418, 546], 'children': [{'type': 'VariableDeclaration', 'name': 'settings', 'range': [426, 430], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [427, 430], 'children': [{'type': 'CallExpression', 'name': 'Settings', 'range': [428, 430], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': '', 'range': [432, 446], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.media_gcs_bucket_name', 'range': [432, 436], 'children': []}, {'type': 'Literal', 'name': '', 'range': [437, 438], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '', 'range': [440, 446], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.google_application_credentials', 'range': [440, 444], 'children': []}, {'type': 'Literal', 'name': '', 'range': [445, 446], 'children': []}]}, {'type': 'CallExpression', 'name': 'monkeypatch.setattr', 'range': [448, 457], 'children': [{'type': 'Literal', 'name': '"backend.server.v2.store.media.Settings"', 'range': [452, 452], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [454, 457], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [456, 456], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'test_file', 'range': [460, 506], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [461, 506], 'children': [{'type': 'CallExpression', 'name': 'fastapi.UploadFile', 'range': [462, 506], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [467, 469], 'children': [{'type': 'Literal', 'name': '"laptop.jpeg"', 'range': [469, 469], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'file', 'range': [472, 483], 'children': [{'type': 'CallExpression', 'name': 'io.BytesIO', 'range': [474, 483], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [478, 482], 'children': [{'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [479, 479], 'children': []}, {'type': 'Literal', 'name': 'b"test data"', 'range': [482, 482], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [490, 503], 'children': [{'type': 'CallExpression', 'name': 'starlette.datastructures.Headers', 'range': [492, 503], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [498, 502], 'children': [{'type': 'Property', 'name': '"content-type"', 'range': [499, 501], 'children': [{'type': 'Literal', 'name': '"image/jpeg"', 'range': [501, 501], 'children': []}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [509, 545], 'children': [{'type': 'CallExpression', 'name': 'pytest.raises', 'range': [510, 525], 'children': [{'type': 'MemberExpression', 'name': 'backend.server.v2.store.exceptions.StorageConfigError', 'range': [514, 524], 'children': []}]}, {'type': 'AwaitExpression', 'name': '', 'range': [528, 544], 'children': [{'type': 'CallExpression', 'name': 'backend.server.v2.store.media.upload_media', 'range': [529, 544], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [541, 541], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [543, 543], 'children': []}]}]}]}]}]}
2025-01-08 10:23:22,846 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:24,205 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [0, 53], 'children': [{'type': 'ImportDeclaration', 'name': 'io', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': 'unittest.mock', 'range': [3, 7], 'children': []}, {'type': 'ImportDeclaration', 'name': 'fastapi', 'range': [9, 11], 'children': []}, {'type': 'ImportDeclaration', 'name': 'pytest', 'range': [12, 14], 'children': []}, {'type': 'ImportDeclaration', 'name': 'starlette.datastructures', 'range': [15, 19], 'children': []}, {'type': 'ImportDeclaration', 'name': 'backend.server.v2.store.exceptions', 'range': [21, 31], 'children': []}, {'type': 'ImportDeclaration', 'name': 'backend.server.v2.store.media', 'range': [32, 42], 'children': []}, {'type': 'ImportDeclaration', 'name': 'Settings', 'range': [43, 51], 'children': []}]}
2025-01-08 10:23:24,205 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:27,709 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_png_success', 'range': [889, 971], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_png_success', 'range': [889, 971], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_png_success', 'range': [889, 897], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [889, 894], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [890, 893], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_png_success', 'range': [891, 920], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [892, 896], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [893, 906], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [895, 914], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [898, 971], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [899, 942], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [899, 908], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [900, 901], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [901, 942], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [901, 908], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [903, 912], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [904, 942], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [906, 908], 'children': [{'type': 'StringLiteral', 'name': '"test.png"', 'range': [908, 918], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [911, 919], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [913, 919], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [913, 915], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [915, 922], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [916, 919], 'children': [{'type': 'BinaryLiteral', 'name': 'b"\\x89PNG\\r\\n\\x1a\\n"', 'range': [917, 918], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [926, 939], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [928, 939], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [928, 937], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [929, 944], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [932, 939], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [933, 939], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [934, 938], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [935, 937], 'children': [{'type': 'StringLiteral', 'name': '"image/png"', 'range': [937, 947], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [945, 964], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [945, 951], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [946, 947], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [947, 952], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [948, 963], 'children': [{'type': 'MemberExpression', 'name': 'backend.server.v2.store.media.upload_media', 'range': [948, 958], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [948, 954], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [949, 955], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [950, 952], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [951, 956], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [952, 957], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [954, 963], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [959, 963], 'children': [{'type': 'StringLiteral', 'name': '"test-user"', 'range': [960, 970], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [962, 971], 'children': []}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [965, 970], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [965, 971], 'children': []}, {'type': 'BinaryExpression', 'name': '==', 'range': [967, 968], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [965, 971], 'children': []}, {'type': 'StringLiteral', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [969, 1001], 'children': []}]}]}]}]}]}
2025-01-08 10:23:27,710 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:28,501 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_gif_success', 'range': [972, 1053], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_gif_success', 'range': [972, 1053], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_gif_success', 'range': [972, 980], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [972, 976], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [973, 976], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_gif_success', 'range': [974, 1006], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [975, 979], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [976, 988], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [978, 998], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [981, 1053], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [982, 1025], 'children': [{'type': 'Assignment', 'name': '=', 'range': [983, 984], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [984, 1025], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [984, 991], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [986, 995], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [987, 1025], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [989, 991], 'children': [{'type': 'StringLiteral', 'name': '"test.gif"', 'range': [991, 999], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [994, 996], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [996, 1002], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [996, 998], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [998, 1004], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [999, 1002], 'children': [{'type': 'BinaryExpression', 'name': 'b', 'range': [1000, 1001], 'children': [{'type': 'StringLiteral', 'name': '"GIF89a"', 'range': [1001, 1007], 'children': []}]}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [1009, 1010], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [1011, 1022], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [1011, 1019], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [1012, 1024], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [1015, 1021], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1016, 1022], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [1017, 1021], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1018, 1020], 'children': [{'type': 'StringLiteral', 'name': '"image/gif"', 'range': [1020, 1028], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'result', 'range': [1028, 1047], 'children': [{'type': 'Assignment', 'name': '=', 'range': [1029, 1030], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1030, 1031], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1031, 1046], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [1031, 1041], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [1031, 1037], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [1032, 1038], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [1033, 1035], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [1034, 1040], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [1035, 1041], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [1037, 1045], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [1042, 1046], 'children': [{'type': 'StringLiteral', 'name': '"test-user"', 'range': [1043, 1051], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1045, 1053], 'children': []}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [1048, 1053], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1049, 1051], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1049, 1055], 'children': []}, {'type': 'StringLiteral', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1051, 1087], 'children': []}]}]}]}]}]}
2025-01-08 10:23:28,501 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:29,447 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_success', 'range': [183, 303], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_success', 'range': [183, 303], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [186, 190], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [187, 187], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [189, 189], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [192, 303], 'children': [{'type': 'Comment', 'name': 'Create test JPEG data with valid signature', 'range': [193, 201], 'children': []}, {'type': 'VariableDeclaration', 'name': 'test_data', 'range': [202, 209], 'children': [{'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [204, 205], 'children': []}, {'type': 'Literal', 'name': 'b"test data"', 'range': [207, 208], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'test_file', 'range': [211, 250], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [213, 249], 'children': [{'type': 'Argument', 'name': 'filename="laptop.jpeg"', 'range': [218, 220], 'children': []}, {'type': 'Argument', 'name': 'file=io.BytesIO(test_data)', 'range': [223, 230], 'children': []}, {'type': 'Argument', 'name': 'headers=starlette.datastructures.Headers({"content-type": "image/jpeg"})', 'range': [233, 246], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'result', 'range': [252, 271], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [255, 270], 'children': [{'type': 'Argument', 'name': '"test-user"', 'range': [267, 267], 'children': []}, {'type': 'Argument', 'name': 'test_file', 'range': [269, 269], 'children': []}]}]}, {'type': 'AssertStatement', 'name': 'assert result == "http://test-url/media/laptop.jpeg"', 'range': [273, 278], 'children': []}, {'type': 'VariableDeclaration', 'name': 'mock_bucket', 'range': [279, 286], 'children': [{'type': 'MemberExpression', 'name': 'mock_storage_client.bucket.return_value', 'range': [281, 285], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'mock_blob', 'range': [287, 294], 'children': [{'type': 'MemberExpression', 'name': 'mock_bucket.blob.return_value', 'range': [289, 293], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob.upload_from_string.assert_called_once()', 'range': [295, 302], 'children': []}]}]}]}
2025-01-08 10:23:29,447 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:29,915 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_file_too_large', 'range': [654, 772], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_file_too_large', 'range': [654, 772], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_file_too_large', 'range': [654, 662], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [654, 658], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [655, 658], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_file_too_large', 'range': [656, 689], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [657, 658], 'children': []}, {'type': 'Identifier', 'name': 'mock_settings', 'range': [658, 671], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [659, 660], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [660, 680], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [661, 662], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [662, 663], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [663, 772], 'children': [{'type': 'VariableDeclaration', 'name': 'large_data', 'range': [664, 682], 'children': [{'type': 'Identifier', 'name': 'large_data', 'range': [664, 674], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [665, 666], 'children': []}, {'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [666, 677], 'children': []}, {'type': 'Operator', 'name': '+', 'range': [668, 669], 'children': []}, {'type': 'Literal', 'name': 'b"x"', 'range': [669, 672], 'children': []}, {'type': 'Operator', 'name': '*', 'range': [671, 672], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [672, 673], 'children': []}, {'type': 'Literal', 'name': '50', 'range': [674, 676], 'children': []}, {'type': 'Operator', 'name': '*', 'range': [675, 676], 'children': []}, {'type': 'Literal', 'name': '1024', 'range': [676, 680], 'children': []}, {'type': 'Operator', 'name': '*', 'range': [677, 678], 'children': []}, {'type': 'Literal', 'name': '1024', 'range': [678, 682], 'children': []}, {'type': 'Operator', 'name': '+', 'range': [679, 680], 'children': []}, {'type': 'Literal', 'name': '1', 'range': [680, 681], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [682, 683], 'children': []}]}, {'type': 'Comment', 'name': '# 50 MB + 1 byte with valid JPEG signature', 'range': [683, 693], 'children': []}, {'type': 'VariableDeclaration', 'name': 'test_file', 'range': [694, 732], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [694, 703], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [695, 696], 'children': []}, {'type': 'Identifier', 'name': 'fastapi.UploadFile', 'range': [696, 711], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [699, 700], 'children': []}, {'type': 'KeywordArgument', 'name': 'filename="laptop.jpeg"', 'range': [701, 714], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [705, 706], 'children': []}, {'type': 'KeywordArgument', 'name': 'file=io.BytesIO(large_data)', 'range': [706, 730], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [715, 716], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers=starlette.datastructures.Headers({"content-type": "image/jpeg"})', 'range': [716, 732], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [732, 733], 'children': []}]}, {'type': 'WithStatement', 'name': 'with pytest.raises(backend.server.v2.store.exceptions.FileSizeTooLargeError):', 'range': [735, 771], 'children': [{'type': 'Identifier', 'name': 'pytest.raises', 'range': [736, 751], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [739, 740], 'children': []}, {'type': 'Identifier', 'name': 'backend.server.v2.store.exceptions.FileSizeTooLargeError', 'range': [740, 751], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [751, 752], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [752, 753], 'children': []}, {'type': 'Block', 'name': 'WithBody', 'range': [753, 771], 'children': [{'type': 'ExpressionStatement', 'name': 'await backend.server.v2.store.media.upload_media("test-user", test_file)', 'range': [754, 771], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [754, 759], 'children': []}, {'type': 'Identifier', 'name': 'backend.server.v2.store.media.upload_media', 'range': [755, 770], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [766, 767], 'children': []}, {'type': 'Literal', 'name': '"test-user"', 'range': [767, 778], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [768, 769], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [769, 778], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [770, 771], 'children': []}]}]}]}]}]}]}
2025-01-08 10:23:29,916 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:30,907 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [0, 53], 'children': [{'type': 'ImportDeclaration', 'name': 'io', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': 'unittest.mock', 'range': [3, 7], 'children': []}, {'type': 'ImportDeclaration', 'name': 'fastapi', 'range': [9, 11], 'children': []}, {'type': 'ImportDeclaration', 'name': 'pytest', 'range': [12, 14], 'children': []}, {'type': 'ImportDeclaration', 'name': 'starlette.datastructures', 'range': [15, 19], 'children': []}, {'type': 'ImportDeclaration', 'name': 'backend.server.v2.store.exceptions', 'range': [21, 31], 'children': []}, {'type': 'ImportDeclaration', 'name': 'backend.server.v2.store.media', 'range': [32, 42], 'children': []}, {'type': 'ImportDeclaration', 'name': 'Settings', 'range': [43, 51], 'children': []}]}
2025-01-08 10:23:30,907 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:23:32,269 - INFO - Step 3 result: {'type': 'Program', 'name': 'mock_settings', 'range': [59, 101], 'children': [{'type': 'FunctionDeclaration', 'name': 'mock_settings', 'range': [59, 101], 'children': [{'type': 'Parameter', 'name': 'monkeypatch', 'range': [62, 62], 'children': []}, {'type': 'BlockStatement', 'range': [64, 101], 'children': [{'type': 'VariableDeclaration', 'name': 'settings', 'range': [66, 70], 'children': [{'type': 'AssignmentExpression', 'range': [67, 70], 'children': [{'type': 'NewExpression', 'name': 'Settings', 'range': [68, 70], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [72, 78], 'children': [{'type': 'AssignmentExpression', 'range': [77, 78], 'children': [{'type': 'MemberExpression', 'range': [72, 76], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [72, 72], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [74, 74], 'children': []}, {'type': 'Identifier', 'name': 'media_gcs_bucket_name', 'range': [76, 76], 'children': []}]}, {'type': 'Literal', 'value': 'test-bucket', 'range': [78, 78], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [80, 86], 'children': [{'type': 'AssignmentExpression', 'range': [85, 86], 'children': [{'type': 'MemberExpression', 'range': [80, 84], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [80, 80], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [82, 82], 'children': []}, {'type': 'Identifier', 'name': 'google_application_credentials', 'range': [84, 84], 'children': []}]}, {'type': 'Literal', 'value': 'test-credentials', 'range': [86, 86], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [88, 97], 'children': [{'type': 'CallExpression', 'range': [90, 97], 'children': [{'type': 'MemberExpression', 'range': [88, 90], 'children': [{'type': 'Identifier', 'name': 'monkeypatch', 'range': [88, 88], 'children': []}, {'type': 'Identifier', 'name': 'setattr', 'range': [90, 90], 'children': []}]}, {'type': 'Literal', 'value': 'backend.server.v2.store.media.Settings', 'range': [92, 92], 'children': []}, {'type': 'ArrowFunctionExpression', 'range': [94, 97], 'children': [{'type': 'BlockStatement', 'range': [96, 97], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [96, 96], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'range': [99, 100], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [100, 100], 'children': []}]}]}]}]}
2025-01-08 10:23:32,269 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:32,512 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_webm_success', 'range': [1136, 1217], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_webm_success', 'range': [1136, 1217], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1139, 1143], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1140, 1140], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1142, 1142], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1144, 1217], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1146, 1189], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1147, 1189], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1148, 1189], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1151, 1189], 'children': [{'type': 'Argument', 'name': 'filename', 'range': [1153, 1155], 'children': []}, {'type': 'Argument', 'name': 'file', 'range': [1158, 1166], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1160, 1166], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1163, 1166], 'children': [{'type': 'Argument', 'name': 'b', 'range': [1164, 1165], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'headers', 'range': [1173, 1186], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1175, 1186], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1180, 1186], 'children': [{'type': 'Argument', 'name': '', 'range': [1181, 1185], 'children': []}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [1192, 1210], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1193, 1210], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [1194, 1210], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1195, 1210], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1206, 1210], 'children': [{'type': 'Argument', 'name': '"test-user"', 'range': [1207, 1207], 'children': []}, {'type': 'Argument', 'name': 'test_file', 'range': [1209, 1209], 'children': []}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'assert', 'range': [1212, 1216], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1213, 1216], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1213, 1213], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1215, 1216], 'children': []}]}]}]}]}]}
2025-01-08 10:23:32,513 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:32,664 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_file_read_error', 'range': [773, 888], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_file_read_error', 'range': [773, 888], 'children': [{'type': 'ParameterList', 'name': '', 'range': [776, 780], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [777, 777], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [779, 779], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [781, 888], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [783, 831], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [784, 831], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [785, 831], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [788, 831], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [790, 792], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [795, 803], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [815, 828], 'children': []}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [833, 850], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [834, 850], 'children': [{'type': 'MemberExpression', 'name': 'read', 'range': [834, 835], 'children': []}, {'type': 'CallExpression', 'name': 'AsyncMock', 'range': [837, 849], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [842, 849], 'children': [{'type': 'KeywordArgument', 'name': 'side_effect', 'range': [843, 848], 'children': []}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [852, 888], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [853, 868], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [856, 868], 'children': [{'type': 'Identifier', 'name': 'FileReadError', 'range': [867, 867], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [869, 888], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [871, 888], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [871, 887], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [872, 887], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [883, 887], 'children': [{'type': 'StringLiteral', 'name': 'test-user', 'range': [884, 884], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [886, 886], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:23:32,664 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:34,807 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_invalid_signature', 'range': [1315, 1403], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_invalid_signature', 'range': [1315, 1403], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [1318, 1322], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1319, 1319], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1321, 1321], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [1324, 1403], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1325, 1364], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1326, 1364], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1327, 1364], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1330, 1364], 'children': [{'type': 'Argument', 'name': 'filename', 'range': [1332, 1334], 'children': []}, {'type': 'Argument', 'name': 'file', 'range': [1337, 1345], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1339, 1345], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1342, 1345], 'children': [{'type': 'Argument', 'name': 'b', 'range': [1343, 1344], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'headers', 'range': [1348, 1361], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1350, 1361], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1355, 1361], 'children': [{'type': 'ObjectExpression', 'name': 'headers', 'range': [1356, 1360], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1357, 1359], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': 'with', 'range': [1367, 1403], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [1368, 1383], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1371, 1383], 'children': [{'type': 'Argument', 'name': 'InvalidFileTypeError', 'range': [1372, 1382], 'children': []}]}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [1385, 1403], 'children': [{'type': 'ExpressionStatement', 'name': 'await', 'range': [1386, 1402], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1387, 1402], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1398, 1402], 'children': [{'type': 'Argument', 'name': 'test-user', 'range': [1399, 1399], 'children': []}, {'type': 'Argument', 'name': 'test_file', 'range': [1401, 1401], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:23:34,808 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:36,052 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_mismatched_signature', 'range': [1218, 1314], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_mismatched_signature', 'range': [1218, 1314], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1221, 1225], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1222, 1222], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1224, 1224], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1226, 1314], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1228, 1274], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1229, 1274], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1230, 1274], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1233, 1274], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [1235, 1237], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [1240, 1248], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1242, 1248], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1245, 1248], 'children': [{'type': 'Literal', 'name': 'b"\\x89PNG\\r\\n\\x1a\\n"', 'range': [1246, 1247], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [1258, 1271], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1260, 1271], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1265, 1271], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1266, 1270], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1267, 1269], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [1277, 1313], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [1278, 1293], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1281, 1293], 'children': [{'type': 'MemberExpression', 'name': 'InvalidFileTypeError', 'range': [1282, 1292], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [1294, 1313], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [1296, 1312], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [1296, 1312], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1297, 1312], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1308, 1312], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [1309, 1309], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1311, 1311], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:23:36,053 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:37,609 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [0, 53], 'children': [{'type': 'ImportDeclaration', 'name': 'io', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': 'unittest.mock', 'range': [3, 7], 'children': []}, {'type': 'ImportDeclaration', 'name': 'fastapi', 'range': [9, 11], 'children': []}, {'type': 'ImportDeclaration', 'name': 'pytest', 'range': [12, 14], 'children': []}, {'type': 'ImportDeclaration', 'name': 'starlette.datastructures', 'range': [15, 19], 'children': []}, {'type': 'ImportDeclaration', 'name': 'backend.server.v2.store.exceptions', 'range': [21, 31], 'children': []}, {'type': 'ImportDeclaration', 'name': 'backend.server.v2.store.media', 'range': [32, 42], 'children': []}, {'type': 'ImportDeclaration', 'name': 'Settings', 'range': [43, 51], 'children': []}]}
2025-01-08 10:23:37,610 - INFO - Completed main AST analysis flow
2025-01-08 10:23:37,610 - INFO - Successfully processed chunk
2025-01-08 10:23:37,616 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_webp_success', 'range': [1054, 1135], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_webp_success', 'range': [1054, 1135], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1057, 1061], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1058, 1058], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1060, 1060], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1062, 1135], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1064, 1107], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1065, 1107], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1066, 1107], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1069, 1107], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [1071, 1073], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [1076, 1084], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1078, 1084], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1081, 1084], 'children': [{'type': 'Literal', 'name': 'b"RIFF\\x00\\x00\\x00\\x00WEBP"', 'range': [1082, 1083], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [1091, 1104], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1093, 1104], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1098, 1104], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [1099, 1103], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1100, 1102], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1110, 1129], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1111, 1129], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [1112, 1129], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1113, 1129], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1124, 1129], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [1125, 1125], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1127, 1127], 'children': []}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1130, 1135], 'children': [{'type': 'AssertStatement', 'name': 'assert', 'range': [1130, 1135], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1131, 1134], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1131, 1131], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1134, 1134], 'children': []}]}]}]}]}]}]}
2025-01-08 10:23:37,616 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:41,754 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_upload_media_invalid_type', 'range': [304, 417], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_invalid_type', 'range': [304, 392], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [304, 308], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [305, 308], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_invalid_type', 'range': [306, 334], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [307, 311], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [308, 321], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [310, 330], 'children': []}]}, {'type': 'Block', 'name': '', 'range': [312, 392], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [314, 353], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [314, 323], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [315, 316], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [316, 353], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [316, 323], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [318, 327], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [319, 353], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [321, 332], 'children': [{'type': 'StringLiteral', 'name': '"test.txt"', 'range': [323, 332], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [326, 334], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [328, 334], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [328, 330], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [330, 337], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [331, 334], 'children': [{'type': 'BinaryExpression', 'name': 'b', 'range': [332, 333], 'children': [{'type': 'StringLiteral', 'name': '"test data"', 'range': [333, 344], 'children': []}]}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [337, 350], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [339, 350], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [339, 348], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [340, 353], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [343, 350], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [344, 350], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [345, 349], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [346, 348], 'children': [{'type': 'StringLiteral', 'name': '"text/plain"', 'range': [348, 359], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [356, 392], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [357, 372], 'children': [{'type': 'Identifier', 'name': 'pytest', 'range': [357, 363], 'children': []}, {'type': 'Identifier', 'name': 'raises', 'range': [359, 365], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [360, 372], 'children': [{'type': 'Identifier', 'name': 'InvalidFileTypeError', 'range': [361, 380], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [361, 368], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [362, 368], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [364, 366], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [366, 371], 'children': []}, {'type': 'Identifier', 'name': 'exceptions', 'range': [369, 379], 'children': []}, {'type': 'Identifier', 'name': 'InvalidFileTypeError', 'range': [371, 392], 'children': []}]}]}]}, {'type': 'Block', 'name': '', 'range': [373, 392], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [375, 392], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [375, 392], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [376, 391], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [376, 383], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [377, 383], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [379, 381], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [381, 386], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [383, 388], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [386, 398], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [387, 391], 'children': [{'type': 'StringLiteral', 'name': '"test-user"', 'range': [388, 399], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [390, 399], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [394, 417], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [395, 396], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [394, 405], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [396, 401], 'children': [{'type': 'Identifier', 'name': 'mock_storage_client', 'range': [396, 414], 'children': []}, {'type': 'Identifier', 'name': 'bucket', 'range': [397, 403], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [399, 411], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [402, 417], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [403, 404], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [402, 411], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [404, 409], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [404, 415], 'children': []}, {'type': 'Identifier', 'name': 'blob', 'range': [405, 409], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [407, 419], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [410, 417], 'children': [{'type': 'CallExpression', 'name': 'assert_not_called', 'range': [411, 416], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [410, 419], 'children': []}, {'type': 'Identifier', 'name': 'upload_from_string', 'range': [412, 430], 'children': []}, {'type': 'Identifier', 'name': 'assert_not_called', 'range': [414, 430], 'children': []}]}]}]}
2025-01-08 10:23:41,755 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:45,425 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [102, 182], 'children': [{'type': 'FunctionDeclaration', 'name': 'mock_storage_client', 'range': [107, 182], 'children': [{'type': 'VariableDeclaration', 'name': 'mock_client', 'range': [114, 122], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [115, 122], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [116, 122], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'mock_bucket', 'range': [124, 132], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [125, 132], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [126, 132], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'mock_blob', 'range': [134, 142], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [135, 142], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [136, 142], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [145, 152], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [150, 152], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [146, 149], 'children': [{'type': 'Identifier', 'name': 'mock_client', 'range': [145, 146], 'children': []}, {'type': 'Identifier', 'name': 'bucket', 'range': [147, 148], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [149, 149], 'children': []}]}, {'type': 'Identifier', 'name': 'mock_bucket', 'range': [151, 152], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [153, 160], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [158, 160], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [154, 157], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [153, 154], 'children': []}, {'type': 'Identifier', 'name': 'blob', 'range': [155, 156], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [157, 157], 'children': []}]}, {'type': 'Identifier', 'name': 'mock_blob', 'range': [159, 160], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [161, 166], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [164, 166], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [162, 163], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [161, 162], 'children': []}, {'type': 'Identifier', 'name': 'public_url', 'range': [163, 163], 'children': []}]}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [165, 166], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [168, 178], 'children': [{'type': 'CallExpression', 'name': 'patch', 'range': [170, 178], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [169, 170], 'children': [{'type': 'Identifier', 'name': 'mocker', 'range': [168, 169], 'children': []}, {'type': 'Identifier', 'name': 'patch', 'range': [170, 170], 'children': []}]}, {'type': 'Literal', 'name': '"google.cloud.storage.Client"', 'range': [172, 173], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [175, 176], 'children': [{'type': 'Identifier', 'name': 'return_value', 'range': [174, 175], 'children': []}, {'type': 'Identifier', 'name': 'mock_client', 'range': [176, 176], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [180, 182], 'children': [{'type': 'Identifier', 'name': 'mock_client', 'range': [181, 182], 'children': []}]}]}]}
2025-01-08 10:23:45,425 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:46,887 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_missing_credentials', 'range': [418, 546], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_missing_credentials', 'range': [418, 546], 'children': [{'type': 'VariableDeclaration', 'name': 'settings', 'range': [426, 430], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [427, 430], 'children': [{'type': 'CallExpression', 'name': 'Settings', 'range': [428, 430], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': '', 'range': [432, 446], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.media_gcs_bucket_name', 'range': [432, 436], 'children': []}, {'type': 'Literal', 'name': '', 'range': [437, 438], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '', 'range': [440, 446], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.google_application_credentials', 'range': [440, 444], 'children': []}, {'type': 'Literal', 'name': '', 'range': [445, 446], 'children': []}]}, {'type': 'CallExpression', 'name': 'monkeypatch.setattr', 'range': [448, 457], 'children': [{'type': 'Literal', 'name': '"backend.server.v2.store.media.Settings"', 'range': [452, 452], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [454, 457], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [456, 456], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'test_file', 'range': [460, 506], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [461, 506], 'children': [{'type': 'CallExpression', 'name': 'fastapi.UploadFile', 'range': [462, 506], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [467, 469], 'children': [{'type': 'Literal', 'name': '"laptop.jpeg"', 'range': [469, 469], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'file', 'range': [472, 483], 'children': [{'type': 'CallExpression', 'name': 'io.BytesIO', 'range': [474, 483], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [478, 482], 'children': [{'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [479, 479], 'children': []}, {'type': 'Literal', 'name': 'b"test data"', 'range': [482, 482], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [490, 503], 'children': [{'type': 'CallExpression', 'name': 'starlette.datastructures.Headers', 'range': [492, 503], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [498, 502], 'children': [{'type': 'Property', 'name': '"content-type"', 'range': [499, 501], 'children': [{'type': 'Literal', 'name': '"image/jpeg"', 'range': [501, 501], 'children': []}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [509, 545], 'children': [{'type': 'CallExpression', 'name': 'pytest.raises', 'range': [510, 525], 'children': [{'type': 'MemberExpression', 'name': 'backend.server.v2.store.exceptions.StorageConfigError', 'range': [514, 524], 'children': []}]}, {'type': 'AwaitExpression', 'name': '', 'range': [528, 544], 'children': [{'type': 'CallExpression', 'name': 'backend.server.v2.store.media.upload_media', 'range': [529, 544], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [541, 541], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [543, 543], 'children': []}]}]}]}]}]}
2025-01-08 10:23:46,887 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:47,635 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_success', 'range': [183, 303], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_success', 'range': [183, 303], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [186, 190], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [187, 187], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [189, 189], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [192, 303], 'children': [{'type': 'Comment', 'name': 'Create test JPEG data with valid signature', 'range': [193, 201], 'children': []}, {'type': 'VariableDecl', 'name': 'test_data', 'range': [202, 209], 'children': [{'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [204, 205], 'children': []}, {'type': 'Literal', 'name': 'b"test data"', 'range': [207, 208], 'children': []}]}, {'type': 'VariableDecl', 'name': 'test_file', 'range': [211, 250], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [213, 249], 'children': [{'type': 'Argument', 'name': 'filename="laptop.jpeg"', 'range': [218, 220], 'children': []}, {'type': 'Argument', 'name': 'file=io.BytesIO(test_data)', 'range': [223, 230], 'children': []}, {'type': 'Argument', 'name': 'headers=starlette.datastructures.Headers({"content-type": "image/jpeg"})', 'range': [233, 246], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'result', 'range': [252, 271], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [255, 270], 'children': [{'type': 'Argument', 'name': '"test-user"', 'range': [267, 267], 'children': []}, {'type': 'Argument', 'name': 'test_file', 'range': [269, 269], 'children': []}]}]}, {'type': 'AssertStatement', 'name': 'assert result == "http://test-url/media/laptop.jpeg"', 'range': [273, 278], 'children': []}, {'type': 'VariableDecl', 'name': 'mock_bucket', 'range': [279, 286], 'children': [{'type': 'MemberExpression', 'name': 'mock_storage_client.bucket.return_value', 'range': [281, 285], 'children': []}]}, {'type': 'VariableDecl', 'name': 'mock_blob', 'range': [287, 294], 'children': [{'type': 'MemberExpression', 'name': 'mock_bucket.blob.return_value', 'range': [289, 293], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob.upload_from_string.assert_called_once()', 'range': [295, 302], 'children': []}]}]}]}
2025-01-08 10:23:47,635 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:23:48,305 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_video_type', 'range': [547, 653], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_video_type', 'range': [547, 653], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [550, 554], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [551, 551], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [553, 553], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [555, 653], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [557, 600], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [558, 600], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [559, 600], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [562, 600], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [564, 566], 'children': [{'type': 'StringLiteral', 'name': '"test.mp4"', 'range': [566, 566], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'file', 'range': [569, 577], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [571, 577], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [574, 577], 'children': [{'type': 'BytesLiteral', 'name': 'b"\\x00\\x00\\x00\\x18ftypmp42"', 'range': [575, 576], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [584, 597], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [586, 597], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [591, 597], 'children': [{'type': 'ObjectLiteral', 'name': '{"content-type":"video/mp4"}', 'range': [592, 596], 'children': []}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [603, 622], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [604, 622], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [605, 622], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [606, 622], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [617, 622], 'children': [{'type': 'StringLiteral', 'name': '"test-user"', 'range': [618, 618], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [620, 620], 'children': []}]}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [624, 629], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [626, 628], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [625, 625], 'children': []}, {'type': 'StringLiteral', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [628, 628], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_bucket', 'range': [630, 637], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [631, 637], 'children': [{'type': 'MemberExpression', 'name': 'mock_storage_client.bucket.return_value', 'range': [632, 636], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob', 'range': [638, 645], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [639, 645], 'children': [{'type': 'MemberExpression', 'name': 'mock_bucket.blob.return_value', 'range': [640, 644], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob.upload_from_string.assert_called_once', 'range': [646, 653], 'children': [{'type': 'CallExpression', 'name': 'assert_called_once', 'range': [648, 653], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [651, 653], 'children': []}]}]}]}]}]}
2025-01-08 10:23:48,305 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:50,014 - INFO - Step 4 result: {'type': 'Program', 'name': 'mock_settings', 'range': [59, 101], 'children': [{'type': 'FunctionDecl', 'name': 'mock_settings', 'range': [59, 101], 'children': [{'type': 'Parameter', 'name': 'monkeypatch', 'range': [62, 62], 'children': []}, {'type': 'BlockStatement', 'range': [64, 101], 'children': [{'type': 'VariableDecl', 'name': 'settings', 'range': [66, 70], 'children': [{'type': 'AssignmentExpression', 'range': [67, 70], 'children': [{'type': 'NewExpression', 'name': 'Settings', 'range': [68, 70], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [72, 78], 'children': [{'type': 'AssignmentExpression', 'range': [77, 78], 'children': [{'type': 'MemberExpression', 'range': [72, 76], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [72, 72], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [74, 74], 'children': []}, {'type': 'Identifier', 'name': 'media_gcs_bucket_name', 'range': [76, 76], 'children': []}]}, {'type': 'Literal', 'value': 'test-bucket', 'range': [78, 78], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [80, 86], 'children': [{'type': 'AssignmentExpression', 'range': [85, 86], 'children': [{'type': 'MemberExpression', 'range': [80, 84], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [80, 80], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [82, 82], 'children': []}, {'type': 'Identifier', 'name': 'google_application_credentials', 'range': [84, 84], 'children': []}]}, {'type': 'Literal', 'value': 'test-credentials', 'range': [86, 86], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [88, 97], 'children': [{'type': 'CallExpression', 'range': [90, 97], 'children': [{'type': 'MemberExpression', 'range': [88, 90], 'children': [{'type': 'Identifier', 'name': 'monkeypatch', 'range': [88, 88], 'children': []}, {'type': 'Identifier', 'name': 'setattr', 'range': [90, 90], 'children': []}]}, {'type': 'Literal', 'value': 'backend.server.v2.store.media.Settings', 'range': [92, 92], 'children': []}, {'type': 'ArrowFunctionExpression', 'range': [94, 97], 'children': [{'type': 'BlockStatement', 'range': [96, 97], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [96, 96], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'range': [99, 100], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [100, 100], 'children': []}]}]}]}]}
2025-01-08 10:23:50,014 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:23:51,766 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_file_read_error', 'range': [773, 888], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_file_read_error', 'range': [773, 888], 'children': [{'type': 'ParameterList', 'name': '', 'range': [776, 780], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [777, 777], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [779, 779], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [781, 888], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [783, 831], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [784, 831], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [785, 831], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [788, 831], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [790, 792], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [795, 803], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [815, 828], 'children': []}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [833, 850], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [834, 850], 'children': [{'type': 'MemberExpression', 'name': 'read', 'range': [834, 835], 'children': []}, {'type': 'CallExpression', 'name': 'AsyncMock', 'range': [837, 849], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [842, 849], 'children': [{'type': 'KeywordArgument', 'name': 'side_effect', 'range': [843, 848], 'children': []}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [852, 888], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [853, 868], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [856, 868], 'children': [{'type': 'Identifier', 'name': 'FileReadError', 'range': [867, 867], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [869, 888], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [871, 888], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [871, 887], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [872, 887], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [883, 887], 'children': [{'type': 'StringLiteral', 'name': 'test-user', 'range': [884, 884], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [886, 886], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:23:51,766 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:23:52,774 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_webm_success', 'range': [1136, 1217], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_webm_success', 'range': [1136, 1217], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1139, 1143], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1140, 1140], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1142, 1142], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1144, 1217], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1146, 1189], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1147, 1189], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1148, 1189], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1151, 1189], 'children': [{'type': 'Argument', 'name': 'filename', 'range': [1153, 1155], 'children': []}, {'type': 'Argument', 'name': 'file', 'range': [1158, 1166], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1160, 1166], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1163, 1166], 'children': [{'type': 'Argument', 'name': 'b', 'range': [1164, 1165], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'headers', 'range': [1173, 1186], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1175, 1186], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1180, 1186], 'children': [{'type': 'Argument', 'name': '', 'range': [1181, 1185], 'children': []}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [1192, 1210], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1193, 1210], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [1194, 1210], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1195, 1210], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1206, 1210], 'children': [{'type': 'Argument', 'name': '"test-user"', 'range': [1207, 1207], 'children': []}, {'type': 'Argument', 'name': 'test_file', 'range': [1209, 1209], 'children': []}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'assert', 'range': [1212, 1216], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1213, 1216], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1213, 1213], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1215, 1216], 'children': []}]}]}]}]}]}
2025-01-08 10:23:52,774 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:23:53,111 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_file_too_large', 'range': [654, 772], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_file_too_large', 'range': [654, 772], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_file_too_large', 'range': [654, 662], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [654, 658], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [655, 658], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_file_too_large', 'range': [656, 689], 'children': []}, {'type': 'Identifier', 'name': 'mock_settings', 'range': [658, 671], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [660, 680], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [663, 772], 'children': [{'type': 'VariableDeclaration', 'name': 'large_data', 'range': [664, 682], 'children': [{'type': 'Identifier', 'name': 'large_data', 'range': [664, 674], 'children': []}, {'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [666, 677], 'children': []}, {'type': 'Literal', 'name': 'b"x"', 'range': [669, 672], 'children': []}, {'type': 'Literal', 'name': '50', 'range': [674, 676], 'children': []}, {'type': 'Literal', 'name': '1024', 'range': [676, 680], 'children': []}, {'type': 'Literal', 'name': '1024', 'range': [678, 682], 'children': []}, {'type': 'Literal', 'name': '1', 'range': [680, 681], 'children': []}]}, {'type': 'Comment', 'name': '# 50 MB + 1 byte with valid JPEG signature', 'range': [683, 693], 'children': []}, {'type': 'VariableDeclaration', 'name': 'test_file', 'range': [694, 732], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [694, 703], 'children': []}, {'type': 'Identifier', 'name': 'fastapi.UploadFile', 'range': [696, 711], 'children': []}, {'type': 'KeywordArgument', 'name': 'filename="laptop.jpeg"', 'range': [701, 714], 'children': []}, {'type': 'KeywordArgument', 'name': 'file=io.BytesIO(large_data)', 'range': [706, 730], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers=starlette.datastructures.Headers({"content-type": "image/jpeg"})', 'range': [716, 732], 'children': []}]}, {'type': 'WithStatement', 'name': 'with pytest.raises(backend.server.v2.store.exceptions.FileSizeTooLargeError):', 'range': [735, 771], 'children': [{'type': 'Identifier', 'name': 'pytest.raises', 'range': [736, 751], 'children': []}, {'type': 'Identifier', 'name': 'backend.server.v2.store.exceptions.FileSizeTooLargeError', 'range': [740, 751], 'children': []}, {'type': 'Block', 'name': 'WithBody', 'range': [753, 771], 'children': [{'type': 'ExpressionStatement', 'name': 'await backend.server.v2.store.media.upload_media("test-user", test_file)', 'range': [754, 771], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [754, 759], 'children': []}, {'type': 'Identifier', 'name': 'backend.server.v2.store.media.upload_media', 'range': [755, 770], 'children': []}, {'type': 'Literal', 'name': '"test-user"', 'range': [767, 778], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [769, 778], 'children': []}]}]}]}]}]}]}
2025-01-08 10:23:53,111 - INFO - Starting Step 4: AST normalization
2025-01-08 10:23:55,151 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_invalid_signature', 'range': [1315, 1403], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_invalid_signature', 'range': [1315, 1403], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [1318, 1322], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1319, 1319], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1321, 1321], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [1324, 1403], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1325, 1364], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1326, 1364], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1327, 1364], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1330, 1364], 'children': [{'type': 'Identifier', 'name': 'filename', 'range': [1332, 1334], 'children': []}, {'type': 'Identifier', 'name': 'file', 'range': [1337, 1345], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1339, 1345], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1342, 1345], 'children': [{'type': 'Literal', 'name': 'b', 'range': [1343, 1344], 'children': []}]}]}]}, {'type': 'Identifier', 'name': 'headers', 'range': [1348, 1361], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1350, 1361], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1355, 1361], 'children': [{'type': 'ObjectExpression', 'name': 'headers', 'range': [1356, 1360], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1357, 1359], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': 'with', 'range': [1367, 1403], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [1368, 1383], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1371, 1383], 'children': [{'type': 'Identifier', 'name': 'InvalidFileTypeError', 'range': [1372, 1382], 'children': []}]}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [1385, 1403], 'children': [{'type': 'ExpressionStatement', 'name': 'await', 'range': [1386, 1402], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1387, 1402], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1398, 1402], 'children': [{'type': 'Identifier', 'name': 'test-user', 'range': [1399, 1399], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1401, 1401], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:23:55,152 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:23:57,021 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_mismatched_signature', 'range': [1218, 1314], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_mismatched_signature', 'range': [1218, 1314], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1221, 1225], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1222, 1222], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1224, 1224], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1226, 1314], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1228, 1274], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1229, 1274], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1230, 1274], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1233, 1274], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [1235, 1237], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [1240, 1248], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1242, 1248], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1245, 1248], 'children': [{'type': 'Literal', 'name': 'b"\\x89PNG\\r\\n\\x1a\\n"', 'range': [1246, 1247], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [1258, 1271], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1260, 1271], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1265, 1271], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1266, 1270], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1267, 1269], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [1277, 1313], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [1278, 1293], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1281, 1293], 'children': [{'type': 'MemberExpression', 'name': 'InvalidFileTypeError', 'range': [1282, 1292], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [1294, 1313], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [1296, 1312], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [1296, 1312], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1297, 1312], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1308, 1312], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [1309, 1309], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1311, 1311], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:23:57,021 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:23:59,299 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_webp_success', 'range': [1054, 1135], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_webp_success', 'range': [1054, 1135], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1057, 1061], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1058, 1058], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1060, 1060], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1062, 1135], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1064, 1107], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1065, 1107], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1066, 1107], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1069, 1107], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [1071, 1073], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [1076, 1084], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1078, 1084], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1081, 1084], 'children': [{'type': 'Literal', 'name': 'b"RIFF\\x00\\x00\\x00\\x00WEBP"', 'range': [1082, 1083], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [1091, 1104], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1093, 1104], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1098, 1104], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [1099, 1103], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1100, 1102], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1110, 1129], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1111, 1129], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [1112, 1129], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1113, 1129], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1124, 1129], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [1125, 1125], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1127, 1127], 'children': []}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1130, 1135], 'children': [{'type': 'AssertStatement', 'name': 'assert', 'range': [1130, 1135], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1131, 1134], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1131, 1131], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1134, 1134], 'children': []}]}]}]}]}]}]}
2025-01-08 10:23:59,300 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:24:02,102 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_png_success', 'range': [889, 971], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_png_success', 'range': [889, 971], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_png_success', 'range': [889, 897], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [889, 894], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [890, 893], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_png_success', 'range': [891, 920], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [892, 896], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [893, 906], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [895, 914], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [898, 971], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [899, 942], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [899, 908], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [900, 901], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [901, 942], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [901, 908], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [903, 912], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [904, 942], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [906, 908], 'children': [{'type': 'StringLiteral', 'name': '"test.png"', 'range': [908, 918], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [911, 919], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [913, 919], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [913, 915], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [915, 922], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [916, 919], 'children': [{'type': 'BinaryLiteral', 'name': 'b"\\x89PNG\\r\\n\\x1a\\n"', 'range': [917, 918], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [926, 939], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [928, 939], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [928, 937], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [929, 944], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [932, 939], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [933, 939], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [934, 938], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [935, 937], 'children': [{'type': 'StringLiteral', 'name': '"image/png"', 'range': [937, 947], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [945, 964], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [945, 951], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [946, 947], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [947, 952], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [948, 963], 'children': [{'type': 'MemberExpression', 'name': 'backend.server.v2.store.media.upload_media', 'range': [948, 958], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [948, 954], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [949, 955], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [950, 952], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [951, 956], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [952, 957], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [954, 963], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [959, 963], 'children': [{'type': 'StringLiteral', 'name': '"test-user"', 'range': [960, 970], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [962, 971], 'children': []}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [965, 970], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [965, 971], 'children': []}, {'type': 'BinaryExpression', 'name': '==', 'range': [967, 968], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [965, 971], 'children': []}, {'type': 'StringLiteral', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [969, 1001], 'children': []}]}]}]}]}]}
2025-01-08 10:24:02,103 - INFO - Starting Step 4: AST normalization
2025-01-08 10:24:02,872 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_gif_success', 'range': [972, 1053], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_gif_success', 'range': [972, 1053], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_gif_success', 'range': [972, 980], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [972, 976], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [973, 976], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_gif_success', 'range': [974, 1006], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [975, 979], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [976, 988], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [978, 998], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [981, 1053], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [982, 1025], 'children': [{'type': 'Assignment', 'name': '=', 'range': [983, 984], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [984, 1025], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [984, 991], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [986, 995], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [987, 1025], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [989, 991], 'children': [{'type': 'StringLiteral', 'name': '"test.gif"', 'range': [991, 999], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [994, 996], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [996, 1002], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [996, 998], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [998, 1004], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [999, 1002], 'children': [{'type': 'BinaryExpression', 'name': 'b', 'range': [1000, 1001], 'children': [{'type': 'StringLiteral', 'name': '"GIF89a"', 'range': [1001, 1007], 'children': []}]}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [1009, 1010], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [1011, 1022], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [1011, 1019], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [1012, 1024], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [1015, 1021], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1016, 1022], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [1017, 1021], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1018, 1020], 'children': [{'type': 'StringLiteral', 'name': '"image/gif"', 'range': [1020, 1028], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'result', 'range': [1028, 1047], 'children': [{'type': 'Assignment', 'name': '=', 'range': [1029, 1030], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1030, 1031], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1031, 1046], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [1031, 1041], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [1031, 1037], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [1032, 1038], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [1033, 1035], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [1034, 1040], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [1035, 1041], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [1037, 1045], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [1042, 1046], 'children': [{'type': 'StringLiteral', 'name': '"test-user"', 'range': [1043, 1051], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1045, 1053], 'children': []}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [1048, 1053], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1049, 1051], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1049, 1055], 'children': []}, {'type': 'StringLiteral', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1051, 1087], 'children': []}]}]}]}]}]}
2025-01-08 10:24:02,872 - INFO - Starting Step 4: AST normalization
2025-01-08 10:24:05,104 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_success', 'range': [183, 303], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_success', 'range': [183, 303], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [186, 190], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [187, 187], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [189, 189], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [192, 303], 'children': [{'type': 'Comment', 'name': 'Create test JPEG data with valid signature', 'range': [193, 201], 'children': []}, {'type': 'VariableDecl', 'name': 'test_data', 'range': [202, 209], 'children': [{'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [204, 205], 'children': []}, {'type': 'Literal', 'name': 'b"test data"', 'range': [207, 208], 'children': []}]}, {'type': 'VariableDecl', 'name': 'test_file', 'range': [211, 250], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [213, 249], 'children': [{'type': 'Argument', 'name': 'filename="laptop.jpeg"', 'range': [218, 220], 'children': []}, {'type': 'Argument', 'name': 'file=io.BytesIO(test_data)', 'range': [223, 230], 'children': []}, {'type': 'Argument', 'name': 'headers=starlette.datastructures.Headers({"content-type": "image/jpeg"})', 'range': [233, 246], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'result', 'range': [252, 271], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [255, 270], 'children': [{'type': 'Argument', 'name': '"test-user"', 'range': [267, 267], 'children': []}, {'type': 'Argument', 'name': 'test_file', 'range': [269, 269], 'children': []}]}]}, {'type': 'AssertStatement', 'name': 'assert result == "http://test-url/media/laptop.jpeg"', 'range': [273, 278], 'children': []}, {'type': 'VariableDecl', 'name': 'mock_bucket', 'range': [279, 286], 'children': [{'type': 'MemberExpression', 'name': 'mock_storage_client.bucket.return_value', 'range': [281, 285], 'children': []}]}, {'type': 'VariableDecl', 'name': 'mock_blob', 'range': [287, 294], 'children': [{'type': 'MemberExpression', 'name': 'mock_bucket.blob.return_value', 'range': [289, 293], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob.upload_from_string.assert_called_once()', 'range': [295, 302], 'children': []}]}]}]}
2025-01-08 10:24:05,104 - INFO - Completed main AST analysis flow
2025-01-08 10:24:05,105 - INFO - Successfully processed chunk
2025-01-08 10:24:08,849 - INFO - Step 5 result: {'type': 'Program', 'name': 'mock_settings', 'range': [59, 101], 'children': [{'type': 'FunctionDecl', 'name': 'mock_settings', 'range': [59, 101], 'children': [{'type': 'Parameter', 'name': 'monkeypatch', 'range': [62, 62], 'children': []}, {'type': 'BlockStatement', 'range': [64, 101], 'children': [{'type': 'VariableDecl', 'name': 'settings', 'range': [66, 70], 'children': [{'type': 'AssignmentExpression', 'range': [67, 70], 'children': [{'type': 'NewExpression', 'name': 'Settings', 'range': [68, 70], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [72, 78], 'children': [{'type': 'AssignmentExpression', 'range': [77, 78], 'children': [{'type': 'MemberExpression', 'range': [72, 76], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [72, 72], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [74, 74], 'children': []}, {'type': 'Identifier', 'name': 'media_gcs_bucket_name', 'range': [76, 76], 'children': []}]}, {'type': 'Literal', 'value': 'test-bucket', 'range': [78, 78], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [80, 86], 'children': [{'type': 'AssignmentExpression', 'range': [85, 86], 'children': [{'type': 'MemberExpression', 'range': [80, 84], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [80, 80], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [82, 82], 'children': []}, {'type': 'Identifier', 'name': 'google_application_credentials', 'range': [84, 84], 'children': []}]}, {'type': 'Literal', 'value': 'test-credentials', 'range': [86, 86], 'children': []}]}]}, {'type': 'ExpressionStatement', 'range': [88, 97], 'children': [{'type': 'CallExpression', 'range': [90, 97], 'children': [{'type': 'MemberExpression', 'range': [88, 90], 'children': [{'type': 'Identifier', 'name': 'monkeypatch', 'range': [88, 88], 'children': []}, {'type': 'Identifier', 'name': 'setattr', 'range': [90, 90], 'children': []}]}, {'type': 'Literal', 'value': 'backend.server.v2.store.media.Settings', 'range': [92, 92], 'children': []}, {'type': 'ArrowFunctionExpression', 'range': [94, 97], 'children': [{'type': 'BlockStatement', 'range': [96, 97], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [96, 96], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'range': [99, 100], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [100, 100], 'children': []}]}]}]}]}
2025-01-08 10:24:08,849 - INFO - Completed main AST analysis flow
2025-01-08 10:24:08,850 - INFO - Successfully processed chunk
2025-01-08 10:24:10,342 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_file_read_error', 'range': [773, 888], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_file_read_error', 'range': [773, 888], 'children': [{'type': 'ParameterList', 'name': '', 'range': [776, 780], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [777, 777], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [779, 779], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [781, 888], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [783, 831], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [784, 831], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [785, 831], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [788, 831], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [790, 792], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [795, 803], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [815, 828], 'children': []}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [833, 850], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [834, 850], 'children': [{'type': 'MemberExpression', 'name': 'read', 'range': [834, 835], 'children': []}, {'type': 'CallExpression', 'name': 'AsyncMock', 'range': [837, 849], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [842, 849], 'children': [{'type': 'KeywordArgument', 'name': 'side_effect', 'range': [843, 848], 'children': []}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [852, 888], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [853, 868], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [856, 868], 'children': [{'type': 'Identifier', 'name': 'FileReadError', 'range': [867, 867], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [869, 888], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [871, 888], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [871, 887], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [872, 887], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [883, 887], 'children': [{'type': 'StringLiteral', 'name': 'test-user', 'range': [884, 884], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [886, 886], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:24:10,343 - INFO - Completed main AST analysis flow
2025-01-08 10:24:10,343 - INFO - Successfully processed chunk
2025-01-08 10:24:11,205 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_missing_credentials', 'range': [418, 546], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_missing_credentials', 'range': [418, 546], 'children': [{'type': 'VariableDecl', 'name': 'settings', 'range': [426, 430], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [427, 430], 'children': [{'type': 'CallExpression', 'name': 'Settings', 'range': [428, 430], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': '', 'range': [432, 446], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.media_gcs_bucket_name', 'range': [432, 436], 'children': []}, {'type': 'Literal', 'name': '', 'range': [437, 438], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '', 'range': [440, 446], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.google_application_credentials', 'range': [440, 444], 'children': []}, {'type': 'Literal', 'name': '', 'range': [445, 446], 'children': []}]}, {'type': 'CallExpression', 'name': 'monkeypatch.setattr', 'range': [448, 457], 'children': [{'type': 'Literal', 'name': '"backend.server.v2.store.media.Settings"', 'range': [452, 452], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [454, 457], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [456, 456], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'test_file', 'range': [460, 506], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [461, 506], 'children': [{'type': 'CallExpression', 'name': 'fastapi.UploadFile', 'range': [462, 506], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [467, 469], 'children': [{'type': 'Literal', 'name': '"laptop.jpeg"', 'range': [469, 469], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'file', 'range': [472, 483], 'children': [{'type': 'CallExpression', 'name': 'io.BytesIO', 'range': [474, 483], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [478, 482], 'children': [{'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [479, 479], 'children': []}, {'type': 'Literal', 'name': 'b"test data"', 'range': [482, 482], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [490, 503], 'children': [{'type': 'CallExpression', 'name': 'starlette.datastructures.Headers', 'range': [492, 503], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [498, 502], 'children': [{'type': 'Property', 'name': '"content-type"', 'range': [499, 501], 'children': [{'type': 'Literal', 'name': '"image/jpeg"', 'range': [501, 501], 'children': []}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [509, 545], 'children': [{'type': 'CallExpression', 'name': 'pytest.raises', 'range': [510, 525], 'children': [{'type': 'MemberExpression', 'name': 'backend.server.v2.store.exceptions.StorageConfigError', 'range': [514, 524], 'children': []}]}, {'type': 'AwaitExpression', 'name': '', 'range': [528, 544], 'children': [{'type': 'CallExpression', 'name': 'backend.server.v2.store.media.upload_media', 'range': [529, 544], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [541, 541], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [543, 543], 'children': []}]}]}]}]}]}
2025-01-08 10:24:11,205 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:24:11,315 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [102, 182], 'children': [{'type': 'FunctionDecl', 'name': 'mock_storage_client', 'range': [107, 182], 'children': [{'type': 'VariableDecl', 'name': 'mock_client', 'range': [114, 122], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [115, 122], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [116, 122], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'mock_bucket', 'range': [124, 132], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [125, 132], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [126, 132], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'mock_blob', 'range': [134, 142], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [135, 142], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [136, 142], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [145, 152], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [150, 152], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [146, 149], 'children': [{'type': 'Identifier', 'name': 'mock_client', 'range': [145, 146], 'children': []}, {'type': 'Identifier', 'name': 'bucket', 'range': [147, 148], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [149, 149], 'children': []}]}, {'type': 'Identifier', 'name': 'mock_bucket', 'range': [151, 152], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [153, 160], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [158, 160], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [154, 157], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [153, 154], 'children': []}, {'type': 'Identifier', 'name': 'blob', 'range': [155, 156], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [157, 157], 'children': []}]}, {'type': 'Identifier', 'name': 'mock_blob', 'range': [159, 160], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [161, 166], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [164, 166], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [162, 163], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [161, 162], 'children': []}, {'type': 'Identifier', 'name': 'public_url', 'range': [163, 163], 'children': []}]}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [165, 166], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [168, 178], 'children': [{'type': 'CallExpression', 'name': 'patch', 'range': [170, 178], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [169, 170], 'children': [{'type': 'Identifier', 'name': 'mocker', 'range': [168, 169], 'children': []}, {'type': 'Identifier', 'name': 'patch', 'range': [170, 170], 'children': []}]}, {'type': 'Literal', 'name': '"google.cloud.storage.Client"', 'range': [172, 173], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [175, 176], 'children': [{'type': 'Identifier', 'name': 'return_value', 'range': [174, 175], 'children': []}, {'type': 'Identifier', 'name': 'mock_client', 'range': [176, 176], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [180, 182], 'children': [{'type': 'Identifier', 'name': 'mock_client', 'range': [181, 182], 'children': []}]}]}]}
2025-01-08 10:24:11,315 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:24:13,078 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_webm_success', 'range': [1136, 1217], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_webm_success', 'range': [1136, 1217], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1139, 1143], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1140, 1140], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1142, 1142], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1144, 1217], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1146, 1189], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1147, 1189], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1148, 1189], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1151, 1189], 'children': [{'type': 'Argument', 'name': 'filename', 'range': [1153, 1155], 'children': []}, {'type': 'Argument', 'name': 'file', 'range': [1158, 1166], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1160, 1166], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1163, 1166], 'children': [{'type': 'Argument', 'name': 'b', 'range': [1164, 1165], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'headers', 'range': [1173, 1186], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1175, 1186], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1180, 1186], 'children': [{'type': 'Argument', 'name': '', 'range': [1181, 1185], 'children': []}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [1192, 1210], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1193, 1210], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [1194, 1210], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1195, 1210], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1206, 1210], 'children': [{'type': 'Argument', 'name': '"test-user"', 'range': [1207, 1207], 'children': []}, {'type': 'Argument', 'name': 'test_file', 'range': [1209, 1209], 'children': []}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'assert', 'range': [1212, 1216], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1213, 1216], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1213, 1213], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1215, 1216], 'children': []}]}]}]}]}]}
2025-01-08 10:24:13,079 - INFO - Completed main AST analysis flow
2025-01-08 10:24:13,079 - INFO - Successfully processed chunk
2025-01-08 10:24:15,276 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_video_type', 'range': [547, 653], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_video_type', 'range': [547, 653], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [550, 554], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [551, 551], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [553, 553], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [555, 653], 'children': [{'type': 'VariableDecl', 'name': 'test_file', 'range': [557, 600], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [558, 600], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [559, 600], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [562, 600], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [564, 566], 'children': [{'type': 'Literal', 'name': '"test.mp4"', 'range': [566, 566], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'file', 'range': [569, 577], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [571, 577], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [574, 577], 'children': [{'type': 'Literal', 'name': 'b"\\x00\\x00\\x00\\x18ftypmp42"', 'range': [575, 576], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [584, 597], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [586, 597], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [591, 597], 'children': [{'type': 'ObjectLiteral', 'name': '{"content-type":"video/mp4"}', 'range': [592, 596], 'children': []}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [603, 622], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [604, 622], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [605, 622], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [606, 622], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [617, 622], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [618, 618], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [620, 620], 'children': []}]}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [624, 629], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [626, 628], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [625, 625], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [628, 628], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_bucket', 'range': [630, 637], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [631, 637], 'children': [{'type': 'MemberExpression', 'name': 'mock_storage_client.bucket.return_value', 'range': [632, 636], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob', 'range': [638, 645], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [639, 645], 'children': [{'type': 'MemberExpression', 'name': 'mock_bucket.blob.return_value', 'range': [640, 644], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob.upload_from_string.assert_called_once', 'range': [646, 653], 'children': [{'type': 'CallExpression', 'name': 'assert_called_once', 'range': [648, 653], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [651, 653], 'children': []}]}]}]}]}]}
2025-01-08 10:24:15,277 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:24:16,283 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_invalid_signature', 'range': [1315, 1403], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_invalid_signature', 'range': [1315, 1403], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [1318, 1322], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1319, 1319], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1321, 1321], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [1324, 1403], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1325, 1364], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1326, 1364], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1327, 1364], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1330, 1364], 'children': [{'type': 'Identifier', 'name': 'filename', 'range': [1332, 1334], 'children': []}, {'type': 'Identifier', 'name': 'file', 'range': [1337, 1345], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1339, 1345], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1342, 1345], 'children': [{'type': 'Literal', 'name': 'b', 'range': [1343, 1344], 'children': []}]}]}]}, {'type': 'Identifier', 'name': 'headers', 'range': [1348, 1361], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1350, 1361], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1355, 1361], 'children': [{'type': 'ObjectExpression', 'name': 'headers', 'range': [1356, 1360], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1357, 1359], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': 'with', 'range': [1367, 1403], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [1368, 1383], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1371, 1383], 'children': [{'type': 'Identifier', 'name': 'InvalidFileTypeError', 'range': [1372, 1382], 'children': []}]}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [1385, 1403], 'children': [{'type': 'ExpressionStatement', 'name': 'await', 'range': [1386, 1402], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1387, 1402], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [1398, 1402], 'children': [{'type': 'Identifier', 'name': 'test-user', 'range': [1399, 1399], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1401, 1401], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:24:16,283 - INFO - Completed main AST analysis flow
2025-01-08 10:24:16,284 - INFO - Successfully processed chunk
2025-01-08 10:24:16,307 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_file_too_large', 'range': [654, 772], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_file_too_large', 'range': [654, 772], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_file_too_large', 'range': [654, 662], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [654, 658], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [655, 658], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_file_too_large', 'range': [656, 689], 'children': []}, {'type': 'Identifier', 'name': 'mock_settings', 'range': [658, 671], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [660, 680], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [663, 772], 'children': [{'type': 'VariableDecl', 'name': 'large_data', 'range': [664, 682], 'children': [{'type': 'Identifier', 'name': 'large_data', 'range': [664, 674], 'children': []}, {'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [666, 677], 'children': []}, {'type': 'Literal', 'name': 'b"x"', 'range': [669, 672], 'children': []}, {'type': 'Literal', 'name': '50', 'range': [674, 676], 'children': []}, {'type': 'Literal', 'name': '1024', 'range': [676, 680], 'children': []}, {'type': 'Literal', 'name': '1024', 'range': [678, 682], 'children': []}, {'type': 'Literal', 'name': '1', 'range': [680, 681], 'children': []}]}, {'type': 'Comment', 'name': '# 50 MB + 1 byte with valid JPEG signature', 'range': [683, 693], 'children': []}, {'type': 'VariableDecl', 'name': 'test_file', 'range': [694, 732], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [694, 703], 'children': []}, {'type': 'Identifier', 'name': 'fastapi.UploadFile', 'range': [696, 711], 'children': []}, {'type': 'KeywordArgument', 'name': 'filename="laptop.jpeg"', 'range': [701, 714], 'children': []}, {'type': 'KeywordArgument', 'name': 'file=io.BytesIO(large_data)', 'range': [706, 730], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers=starlette.datastructures.Headers({"content-type": "image/jpeg"})', 'range': [716, 732], 'children': []}]}, {'type': 'WithStatement', 'name': 'with pytest.raises(backend.server.v2.store.exceptions.FileSizeTooLargeError):', 'range': [735, 771], 'children': [{'type': 'CallExpression', 'name': 'pytest.raises', 'range': [736, 751], 'children': [{'type': 'Identifier', 'name': 'backend.server.v2.store.exceptions.FileSizeTooLargeError', 'range': [740, 751], 'children': []}]}, {'type': 'Block', 'name': 'WithBody', 'range': [753, 771], 'children': [{'type': 'ExpressionStatement', 'name': 'await backend.server.v2.store.media.upload_media("test-user", test_file)', 'range': [754, 771], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [754, 759], 'children': []}, {'type': 'CallExpression', 'name': 'backend.server.v2.store.media.upload_media', 'range': [755, 770], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [767, 778], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [769, 778], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:24:16,307 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:24:18,316 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_mismatched_signature', 'range': [1218, 1314], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_mismatched_signature', 'range': [1218, 1314], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1221, 1225], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1222, 1222], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1224, 1224], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1226, 1314], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1228, 1274], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1229, 1274], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1230, 1274], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1233, 1274], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [1235, 1237], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [1240, 1248], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1242, 1248], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1245, 1248], 'children': [{'type': 'Literal', 'name': 'b"\\x89PNG\\r\\n\\x1a\\n"', 'range': [1246, 1247], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [1258, 1271], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1260, 1271], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1265, 1271], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1266, 1270], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1267, 1269], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [1277, 1313], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [1278, 1293], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1281, 1293], 'children': [{'type': 'MemberExpression', 'name': 'InvalidFileTypeError', 'range': [1282, 1292], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [1294, 1313], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [1296, 1312], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [1296, 1312], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1297, 1312], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1308, 1312], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [1309, 1309], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1311, 1311], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:24:18,316 - INFO - Completed main AST analysis flow
2025-01-08 10:24:18,317 - INFO - Successfully processed chunk
2025-01-08 10:24:21,422 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_webp_success', 'range': [1054, 1135], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_webp_success', 'range': [1054, 1135], 'children': [{'type': 'ParameterList', 'name': '', 'range': [1057, 1061], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [1058, 1058], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [1060, 1060], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [1062, 1135], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [1064, 1107], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1065, 1107], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [1066, 1107], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1069, 1107], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [1071, 1073], 'children': []}, {'type': 'KeywordArgument', 'name': 'file', 'range': [1076, 1084], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [1078, 1084], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1081, 1084], 'children': [{'type': 'Literal', 'name': 'b"RIFF\\x00\\x00\\x00\\x00WEBP"', 'range': [1082, 1083], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [1091, 1104], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [1093, 1104], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1098, 1104], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [1099, 1103], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1100, 1102], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1110, 1129], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [1111, 1129], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [1112, 1129], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1113, 1129], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [1124, 1129], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [1125, 1125], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1127, 1127], 'children': []}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1130, 1135], 'children': [{'type': 'AssertStatement', 'name': 'assert', 'range': [1130, 1135], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1131, 1134], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1131, 1131], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1134, 1134], 'children': []}]}]}]}]}]}]}
2025-01-08 10:24:21,422 - INFO - Completed main AST analysis flow
2025-01-08 10:24:21,423 - INFO - Successfully processed chunk
2025-01-08 10:24:30,865 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_upload_media_invalid_type', 'range': [304, 417], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_upload_media_invalid_type', 'range': [304, 392], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [304, 308], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [305, 308], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_invalid_type', 'range': [306, 334], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [307, 311], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [308, 321], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [310, 330], 'children': []}]}, {'type': 'Block', 'name': '', 'range': [312, 392], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [314, 353], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [314, 323], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [315, 316], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [316, 353], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [316, 323], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [318, 327], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [319, 353], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [321, 332], 'children': [{'type': 'StringLiteral', 'name': '"test.txt"', 'range': [323, 332], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [326, 334], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [328, 334], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [328, 330], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [330, 337], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [331, 334], 'children': [{'type': 'BinaryExpression', 'name': 'b', 'range': [332, 333], 'children': [{'type': 'StringLiteral', 'name': '"test data"', 'range': [333, 344], 'children': []}]}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [337, 350], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [339, 350], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [339, 348], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [340, 353], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [343, 350], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [344, 350], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [345, 349], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [346, 348], 'children': [{'type': 'StringLiteral', 'name': '"text/plain"', 'range': [348, 359], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [356, 392], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [357, 372], 'children': [{'type': 'Identifier', 'name': 'pytest', 'range': [357, 363], 'children': []}, {'type': 'Identifier', 'name': 'raises', 'range': [359, 365], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [360, 372], 'children': [{'type': 'Identifier', 'name': 'InvalidFileTypeError', 'range': [361, 380], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [361, 368], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [362, 368], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [364, 366], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [366, 371], 'children': []}, {'type': 'Identifier', 'name': 'exceptions', 'range': [369, 379], 'children': []}, {'type': 'Identifier', 'name': 'InvalidFileTypeError', 'range': [371, 392], 'children': []}]}]}]}, {'type': 'Block', 'name': '', 'range': [373, 392], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [375, 392], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [375, 392], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [376, 391], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [376, 383], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [377, 383], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [379, 381], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [381, 386], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [383, 388], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [386, 398], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [387, 391], 'children': [{'type': 'StringLiteral', 'name': '"test-user"', 'range': [388, 399], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [390, 399], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [394, 417], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [395, 396], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [394, 405], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [396, 401], 'children': [{'type': 'Identifier', 'name': 'mock_storage_client', 'range': [396, 414], 'children': []}, {'type': 'Identifier', 'name': 'bucket', 'range': [397, 403], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [399, 411], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [402, 417], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [403, 404], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [402, 411], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [404, 409], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [404, 415], 'children': []}, {'type': 'Identifier', 'name': 'blob', 'range': [405, 409], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [407, 419], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [410, 417], 'children': [{'type': 'CallExpression', 'name': 'assert_not_called', 'range': [411, 416], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [410, 419], 'children': []}, {'type': 'Identifier', 'name': 'upload_from_string', 'range': [412, 430], 'children': []}, {'type': 'Identifier', 'name': 'assert_not_called', 'range': [414, 430], 'children': []}]}]}]}
2025-01-08 10:24:30,866 - INFO - Starting Step 4: AST normalization
2025-01-08 10:24:36,981 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_png_success', 'range': [889, 971], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_png_success', 'range': [889, 971], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_png_success', 'range': [889, 897], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [889, 894], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [890, 893], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_png_success', 'range': [891, 920], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [892, 896], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [893, 906], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [895, 914], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [898, 971], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [899, 942], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [899, 908], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [900, 901], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [901, 942], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [901, 908], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [903, 912], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [904, 942], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [906, 908], 'children': [{'type': 'Literal', 'name': '"test.png"', 'range': [908, 918], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [911, 919], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [913, 919], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [913, 915], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [915, 922], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [916, 919], 'children': [{'type': 'Literal', 'name': 'b"\\x89PNG\\r\\n\\x1a\\n"', 'range': [917, 918], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [926, 939], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [928, 939], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [928, 937], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [929, 944], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [932, 939], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [933, 939], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [934, 938], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [935, 937], 'children': [{'type': 'Literal', 'name': '"image/png"', 'range': [937, 947], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [945, 964], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [945, 951], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [946, 947], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [947, 952], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [948, 963], 'children': [{'type': 'MemberExpression', 'name': 'backend.server.v2.store.media.upload_media', 'range': [948, 958], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [948, 954], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [949, 955], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [950, 952], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [951, 956], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [952, 957], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [954, 963], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [959, 963], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [960, 970], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [962, 971], 'children': []}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [965, 970], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [965, 971], 'children': []}, {'type': 'BinaryExpression', 'name': '==', 'range': [967, 968], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [965, 971], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [969, 1001], 'children': []}]}]}]}]}]}
2025-01-08 10:24:36,981 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:24:37,394 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [102, 182], 'children': [{'type': 'FunctionDecl', 'name': 'mock_storage_client', 'range': [107, 182], 'children': [{'type': 'VariableDecl', 'name': 'mock_client', 'range': [114, 122], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [115, 122], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [116, 122], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'mock_bucket', 'range': [124, 132], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [125, 132], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [126, 132], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'mock_blob', 'range': [134, 142], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [135, 142], 'children': [{'type': 'CallExpression', 'name': 'MagicMock', 'range': [136, 142], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [145, 152], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [150, 152], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [146, 149], 'children': [{'type': 'Identifier', 'name': 'mock_client', 'range': [145, 146], 'children': []}, {'type': 'Identifier', 'name': 'bucket', 'range': [147, 148], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [149, 149], 'children': []}]}, {'type': 'Identifier', 'name': 'mock_bucket', 'range': [151, 152], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [153, 160], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [158, 160], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [154, 157], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [153, 154], 'children': []}, {'type': 'Identifier', 'name': 'blob', 'range': [155, 156], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [157, 157], 'children': []}]}, {'type': 'Identifier', 'name': 'mock_blob', 'range': [159, 160], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [161, 166], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [164, 166], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [162, 163], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [161, 162], 'children': []}, {'type': 'Identifier', 'name': 'public_url', 'range': [163, 163], 'children': []}]}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [165, 166], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [168, 178], 'children': [{'type': 'CallExpression', 'name': 'patch', 'range': [170, 178], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [169, 170], 'children': [{'type': 'Identifier', 'name': 'mocker', 'range': [168, 169], 'children': []}, {'type': 'Identifier', 'name': 'patch', 'range': [170, 170], 'children': []}]}, {'type': 'Literal', 'name': '"google.cloud.storage.Client"', 'range': [172, 173], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [175, 176], 'children': [{'type': 'Identifier', 'name': 'return_value', 'range': [174, 175], 'children': []}, {'type': 'Identifier', 'name': 'mock_client', 'range': [176, 176], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [180, 182], 'children': [{'type': 'Identifier', 'name': 'mock_client', 'range': [181, 182], 'children': []}]}]}]}
2025-01-08 10:24:37,394 - INFO - Completed main AST analysis flow
2025-01-08 10:24:37,395 - INFO - Successfully processed chunk
2025-01-08 10:24:37,671 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_missing_credentials', 'range': [418, 546], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_missing_credentials', 'range': [418, 546], 'children': [{'type': 'VariableDecl', 'name': 'settings', 'range': [426, 430], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [427, 430], 'children': [{'type': 'CallExpression', 'name': 'Settings', 'range': [428, 430], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': '', 'range': [432, 446], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.media_gcs_bucket_name', 'range': [432, 436], 'children': []}, {'type': 'Literal', 'name': '', 'range': [437, 438], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '', 'range': [440, 446], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.google_application_credentials', 'range': [440, 444], 'children': []}, {'type': 'Literal', 'name': '', 'range': [445, 446], 'children': []}]}, {'type': 'CallExpression', 'name': 'monkeypatch.setattr', 'range': [448, 457], 'children': [{'type': 'Literal', 'name': '"backend.server.v2.store.media.Settings"', 'range': [452, 452], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [454, 457], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [456, 456], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'test_file', 'range': [460, 506], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [461, 506], 'children': [{'type': 'CallExpression', 'name': 'fastapi.UploadFile', 'range': [462, 506], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [467, 469], 'children': [{'type': 'Literal', 'name': '"laptop.jpeg"', 'range': [469, 469], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'file', 'range': [472, 483], 'children': [{'type': 'CallExpression', 'name': 'io.BytesIO', 'range': [474, 483], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [478, 482], 'children': [{'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [479, 479], 'children': []}, {'type': 'Literal', 'name': 'b"test data"', 'range': [482, 482], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [490, 503], 'children': [{'type': 'CallExpression', 'name': 'starlette.datastructures.Headers', 'range': [492, 503], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [498, 502], 'children': [{'type': 'Property', 'name': '"content-type"', 'range': [499, 501], 'children': [{'type': 'Literal', 'name': '"image/jpeg"', 'range': [501, 501], 'children': []}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [509, 545], 'children': [{'type': 'CallExpression', 'name': 'pytest.raises', 'range': [510, 525], 'children': [{'type': 'MemberExpression', 'name': 'backend.server.v2.store.exceptions.StorageConfigError', 'range': [514, 524], 'children': []}]}, {'type': 'AwaitExpression', 'name': '', 'range': [528, 544], 'children': [{'type': 'CallExpression', 'name': 'backend.server.v2.store.media.upload_media', 'range': [529, 544], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [541, 541], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [543, 543], 'children': []}]}]}]}]}]}
2025-01-08 10:24:37,671 - INFO - Completed main AST analysis flow
2025-01-08 10:24:37,672 - INFO - Successfully processed chunk
2025-01-08 10:24:37,805 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_gif_success', 'range': [972, 1053], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_gif_success', 'range': [972, 1053], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_gif_success', 'range': [972, 980], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [972, 976], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [973, 976], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_gif_success', 'range': [974, 1006], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [975, 979], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [976, 988], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [978, 998], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [981, 1053], 'children': [{'type': 'VariableDecl', 'name': 'test_file', 'range': [982, 1025], 'children': [{'type': 'Assignment', 'name': '=', 'range': [983, 984], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [984, 1025], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [984, 991], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [986, 995], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [987, 1025], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [989, 991], 'children': [{'type': 'Literal', 'name': '"test.gif"', 'range': [991, 999], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [994, 996], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [996, 1002], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [996, 998], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [998, 1004], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [999, 1002], 'children': [{'type': 'BinaryExpression', 'name': 'b', 'range': [1000, 1001], 'children': [{'type': 'Literal', 'name': '"GIF89a"', 'range': [1001, 1007], 'children': []}]}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [1009, 1010], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [1011, 1022], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [1011, 1019], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [1012, 1024], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [1015, 1021], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1016, 1022], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [1017, 1021], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1018, 1020], 'children': [{'type': 'Literal', 'name': '"image/gif"', 'range': [1020, 1028], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'result', 'range': [1028, 1047], 'children': [{'type': 'Assignment', 'name': '=', 'range': [1029, 1030], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1030, 1031], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1031, 1046], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [1031, 1041], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [1031, 1037], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [1032, 1038], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [1033, 1035], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [1034, 1040], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [1035, 1041], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [1037, 1045], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [1042, 1046], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [1043, 1051], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1045, 1053], 'children': []}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [1048, 1053], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1049, 1051], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1049, 1055], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1051, 1087], 'children': []}]}]}]}]}]}
2025-01-08 10:24:37,805 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:24:38,457 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_file_too_large', 'range': [654, 772], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_file_too_large', 'range': [654, 772], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_file_too_large', 'range': [654, 662], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [654, 658], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [655, 658], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_file_too_large', 'range': [656, 689], 'children': []}, {'type': 'Identifier', 'name': 'mock_settings', 'range': [658, 671], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [660, 680], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [663, 772], 'children': [{'type': 'VariableDecl', 'name': 'large_data', 'range': [664, 682], 'children': [{'type': 'Identifier', 'name': 'large_data', 'range': [664, 674], 'children': []}, {'type': 'Literal', 'name': 'b"\\xFF\\xD8\\xFF"', 'range': [666, 677], 'children': []}, {'type': 'Literal', 'name': 'b"x"', 'range': [669, 672], 'children': []}, {'type': 'Literal', 'name': '50', 'range': [674, 676], 'children': []}, {'type': 'Literal', 'name': '1024', 'range': [676, 680], 'children': []}, {'type': 'Literal', 'name': '1024', 'range': [678, 682], 'children': []}, {'type': 'Literal', 'name': '1', 'range': [680, 681], 'children': []}]}, {'type': 'Comment', 'name': '# 50 MB + 1 byte with valid JPEG signature', 'range': [683, 693], 'children': []}, {'type': 'VariableDecl', 'name': 'test_file', 'range': [694, 732], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [694, 703], 'children': []}, {'type': 'Identifier', 'name': 'fastapi.UploadFile', 'range': [696, 711], 'children': []}, {'type': 'KeywordArgument', 'name': 'filename="laptop.jpeg"', 'range': [701, 714], 'children': []}, {'type': 'KeywordArgument', 'name': 'file=io.BytesIO(large_data)', 'range': [706, 730], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers=starlette.datastructures.Headers({"content-type": "image/jpeg"})', 'range': [716, 732], 'children': []}]}, {'type': 'WithStatement', 'name': 'with pytest.raises(backend.server.v2.store.exceptions.FileSizeTooLargeError):', 'range': [735, 771], 'children': [{'type': 'CallExpression', 'name': 'pytest.raises', 'range': [736, 751], 'children': [{'type': 'Identifier', 'name': 'backend.server.v2.store.exceptions.FileSizeTooLargeError', 'range': [740, 751], 'children': []}]}, {'type': 'Block', 'name': 'WithBody', 'range': [753, 771], 'children': [{'type': 'ExpressionStatement', 'name': 'await backend.server.v2.store.media.upload_media("test-user", test_file)', 'range': [754, 771], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [754, 759], 'children': []}, {'type': 'CallExpression', 'name': 'backend.server.v2.store.media.upload_media', 'range': [755, 770], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [767, 778], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [769, 778], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:24:38,457 - INFO - Completed main AST analysis flow
2025-01-08 10:24:38,457 - INFO - Successfully processed chunk
2025-01-08 10:24:41,740 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_video_type', 'range': [547, 653], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_video_type', 'range': [547, 653], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [550, 554], 'children': [{'type': 'Parameter', 'name': 'mock_settings', 'range': [551, 551], 'children': []}, {'type': 'Parameter', 'name': 'mock_storage_client', 'range': [553, 553], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [555, 653], 'children': [{'type': 'VariableDecl', 'name': 'test_file', 'range': [557, 600], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [558, 600], 'children': [{'type': 'CallExpression', 'name': 'UploadFile', 'range': [559, 600], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [562, 600], 'children': [{'type': 'KeywordArgument', 'name': 'filename', 'range': [564, 566], 'children': [{'type': 'Literal', 'name': '"test.mp4"', 'range': [566, 566], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'file', 'range': [569, 577], 'children': [{'type': 'CallExpression', 'name': 'BytesIO', 'range': [571, 577], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [574, 577], 'children': [{'type': 'Literal', 'name': 'b"\\x00\\x00\\x00\\x18ftypmp42"', 'range': [575, 576], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [584, 597], 'children': [{'type': 'CallExpression', 'name': 'Headers', 'range': [586, 597], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [591, 597], 'children': [{'type': 'ObjectLiteral', 'name': '{"content-type":"video/mp4"}', 'range': [592, 596], 'children': []}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [603, 622], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [604, 622], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [605, 622], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [606, 622], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [617, 622], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [618, 618], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [620, 620], 'children': []}]}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [624, 629], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [626, 628], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [625, 625], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [628, 628], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_bucket', 'range': [630, 637], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [631, 637], 'children': [{'type': 'MemberExpression', 'name': 'mock_storage_client.bucket.return_value', 'range': [632, 636], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob', 'range': [638, 645], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [639, 645], 'children': [{'type': 'MemberExpression', 'name': 'mock_bucket.blob.return_value', 'range': [640, 644], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'mock_blob.upload_from_string.assert_called_once', 'range': [646, 653], 'children': [{'type': 'CallExpression', 'name': 'assert_called_once', 'range': [648, 653], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [651, 653], 'children': []}]}]}]}]}]}
2025-01-08 10:24:41,740 - INFO - Completed main AST analysis flow
2025-01-08 10:24:41,740 - INFO - Successfully processed chunk
2025-01-08 10:25:11,649 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_png_success', 'range': [889, 971], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_png_success', 'range': [889, 971], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_png_success', 'range': [889, 897], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [889, 894], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [890, 893], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_png_success', 'range': [891, 920], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [892, 896], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [893, 906], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [895, 914], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [898, 971], 'children': [{'type': 'VariableDeclaration', 'name': 'test_file', 'range': [899, 942], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [899, 908], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [900, 901], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [901, 942], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [901, 908], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [903, 912], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [904, 942], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [906, 908], 'children': [{'type': 'Literal', 'name': '"test.png"', 'range': [908, 918], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [911, 919], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [913, 919], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [913, 915], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [915, 922], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [916, 919], 'children': [{'type': 'Literal', 'name': 'b"\\x89PNG\\r\\n\\x1a\\n"', 'range': [917, 918], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [926, 939], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [928, 939], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [928, 937], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [929, 944], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [932, 939], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [933, 939], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [934, 938], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [935, 937], 'children': [{'type': 'Literal', 'name': '"image/png"', 'range': [937, 947], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': 'result', 'range': [945, 964], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [945, 951], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [946, 947], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [947, 952], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [948, 963], 'children': [{'type': 'MemberExpression', 'name': 'backend.server.v2.store.media.upload_media', 'range': [948, 958], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [948, 954], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [949, 955], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [950, 952], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [951, 956], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [952, 957], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [954, 963], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [959, 963], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [960, 970], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [962, 971], 'children': []}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [965, 970], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [965, 971], 'children': []}, {'type': 'BinaryExpression', 'name': '==', 'range': [967, 968], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [965, 971], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [969, 1001], 'children': []}]}]}]}]}]}
2025-01-08 10:25:11,649 - INFO - Completed main AST analysis flow
2025-01-08 10:25:11,650 - INFO - Successfully processed chunk
2025-01-08 10:25:12,183 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_gif_success', 'range': [972, 1053], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_gif_success', 'range': [972, 1053], 'children': [{'type': 'FunctionSignature', 'name': 'test_upload_media_gif_success', 'range': [972, 980], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [972, 976], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [973, 976], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_gif_success', 'range': [974, 1006], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [975, 979], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [976, 988], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [978, 998], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [981, 1053], 'children': [{'type': 'VariableDecl', 'name': 'test_file', 'range': [982, 1025], 'children': [{'type': 'Assignment', 'name': '=', 'range': [983, 984], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [984, 1025], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [984, 991], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [986, 995], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [987, 1025], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [989, 991], 'children': [{'type': 'Literal', 'name': '"test.gif"', 'range': [991, 999], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [994, 996], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [996, 1002], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [996, 998], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [998, 1004], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [999, 1002], 'children': [{'type': 'BinaryExpression', 'name': 'b', 'range': [1000, 1001], 'children': [{'type': 'Literal', 'name': '"GIF89a"', 'range': [1001, 1007], 'children': []}]}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [1009, 1010], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [1011, 1022], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [1011, 1019], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [1012, 1024], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [1015, 1021], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1016, 1022], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [1017, 1021], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [1018, 1020], 'children': [{'type': 'Literal', 'name': '"image/gif"', 'range': [1020, 1028], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'result', 'range': [1028, 1047], 'children': [{'type': 'Assignment', 'name': '=', 'range': [1029, 1030], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1030, 1031], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [1031, 1046], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [1031, 1041], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [1031, 1037], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [1032, 1038], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [1033, 1035], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [1034, 1040], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [1035, 1041], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [1037, 1045], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [1042, 1046], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [1043, 1051], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [1045, 1053], 'children': []}]}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [1048, 1053], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [1049, 1051], 'children': [{'type': 'Identifier', 'name': 'result', 'range': [1049, 1055], 'children': []}, {'type': 'Literal', 'name': '"http://test-url/media/laptop.jpeg"', 'range': [1051, 1087], 'children': []}]}]}]}]}]}
2025-01-08 10:25:12,183 - INFO - Completed main AST analysis flow
2025-01-08 10:25:12,184 - INFO - Successfully processed chunk
2025-01-08 10:25:15,779 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_upload_media_invalid_type', 'range': [304, 417], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_invalid_type', 'range': [304, 392], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [304, 308], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [305, 308], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_invalid_type', 'range': [306, 334], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [307, 311], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [308, 321], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [310, 330], 'children': []}]}, {'type': 'Block', 'name': '', 'range': [312, 392], 'children': [{'type': 'VariableDecl', 'name': 'test_file', 'range': [314, 353], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [314, 323], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [315, 316], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [316, 353], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [316, 323], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [318, 327], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [319, 353], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [321, 332], 'children': [{'type': 'Literal', 'name': '"test.txt"', 'range': [323, 332], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [326, 334], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [328, 334], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [328, 330], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [330, 337], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [331, 334], 'children': [{'type': 'BinaryExpression', 'name': 'b', 'range': [332, 333], 'children': [{'type': 'Literal', 'name': '"test data"', 'range': [333, 344], 'children': []}]}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [337, 350], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [339, 350], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [339, 348], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [340, 353], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [343, 350], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [344, 350], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [345, 349], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [346, 348], 'children': [{'type': 'Literal', 'name': '"text/plain"', 'range': [348, 359], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [356, 392], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [357, 372], 'children': [{'type': 'Identifier', 'name': 'pytest', 'range': [357, 363], 'children': []}, {'type': 'Identifier', 'name': 'raises', 'range': [359, 365], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [360, 372], 'children': [{'type': 'Identifier', 'name': 'InvalidFileTypeError', 'range': [361, 380], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [361, 368], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [362, 368], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [364, 366], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [366, 371], 'children': []}, {'type': 'Identifier', 'name': 'exceptions', 'range': [369, 379], 'children': []}, {'type': 'Identifier', 'name': 'InvalidFileTypeError', 'range': [371, 392], 'children': []}]}]}]}, {'type': 'Block', 'name': '', 'range': [373, 392], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [375, 392], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [375, 392], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [376, 391], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [376, 383], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [377, 383], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [379, 381], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [381, 386], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [383, 388], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [386, 398], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [387, 391], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [388, 399], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [390, 399], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [394, 417], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [395, 396], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [394, 405], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [396, 401], 'children': [{'type': 'Identifier', 'name': 'mock_storage_client', 'range': [396, 414], 'children': []}, {'type': 'Identifier', 'name': 'bucket', 'range': [397, 403], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [399, 411], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [402, 417], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [403, 404], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [402, 411], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [404, 409], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [404, 415], 'children': []}, {'type': 'Identifier', 'name': 'blob', 'range': [405, 409], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [407, 419], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [410, 417], 'children': [{'type': 'CallExpression', 'name': 'assert_not_called', 'range': [411, 416], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [410, 419], 'children': []}, {'type': 'Identifier', 'name': 'upload_from_string', 'range': [412, 430], 'children': []}, {'type': 'Identifier', 'name': 'assert_not_called', 'range': [414, 430], 'children': []}]}]}]}
2025-01-08 10:25:15,779 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:26:05,115 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_upload_media_invalid_type', 'range': [304, 417], 'children': [{'type': 'FunctionDecl', 'name': 'test_upload_media_invalid_type', 'range': [304, 392], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [304, 308], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [305, 308], 'children': []}, {'type': 'Identifier', 'name': 'test_upload_media_invalid_type', 'range': [306, 334], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [307, 311], 'children': [{'type': 'Identifier', 'name': 'mock_settings', 'range': [308, 321], 'children': []}, {'type': 'Identifier', 'name': 'mock_storage_client', 'range': [310, 330], 'children': []}]}, {'type': 'Block', 'name': '', 'range': [312, 392], 'children': [{'type': 'VariableDecl', 'name': 'test_file', 'range': [314, 353], 'children': [{'type': 'Identifier', 'name': 'test_file', 'range': [314, 323], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [315, 316], 'children': []}, {'type': 'NewExpression', 'name': 'UploadFile', 'range': [316, 353], 'children': [{'type': 'Identifier', 'name': 'fastapi', 'range': [316, 323], 'children': []}, {'type': 'Identifier', 'name': 'UploadFile', 'range': [318, 327], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [319, 353], 'children': [{'type': 'NamedArgument', 'name': 'filename', 'range': [321, 332], 'children': [{'type': 'Literal', 'name': '"test.txt"', 'range': [323, 332], 'children': []}]}, {'type': 'NamedArgument', 'name': 'file', 'range': [326, 334], 'children': [{'type': 'NewExpression', 'name': 'BytesIO', 'range': [328, 334], 'children': [{'type': 'Identifier', 'name': 'io', 'range': [328, 330], 'children': []}, {'type': 'Identifier', 'name': 'BytesIO', 'range': [330, 337], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [331, 334], 'children': [{'type': 'BinaryExpression', 'name': 'b', 'range': [332, 333], 'children': [{'type': 'Literal', 'name': '"test data"', 'range': [333, 344], 'children': []}]}]}]}]}, {'type': 'NamedArgument', 'name': 'headers', 'range': [337, 350], 'children': [{'type': 'NewExpression', 'name': 'Headers', 'range': [339, 350], 'children': [{'type': 'Identifier', 'name': 'starlette', 'range': [339, 348], 'children': []}, {'type': 'Identifier', 'name': 'datastructures', 'range': [340, 353], 'children': []}, {'type': 'Identifier', 'name': 'Headers', 'range': [343, 350], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [344, 350], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [345, 349], 'children': [{'type': 'Property', 'name': 'content-type', 'range': [346, 348], 'children': [{'type': 'Literal', 'name': '"text/plain"', 'range': [348, 359], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'WithStatement', 'name': '', 'range': [356, 392], 'children': [{'type': 'CallExpression', 'name': 'raises', 'range': [357, 372], 'children': [{'type': 'Identifier', 'name': 'pytest', 'range': [357, 363], 'children': []}, {'type': 'Identifier', 'name': 'raises', 'range': [359, 365], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [360, 372], 'children': [{'type': 'Identifier', 'name': 'InvalidFileTypeError', 'range': [361, 380], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [361, 368], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [362, 368], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [364, 366], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [366, 371], 'children': []}, {'type': 'Identifier', 'name': 'exceptions', 'range': [369, 379], 'children': []}, {'type': 'Identifier', 'name': 'InvalidFileTypeError', 'range': [371, 392], 'children': []}]}]}]}, {'type': 'Block', 'name': '', 'range': [373, 392], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [375, 392], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [375, 392], 'children': [{'type': 'CallExpression', 'name': 'upload_media', 'range': [376, 391], 'children': [{'type': 'Identifier', 'name': 'backend', 'range': [376, 383], 'children': []}, {'type': 'Identifier', 'name': 'server', 'range': [377, 383], 'children': []}, {'type': 'Identifier', 'name': 'v2', 'range': [379, 381], 'children': []}, {'type': 'Identifier', 'name': 'store', 'range': [381, 386], 'children': []}, {'type': 'Identifier', 'name': 'media', 'range': [383, 388], 'children': []}, {'type': 'Identifier', 'name': 'upload_media', 'range': [386, 398], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [387, 391], 'children': [{'type': 'Literal', 'name': '"test-user"', 'range': [388, 399], 'children': []}, {'type': 'Identifier', 'name': 'test_file', 'range': [390, 399], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [394, 417], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [395, 396], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [394, 405], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [396, 401], 'children': [{'type': 'Identifier', 'name': 'mock_storage_client', 'range': [396, 414], 'children': []}, {'type': 'Identifier', 'name': 'bucket', 'range': [397, 403], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [399, 411], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [402, 417], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [403, 404], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [402, 411], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [404, 409], 'children': [{'type': 'Identifier', 'name': 'mock_bucket', 'range': [404, 415], 'children': []}, {'type': 'Identifier', 'name': 'blob', 'range': [405, 409], 'children': []}, {'type': 'Identifier', 'name': 'return_value', 'range': [407, 419], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [410, 417], 'children': [{'type': 'CallExpression', 'name': 'assert_not_called', 'range': [411, 416], 'children': [{'type': 'Identifier', 'name': 'mock_blob', 'range': [410, 419], 'children': []}, {'type': 'Identifier', 'name': 'upload_from_string', 'range': [412, 430], 'children': []}, {'type': 'Identifier', 'name': 'assert_not_called', 'range': [414, 430], 'children': []}]}]}]}
2025-01-08 10:26:05,116 - INFO - Completed main AST analysis flow
2025-01-08 10:26:05,117 - INFO - Successfully processed chunk
2025-01-08 10:26:05,237 - INFO - Starting code generation from AST
2025-01-08 10:26:50,637 - INFO - Successfully generated code from AST
2025-01-08 10:26:50,638 - INFO - Starting static code similarity comparison
2025-01-08 10:26:50,659 - INFO - Static similarity result: {'final_score': 96.16, 'length_similarity': 95.33, 'token_similarity': 91.3, 'structure_similarity': 97.86, 'function_similarity': 100, 'complexity_similarity': 100.0, 'variable_similarity': 100}
