2025-01-08 10:14:53,031 - INFO - Processing sample 137
2025-01-08 10:14:53,031 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 10:14:57,093 - INFO - Successfully split code into 3 top-level declarations
2025-01-08 10:14:57,097 - INFO - Processing chunk #0 (size=380 chars, start_index=0)
2025-01-08 10:14:57,098 - INFO - Processing chunk with 380 chars starting at index 0
2025-01-08 10:14:57,098 - INFO - Starting main AST analysis flow
2025-01-08 10:14:57,098 - INFO - Tokenized code into 84 tokens
2025-01-08 10:14:57,098 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:14:57,103 - INFO - Processing chunk #1 (size=1099 chars, start_index=84)
2025-01-08 10:14:57,103 - INFO - Processing chunk with 1099 chars starting at index 84
2025-01-08 10:14:57,103 - INFO - Starting main AST analysis flow
2025-01-08 10:14:57,103 - INFO - Tokenized code into 140 tokens
2025-01-08 10:14:57,103 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:14:57,105 - INFO - Processing chunk #2 (size=5980 chars, start_index=224)
2025-01-08 10:14:57,105 - INFO - Processing chunk with 5980 chars starting at index 224
2025-01-08 10:14:57,105 - INFO - Starting main AST analysis flow
2025-01-08 10:14:57,107 - INFO - Tokenized code into 945 tokens
2025-01-08 10:14:57,107 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:14:58,798 - INFO - Step 1 result: {'type': 'Program', 'name': 'check_media_exists', 'range': [84, 222], 'children': []}
2025-01-08 10:14:58,798 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:14:59,462 - INFO - Step 1 result: {'type': 'Program', 'name': 'upload_media', 'range': [224, 1168], 'children': []}
2025-01-08 10:14:59,462 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:15:04,340 - INFO - Step 1 result: {'top_level_declarations': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 8], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [10, 12], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 19], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 31], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [32, 40], 'children': []}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [42, 50], 'children': []}, {'type': 'VariableDeclaration', 'name': 'ALLOWED_IMAGE_TYPES', 'range': [52, 63], 'children': []}, {'type': 'VariableDeclaration', 'name': 'ALLOWED_VIDEO_TYPES', 'range': [64, 71], 'children': []}, {'type': 'VariableDeclaration', 'name': 'MAX_FILE_SIZE', 'range': [72, 82], 'children': []}]}
2025-01-08 10:15:04,340 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:15:28,155 - INFO - Step 2 result: {'top_level_declarations': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportPath', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportPath', 'name': 'os', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 8], 'children': [{'type': 'ImportPath', 'name': 'uuid', 'range': [7, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [10, 12], 'children': [{'type': 'ImportPath', 'name': 'fastapi', 'range': [11, 11], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 19], 'children': [{'type': 'FromImport', 'name': 'google.cloud', 'range': [14, 17], 'children': []}, {'type': 'ImportPath', 'name': 'storage', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 31], 'children': [{'type': 'ImportPath', 'name': 'backend.server.v2.store.exceptions', 'range': [22, 30], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [32, 40], 'children': [{'type': 'FromImport', 'name': 'backend.util.settings', 'range': [33, 37], 'children': []}, {'type': 'ImportPath', 'name': 'Settings', 'range': [39, 39], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [42, 50], 'children': [{'type': 'Assignment', 'name': '=', 'range': [43, 43], 'children': [{'type': 'CallExpression', 'name': 'logging.getLogger', 'range': [44, 49], 'children': [{'type': 'Argument', 'name': '__name__', 'range': [48, 48], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'ALLOWED_IMAGE_TYPES', 'range': [52, 63], 'children': [{'type': 'Assignment', 'name': '=', 'range': [53, 53], 'children': [{'type': 'SetLiteral', 'name': '', 'range': [54, 62], 'children': [{'type': 'StringLiteral', 'name': '"image/jpeg"', 'range': [55, 55], 'children': []}, {'type': 'StringLiteral', 'name': '"image/png"', 'range': [57, 57], 'children': []}, {'type': 'StringLiteral', 'name': '"image/gif"', 'range': [59, 59], 'children': []}, {'type': 'StringLiteral', 'name': '"image/webp"', 'range': [61, 61], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'ALLOWED_VIDEO_TYPES', 'range': [64, 71], 'children': [{'type': 'Assignment', 'name': '=', 'range': [65, 65], 'children': [{'type': 'SetLiteral', 'name': '', 'range': [66, 70], 'children': [{'type': 'StringLiteral', 'name': '"video/mp4"', 'range': [67, 67], 'children': []}, {'type': 'StringLiteral', 'name': '"video/webm"', 'range': [69, 69], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'MAX_FILE_SIZE', 'range': [72, 82], 'children': [{'type': 'Assignment', 'name': '=', 'range': [73, 73], 'children': [{'type': 'BinaryExpression', 'name': '*', 'range': [75, 75], 'children': [{'type': 'BinaryExpression', 'name': '*', 'range': [77, 77], 'children': [{'type': 'NumericLiteral', 'name': '50', 'range': [74, 74], 'children': []}, {'type': 'NumericLiteral', 'name': '1024', 'range': [76, 76], 'children': []}]}, {'type': 'NumericLiteral', 'name': '1024', 'range': [78, 78], 'children': []}]}]}]}]}
2025-01-08 10:15:28,155 - INFO - Starting Step 3: AST simplification
2025-01-08 10:15:38,597 - INFO - Step 2 result: {'type': 'Program', 'name': 'check_media_exists', 'range': [84, 222], 'children': [{'type': 'FunctionDeclaration', 'name': 'check_media_exists', 'range': [84, 222], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [84, 89], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [85, 88], 'children': []}, {'type': 'FunctionName', 'name': 'check_media_exists', 'range': [86, 105], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [87, 95], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [88, 94], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [90, 93], 'children': []}]}, {'type': 'Parameter', 'name': 'filename', 'range': [92, 98], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [94, 97], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [96, 100], 'children': [{'type': 'TypeUnion', 'name': 'str | None', 'range': [98, 100], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [101, 222], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [103, 105], 'children': []}, {'type': 'TryStatement', 'name': 'try_statement', 'range': [107, 222], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [107, 205], 'children': [{'type': 'Assignment', 'name': 'settings_assignment', 'range': [110, 114], 'children': [{'type': 'Variable', 'name': 'settings', 'range': [110, 117], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [111, 112], 'children': []}, {'type': 'FunctionCall', 'name': 'Settings', 'range': [112, 114], 'children': []}]}, {'type': 'Assignment', 'name': 'storage_client_assignment', 'range': [116, 122], 'children': [{'type': 'Variable', 'name': 'storage_client', 'range': [116, 129], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [117, 118], 'children': []}, {'type': 'FunctionCall', 'name': 'storage.Client', 'range': [118, 122], 'children': []}]}, {'type': 'Assignment', 'name': 'bucket_assignment', 'range': [124, 135], 'children': [{'type': 'Variable', 'name': 'bucket', 'range': [124, 130], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [125, 126], 'children': []}, {'type': 'FunctionCall', 'name': 'storage_client.bucket', 'range': [126, 135], 'children': [{'type': 'Argument', 'name': 'settings.config.media_gcs_bucket_name', 'range': [130, 135], 'children': []}]}]}, {'type': 'Comment', 'name': 'Check images', 'range': [138, 141], 'children': []}, {'type': 'Assignment', 'name': 'image_path_assignment', 'range': [142, 146], 'children': [{'type': 'Variable', 'name': 'image_path', 'range': [142, 152], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [143, 144], 'children': []}, {'type': 'StringLiteral', 'name': 'f"users/{user_id}/images/{filename}"', 'range': [144, 146], 'children': []}]}, {'type': 'Assignment', 'name': 'image_blob_assignment', 'range': [147, 155], 'children': [{'type': 'Variable', 'name': 'image_blob', 'range': [147, 157], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [148, 149], 'children': []}, {'type': 'FunctionCall', 'name': 'bucket.blob', 'range': [149, 155], 'children': [{'type': 'Argument', 'name': 'image_path', 'range': [153, 155], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_image_blob_exists', 'range': [156, 168], 'children': [{'type': 'Condition', 'name': 'image_blob.exists()', 'range': [157, 162], 'children': []}, {'type': 'ReturnStatement', 'name': 'return_image_blob_public_url', 'range': [164, 168], 'children': [{'type': 'FunctionCall', 'name': 'image_blob.public_url', 'range': [165, 168], 'children': []}]}]}, {'type': 'Comment', 'name': 'Check videos', 'range': [170, 173], 'children': []}, {'type': 'Assignment', 'name': 'video_path_assignment', 'range': [174, 178], 'children': [{'type': 'Variable', 'name': 'video_path', 'range': [174, 184], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [175, 176], 'children': []}, {'type': 'StringLiteral', 'name': 'f"users/{user_id}/videos/{filename}"', 'range': [176, 178], 'children': []}]}, {'type': 'Assignment', 'name': 'video_blob_assignment', 'range': [180, 188], 'children': [{'type': 'Variable', 'name': 'video_blob', 'range': [180, 190], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [181, 182], 'children': []}, {'type': 'FunctionCall', 'name': 'bucket.blob', 'range': [182, 188], 'children': [{'type': 'Argument', 'name': 'video_path', 'range': [186, 188], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_video_blob_exists', 'range': [189, 201], 'children': [{'type': 'Condition', 'name': 'video_blob.exists()', 'range': [190, 195], 'children': []}, {'type': 'ReturnStatement', 'name': 'return_video_blob_public_url', 'range': [197, 201], 'children': [{'type': 'FunctionCall', 'name': 'video_blob.public_url', 'range': [198, 201], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return_none', 'range': [203, 205], 'children': [{'type': 'NoneKeyword', 'name': 'None', 'range': [204, 205], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [206, 222], 'children': [{'type': 'Exception', 'name': 'Exception', 'range': [207, 209], 'children': []}, {'type': 'Assignment', 'name': 'e_assignment', 'range': [208, 210], 'children': [{'type': 'Variable', 'name': 'e', 'range': [209, 210], 'children': []}]}, {'type': 'FunctionCall', 'name': 'logger.error', 'range': [212, 218], 'children': [{'type': 'Argument', 'name': 'f"Error checking if media file exists: {str(e)}"', 'range': [216, 218], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return_none', 'range': [220, 222], 'children': [{'type': 'NoneKeyword', 'name': 'None', 'range': [221, 222], 'children': []}]}]}]}]}]}]}
2025-01-08 10:15:38,597 - INFO - Starting Step 3: AST simplification
2025-01-08 10:15:52,999 - INFO - Step 3 result: {'top_level_declarations': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportPath', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportPath', 'name': 'os', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 8], 'children': [{'type': 'ImportPath', 'name': 'uuid', 'range': [7, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [10, 12], 'children': [{'type': 'ImportPath', 'name': 'fastapi', 'range': [11, 11], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 19], 'children': [{'type': 'FromImport', 'name': 'google.cloud', 'range': [14, 17], 'children': []}, {'type': 'ImportPath', 'name': 'storage', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 31], 'children': [{'type': 'ImportPath', 'name': 'backend.server.v2.store.exceptions', 'range': [22, 30], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [32, 40], 'children': [{'type': 'FromImport', 'name': 'backend.util.settings', 'range': [33, 37], 'children': []}, {'type': 'ImportPath', 'name': 'Settings', 'range': [39, 39], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [42, 50], 'children': [{'type': 'Assignment', 'name': '=', 'range': [43, 43], 'children': [{'type': 'CallExpression', 'name': 'logging.getLogger', 'range': [44, 49], 'children': [{'type': 'Argument', 'name': '__name__', 'range': [48, 48], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'ALLOWED_IMAGE_TYPES', 'range': [52, 63], 'children': [{'type': 'Assignment', 'name': '=', 'range': [53, 53], 'children': [{'type': 'SetLiteral', 'name': '', 'range': [54, 62], 'children': [{'type': 'StringLiteral', 'name': '"image/jpeg"', 'range': [55, 55], 'children': []}, {'type': 'StringLiteral', 'name': '"image/png"', 'range': [57, 57], 'children': []}, {'type': 'StringLiteral', 'name': '"image/gif"', 'range': [59, 59], 'children': []}, {'type': 'StringLiteral', 'name': '"image/webp"', 'range': [61, 61], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'ALLOWED_VIDEO_TYPES', 'range': [64, 71], 'children': [{'type': 'Assignment', 'name': '=', 'range': [65, 65], 'children': [{'type': 'SetLiteral', 'name': '', 'range': [66, 70], 'children': [{'type': 'StringLiteral', 'name': '"video/mp4"', 'range': [67, 67], 'children': []}, {'type': 'StringLiteral', 'name': '"video/webm"', 'range': [69, 69], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'MAX_FILE_SIZE', 'range': [72, 82], 'children': [{'type': 'Assignment', 'name': '=', 'range': [73, 73], 'children': [{'type': 'BinaryExpression', 'name': '*', 'range': [75, 75], 'children': [{'type': 'BinaryExpression', 'name': '*', 'range': [77, 77], 'children': [{'type': 'NumericLiteral', 'name': '50', 'range': [74, 74], 'children': []}, {'type': 'NumericLiteral', 'name': '1024', 'range': [76, 76], 'children': []}]}, {'type': 'NumericLiteral', 'name': '1024', 'range': [78, 78], 'children': []}]}]}]}]}
2025-01-08 10:15:52,999 - INFO - Starting Step 4: AST normalization
2025-01-08 10:16:17,216 - INFO - Step 3 result: {'type': 'Program', 'name': 'check_media_exists', 'range': [84, 222], 'children': [{'type': 'FunctionDeclaration', 'name': 'check_media_exists', 'range': [84, 222], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [84, 89], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [85, 88], 'children': []}, {'type': 'FunctionName', 'name': 'check_media_exists', 'range': [86, 105], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [87, 95], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [88, 94], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [90, 93], 'children': []}]}, {'type': 'Parameter', 'name': 'filename', 'range': [92, 98], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [94, 97], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [96, 100], 'children': [{'type': 'TypeUnion', 'name': 'str | None', 'range': [98, 100], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [101, 222], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [103, 105], 'children': []}, {'type': 'TryStatement', 'name': 'try_statement', 'range': [107, 222], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [107, 205], 'children': [{'type': 'Assignment', 'name': 'settings_assignment', 'range': [110, 114], 'children': [{'type': 'Variable', 'name': 'settings', 'range': [110, 117], 'children': []}, {'type': 'FunctionCall', 'name': 'Settings', 'range': [112, 114], 'children': []}]}, {'type': 'Assignment', 'name': 'storage_client_assignment', 'range': [116, 122], 'children': [{'type': 'Variable', 'name': 'storage_client', 'range': [116, 129], 'children': []}, {'type': 'FunctionCall', 'name': 'storage.Client', 'range': [118, 122], 'children': []}]}, {'type': 'Assignment', 'name': 'bucket_assignment', 'range': [124, 135], 'children': [{'type': 'Variable', 'name': 'bucket', 'range': [124, 130], 'children': []}, {'type': 'FunctionCall', 'name': 'storage_client.bucket', 'range': [126, 135], 'children': [{'type': 'Argument', 'name': 'settings.config.media_gcs_bucket_name', 'range': [130, 135], 'children': []}]}]}, {'type': 'Comment', 'name': 'Check images', 'range': [138, 141], 'children': []}, {'type': 'Assignment', 'name': 'image_path_assignment', 'range': [142, 146], 'children': [{'type': 'Variable', 'name': 'image_path', 'range': [142, 152], 'children': []}, {'type': 'StringLiteral', 'name': 'f"users/{user_id}/images/{filename}"', 'range': [144, 146], 'children': []}]}, {'type': 'Assignment', 'name': 'image_blob_assignment', 'range': [147, 155], 'children': [{'type': 'Variable', 'name': 'image_blob', 'range': [147, 157], 'children': []}, {'type': 'FunctionCall', 'name': 'bucket.blob', 'range': [149, 155], 'children': [{'type': 'Argument', 'name': 'image_path', 'range': [153, 155], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_image_blob_exists', 'range': [156, 168], 'children': [{'type': 'Condition', 'name': 'image_blob.exists()', 'range': [157, 162], 'children': []}, {'type': 'ReturnStatement', 'name': 'return_image_blob_public_url', 'range': [164, 168], 'children': [{'type': 'FunctionCall', 'name': 'image_blob.public_url', 'range': [165, 168], 'children': []}]}]}, {'type': 'Comment', 'name': 'Check videos', 'range': [170, 173], 'children': []}, {'type': 'Assignment', 'name': 'video_path_assignment', 'range': [174, 178], 'children': [{'type': 'Variable', 'name': 'video_path', 'range': [174, 184], 'children': []}, {'type': 'StringLiteral', 'name': 'f"users/{user_id}/videos/{filename}"', 'range': [176, 178], 'children': []}]}, {'type': 'Assignment', 'name': 'video_blob_assignment', 'range': [180, 188], 'children': [{'type': 'Variable', 'name': 'video_blob', 'range': [180, 190], 'children': []}, {'type': 'FunctionCall', 'name': 'bucket.blob', 'range': [182, 188], 'children': [{'type': 'Argument', 'name': 'video_path', 'range': [186, 188], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_video_blob_exists', 'range': [189, 201], 'children': [{'type': 'Condition', 'name': 'video_blob.exists()', 'range': [190, 195], 'children': []}, {'type': 'ReturnStatement', 'name': 'return_video_blob_public_url', 'range': [197, 201], 'children': [{'type': 'FunctionCall', 'name': 'video_blob.public_url', 'range': [198, 201], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return_none', 'range': [203, 205], 'children': [{'type': 'NoneKeyword', 'name': 'None', 'range': [204, 205], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [206, 222], 'children': [{'type': 'Exception', 'name': 'Exception', 'range': [207, 209], 'children': []}, {'type': 'Assignment', 'name': 'e_assignment', 'range': [208, 210], 'children': [{'type': 'Variable', 'name': 'e', 'range': [209, 210], 'children': []}]}, {'type': 'FunctionCall', 'name': 'logger.error', 'range': [212, 218], 'children': [{'type': 'Argument', 'name': 'f"Error checking if media file exists: {str(e)}"', 'range': [216, 218], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return_none', 'range': [220, 222], 'children': [{'type': 'NoneKeyword', 'name': 'None', 'range': [221, 222], 'children': []}]}]}]}]}]}]}
2025-01-08 10:16:17,217 - INFO - Starting Step 4: AST normalization
2025-01-08 10:16:17,627 - INFO - Step 4 result: {'top_level_declarations': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportPath', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportPath', 'name': 'os', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 8], 'children': [{'type': 'ImportPath', 'name': 'uuid', 'range': [7, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [10, 12], 'children': [{'type': 'ImportPath', 'name': 'fastapi', 'range': [11, 11], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 19], 'children': [{'type': 'FromImport', 'name': 'google.cloud', 'range': [14, 17], 'children': []}, {'type': 'ImportPath', 'name': 'storage', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 31], 'children': [{'type': 'ImportPath', 'name': 'backend.server.v2.store.exceptions', 'range': [22, 30], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [32, 40], 'children': [{'type': 'FromImport', 'name': 'backend.util.settings', 'range': [33, 37], 'children': []}, {'type': 'ImportPath', 'name': 'Settings', 'range': [39, 39], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [42, 50], 'children': [{'type': 'Assignment', 'name': '=', 'range': [43, 43], 'children': [{'type': 'CallExpression', 'name': 'logging.getLogger', 'range': [44, 49], 'children': [{'type': 'Argument', 'name': '__name__', 'range': [48, 48], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'ALLOWED_IMAGE_TYPES', 'range': [52, 63], 'children': [{'type': 'Assignment', 'name': '=', 'range': [53, 53], 'children': [{'type': 'SetLiteral', 'name': '', 'range': [54, 62], 'children': [{'type': 'StringLiteral', 'name': '"image/jpeg"', 'range': [55, 55], 'children': []}, {'type': 'StringLiteral', 'name': '"image/png"', 'range': [57, 57], 'children': []}, {'type': 'StringLiteral', 'name': '"image/gif"', 'range': [59, 59], 'children': []}, {'type': 'StringLiteral', 'name': '"image/webp"', 'range': [61, 61], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'ALLOWED_VIDEO_TYPES', 'range': [64, 71], 'children': [{'type': 'Assignment', 'name': '=', 'range': [65, 65], 'children': [{'type': 'SetLiteral', 'name': '', 'range': [66, 70], 'children': [{'type': 'StringLiteral', 'name': '"video/mp4"', 'range': [67, 67], 'children': []}, {'type': 'StringLiteral', 'name': '"video/webm"', 'range': [69, 69], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'MAX_FILE_SIZE', 'range': [72, 82], 'children': [{'type': 'Assignment', 'name': '=', 'range': [73, 73], 'children': [{'type': 'BinaryExpression', 'name': '*', 'range': [75, 75], 'children': [{'type': 'BinaryExpression', 'name': '*', 'range': [77, 77], 'children': [{'type': 'NumericLiteral', 'name': '50', 'range': [74, 74], 'children': []}, {'type': 'NumericLiteral', 'name': '1024', 'range': [76, 76], 'children': []}]}, {'type': 'NumericLiteral', 'name': '1024', 'range': [78, 78], 'children': []}]}]}]}]}
2025-01-08 10:16:17,627 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:16:42,365 - INFO - Step 5 result: {'type': 'Program', 'name': 'MainOrSomething', 'range': [0, 82], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportPath', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportPath', 'name': 'os', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 8], 'children': [{'type': 'ImportPath', 'name': 'uuid', 'range': [7, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [10, 12], 'children': [{'type': 'ImportPath', 'name': 'fastapi', 'range': [11, 11], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 19], 'children': [{'type': 'FromImport', 'name': 'google.cloud', 'range': [14, 17], 'children': []}, {'type': 'ImportPath', 'name': 'storage', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 31], 'children': [{'type': 'ImportPath', 'name': 'backend.server.v2.store.exceptions', 'range': [22, 30], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [32, 40], 'children': [{'type': 'FromImport', 'name': 'backend.util.settings', 'range': [33, 37], 'children': []}, {'type': 'ImportPath', 'name': 'Settings', 'range': [39, 39], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [42, 50], 'children': [{'type': 'Assignment', 'name': '=', 'range': [43, 43], 'children': [{'type': 'CallExpression', 'name': 'logging.getLogger', 'range': [44, 49], 'children': [{'type': 'Argument', 'name': '__name__', 'range': [48, 48], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'ALLOWED_IMAGE_TYPES', 'range': [52, 63], 'children': [{'type': 'Assignment', 'name': '=', 'range': [53, 53], 'children': [{'type': 'SetLiteral', 'name': '', 'range': [54, 62], 'children': [{'type': 'StringLiteral', 'name': '"image/jpeg"', 'range': [55, 55], 'children': []}, {'type': 'StringLiteral', 'name': '"image/png"', 'range': [57, 57], 'children': []}, {'type': 'StringLiteral', 'name': '"image/gif"', 'range': [59, 59], 'children': []}, {'type': 'StringLiteral', 'name': '"image/webp"', 'range': [61, 61], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'ALLOWED_VIDEO_TYPES', 'range': [64, 71], 'children': [{'type': 'Assignment', 'name': '=', 'range': [65, 65], 'children': [{'type': 'SetLiteral', 'name': '', 'range': [66, 70], 'children': [{'type': 'StringLiteral', 'name': '"video/mp4"', 'range': [67, 67], 'children': []}, {'type': 'StringLiteral', 'name': '"video/webm"', 'range': [69, 69], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'MAX_FILE_SIZE', 'range': [72, 82], 'children': [{'type': 'Assignment', 'name': '=', 'range': [73, 73], 'children': [{'type': 'BinaryExpression', 'name': '*', 'range': [75, 75], 'children': [{'type': 'BinaryExpression', 'name': '*', 'range': [77, 77], 'children': [{'type': 'NumericLiteral', 'name': '50', 'range': [74, 74], 'children': []}, {'type': 'NumericLiteral', 'name': '1024', 'range': [76, 76], 'children': []}]}, {'type': 'NumericLiteral', 'name': '1024', 'range': [78, 78], 'children': []}]}]}]}]}
2025-01-08 10:16:42,365 - INFO - Completed main AST analysis flow
2025-01-08 10:16:42,365 - INFO - Successfully processed chunk
2025-01-08 10:16:56,492 - INFO - Step 4 result: {'type': 'Program', 'name': 'check_media_exists', 'range': [84, 222], 'children': [{'type': 'FunctionDecl', 'name': 'check_media_exists', 'range': [84, 222], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [84, 89], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [85, 88], 'children': []}, {'type': 'Identifier', 'name': 'check_media_exists', 'range': [86, 105], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [87, 95], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [88, 94], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [90, 93], 'children': []}]}, {'type': 'Parameter', 'name': 'filename', 'range': [92, 98], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [94, 97], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [96, 100], 'children': [{'type': 'TypeUnion', 'name': 'str | None', 'range': [98, 100], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [101, 222], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [103, 105], 'children': []}, {'type': 'TryStatement', 'name': 'try_statement', 'range': [107, 222], 'children': [{'type': 'BlockStatement', 'name': 'try_block', 'range': [107, 205], 'children': [{'type': 'AssignmentExpression', 'name': 'settings_assignment', 'range': [110, 114], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [110, 117], 'children': []}, {'type': 'CallExpression', 'name': 'Settings', 'range': [112, 114], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'storage_client_assignment', 'range': [116, 122], 'children': [{'type': 'Identifier', 'name': 'storage_client', 'range': [116, 129], 'children': []}, {'type': 'CallExpression', 'name': 'storage.Client', 'range': [118, 122], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'bucket_assignment', 'range': [124, 135], 'children': [{'type': 'Identifier', 'name': 'bucket', 'range': [124, 130], 'children': []}, {'type': 'CallExpression', 'name': 'storage_client.bucket', 'range': [126, 135], 'children': [{'type': 'Identifier', 'name': 'settings.config.media_gcs_bucket_name', 'range': [130, 135], 'children': []}]}]}, {'type': 'Comment', 'name': 'Check images', 'range': [138, 141], 'children': []}, {'type': 'AssignmentExpression', 'name': 'image_path_assignment', 'range': [142, 146], 'children': [{'type': 'Identifier', 'name': 'image_path', 'range': [142, 152], 'children': []}, {'type': 'Literal', 'name': 'f"users/{user_id}/images/{filename}"', 'range': [144, 146], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'image_blob_assignment', 'range': [147, 155], 'children': [{'type': 'Identifier', 'name': 'image_blob', 'range': [147, 157], 'children': []}, {'type': 'CallExpression', 'name': 'bucket.blob', 'range': [149, 155], 'children': [{'type': 'Identifier', 'name': 'image_path', 'range': [153, 155], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_image_blob_exists', 'range': [156, 168], 'children': [{'type': 'CallExpression', 'name': 'image_blob.exists()', 'range': [157, 162], 'children': []}, {'type': 'ReturnStatement', 'name': 'return_image_blob_public_url', 'range': [164, 168], 'children': [{'type': 'CallExpression', 'name': 'image_blob.public_url', 'range': [165, 168], 'children': []}]}]}, {'type': 'Comment', 'name': 'Check videos', 'range': [170, 173], 'children': []}, {'type': 'AssignmentExpression', 'name': 'video_path_assignment', 'range': [174, 178], 'children': [{'type': 'Identifier', 'name': 'video_path', 'range': [174, 184], 'children': []}, {'type': 'Literal', 'name': 'f"users/{user_id}/videos/{filename}"', 'range': [176, 178], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'video_blob_assignment', 'range': [180, 188], 'children': [{'type': 'Identifier', 'name': 'video_blob', 'range': [180, 190], 'children': []}, {'type': 'CallExpression', 'name': 'bucket.blob', 'range': [182, 188], 'children': [{'type': 'Identifier', 'name': 'video_path', 'range': [186, 188], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_video_blob_exists', 'range': [189, 201], 'children': [{'type': 'CallExpression', 'name': 'video_blob.exists()', 'range': [190, 195], 'children': []}, {'type': 'ReturnStatement', 'name': 'return_video_blob_public_url', 'range': [197, 201], 'children': [{'type': 'CallExpression', 'name': 'video_blob.public_url', 'range': [198, 201], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return_none', 'range': [203, 205], 'children': [{'type': 'Literal', 'name': 'None', 'range': [204, 205], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except_block', 'range': [206, 222], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [207, 209], 'children': []}, {'type': 'AssignmentExpression', 'name': 'e_assignment', 'range': [208, 210], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [209, 210], 'children': []}]}, {'type': 'CallExpression', 'name': 'logger.error', 'range': [212, 218], 'children': [{'type': 'Literal', 'name': 'f"Error checking if media file exists: {str(e)}"', 'range': [216, 218], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return_none', 'range': [220, 222], 'children': [{'type': 'Literal', 'name': 'None', 'range': [221, 222], 'children': []}]}]}]}]}]}]}
2025-01-08 10:16:56,493 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:17:02,686 - ERROR - Failed to parse Step 2 result
2025-01-08 10:17:02,686 - INFO - Starting Step 3: AST simplification
2025-01-08 10:17:33,061 - INFO - Step 5 result: {'type': 'Program', 'name': 'check_media_exists', 'range': [84, 222], 'children': [{'type': 'FunctionDecl', 'name': 'check_media_exists', 'range': [84, 222], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [84, 89], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [85, 88], 'children': []}, {'type': 'Identifier', 'name': 'check_media_exists', 'range': [86, 105], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [87, 95], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [88, 94], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [90, 93], 'children': []}]}, {'type': 'Parameter', 'name': 'filename', 'range': [92, 98], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [94, 97], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [96, 100], 'children': [{'type': 'TypeUnion', 'name': 'str | None', 'range': [98, 100], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [101, 222], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [103, 105], 'children': []}, {'type': 'TryStatement', 'name': 'try_statement', 'range': [107, 222], 'children': [{'type': 'BlockStatement', 'name': 'try_block', 'range': [107, 205], 'children': [{'type': 'AssignmentExpression', 'name': 'settings_assignment', 'range': [110, 114], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [110, 117], 'children': []}, {'type': 'CallExpression', 'name': 'Settings', 'range': [112, 114], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'storage_client_assignment', 'range': [116, 122], 'children': [{'type': 'Identifier', 'name': 'storage_client', 'range': [116, 129], 'children': []}, {'type': 'CallExpression', 'name': 'storage.Client', 'range': [118, 122], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'bucket_assignment', 'range': [124, 135], 'children': [{'type': 'Identifier', 'name': 'bucket', 'range': [124, 130], 'children': []}, {'type': 'CallExpression', 'name': 'storage_client.bucket', 'range': [126, 135], 'children': [{'type': 'Identifier', 'name': 'settings.config.media_gcs_bucket_name', 'range': [130, 135], 'children': []}]}]}, {'type': 'Comment', 'name': 'Check images', 'range': [138, 141], 'children': []}, {'type': 'AssignmentExpression', 'name': 'image_path_assignment', 'range': [142, 146], 'children': [{'type': 'Identifier', 'name': 'image_path', 'range': [142, 152], 'children': []}, {'type': 'Literal', 'name': 'f"users/{user_id}/images/{filename}"', 'range': [144, 146], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'image_blob_assignment', 'range': [147, 155], 'children': [{'type': 'Identifier', 'name': 'image_blob', 'range': [147, 157], 'children': []}, {'type': 'CallExpression', 'name': 'bucket.blob', 'range': [149, 155], 'children': [{'type': 'Identifier', 'name': 'image_path', 'range': [153, 155], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_image_blob_exists', 'range': [156, 168], 'children': [{'type': 'CallExpression', 'name': 'image_blob.exists()', 'range': [157, 162], 'children': []}, {'type': 'ReturnStatement', 'name': 'return_image_blob_public_url', 'range': [164, 168], 'children': [{'type': 'CallExpression', 'name': 'image_blob.public_url', 'range': [165, 168], 'children': []}]}]}, {'type': 'Comment', 'name': 'Check videos', 'range': [170, 173], 'children': []}, {'type': 'AssignmentExpression', 'name': 'video_path_assignment', 'range': [174, 178], 'children': [{'type': 'Identifier', 'name': 'video_path', 'range': [174, 184], 'children': []}, {'type': 'Literal', 'name': 'f"users/{user_id}/videos/{filename}"', 'range': [176, 178], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'video_blob_assignment', 'range': [180, 188], 'children': [{'type': 'Identifier', 'name': 'video_blob', 'range': [180, 190], 'children': []}, {'type': 'CallExpression', 'name': 'bucket.blob', 'range': [182, 188], 'children': [{'type': 'Identifier', 'name': 'video_path', 'range': [186, 188], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_video_blob_exists', 'range': [189, 201], 'children': [{'type': 'CallExpression', 'name': 'video_blob.exists()', 'range': [190, 195], 'children': []}, {'type': 'ReturnStatement', 'name': 'return_video_blob_public_url', 'range': [197, 201], 'children': [{'type': 'CallExpression', 'name': 'video_blob.public_url', 'range': [198, 201], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return_none', 'range': [203, 205], 'children': [{'type': 'Literal', 'name': 'None', 'range': [204, 205], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except_block', 'range': [206, 222], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [207, 209], 'children': []}, {'type': 'AssignmentExpression', 'name': 'e_assignment', 'range': [208, 210], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [209, 210], 'children': []}]}, {'type': 'CallExpression', 'name': 'logger.error', 'range': [212, 218], 'children': [{'type': 'Literal', 'name': 'f"Error checking if media file exists: {str(e)}"', 'range': [216, 218], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return_none', 'range': [220, 222], 'children': [{'type': 'Literal', 'name': 'None', 'range': [221, 222], 'children': []}]}]}]}]}]}]}
2025-01-08 10:17:33,061 - INFO - Completed main AST analysis flow
2025-01-08 10:17:33,061 - INFO - Successfully processed chunk
2025-01-08 10:19:09,551 - ERROR - Failed to parse Step 3 result
2025-01-08 10:19:09,552 - INFO - Starting Step 4: AST normalization
2025-01-08 10:19:12,053 - INFO - Step 4 result: {'type': 'Program', 'name': 'Program', 'range': [0, 0], 'children': []}
2025-01-08 10:19:12,053 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:19:13,731 - INFO - Step 5 result: {'type': 'Program', 'name': 'Program', 'range': [0, 0], 'children': []}
2025-01-08 10:19:13,731 - INFO - Completed main AST analysis flow
2025-01-08 10:19:13,732 - INFO - Successfully processed chunk
2025-01-08 10:19:13,792 - INFO - Starting code generation from AST
2025-01-08 10:19:21,456 - INFO - Successfully generated code from AST
2025-01-08 10:19:21,459 - INFO - Starting static code similarity comparison
2025-01-08 10:19:21,472 - INFO - Static similarity result: {'final_score': 43.33, 'length_similarity': 19.74, 'token_similarity': 40.8, 'structure_similarity': 23.49, 'function_similarity': 100, 'complexity_similarity': 22.58, 'variable_similarity': 100}
