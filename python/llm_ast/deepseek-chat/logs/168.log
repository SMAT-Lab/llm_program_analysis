2025-01-08 10:27:27,447 - INFO - Processing sample 168
2025-01-08 10:27:27,447 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 10:27:33,396 - INFO - Successfully split code into 3 top-level declarations
2025-01-08 10:27:33,397 - INFO - Processing chunk #0 (size=105 chars, start_index=0)
2025-01-08 10:27:33,398 - INFO - Processing chunk with 105 chars starting at index 0
2025-01-08 10:27:33,398 - INFO - Starting main AST analysis flow
2025-01-08 10:27:33,398 - INFO - Tokenized code into 23 tokens
2025-01-08 10:27:33,398 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:33,398 - INFO - Processing chunk #1 (size=563 chars, start_index=23)
2025-01-08 10:27:33,399 - INFO - Processing chunk with 563 chars starting at index 23
2025-01-08 10:27:33,399 - INFO - Starting main AST analysis flow
2025-01-08 10:27:33,400 - INFO - Tokenized code into 95 tokens
2025-01-08 10:27:33,400 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:33,404 - INFO - Processing chunk #2 (size=862 chars, start_index=118)
2025-01-08 10:27:33,404 - INFO - Processing chunk with 862 chars starting at index 118
2025-01-08 10:27:33,404 - INFO - Starting main AST analysis flow
2025-01-08 10:27:33,404 - INFO - Tokenized code into 161 tokens
2025-01-08 10:27:33,405 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:36,279 - INFO - Step 1 result: {'type': 'Program', 'name': 'check_rate_limit', 'range': [118, 278], 'children': []}
2025-01-08 10:27:36,279 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:27:38,229 - INFO - Step 1 result: {'type': 'Program', 'name': 'RateLimiter', 'range': [23, 117], 'children': [{'type': 'FunctionDeclaration', 'name': '__init__', 'range': [27, 116], 'children': []}]}
2025-01-08 10:27:38,258 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:27:41,042 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 22], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'time', 'range': [0, 1]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 7], 'children': [{'type': 'ImportSpecifier', 'name': 'Tuple', 'range': [5, 6]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 13], 'children': [{'type': 'ImportSpecifier', 'name': 'Redis', 'range': [11, 12]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [15, 20], 'children': [{'type': 'ImportSpecifier', 'name': 'RATE_LIMIT_SETTINGS', 'range': [18, 19]}]}]}
2025-01-08 10:27:41,067 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:02,264 - INFO - Step 2 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'time', 'range': [0, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 7], 'children': [{'type': 'ImportSpecifier', 'name': 'Tuple', 'range': [5, 6], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 13], 'children': [{'type': 'ImportSpecifier', 'name': 'Redis', 'range': [11, 12], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [15, 20], 'children': [{'type': 'ImportSpecifier', 'name': 'RATE_LIMIT_SETTINGS', 'range': [18, 19], 'children': []}]}]}
2025-01-08 10:28:02,264 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:02,417 - INFO - Step 2 result: {'type': 'Program', 'name': 'RateLimiter', 'range': [23, 117], 'children': [{'type': 'FunctionDeclaration', 'name': '__init__', 'range': [27, 116], 'children': [{'type': 'ParameterList', 'name': '', 'range': [29, 70], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [31, 31], 'children': []}, {'type': 'Parameter', 'name': 'redis_host', 'range': [34, 40], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [35, 36], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_host', 'range': [37, 40], 'children': []}]}, {'type': 'Parameter', 'name': 'redis_port', 'range': [43, 49], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [44, 45], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_port', 'range': [46, 49], 'children': []}]}, {'type': 'Parameter', 'name': 'redis_password', 'range': [52, 58], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [53, 54], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_password', 'range': [55, 58], 'children': []}]}, {'type': 'Parameter', 'name': 'requests_per_minute', 'range': [61, 67], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [62, 63], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.requests_per_minute', 'range': [64, 67], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [72, 116], 'children': [{'type': 'AssignmentExpression', 'name': 'self.redis', 'range': [73, 103], 'children': [{'type': 'CallExpression', 'name': 'Redis', 'range': [77, 103], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [78, 103], 'children': [{'type': 'Argument', 'name': 'host=redis_host', 'range': [80, 82], 'children': []}, {'type': 'Argument', 'name': 'port=int(redis_port)', 'range': [85, 90], 'children': []}, {'type': 'Argument', 'name': 'password=redis_password', 'range': [93, 95], 'children': []}, {'type': 'Argument', 'name': 'decode_responses=True', 'range': [98, 100], 'children': []}]}]}]}, {'type': 'AssignmentExpression', 'name': 'self.window', 'range': [105, 109], 'children': [{'type': 'Literal', 'name': '60', 'range': [108, 109], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'self.max_requests', 'range': [111, 115], 'children': [{'type': 'Identifier', 'name': 'requests_per_minute', 'range': [114, 115], 'children': []}]}]}]}]}
2025-01-08 10:28:02,460 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:08,668 - INFO - Step 2 result: {'type': 'Program', 'name': 'check_rate_limit', 'range': [118, 278], 'children': [{'type': 'FunctionDeclaration', 'name': 'check_rate_limit', 'range': [118, 278], 'children': [{'type': 'FunctionSignature', 'name': 'check_rate_limit', 'range': [118, 138], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [118, 118], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [119, 119], 'children': []}, {'type': 'Identifier', 'name': 'check_rate_limit', 'range': [120, 120], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [121, 121], 'children': []}, {'type': 'Parameter', 'name': 'self', 'range': [122, 122], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [123, 123], 'children': []}, {'type': 'Parameter', 'name': 'api_key_id', 'range': [124, 124], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [125, 125], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [126, 126], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [127, 127], 'children': []}, {'type': 'Punctuation', 'name': '-', 'range': [128, 128], 'children': []}, {'type': 'Punctuation', 'name': '>', 'range': [129, 129], 'children': []}, {'type': 'TypeAnnotation', 'name': 'Tuple', 'range': [130, 130], 'children': []}, {'type': 'Punctuation', 'name': '[', 'range': [131, 131], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [132, 132], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [133, 133], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [134, 134], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [135, 135], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [136, 136], 'children': []}, {'type': 'Punctuation', 'name': ']', 'range': [137, 137], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [138, 138], 'children': []}]}, {'type': 'FunctionBody', 'name': 'check_rate_limit', 'range': [139, 278], 'children': [{'type': 'Docstring', 'name': 'Docstring', 'range': [140, 142], 'children': []}, {'type': 'Statement', 'name': 'now = time.time()', 'range': [144, 150], 'children': []}, {'type': 'Statement', 'name': 'window_start = now - self.window', 'range': [152, 158], 'children': []}, {'type': 'Statement', 'name': 'key = f"ratelimit:{api_key_id}:1min"', 'range': [160, 163], 'children': []}, {'type': 'Statement', 'name': 'pipe = self.redis.pipeline()', 'range': [166, 174], 'children': []}, {'type': 'Statement', 'name': 'pipe.zremrangebyscore(key, 0, window_start)', 'range': [176, 185], 'children': []}, {'type': 'Statement', 'name': 'pipe.zadd(key, {str(now): now})', 'range': [187, 201], 'children': []}, {'type': 'Statement', 'name': 'pipe.zcount(key, window_start, now)', 'range': [203, 212], 'children': []}, {'type': 'Statement', 'name': 'pipe.expire(key, self.window)', 'range': [214, 223], 'children': []}, {'type': 'Statement', 'name': '_, _, request_count, _ = pipe.execute()', 'range': [226, 238], 'children': []}, {'type': 'Statement', 'name': 'remaining = max(0, self.max_requests - request_count)', 'range': [241, 252], 'children': []}, {'type': 'Statement', 'name': 'reset_time = int(now + self.window)', 'range': [254, 263], 'children': []}, {'type': 'Statement', 'name': 'return request_count <= self.max_requests, remaining, reset_time', 'range': [266, 276], 'children': []}]}]}]}
2025-01-08 10:28:08,683 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:15,071 - INFO - Step 3 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'time', 'range': [0, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 7], 'children': [{'type': 'ImportSpecifier', 'name': 'Tuple', 'range': [5, 6], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 13], 'children': [{'type': 'ImportSpecifier', 'name': 'Redis', 'range': [11, 12], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [15, 20], 'children': [{'type': 'ImportSpecifier', 'name': 'RATE_LIMIT_SETTINGS', 'range': [18, 19], 'children': []}]}]}
2025-01-08 10:28:15,114 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:24,911 - INFO - Step 4 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'time', 'range': [0, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 7], 'children': [{'type': 'ImportSpecifier', 'name': 'Tuple', 'range': [5, 6], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 13], 'children': [{'type': 'ImportSpecifier', 'name': 'Redis', 'range': [11, 12], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [15, 20], 'children': [{'type': 'ImportSpecifier', 'name': 'RATE_LIMIT_SETTINGS', 'range': [18, 19], 'children': []}]}]}
2025-01-08 10:28:24,911 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:28,500 - INFO - Step 3 result: {'type': 'Program', 'name': 'RateLimiter', 'range': [23, 117], 'children': [{'type': 'FunctionDeclaration', 'name': '__init__', 'range': [27, 116], 'children': [{'type': 'ParameterList', 'name': '', 'range': [29, 70], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [31, 31], 'children': []}, {'type': 'Parameter', 'name': 'redis_host', 'range': [34, 40], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [35, 36], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_host', 'range': [37, 40], 'children': []}]}, {'type': 'Parameter', 'name': 'redis_port', 'range': [43, 49], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [44, 45], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_port', 'range': [46, 49], 'children': []}]}, {'type': 'Parameter', 'name': 'redis_password', 'range': [52, 58], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [53, 54], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_password', 'range': [55, 58], 'children': []}]}, {'type': 'Parameter', 'name': 'requests_per_minute', 'range': [61, 67], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [62, 63], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.requests_per_minute', 'range': [64, 67], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [72, 116], 'children': [{'type': 'AssignmentExpression', 'name': 'self.redis', 'range': [73, 103], 'children': [{'type': 'CallExpression', 'name': 'Redis', 'range': [77, 103], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [78, 103], 'children': [{'type': 'Argument', 'name': 'host=redis_host', 'range': [80, 82], 'children': []}, {'type': 'Argument', 'name': 'port=int(redis_port)', 'range': [85, 90], 'children': []}, {'type': 'Argument', 'name': 'password=redis_password', 'range': [93, 95], 'children': []}, {'type': 'Argument', 'name': 'decode_responses=True', 'range': [98, 100], 'children': []}]}]}]}, {'type': 'AssignmentExpression', 'name': 'self.window', 'range': [105, 109], 'children': [{'type': 'Literal', 'name': '60', 'range': [108, 109], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'self.max_requests', 'range': [111, 115], 'children': [{'type': 'Identifier', 'name': 'requests_per_minute', 'range': [114, 115], 'children': []}]}]}]}]}
2025-01-08 10:28:28,509 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:31,757 - INFO - Step 5 result: {'nodes': [{'type': 'Program', 'name': 'MainOrSomething', 'range': [0, 20], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'time', 'range': [0, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 7], 'children': [{'type': 'ImportSpecifier', 'name': 'Tuple', 'range': [5, 6], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 13], 'children': [{'type': 'ImportSpecifier', 'name': 'Redis', 'range': [11, 12], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [15, 20], 'children': [{'type': 'ImportSpecifier', 'name': 'RATE_LIMIT_SETTINGS', 'range': [18, 19], 'children': []}]}]}]}
2025-01-08 10:28:31,757 - INFO - Completed main AST analysis flow
2025-01-08 10:28:31,757 - INFO - Successfully processed chunk
2025-01-08 10:28:35,545 - INFO - Step 3 result: {'type': 'Program', 'name': 'check_rate_limit', 'range': [118, 278], 'children': [{'type': 'FunctionDeclaration', 'name': 'check_rate_limit', 'range': [118, 278], 'children': [{'type': 'FunctionSignature', 'name': 'check_rate_limit', 'range': [118, 138], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [118, 118], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [119, 119], 'children': []}, {'type': 'Identifier', 'name': 'check_rate_limit', 'range': [120, 120], 'children': []}, {'type': 'Parameter', 'name': 'self', 'range': [122, 122], 'children': []}, {'type': 'Parameter', 'name': 'api_key_id', 'range': [124, 124], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [126, 126], 'children': []}, {'type': 'TypeAnnotation', 'name': 'Tuple', 'range': [130, 130], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [132, 132], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [134, 134], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [136, 136], 'children': []}]}, {'type': 'FunctionBody', 'name': 'check_rate_limit', 'range': [139, 278], 'children': [{'type': 'Docstring', 'name': 'Docstring', 'range': [140, 142], 'children': []}, {'type': 'Statement', 'name': 'now = time.time()', 'range': [144, 150], 'children': []}, {'type': 'Statement', 'name': 'window_start = now - self.window', 'range': [152, 158], 'children': []}, {'type': 'Statement', 'name': 'key = f"ratelimit:{api_key_id}:1min"', 'range': [160, 163], 'children': []}, {'type': 'Statement', 'name': 'pipe = self.redis.pipeline()', 'range': [166, 174], 'children': []}, {'type': 'Statement', 'name': 'pipe.zremrangebyscore(key, 0, window_start)', 'range': [176, 185], 'children': []}, {'type': 'Statement', 'name': 'pipe.zadd(key, {str(now): now})', 'range': [187, 201], 'children': []}, {'type': 'Statement', 'name': 'pipe.zcount(key, window_start, now)', 'range': [203, 212], 'children': []}, {'type': 'Statement', 'name': 'pipe.expire(key, self.window)', 'range': [214, 223], 'children': []}, {'type': 'Statement', 'name': '_, _, request_count, _ = pipe.execute()', 'range': [226, 238], 'children': []}, {'type': 'Statement', 'name': 'remaining = max(0, self.max_requests - request_count)', 'range': [241, 252], 'children': []}, {'type': 'Statement', 'name': 'reset_time = int(now + self.window)', 'range': [254, 263], 'children': []}, {'type': 'Statement', 'name': 'return request_count <= self.max_requests, remaining, reset_time', 'range': [266, 276], 'children': []}]}]}]}
2025-01-08 10:28:35,545 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:47,885 - INFO - Step 4 result: {'type': 'Program', 'name': 'RateLimiter', 'range': [23, 117], 'children': [{'type': 'FunctionDecl', 'name': '__init__', 'range': [27, 116], 'children': [{'type': 'ParameterList', 'name': '', 'range': [29, 70], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [31, 31], 'children': []}, {'type': 'Parameter', 'name': 'redis_host', 'range': [34, 40], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [35, 36], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_host', 'range': [37, 40], 'children': []}]}, {'type': 'Parameter', 'name': 'redis_port', 'range': [43, 49], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [44, 45], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_port', 'range': [46, 49], 'children': []}]}, {'type': 'Parameter', 'name': 'redis_password', 'range': [52, 58], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [53, 54], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_password', 'range': [55, 58], 'children': []}]}, {'type': 'Parameter', 'name': 'requests_per_minute', 'range': [61, 67], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [62, 63], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.requests_per_minute', 'range': [64, 67], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [72, 116], 'children': [{'type': 'AssignmentExpression', 'name': 'self.redis', 'range': [73, 103], 'children': [{'type': 'CallExpression', 'name': 'Redis', 'range': [77, 103], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [78, 103], 'children': [{'type': 'Argument', 'name': 'host=redis_host', 'range': [80, 82], 'children': []}, {'type': 'Argument', 'name': 'port=int(redis_port)', 'range': [85, 90], 'children': []}, {'type': 'Argument', 'name': 'password=redis_password', 'range': [93, 95], 'children': []}, {'type': 'Argument', 'name': 'decode_responses=True', 'range': [98, 100], 'children': []}]}]}]}, {'type': 'AssignmentExpression', 'name': 'self.window', 'range': [105, 109], 'children': [{'type': 'Literal', 'name': '60', 'range': [108, 109], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'self.max_requests', 'range': [111, 115], 'children': [{'type': 'Identifier', 'name': 'requests_per_minute', 'range': [114, 115], 'children': []}]}]}]}]}
2025-01-08 10:28:47,885 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:55,458 - INFO - Step 4 result: {'type': 'Program', 'name': 'check_rate_limit', 'range': [118, 278], 'children': [{'type': 'FunctionDecl', 'name': 'check_rate_limit', 'range': [118, 278], 'children': [{'type': 'FunctionSignature', 'name': 'check_rate_limit', 'range': [118, 138], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [118, 118], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [119, 119], 'children': []}, {'type': 'Identifier', 'name': 'check_rate_limit', 'range': [120, 120], 'children': []}, {'type': 'Parameter', 'name': 'self', 'range': [122, 122], 'children': []}, {'type': 'Parameter', 'name': 'api_key_id', 'range': [124, 124], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [126, 126], 'children': []}, {'type': 'TypeAnnotation', 'name': 'Tuple', 'range': [130, 130], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [132, 132], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [134, 134], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [136, 136], 'children': []}]}, {'type': 'FunctionBody', 'name': 'check_rate_limit', 'range': [139, 278], 'children': [{'type': 'Docstring', 'name': 'Docstring', 'range': [140, 142], 'children': []}, {'type': 'AssignmentExpression', 'name': 'now = time.time()', 'range': [144, 150], 'children': []}, {'type': 'AssignmentExpression', 'name': 'window_start = now - self.window', 'range': [152, 158], 'children': []}, {'type': 'AssignmentExpression', 'name': 'key = f"ratelimit:{api_key_id}:1min"', 'range': [160, 163], 'children': []}, {'type': 'AssignmentExpression', 'name': 'pipe = self.redis.pipeline()', 'range': [166, 174], 'children': []}, {'type': 'CallExpression', 'name': 'pipe.zremrangebyscore(key, 0, window_start)', 'range': [176, 185], 'children': []}, {'type': 'CallExpression', 'name': 'pipe.zadd(key, {str(now): now})', 'range': [187, 201], 'children': []}, {'type': 'CallExpression', 'name': 'pipe.zcount(key, window_start, now)', 'range': [203, 212], 'children': []}, {'type': 'CallExpression', 'name': 'pipe.expire(key, self.window)', 'range': [214, 223], 'children': []}, {'type': 'AssignmentExpression', 'name': '_, _, request_count, _ = pipe.execute()', 'range': [226, 238], 'children': []}, {'type': 'AssignmentExpression', 'name': 'remaining = max(0, self.max_requests - request_count)', 'range': [241, 252], 'children': []}, {'type': 'AssignmentExpression', 'name': 'reset_time = int(now + self.window)', 'range': [254, 263], 'children': []}, {'type': 'ReturnStatement', 'name': 'return request_count <= self.max_requests, remaining, reset_time', 'range': [266, 276], 'children': []}]}]}]}
2025-01-08 10:28:55,458 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:07,735 - INFO - Step 5 result: {'type': 'Program', 'name': 'RateLimiter', 'range': [23, 117], 'children': [{'type': 'FunctionDecl', 'name': '__init__', 'range': [27, 116], 'children': [{'type': 'ParameterList', 'name': '', 'range': [29, 70], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [31, 31], 'children': []}, {'type': 'Parameter', 'name': 'redis_host', 'range': [34, 40], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [35, 36], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_host', 'range': [37, 40], 'children': []}]}, {'type': 'Parameter', 'name': 'redis_port', 'range': [43, 49], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [44, 45], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_port', 'range': [46, 49], 'children': []}]}, {'type': 'Parameter', 'name': 'redis_password', 'range': [52, 58], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [53, 54], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.redis_password', 'range': [55, 58], 'children': []}]}, {'type': 'Parameter', 'name': 'requests_per_minute', 'range': [61, 67], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [62, 63], 'children': []}, {'type': 'DefaultValue', 'name': 'RATE_LIMIT_SETTINGS.requests_per_minute', 'range': [64, 67], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [72, 116], 'children': [{'type': 'AssignmentExpression', 'name': 'self.redis', 'range': [73, 103], 'children': [{'type': 'CallExpression', 'name': 'Redis', 'range': [77, 103], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [78, 103], 'children': [{'type': 'Argument', 'name': 'host=redis_host', 'range': [80, 82], 'children': []}, {'type': 'Argument', 'name': 'port=int(redis_port)', 'range': [85, 90], 'children': []}, {'type': 'Argument', 'name': 'password=redis_password', 'range': [93, 95], 'children': []}, {'type': 'Argument', 'name': 'decode_responses=True', 'range': [98, 100], 'children': []}]}]}]}, {'type': 'AssignmentExpression', 'name': 'self.window', 'range': [105, 109], 'children': [{'type': 'Literal', 'name': '60', 'range': [108, 109], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'self.max_requests', 'range': [111, 115], 'children': [{'type': 'Identifier', 'name': 'requests_per_minute', 'range': [114, 115], 'children': []}]}]}]}]}
2025-01-08 10:29:07,735 - INFO - Completed main AST analysis flow
2025-01-08 10:29:07,735 - INFO - Successfully processed chunk
2025-01-08 10:29:15,385 - INFO - Step 5 result: {'type': 'Program', 'name': 'check_rate_limit', 'range': [118, 278], 'children': [{'type': 'FunctionDecl', 'name': 'check_rate_limit', 'range': [118, 278], 'children': [{'type': 'FunctionSignature', 'name': 'check_rate_limit', 'range': [118, 138], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [118, 118], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [119, 119], 'children': []}, {'type': 'Identifier', 'name': 'check_rate_limit', 'range': [120, 120], 'children': []}, {'type': 'Parameter', 'name': 'self', 'range': [122, 122], 'children': []}, {'type': 'Parameter', 'name': 'api_key_id', 'range': [124, 124], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [126, 126], 'children': []}, {'type': 'TypeAnnotation', 'name': 'Tuple', 'range': [130, 130], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [132, 132], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [134, 134], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [136, 136], 'children': []}]}, {'type': 'FunctionBody', 'name': 'check_rate_limit', 'range': [139, 278], 'children': [{'type': 'Docstring', 'name': 'Docstring', 'range': [140, 142], 'children': []}, {'type': 'AssignmentExpression', 'name': 'now = time.time()', 'range': [144, 150], 'children': []}, {'type': 'AssignmentExpression', 'name': 'window_start = now - self.window', 'range': [152, 158], 'children': []}, {'type': 'AssignmentExpression', 'name': 'key = f"ratelimit:{api_key_id}:1min"', 'range': [160, 163], 'children': []}, {'type': 'AssignmentExpression', 'name': 'pipe = self.redis.pipeline()', 'range': [166, 174], 'children': []}, {'type': 'CallExpression', 'name': 'pipe.zremrangebyscore(key, 0, window_start)', 'range': [176, 185], 'children': []}, {'type': 'CallExpression', 'name': 'pipe.zadd(key, {str(now): now})', 'range': [187, 201], 'children': []}, {'type': 'CallExpression', 'name': 'pipe.zcount(key, window_start, now)', 'range': [203, 212], 'children': []}, {'type': 'CallExpression', 'name': 'pipe.expire(key, self.window)', 'range': [214, 223], 'children': []}, {'type': 'AssignmentExpression', 'name': '_, _, request_count, _ = pipe.execute()', 'range': [226, 238], 'children': []}, {'type': 'AssignmentExpression', 'name': 'remaining = max(0, self.max_requests - request_count)', 'range': [241, 252], 'children': []}, {'type': 'AssignmentExpression', 'name': 'reset_time = int(now + self.window)', 'range': [254, 263], 'children': []}, {'type': 'ReturnStatement', 'name': 'return request_count <= self.max_requests, remaining, reset_time', 'range': [266, 276], 'children': []}]}]}]}
2025-01-08 10:29:15,385 - INFO - Completed main AST analysis flow
2025-01-08 10:29:15,386 - INFO - Successfully processed chunk
2025-01-08 10:29:15,397 - INFO - Starting code generation from AST
2025-01-08 10:29:23,089 - INFO - Successfully generated code from AST
2025-01-08 10:29:23,089 - INFO - Starting static code similarity comparison
2025-01-08 10:29:23,092 - INFO - Static similarity result: {'final_score': 93.03, 'length_similarity': 94.46, 'token_similarity': 94.12, 'structure_similarity': 82.5, 'function_similarity': 100, 'complexity_similarity': 100.0, 'variable_similarity': 100}
