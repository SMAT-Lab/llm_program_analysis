2025-01-08 10:14:47,353 - INFO - Processing sample 136
2025-01-08 10:14:47,353 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 10:14:50,993 - INFO - Successfully split code into 5 top-level declarations
2025-01-08 10:14:50,996 - INFO - Processing chunk #0 (size=325 chars, start_index=0)
2025-01-08 10:14:50,996 - INFO - Processing chunk with 325 chars starting at index 0
2025-01-08 10:14:50,997 - INFO - Starting main AST analysis flow
2025-01-08 10:14:50,997 - INFO - Tokenized code into 63 tokens
2025-01-08 10:14:50,997 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:14:51,001 - INFO - Processing chunk #1 (size=2986 chars, start_index=63)
2025-01-08 10:14:51,005 - INFO - Processing chunk with 2986 chars starting at index 63
2025-01-08 10:14:51,005 - INFO - Starting main AST analysis flow
2025-01-08 10:14:51,006 - INFO - Tokenized code into 458 tokens
2025-01-08 10:14:51,006 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:14:51,012 - INFO - Processing chunk #2 (size=1254 chars, start_index=521)
2025-01-08 10:14:51,012 - INFO - Processing chunk with 1254 chars starting at index 521
2025-01-08 10:14:51,012 - INFO - Starting main AST analysis flow
2025-01-08 10:14:51,013 - INFO - Tokenized code into 214 tokens
2025-01-08 10:14:51,013 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:14:51,018 - INFO - Processing chunk #3 (size=1086 chars, start_index=735)
2025-01-08 10:14:51,018 - INFO - Processing chunk with 1086 chars starting at index 735
2025-01-08 10:14:51,018 - INFO - Starting main AST analysis flow
2025-01-08 10:14:51,019 - INFO - Tokenized code into 168 tokens
2025-01-08 10:14:51,019 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:14:51,024 - INFO - Processing chunk #4 (size=462 chars, start_index=903)
2025-01-08 10:14:51,024 - INFO - Processing chunk with 462 chars starting at index 903
2025-01-08 10:14:51,024 - INFO - Starting main AST analysis flow
2025-01-08 10:14:51,024 - INFO - Tokenized code into 50 tokens
2025-01-08 10:14:51,025 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:14:53,111 - INFO - Step 1 result: {'type': 'Program', 'name': 'validate_payload', 'range': [735, 902], 'children': []}
2025-01-08 10:14:53,111 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:14:53,138 - INFO - Step 1 result: {'type': 'Program', 'name': '_deregister_webhook', 'range': [903, 952], 'children': []}
2025-01-08 10:14:53,139 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:14:53,587 - INFO - Step 1 result: {'type': 'Program', 'name': '_register_webhook', 'range': [521, 734], 'children': []}
2025-01-08 10:14:53,587 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:14:56,925 - INFO - Step 1 result: {'type': 'Program', 'name': 'Slant3DWebhooksManager', 'range': [63, 520], 'children': [{'type': 'ClassDeclaration', 'name': 'Slant3DWebhooksManager', 'range': [63, 520], 'children': [{'type': 'ClassVariableDeclaration', 'name': 'PROVIDER_NAME', 'range': [75, 80], 'children': []}, {'type': 'ClassVariableDeclaration', 'name': 'BASE_URL', 'range': [81, 84], 'children': []}, {'type': 'MethodDeclaration', 'name': '_register_webhook', 'range': [86, 299], 'children': []}, {'type': 'MethodDeclaration', 'name': 'validate_payload', 'range': [301, 468], 'children': []}, {'type': 'MethodDeclaration', 'name': '_deregister_webhook', 'range': [470, 519], 'children': []}]}]}
2025-01-08 10:14:56,925 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:14:57,390 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 62], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 1], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [4, 5], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [7, 10], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 18], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [20, 27], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [31, 38], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [40, 49], 'children': []}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [52, 59], 'children': []}]}
2025-01-08 10:14:57,390 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:15:09,413 - INFO - Step 2 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 1], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [4, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'requests', 'range': [5, 5], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [7, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'Request', 'range': [10, 10], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 18], 'children': [{'type': 'ImportSpecifier', 'name': 'integrations', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [20, 27], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyCredentials', 'range': [27, 27], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Credentials', 'range': [29, 29], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [31, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'ProviderName', 'range': [38, 38], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [40, 49], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseWebhooksManager', 'range': [49, 49], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [52, 59], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [54, 59], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [58, 58], 'children': []}]}]}]}
2025-01-08 10:15:09,413 - INFO - Starting Step 3: AST simplification
2025-01-08 10:15:13,493 - INFO - Step 2 result: {'type': 'Program', 'name': '_deregister_webhook', 'range': [903, 952], 'children': [{'type': 'FunctionDeclaration', 'name': '_deregister_webhook', 'range': [903, 952], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [903, 903], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [904, 904], 'children': []}, {'type': 'Identifier', 'name': '_deregister_webhook', 'range': [905, 905], 'children': []}, {'type': 'Punctuator', 'name': '(', 'range': [906, 906], 'children': []}, {'type': 'Parameter', 'name': 'self', 'range': [908, 908], 'children': []}, {'type': 'Punctuator', 'name': ',', 'range': [909, 909], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [910, 910], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [911, 911], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [912, 912], 'children': []}, {'type': 'Punctuator', 'name': '.', 'range': [913, 913], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [914, 914], 'children': []}]}]}, {'type': 'Punctuator', 'name': ',', 'range': [915, 915], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [916, 916], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [917, 917], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [918, 918], 'children': []}]}]}, {'type': 'Punctuator', 'name': ')', 'range': [920, 920], 'children': []}, {'type': 'ReturnType', 'name': '->', 'range': [921, 922], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [923, 923], 'children': []}]}, {'type': 'Punctuator', 'name': ':', 'range': [924, 924], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [925, 952], 'children': [{'type': 'StringLiteral', 'name': '""" \\n         Note: Slant3D API currently doesn\'t provide a deregistration endpoint. \\n         This would need to be handled through support. \\n         """', 'range': [926, 928], 'children': []}, {'type': 'Comment', 'name': "# Log warning since we can't properly deregister", 'range': [930, 940], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.warning(f"Warning: Manual deregistration required for webhook {webhook.id}")', 'range': [941, 949], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [941, 941], 'children': []}, {'type': 'Punctuator', 'name': '.', 'range': [942, 942], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [943, 943], 'children': []}, {'type': 'Punctuator', 'name': '(', 'range': [944, 944], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Warning: Manual deregistration required for webhook {webhook.id}"', 'range': [946, 947], 'children': []}, {'type': 'Punctuator', 'name': ')', 'range': [949, 949], 'children': []}]}, {'type': 'Keyword', 'name': 'pass', 'range': [951, 951], 'children': []}]}]}]}
2025-01-08 10:15:13,494 - INFO - Starting Step 3: AST simplification
2025-01-08 10:15:20,894 - INFO - Step 3 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 1], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [4, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'requests', 'range': [5, 5], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [7, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'Request', 'range': [10, 10], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 18], 'children': [{'type': 'ImportSpecifier', 'name': 'integrations', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [20, 27], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyCredentials', 'range': [27, 27], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Credentials', 'range': [29, 29], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [31, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'ProviderName', 'range': [38, 38], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [40, 49], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseWebhooksManager', 'range': [49, 49], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [52, 59], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [54, 59], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [58, 58], 'children': []}]}]}]}
2025-01-08 10:15:20,894 - INFO - Starting Step 4: AST normalization
2025-01-08 10:15:21,861 - INFO - Step 2 result: {'type': 'Program', 'name': '_register_webhook', 'range': [521, 734], 'children': [{'type': 'FunctionDeclaration', 'name': '_register_webhook', 'range': [521, 734], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [521, 525], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [522, 525], 'children': []}, {'type': 'FunctionName', 'name': '_register_webhook', 'range': [523, 524], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [524, 562], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [526, 527], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [529, 531], 'children': []}, {'type': 'Parameter', 'name': 'webhook_type', 'range': [534, 536], 'children': []}, {'type': 'Parameter', 'name': 'resource', 'range': [539, 541], 'children': []}, {'type': 'Parameter', 'name': 'events', 'range': [544, 549], 'children': []}, {'type': 'Parameter', 'name': 'ingress_url', 'range': [552, 554], 'children': []}, {'type': 'Parameter', 'name': 'secret', 'range': [557, 559], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple[str, dict]', 'range': [563, 571], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [572, 734], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [573, 575], 'children': []}, {'type': 'IfStatement', 'name': 'if', 'range': [578, 593], 'children': [{'type': 'Condition', 'name': 'not isinstance(credentials, APIKeyCredentials)', 'range': [579, 585], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise ValueError', 'range': [588, 592], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'headers', 'range': [595, 616], 'children': [{'type': 'Dictionary', 'name': 'headers', 'range': [597, 615], 'children': [{'type': 'KeyValuePair', 'name': 'api-key', 'range': [599, 608], 'children': []}, {'type': 'KeyValuePair', 'name': 'Content-Type', 'range': [610, 613], 'children': []}]}]}, {'type': 'Comment', 'name': 'comment', 'range': [618, 632], 'children': []}, {'type': 'VariableDeclaration', 'name': 'payload', 'range': [633, 640], 'children': [{'type': 'Dictionary', 'name': 'payload', 'range': [635, 639], 'children': [{'type': 'KeyValuePair', 'name': 'endPoint', 'range': [636, 638], 'children': []}]}]}, {'type': 'FunctionCall', 'name': 'requests.post', 'range': [642, 661], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [647, 660], 'children': [{'type': 'StringLiteral', 'name': 'f"{self.BASE_URL}/customer/webhookSubscribe"', 'range': [649, 651], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers=headers', 'range': [652, 654], 'children': []}, {'type': 'KeywordArgument', 'name': 'json=payload', 'range': [656, 658], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [663, 691], 'children': [{'type': 'Condition', 'name': 'not response.ok', 'range': [664, 668], 'children': []}, {'type': 'VariableDeclaration', 'name': 'error', 'range': [670, 684], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise RuntimeError', 'range': [685, 690], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'webhook_config', 'range': [693, 728], 'children': [{'type': 'Dictionary', 'name': 'webhook_config', 'range': [695, 727], 'children': [{'type': 'KeyValuePair', 'name': 'endpoint', 'range': [697, 699], 'children': []}, {'type': 'KeyValuePair', 'name': 'provider', 'range': [702, 704], 'children': []}, {'type': 'KeyValuePair', 'name': 'events', 'range': [709, 713], 'children': []}, {'type': 'KeyValuePair', 'name': 'type', 'range': [722, 724], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [730, 734], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [731, 732], 'children': []}, {'type': 'Variable', 'name': 'webhook_config', 'range': [733, 734], 'children': []}]}]}]}]}
2025-01-08 10:15:21,861 - INFO - Starting Step 3: AST simplification
2025-01-08 10:15:24,519 - INFO - Step 2 result: {'type': 'Program', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'ClassMethod', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'FunctionDef', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'Async', 'name': 'async', 'range': [738, 739], 'children': []}, {'type': 'Parameters', 'name': 'parameters', 'range': [741, 755], 'children': [{'type': 'Parameter', 'name': 'cls', 'range': [743, 743], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [745, 749], 'children': []}, {'type': 'Parameter', 'name': 'request', 'range': [751, 753], 'children': []}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [756, 763], 'children': [{'type': 'Type', 'name': 'tuple', 'range': [758, 758], 'children': []}, {'type': 'Type', 'name': 'dict', 'range': [760, 760], 'children': []}, {'type': 'Type', 'name': 'str', 'range': [762, 762], 'children': []}]}, {'type': 'Docstring', 'name': 'docstring', 'range': [766, 768], 'children': []}, {'type': 'Assignment', 'name': 'payload_assignment', 'range': [771, 779], 'children': [{'type': 'Variable', 'name': 'payload', 'range': [771, 771], 'children': []}, {'type': 'Await', 'name': 'await', 'range': [773, 773], 'children': []}, {'type': 'MethodCall', 'name': 'json', 'range': [774, 778], 'children': [{'type': 'Object', 'name': 'request', 'range': [774, 774], 'children': []}]}]}, {'type': 'List', 'name': 'required_fields', 'range': [790, 800], 'children': [{'type': 'String', 'name': 'orderId', 'range': [793, 793], 'children': []}, {'type': 'String', 'name': 'status', 'range': [795, 795], 'children': []}, {'type': 'String', 'name': 'trackingNumber', 'range': [797, 797], 'children': []}, {'type': 'String', 'name': 'carrierCode', 'range': [799, 799], 'children': []}]}, {'type': 'ListComprehension', 'name': 'missing_fields', 'range': [802, 815], 'children': [{'type': 'Variable', 'name': 'field', 'range': [805, 805], 'children': []}, {'type': 'For', 'name': 'for', 'range': [806, 806], 'children': []}, {'type': 'In', 'name': 'in', 'range': [808, 808], 'children': []}, {'type': 'If', 'name': 'if', 'range': [810, 810], 'children': []}, {'type': 'NotIn', 'name': 'not_in', 'range': [812, 813], 'children': []}]}, {'type': 'If', 'name': 'if_missing_fields', 'range': [818, 828], 'children': [{'type': 'Raise', 'name': 'raise', 'range': [822, 822], 'children': []}, {'type': 'Exception', 'name': 'ValueError', 'range': [823, 823], 'children': []}, {'type': 'FString', 'name': 'f_string', 'range': [825, 826], 'children': []}]}, {'type': 'Dict', 'name': 'normalized_payload', 'range': [835, 871], 'children': [{'type': 'KeyValue', 'name': 'orderId', 'range': [839, 845], 'children': [{'type': 'String', 'name': 'orderId', 'range': [839, 839], 'children': []}, {'type': 'Variable', 'name': 'payload', 'range': [841, 841], 'children': []}]}, {'type': 'KeyValue', 'name': 'status', 'range': [847, 853], 'children': [{'type': 'String', 'name': 'status', 'range': [847, 847], 'children': []}, {'type': 'Variable', 'name': 'payload', 'range': [849, 849], 'children': []}]}, {'type': 'KeyValue', 'name': 'trackingNumber', 'range': [855, 861], 'children': [{'type': 'String', 'name': 'trackingNumber', 'range': [855, 855], 'children': []}, {'type': 'Variable', 'name': 'payload', 'range': [857, 857], 'children': []}]}, {'type': 'KeyValue', 'name': 'carrierCode', 'range': [863, 869], 'children': [{'type': 'String', 'name': 'carrierCode', 'range': [863, 863], 'children': []}, {'type': 'Variable', 'name': 'payload', 'range': [865, 865], 'children': []}]}]}, {'type': 'Assignment', 'name': 'event_type_assignment', 'range': [892, 896], 'children': [{'type': 'Variable', 'name': 'event_type', 'range': [892, 892], 'children': []}, {'type': 'FString', 'name': 'f_string', 'range': [894, 895], 'children': []}]}, {'type': 'Return', 'name': 'return', 'range': [898, 902], 'children': [{'type': 'Variable', 'name': 'normalized_payload', 'range': [899, 899], 'children': []}, {'type': 'Variable', 'name': 'event_type', 'range': [901, 901], 'children': []}]}]}]}]}
2025-01-08 10:15:24,520 - INFO - Starting Step 3: AST simplification
2025-01-08 10:15:29,225 - INFO - Step 3 result: {'type': 'Program', 'name': '_deregister_webhook', 'range': [903, 952], 'children': [{'type': 'FunctionDeclaration', 'name': '_deregister_webhook', 'range': [903, 952], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [903, 903], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [904, 904], 'children': []}, {'type': 'Identifier', 'name': '_deregister_webhook', 'range': [905, 905], 'children': []}, {'type': 'Parameter', 'name': 'self', 'range': [908, 908], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [910, 910], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [911, 911], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [912, 912], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [914, 914], 'children': []}]}]}, {'type': 'Parameter', 'name': 'credentials', 'range': [916, 916], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [917, 917], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [918, 918], 'children': []}]}]}, {'type': 'ReturnType', 'name': '->', 'range': [921, 922], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [923, 923], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [925, 952], 'children': [{'type': 'StringLiteral', 'name': '""" \\n         Note: Slant3D API currently doesn\'t provide a deregistration endpoint. \\n         This would need to be handled through support. \\n         """', 'range': [926, 928], 'children': []}, {'type': 'Comment', 'name': "# Log warning since we can't properly deregister", 'range': [930, 940], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.warning(f"Warning: Manual deregistration required for webhook {webhook.id}")', 'range': [941, 949], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [941, 941], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [943, 943], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Warning: Manual deregistration required for webhook {webhook.id}"', 'range': [946, 947], 'children': []}]}, {'type': 'Keyword', 'name': 'pass', 'range': [951, 951], 'children': []}]}]}]}
2025-01-08 10:15:29,225 - INFO - Starting Step 4: AST normalization
2025-01-08 10:15:32,154 - INFO - Step 4 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 1], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [4, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'requests', 'range': [5, 5], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [7, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'Request', 'range': [10, 10], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 18], 'children': [{'type': 'ImportSpecifier', 'name': 'integrations', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [20, 27], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyCredentials', 'range': [27, 27], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Credentials', 'range': [29, 29], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [31, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'ProviderName', 'range': [38, 38], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [40, 49], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseWebhooksManager', 'range': [49, 49], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [52, 59], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [54, 59], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [58, 58], 'children': []}]}]}]}
2025-01-08 10:15:32,154 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:15:45,240 - INFO - Step 5 result: {'nodes': [{'type': 'Program', 'name': 'MainOrSomething', 'range': [0, 59], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 1], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [4, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'requests', 'range': [5, 5], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [7, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'Request', 'range': [10, 10], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 18], 'children': [{'type': 'ImportSpecifier', 'name': 'integrations', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [20, 27], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyCredentials', 'range': [27, 27], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Credentials', 'range': [29, 29], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [31, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'ProviderName', 'range': [38, 38], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [40, 49], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseWebhooksManager', 'range': [49, 49], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [52, 59], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [54, 59], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [58, 58], 'children': []}]}]}]}]}
2025-01-08 10:15:45,240 - INFO - Completed main AST analysis flow
2025-01-08 10:15:45,241 - INFO - Successfully processed chunk
2025-01-08 10:15:46,164 - INFO - Step 4 result: {'type': 'Program', 'name': '_deregister_webhook', 'range': [903, 952], 'children': [{'type': 'FunctionDecl', 'name': '_deregister_webhook', 'range': [903, 952], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [903, 903], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [904, 904], 'children': []}, {'type': 'Identifier', 'name': '_deregister_webhook', 'range': [905, 905], 'children': []}, {'type': 'Parameter', 'name': 'self', 'range': [908, 908], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [910, 910], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [911, 911], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [912, 912], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [914, 914], 'children': []}]}]}, {'type': 'Parameter', 'name': 'credentials', 'range': [916, 916], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [917, 917], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [918, 918], 'children': []}]}]}, {'type': 'ReturnType', 'name': '->', 'range': [921, 922], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [923, 923], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [925, 952], 'children': [{'type': 'Literal', 'name': '""" \\n         Note: Slant3D API currently doesn\'t provide a deregistration endpoint. \\n         This would need to be handled through support. \\n         """', 'range': [926, 928], 'children': []}, {'type': 'Comment', 'name': "# Log warning since we can't properly deregister", 'range': [930, 940], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.warning(f"Warning: Manual deregistration required for webhook {webhook.id}")', 'range': [941, 949], 'children': [{'type': 'CallExpression', 'name': 'logger.warning', 'range': [941, 949], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [941, 941], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [943, 943], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Warning: Manual deregistration required for webhook {webhook.id}"', 'range': [946, 947], 'children': []}]}]}, {'type': 'Keyword', 'name': 'pass', 'range': [951, 951], 'children': []}]}]}]}
2025-01-08 10:15:46,164 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:15:49,795 - INFO - Step 3 result: {'type': 'Program', 'name': '_register_webhook', 'range': [521, 734], 'children': [{'type': 'FunctionDeclaration', 'name': '_register_webhook', 'range': [521, 734], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [521, 525], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [522, 525], 'children': []}, {'type': 'FunctionName', 'name': '_register_webhook', 'range': [523, 524], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [524, 562], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [526, 527], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [529, 531], 'children': []}, {'type': 'Parameter', 'name': 'webhook_type', 'range': [534, 536], 'children': []}, {'type': 'Parameter', 'name': 'resource', 'range': [539, 541], 'children': []}, {'type': 'Parameter', 'name': 'events', 'range': [544, 549], 'children': []}, {'type': 'Parameter', 'name': 'ingress_url', 'range': [552, 554], 'children': []}, {'type': 'Parameter', 'name': 'secret', 'range': [557, 559], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple[str, dict]', 'range': [563, 571], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [572, 734], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [573, 575], 'children': []}, {'type': 'IfStatement', 'name': 'if', 'range': [578, 593], 'children': [{'type': 'Condition', 'name': 'not isinstance(credentials, APIKeyCredentials)', 'range': [579, 585], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise ValueError', 'range': [588, 592], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'headers', 'range': [595, 616], 'children': [{'type': 'Dictionary', 'name': 'headers', 'range': [597, 615], 'children': [{'type': 'KeyValuePair', 'name': 'api-key', 'range': [599, 608], 'children': []}, {'type': 'KeyValuePair', 'name': 'Content-Type', 'range': [610, 613], 'children': []}]}]}, {'type': 'Comment', 'name': 'comment', 'range': [618, 632], 'children': []}, {'type': 'VariableDeclaration', 'name': 'payload', 'range': [633, 640], 'children': [{'type': 'Dictionary', 'name': 'payload', 'range': [635, 639], 'children': [{'type': 'KeyValuePair', 'name': 'endPoint', 'range': [636, 638], 'children': []}]}]}, {'type': 'FunctionCall', 'name': 'requests.post', 'range': [642, 661], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [647, 660], 'children': [{'type': 'StringLiteral', 'name': 'f"{self.BASE_URL}/customer/webhookSubscribe"', 'range': [649, 651], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers=headers', 'range': [652, 654], 'children': []}, {'type': 'KeywordArgument', 'name': 'json=payload', 'range': [656, 658], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [663, 691], 'children': [{'type': 'Condition', 'name': 'not response.ok', 'range': [664, 668], 'children': []}, {'type': 'VariableDeclaration', 'name': 'error', 'range': [670, 684], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise RuntimeError', 'range': [685, 690], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'webhook_config', 'range': [693, 728], 'children': [{'type': 'Dictionary', 'name': 'webhook_config', 'range': [695, 727], 'children': [{'type': 'KeyValuePair', 'name': 'endpoint', 'range': [697, 699], 'children': []}, {'type': 'KeyValuePair', 'name': 'provider', 'range': [702, 704], 'children': []}, {'type': 'KeyValuePair', 'name': 'events', 'range': [709, 713], 'children': []}, {'type': 'KeyValuePair', 'name': 'type', 'range': [722, 724], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [730, 734], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [731, 732], 'children': []}, {'type': 'Variable', 'name': 'webhook_config', 'range': [733, 734], 'children': []}]}]}]}]}
2025-01-08 10:15:49,795 - INFO - Starting Step 4: AST normalization
2025-01-08 10:15:57,021 - INFO - Step 3 result: {'type': 'Program', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'ClassMethod', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'FunctionDef', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'Async', 'name': 'async', 'range': [738, 739], 'children': []}, {'type': 'Parameters', 'name': 'parameters', 'range': [741, 755], 'children': [{'type': 'Parameter', 'name': 'cls', 'range': [743, 743], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [745, 749], 'children': []}, {'type': 'Parameter', 'name': 'request', 'range': [751, 753], 'children': []}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [756, 763], 'children': [{'type': 'Type', 'name': 'tuple', 'range': [758, 758], 'children': []}, {'type': 'Type', 'name': 'dict', 'range': [760, 760], 'children': []}, {'type': 'Type', 'name': 'str', 'range': [762, 762], 'children': []}]}, {'type': 'Docstring', 'name': 'docstring', 'range': [766, 768], 'children': []}, {'type': 'Assignment', 'name': 'payload_assignment', 'range': [771, 779], 'children': [{'type': 'Variable', 'name': 'payload', 'range': [771, 771], 'children': []}, {'type': 'Await', 'name': 'await', 'range': [773, 773], 'children': []}, {'type': 'MethodCall', 'name': 'json', 'range': [774, 778], 'children': [{'type': 'Object', 'name': 'request', 'range': [774, 774], 'children': []}]}]}, {'type': 'List', 'name': 'required_fields', 'range': [790, 800], 'children': [{'type': 'String', 'name': 'orderId', 'range': [793, 793], 'children': []}, {'type': 'String', 'name': 'status', 'range': [795, 795], 'children': []}, {'type': 'String', 'name': 'trackingNumber', 'range': [797, 797], 'children': []}, {'type': 'String', 'name': 'carrierCode', 'range': [799, 799], 'children': []}]}, {'type': 'ListComprehension', 'name': 'missing_fields', 'range': [802, 815], 'children': [{'type': 'Variable', 'name': 'field', 'range': [805, 805], 'children': []}, {'type': 'For', 'name': 'for', 'range': [806, 806], 'children': []}, {'type': 'In', 'name': 'in', 'range': [808, 808], 'children': []}, {'type': 'If', 'name': 'if', 'range': [810, 810], 'children': []}, {'type': 'NotIn', 'name': 'not_in', 'range': [812, 813], 'children': []}]}, {'type': 'If', 'name': 'if_missing_fields', 'range': [818, 828], 'children': [{'type': 'Raise', 'name': 'raise', 'range': [822, 822], 'children': []}, {'type': 'Exception', 'name': 'ValueError', 'range': [823, 823], 'children': []}, {'type': 'FString', 'name': 'f_string', 'range': [825, 826], 'children': []}]}, {'type': 'Dict', 'name': 'normalized_payload', 'range': [835, 871], 'children': [{'type': 'KeyValue', 'name': 'orderId', 'range': [839, 845], 'children': [{'type': 'String', 'name': 'orderId', 'range': [839, 839], 'children': []}, {'type': 'Variable', 'name': 'payload', 'range': [841, 841], 'children': []}]}, {'type': 'KeyValue', 'name': 'status', 'range': [847, 853], 'children': [{'type': 'String', 'name': 'status', 'range': [847, 847], 'children': []}, {'type': 'Variable', 'name': 'payload', 'range': [849, 849], 'children': []}]}, {'type': 'KeyValue', 'name': 'trackingNumber', 'range': [855, 861], 'children': [{'type': 'String', 'name': 'trackingNumber', 'range': [855, 855], 'children': []}, {'type': 'Variable', 'name': 'payload', 'range': [857, 857], 'children': []}]}, {'type': 'KeyValue', 'name': 'carrierCode', 'range': [863, 869], 'children': [{'type': 'String', 'name': 'carrierCode', 'range': [863, 863], 'children': []}, {'type': 'Variable', 'name': 'payload', 'range': [865, 865], 'children': []}]}]}, {'type': 'Assignment', 'name': 'event_type_assignment', 'range': [892, 896], 'children': [{'type': 'Variable', 'name': 'event_type', 'range': [892, 892], 'children': []}, {'type': 'FString', 'name': 'f_string', 'range': [894, 895], 'children': []}]}, {'type': 'Return', 'name': 'return', 'range': [898, 902], 'children': [{'type': 'Variable', 'name': 'normalized_payload', 'range': [899, 899], 'children': []}, {'type': 'Variable', 'name': 'event_type', 'range': [901, 901], 'children': []}]}]}]}]}
2025-01-08 10:15:57,021 - INFO - Starting Step 4: AST normalization
2025-01-08 10:16:02,972 - INFO - Step 5 result: {'type': 'Program', 'name': '_deregister_webhook', 'range': [903, 952], 'children': [{'type': 'FunctionDecl', 'name': '_deregister_webhook', 'range': [903, 952], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [903, 903], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [904, 904], 'children': []}, {'type': 'Identifier', 'name': '_deregister_webhook', 'range': [905, 905], 'children': []}, {'type': 'Parameter', 'name': 'self', 'range': [908, 908], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [910, 910], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [911, 911], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [912, 912], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [914, 914], 'children': []}]}]}, {'type': 'Parameter', 'name': 'credentials', 'range': [916, 916], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [917, 917], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [918, 918], 'children': []}]}]}, {'type': 'ReturnType', 'name': '->', 'range': [921, 922], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [923, 923], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [925, 952], 'children': [{'type': 'Literal', 'name': '""" \\n         Note: Slant3D API currently doesn\'t provide a deregistration endpoint. \\n         This would need to be handled through support. \\n         """', 'range': [926, 928], 'children': []}, {'type': 'Comment', 'name': "# Log warning since we can't properly deregister", 'range': [930, 940], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.warning(f"Warning: Manual deregistration required for webhook {webhook.id}")', 'range': [941, 949], 'children': [{'type': 'CallExpression', 'name': 'logger.warning', 'range': [941, 949], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [941, 941], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [943, 943], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Warning: Manual deregistration required for webhook {webhook.id}"', 'range': [946, 947], 'children': []}]}]}, {'type': 'Keyword', 'name': 'pass', 'range': [951, 951], 'children': []}]}]}]}
2025-01-08 10:16:02,972 - INFO - Completed main AST analysis flow
2025-01-08 10:16:02,973 - INFO - Successfully processed chunk
2025-01-08 10:16:18,378 - INFO - Step 4 result: {'type': 'Program', 'name': '_register_webhook', 'range': [521, 734], 'children': [{'type': 'FunctionDecl', 'name': '_register_webhook', 'range': [521, 734], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [521, 525], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [522, 525], 'children': []}, {'type': 'FunctionName', 'name': '_register_webhook', 'range': [523, 524], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [524, 562], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [526, 527], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [529, 531], 'children': []}, {'type': 'Parameter', 'name': 'webhook_type', 'range': [534, 536], 'children': []}, {'type': 'Parameter', 'name': 'resource', 'range': [539, 541], 'children': []}, {'type': 'Parameter', 'name': 'events', 'range': [544, 549], 'children': []}, {'type': 'Parameter', 'name': 'ingress_url', 'range': [552, 554], 'children': []}, {'type': 'Parameter', 'name': 'secret', 'range': [557, 559], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple[str, dict]', 'range': [563, 571], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [572, 734], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [573, 575], 'children': []}, {'type': 'IfStatement', 'name': 'if', 'range': [578, 593], 'children': [{'type': 'Condition', 'name': 'not isinstance(credentials, APIKeyCredentials)', 'range': [579, 585], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise ValueError', 'range': [588, 592], 'children': []}]}, {'type': 'VariableDecl', 'name': 'headers', 'range': [595, 616], 'children': [{'type': 'Dictionary', 'name': 'headers', 'range': [597, 615], 'children': [{'type': 'KeyValuePair', 'name': 'api-key', 'range': [599, 608], 'children': []}, {'type': 'KeyValuePair', 'name': 'Content-Type', 'range': [610, 613], 'children': []}]}]}, {'type': 'Comment', 'name': 'comment', 'range': [618, 632], 'children': []}, {'type': 'VariableDecl', 'name': 'payload', 'range': [633, 640], 'children': [{'type': 'Dictionary', 'name': 'payload', 'range': [635, 639], 'children': [{'type': 'KeyValuePair', 'name': 'endPoint', 'range': [636, 638], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'requests.post', 'range': [642, 661], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [647, 660], 'children': [{'type': 'StringLiteral', 'name': 'f"{self.BASE_URL}/customer/webhookSubscribe"', 'range': [649, 651], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers=headers', 'range': [652, 654], 'children': []}, {'type': 'KeywordArgument', 'name': 'json=payload', 'range': [656, 658], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [663, 691], 'children': [{'type': 'Condition', 'name': 'not response.ok', 'range': [664, 668], 'children': []}, {'type': 'VariableDecl', 'name': 'error', 'range': [670, 684], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise RuntimeError', 'range': [685, 690], 'children': []}]}, {'type': 'VariableDecl', 'name': 'webhook_config', 'range': [693, 728], 'children': [{'type': 'Dictionary', 'name': 'webhook_config', 'range': [695, 727], 'children': [{'type': 'KeyValuePair', 'name': 'endpoint', 'range': [697, 699], 'children': []}, {'type': 'KeyValuePair', 'name': 'provider', 'range': [702, 704], 'children': []}, {'type': 'KeyValuePair', 'name': 'events', 'range': [709, 713], 'children': []}, {'type': 'KeyValuePair', 'name': 'type', 'range': [722, 724], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [730, 734], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [731, 732], 'children': []}, {'type': 'Identifier', 'name': 'webhook_config', 'range': [733, 734], 'children': []}]}]}]}]}
2025-01-08 10:16:18,379 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:16:27,959 - INFO - Step 4 result: {'type': 'Program', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'ClassMethod', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'FunctionDecl', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'Async', 'name': 'async', 'range': [738, 739], 'children': []}, {'type': 'Parameters', 'name': 'parameters', 'range': [741, 755], 'children': [{'type': 'Parameter', 'name': 'cls', 'range': [743, 743], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [745, 749], 'children': []}, {'type': 'Parameter', 'name': 'request', 'range': [751, 753], 'children': []}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [756, 763], 'children': [{'type': 'Type', 'name': 'tuple', 'range': [758, 758], 'children': []}, {'type': 'Type', 'name': 'dict', 'range': [760, 760], 'children': []}, {'type': 'Type', 'name': 'str', 'range': [762, 762], 'children': []}]}, {'type': 'Docstring', 'name': 'docstring', 'range': [766, 768], 'children': []}, {'type': 'Assignment', 'name': 'payload_assignment', 'range': [771, 779], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [771, 771], 'children': []}, {'type': 'Await', 'name': 'await', 'range': [773, 773], 'children': []}, {'type': 'CallExpression', 'name': 'json', 'range': [774, 778], 'children': [{'type': 'Identifier', 'name': 'request', 'range': [774, 774], 'children': []}]}]}, {'type': 'List', 'name': 'required_fields', 'range': [790, 800], 'children': [{'type': 'Literal', 'name': 'orderId', 'range': [793, 793], 'children': []}, {'type': 'Literal', 'name': 'status', 'range': [795, 795], 'children': []}, {'type': 'Literal', 'name': 'trackingNumber', 'range': [797, 797], 'children': []}, {'type': 'Literal', 'name': 'carrierCode', 'range': [799, 799], 'children': []}]}, {'type': 'ListComprehension', 'name': 'missing_fields', 'range': [802, 815], 'children': [{'type': 'Identifier', 'name': 'field', 'range': [805, 805], 'children': []}, {'type': 'ForStatement', 'name': 'for', 'range': [806, 806], 'children': []}, {'type': 'In', 'name': 'in', 'range': [808, 808], 'children': []}, {'type': 'IfStatement', 'name': 'if', 'range': [810, 810], 'children': []}, {'type': 'BinaryExpression', 'name': 'not_in', 'range': [812, 813], 'children': []}]}, {'type': 'IfStatement', 'name': 'if_missing_fields', 'range': [818, 828], 'children': [{'type': 'Raise', 'name': 'raise', 'range': [822, 822], 'children': []}, {'type': 'Identifier', 'name': 'ValueError', 'range': [823, 823], 'children': []}, {'type': 'Literal', 'name': 'f_string', 'range': [825, 826], 'children': []}]}, {'type': 'Dict', 'name': 'normalized_payload', 'range': [835, 871], 'children': [{'type': 'KeyValue', 'name': 'orderId', 'range': [839, 845], 'children': [{'type': 'Literal', 'name': 'orderId', 'range': [839, 839], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [841, 841], 'children': []}]}, {'type': 'KeyValue', 'name': 'status', 'range': [847, 853], 'children': [{'type': 'Literal', 'name': 'status', 'range': [847, 847], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [849, 849], 'children': []}]}, {'type': 'KeyValue', 'name': 'trackingNumber', 'range': [855, 861], 'children': [{'type': 'Literal', 'name': 'trackingNumber', 'range': [855, 855], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [857, 857], 'children': []}]}, {'type': 'KeyValue', 'name': 'carrierCode', 'range': [863, 869], 'children': [{'type': 'Literal', 'name': 'carrierCode', 'range': [863, 863], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [865, 865], 'children': []}]}]}, {'type': 'Assignment', 'name': 'event_type_assignment', 'range': [892, 896], 'children': [{'type': 'Identifier', 'name': 'event_type', 'range': [892, 892], 'children': []}, {'type': 'Literal', 'name': 'f_string', 'range': [894, 895], 'children': []}]}, {'type': 'Return', 'name': 'return', 'range': [898, 902], 'children': [{'type': 'Identifier', 'name': 'normalized_payload', 'range': [899, 899], 'children': []}, {'type': 'Identifier', 'name': 'event_type', 'range': [901, 901], 'children': []}]}]}]}]}
2025-01-08 10:16:27,959 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:16:47,917 - INFO - Step 5 result: {'type': 'Program', 'name': '_register_webhook', 'range': [521, 734], 'children': [{'type': 'FunctionDecl', 'name': '_register_webhook', 'range': [521, 734], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [521, 525], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [522, 525], 'children': []}, {'type': 'FunctionName', 'name': '_register_webhook', 'range': [523, 524], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [524, 562], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [526, 527], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [529, 531], 'children': []}, {'type': 'Parameter', 'name': 'webhook_type', 'range': [534, 536], 'children': []}, {'type': 'Parameter', 'name': 'resource', 'range': [539, 541], 'children': []}, {'type': 'Parameter', 'name': 'events', 'range': [544, 549], 'children': []}, {'type': 'Parameter', 'name': 'ingress_url', 'range': [552, 554], 'children': []}, {'type': 'Parameter', 'name': 'secret', 'range': [557, 559], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple[str, dict]', 'range': [563, 571], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [572, 734], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [573, 575], 'children': []}, {'type': 'IfStatement', 'name': 'if', 'range': [578, 593], 'children': [{'type': 'Condition', 'name': 'not isinstance(credentials, APIKeyCredentials)', 'range': [579, 585], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise ValueError', 'range': [588, 592], 'children': []}]}, {'type': 'VariableDecl', 'name': 'headers', 'range': [595, 616], 'children': [{'type': 'Dictionary', 'name': 'headers', 'range': [597, 615], 'children': [{'type': 'KeyValuePair', 'name': 'api-key', 'range': [599, 608], 'children': []}, {'type': 'KeyValuePair', 'name': 'Content-Type', 'range': [610, 613], 'children': []}]}]}, {'type': 'Comment', 'name': 'comment', 'range': [618, 632], 'children': []}, {'type': 'VariableDecl', 'name': 'payload', 'range': [633, 640], 'children': [{'type': 'Dictionary', 'name': 'payload', 'range': [635, 639], 'children': [{'type': 'KeyValuePair', 'name': 'endPoint', 'range': [636, 638], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'requests.post', 'range': [642, 661], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [647, 660], 'children': [{'type': 'StringLiteral', 'name': 'f"{self.BASE_URL}/customer/webhookSubscribe"', 'range': [649, 651], 'children': []}, {'type': 'KeywordArgument', 'name': 'headers=headers', 'range': [652, 654], 'children': []}, {'type': 'KeywordArgument', 'name': 'json=payload', 'range': [656, 658], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [663, 691], 'children': [{'type': 'Condition', 'name': 'not response.ok', 'range': [664, 668], 'children': []}, {'type': 'VariableDecl', 'name': 'error', 'range': [670, 684], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise RuntimeError', 'range': [685, 690], 'children': []}]}, {'type': 'VariableDecl', 'name': 'webhook_config', 'range': [693, 728], 'children': [{'type': 'Dictionary', 'name': 'webhook_config', 'range': [695, 727], 'children': [{'type': 'KeyValuePair', 'name': 'endpoint', 'range': [697, 699], 'children': []}, {'type': 'KeyValuePair', 'name': 'provider', 'range': [702, 704], 'children': []}, {'type': 'KeyValuePair', 'name': 'events', 'range': [709, 713], 'children': []}, {'type': 'KeyValuePair', 'name': 'type', 'range': [722, 724], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [730, 734], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [731, 732], 'children': []}, {'type': 'Identifier', 'name': 'webhook_config', 'range': [733, 734], 'children': []}]}]}]}]}
2025-01-08 10:16:47,917 - INFO - Completed main AST analysis flow
2025-01-08 10:16:47,918 - INFO - Successfully processed chunk
2025-01-08 10:16:59,465 - INFO - Step 5 result: {'type': 'Program', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'ClassMethod', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'FunctionDecl', 'name': 'validate_payload', 'range': [735, 902], 'children': [{'type': 'Async', 'name': 'async', 'range': [738, 739], 'children': []}, {'type': 'Parameters', 'name': 'parameters', 'range': [741, 755], 'children': [{'type': 'Parameter', 'name': 'cls', 'range': [743, 743], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [745, 749], 'children': []}, {'type': 'Parameter', 'name': 'request', 'range': [751, 753], 'children': []}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [756, 763], 'children': [{'type': 'Type', 'name': 'tuple', 'range': [758, 758], 'children': []}, {'type': 'Type', 'name': 'dict', 'range': [760, 760], 'children': []}, {'type': 'Type', 'name': 'str', 'range': [762, 762], 'children': []}]}, {'type': 'Docstring', 'name': 'docstring', 'range': [766, 768], 'children': []}, {'type': 'Assignment', 'name': 'payload_assignment', 'range': [771, 779], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [771, 771], 'children': []}, {'type': 'Await', 'name': 'await', 'range': [773, 773], 'children': []}, {'type': 'CallExpression', 'name': 'json', 'range': [774, 778], 'children': [{'type': 'Identifier', 'name': 'request', 'range': [774, 774], 'children': []}]}]}, {'type': 'List', 'name': 'required_fields', 'range': [790, 800], 'children': [{'type': 'Literal', 'name': 'orderId', 'range': [793, 793], 'children': []}, {'type': 'Literal', 'name': 'status', 'range': [795, 795], 'children': []}, {'type': 'Literal', 'name': 'trackingNumber', 'range': [797, 797], 'children': []}, {'type': 'Literal', 'name': 'carrierCode', 'range': [799, 799], 'children': []}]}, {'type': 'ListComprehension', 'name': 'missing_fields', 'range': [802, 815], 'children': [{'type': 'Identifier', 'name': 'field', 'range': [805, 805], 'children': []}, {'type': 'ForStatement', 'name': 'for', 'range': [806, 806], 'children': []}, {'type': 'In', 'name': 'in', 'range': [808, 808], 'children': []}, {'type': 'IfStatement', 'name': 'if', 'range': [810, 810], 'children': []}, {'type': 'BinaryExpression', 'name': 'not_in', 'range': [812, 813], 'children': []}]}, {'type': 'IfStatement', 'name': 'if_missing_fields', 'range': [818, 828], 'children': [{'type': 'Raise', 'name': 'raise', 'range': [822, 822], 'children': []}, {'type': 'Identifier', 'name': 'ValueError', 'range': [823, 823], 'children': []}, {'type': 'Literal', 'name': 'f_string', 'range': [825, 826], 'children': []}]}, {'type': 'Dict', 'name': 'normalized_payload', 'range': [835, 871], 'children': [{'type': 'KeyValue', 'name': 'orderId', 'range': [839, 845], 'children': [{'type': 'Literal', 'name': 'orderId', 'range': [839, 839], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [841, 841], 'children': []}]}, {'type': 'KeyValue', 'name': 'status', 'range': [847, 853], 'children': [{'type': 'Literal', 'name': 'status', 'range': [847, 847], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [849, 849], 'children': []}]}, {'type': 'KeyValue', 'name': 'trackingNumber', 'range': [855, 861], 'children': [{'type': 'Literal', 'name': 'trackingNumber', 'range': [855, 855], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [857, 857], 'children': []}]}, {'type': 'KeyValue', 'name': 'carrierCode', 'range': [863, 869], 'children': [{'type': 'Literal', 'name': 'carrierCode', 'range': [863, 863], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [865, 865], 'children': []}]}]}, {'type': 'Assignment', 'name': 'event_type_assignment', 'range': [892, 896], 'children': [{'type': 'Identifier', 'name': 'event_type', 'range': [892, 892], 'children': []}, {'type': 'Literal', 'name': 'f_string', 'range': [894, 895], 'children': []}]}, {'type': 'Return', 'name': 'return', 'range': [898, 902], 'children': [{'type': 'Identifier', 'name': 'normalized_payload', 'range': [899, 899], 'children': []}, {'type': 'Identifier', 'name': 'event_type', 'range': [901, 901], 'children': []}]}]}]}]}
2025-01-08 10:16:59,466 - INFO - Completed main AST analysis flow
2025-01-08 10:16:59,467 - INFO - Successfully processed chunk
2025-01-08 10:17:00,100 - INFO - Step 2 result: {'type': 'Program', 'name': 'Slant3DWebhooksManager', 'range': [63, 520], 'children': [{'type': 'ClassDeclaration', 'name': 'Slant3DWebhooksManager', 'range': [63, 520], 'children': [{'type': 'ClassVariableDeclaration', 'name': 'PROVIDER_NAME', 'range': [75, 80], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [76, 80], 'children': [{'type': 'Identifier', 'name': 'ProviderName', 'range': [77, 77], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [78, 79], 'children': [{'type': 'Identifier', 'name': 'SLANT3D', 'range': [79, 79], 'children': []}]}]}]}, {'type': 'ClassVariableDeclaration', 'name': 'BASE_URL', 'range': [81, 84], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [82, 84], 'children': [{'type': 'StringLiteral', 'name': '"https://www.slant3dapi.com/api"', 'range': [83, 83], 'children': []}]}]}, {'type': 'MethodDeclaration', 'name': '_register_webhook', 'range': [86, 299], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [89, 127], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [91, 91], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [94, 94], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [95, 96], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [96, 96], 'children': []}]}]}, {'type': 'Parameter', 'name': 'webhook_type', 'range': [99, 99], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [100, 101], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [101, 101], 'children': []}]}]}, {'type': 'Parameter', 'name': 'resource', 'range': [104, 104], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [105, 106], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [106, 106], 'children': []}]}]}, {'type': 'Parameter', 'name': 'events', 'range': [109, 109], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [110, 111], 'children': [{'type': 'Identifier', 'name': 'list', 'range': [111, 111], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [112, 114], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [113, 113], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'ingress_url', 'range': [117, 117], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [118, 119], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [119, 119], 'children': []}]}]}, {'type': 'Parameter', 'name': 'secret', 'range': [122, 122], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [123, 124], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [124, 124], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [128, 136], 'children': [{'type': 'Identifier', 'name': 'tuple', 'range': [130, 130], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [131, 135], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [132, 132], 'children': []}, {'type': 'Identifier', 'name': 'dict', 'range': [134, 134], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [137, 299], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [143, 158], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [144, 145], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [145, 150], 'children': [{'type': 'Identifier', 'name': 'credentials', 'range': [147, 147], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyCredentials', 'range': [149, 149], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [151, 158], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [153, 157], 'children': [{'type': 'NewExpression', 'name': 'ValueError', 'range': [154, 157], 'children': [{'type': 'StringLiteral', 'name': '"API key is required to register a webhook"', 'range': [156, 156], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'headers', 'range': [160, 181], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [161, 181], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [162, 180], 'children': [{'type': 'Property', 'name': '"api-key"', 'range': [164, 173], 'children': [{'type': 'Identifier', 'name': 'credentials', 'range': [166, 166], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [167, 168], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [168, 168], 'children': []}]}, {'type': 'CallExpression', 'name': 'get_secret_value', 'range': [170, 172], 'children': []}]}, {'type': 'Property', 'name': '"Content-Type"', 'range': [175, 178], 'children': [{'type': 'StringLiteral', 'name': '"application/json"', 'range': [177, 177], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'payload', 'range': [198, 205], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [199, 205], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [200, 204], 'children': [{'type': 'Property', 'name': '"endPoint"', 'range': [201, 203], 'children': [{'type': 'Identifier', 'name': 'ingress_url', 'range': [203, 203], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'response', 'range': [207, 226], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [208, 226], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [211, 225], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [210, 211], 'children': [{'type': 'Identifier', 'name': 'requests', 'range': [209, 209], 'children': []}]}, {'type': 'TemplateLiteral', 'name': 'f', 'range': [214, 215], 'children': [{'type': 'TemplateElement', 'name': '"{self.BASE_URL}/customer/webhookSubscribe"', 'range': [215, 215], 'children': []}]}, {'type': 'Identifier', 'name': 'headers', 'range': [217, 217], 'children': []}, {'type': 'Identifier', 'name': 'json', 'range': [221, 221], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [223, 223], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [228, 256], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [229, 230], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [231, 232], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [230, 230], 'children': []}, {'type': 'Identifier', 'name': 'ok', 'range': [232, 232], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [233, 256], 'children': [{'type': 'VariableDeclaration', 'name': 'error', 'range': [235, 249], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [236, 249], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [238, 239], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [237, 237], 'children': []}, {'type': 'CallExpression', 'name': 'json', 'range': [239, 241], 'children': []}]}, {'type': 'CallExpression', 'name': 'get', 'range': [243, 248], 'children': [{'type': 'StringLiteral', 'name': '"error"', 'range': [245, 245], 'children': []}, {'type': 'StringLiteral', 'name': '"Unknown error"', 'range': [247, 247], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [250, 255], 'children': [{'type': 'NewExpression', 'name': 'RuntimeError', 'range': [251, 255], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [253, 254], 'children': [{'type': 'TemplateElement', 'name': '"Failed to register webhook: {error}"', 'range': [254, 254], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'webhook_config', 'range': [258, 293], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [259, 293], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [260, 292], 'children': [{'type': 'Property', 'name': '"endpoint"', 'range': [262, 264], 'children': [{'type': 'Identifier', 'name': 'ingress_url', 'range': [264, 264], 'children': []}]}, {'type': 'Property', 'name': '"provider"', 'range': [267, 272], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [269, 270], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [269, 269], 'children': []}, {'type': 'Identifier', 'name': 'PROVIDER_NAME', 'range': [271, 271], 'children': []}]}]}, {'type': 'Property', 'name': '"events"', 'range': [274, 279], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [276, 278], 'children': [{'type': 'StringLiteral', 'name': '"order.shipped"', 'range': [277, 277], 'children': []}]}]}, {'type': 'Property', 'name': '"type"', 'range': [287, 290], 'children': [{'type': 'Identifier', 'name': 'webhook_type', 'range': [289, 289], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [295, 299], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [296, 296], 'children': []}, {'type': 'Identifier', 'name': 'webhook_config', 'range': [298, 298], 'children': []}]}]}]}, {'type': 'MethodDeclaration', 'name': 'validate_payload', 'range': [301, 468], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [307, 321], 'children': [{'type': 'Parameter', 'name': 'cls', 'range': [309, 309], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [311, 311], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [312, 313], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [314, 315], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [313, 313], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [315, 315], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'request', 'range': [317, 317], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [318, 319], 'children': [{'type': 'Identifier', 'name': 'Request', 'range': [319, 319], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [322, 330], 'children': [{'type': 'Identifier', 'name': 'tuple', 'range': [324, 324], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [325, 329], 'children': [{'type': 'Identifier', 'name': 'dict', 'range': [326, 326], 'children': []}, {'type': 'Identifier', 'name': 'str', 'range': [328, 328], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [331, 468], 'children': [{'type': 'VariableDeclaration', 'name': 'payload', 'range': [337, 345], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [338, 345], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [339, 340], 'children': [{'type': 'CallExpression', 'name': 'json', 'range': [342, 344], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [341, 342], 'children': [{'type': 'Identifier', 'name': 'request', 'range': [340, 340], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'required_fields', 'range': [356, 367], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [357, 367], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [358, 366], 'children': [{'type': 'StringLiteral', 'name': '"orderId"', 'range': [359, 359], 'children': []}, {'type': 'StringLiteral', 'name': '"status"', 'range': [361, 361], 'children': []}, {'type': 'StringLiteral', 'name': '"trackingNumber"', 'range': [363, 363], 'children': []}, {'type': 'StringLiteral', 'name': '"carrierCode"', 'range': [365, 365], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'missing_fields', 'range': [368, 382], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [369, 382], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [370, 381], 'children': [{'type': 'ForStatement', 'name': 'for', 'range': [371, 380], 'children': [{'type': 'VariableDeclaration', 'name': 'field', 'range': [371, 371], 'children': []}, {'type': 'BinaryExpression', 'name': 'in', 'range': [373, 375], 'children': [{'type': 'Identifier', 'name': 'required_fields', 'range': [374, 374], 'children': []}]}, {'type': 'UnaryExpression', 'name': 'not', 'range': [377, 378], 'children': [{'type': 'BinaryExpression', 'name': 'in', 'range': [379, 380], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [380, 380], 'children': []}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [384, 394], 'children': [{'type': 'Identifier', 'name': 'missing_fields', 'range': [385, 385], 'children': []}, {'type': 'BlockStatement', 'name': '{', 'range': [386, 394], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [388, 393], 'children': [{'type': 'NewExpression', 'name': 'ValueError', 'range': [389, 393], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [391, 392], 'children': [{'type': 'TemplateElement', 'name': '"Missing required fields: {\', \'.join(missing_fields)}"', 'range': [392, 392], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'normalized_payload', 'range': [401, 438], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [402, 438], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [403, 437], 'children': [{'type': 'Property', 'name': '"orderId"', 'range': [405, 410], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [408, 409], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [407, 407], 'children': []}, {'type': 'StringLiteral', 'name': '"orderId"', 'range': [409, 409], 'children': []}]}]}, {'type': 'Property', 'name': '"status"', 'range': [413, 418], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [416, 417], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [415, 415], 'children': []}, {'type': 'StringLiteral', 'name': '"status"', 'range': [417, 417], 'children': []}]}]}, {'type': 'Property', 'name': '"trackingNumber"', 'range': [421, 426], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [424, 425], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [423, 423], 'children': []}, {'type': 'StringLiteral', 'name': '"trackingNumber"', 'range': [425, 425], 'children': []}]}]}, {'type': 'Property', 'name': '"carrierCode"', 'range': [429, 434], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [432, 433], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [431, 431], 'children': []}, {'type': 'StringLiteral', 'name': '"carrierCode"', 'range': [433, 433], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'event_type', 'range': [458, 462], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [459, 462], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [460, 461], 'children': [{'type': 'TemplateElement', 'name': '"order.{payload[\'status\'].lower()}"', 'range': [461, 461], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [464, 468], 'children': [{'type': 'Identifier', 'name': 'normalized_payload', 'range': [465, 465], 'children': []}, {'type': 'Identifier', 'name': 'event_type', 'range': [467, 467], 'children': []}]}]}]}, {'type': 'MethodDeclaration', 'name': '_deregister_webhook', 'range': [470, 519], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [473, 487], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [475, 475], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [477, 477], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [478, 479], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [480, 481], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [479, 479], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [481, 481], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'credentials', 'range': [483, 483], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [484, 485], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [485, 485], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [488, 491], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [490, 490], 'children': []}]}, {'type': 'BlockStatement', 'name': '{', 'range': [492, 519], 'children': [{'type': 'ExpressionStatement', 'name': 'logger', 'range': [508, 517], 'children': [{'type': 'CallExpression', 'name': 'warning', 'range': [510, 516], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [513, 514], 'children': [{'type': 'TemplateElement', 'name': '"Warning: Manual deregistration required for webhook {webhook.id}"', 'range': [514, 514], 'children': []}]}]}]}, {'type': 'EmptyStatement', 'name': 'pass', 'range': [518, 518], 'children': []}]}]}]}]}
2025-01-08 10:17:00,101 - INFO - Starting Step 3: AST simplification
2025-01-08 10:19:54,581 - INFO - Step 3 result: {'type': 'Program', 'name': 'Slant3DWebhooksManager', 'range': [63, 520], 'children': [{'type': 'ClassDeclaration', 'name': 'Slant3DWebhooksManager', 'range': [63, 520], 'children': [{'type': 'ClassVariableDeclaration', 'name': 'PROVIDER_NAME', 'range': [75, 80], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [76, 80], 'children': [{'type': 'Identifier', 'name': 'ProviderName', 'range': [77, 77], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [78, 79], 'children': [{'type': 'Identifier', 'name': 'SLANT3D', 'range': [79, 79], 'children': []}]}]}]}, {'type': 'ClassVariableDeclaration', 'name': 'BASE_URL', 'range': [81, 84], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [82, 84], 'children': [{'type': 'StringLiteral', 'name': '"https://www.slant3dapi.com/api"', 'range': [83, 83], 'children': []}]}]}, {'type': 'MethodDeclaration', 'name': '_register_webhook', 'range': [86, 299], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [89, 127], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [91, 91], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [94, 94], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [95, 96], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [96, 96], 'children': []}]}]}, {'type': 'Parameter', 'name': 'webhook_type', 'range': [99, 99], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [100, 101], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [101, 101], 'children': []}]}]}, {'type': 'Parameter', 'name': 'resource', 'range': [104, 104], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [105, 106], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [106, 106], 'children': []}]}]}, {'type': 'Parameter', 'name': 'events', 'range': [109, 109], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [110, 111], 'children': [{'type': 'Identifier', 'name': 'list', 'range': [111, 111], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [112, 114], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [113, 113], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'ingress_url', 'range': [117, 117], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [118, 119], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [119, 119], 'children': []}]}]}, {'type': 'Parameter', 'name': 'secret', 'range': [122, 122], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [123, 124], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [124, 124], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [128, 136], 'children': [{'type': 'Identifier', 'name': 'tuple', 'range': [130, 130], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [131, 135], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [132, 132], 'children': []}, {'type': 'Identifier', 'name': 'dict', 'range': [134, 134], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [137, 299], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [143, 158], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [144, 145], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [145, 150], 'children': [{'type': 'Identifier', 'name': 'credentials', 'range': [147, 147], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyCredentials', 'range': [149, 149], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [151, 158], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [153, 157], 'children': [{'type': 'NewExpression', 'name': 'ValueError', 'range': [154, 157], 'children': [{'type': 'StringLiteral', 'name': '"API key is required to register a webhook"', 'range': [156, 156], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'headers', 'range': [160, 181], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [161, 181], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [162, 180], 'children': [{'type': 'Property', 'name': '"api-key"', 'range': [164, 173], 'children': [{'type': 'Identifier', 'name': 'credentials', 'range': [166, 166], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [167, 168], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [168, 168], 'children': []}]}, {'type': 'CallExpression', 'name': 'get_secret_value', 'range': [170, 172], 'children': []}]}, {'type': 'Property', 'name': '"Content-Type"', 'range': [175, 178], 'children': [{'type': 'StringLiteral', 'name': '"application/json"', 'range': [177, 177], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'payload', 'range': [198, 205], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [199, 205], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [200, 204], 'children': [{'type': 'Property', 'name': '"endPoint"', 'range': [201, 203], 'children': [{'type': 'Identifier', 'name': 'ingress_url', 'range': [203, 203], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'response', 'range': [207, 226], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [208, 226], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [211, 225], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [210, 211], 'children': [{'type': 'Identifier', 'name': 'requests', 'range': [209, 209], 'children': []}]}, {'type': 'TemplateLiteral', 'name': 'f', 'range': [214, 215], 'children': [{'type': 'TemplateElement', 'name': '"{self.BASE_URL}/customer/webhookSubscribe"', 'range': [215, 215], 'children': []}]}, {'type': 'Identifier', 'name': 'headers', 'range': [217, 217], 'children': []}, {'type': 'Identifier', 'name': 'json', 'range': [221, 221], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [223, 223], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [228, 256], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [229, 230], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [231, 232], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [230, 230], 'children': []}, {'type': 'Identifier', 'name': 'ok', 'range': [232, 232], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [233, 256], 'children': [{'type': 'VariableDeclaration', 'name': 'error', 'range': [235, 249], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [236, 249], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [238, 239], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [237, 237], 'children': []}, {'type': 'CallExpression', 'name': 'json', 'range': [239, 241], 'children': []}]}, {'type': 'CallExpression', 'name': 'get', 'range': [243, 248], 'children': [{'type': 'StringLiteral', 'name': '"error"', 'range': [245, 245], 'children': []}, {'type': 'StringLiteral', 'name': '"Unknown error"', 'range': [247, 247], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [250, 255], 'children': [{'type': 'NewExpression', 'name': 'RuntimeError', 'range': [251, 255], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [253, 254], 'children': [{'type': 'TemplateElement', 'name': '"Failed to register webhook: {error}"', 'range': [254, 254], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'webhook_config', 'range': [258, 293], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [259, 293], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [260, 292], 'children': [{'type': 'Property', 'name': '"endpoint"', 'range': [262, 264], 'children': [{'type': 'Identifier', 'name': 'ingress_url', 'range': [264, 264], 'children': []}]}, {'type': 'Property', 'name': '"provider"', 'range': [267, 272], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [269, 270], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [269, 269], 'children': []}, {'type': 'Identifier', 'name': 'PROVIDER_NAME', 'range': [271, 271], 'children': []}]}]}, {'type': 'Property', 'name': '"events"', 'range': [274, 279], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [276, 278], 'children': [{'type': 'StringLiteral', 'name': '"order.shipped"', 'range': [277, 277], 'children': []}]}]}, {'type': 'Property', 'name': '"type"', 'range': [287, 290], 'children': [{'type': 'Identifier', 'name': 'webhook_type', 'range': [289, 289], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [295, 299], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [296, 296], 'children': []}, {'type': 'Identifier', 'name': 'webhook_config', 'range': [298, 298], 'children': []}]}]}]}, {'type': 'MethodDeclaration', 'name': 'validate_payload', 'range': [301, 468], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [307, 321], 'children': [{'type': 'Parameter', 'name': 'cls', 'range': [309, 309], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [311, 311], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [312, 313], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [314, 315], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [313, 313], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [315, 315], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'request', 'range': [317, 317], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [318, 319], 'children': [{'type': 'Identifier', 'name': 'Request', 'range': [319, 319], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [322, 330], 'children': [{'type': 'Identifier', 'name': 'tuple', 'range': [324, 324], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [325, 329], 'children': [{'type': 'Identifier', 'name': 'dict', 'range': [326, 326], 'children': []}, {'type': 'Identifier', 'name': 'str', 'range': [328, 328], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [331, 468], 'children': [{'type': 'VariableDeclaration', 'name': 'payload', 'range': [337, 345], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [338, 345], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [339, 340], 'children': [{'type': 'CallExpression', 'name': 'json', 'range': [342, 344], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [341, 342], 'children': [{'type': 'Identifier', 'name': 'request', 'range': [340, 340], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'required_fields', 'range': [356, 367], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [357, 367], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [358, 366], 'children': [{'type': 'StringLiteral', 'name': '"orderId"', 'range': [359, 359], 'children': []}, {'type': 'StringLiteral', 'name': '"status"', 'range': [361, 361], 'children': []}, {'type': 'StringLiteral', 'name': '"trackingNumber"', 'range': [363, 363], 'children': []}, {'type': 'StringLiteral', 'name': '"carrierCode"', 'range': [365, 365], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'missing_fields', 'range': [368, 382], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [369, 382], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [370, 381], 'children': [{'type': 'ForStatement', 'name': 'for', 'range': [371, 380], 'children': [{'type': 'VariableDeclaration', 'name': 'field', 'range': [371, 371], 'children': []}, {'type': 'BinaryExpression', 'name': 'in', 'range': [373, 375], 'children': [{'type': 'Identifier', 'name': 'required_fields', 'range': [374, 374], 'children': []}]}, {'type': 'UnaryExpression', 'name': 'not', 'range': [377, 378], 'children': [{'type': 'BinaryExpression', 'name': 'in', 'range': [379, 380], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [380, 380], 'children': []}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [384, 394], 'children': [{'type': 'Identifier', 'name': 'missing_fields', 'range': [385, 385], 'children': []}, {'type': 'BlockStatement', 'name': '{', 'range': [386, 394], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [388, 393], 'children': [{'type': 'NewExpression', 'name': 'ValueError', 'range': [389, 393], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [391, 392], 'children': [{'type': 'TemplateElement', 'name': '"Missing required fields: {\', \'.join(missing_fields)}"', 'range': [392, 392], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'normalized_payload', 'range': [401, 438], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [402, 438], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [403, 437], 'children': [{'type': 'Property', 'name': '"orderId"', 'range': [405, 410], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [408, 409], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [407, 407], 'children': []}, {'type': 'StringLiteral', 'name': '"orderId"', 'range': [409, 409], 'children': []}]}]}, {'type': 'Property', 'name': '"status"', 'range': [413, 418], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [416, 417], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [415, 415], 'children': []}, {'type': 'StringLiteral', 'name': '"status"', 'range': [417, 417], 'children': []}]}]}, {'type': 'Property', 'name': '"trackingNumber"', 'range': [421, 426], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [424, 425], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [423, 423], 'children': []}, {'type': 'StringLiteral', 'name': '"trackingNumber"', 'range': [425, 425], 'children': []}]}]}, {'type': 'Property', 'name': '"carrierCode"', 'range': [429, 434], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [432, 433], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [431, 431], 'children': []}, {'type': 'StringLiteral', 'name': '"carrierCode"', 'range': [433, 433], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'event_type', 'range': [458, 462], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [459, 462], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [460, 461], 'children': [{'type': 'TemplateElement', 'name': '"order.{payload[\'status\'].lower()}"', 'range': [461, 461], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [464, 468], 'children': [{'type': 'Identifier', 'name': 'normalized_payload', 'range': [465, 465], 'children': []}, {'type': 'Identifier', 'name': 'event_type', 'range': [467, 467], 'children': []}]}]}]}, {'type': 'MethodDeclaration', 'name': '_deregister_webhook', 'range': [470, 519], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [473, 487], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [475, 475], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [477, 477], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [478, 479], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [480, 481], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [479, 479], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [481, 481], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'credentials', 'range': [483, 483], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [484, 485], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [485, 485], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [488, 491], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [490, 490], 'children': []}]}, {'type': 'BlockStatement', 'name': '{', 'range': [492, 519], 'children': [{'type': 'ExpressionStatement', 'name': 'logger', 'range': [508, 517], 'children': [{'type': 'CallExpression', 'name': 'warning', 'range': [510, 516], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [513, 514], 'children': [{'type': 'TemplateElement', 'name': '"Warning: Manual deregistration required for webhook {webhook.id}"', 'range': [514, 514], 'children': []}]}]}]}, {'type': 'EmptyStatement', 'name': 'pass', 'range': [518, 518], 'children': []}]}]}]}]}
2025-01-08 10:19:54,581 - INFO - Starting Step 4: AST normalization
2025-01-08 10:21:57,687 - INFO - Step 4 result: {'type': 'Program', 'name': 'Slant3DWebhooksManager', 'range': [63, 520], 'children': [{'type': 'ClassDecl', 'name': 'Slant3DWebhooksManager', 'range': [63, 520], 'children': [{'type': 'ClassVariableDecl', 'name': 'PROVIDER_NAME', 'range': [75, 80], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [76, 80], 'children': [{'type': 'Identifier', 'name': 'ProviderName', 'range': [77, 77], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [78, 79], 'children': [{'type': 'Identifier', 'name': 'SLANT3D', 'range': [79, 79], 'children': []}]}]}]}, {'type': 'ClassVariableDecl', 'name': 'BASE_URL', 'range': [81, 84], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [82, 84], 'children': [{'type': 'Literal', 'name': '"https://www.slant3dapi.com/api"', 'range': [83, 83], 'children': []}]}]}, {'type': 'MethodDecl', 'name': '_register_webhook', 'range': [86, 299], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [89, 127], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [91, 91], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [94, 94], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [95, 96], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [96, 96], 'children': []}]}]}, {'type': 'Parameter', 'name': 'webhook_type', 'range': [99, 99], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [100, 101], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [101, 101], 'children': []}]}]}, {'type': 'Parameter', 'name': 'resource', 'range': [104, 104], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [105, 106], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [106, 106], 'children': []}]}]}, {'type': 'Parameter', 'name': 'events', 'range': [109, 109], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [110, 111], 'children': [{'type': 'Identifier', 'name': 'list', 'range': [111, 111], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [112, 114], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [113, 113], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'ingress_url', 'range': [117, 117], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [118, 119], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [119, 119], 'children': []}]}]}, {'type': 'Parameter', 'name': 'secret', 'range': [122, 122], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [123, 124], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [124, 124], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [128, 136], 'children': [{'type': 'Identifier', 'name': 'tuple', 'range': [130, 130], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [131, 135], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [132, 132], 'children': []}, {'type': 'Identifier', 'name': 'dict', 'range': [134, 134], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [137, 299], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [143, 158], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [144, 145], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [145, 150], 'children': [{'type': 'Identifier', 'name': 'credentials', 'range': [147, 147], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyCredentials', 'range': [149, 149], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [151, 158], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [153, 157], 'children': [{'type': 'NewExpression', 'name': 'ValueError', 'range': [154, 157], 'children': [{'type': 'Literal', 'name': '"API key is required to register a webhook"', 'range': [156, 156], 'children': []}]}]}]}]}, {'type': 'VariableDecl', 'name': 'headers', 'range': [160, 181], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [161, 181], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [162, 180], 'children': [{'type': 'Property', 'name': '"api-key"', 'range': [164, 173], 'children': [{'type': 'Identifier', 'name': 'credentials', 'range': [166, 166], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [167, 168], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [168, 168], 'children': []}]}, {'type': 'CallExpression', 'name': 'get_secret_value', 'range': [170, 172], 'children': []}]}, {'type': 'Property', 'name': '"Content-Type"', 'range': [175, 178], 'children': [{'type': 'Literal', 'name': '"application/json"', 'range': [177, 177], 'children': []}]}]}]}]}, {'type': 'VariableDecl', 'name': 'payload', 'range': [198, 205], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [199, 205], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [200, 204], 'children': [{'type': 'Property', 'name': '"endPoint"', 'range': [201, 203], 'children': [{'type': 'Identifier', 'name': 'ingress_url', 'range': [203, 203], 'children': []}]}]}]}]}, {'type': 'VariableDecl', 'name': 'response', 'range': [207, 226], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [208, 226], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [211, 225], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [210, 211], 'children': [{'type': 'Identifier', 'name': 'requests', 'range': [209, 209], 'children': []}]}, {'type': 'TemplateLiteral', 'name': 'f', 'range': [214, 215], 'children': [{'type': 'TemplateElement', 'name': '"{self.BASE_URL}/customer/webhookSubscribe"', 'range': [215, 215], 'children': []}]}, {'type': 'Identifier', 'name': 'headers', 'range': [217, 217], 'children': []}, {'type': 'Identifier', 'name': 'json', 'range': [221, 221], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [223, 223], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [228, 256], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [229, 230], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [231, 232], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [230, 230], 'children': []}, {'type': 'Identifier', 'name': 'ok', 'range': [232, 232], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [233, 256], 'children': [{'type': 'VariableDecl', 'name': 'error', 'range': [235, 249], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [236, 249], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [238, 239], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [237, 237], 'children': []}, {'type': 'CallExpression', 'name': 'json', 'range': [239, 241], 'children': []}]}, {'type': 'CallExpression', 'name': 'get', 'range': [243, 248], 'children': [{'type': 'Literal', 'name': '"error"', 'range': [245, 245], 'children': []}, {'type': 'Literal', 'name': '"Unknown error"', 'range': [247, 247], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [250, 255], 'children': [{'type': 'NewExpression', 'name': 'RuntimeError', 'range': [251, 255], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [253, 254], 'children': [{'type': 'TemplateElement', 'name': '"Failed to register webhook: {error}"', 'range': [254, 254], 'children': []}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'webhook_config', 'range': [258, 293], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [259, 293], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [260, 292], 'children': [{'type': 'Property', 'name': '"endpoint"', 'range': [262, 264], 'children': [{'type': 'Identifier', 'name': 'ingress_url', 'range': [264, 264], 'children': []}]}, {'type': 'Property', 'name': '"provider"', 'range': [267, 272], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [269, 270], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [269, 269], 'children': []}, {'type': 'Identifier', 'name': 'PROVIDER_NAME', 'range': [271, 271], 'children': []}]}]}, {'type': 'Property', 'name': '"events"', 'range': [274, 279], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [276, 278], 'children': [{'type': 'Literal', 'name': '"order.shipped"', 'range': [277, 277], 'children': []}]}]}, {'type': 'Property', 'name': '"type"', 'range': [287, 290], 'children': [{'type': 'Identifier', 'name': 'webhook_type', 'range': [289, 289], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [295, 299], 'children': [{'type': 'Literal', 'name': '""', 'range': [296, 296], 'children': []}, {'type': 'Identifier', 'name': 'webhook_config', 'range': [298, 298], 'children': []}]}]}]}, {'type': 'MethodDecl', 'name': 'validate_payload', 'range': [301, 468], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [307, 321], 'children': [{'type': 'Parameter', 'name': 'cls', 'range': [309, 309], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [311, 311], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [312, 313], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [314, 315], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [313, 313], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [315, 315], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'request', 'range': [317, 317], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [318, 319], 'children': [{'type': 'Identifier', 'name': 'Request', 'range': [319, 319], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [322, 330], 'children': [{'type': 'Identifier', 'name': 'tuple', 'range': [324, 324], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [325, 329], 'children': [{'type': 'Identifier', 'name': 'dict', 'range': [326, 326], 'children': []}, {'type': 'Identifier', 'name': 'str', 'range': [328, 328], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [331, 468], 'children': [{'type': 'VariableDecl', 'name': 'payload', 'range': [337, 345], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [338, 345], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [339, 340], 'children': [{'type': 'CallExpression', 'name': 'json', 'range': [342, 344], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [341, 342], 'children': [{'type': 'Identifier', 'name': 'request', 'range': [340, 340], 'children': []}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'required_fields', 'range': [356, 367], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [357, 367], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [358, 366], 'children': [{'type': 'Literal', 'name': '"orderId"', 'range': [359, 359], 'children': []}, {'type': 'Literal', 'name': '"status"', 'range': [361, 361], 'children': []}, {'type': 'Literal', 'name': '"trackingNumber"', 'range': [363, 363], 'children': []}, {'type': 'Literal', 'name': '"carrierCode"', 'range': [365, 365], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'missing_fields', 'range': [368, 382], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [369, 382], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [370, 381], 'children': [{'type': 'ForStatement', 'name': 'for', 'range': [371, 380], 'children': [{'type': 'VariableDecl', 'name': 'field', 'range': [371, 371], 'children': []}, {'type': 'BinaryExpression', 'name': 'in', 'range': [373, 375], 'children': [{'type': 'Identifier', 'name': 'required_fields', 'range': [374, 374], 'children': []}]}, {'type': 'UnaryExpression', 'name': 'not', 'range': [377, 378], 'children': [{'type': 'BinaryExpression', 'name': 'in', 'range': [379, 380], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [380, 380], 'children': []}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [384, 394], 'children': [{'type': 'Identifier', 'name': 'missing_fields', 'range': [385, 385], 'children': []}, {'type': 'BlockStatement', 'name': '{', 'range': [386, 394], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [388, 393], 'children': [{'type': 'NewExpression', 'name': 'ValueError', 'range': [389, 393], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [391, 392], 'children': [{'type': 'TemplateElement', 'name': '"Missing required fields: {\', \'.join(missing_fields)}"', 'range': [392, 392], 'children': []}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'normalized_payload', 'range': [401, 438], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [402, 438], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [403, 437], 'children': [{'type': 'Property', 'name': '"orderId"', 'range': [405, 410], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [408, 409], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [407, 407], 'children': []}, {'type': 'Literal', 'name': '"orderId"', 'range': [409, 409], 'children': []}]}]}, {'type': 'Property', 'name': '"status"', 'range': [413, 418], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [416, 417], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [415, 415], 'children': []}, {'type': 'Literal', 'name': '"status"', 'range': [417, 417], 'children': []}]}]}, {'type': 'Property', 'name': '"trackingNumber"', 'range': [421, 426], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [424, 425], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [423, 423], 'children': []}, {'type': 'Literal', 'name': '"trackingNumber"', 'range': [425, 425], 'children': []}]}]}, {'type': 'Property', 'name': '"carrierCode"', 'range': [429, 434], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [432, 433], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [431, 431], 'children': []}, {'type': 'Literal', 'name': '"carrierCode"', 'range': [433, 433], 'children': []}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'event_type', 'range': [458, 462], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [459, 462], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [460, 461], 'children': [{'type': 'TemplateElement', 'name': '"order.{payload[\'status\'].lower()}"', 'range': [461, 461], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [464, 468], 'children': [{'type': 'Identifier', 'name': 'normalized_payload', 'range': [465, 465], 'children': []}, {'type': 'Identifier', 'name': 'event_type', 'range': [467, 467], 'children': []}]}]}]}, {'type': 'MethodDecl', 'name': '_deregister_webhook', 'range': [470, 519], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [473, 487], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [475, 475], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [477, 477], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [478, 479], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [480, 481], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [479, 479], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [481, 481], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'credentials', 'range': [483, 483], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [484, 485], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [485, 485], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [488, 491], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [490, 490], 'children': []}]}, {'type': 'BlockStatement', 'name': '{', 'range': [492, 519], 'children': [{'type': 'ExpressionStatement', 'name': 'logger', 'range': [508, 517], 'children': [{'type': 'CallExpression', 'name': 'warning', 'range': [510, 516], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [513, 514], 'children': [{'type': 'TemplateElement', 'name': '"Warning: Manual deregistration required for webhook {webhook.id}"', 'range': [514, 514], 'children': []}]}]}]}, {'type': 'EmptyStatement', 'name': 'pass', 'range': [518, 518], 'children': []}]}]}]}]}
2025-01-08 10:21:57,687 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:24:03,715 - INFO - Step 5 result: {'type': 'Program', 'name': 'Slant3DWebhooksManager', 'range': [63, 520], 'children': [{'type': 'ClassDecl', 'name': 'Slant3DWebhooksManager', 'range': [63, 520], 'children': [{'type': 'ClassVariableDecl', 'name': 'PROVIDER_NAME', 'range': [75, 80], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [76, 80], 'children': [{'type': 'Identifier', 'name': 'ProviderName', 'range': [77, 77], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [78, 79], 'children': [{'type': 'Identifier', 'name': 'SLANT3D', 'range': [79, 79], 'children': []}]}]}]}, {'type': 'ClassVariableDecl', 'name': 'BASE_URL', 'range': [81, 84], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [82, 84], 'children': [{'type': 'Literal', 'name': '"https://www.slant3dapi.com/api"', 'range': [83, 83], 'children': []}]}]}, {'type': 'MethodDecl', 'name': '_register_webhook', 'range': [86, 299], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [89, 127], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [91, 91], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [94, 94], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [95, 96], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [96, 96], 'children': []}]}]}, {'type': 'Parameter', 'name': 'webhook_type', 'range': [99, 99], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [100, 101], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [101, 101], 'children': []}]}]}, {'type': 'Parameter', 'name': 'resource', 'range': [104, 104], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [105, 106], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [106, 106], 'children': []}]}]}, {'type': 'Parameter', 'name': 'events', 'range': [109, 109], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [110, 111], 'children': [{'type': 'Identifier', 'name': 'list', 'range': [111, 111], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [112, 114], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [113, 113], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'ingress_url', 'range': [117, 117], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [118, 119], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [119, 119], 'children': []}]}]}, {'type': 'Parameter', 'name': 'secret', 'range': [122, 122], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [123, 124], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [124, 124], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [128, 136], 'children': [{'type': 'Identifier', 'name': 'tuple', 'range': [130, 130], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [131, 135], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [132, 132], 'children': []}, {'type': 'Identifier', 'name': 'dict', 'range': [134, 134], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [137, 299], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [143, 158], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [144, 145], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [145, 150], 'children': [{'type': 'Identifier', 'name': 'credentials', 'range': [147, 147], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyCredentials', 'range': [149, 149], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [151, 158], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [153, 157], 'children': [{'type': 'NewExpression', 'name': 'ValueError', 'range': [154, 157], 'children': [{'type': 'Literal', 'name': '"API key is required to register a webhook"', 'range': [156, 156], 'children': []}]}]}]}]}, {'type': 'VariableDecl', 'name': 'headers', 'range': [160, 181], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [161, 181], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [162, 180], 'children': [{'type': 'Property', 'name': '"api-key"', 'range': [164, 173], 'children': [{'type': 'Identifier', 'name': 'credentials', 'range': [166, 166], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [167, 168], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [168, 168], 'children': []}]}, {'type': 'CallExpression', 'name': 'get_secret_value', 'range': [170, 172], 'children': []}]}, {'type': 'Property', 'name': '"Content-Type"', 'range': [175, 178], 'children': [{'type': 'Literal', 'name': '"application/json"', 'range': [177, 177], 'children': []}]}]}]}]}, {'type': 'VariableDecl', 'name': 'payload', 'range': [198, 205], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [199, 205], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [200, 204], 'children': [{'type': 'Property', 'name': '"endPoint"', 'range': [201, 203], 'children': [{'type': 'Identifier', 'name': 'ingress_url', 'range': [203, 203], 'children': []}]}]}]}]}, {'type': 'VariableDecl', 'name': 'response', 'range': [207, 226], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [208, 226], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [211, 225], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [210, 211], 'children': [{'type': 'Identifier', 'name': 'requests', 'range': [209, 209], 'children': []}]}, {'type': 'TemplateLiteral', 'name': 'f', 'range': [214, 215], 'children': [{'type': 'TemplateElement', 'name': '"{self.BASE_URL}/customer/webhookSubscribe"', 'range': [215, 215], 'children': []}]}, {'type': 'Identifier', 'name': 'headers', 'range': [217, 217], 'children': []}, {'type': 'Identifier', 'name': 'json', 'range': [221, 221], 'children': []}, {'type': 'Identifier', 'name': 'payload', 'range': [223, 223], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [228, 256], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [229, 230], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [231, 232], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [230, 230], 'children': []}, {'type': 'Identifier', 'name': 'ok', 'range': [232, 232], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [233, 256], 'children': [{'type': 'VariableDecl', 'name': 'error', 'range': [235, 249], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [236, 249], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [238, 239], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [237, 237], 'children': []}, {'type': 'CallExpression', 'name': 'json', 'range': [239, 241], 'children': []}]}, {'type': 'CallExpression', 'name': 'get', 'range': [243, 248], 'children': [{'type': 'Literal', 'name': '"error"', 'range': [245, 245], 'children': []}, {'type': 'Literal', 'name': '"Unknown error"', 'range': [247, 247], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [250, 255], 'children': [{'type': 'NewExpression', 'name': 'RuntimeError', 'range': [251, 255], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [253, 254], 'children': [{'type': 'TemplateElement', 'name': '"Failed to register webhook: {error}"', 'range': [254, 254], 'children': []}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'webhook_config', 'range': [258, 293], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [259, 293], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [260, 292], 'children': [{'type': 'Property', 'name': '"endpoint"', 'range': [262, 264], 'children': [{'type': 'Identifier', 'name': 'ingress_url', 'range': [264, 264], 'children': []}]}, {'type': 'Property', 'name': '"provider"', 'range': [267, 272], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [269, 270], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [269, 269], 'children': []}, {'type': 'Identifier', 'name': 'PROVIDER_NAME', 'range': [271, 271], 'children': []}]}]}, {'type': 'Property', 'name': '"events"', 'range': [274, 279], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [276, 278], 'children': [{'type': 'Literal', 'name': '"order.shipped"', 'range': [277, 277], 'children': []}]}]}, {'type': 'Property', 'name': '"type"', 'range': [287, 290], 'children': [{'type': 'Identifier', 'name': 'webhook_type', 'range': [289, 289], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [295, 299], 'children': [{'type': 'Literal', 'name': '""', 'range': [296, 296], 'children': []}, {'type': 'Identifier', 'name': 'webhook_config', 'range': [298, 298], 'children': []}]}]}]}, {'type': 'MethodDecl', 'name': 'validate_payload', 'range': [301, 468], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [307, 321], 'children': [{'type': 'Parameter', 'name': 'cls', 'range': [309, 309], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [311, 311], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [312, 313], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [314, 315], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [313, 313], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [315, 315], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'request', 'range': [317, 317], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [318, 319], 'children': [{'type': 'Identifier', 'name': 'Request', 'range': [319, 319], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [322, 330], 'children': [{'type': 'Identifier', 'name': 'tuple', 'range': [324, 324], 'children': []}, {'type': 'TypeParameter', 'name': '[', 'range': [325, 329], 'children': [{'type': 'Identifier', 'name': 'dict', 'range': [326, 326], 'children': []}, {'type': 'Identifier', 'name': 'str', 'range': [328, 328], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '{', 'range': [331, 468], 'children': [{'type': 'VariableDecl', 'name': 'payload', 'range': [337, 345], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [338, 345], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [339, 340], 'children': [{'type': 'CallExpression', 'name': 'json', 'range': [342, 344], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [341, 342], 'children': [{'type': 'Identifier', 'name': 'request', 'range': [340, 340], 'children': []}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'required_fields', 'range': [356, 367], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [357, 367], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [358, 366], 'children': [{'type': 'Literal', 'name': '"orderId"', 'range': [359, 359], 'children': []}, {'type': 'Literal', 'name': '"status"', 'range': [361, 361], 'children': []}, {'type': 'Literal', 'name': '"trackingNumber"', 'range': [363, 363], 'children': []}, {'type': 'Literal', 'name': '"carrierCode"', 'range': [365, 365], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'missing_fields', 'range': [368, 382], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [369, 382], 'children': [{'type': 'ArrayExpression', 'name': '[', 'range': [370, 381], 'children': [{'type': 'ForStatement', 'name': 'for', 'range': [371, 380], 'children': [{'type': 'VariableDecl', 'name': 'field', 'range': [371, 371], 'children': []}, {'type': 'BinaryExpression', 'name': 'in', 'range': [373, 375], 'children': [{'type': 'Identifier', 'name': 'required_fields', 'range': [374, 374], 'children': []}]}, {'type': 'UnaryExpression', 'name': 'not', 'range': [377, 378], 'children': [{'type': 'BinaryExpression', 'name': 'in', 'range': [379, 380], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [380, 380], 'children': []}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [384, 394], 'children': [{'type': 'Identifier', 'name': 'missing_fields', 'range': [385, 385], 'children': []}, {'type': 'BlockStatement', 'name': '{', 'range': [386, 394], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [388, 393], 'children': [{'type': 'NewExpression', 'name': 'ValueError', 'range': [389, 393], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [391, 392], 'children': [{'type': 'TemplateElement', 'name': '"Missing required fields: {\', \'.join(missing_fields)}"', 'range': [392, 392], 'children': []}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'normalized_payload', 'range': [401, 438], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [402, 438], 'children': [{'type': 'ObjectExpression', 'name': '{', 'range': [403, 437], 'children': [{'type': 'Property', 'name': '"orderId"', 'range': [405, 410], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [408, 409], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [407, 407], 'children': []}, {'type': 'Literal', 'name': '"orderId"', 'range': [409, 409], 'children': []}]}]}, {'type': 'Property', 'name': '"status"', 'range': [413, 418], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [416, 417], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [415, 415], 'children': []}, {'type': 'Literal', 'name': '"status"', 'range': [417, 417], 'children': []}]}]}, {'type': 'Property', 'name': '"trackingNumber"', 'range': [421, 426], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [424, 425], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [423, 423], 'children': []}, {'type': 'Literal', 'name': '"trackingNumber"', 'range': [425, 425], 'children': []}]}]}, {'type': 'Property', 'name': '"carrierCode"', 'range': [429, 434], 'children': [{'type': 'MemberExpression', 'name': '[', 'range': [432, 433], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [431, 431], 'children': []}, {'type': 'Literal', 'name': '"carrierCode"', 'range': [433, 433], 'children': []}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'event_type', 'range': [458, 462], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [459, 462], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [460, 461], 'children': [{'type': 'TemplateElement', 'name': '"order.{payload[\'status\'].lower()}"', 'range': [461, 461], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [464, 468], 'children': [{'type': 'Identifier', 'name': 'normalized_payload', 'range': [465, 465], 'children': []}, {'type': 'Identifier', 'name': 'event_type', 'range': [467, 467], 'children': []}]}]}]}, {'type': 'MethodDecl', 'name': '_deregister_webhook', 'range': [470, 519], 'children': [{'type': 'FunctionSignature', 'name': '(', 'range': [473, 487], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [475, 475], 'children': []}, {'type': 'Parameter', 'name': 'webhook', 'range': [477, 477], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [478, 479], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [480, 481], 'children': [{'type': 'Identifier', 'name': 'integrations', 'range': [479, 479], 'children': []}, {'type': 'Identifier', 'name': 'Webhook', 'range': [481, 481], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'credentials', 'range': [483, 483], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [484, 485], 'children': [{'type': 'Identifier', 'name': 'Credentials', 'range': [485, 485], 'children': []}]}]}]}, {'type': 'ReturnTypeAnnotation', 'name': '->', 'range': [488, 491], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [490, 490], 'children': []}]}, {'type': 'BlockStatement', 'name': '{', 'range': [492, 519], 'children': [{'type': 'ExpressionStatement', 'name': 'logger', 'range': [508, 517], 'children': [{'type': 'CallExpression', 'name': 'warning', 'range': [510, 516], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [513, 514], 'children': [{'type': 'TemplateElement', 'name': '"Warning: Manual deregistration required for webhook {webhook.id}"', 'range': [514, 514], 'children': []}]}]}]}, {'type': 'EmptyStatement', 'name': 'pass', 'range': [518, 518], 'children': []}]}]}]}]}
2025-01-08 10:24:03,715 - INFO - Completed main AST analysis flow
2025-01-08 10:24:03,717 - INFO - Successfully processed chunk
2025-01-08 10:24:03,757 - INFO - Starting code generation from AST
2025-01-08 10:24:22,966 - INFO - Successfully generated code from AST
2025-01-08 10:24:22,967 - INFO - Starting static code similarity comparison
2025-01-08 10:24:22,975 - INFO - Static similarity result: {'final_score': 90.89, 'length_similarity': 89.52, 'token_similarity': 85.71, 'structure_similarity': 87.01, 'function_similarity': 100, 'complexity_similarity': 100.0, 'variable_similarity': 100}
