2025-01-08 10:27:27,347 - INFO - Processing sample 104
2025-01-08 10:27:27,347 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 10:27:44,175 - INFO - Successfully split code into 19 top-level declarations
2025-01-08 10:27:45,380 - INFO - Processing chunk #0 (size=211 chars, start_index=0)
2025-01-08 10:27:45,388 - INFO - Processing chunk with 211 chars starting at index 0
2025-01-08 10:27:45,481 - INFO - Starting main AST analysis flow
2025-01-08 10:27:45,731 - INFO - Tokenized code into 50 tokens
2025-01-08 10:27:45,741 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:45,805 - INFO - Processing chunk #1 (size=95 chars, start_index=50)
2025-01-08 10:27:45,977 - INFO - Processing chunk #2 (size=542 chars, start_index=65)
2025-01-08 10:27:46,434 - INFO - Processing chunk #3 (size=572 chars, start_index=107)
2025-01-08 10:27:46,718 - INFO - Processing chunk with 95 chars starting at index 50
2025-01-08 10:27:46,758 - INFO - Processing chunk with 542 chars starting at index 65
2025-01-08 10:27:47,002 - INFO - Processing chunk #4 (size=741 chars, start_index=149)
2025-01-08 10:27:47,833 - INFO - Processing chunk with 572 chars starting at index 107
2025-01-08 10:27:49,248 - INFO - Starting main AST analysis flow
2025-01-08 10:27:49,737 - INFO - Processing chunk #5 (size=1523 chars, start_index=235)
2025-01-08 10:27:49,820 - INFO - Starting main AST analysis flow
2025-01-08 10:27:49,991 - INFO - Processing chunk with 741 chars starting at index 149
2025-01-08 10:27:50,037 - INFO - Starting main AST analysis flow
2025-01-08 10:27:50,213 - INFO - Tokenized code into 15 tokens
2025-01-08 10:27:50,236 - INFO - Processing chunk with 1523 chars starting at index 235
2025-01-08 10:27:50,259 - INFO - Tokenized code into 42 tokens
2025-01-08 10:27:50,275 - INFO - Starting main AST analysis flow
2025-01-08 10:27:50,289 - INFO - Tokenized code into 42 tokens
2025-01-08 10:27:50,294 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:50,298 - INFO - Starting main AST analysis flow
2025-01-08 10:27:50,299 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:50,300 - INFO - Tokenized code into 86 tokens
2025-01-08 10:27:50,303 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:50,312 - INFO - Tokenized code into 186 tokens
2025-01-08 10:27:50,321 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:50,329 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:51,504 - INFO - Processing chunk #6 (size=1082 chars, start_index=421)
2025-01-08 10:27:51,535 - INFO - Processing chunk with 1082 chars starting at index 421
2025-01-08 10:27:51,535 - INFO - Starting main AST analysis flow
2025-01-08 10:27:51,535 - INFO - Tokenized code into 153 tokens
2025-01-08 10:27:51,535 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:51,553 - INFO - Processing chunk #7 (size=3714 chars, start_index=574)
2025-01-08 10:27:51,573 - INFO - Processing chunk with 3714 chars starting at index 574
2025-01-08 10:27:51,573 - INFO - Starting main AST analysis flow
2025-01-08 10:27:51,574 - INFO - Tokenized code into 496 tokens
2025-01-08 10:27:51,574 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:51,612 - INFO - Processing chunk #8 (size=959 chars, start_index=1070)
2025-01-08 10:27:51,747 - INFO - Processing chunk with 959 chars starting at index 1070
2025-01-08 10:27:51,747 - INFO - Starting main AST analysis flow
2025-01-08 10:27:51,748 - INFO - Tokenized code into 123 tokens
2025-01-08 10:27:51,748 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:52,782 - INFO - Processing chunk #9 (size=4278 chars, start_index=1193)
2025-01-08 10:27:52,793 - INFO - Processing chunk with 4278 chars starting at index 1193
2025-01-08 10:27:52,793 - INFO - Starting main AST analysis flow
2025-01-08 10:27:52,794 - INFO - Tokenized code into 410 tokens
2025-01-08 10:27:52,795 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:52,796 - INFO - Processing chunk #10 (size=2174 chars, start_index=1603)
2025-01-08 10:27:52,837 - INFO - Processing chunk with 2174 chars starting at index 1603
2025-01-08 10:27:52,838 - INFO - Starting main AST analysis flow
2025-01-08 10:27:52,838 - INFO - Tokenized code into 345 tokens
2025-01-08 10:27:52,839 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:55,854 - INFO - Processing chunk #11 (size=1403 chars, start_index=1948)
2025-01-08 10:27:56,329 - INFO - Processing chunk with 1403 chars starting at index 1948
2025-01-08 10:27:56,329 - INFO - Starting main AST analysis flow
2025-01-08 10:27:56,330 - INFO - Tokenized code into 197 tokens
2025-01-08 10:27:56,330 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:56,471 - INFO - Processing chunk #12 (size=2147 chars, start_index=2145)
2025-01-08 10:27:56,829 - INFO - Processing chunk with 2147 chars starting at index 2145
2025-01-08 10:27:56,855 - INFO - Starting main AST analysis flow
2025-01-08 10:27:56,856 - INFO - Tokenized code into 293 tokens
2025-01-08 10:27:57,229 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:57,242 - INFO - Processing chunk #13 (size=1227 chars, start_index=2438)
2025-01-08 10:27:57,443 - INFO - Processing chunk #14 (size=803 chars, start_index=2617)
2025-01-08 10:27:57,706 - INFO - Processing chunk #15 (size=664 chars, start_index=2726)
2025-01-08 10:27:57,756 - INFO - Processing chunk #16 (size=1687 chars, start_index=2812)
2025-01-08 10:27:57,988 - INFO - Processing chunk with 1227 chars starting at index 2438
2025-01-08 10:27:58,261 - INFO - Processing chunk with 803 chars starting at index 2617
2025-01-08 10:27:58,287 - INFO - Processing chunk with 664 chars starting at index 2726
2025-01-08 10:27:58,307 - INFO - Processing chunk with 1687 chars starting at index 2812
2025-01-08 10:27:58,363 - INFO - Starting main AST analysis flow
2025-01-08 10:27:58,565 - INFO - Starting main AST analysis flow
2025-01-08 10:27:58,595 - INFO - Starting main AST analysis flow
2025-01-08 10:27:58,610 - INFO - Starting main AST analysis flow
2025-01-08 10:27:58,668 - INFO - Tokenized code into 179 tokens
2025-01-08 10:27:58,683 - INFO - Tokenized code into 109 tokens
2025-01-08 10:27:58,695 - INFO - Processing chunk #17 (size=885 chars, start_index=3021)
2025-01-08 10:27:58,698 - INFO - Tokenized code into 86 tokens
2025-01-08 10:27:58,718 - INFO - Tokenized code into 209 tokens
2025-01-08 10:27:58,728 - INFO - Processing chunk #18 (size=720 chars, start_index=3165)
2025-01-08 10:27:58,803 - INFO - Processing chunk with 720 chars starting at index 3165
2025-01-08 10:27:58,741 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:58,755 - INFO - Processing chunk with 885 chars starting at index 3021
2025-01-08 10:27:58,780 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:58,786 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:58,732 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:58,809 - INFO - Starting main AST analysis flow
2025-01-08 10:27:58,825 - INFO - Starting main AST analysis flow
2025-01-08 10:27:58,851 - INFO - Tokenized code into 104 tokens
2025-01-08 10:27:58,853 - INFO - Step 1 result: {'type': 'Program', 'name': 'TopAgentsDBResponse', 'range': [65, 106], 'children': []}
2025-01-08 10:27:58,860 - INFO - Tokenized code into 144 tokens
2025-01-08 10:27:58,861 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:58,863 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:27:58,869 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,292 - INFO - Step 1 result: {'type': 'Program', 'name': 'delete_agent', 'range': [149, 234], 'children': []}
2025-01-08 10:27:59,293 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:00,021 - INFO - Step 1 result: {'type': 'Program', 'name': 'update_agent_entry', 'range': [421, 573], 'children': []}
2025-01-08 10:28:00,021 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:00,205 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_agents', 'range': [574, 1069], 'children': []}
2025-01-08 10:28:00,205 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:00,458 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_agent_details', 'range': [1070, 1192], 'children': []}
2025-01-08 10:28:00,458 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:00,465 - INFO - Step 1 result: {'type': 'Program', 'name': 'FeaturedAgentResponse', 'range': [107, 148], 'children': []}
2025-01-08 10:28:00,483 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:00,975 - INFO - Step 1 result: {'type': 'Program', 'name': 'create_agent_entry', 'range': [235, 420], 'children': []}
2025-01-08 10:28:00,975 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:00,976 - INFO - Step 1 result: {'type': 'Program', 'name': 'AgentQueryError', 'range': [50, 64], 'children': []}
2025-01-08 10:28:01,035 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:01,119 - INFO - Step 1 result: {'type': 'Program', 'name': 'set_agent_featured', 'range': [1948, 2144], 'children': []}
2025-01-08 10:28:01,119 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:01,146 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_top_agents_by_downloads', 'range': [1603, 1947], 'children': []}
2025-01-08 10:28:01,147 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:02,251 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_featured_agents', 'range': [2145, 2437], 'children': []}
2025-01-08 10:28:02,333 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:02,802 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 49], 'children': [{'type': 'ImportDeclaration', 'name': 'datetime', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': 'typing', 'range': [3, 5], 'children': []}, {'type': 'ImportDeclaration', 'name': 'fuzzywuzzy.fuzz', 'range': [7, 11], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.enums', 'range': [12, 16], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.errors', 'range': [17, 21], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.models', 'range': [22, 26], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.types', 'range': [27, 31], 'children': []}, {'type': 'ImportDeclaration', 'name': 'pydantic', 'range': [32, 34], 'children': []}, {'type': 'ImportDeclaration', 'name': 'market.model', 'range': [36, 40], 'children': []}, {'type': 'ImportDeclaration', 'name': 'market.utils.extension_types', 'range': [41, 47], 'children': []}]}
2025-01-08 10:28:02,802 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:08,061 - INFO - Step 1 result: {'type': 'Program', 'name': 'remove_featured_category', 'range': [2438, 2616], 'children': []}
2025-01-08 10:28:08,061 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:08,147 - INFO - Step 1 result: {'type': 'Program', 'name': 'search_db', 'range': [1193, 1602], 'children': [{'type': 'FunctionDeclaration', 'name': 'search_db', 'range': [1193, 1602], 'children': [{'type': 'Parameter', 'name': 'query', 'range': [1198, 1200]}, {'type': 'Parameter', 'name': 'page', 'range': [1203, 1207]}, {'type': 'Parameter', 'name': 'page_size', 'range': [1210, 1214]}, {'type': 'Parameter', 'name': 'categories', 'range': [1217, 1228]}, {'type': 'Parameter', 'name': 'description_threshold', 'range': [1231, 1235]}, {'type': 'Parameter', 'name': 'sort_by', 'range': [1238, 1242]}, {'type': 'Parameter', 'name': 'sort_order', 'range': [1245, 1261]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [1264, 1278]}, {'type': 'ReturnType', 'name': 'market.model.ListResponse[market.utils.extension_types.AgentsWithRank]', 'range': [1284, 1297]}]}, {'type': 'ClassDeclaration', 'name': 'CountResponse', 'range': [1467, 1479], 'children': [{'type': 'Property', 'name': 'count', 'range': [1476, 1478]}]}]}
2025-01-08 10:28:08,445 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:08,758 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_not_featured_agents', 'range': [2812, 3020], 'children': []}
2025-01-08 10:28:08,779 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,395 - INFO - Step 1 result: {'type': 'Program', 'name': 'add_featured_category', 'range': [2617, 2725], 'children': []}
2025-01-08 10:28:10,395 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,645 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_all_categories', 'range': [3021, 3164], 'children': []}
2025-01-08 10:28:10,645 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,763 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_agent_featured', 'range': [2726, 2811], 'children': []}
2025-01-08 10:28:10,763 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,608 - INFO - Step 1 result: {'type': 'Program', 'name': 'create_agent_installed_event', 'range': [3165, 3268], 'children': []}
2025-01-08 10:28:11,608 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:12,325 - INFO - Step 2 result: {'type': 'Program', 'name': 'AgentQueryError', 'range': [50, 64], 'children': [{'type': 'ClassDeclaration', 'name': 'AgentQueryError', 'range': [50, 64], 'children': [{'type': 'Inheritance', 'name': 'Exception', 'range': [52, 54], 'children': []}, {'type': 'Docstring', 'name': 'Custom exception for agent query errors', 'range': [57, 59], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [62, 62], 'children': []}]}]}
2025-01-08 10:28:12,326 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:20,315 - INFO - Step 2 result: {'type': 'Program', 'name': 'TopAgentsDBResponse', 'range': [65, 106], 'children': [{'type': 'ClassDeclaration', 'name': 'TopAgentsDBResponse', 'range': [65, 106], 'children': [{'type': 'Inheritance', 'name': 'BaseModel', 'range': [67, 71], 'children': [{'type': 'Module', 'name': 'pydantic', 'range': [68, 70], 'children': []}]}, {'type': 'Docstring', 'name': 'Docstring', 'range': [74, 76], 'children': []}, {'type': 'Attribute', 'name': 'analytics', 'range': [79, 88], 'children': [{'type': 'Type', 'name': 'list', 'range': [81, 88], 'children': [{'type': 'Module', 'name': 'prisma', 'range': [83, 87], 'children': []}]}]}, {'type': 'Attribute', 'name': 'total_count', 'range': [90, 92], 'children': [{'type': 'Type', 'name': 'int', 'range': [92, 92], 'children': []}]}, {'type': 'Attribute', 'name': 'page', 'range': [94, 96], 'children': [{'type': 'Type', 'name': 'int', 'range': [96, 96], 'children': []}]}, {'type': 'Attribute', 'name': 'page_size', 'range': [98, 100], 'children': [{'type': 'Type', 'name': 'int', 'range': [100, 100], 'children': []}]}, {'type': 'Attribute', 'name': 'total_pages', 'range': [102, 104], 'children': [{'type': 'Type', 'name': 'int', 'range': [104, 104], 'children': []}]}]}]}
2025-01-08 10:28:20,315 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:21,623 - INFO - Step 2 result: {'type': 'Program', 'name': 'FeaturedAgentResponse', 'range': [107, 148], 'children': [{'type': 'ClassDeclaration', 'name': 'FeaturedAgentResponse', 'range': [107, 148], 'children': [{'type': 'Inheritance', 'name': 'BaseModel', 'range': [109, 113], 'children': [{'type': 'Module', 'name': 'pydantic', 'range': [110, 110], 'children': []}]}, {'type': 'Docstring', 'name': '', 'range': [116, 118], 'children': []}, {'type': 'Attribute', 'name': 'featured_agents', 'range': [121, 130], 'children': [{'type': 'Type', 'name': 'list', 'range': [123, 123], 'children': [{'type': 'Module', 'name': 'prisma', 'range': [125, 125], 'children': [{'type': 'SubModule', 'name': 'models', 'range': [127, 127], 'children': [{'type': 'Class', 'name': 'FeaturedAgent', 'range': [129, 129], 'children': []}]}]}]}]}, {'type': 'Attribute', 'name': 'total_count', 'range': [132, 134], 'children': [{'type': 'Type', 'name': 'int', 'range': [134, 134], 'children': []}]}, {'type': 'Attribute', 'name': 'page', 'range': [136, 138], 'children': [{'type': 'Type', 'name': 'int', 'range': [138, 138], 'children': []}]}, {'type': 'Attribute', 'name': 'page_size', 'range': [140, 142], 'children': [{'type': 'Type', 'name': 'int', 'range': [142, 142], 'children': []}]}, {'type': 'Attribute', 'name': 'total_pages', 'range': [144, 146], 'children': [{'type': 'Type', 'name': 'int', 'range': [146, 146], 'children': []}]}]}]}
2025-01-08 10:28:21,623 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:21,972 - INFO - Step 3 result: {'type': 'Program', 'name': 'AgentQueryError', 'range': [50, 64], 'children': [{'type': 'ClassDeclaration', 'name': 'AgentQueryError', 'range': [50, 64], 'children': [{'type': 'Inheritance', 'name': 'Exception', 'range': [52, 54], 'children': []}, {'type': 'Docstring', 'name': 'Custom exception for agent query errors', 'range': [57, 59], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [62, 62], 'children': []}]}]}
2025-01-08 10:28:21,972 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:27,394 - INFO - Step 4 result: {'type': 'Program', 'name': 'AgentQueryError', 'range': [50, 64], 'children': [{'type': 'ClassDecl', 'name': 'AgentQueryError', 'range': [50, 64], 'children': [{'type': 'Inheritance', 'name': 'Exception', 'range': [52, 54], 'children': []}, {'type': 'Docstring', 'name': 'Custom exception for agent query errors', 'range': [57, 59], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [62, 62], 'children': []}]}]}
2025-01-08 10:28:27,395 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:29,182 - INFO - Step 2 result: {'nodes': [{'type': 'ImportDeclaration', 'name': 'datetime', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'datetime', 'range': [0, 2], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'typing', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'typing', 'range': [3, 5], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'fuzzywuzzy.fuzz', 'range': [7, 11], 'children': [{'type': 'ImportSpecifier', 'name': 'fuzzywuzzy', 'range': [7, 8], 'children': []}, {'type': 'ImportSpecifier', 'name': 'fuzz', 'range': [10, 11], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'prisma.enums', 'range': [12, 16], 'children': [{'type': 'ImportSpecifier', 'name': 'prisma', 'range': [12, 13], 'children': []}, {'type': 'ImportSpecifier', 'name': 'enums', 'range': [15, 16], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'prisma.errors', 'range': [17, 21], 'children': [{'type': 'ImportSpecifier', 'name': 'prisma', 'range': [17, 18], 'children': []}, {'type': 'ImportSpecifier', 'name': 'errors', 'range': [20, 21], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'prisma.models', 'range': [22, 26], 'children': [{'type': 'ImportSpecifier', 'name': 'prisma', 'range': [22, 23], 'children': []}, {'type': 'ImportSpecifier', 'name': 'models', 'range': [25, 26], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'prisma.types', 'range': [27, 31], 'children': [{'type': 'ImportSpecifier', 'name': 'prisma', 'range': [27, 28], 'children': []}, {'type': 'ImportSpecifier', 'name': 'types', 'range': [30, 31], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'pydantic', 'range': [32, 34], 'children': [{'type': 'ImportSpecifier', 'name': 'pydantic', 'range': [32, 34], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'market.model', 'range': [36, 40], 'children': [{'type': 'ImportSpecifier', 'name': 'market', 'range': [36, 37], 'children': []}, {'type': 'ImportSpecifier', 'name': 'model', 'range': [39, 40], 'children': []}]}, {'type': 'ImportDeclaration', 'name': 'market.utils.extension_types', 'range': [41, 47], 'children': [{'type': 'ImportSpecifier', 'name': 'market', 'range': [41, 42], 'children': []}, {'type': 'ImportSpecifier', 'name': 'utils', 'range': [43, 44], 'children': []}, {'type': 'ImportSpecifier', 'name': 'extension_types', 'range': [46, 47], 'children': []}]}]}
2025-01-08 10:28:29,183 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:32,907 - INFO - Step 5 result: {'type': 'Program', 'name': 'AgentQueryError', 'range': [50, 64], 'children': [{'type': 'ClassDecl', 'name': 'AgentQueryError', 'range': [50, 64], 'children': [{'type': 'Inheritance', 'name': 'Exception', 'range': [52, 54], 'children': []}, {'type': 'Docstring', 'name': 'Custom exception for agent query errors', 'range': [57, 59], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [62, 62], 'children': []}]}]}
2025-01-08 10:28:32,907 - INFO - Completed main AST analysis flow
2025-01-08 10:28:32,907 - INFO - Successfully processed chunk
2025-01-08 10:28:33,013 - INFO - Step 2 result: {'type': 'Program', 'name': 'delete_agent', 'range': [149, 234], 'children': [{'type': 'FunctionDeclaration', 'name': 'delete_agent', 'range': [149, 234], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [149, 149], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [150, 150], 'children': []}, {'type': 'Identifier', 'name': 'delete_agent', 'range': [151, 151], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [152, 152], 'children': []}, {'type': 'Parameter', 'name': 'agent_id', 'range': [153, 153], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [154, 154], 'children': [{'type': 'Type', 'name': 'str', 'range': [155, 155], 'children': []}]}]}, {'type': 'Punctuation', 'name': ')', 'range': [156, 156], 'children': []}, {'type': 'ReturnType', 'name': '->', 'range': [157, 158], 'children': [{'type': 'Type', 'name': 'prisma.models.Agents | None', 'range': [159, 165], 'children': []}]}, {'type': 'Punctuation', 'name': ':', 'range': [166, 166], 'children': []}, {'type': 'Docstring', 'name': '"""', 'range': [168, 170], 'children': [{'type': 'Text', 'name': 'Delete an agent from the database.', 'range': [169, 169], 'children': []}]}, {'type': 'Block', 'name': 'try', 'range': [172, 233], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [172, 172], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [173, 173], 'children': []}, {'type': 'Statement', 'name': 'deleted_agent = await prisma.models.Agents.prisma().delete(where={"id": agent_id})', 'range': [175, 199], 'children': []}, {'type': 'Keyword', 'name': 'return', 'range': [201, 201], 'children': [{'type': 'Identifier', 'name': 'deleted_agent', 'range': [202, 202], 'children': []}]}, {'type': 'ExceptBlock', 'name': 'except', 'range': [204, 232], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [204, 204], 'children': []}, {'type': 'Exception', 'name': 'PrismaError', 'range': [205, 209], 'children': []}, {'type': 'Keyword', 'name': 'as', 'range': [210, 210], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [211, 211], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [212, 212], 'children': []}, {'type': 'Statement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [214, 219], 'children': []}, {'type': 'ExceptBlock', 'name': 'except', 'range': [221, 232], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [221, 221], 'children': []}, {'type': 'Exception', 'name': 'Exception', 'range': [222, 222], 'children': []}, {'type': 'Keyword', 'name': 'as', 'range': [223, 223], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [224, 224], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [225, 225], 'children': []}, {'type': 'Statement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [227, 232], 'children': []}]}]}]}]}]}
2025-01-08 10:28:33,013 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:33,240 - INFO - Step 3 result: {'type': 'Program', 'name': 'TopAgentsDBResponse', 'range': [65, 106], 'children': [{'type': 'ClassDeclaration', 'name': 'TopAgentsDBResponse', 'range': [65, 106], 'children': [{'type': 'Inheritance', 'name': 'BaseModel', 'range': [67, 71], 'children': [{'type': 'Module', 'name': 'pydantic', 'range': [68, 70], 'children': []}]}, {'type': 'Docstring', 'name': 'Docstring', 'range': [74, 76], 'children': []}, {'type': 'Attribute', 'name': 'analytics', 'range': [79, 88], 'children': [{'type': 'Type', 'name': 'list', 'range': [81, 88], 'children': [{'type': 'Module', 'name': 'prisma', 'range': [83, 87], 'children': []}]}]}, {'type': 'Attribute', 'name': 'total_count', 'range': [90, 92], 'children': [{'type': 'Type', 'name': 'int', 'range': [92, 92], 'children': []}]}, {'type': 'Attribute', 'name': 'page', 'range': [94, 96], 'children': [{'type': 'Type', 'name': 'int', 'range': [96, 96], 'children': []}]}, {'type': 'Attribute', 'name': 'page_size', 'range': [98, 100], 'children': [{'type': 'Type', 'name': 'int', 'range': [100, 100], 'children': []}]}, {'type': 'Attribute', 'name': 'total_pages', 'range': [102, 104], 'children': [{'type': 'Type', 'name': 'int', 'range': [104, 104], 'children': []}]}]}]}
2025-01-08 10:28:33,240 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:35,340 - INFO - Step 2 result: {'type': 'Program', 'name': 'update_agent_entry', 'range': [421, 573], 'children': [{'type': 'FunctionDeclaration', 'name': 'update_agent_entry', 'range': [421, 573], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [421, 421], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [422, 422], 'children': []}, {'type': 'Identifier', 'name': 'update_agent_entry', 'range': [423, 423], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [424, 424], 'children': []}, {'type': 'Parameter', 'name': 'agent_id', 'range': [426, 428], 'children': [{'type': 'Identifier', 'name': 'agent_id', 'range': [426, 426], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [427, 427], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [428, 428], 'children': []}]}, {'type': 'Parameter', 'name': 'version', 'range': [431, 433], 'children': [{'type': 'Identifier', 'name': 'version', 'range': [431, 431], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [432, 432], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [433, 433], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_state', 'range': [436, 442], 'children': [{'type': 'Identifier', 'name': 'submission_state', 'range': [436, 436], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [437, 437], 'children': []}, {'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [438, 442], 'children': []}]}, {'type': 'Parameter', 'name': 'comments', 'range': [445, 451], 'children': [{'type': 'Identifier', 'name': 'comments', 'range': [445, 445], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [446, 446], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str | None', 'range': [447, 451], 'children': []}]}, {'type': 'Punctuation', 'name': ')', 'range': [454, 454], 'children': []}, {'type': 'ReturnType', 'name': '-> prisma.models.Agents | None', 'range': [455, 463], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [464, 464], 'children': []}, {'type': 'Docstring', 'name': '""" \\n     Update an existing agent entry in the database. \\n  \\n     Args: \\n         agent_id (str): The ID of the agent. \\n         version (int): The version of the agent. \\n         submission_state (prisma.enums.SubmissionStatus): The submission state of the agent. \\n     """', 'range': [466, 468], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [471, 572], 'children': [{'type': 'Block', 'name': '', 'range': [473, 538], 'children': [{'type': 'AssignmentExpression', 'name': 'agent = await prisma.models.Agents.prisma().update(where={"id": agent_id}, data={"version": version, "submissionStatus": submission_state, "submissionReviewDate": datetime.datetime.now(datetime.timezone.utc), "submissionReviewComments": comments})', 'range': [474, 537], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except prisma.errors.PrismaError as e', 'range': [543, 558], 'children': [{'type': 'RaiseStatement', 'name': 'raise AgentQueryError(f"Agent Update Failed Database query failed: {str(e)}")', 'range': [553, 558], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except Exception as e', 'range': [560, 571], 'children': [{'type': 'RaiseStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [566, 571], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return agent', 'range': [540, 542], 'children': []}]}]}
2025-01-08 10:28:35,340 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:35,453 - INFO - Step 3 result: {'type': 'Program', 'name': 'FeaturedAgentResponse', 'range': [107, 148], 'children': [{'type': 'ClassDeclaration', 'name': 'FeaturedAgentResponse', 'range': [107, 148], 'children': [{'type': 'Inheritance', 'name': 'BaseModel', 'range': [109, 113], 'children': [{'type': 'Module', 'name': 'pydantic', 'range': [110, 110], 'children': []}]}, {'type': 'Docstring', 'name': '', 'range': [116, 118], 'children': []}, {'type': 'Attribute', 'name': 'featured_agents', 'range': [121, 130], 'children': [{'type': 'Type', 'name': 'list', 'range': [123, 123], 'children': [{'type': 'Module', 'name': 'prisma', 'range': [125, 125], 'children': [{'type': 'SubModule', 'name': 'models', 'range': [127, 127], 'children': [{'type': 'Class', 'name': 'FeaturedAgent', 'range': [129, 129], 'children': []}]}]}]}]}, {'type': 'Attribute', 'name': 'total_count', 'range': [132, 134], 'children': [{'type': 'Type', 'name': 'int', 'range': [134, 134], 'children': []}]}, {'type': 'Attribute', 'name': 'page', 'range': [136, 138], 'children': [{'type': 'Type', 'name': 'int', 'range': [138, 138], 'children': []}]}, {'type': 'Attribute', 'name': 'page_size', 'range': [140, 142], 'children': [{'type': 'Type', 'name': 'int', 'range': [142, 142], 'children': []}]}, {'type': 'Attribute', 'name': 'total_pages', 'range': [144, 146], 'children': [{'type': 'Type', 'name': 'int', 'range': [146, 146], 'children': []}]}]}]}
2025-01-08 10:28:35,453 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:38,139 - INFO - Step 3 result: {'nodes': [{'type': 'ImportDeclaration', 'name': 'datetime', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': 'typing', 'range': [3, 5], 'children': []}, {'type': 'ImportDeclaration', 'name': 'fuzzywuzzy.fuzz', 'range': [7, 11], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.enums', 'range': [12, 16], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.errors', 'range': [17, 21], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.models', 'range': [22, 26], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.types', 'range': [27, 31], 'children': []}, {'type': 'ImportDeclaration', 'name': 'pydantic', 'range': [32, 34], 'children': []}, {'type': 'ImportDeclaration', 'name': 'market.model', 'range': [36, 40], 'children': []}, {'type': 'ImportDeclaration', 'name': 'market.utils.extension_types', 'range': [41, 47], 'children': []}]}
2025-01-08 10:28:38,141 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:39,308 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_top_agents_by_downloads', 'range': [1603, 1947], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_top_agents_by_downloads', 'range': [1603, 1947], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1603, 1607], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1604, 1607], 'children': []}, {'type': 'Identifier', 'name': 'get_top_agents_by_downloads', 'range': [1605, 1639], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [1606, 1639], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [1608, 1612], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [1609, 1612], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [1615, 1619], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [1616, 1619], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [1622, 1636], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [1623, 1636], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'market.model.ListResponse[prisma.models.AnalyticsTracker]', 'range': [1640, 1653], 'children': []}, {'type': 'Block', 'name': '', 'range': [1655, 1947], 'children': [{'type': 'TryStatement', 'name': '', 'range': [1660, 1947], 'children': [{'type': 'Block', 'name': '', 'range': [1662, 1888], 'children': [{'type': 'ExpressionStatement', 'name': 'skip = (page - 1) * page_size', 'range': [1667, 1676], 'children': []}, {'type': 'TryStatement', 'name': '', 'range': [1683, 1787], 'children': [{'type': 'Block', 'name': '', 'range': [1685, 1770], 'children': [{'type': 'ExpressionStatement', 'name': 'analytics = await prisma.models.AnalyticsTracker.prisma().find_many(...)', 'range': [1708, 1770], 'children': []}]}, {'type': 'CatchClause', 'name': 'PrismaError', 'range': [1771, 1787], 'children': [{'type': 'Block', 'name': '', 'range': [1779, 1787], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [1781, 1787], 'children': []}]}]}]}, {'type': 'TryStatement', 'name': '', 'range': [1789, 1843], 'children': [{'type': 'Block', 'name': '', 'range': [1791, 1826], 'children': [{'type': 'ExpressionStatement', 'name': 'total_count = await prisma.models.AnalyticsTracker.prisma().count(...)', 'range': [1792, 1826], 'children': []}]}, {'type': 'CatchClause', 'name': 'PrismaError', 'range': [1827, 1843], 'children': [{'type': 'Block', 'name': '', 'range': [1835, 1843], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [1837, 1843], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return market.model.ListResponse(...)', 'range': [1845, 1888], 'children': []}]}, {'type': 'CatchClause', 'name': 'AgentQueryError', 'range': [1890, 1910], 'children': [{'type': 'Block', 'name': '', 'range': [1894, 1910], 'children': [{'type': 'ThrowStatement', 'name': 'raise e from e', 'range': [1906, 1910], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'ValueError', 'range': [1911, 1925], 'children': [{'type': 'Block', 'name': '', 'range': [1915, 1925], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Invalid input parameter: {str(e)}") from e', 'range': [1917, 1925], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'Exception', 'range': [1926, 1947], 'children': [{'type': 'Block', 'name': '', 'range': [1930, 1947], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}") from e', 'range': [1939, 1947], 'children': []}]}]}]}]}]}]}
2025-01-08 10:28:39,309 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:41,745 - INFO - Step 2 result: {'type': 'Program', 'name': 'set_agent_featured', 'range': [1948, 2144], 'children': [{'type': 'FunctionDeclaration', 'name': 'set_agent_featured', 'range': [1948, 2144], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1948, 1952], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1949, 1952], 'children': []}, {'type': 'FunctionName', 'name': 'set_agent_featured', 'range': [1950, 1974], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1951, 1974], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [1953, 1955], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1955, 1956], 'children': []}, {'type': 'Parameter', 'name': 'is_active', 'range': [1957, 1959], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [1959, 1960], 'children': []}, {'type': 'DefaultValue', 'name': 'True', 'range': [1961, 1962], 'children': []}, {'type': 'Parameter', 'name': 'featured_categories', 'range': [1963, 1965], 'children': []}, {'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [1965, 1969], 'children': []}, {'type': 'DefaultValue', 'name': '["featured"]', 'range': [1970, 1972], 'children': []}]}, {'type': 'ReturnType', 'name': 'prisma.models.FeaturedAgent', 'range': [1975, 1982], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [1984, 1988], 'children': []}, {'type': 'TryBlock', 'name': 'try', 'range': [1990, 2131], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [1990, 1991], 'children': []}, {'type': 'Block', 'name': 'try_block', 'range': [1992, 2131], 'children': [{'type': 'Assignment', 'name': 'agent', 'range': [1993, 2015], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [1995, 1996], 'children': []}, {'type': 'FunctionCall', 'name': 'prisma.models.Agents.prisma().find_unique', 'range': [1996, 2015], 'children': [{'type': 'Argument', 'name': 'where', 'range': [2008, 2014], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [2017, 2028], 'children': [{'type': 'Condition', 'name': 'not agent', 'range': [2018, 2020], 'children': []}, {'type': 'Block', 'name': 'if_block', 'range': [2021, 2028], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2022, 2027], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2023, 2027], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'featured', 'range': [2030, 2110], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [2032, 2033], 'children': []}, {'type': 'FunctionCall', 'name': 'prisma.models.FeaturedAgent.prisma().upsert', 'range': [2033, 2110], 'children': [{'type': 'Argument', 'name': 'where', 'range': [2046, 2052], 'children': []}, {'type': 'Argument', 'name': 'data', 'range': [2055, 2106], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2111, 2113], 'children': [{'type': 'ReturnValue', 'name': 'featured', 'range': [2112, 2113], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': 'except', 'range': [2115, 2131], 'children': [{'type': 'Exception', 'name': 'PrismaError', 'range': [2116, 2120], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2121, 2131], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2125, 2130], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2126, 2130], 'children': []}]}]}]}, {'type': 'ExceptBlock', 'name': 'except', 'range': [2132, 2144], 'children': [{'type': 'Exception', 'name': 'Exception', 'range': [2133, 2135], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2136, 2144], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2138, 2143], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2139, 2143], 'children': []}]}]}]}]}]}]}
2025-01-08 10:28:41,746 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:41,810 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_not_featured_agents', 'range': [2812, 3020], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_not_featured_agents', 'range': [2812, 3020], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2812, 2816], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2813, 2816], 'children': []}, {'type': 'Identifier', 'name': 'get_not_featured_agents', 'range': [2814, 2834], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2815, 2829], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [2817, 2821], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [2819, 2821], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [2823, 2827], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [2825, 2827], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'typing.List[prisma.models.Agents]', 'range': [2830, 2841], 'children': []}, {'type': 'Docstring', 'name': 'Retrieve a list of not featured agents from the database.', 'range': [2844, 2846], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2848, 3020], 'children': [{'type': 'Block', 'name': 'try_block', 'range': [2850, 2987], 'children': [{'type': 'Assignment', 'name': 'agents', 'range': [2851, 2863], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2853, 2859], 'children': [{'type': 'CallExpression', 'name': 'get_client', 'range': [2854, 2860], 'children': []}]}, {'type': 'CallExpression', 'name': 'query_raw', 'range': [2861, 2986], 'children': [{'type': 'StringLiteral', 'name': 'query', 'range': [2865, 2974], 'children': []}, {'type': 'Assignment', 'name': 'model', 'range': [2977, 2984], 'children': [{'type': 'Identifier', 'name': 'prisma.models.Agents', 'range': [2979, 2983], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2988, 2990], 'children': [{'type': 'Identifier', 'name': 'agents', 'range': [2989, 2990], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2991, 3007], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2992, 2996], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2999, 3007], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3001, 3006], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3002, 3006], 'children': [{'type': 'StringLiteral', 'name': 'Database query failed: {str(e)}', 'range': [3004, 3005], 'children': []}]}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [3008, 3020], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [3009, 3011], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [3012, 3020], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3014, 3019], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3015, 3019], 'children': [{'type': 'StringLiteral', 'name': 'Unexpected error occurred: {str(e)}', 'range': [3017, 3018], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:28:41,810 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:42,864 - INFO - Step 2 result: {'type': 'Program', 'name': 'remove_featured_category', 'range': [2438, 2616], 'children': [{'type': 'FunctionDeclaration', 'name': 'remove_featured_category', 'range': [2438, 2616], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2438, 2442], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2439, 2442], 'children': []}, {'type': 'Identifier', 'name': 'remove_featured_category', 'range': [2440, 2461], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2441, 2451], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2443, 2446], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2445, 2446], 'children': []}]}, {'type': 'Parameter', 'name': 'category', 'range': [2447, 2450], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2449, 2450], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [2452, 2461], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.models.FeaturedAgent|None', 'range': [2454, 2461], 'children': []}]}, {'type': 'Docstring', 'name': 'docstring', 'range': [2463, 2465], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2467, 2616], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [2467, 2616], 'children': [{'type': 'Block', 'name': 'try_body', 'range': [2469, 2585], 'children': [{'type': 'Comment', 'name': 'get the existing categories', 'range': [2470, 2475], 'children': []}, {'type': 'Assignment', 'name': 'featured_agent', 'range': [2476, 2511], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2478, 2511], 'children': [{'type': 'CallExpression', 'name': 'find_unique', 'range': [2489, 2510], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2494, 2498], 'children': []}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2503, 2507], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [2513, 2524], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [2514, 2515], 'children': []}, {'type': 'Block', 'name': 'consequent', 'range': [2517, 2524], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2518, 2523], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2519, 2523], 'children': []}]}]}]}, {'type': 'Comment', 'name': 'remove the category from the list', 'range': [2526, 2533], 'children': []}, {'type': 'ExpressionStatement', 'name': 'featured_agent.featuredCategories.remove', 'range': [2534, 2542], 'children': [{'type': 'CallExpression', 'name': 'remove', 'range': [2538, 2541], 'children': []}]}, {'type': 'Assignment', 'name': 'featured_agent', 'range': [2544, 2581], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2546, 2581], 'children': [{'type': 'CallExpression', 'name': 'update', 'range': [2557, 2580], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2562, 2566], 'children': []}, {'type': 'ObjectExpression', 'name': 'data', 'range': [2571, 2577], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2583, 2585], 'children': []}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2587, 2603], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2592, 2595], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2596, 2603], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2597, 2602], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2598, 2602], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2604, 2616], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [2605, 2608], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2609, 2616], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2610, 2615], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2611, 2615], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:28:42,864 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:43,039 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_agent_featured', 'range': [2726, 2811], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_agent_featured', 'range': [2726, 2811], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [2726, 2730], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [2727, 2730], 'children': []}, {'type': 'FunctionName', 'name': 'get_agent_featured', 'range': [2728, 2744], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2729, 2733], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2730, 2733], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2731, 2733], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [2734, 2743], 'children': [{'type': 'Type', 'name': 'prisma.models.FeaturedAgent', 'range': [2736, 2740], 'children': []}, {'type': 'UnionType', 'name': '|', 'range': [2741, 2742], 'children': []}, {'type': 'Type', 'name': 'None', 'range': [2742, 2743], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [2744, 2811], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [2745, 2747], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2749, 2811], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [2751, 2778], 'children': [{'type': 'AssignmentExpression', 'name': 'featured_agent', 'range': [2752, 2777], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2754, 2777], 'children': [{'type': 'CallExpression', 'name': 'find_unique', 'range': [2765, 2777], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.FeaturedAgent.prisma', 'range': [2755, 2764], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2766, 2777], 'children': [{'type': 'KeywordArgument', 'name': 'where', 'range': [2768, 2774], 'children': [{'type': 'ObjectExpression', 'name': 'object', 'range': [2770, 2774], 'children': [{'type': 'Property', 'name': 'agentId', 'range': [2771, 2773], 'children': []}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2779, 2781], 'children': [{'type': 'Identifier', 'name': 'featured_agent', 'range': [2780, 2781], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2782, 2798], 'children': [{'type': 'ExceptionType', 'name': 'PrismaError', 'range': [2783, 2787], 'children': []}, {'type': 'Alias', 'name': 'e', 'range': [2788, 2789], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [2792, 2798], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2793, 2798], 'children': [{'type': 'TemplateLiteral', 'name': 'f-string', 'range': [2795, 2797], 'children': []}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2799, 2811], 'children': [{'type': 'ExceptionType', 'name': 'Exception', 'range': [2800, 2801], 'children': []}, {'type': 'Alias', 'name': 'e', 'range': [2802, 2803], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [2805, 2811], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2806, 2811], 'children': [{'type': 'TemplateLiteral', 'name': 'f-string', 'range': [2808, 2810], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:28:43,039 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:45,723 - INFO - Step 4 result: {'type': 'Program', 'name': 'TopAgentsDBResponse', 'range': [65, 106], 'children': [{'type': 'ClassDecl', 'name': 'TopAgentsDBResponse', 'range': [65, 106], 'children': [{'type': 'Inheritance', 'name': 'BaseModel', 'range': [67, 71], 'children': [{'type': 'Module', 'name': 'pydantic', 'range': [68, 70], 'children': []}]}, {'type': 'Docstring', 'name': 'Docstring', 'range': [74, 76], 'children': []}, {'type': 'Attribute', 'name': 'analytics', 'range': [79, 88], 'children': [{'type': 'Type', 'name': 'list', 'range': [81, 88], 'children': [{'type': 'Module', 'name': 'prisma', 'range': [83, 87], 'children': []}]}]}, {'type': 'Attribute', 'name': 'total_count', 'range': [90, 92], 'children': [{'type': 'Type', 'name': 'int', 'range': [92, 92], 'children': []}]}, {'type': 'Attribute', 'name': 'page', 'range': [94, 96], 'children': [{'type': 'Type', 'name': 'int', 'range': [96, 96], 'children': []}]}, {'type': 'Attribute', 'name': 'page_size', 'range': [98, 100], 'children': [{'type': 'Type', 'name': 'int', 'range': [100, 100], 'children': []}]}, {'type': 'Attribute', 'name': 'total_pages', 'range': [102, 104], 'children': [{'type': 'Type', 'name': 'int', 'range': [104, 104], 'children': []}]}]}]}
2025-01-08 10:28:45,724 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:46,477 - INFO - Step 2 result: {'type': 'Program', 'name': 'search_db', 'range': [1193, 1602], 'children': [{'type': 'FunctionDeclaration', 'name': 'search_db', 'range': [1193, 1602], 'children': [{'type': 'Parameter', 'name': 'query', 'range': [1198, 1200], 'children': []}, {'type': 'Parameter', 'name': 'page', 'range': [1203, 1207], 'children': []}, {'type': 'Parameter', 'name': 'page_size', 'range': [1210, 1214], 'children': []}, {'type': 'Parameter', 'name': 'categories', 'range': [1217, 1228], 'children': []}, {'type': 'Parameter', 'name': 'description_threshold', 'range': [1231, 1235], 'children': []}, {'type': 'Parameter', 'name': 'sort_by', 'range': [1238, 1242], 'children': []}, {'type': 'Parameter', 'name': 'sort_order', 'range': [1245, 1261], 'children': []}, {'type': 'Parameter', 'name': 'submission_status', 'range': [1264, 1278], 'children': []}, {'type': 'ReturnType', 'name': 'market.model.ListResponse[market.utils.extension_types.AgentsWithRank]', 'range': [1284, 1297], 'children': []}, {'type': 'Block', 'name': 'FunctionBody', 'range': [1299, 1602], 'children': [{'type': 'TryStatement', 'name': 'Try', 'range': [1312, 1602], 'children': [{'type': 'Block', 'name': 'TryBlock', 'range': [1314, 1572], 'children': [{'type': 'VariableDeclaration', 'name': 'offset', 'range': [1315, 1324], 'children': []}, {'type': 'VariableDeclaration', 'name': 'category_filter', 'range': [1326, 1329], 'children': []}, {'type': 'IfStatement', 'name': 'If', 'range': [1330, 1357], 'children': [{'type': 'Block', 'name': 'IfBlock', 'range': [1333, 1357], 'children': [{'type': 'VariableDeclaration', 'name': 'category_conditions', 'range': [1334, 1343], 'children': []}, {'type': 'AssignmentExpression', 'name': 'category_filter', 'range': [1345, 1357], 'children': []}]}]}, {'type': 'Comment', 'name': 'Construct the ORDER BY clause based on the sort_by parameter', 'range': [1359, 1369], 'children': []}, {'type': 'IfStatement', 'name': 'If', 'range': [1371, 1404], 'children': [{'type': 'Block', 'name': 'IfBlock', 'range': [1380, 1385], 'children': [{'type': 'VariableDeclaration', 'name': 'order_by_clause', 'range': [1381, 1385], 'children': []}]}, {'type': 'ElseIfStatement', 'name': 'Elif', 'range': [1386, 1397], 'children': [{'type': 'Block', 'name': 'ElseIfBlock', 'range': [1392, 1397], 'children': [{'type': 'VariableDeclaration', 'name': 'order_by_clause', 'range': [1393, 1397], 'children': []}]}]}, {'type': 'ElseStatement', 'name': 'Else', 'range': [1398, 1404], 'children': [{'type': 'Block', 'name': 'ElseBlock', 'range': [1400, 1404], 'children': [{'type': 'VariableDeclaration', 'name': 'order_by_clause', 'range': [1401, 1404], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'submission_status_filter', 'range': [1406, 1414], 'children': []}, {'type': 'VariableDeclaration', 'name': 'sql_query', 'range': [1416, 1432], 'children': []}, {'type': 'VariableDeclaration', 'name': 'results', 'range': [1434, 1465], 'children': []}, {'type': 'ReturnStatement', 'name': 'Return', 'range': [1528, 1571], 'children': []}]}, {'type': 'CatchStatement', 'name': 'Except', 'range': [1573, 1589], 'children': [{'type': 'Block', 'name': 'CatchBlock', 'range': [1582, 1589], 'children': [{'type': 'ThrowStatement', 'name': 'Raise', 'range': [1583, 1589], 'children': []}]}]}, {'type': 'CatchStatement', 'name': 'Except', 'range': [1590, 1602], 'children': [{'type': 'Block', 'name': 'CatchBlock', 'range': [1595, 1602], 'children': [{'type': 'ThrowStatement', 'name': 'Raise', 'range': [1596, 1602], 'children': []}]}]}]}]}]}, {'type': 'ClassDeclaration', 'name': 'CountResponse', 'range': [1467, 1479], 'children': [{'type': 'Property', 'name': 'count', 'range': [1476, 1478], 'children': []}]}]}
2025-01-08 10:28:46,477 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:46,517 - INFO - Step 4 result: {'nodes': [{'type': 'ImportDeclaration', 'name': 'datetime', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': 'typing', 'range': [3, 5], 'children': []}, {'type': 'ImportDeclaration', 'name': 'fuzzywuzzy.fuzz', 'range': [7, 11], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.enums', 'range': [12, 16], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.errors', 'range': [17, 21], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.models', 'range': [22, 26], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.types', 'range': [27, 31], 'children': []}, {'type': 'ImportDeclaration', 'name': 'pydantic', 'range': [32, 34], 'children': []}, {'type': 'ImportDeclaration', 'name': 'market.model', 'range': [36, 40], 'children': []}, {'type': 'ImportDeclaration', 'name': 'market.utils.extension_types', 'range': [41, 47], 'children': []}]}
2025-01-08 10:28:46,517 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:48,033 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_all_categories', 'range': [3021, 3164], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_all_categories', 'range': [3021, 3164], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [3021, 3021], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [3022, 3022], 'children': []}, {'type': 'FunctionName', 'name': 'get_all_categories', 'range': [3023, 3023], 'children': []}, {'type': 'ParameterList', 'name': '()', 'range': [3024, 3025], 'children': []}, {'type': 'ReturnType', 'name': '-> market.model.CategoriesResponse', 'range': [3026, 3032], 'children': []}, {'type': 'Colon', 'name': ':', 'range': [3033, 3033], 'children': []}, {'type': 'Docstring', 'name': '""" \\n     Retrieve all unique categories from the database. \\n  \\n     Returns: \\n         CategoriesResponse: A list of unique categories. \\n     """', 'range': [3035, 3037], 'children': []}, {'type': 'TryBlock', 'name': 'try', 'range': [3039, 3134], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [3039, 3039], 'children': []}, {'type': 'Colon', 'name': ':', 'range': [3040, 3040], 'children': []}, {'type': 'Block', 'name': '', 'range': [3041, 3117], 'children': [{'type': 'Assignment', 'name': 'agents = await prisma.models.Agents.prisma().find_many(distinct=["categories"])', 'range': [3042, 3062], 'children': []}, {'type': 'Comment', 'name': '# Aggregate categories on the Python side', 'range': [3065, 3072], 'children': []}, {'type': 'Assignment', 'name': 'all_categories = set()', 'range': [3073, 3077], 'children': []}, {'type': 'ForLoop', 'name': 'for agent in agents:', 'range': [3079, 3093], 'children': [{'type': 'ForKeyword', 'name': 'for', 'range': [3079, 3079], 'children': []}, {'type': 'Variable', 'name': 'agent', 'range': [3080, 3080], 'children': []}, {'type': 'InKeyword', 'name': 'in', 'range': [3081, 3081], 'children': []}, {'type': 'Variable', 'name': 'agents', 'range': [3082, 3082], 'children': []}, {'type': 'Colon', 'name': ':', 'range': [3083, 3083], 'children': []}, {'type': 'Block', 'name': '', 'range': [3084, 3093], 'children': [{'type': 'MethodCall', 'name': 'all_categories.update(agent.categories)', 'range': [3085, 3092], 'children': []}]}]}, {'type': 'Assignment', 'name': 'unique_categories = sorted(list(all_categories))', 'range': [3095, 3103], 'children': []}, {'type': 'ReturnStatement', 'name': 'return market.model.CategoriesResponse(unique_categories=unique_categories)', 'range': [3106, 3116], 'children': []}]}, {'type': 'ExceptBlock', 'name': 'except prisma.errors.PrismaError as e:', 'range': [3118, 3133], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [3118, 3118], 'children': []}, {'type': 'Exception', 'name': 'prisma.errors.PrismaError', 'range': [3119, 3123], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [3124, 3124], 'children': []}, {'type': 'Variable', 'name': 'e', 'range': [3125, 3125], 'children': []}, {'type': 'Colon', 'name': ':', 'range': [3126, 3126], 'children': []}, {'type': 'Block', 'name': '', 'range': [3127, 3133], 'children': [{'type': 'RaiseStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [3128, 3133], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': 'except Exception:', 'range': [3135, 3163], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [3135, 3135], 'children': []}, {'type': 'Exception', 'name': 'Exception', 'range': [3136, 3136], 'children': []}, {'type': 'Colon', 'name': ':', 'range': [3137, 3137], 'children': []}, {'type': 'Block', 'name': '', 'range': [3138, 3163], 'children': [{'type': 'Comment', 'name': '# Return an empty list of categories in case of unexpected errors', 'range': [3139, 3151], 'children': []}, {'type': 'ReturnStatement', 'name': 'return market.model.CategoriesResponse(unique_categories=[])', 'range': [3152, 3163], 'children': []}]}]}]}]}]}
2025-01-08 10:28:48,033 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:48,628 - INFO - Step 4 result: {'type': 'Program', 'name': 'FeaturedAgentResponse', 'range': [107, 148], 'children': [{'type': 'ClassDecl', 'name': 'FeaturedAgentResponse', 'range': [107, 148], 'children': [{'type': 'Inheritance', 'name': 'BaseModel', 'range': [109, 113], 'children': [{'type': 'Module', 'name': 'pydantic', 'range': [110, 110], 'children': []}]}, {'type': 'Docstring', 'name': '', 'range': [116, 118], 'children': []}, {'type': 'Attribute', 'name': 'featured_agents', 'range': [121, 130], 'children': [{'type': 'Type', 'name': 'list', 'range': [123, 123], 'children': [{'type': 'Module', 'name': 'prisma', 'range': [125, 125], 'children': [{'type': 'SubModule', 'name': 'models', 'range': [127, 127], 'children': [{'type': 'Class', 'name': 'FeaturedAgent', 'range': [129, 129], 'children': []}]}]}]}]}, {'type': 'Attribute', 'name': 'total_count', 'range': [132, 134], 'children': [{'type': 'Type', 'name': 'int', 'range': [134, 134], 'children': []}]}, {'type': 'Attribute', 'name': 'page', 'range': [136, 138], 'children': [{'type': 'Type', 'name': 'int', 'range': [138, 138], 'children': []}]}, {'type': 'Attribute', 'name': 'page_size', 'range': [140, 142], 'children': [{'type': 'Type', 'name': 'int', 'range': [142, 142], 'children': []}]}, {'type': 'Attribute', 'name': 'total_pages', 'range': [144, 146], 'children': [{'type': 'Type', 'name': 'int', 'range': [146, 146], 'children': []}]}]}]}
2025-01-08 10:28:48,628 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:49,899 - INFO - Step 2 result: {'type': 'Program', 'name': 'add_featured_category', 'range': [2617, 2725], 'children': [{'type': 'FunctionDeclaration', 'name': 'add_featured_category', 'range': [2617, 2725], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [2617, 2621], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [2618, 2621], 'children': []}, {'type': 'FunctionName', 'name': 'add_featured_category', 'range': [2619, 2637], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2620, 2630], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2622, 2624], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2624, 2627], 'children': []}, {'type': 'Parameter', 'name': 'category', 'range': [2626, 2628], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2628, 2630], 'children': []}]}, {'type': 'ReturnType', 'name': '->', 'range': [2631, 2633], 'children': []}, {'type': 'ReturnTypeValue', 'name': 'prisma.models.FeaturedAgent|None', 'range': [2633, 2639], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [2642, 2644], 'children': []}, {'type': 'TryBlock', 'name': 'try', 'range': [2646, 2725], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [2646, 2649], 'children': []}, {'type': 'Block', 'name': 'try_block', 'range': [2649, 2694], 'children': [{'type': 'Assignment', 'name': 'featured_agent', 'range': [2649, 2690], 'children': [{'type': 'Variable', 'name': 'featured_agent', 'range': [2649, 2662], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [2651, 2655], 'children': []}, {'type': 'FunctionCall', 'name': 'prisma.models.FeaturedAgent.prisma().update', 'range': [2652, 2689], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [2663, 2689], 'children': [{'type': 'KeywordArgument', 'name': 'where', 'range': [2665, 2671], 'children': []}, {'type': 'KeywordArgument', 'name': 'data', 'range': [2674, 2686], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2692, 2694], 'children': [{'type': 'Variable', 'name': 'featured_agent', 'range': [2693, 2694], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': 'except', 'range': [2696, 2712], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [2696, 2702], 'children': []}, {'type': 'ExceptionType', 'name': 'prisma.errors.PrismaError', 'range': [2697, 2701], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [2702, 2704], 'children': []}, {'type': 'ExceptionVariable', 'name': 'e', 'range': [2703, 2704], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2704, 2712], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2706, 2711], 'children': [{'type': 'ExceptionType', 'name': 'AgentQueryError', 'range': [2707, 2711], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2708, 2711], 'children': [{'type': 'FString', 'name': 'f"Database query failed: {str(e)}"', 'range': [2709, 2711], 'children': []}]}]}]}]}, {'type': 'ExceptBlock', 'name': 'except', 'range': [2713, 2725], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [2713, 2717], 'children': []}, {'type': 'ExceptionType', 'name': 'Exception', 'range': [2714, 2717], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [2715, 2717], 'children': []}, {'type': 'ExceptionVariable', 'name': 'e', 'range': [2716, 2717], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2717, 2725], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2719, 2724], 'children': [{'type': 'ExceptionType', 'name': 'AgentQueryError', 'range': [2720, 2724], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2721, 2724], 'children': [{'type': 'FString', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [2722, 2724], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:28:49,900 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:52,727 - INFO - Step 3 result: {'type': 'Program', 'name': 'delete_agent', 'range': [149, 234], 'children': [{'type': 'FunctionDeclaration', 'name': 'delete_agent', 'range': [149, 234], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [149, 149], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [150, 150], 'children': []}, {'type': 'Identifier', 'name': 'delete_agent', 'range': [151, 151], 'children': []}, {'type': 'Parameter', 'name': 'agent_id', 'range': [153, 153], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [154, 154], 'children': [{'type': 'Type', 'name': 'str', 'range': [155, 155], 'children': []}]}]}, {'type': 'ReturnType', 'name': '->', 'range': [157, 158], 'children': [{'type': 'Type', 'name': 'prisma.models.Agents | None', 'range': [159, 165], 'children': []}]}, {'type': 'Docstring', 'name': '"""', 'range': [168, 170], 'children': [{'type': 'Text', 'name': 'Delete an agent from the database.', 'range': [169, 169], 'children': []}]}, {'type': 'Block', 'name': 'try', 'range': [172, 233], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [172, 172], 'children': []}, {'type': 'Statement', 'name': 'deleted_agent = await prisma.models.Agents.prisma().delete(where={"id": agent_id})', 'range': [175, 199], 'children': []}, {'type': 'Keyword', 'name': 'return', 'range': [201, 201], 'children': [{'type': 'Identifier', 'name': 'deleted_agent', 'range': [202, 202], 'children': []}]}, {'type': 'ExceptBlock', 'name': 'except', 'range': [204, 232], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [204, 204], 'children': []}, {'type': 'Exception', 'name': 'PrismaError', 'range': [205, 209], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [211, 211], 'children': []}, {'type': 'Statement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [214, 219], 'children': []}, {'type': 'ExceptBlock', 'name': 'except', 'range': [221, 232], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [221, 221], 'children': []}, {'type': 'Exception', 'name': 'Exception', 'range': [222, 222], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [224, 224], 'children': []}, {'type': 'Statement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [227, 232], 'children': []}]}]}]}]}]}
2025-01-08 10:28:52,727 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:54,358 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_agent_details', 'range': [1070, 1192], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_agent_details', 'range': [1070, 1192], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1070, 1070], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1071, 1071], 'children': []}, {'type': 'FunctionName', 'name': 'get_agent_details', 'range': [1072, 1072], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1073, 1085], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [1074, 1076], 'children': [{'type': 'ParameterName', 'name': 'agent_id', 'range': [1074, 1074], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1076, 1076], 'children': []}]}, {'type': 'Parameter', 'name': 'version', 'range': [1078, 1084], 'children': [{'type': 'ParameterName', 'name': 'version', 'range': [1078, 1078], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int | None', 'range': [1080, 1082], 'children': []}, {'type': 'DefaultValue', 'name': 'None', 'range': [1084, 1084], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [1086, 1086], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [1087, 1192], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [1088, 1090], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [1092, 1192], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [1093, 1162], 'children': [{'type': 'Assignment', 'name': 'query', 'range': [1095, 1101], 'children': [{'type': 'VariableName', 'name': 'query', 'range': [1095, 1095], 'children': []}, {'type': 'Dictionary', 'name': 'dictionary', 'range': [1097, 1101], 'children': [{'type': 'KeyValuePair', 'name': 'id', 'range': [1098, 1100], 'children': [{'type': 'Key', 'name': 'id', 'range': [1098, 1098], 'children': []}, {'type': 'Value', 'name': 'agent_id', 'range': [1100, 1100], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1103, 1120], 'children': [{'type': 'Condition', 'name': 'version is not None', 'range': [1104, 1107], 'children': []}, {'type': 'IfBlock', 'name': 'if_block', 'range': [1108, 1120], 'children': [{'type': 'Assignment', 'name': 'query["version"]', 'range': [1110, 1115], 'children': [{'type': 'VariableName', 'name': 'query', 'range': [1110, 1110], 'children': []}, {'type': 'Index', 'name': 'version', 'range': [1112, 1112], 'children': []}, {'type': 'Value', 'name': 'version', 'range': [1115, 1115], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'agent', 'range': [1122, 1145], 'children': [{'type': 'VariableName', 'name': 'agent', 'range': [1122, 1122], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1124, 1124], 'children': []}, {'type': 'MethodCall', 'name': 'prisma.models.Agents.prisma().find_first', 'range': [1125, 1140], 'children': [{'type': 'Object', 'name': 'prisma', 'range': [1125, 1125], 'children': []}, {'type': 'Property', 'name': 'models', 'range': [1127, 1127], 'children': []}, {'type': 'Property', 'name': 'Agents', 'range': [1129, 1129], 'children': []}, {'type': 'MethodCall', 'name': 'prisma', 'range': [1131, 1133], 'children': []}, {'type': 'MethodCall', 'name': 'find_first', 'range': [1135, 1140], 'children': [{'type': 'Argument', 'name': 'where', 'range': [1137, 1139], 'children': [{'type': 'VariableName', 'name': 'query', 'range': [1139, 1139], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1147, 1157], 'children': [{'type': 'Condition', 'name': 'not agent', 'range': [1148, 1149], 'children': []}, {'type': 'IfBlock', 'name': 'if_block', 'range': [1150, 1157], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [1152, 1156], 'children': [{'type': 'ExceptionName', 'name': 'AgentQueryError', 'range': [1153, 1153], 'children': []}, {'type': 'Argument', 'name': '"Agent not found"', 'range': [1155, 1155], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1159, 1161], 'children': [{'type': 'VariableName', 'name': 'agent', 'range': [1160, 1160], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1163, 1179], 'children': [{'type': 'ExceptionType', 'name': 'PrismaError', 'range': [1168, 1168], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [1169, 1169], 'children': []}, {'type': 'VariableName', 'name': 'e', 'range': [1170, 1170], 'children': []}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [1171, 1179], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [1173, 1178], 'children': [{'type': 'ExceptionName', 'name': 'AgentQueryError', 'range': [1174, 1174], 'children': []}, {'type': 'Argument', 'name': 'f"Database query failed: {str(e)}"', 'range': [1176, 1177], 'children': []}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1180, 1192], 'children': [{'type': 'ExceptionType', 'name': 'Exception', 'range': [1181, 1181], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [1182, 1182], 'children': []}, {'type': 'VariableName', 'name': 'e', 'range': [1183, 1183], 'children': []}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [1184, 1192], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [1186, 1191], 'children': [{'type': 'ExceptionName', 'name': 'AgentQueryError', 'range': [1187, 1187], 'children': []}, {'type': 'Argument', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [1189, 1190], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:28:54,358 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:55,205 - INFO - Step 5 result: {'nodes': [{'type': 'Program', 'name': 'MainProgram', 'range': [0, 47], 'children': [{'type': 'ImportDeclaration', 'name': 'datetime', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': 'typing', 'range': [3, 5], 'children': []}, {'type': 'ImportDeclaration', 'name': 'fuzzywuzzy.fuzz', 'range': [7, 11], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.enums', 'range': [12, 16], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.errors', 'range': [17, 21], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.models', 'range': [22, 26], 'children': []}, {'type': 'ImportDeclaration', 'name': 'prisma.types', 'range': [27, 31], 'children': []}, {'type': 'ImportDeclaration', 'name': 'pydantic', 'range': [32, 34], 'children': []}, {'type': 'ImportDeclaration', 'name': 'market.model', 'range': [36, 40], 'children': []}, {'type': 'ImportDeclaration', 'name': 'market.utils.extension_types', 'range': [41, 47], 'children': []}]}]}
2025-01-08 10:28:55,205 - INFO - Completed main AST analysis flow
2025-01-08 10:28:55,206 - INFO - Successfully processed chunk
2025-01-08 10:28:56,934 - INFO - Step 3 result: {'type': 'Program', 'name': 'update_agent_entry', 'range': [421, 573], 'children': [{'type': 'FunctionDeclaration', 'name': 'update_agent_entry', 'range': [421, 573], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [421, 421], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [422, 422], 'children': []}, {'type': 'Identifier', 'name': 'update_agent_entry', 'range': [423, 423], 'children': []}, {'type': 'Parameter', 'name': 'agent_id', 'range': [426, 428], 'children': [{'type': 'Identifier', 'name': 'agent_id', 'range': [426, 426], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [428, 428], 'children': []}]}, {'type': 'Parameter', 'name': 'version', 'range': [431, 433], 'children': [{'type': 'Identifier', 'name': 'version', 'range': [431, 431], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [433, 433], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_state', 'range': [436, 442], 'children': [{'type': 'Identifier', 'name': 'submission_state', 'range': [436, 436], 'children': []}, {'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [438, 442], 'children': []}]}, {'type': 'Parameter', 'name': 'comments', 'range': [445, 451], 'children': [{'type': 'Identifier', 'name': 'comments', 'range': [445, 445], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str | None', 'range': [447, 451], 'children': []}]}, {'type': 'ReturnType', 'name': '-> prisma.models.Agents | None', 'range': [455, 463], 'children': []}, {'type': 'Docstring', 'name': '""" \\n     Update an existing agent entry in the database. \\n  \\n     Args: \\n         agent_id (str): The ID of the agent. \\n         version (int): The version of the agent. \\n         submission_state (prisma.enums.SubmissionStatus): The submission state of the agent. \\n     """', 'range': [466, 468], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [471, 572], 'children': [{'type': 'Block', 'name': '', 'range': [473, 538], 'children': [{'type': 'AssignmentExpression', 'name': 'agent = await prisma.models.Agents.prisma().update(where={"id": agent_id}, data={"version": version, "submissionStatus": submission_state, "submissionReviewDate": datetime.datetime.now(datetime.timezone.utc), "submissionReviewComments": comments})', 'range': [474, 537], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except prisma.errors.PrismaError as e', 'range': [543, 558], 'children': [{'type': 'RaiseStatement', 'name': 'raise AgentQueryError(f"Agent Update Failed Database query failed: {str(e)}")', 'range': [553, 558], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except Exception as e', 'range': [560, 571], 'children': [{'type': 'RaiseStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [566, 571], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return agent', 'range': [540, 542], 'children': []}]}]}
2025-01-08 10:28:56,934 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:57,587 - INFO - Step 5 result: {'type': 'Program', 'name': 'TopAgentsDBResponse', 'range': [65, 106], 'children': [{'type': 'ClassDecl', 'name': 'TopAgentsDBResponse', 'range': [65, 106], 'children': [{'type': 'Inheritance', 'name': 'BaseModel', 'range': [67, 71], 'children': [{'type': 'Module', 'name': 'pydantic', 'range': [68, 70], 'children': []}]}, {'type': 'Docstring', 'name': 'Docstring', 'range': [74, 76], 'children': []}, {'type': 'Attribute', 'name': 'analytics', 'range': [79, 88], 'children': [{'type': 'Type', 'name': 'list', 'range': [81, 88], 'children': [{'type': 'Module', 'name': 'prisma', 'range': [83, 87], 'children': []}]}]}, {'type': 'Attribute', 'name': 'total_count', 'range': [90, 92], 'children': [{'type': 'Type', 'name': 'int', 'range': [92, 92], 'children': []}]}, {'type': 'Attribute', 'name': 'page', 'range': [94, 96], 'children': [{'type': 'Type', 'name': 'int', 'range': [96, 96], 'children': []}]}, {'type': 'Attribute', 'name': 'page_size', 'range': [98, 100], 'children': [{'type': 'Type', 'name': 'int', 'range': [100, 100], 'children': []}]}, {'type': 'Attribute', 'name': 'total_pages', 'range': [102, 104], 'children': [{'type': 'Type', 'name': 'int', 'range': [104, 104], 'children': []}]}]}]}
2025-01-08 10:28:57,587 - INFO - Completed main AST analysis flow
2025-01-08 10:28:57,587 - INFO - Successfully processed chunk
2025-01-08 10:29:02,020 - INFO - Step 5 result: {'type': 'Program', 'name': 'FeaturedAgentResponse', 'range': [107, 148], 'children': [{'type': 'ClassDecl', 'name': 'FeaturedAgentResponse', 'range': [107, 148], 'children': [{'type': 'Inheritance', 'name': 'BaseModel', 'range': [109, 113], 'children': [{'type': 'Module', 'name': 'pydantic', 'range': [110, 110], 'children': []}]}, {'type': 'Docstring', 'name': '', 'range': [116, 118], 'children': []}, {'type': 'Attribute', 'name': 'featured_agents', 'range': [121, 130], 'children': [{'type': 'Type', 'name': 'list', 'range': [123, 123], 'children': [{'type': 'Module', 'name': 'prisma', 'range': [125, 125], 'children': [{'type': 'SubModule', 'name': 'models', 'range': [127, 127], 'children': [{'type': 'Class', 'name': 'FeaturedAgent', 'range': [129, 129], 'children': []}]}]}]}]}, {'type': 'Attribute', 'name': 'total_count', 'range': [132, 134], 'children': [{'type': 'Type', 'name': 'int', 'range': [134, 134], 'children': []}]}, {'type': 'Attribute', 'name': 'page', 'range': [136, 138], 'children': [{'type': 'Type', 'name': 'int', 'range': [138, 138], 'children': []}]}, {'type': 'Attribute', 'name': 'page_size', 'range': [140, 142], 'children': [{'type': 'Type', 'name': 'int', 'range': [142, 142], 'children': []}]}, {'type': 'Attribute', 'name': 'total_pages', 'range': [144, 146], 'children': [{'type': 'Type', 'name': 'int', 'range': [146, 146], 'children': []}]}]}]}
2025-01-08 10:29:02,021 - INFO - Completed main AST analysis flow
2025-01-08 10:29:02,021 - INFO - Successfully processed chunk
2025-01-08 10:29:04,401 - INFO - Step 2 result: {'type': 'Program', 'name': 'create_agent_entry', 'range': [235, 420], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_agent_entry', 'range': [235, 420], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [235, 239], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [236, 239], 'children': []}, {'type': 'FunctionName', 'name': 'create_agent_entry', 'range': [237, 253], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [238, 299], 'children': [{'type': 'Parameter', 'name': 'name', 'range': [240, 243], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [242, 243], 'children': []}]}, {'type': 'Parameter', 'name': 'description', 'range': [245, 248], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [247, 248], 'children': []}]}, {'type': 'Parameter', 'name': 'author', 'range': [250, 253], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [252, 253], 'children': []}]}, {'type': 'Parameter', 'name': 'keywords', 'range': [255, 263], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.List[str]', 'range': [257, 263], 'children': []}]}, {'type': 'Parameter', 'name': 'categories', 'range': [265, 273], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.List[str]', 'range': [267, 273], 'children': []}]}, {'type': 'Parameter', 'name': 'graph', 'range': [275, 280], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.Json', 'range': [277, 280], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_state', 'range': [282, 297], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [284, 297], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [300, 301], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [302, 304], 'children': []}, {'type': 'TryBlock', 'name': 'try_block', 'range': [306, 406], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [306, 309], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [310, 384], 'children': [{'type': 'Assignment', 'name': 'assignment', 'range': [309, 384], 'children': [{'type': 'Variable', 'name': 'agent', 'range': [309, 314], 'children': []}, {'type': 'AwaitExpression', 'name': 'await_expression', 'range': [311, 384], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [312, 384], 'children': [{'type': 'MemberExpression', 'name': 'member_expression', 'range': [312, 319], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [312, 318], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [313, 319], 'children': []}, {'type': 'Identifier', 'name': 'Agents', 'range': [314, 320], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [317, 323], 'children': []}]}, {'type': 'CallExpression', 'name': 'call_expression', 'range': [319, 384], 'children': [{'type': 'Identifier', 'name': 'create', 'range': [322, 328], 'children': []}, {'type': 'ObjectExpression', 'name': 'object_expression', 'range': [324, 383], 'children': [{'type': 'Property', 'name': 'data', 'range': [325, 381], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [327, 381], 'children': [{'type': 'Property', 'name': 'name', 'range': [329, 332], 'children': [{'type': 'Identifier', 'name': 'name', 'range': [331, 332], 'children': []}]}, {'type': 'Property', 'name': 'description', 'range': [334, 337], 'children': [{'type': 'Identifier', 'name': 'description', 'range': [336, 337], 'children': []}]}, {'type': 'Property', 'name': 'author', 'range': [339, 342], 'children': [{'type': 'Identifier', 'name': 'author', 'range': [341, 342], 'children': []}]}, {'type': 'Property', 'name': 'keywords', 'range': [344, 347], 'children': [{'type': 'Identifier', 'name': 'keywords', 'range': [346, 347], 'children': []}]}, {'type': 'Property', 'name': 'categories', 'range': [349, 352], 'children': [{'type': 'Identifier', 'name': 'categories', 'range': [351, 352], 'children': []}]}, {'type': 'Property', 'name': 'graph', 'range': [354, 357], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [356, 357], 'children': []}]}, {'type': 'Property', 'name': 'AnalyticsTracker', 'range': [359, 373], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [361, 373], 'children': [{'type': 'Property', 'name': 'create', 'range': [362, 372], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [364, 372], 'children': [{'type': 'Property', 'name': 'downloads', 'range': [365, 368], 'children': [{'type': 'Literal', 'name': '0', 'range': [367, 368], 'children': []}]}, {'type': 'Property', 'name': 'views', 'range': [369, 372], 'children': [{'type': 'Literal', 'name': '0', 'range': [371, 372], 'children': []}]}]}]}]}]}, {'type': 'Property', 'name': 'submissionStatus', 'range': [376, 379], 'children': [{'type': 'Identifier', 'name': 'submission_state', 'range': [378, 379], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return_statement', 'range': [386, 388], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [387, 388], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [390, 406], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [390, 396], 'children': []}, {'type': 'ExceptionType', 'name': 'PrismaError', 'range': [391, 396], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [396, 398], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [397, 398], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [399, 406], 'children': [{'type': 'RaiseStatement', 'name': 'raise_statement', 'range': [400, 405], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [401, 405], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [401, 415], 'children': []}, {'type': 'TemplateLiteral', 'name': 'template_literal', 'range': [403, 405], 'children': [{'type': 'TemplateElement', 'name': 'template_element', 'range': [404, 405], 'children': []}]}]}]}]}]}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [407, 419], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [407, 411], 'children': []}, {'type': 'ExceptionType', 'name': 'Exception', 'range': [408, 411], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [411, 413], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [412, 413], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [414, 419], 'children': [{'type': 'RaiseStatement', 'name': 'raise_statement', 'range': [413, 418], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [414, 418], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [414, 428], 'children': []}, {'type': 'TemplateLiteral', 'name': 'template_literal', 'range': [416, 418], 'children': [{'type': 'TemplateElement', 'name': 'template_element', 'range': [417, 418], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:29:04,401 - INFO - Starting Step 3: AST simplification
2025-01-08 10:29:05,354 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_all_categories', 'range': [3021, 3164], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_all_categories', 'range': [3021, 3164], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [3021, 3021], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [3022, 3022], 'children': []}, {'type': 'FunctionName', 'name': 'get_all_categories', 'range': [3023, 3023], 'children': []}, {'type': 'ReturnType', 'name': '-> market.model.CategoriesResponse', 'range': [3026, 3032], 'children': []}, {'type': 'Docstring', 'name': '""" \\n     Retrieve all unique categories from the database. \\n  \\n     Returns: \\n         CategoriesResponse: A list of unique categories. \\n     """', 'range': [3035, 3037], 'children': []}, {'type': 'TryBlock', 'name': 'try', 'range': [3039, 3134], 'children': [{'type': 'Assignment', 'name': 'agents = await prisma.models.Agents.prisma().find_many(distinct=["categories"])', 'range': [3042, 3062], 'children': []}, {'type': 'Comment', 'name': '# Aggregate categories on the Python side', 'range': [3065, 3072], 'children': []}, {'type': 'Assignment', 'name': 'all_categories = set()', 'range': [3073, 3077], 'children': []}, {'type': 'ForLoop', 'name': 'for agent in agents:', 'range': [3079, 3093], 'children': [{'type': 'MethodCall', 'name': 'all_categories.update(agent.categories)', 'range': [3085, 3092], 'children': []}]}, {'type': 'Assignment', 'name': 'unique_categories = sorted(list(all_categories))', 'range': [3095, 3103], 'children': []}, {'type': 'ReturnStatement', 'name': 'return market.model.CategoriesResponse(unique_categories=unique_categories)', 'range': [3106, 3116], 'children': []}, {'type': 'ExceptBlock', 'name': 'except prisma.errors.PrismaError as e:', 'range': [3118, 3133], 'children': [{'type': 'RaiseStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [3128, 3133], 'children': []}]}, {'type': 'ExceptBlock', 'name': 'except Exception:', 'range': [3135, 3163], 'children': [{'type': 'Comment', 'name': '# Return an empty list of categories in case of unexpected errors', 'range': [3139, 3151], 'children': []}, {'type': 'ReturnStatement', 'name': 'return market.model.CategoriesResponse(unique_categories=[])', 'range': [3152, 3163], 'children': []}]}]}]}]}
2025-01-08 10:29:05,354 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:08,298 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_not_featured_agents', 'range': [2812, 3020], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_not_featured_agents', 'range': [2812, 3020], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2812, 2816], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2813, 2816], 'children': []}, {'type': 'Identifier', 'name': 'get_not_featured_agents', 'range': [2814, 2834], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2815, 2829], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [2817, 2821], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [2819, 2821], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [2823, 2827], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [2825, 2827], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'typing.List[prisma.models.Agents]', 'range': [2830, 2841], 'children': []}, {'type': 'Docstring', 'name': 'Retrieve a list of not featured agents from the database.', 'range': [2844, 2846], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2848, 3020], 'children': [{'type': 'Block', 'name': 'try_block', 'range': [2850, 2987], 'children': [{'type': 'Assignment', 'name': 'agents', 'range': [2851, 2863], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2853, 2859], 'children': [{'type': 'CallExpression', 'name': 'get_client', 'range': [2854, 2860], 'children': []}]}, {'type': 'CallExpression', 'name': 'query_raw', 'range': [2861, 2986], 'children': [{'type': 'StringLiteral', 'name': 'query', 'range': [2865, 2974], 'children': []}, {'type': 'Assignment', 'name': 'model', 'range': [2977, 2984], 'children': [{'type': 'Identifier', 'name': 'prisma.models.Agents', 'range': [2979, 2983], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2988, 2990], 'children': [{'type': 'Identifier', 'name': 'agents', 'range': [2989, 2990], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2991, 3007], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2992, 2996], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2999, 3007], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3001, 3006], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3002, 3006], 'children': [{'type': 'StringLiteral', 'name': 'Database query failed: {str(e)}', 'range': [3004, 3005], 'children': []}]}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [3008, 3020], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [3009, 3011], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [3012, 3020], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3014, 3019], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3015, 3019], 'children': [{'type': 'StringLiteral', 'name': 'Unexpected error occurred: {str(e)}', 'range': [3017, 3018], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:08,298 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:08,497 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_top_agents_by_downloads', 'range': [1603, 1947], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_top_agents_by_downloads', 'range': [1603, 1947], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1603, 1607], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1604, 1607], 'children': []}, {'type': 'Identifier', 'name': 'get_top_agents_by_downloads', 'range': [1605, 1639], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [1606, 1639], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [1608, 1612], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [1609, 1612], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [1615, 1619], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [1616, 1619], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [1622, 1636], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [1623, 1636], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'market.model.ListResponse[prisma.models.AnalyticsTracker]', 'range': [1640, 1653], 'children': []}, {'type': 'Block', 'name': '', 'range': [1655, 1947], 'children': [{'type': 'TryStatement', 'name': '', 'range': [1660, 1947], 'children': [{'type': 'Block', 'name': '', 'range': [1662, 1888], 'children': [{'type': 'ExpressionStatement', 'name': 'skip = (page - 1) * page_size', 'range': [1667, 1676], 'children': []}, {'type': 'TryStatement', 'name': '', 'range': [1683, 1787], 'children': [{'type': 'Block', 'name': '', 'range': [1685, 1770], 'children': [{'type': 'ExpressionStatement', 'name': 'analytics = await prisma.models.AnalyticsTracker.prisma().find_many(...)', 'range': [1708, 1770], 'children': []}]}, {'type': 'CatchClause', 'name': 'PrismaError', 'range': [1771, 1787], 'children': [{'type': 'Block', 'name': '', 'range': [1779, 1787], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [1781, 1787], 'children': []}]}]}]}, {'type': 'TryStatement', 'name': '', 'range': [1789, 1843], 'children': [{'type': 'Block', 'name': '', 'range': [1791, 1826], 'children': [{'type': 'ExpressionStatement', 'name': 'total_count = await prisma.models.AnalyticsTracker.prisma().count(...)', 'range': [1792, 1826], 'children': []}]}, {'type': 'CatchClause', 'name': 'PrismaError', 'range': [1827, 1843], 'children': [{'type': 'Block', 'name': '', 'range': [1835, 1843], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [1837, 1843], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return market.model.ListResponse(...)', 'range': [1845, 1888], 'children': []}]}, {'type': 'CatchClause', 'name': 'AgentQueryError', 'range': [1890, 1910], 'children': [{'type': 'Block', 'name': '', 'range': [1894, 1910], 'children': [{'type': 'ThrowStatement', 'name': 'raise e from e', 'range': [1906, 1910], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'ValueError', 'range': [1911, 1925], 'children': [{'type': 'Block', 'name': '', 'range': [1915, 1925], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Invalid input parameter: {str(e)}") from e', 'range': [1917, 1925], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'Exception', 'range': [1926, 1947], 'children': [{'type': 'Block', 'name': '', 'range': [1930, 1947], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}") from e', 'range': [1939, 1947], 'children': []}]}]}]}]}]}]}
2025-01-08 10:29:08,497 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:09,989 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_agent_featured', 'range': [2726, 2811], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_agent_featured', 'range': [2726, 2811], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [2726, 2730], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [2727, 2730], 'children': []}, {'type': 'FunctionName', 'name': 'get_agent_featured', 'range': [2728, 2744], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2729, 2733], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2730, 2733], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2731, 2733], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [2734, 2743], 'children': [{'type': 'Type', 'name': 'prisma.models.FeaturedAgent', 'range': [2736, 2740], 'children': []}, {'type': 'UnionType', 'name': '|', 'range': [2741, 2742], 'children': []}, {'type': 'Type', 'name': 'None', 'range': [2742, 2743], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [2744, 2811], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [2745, 2747], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2749, 2811], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [2751, 2778], 'children': [{'type': 'AssignmentExpression', 'name': 'featured_agent', 'range': [2752, 2777], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2754, 2777], 'children': [{'type': 'CallExpression', 'name': 'find_unique', 'range': [2765, 2777], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.FeaturedAgent.prisma', 'range': [2755, 2764], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2766, 2777], 'children': [{'type': 'KeywordArgument', 'name': 'where', 'range': [2768, 2774], 'children': [{'type': 'ObjectExpression', 'name': 'object', 'range': [2770, 2774], 'children': [{'type': 'Property', 'name': 'agentId', 'range': [2771, 2773], 'children': []}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2779, 2781], 'children': [{'type': 'Identifier', 'name': 'featured_agent', 'range': [2780, 2781], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2782, 2798], 'children': [{'type': 'ExceptionType', 'name': 'PrismaError', 'range': [2783, 2787], 'children': []}, {'type': 'Alias', 'name': 'e', 'range': [2788, 2789], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [2792, 2798], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2793, 2798], 'children': [{'type': 'TemplateLiteral', 'name': 'f-string', 'range': [2795, 2797], 'children': []}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2799, 2811], 'children': [{'type': 'ExceptionType', 'name': 'Exception', 'range': [2800, 2801], 'children': []}, {'type': 'Alias', 'name': 'e', 'range': [2802, 2803], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [2805, 2811], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2806, 2811], 'children': [{'type': 'TemplateLiteral', 'name': 'f-string', 'range': [2808, 2810], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:09,989 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:11,769 - INFO - Step 4 result: {'type': 'Program', 'name': 'delete_agent', 'range': [149, 234], 'children': [{'type': 'FunctionDecl', 'name': 'delete_agent', 'range': [149, 234], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [149, 149], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [150, 150], 'children': []}, {'type': 'Identifier', 'name': 'delete_agent', 'range': [151, 151], 'children': []}, {'type': 'Parameter', 'name': 'agent_id', 'range': [153, 153], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [154, 154], 'children': [{'type': 'Type', 'name': 'str', 'range': [155, 155], 'children': []}]}]}, {'type': 'ReturnType', 'name': '->', 'range': [157, 158], 'children': [{'type': 'Type', 'name': 'prisma.models.Agents | None', 'range': [159, 165], 'children': []}]}, {'type': 'Docstring', 'name': '"""', 'range': [168, 170], 'children': [{'type': 'Text', 'name': 'Delete an agent from the database.', 'range': [169, 169], 'children': []}]}, {'type': 'TryStatement', 'name': 'try', 'range': [172, 233], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [172, 172], 'children': []}, {'type': 'ExpressionStatement', 'name': 'deleted_agent = await prisma.models.Agents.prisma().delete(where={"id": agent_id})', 'range': [175, 199], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [201, 201], 'children': [{'type': 'Identifier', 'name': 'deleted_agent', 'range': [202, 202], 'children': []}]}, {'type': 'CatchClause', 'name': 'except', 'range': [204, 232], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [204, 204], 'children': []}, {'type': 'Identifier', 'name': 'PrismaError', 'range': [205, 209], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [211, 211], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [214, 219], 'children': []}, {'type': 'CatchClause', 'name': 'except', 'range': [221, 232], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [221, 221], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [222, 222], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [224, 224], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [227, 232], 'children': []}]}]}]}]}]}
2025-01-08 10:29:11,770 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:13,927 - INFO - Step 2 result: {'type': 'Program', 'name': 'create_agent_installed_event', 'range': [3165, 3268], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_agent_installed_event', 'range': [3165, 3268], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3165, 3169], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3166, 3169], 'children': []}, {'type': 'Identifier', 'name': 'create_agent_installed_event', 'range': [3167, 3191], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [3168, 3169], 'children': []}, {'type': 'Parameter', 'name': 'event_data', 'range': [3170, 3176], 'children': [{'type': 'Identifier', 'name': 'event_data', 'range': [3170, 3176], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [3171, 3172], 'children': []}, {'type': 'Type', 'name': 'market.model.AgentInstalledFromMarketplaceEventData', 'range': [3172, 3176], 'children': []}]}, {'type': 'Punctuation', 'name': ')', 'range': [3179, 3180], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [3180, 3181], 'children': []}, {'type': 'Block', 'name': 'try', 'range': [3182, 3268], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [3182, 3185], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [3183, 3184], 'children': []}, {'type': 'ExpressionStatement', 'name': 'await prisma.models.InstallTracker.prisma().create(data={...})', 'range': [3185, 3237], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [3185, 3190], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.InstallTracker.prisma().create', 'range': [3190, 3237], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.InstallTracker.prisma', 'range': [3190, 3193], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [3190, 3196], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [3196, 3197], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [3197, 3202], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [3202, 3203], 'children': []}, {'type': 'Identifier', 'name': 'InstallTracker', 'range': [3203, 3216], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [3216, 3217], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [3217, 3222], 'children': []}]}, {'type': 'CallExpression', 'name': 'create', 'range': [3222, 3237], 'children': [{'type': 'Identifier', 'name': 'create', 'range': [3222, 3227], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [3227, 3228], 'children': []}, {'type': 'ObjectExpression', 'name': 'data', 'range': [3228, 3235], 'children': [{'type': 'Property', 'name': 'installedAgentId', 'range': [3228, 3231], 'children': [{'type': 'Identifier', 'name': 'installedAgentId', 'range': [3228, 3243], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [3243, 3244], 'children': []}, {'type': 'Identifier', 'name': 'event_data.installed_agent_id', 'range': [3244, 3261], 'children': []}]}, {'type': 'Property', 'name': 'marketplaceAgentId', 'range': [3231, 3234], 'children': [{'type': 'Identifier', 'name': 'marketplaceAgentId', 'range': [3231, 3248], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [3248, 3249], 'children': []}, {'type': 'Identifier', 'name': 'event_data.marketplace_agent_id', 'range': [3249, 3266], 'children': []}]}, {'type': 'Property', 'name': 'installationLocation', 'range': [3234, 3235], 'children': [{'type': 'Identifier', 'name': 'installationLocation', 'range': [3234, 3253], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [3253, 3254], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.enums.InstallationLocation', 'range': [3254, 3265], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [3254, 3259], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [3259, 3260], 'children': []}, {'type': 'Identifier', 'name': 'enums', 'range': [3260, 3265], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [3265, 3266], 'children': []}, {'type': 'Identifier', 'name': 'InstallationLocation', 'range': [3266, 3283], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [3283, 3284], 'children': []}, {'type': 'Identifier', 'name': 'event_data.installation_location.name', 'range': [3284, 3307], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [3307, 3308], 'children': []}]}]}]}, {'type': 'Punctuation', 'name': ')', 'range': [3235, 3236], 'children': []}]}]}]}, {'type': 'Block', 'name': 'except', 'range': [3239, 3268], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [3239, 3245], 'children': []}, {'type': 'Identifier', 'name': 'prisma.errors.PrismaError', 'range': [3245, 3261], 'children': []}, {'type': 'Keyword', 'name': 'as', 'range': [3261, 3263], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3263, 3264], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [3264, 3265], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [3265, 3268], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [3265, 3270], 'children': []}, {'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3270, 3287], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [3270, 3284], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [3284, 3285], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Database query failed: {str(e)}"', 'range': [3285, 3307], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [3299, 3302], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [3302, 3303], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3303, 3304], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [3304, 3305], 'children': []}]}, {'type': 'Punctuation', 'name': ')', 'range': [3307, 3308], 'children': []}]}]}]}, {'type': 'Block', 'name': 'except', 'range': [3256, 3268], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [3256, 3262], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [3262, 3271], 'children': []}, {'type': 'Keyword', 'name': 'as', 'range': [3271, 3273], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3273, 3274], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [3274, 3275], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [3275, 3268], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [3275, 3280], 'children': []}, {'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3280, 3297], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [3280, 3294], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [3294, 3295], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [3295, 3317], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [3309, 3312], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [3312, 3313], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3313, 3314], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [3314, 3315], 'children': []}]}, {'type': 'Punctuation', 'name': ')', 'range': [3317, 3318], 'children': []}]}]}]}]}]}]}
2025-01-08 10:29:13,927 - INFO - Starting Step 3: AST simplification
2025-01-08 10:29:14,610 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_agents', 'range': [574, 1069], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_agents', 'range': [574, 1069], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [574, 578], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [575, 578], 'children': []}, {'type': 'FunctionName', 'name': 'get_agents', 'range': [576, 585], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [577, 679], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [579, 583], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [580, 583], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [586, 590], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [587, 590], 'children': []}]}, {'type': 'Parameter', 'name': 'name', 'range': [593, 599], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [594, 599], 'children': []}]}, {'type': 'Parameter', 'name': 'keyword', 'range': [602, 608], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [603, 608], 'children': []}]}, {'type': 'Parameter', 'name': 'category', 'range': [611, 617], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [612, 617], 'children': []}]}, {'type': 'Parameter', 'name': 'description', 'range': [620, 626], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [621, 626], 'children': []}]}, {'type': 'Parameter', 'name': 'description_threshold', 'range': [629, 633], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [630, 633], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [636, 651], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [637, 651], 'children': []}]}, {'type': 'Parameter', 'name': 'sort_by', 'range': [653, 657], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [654, 657], 'children': []}]}, {'type': 'Parameter', 'name': 'sort_order', 'range': [660, 676], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.Literal["desc"] | typing.Literal["asc"]', 'range': [661, 676], 'children': []}]}]}, {'type': 'ReturnTypeAnnotation', 'name': 'return_type', 'range': [680, 681], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [682, 1069], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [682, 691], 'children': []}, {'type': 'TryStatement', 'name': 'try_statement', 'range': [694, 1069], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [694, 1017], 'children': [{'type': 'Comment', 'name': 'Define the base query', 'range': [697, 702], 'children': []}, {'type': 'VariableDeclaration', 'name': 'query', 'range': [703, 706], 'children': []}, {'type': 'Comment', 'name': 'Add optional filters', 'range': [709, 713], 'children': []}, {'type': 'IfStatement', 'name': 'if_name', 'range': [714, 732], 'children': [{'type': 'Condition', 'name': 'name', 'range': [715, 716], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [717, 732], 'children': [{'type': 'AssignmentExpression', 'name': 'query["name"]', 'range': [718, 731], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_keyword', 'range': [733, 747], 'children': [{'type': 'Condition', 'name': 'keyword', 'range': [734, 735], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [736, 747], 'children': [{'type': 'AssignmentExpression', 'name': 'query["keywords"]', 'range': [737, 746], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_category', 'range': [748, 762], 'children': [{'type': 'Condition', 'name': 'category', 'range': [749, 750], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [751, 762], 'children': [{'type': 'AssignmentExpression', 'name': 'query["categories"]', 'range': [752, 761], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': 'query["submissionStatus"]', 'range': [763, 770], 'children': []}, {'type': 'Comment', 'name': 'Define sorting', 'range': [772, 775], 'children': []}, {'type': 'VariableDeclaration', 'name': 'order', 'range': [776, 783], 'children': []}, {'type': 'Comment', 'name': 'Calculate pagination', 'range': [785, 788], 'children': []}, {'type': 'VariableDeclaration', 'name': 'skip', 'range': [789, 798], 'children': []}, {'type': 'Comment', 'name': 'Execute the query', 'range': [800, 804], 'children': []}, {'type': 'TryStatement', 'name': 'try_execute_query', 'range': [805, 870], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [805, 853], 'children': [{'type': 'VariableDeclaration', 'name': 'agents', 'range': [808, 852], 'children': []}]}, {'type': 'CatchClause', 'name': 'catch_prisma_error', 'range': [854, 870], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [860, 861], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [862, 870], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [864, 869], 'children': []}]}]}]}, {'type': 'Comment', 'name': 'Apply fuzzy search on description if provided', 'range': [872, 880], 'children': []}, {'type': 'IfStatement', 'name': 'if_description', 'range': [881, 960], 'children': [{'type': 'Condition', 'name': 'description', 'range': [882, 883], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [884, 960], 'children': [{'type': 'TryStatement', 'name': 'try_fuzzy_search', 'range': [885, 959], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [885, 947], 'children': [{'type': 'VariableDeclaration', 'name': 'filtered_agents', 'range': [888, 892], 'children': []}, {'type': 'ForStatement', 'name': 'for_agent_in_agents', 'range': [893, 943], 'children': [{'type': 'Initialization', 'name': 'agent', 'range': [894, 895], 'children': []}, {'type': 'Condition', 'name': 'agents', 'range': [896, 897], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [898, 943], 'children': [{'type': 'IfStatement', 'name': 'if_fuzzy_match', 'range': [899, 935], 'children': [{'type': 'Condition', 'name': 'fuzzy_match', 'range': [900, 933], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [936, 943], 'children': [{'type': 'ExpressionStatement', 'name': 'filtered_agents.append(agent)', 'range': [937, 942], 'children': []}]}]}]}]}, {'type': 'AssignmentExpression', 'name': 'agents', 'range': [944, 946], 'children': []}]}, {'type': 'CatchClause', 'name': 'catch_AttributeError', 'range': [949, 959], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [950, 951], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [952, 959], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [954, 958], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': 'Get total count for pagination info', 'range': [962, 969], 'children': []}, {'type': 'VariableDeclaration', 'name': 'total_count', 'range': [970, 976], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [978, 1015], 'children': [{'type': 'ObjectExpression', 'name': 'return_object', 'range': [979, 1015], 'children': [{'type': 'Property', 'name': 'agents', 'range': [981, 983], 'children': []}, {'type': 'Property', 'name': 'total_count', 'range': [986, 988], 'children': []}, {'type': 'Property', 'name': 'page', 'range': [991, 993], 'children': []}, {'type': 'Property', 'name': 'page_size', 'range': [996, 998], 'children': []}, {'type': 'Property', 'name': 'total_pages', 'range': [1001, 1013], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'catch_AgentQueryError', 'range': [1018, 1036], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1020, 1021], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1022, 1036], 'children': [{'type': 'Comment', 'name': 'Log the error or handle it as needed', 'range': [1024, 1033], 'children': []}, {'type': 'ThrowStatement', 'name': 'throw_e', 'range': [1034, 1035], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'catch_ValueError', 'range': [1037, 1049], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1039, 1040], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1041, 1049], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [1043, 1048], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'catch_Exception', 'range': [1050, 1069], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1052, 1053], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1054, 1069], 'children': [{'type': 'Comment', 'name': 'Catch any other unexpected exceptions', 'range': [1056, 1062], 'children': []}, {'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [1063, 1068], 'children': []}]}]}]}]}]}]}
2025-01-08 10:29:14,611 - INFO - Starting Step 3: AST simplification
2025-01-08 10:29:14,756 - INFO - Step 3 result: {'type': 'Program', 'name': 'remove_featured_category', 'range': [2438, 2616], 'children': [{'type': 'FunctionDeclaration', 'name': 'remove_featured_category', 'range': [2438, 2616], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2438, 2442], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2439, 2442], 'children': []}, {'type': 'Identifier', 'name': 'remove_featured_category', 'range': [2440, 2461], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2441, 2451], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2443, 2446], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2445, 2446], 'children': []}]}, {'type': 'Parameter', 'name': 'category', 'range': [2447, 2450], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2449, 2450], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [2452, 2461], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.models.FeaturedAgent|None', 'range': [2454, 2461], 'children': []}]}, {'type': 'Docstring', 'name': 'docstring', 'range': [2463, 2465], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2467, 2616], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [2467, 2616], 'children': [{'type': 'Block', 'name': 'try_body', 'range': [2469, 2585], 'children': [{'type': 'Comment', 'name': 'get the existing categories', 'range': [2470, 2475], 'children': []}, {'type': 'Assignment', 'name': 'featured_agent', 'range': [2476, 2511], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2478, 2511], 'children': [{'type': 'CallExpression', 'name': 'find_unique', 'range': [2489, 2510], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2494, 2498], 'children': []}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2503, 2507], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [2513, 2524], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [2514, 2515], 'children': []}, {'type': 'Block', 'name': 'consequent', 'range': [2517, 2524], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2518, 2523], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2519, 2523], 'children': []}]}]}]}, {'type': 'Comment', 'name': 'remove the category from the list', 'range': [2526, 2533], 'children': []}, {'type': 'ExpressionStatement', 'name': 'featured_agent.featuredCategories.remove', 'range': [2534, 2542], 'children': [{'type': 'CallExpression', 'name': 'remove', 'range': [2538, 2541], 'children': []}]}, {'type': 'Assignment', 'name': 'featured_agent', 'range': [2544, 2581], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2546, 2581], 'children': [{'type': 'CallExpression', 'name': 'update', 'range': [2557, 2580], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2562, 2566], 'children': []}, {'type': 'ObjectExpression', 'name': 'data', 'range': [2571, 2577], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2583, 2585], 'children': []}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2587, 2603], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2592, 2595], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2596, 2603], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2597, 2602], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2598, 2602], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2604, 2616], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [2605, 2608], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2609, 2616], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2610, 2615], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2611, 2615], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:14,756 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:14,856 - INFO - Step 3 result: {'type': 'Program', 'name': 'set_agent_featured', 'range': [1948, 2144], 'children': [{'type': 'FunctionDeclaration', 'name': 'set_agent_featured', 'range': [1948, 2144], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1948, 1952], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1949, 1952], 'children': []}, {'type': 'FunctionName', 'name': 'set_agent_featured', 'range': [1950, 1974], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1951, 1974], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [1953, 1955], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1955, 1956], 'children': []}, {'type': 'Parameter', 'name': 'is_active', 'range': [1957, 1959], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [1959, 1960], 'children': []}, {'type': 'DefaultValue', 'name': 'True', 'range': [1961, 1962], 'children': []}, {'type': 'Parameter', 'name': 'featured_categories', 'range': [1963, 1965], 'children': []}, {'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [1965, 1969], 'children': []}, {'type': 'DefaultValue', 'name': '["featured"]', 'range': [1970, 1972], 'children': []}]}, {'type': 'ReturnType', 'name': 'prisma.models.FeaturedAgent', 'range': [1975, 1982], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [1984, 1988], 'children': []}, {'type': 'TryBlock', 'name': 'try', 'range': [1990, 2131], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [1990, 1991], 'children': []}, {'type': 'Block', 'name': 'try_block', 'range': [1992, 2131], 'children': [{'type': 'Assignment', 'name': 'agent', 'range': [1993, 2015], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [1995, 1996], 'children': []}, {'type': 'FunctionCall', 'name': 'prisma.models.Agents.prisma().find_unique', 'range': [1996, 2015], 'children': [{'type': 'Argument', 'name': 'where', 'range': [2008, 2014], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [2017, 2028], 'children': [{'type': 'Condition', 'name': 'not agent', 'range': [2018, 2020], 'children': []}, {'type': 'Block', 'name': 'if_block', 'range': [2021, 2028], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2022, 2027], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2023, 2027], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'featured', 'range': [2030, 2110], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [2032, 2033], 'children': []}, {'type': 'FunctionCall', 'name': 'prisma.models.FeaturedAgent.prisma().upsert', 'range': [2033, 2110], 'children': [{'type': 'Argument', 'name': 'where', 'range': [2046, 2052], 'children': []}, {'type': 'Argument', 'name': 'data', 'range': [2055, 2106], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2111, 2113], 'children': [{'type': 'ReturnValue', 'name': 'featured', 'range': [2112, 2113], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': 'except', 'range': [2115, 2131], 'children': [{'type': 'Exception', 'name': 'PrismaError', 'range': [2116, 2120], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2121, 2131], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2125, 2130], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2126, 2130], 'children': []}]}]}]}, {'type': 'ExceptBlock', 'name': 'except', 'range': [2132, 2144], 'children': [{'type': 'Exception', 'name': 'Exception', 'range': [2133, 2135], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2136, 2144], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2138, 2143], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2139, 2143], 'children': []}]}]}]}]}]}]}
2025-01-08 10:29:14,856 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:17,706 - INFO - Step 3 result: {'type': 'Program', 'name': 'search_db', 'range': [1193, 1602], 'children': [{'type': 'FunctionDeclaration', 'name': 'search_db', 'range': [1193, 1602], 'children': [{'type': 'Parameter', 'name': 'query', 'range': [1198, 1200], 'children': []}, {'type': 'Parameter', 'name': 'page', 'range': [1203, 1207], 'children': []}, {'type': 'Parameter', 'name': 'page_size', 'range': [1210, 1214], 'children': []}, {'type': 'Parameter', 'name': 'categories', 'range': [1217, 1228], 'children': []}, {'type': 'Parameter', 'name': 'description_threshold', 'range': [1231, 1235], 'children': []}, {'type': 'Parameter', 'name': 'sort_by', 'range': [1238, 1242], 'children': []}, {'type': 'Parameter', 'name': 'sort_order', 'range': [1245, 1261], 'children': []}, {'type': 'Parameter', 'name': 'submission_status', 'range': [1264, 1278], 'children': []}, {'type': 'ReturnType', 'name': 'market.model.ListResponse[market.utils.extension_types.AgentsWithRank]', 'range': [1284, 1297], 'children': []}, {'type': 'Block', 'name': 'FunctionBody', 'range': [1299, 1602], 'children': [{'type': 'TryStatement', 'name': 'Try', 'range': [1312, 1602], 'children': [{'type': 'Block', 'name': 'TryBlock', 'range': [1314, 1572], 'children': [{'type': 'VariableDeclaration', 'name': 'offset', 'range': [1315, 1324], 'children': []}, {'type': 'VariableDeclaration', 'name': 'category_filter', 'range': [1326, 1329], 'children': []}, {'type': 'IfStatement', 'name': 'If', 'range': [1330, 1357], 'children': [{'type': 'Block', 'name': 'IfBlock', 'range': [1333, 1357], 'children': [{'type': 'VariableDeclaration', 'name': 'category_conditions', 'range': [1334, 1343], 'children': []}, {'type': 'AssignmentExpression', 'name': 'category_filter', 'range': [1345, 1357], 'children': []}]}]}, {'type': 'Comment', 'name': 'Construct the ORDER BY clause based on the sort_by parameter', 'range': [1359, 1369], 'children': []}, {'type': 'IfStatement', 'name': 'If', 'range': [1371, 1404], 'children': [{'type': 'Block', 'name': 'IfBlock', 'range': [1380, 1385], 'children': [{'type': 'VariableDeclaration', 'name': 'order_by_clause', 'range': [1381, 1385], 'children': []}]}, {'type': 'ElseIfStatement', 'name': 'Elif', 'range': [1386, 1397], 'children': [{'type': 'Block', 'name': 'ElseIfBlock', 'range': [1392, 1397], 'children': [{'type': 'VariableDeclaration', 'name': 'order_by_clause', 'range': [1393, 1397], 'children': []}]}]}, {'type': 'ElseStatement', 'name': 'Else', 'range': [1398, 1404], 'children': [{'type': 'Block', 'name': 'ElseBlock', 'range': [1400, 1404], 'children': [{'type': 'VariableDeclaration', 'name': 'order_by_clause', 'range': [1401, 1404], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'submission_status_filter', 'range': [1406, 1414], 'children': []}, {'type': 'VariableDeclaration', 'name': 'sql_query', 'range': [1416, 1432], 'children': []}, {'type': 'VariableDeclaration', 'name': 'results', 'range': [1434, 1465], 'children': []}, {'type': 'ReturnStatement', 'name': 'Return', 'range': [1528, 1571], 'children': []}]}, {'type': 'CatchStatement', 'name': 'Except', 'range': [1573, 1589], 'children': [{'type': 'Block', 'name': 'CatchBlock', 'range': [1582, 1589], 'children': [{'type': 'ThrowStatement', 'name': 'Raise', 'range': [1583, 1589], 'children': []}]}]}, {'type': 'CatchStatement', 'name': 'Except', 'range': [1590, 1602], 'children': [{'type': 'Block', 'name': 'CatchBlock', 'range': [1595, 1602], 'children': [{'type': 'ThrowStatement', 'name': 'Raise', 'range': [1596, 1602], 'children': []}]}]}]}]}]}, {'type': 'ClassDeclaration', 'name': 'CountResponse', 'range': [1467, 1479], 'children': [{'type': 'Property', 'name': 'count', 'range': [1476, 1478], 'children': []}]}]}
2025-01-08 10:29:17,706 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:18,870 - INFO - Step 4 result: {'type': 'Program', 'name': 'update_agent_entry', 'range': [421, 573], 'children': [{'type': 'FunctionDecl', 'name': 'update_agent_entry', 'range': [421, 573], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [421, 421], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [422, 422], 'children': []}, {'type': 'Identifier', 'name': 'update_agent_entry', 'range': [423, 423], 'children': []}, {'type': 'Parameter', 'name': 'agent_id', 'range': [426, 428], 'children': [{'type': 'Identifier', 'name': 'agent_id', 'range': [426, 426], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [428, 428], 'children': []}]}, {'type': 'Parameter', 'name': 'version', 'range': [431, 433], 'children': [{'type': 'Identifier', 'name': 'version', 'range': [431, 431], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [433, 433], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_state', 'range': [436, 442], 'children': [{'type': 'Identifier', 'name': 'submission_state', 'range': [436, 436], 'children': []}, {'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [438, 442], 'children': []}]}, {'type': 'Parameter', 'name': 'comments', 'range': [445, 451], 'children': [{'type': 'Identifier', 'name': 'comments', 'range': [445, 445], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str | None', 'range': [447, 451], 'children': []}]}, {'type': 'ReturnType', 'name': '-> prisma.models.Agents | None', 'range': [455, 463], 'children': []}, {'type': 'Docstring', 'name': '""" \\n     Update an existing agent entry in the database. \\n  \\n     Args: \\n         agent_id (str): The ID of the agent. \\n         version (int): The version of the agent. \\n         submission_state (prisma.enums.SubmissionStatus): The submission state of the agent. \\n     """', 'range': [466, 468], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [471, 572], 'children': [{'type': 'Block', 'name': '', 'range': [473, 538], 'children': [{'type': 'AssignmentExpression', 'name': 'agent = await prisma.models.Agents.prisma().update(where={"id": agent_id}, data={"version": version, "submissionStatus": submission_state, "submissionReviewDate": datetime.datetime.now(datetime.timezone.utc), "submissionReviewComments": comments})', 'range': [474, 537], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except prisma.errors.PrismaError as e', 'range': [543, 558], 'children': [{'type': 'RaiseStatement', 'name': 'raise AgentQueryError(f"Agent Update Failed Database query failed: {str(e)}")', 'range': [553, 558], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except Exception as e', 'range': [560, 571], 'children': [{'type': 'RaiseStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [566, 571], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return agent', 'range': [540, 542], 'children': []}]}]}
2025-01-08 10:29:18,870 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:20,911 - INFO - Step 3 result: {'type': 'Program', 'name': 'add_featured_category', 'range': [2617, 2725], 'children': [{'type': 'FunctionDeclaration', 'name': 'add_featured_category', 'range': [2617, 2725], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [2617, 2621], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [2618, 2621], 'children': []}, {'type': 'FunctionName', 'name': 'add_featured_category', 'range': [2619, 2637], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2620, 2630], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2622, 2624], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2624, 2627], 'children': []}, {'type': 'Parameter', 'name': 'category', 'range': [2626, 2628], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2628, 2630], 'children': []}]}, {'type': 'ReturnType', 'name': '->', 'range': [2631, 2633], 'children': []}, {'type': 'ReturnTypeValue', 'name': 'prisma.models.FeaturedAgent|None', 'range': [2633, 2639], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [2642, 2644], 'children': []}, {'type': 'TryBlock', 'name': 'try', 'range': [2646, 2725], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [2646, 2649], 'children': []}, {'type': 'Block', 'name': 'try_block', 'range': [2649, 2694], 'children': [{'type': 'Assignment', 'name': 'featured_agent', 'range': [2649, 2690], 'children': [{'type': 'Variable', 'name': 'featured_agent', 'range': [2649, 2662], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [2651, 2655], 'children': []}, {'type': 'FunctionCall', 'name': 'prisma.models.FeaturedAgent.prisma().update', 'range': [2652, 2689], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [2663, 2689], 'children': [{'type': 'KeywordArgument', 'name': 'where', 'range': [2665, 2671], 'children': []}, {'type': 'KeywordArgument', 'name': 'data', 'range': [2674, 2686], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2692, 2694], 'children': [{'type': 'Variable', 'name': 'featured_agent', 'range': [2693, 2694], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': 'except', 'range': [2696, 2712], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [2696, 2702], 'children': []}, {'type': 'ExceptionType', 'name': 'prisma.errors.PrismaError', 'range': [2697, 2701], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [2702, 2704], 'children': []}, {'type': 'ExceptionVariable', 'name': 'e', 'range': [2703, 2704], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2704, 2712], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2706, 2711], 'children': [{'type': 'ExceptionType', 'name': 'AgentQueryError', 'range': [2707, 2711], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2708, 2711], 'children': [{'type': 'FString', 'name': 'f"Database query failed: {str(e)}"', 'range': [2709, 2711], 'children': []}]}]}]}]}, {'type': 'ExceptBlock', 'name': 'except', 'range': [2713, 2725], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [2713, 2717], 'children': []}, {'type': 'ExceptionType', 'name': 'Exception', 'range': [2714, 2717], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [2715, 2717], 'children': []}, {'type': 'ExceptionVariable', 'name': 'e', 'range': [2716, 2717], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2717, 2725], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2719, 2724], 'children': [{'type': 'ExceptionType', 'name': 'AgentQueryError', 'range': [2720, 2724], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2721, 2724], 'children': [{'type': 'FString', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [2722, 2724], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:20,911 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:21,964 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_all_categories', 'range': [3021, 3164], 'children': [{'type': 'FunctionDecl', 'name': 'get_all_categories', 'range': [3021, 3164], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [3021, 3021], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [3022, 3022], 'children': []}, {'type': 'Identifier', 'name': 'get_all_categories', 'range': [3023, 3023], 'children': []}, {'type': 'ReturnType', 'name': '-> market.model.CategoriesResponse', 'range': [3026, 3032], 'children': []}, {'type': 'Docstring', 'name': '""" \\n     Retrieve all unique categories from the database. \\n  \\n     Returns: \\n         CategoriesResponse: A list of unique categories. \\n     """', 'range': [3035, 3037], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [3039, 3134], 'children': [{'type': 'AssignmentExpression', 'name': 'agents = await prisma.models.Agents.prisma().find_many(distinct=["categories"])', 'range': [3042, 3062], 'children': []}, {'type': 'Comment', 'name': '# Aggregate categories on the Python side', 'range': [3065, 3072], 'children': []}, {'type': 'AssignmentExpression', 'name': 'all_categories = set()', 'range': [3073, 3077], 'children': []}, {'type': 'ForStatement', 'name': 'for agent in agents:', 'range': [3079, 3093], 'children': [{'type': 'CallExpression', 'name': 'all_categories.update(agent.categories)', 'range': [3085, 3092], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'unique_categories = sorted(list(all_categories))', 'range': [3095, 3103], 'children': []}, {'type': 'ReturnStatement', 'name': 'return market.model.CategoriesResponse(unique_categories=unique_categories)', 'range': [3106, 3116], 'children': []}, {'type': 'CatchClause', 'name': 'except prisma.errors.PrismaError as e:', 'range': [3118, 3133], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [3128, 3133], 'children': []}]}, {'type': 'CatchClause', 'name': 'except Exception:', 'range': [3135, 3163], 'children': [{'type': 'Comment', 'name': '# Return an empty list of categories in case of unexpected errors', 'range': [3139, 3151], 'children': []}, {'type': 'ReturnStatement', 'name': 'return market.model.CategoriesResponse(unique_categories=[])', 'range': [3152, 3163], 'children': []}]}]}]}]}
2025-01-08 10:29:21,965 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:30,148 - INFO - Step 5 result: {'type': 'Program', 'name': 'delete_agent', 'range': [149, 234], 'children': [{'type': 'FunctionDecl', 'name': 'delete_agent', 'range': [149, 234], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [149, 149], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [150, 150], 'children': []}, {'type': 'Identifier', 'name': 'delete_agent', 'range': [151, 151], 'children': []}, {'type': 'Parameter', 'name': 'agent_id', 'range': [153, 153], 'children': [{'type': 'TypeAnnotation', 'name': ':', 'range': [154, 154], 'children': [{'type': 'Type', 'name': 'str', 'range': [155, 155], 'children': []}]}]}, {'type': 'ReturnType', 'name': '->', 'range': [157, 158], 'children': [{'type': 'Type', 'name': 'prisma.models.Agents | None', 'range': [159, 165], 'children': []}]}, {'type': 'Docstring', 'name': '"""', 'range': [168, 170], 'children': [{'type': 'Text', 'name': 'Delete an agent from the database.', 'range': [169, 169], 'children': []}]}, {'type': 'TryStatement', 'name': 'try', 'range': [172, 233], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [172, 172], 'children': []}, {'type': 'ExpressionStatement', 'name': 'deleted_agent = await prisma.models.Agents.prisma().delete(where={"id": agent_id})', 'range': [175, 199], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [201, 201], 'children': [{'type': 'Identifier', 'name': 'deleted_agent', 'range': [202, 202], 'children': []}]}, {'type': 'CatchClause', 'name': 'except', 'range': [204, 232], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [204, 204], 'children': []}, {'type': 'Identifier', 'name': 'PrismaError', 'range': [205, 209], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [211, 211], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [214, 219], 'children': []}, {'type': 'CatchClause', 'name': 'except', 'range': [221, 232], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [221, 221], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [222, 222], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [224, 224], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [227, 232], 'children': []}]}]}]}]}]}
2025-01-08 10:29:30,149 - INFO - Completed main AST analysis flow
2025-01-08 10:29:30,149 - INFO - Successfully processed chunk
2025-01-08 10:29:34,818 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_not_featured_agents', 'range': [2812, 3020], 'children': [{'type': 'FunctionDecl', 'name': 'get_not_featured_agents', 'range': [2812, 3020], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2812, 2816], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2813, 2816], 'children': []}, {'type': 'Identifier', 'name': 'get_not_featured_agents', 'range': [2814, 2834], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2815, 2829], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [2817, 2821], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [2819, 2821], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [2823, 2827], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [2825, 2827], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'typing.List[prisma.models.Agents]', 'range': [2830, 2841], 'children': []}, {'type': 'Docstring', 'name': 'Retrieve a list of not featured agents from the database.', 'range': [2844, 2846], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2848, 3020], 'children': [{'type': 'Block', 'name': 'try_block', 'range': [2850, 2987], 'children': [{'type': 'Assignment', 'name': 'agents', 'range': [2851, 2863], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2853, 2859], 'children': [{'type': 'CallExpression', 'name': 'get_client', 'range': [2854, 2860], 'children': []}]}, {'type': 'CallExpression', 'name': 'query_raw', 'range': [2861, 2986], 'children': [{'type': 'StringLiteral', 'name': 'query', 'range': [2865, 2974], 'children': []}, {'type': 'Assignment', 'name': 'model', 'range': [2977, 2984], 'children': [{'type': 'Identifier', 'name': 'prisma.models.Agents', 'range': [2979, 2983], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2988, 2990], 'children': [{'type': 'Identifier', 'name': 'agents', 'range': [2989, 2990], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2991, 3007], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2992, 2996], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2999, 3007], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3001, 3006], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3002, 3006], 'children': [{'type': 'StringLiteral', 'name': 'Database query failed: {str(e)}', 'range': [3004, 3005], 'children': []}]}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [3008, 3020], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [3009, 3011], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [3012, 3020], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3014, 3019], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3015, 3019], 'children': [{'type': 'StringLiteral', 'name': 'Unexpected error occurred: {str(e)}', 'range': [3017, 3018], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:34,818 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:37,969 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_all_categories', 'range': [3021, 3164], 'children': [{'type': 'FunctionDecl', 'name': 'get_all_categories', 'range': [3021, 3164], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [3021, 3021], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [3022, 3022], 'children': []}, {'type': 'Identifier', 'name': 'get_all_categories', 'range': [3023, 3023], 'children': []}, {'type': 'ReturnType', 'name': '-> market.model.CategoriesResponse', 'range': [3026, 3032], 'children': []}, {'type': 'Docstring', 'name': '""" \\n     Retrieve all unique categories from the database. \\n  \\n     Returns: \\n         CategoriesResponse: A list of unique categories. \\n     """', 'range': [3035, 3037], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [3039, 3134], 'children': [{'type': 'AssignmentExpression', 'name': 'agents = await prisma.models.Agents.prisma().find_many(distinct=["categories"])', 'range': [3042, 3062], 'children': []}, {'type': 'Comment', 'name': '# Aggregate categories on the Python side', 'range': [3065, 3072], 'children': []}, {'type': 'AssignmentExpression', 'name': 'all_categories = set()', 'range': [3073, 3077], 'children': []}, {'type': 'ForStatement', 'name': 'for agent in agents:', 'range': [3079, 3093], 'children': [{'type': 'CallExpression', 'name': 'all_categories.update(agent.categories)', 'range': [3085, 3092], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'unique_categories = sorted(list(all_categories))', 'range': [3095, 3103], 'children': []}, {'type': 'ReturnStatement', 'name': 'return market.model.CategoriesResponse(unique_categories=unique_categories)', 'range': [3106, 3116], 'children': []}, {'type': 'CatchClause', 'name': 'except prisma.errors.PrismaError as e:', 'range': [3118, 3133], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [3128, 3133], 'children': []}]}, {'type': 'CatchClause', 'name': 'except Exception:', 'range': [3135, 3163], 'children': [{'type': 'Comment', 'name': '# Return an empty list of categories in case of unexpected errors', 'range': [3139, 3151], 'children': []}, {'type': 'ReturnStatement', 'name': 'return market.model.CategoriesResponse(unique_categories=[])', 'range': [3152, 3163], 'children': []}]}]}]}]}
2025-01-08 10:29:37,970 - INFO - Completed main AST analysis flow
2025-01-08 10:29:37,970 - INFO - Successfully processed chunk
2025-01-08 10:29:37,988 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_featured_agents', 'range': [2145, 2437], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_featured_agents', 'range': [2145, 2437], 'children': [{'type': 'FunctionSignature', 'name': 'get_featured_agents', 'range': [2145, 2193], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2145, 2149], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2146, 2149], 'children': []}, {'type': 'Identifier', 'name': 'get_featured_agents', 'range': [2147, 2167], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2148, 2188], 'children': [{'type': 'Parameter', 'name': 'category', 'range': [2150, 2154], 'children': [{'type': 'Identifier', 'name': 'category', 'range': [2150, 2157], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2151, 2154], 'children': []}, {'type': 'DefaultValue', 'name': '"featured"', 'range': [2153, 2154], 'children': []}]}, {'type': 'Parameter', 'name': 'page', 'range': [2157, 2161], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2157, 2161], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [2158, 2161], 'children': []}, {'type': 'DefaultValue', 'name': '1', 'range': [2160, 2161], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [2164, 2168], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2164, 2172], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [2165, 2168], 'children': []}, {'type': 'DefaultValue', 'name': '10', 'range': [2167, 2168], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [2171, 2185], 'children': [{'type': 'Identifier', 'name': 'submission_status', 'range': [2171, 2187], 'children': []}, {'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [2172, 2185], 'children': []}, {'type': 'DefaultValue', 'name': 'prisma.enums.SubmissionStatus.APPROVED', 'range': [2178, 2185], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'FeaturedAgentResponse', 'range': [2190, 2193], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [2194, 2437], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [2194, 2198], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2200, 2437], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2202, 2378], 'children': [{'type': 'Comment', 'name': 'Calculate pagination', 'range': [2203, 2206], 'children': []}, {'type': 'VariableDeclaration', 'name': 'skip', 'range': [2207, 2216], 'children': [{'type': 'Identifier', 'name': 'skip', 'range': [2207, 2211], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2208, 2211], 'children': []}, {'type': 'BinaryExpression', 'name': '*', 'range': [2209, 2215], 'children': [{'type': 'BinaryExpression', 'name': '-', 'range': [2210, 2213], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2210, 2214], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [2212, 2213], 'children': []}]}, {'type': 'Identifier', 'name': 'page_size', 'range': [2214, 2218], 'children': []}]}]}, {'type': 'Comment', 'name': 'Execute the query', 'range': [2218, 2222], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2223, 2321], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2225, 2304], 'children': [{'type': 'VariableDeclaration', 'name': 'featured_agents', 'range': [2226, 2304], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2226, 2240], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2227, 2240], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [2228, 2304], 'children': [{'type': 'CallExpression', 'name': 'find_many', 'range': [2229, 2304], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.FeaturedAgent.prisma', 'range': [2229, 2238], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [2229, 2235], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [2230, 2236], 'children': []}, {'type': 'Identifier', 'name': 'FeaturedAgent', 'range': [2231, 2244], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [2232, 2238], 'children': []}]}, {'type': 'CallExpression', 'name': 'find_many', 'range': [2239, 2304], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2241, 2273], 'children': [{'type': 'Property', 'name': 'featuredCategories', 'range': [2242, 2252], 'children': [{'type': 'Identifier', 'name': 'featuredCategories', 'range': [2242, 2258], 'children': []}, {'type': 'ObjectExpression', 'name': 'has', 'range': [2248, 2252], 'children': [{'type': 'Identifier', 'name': 'category', 'range': [2249, 2256], 'children': []}]}]}, {'type': 'Property', 'name': 'isActive', 'range': [2255, 2258], 'children': [{'type': 'Identifier', 'name': 'isActive', 'range': [2255, 2263], 'children': []}, {'type': 'BooleanLiteral', 'name': 'True', 'range': [2256, 2260], 'children': []}]}, {'type': 'Property', 'name': 'agent', 'range': [2260, 2270], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [2260, 2265], 'children': []}, {'type': 'ObjectExpression', 'name': 'is', 'range': [2262, 2270], 'children': [{'type': 'Property', 'name': 'submissionStatus', 'range': [2263, 2269], 'children': [{'type': 'Identifier', 'name': 'submissionStatus', 'range': [2263, 2279], 'children': []}, {'type': 'Identifier', 'name': 'submission_status', 'range': [2266, 2279], 'children': []}]}]}]}]}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2276, 2290], 'children': [{'type': 'Property', 'name': 'agent', 'range': [2277, 2289], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [2277, 2282], 'children': []}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2281, 2289], 'children': [{'type': 'Property', 'name': 'AnalyticsTracker', 'range': [2282, 2288], 'children': [{'type': 'Identifier', 'name': 'AnalyticsTracker', 'range': [2282, 2298], 'children': []}, {'type': 'BooleanLiteral', 'name': 'True', 'range': [2286, 2288], 'children': []}]}]}]}]}, {'type': 'Property', 'name': 'skip', 'range': [2293, 2296], 'children': [{'type': 'Identifier', 'name': 'skip', 'range': [2293, 2297], 'children': []}]}, {'type': 'Property', 'name': 'take', 'range': [2298, 2301], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2298, 2306], 'children': []}]}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2305, 2321], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2306, 2317], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2311, 2313], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2314, 2321], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [2315, 2321], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2316, 2321], 'children': [{'type': 'Literal', 'name': '"Database query failed: {str(e)}"', 'range': [2318, 2320], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': 'Get total count for pagination info', 'range': [2323, 2330], 'children': []}, {'type': 'VariableDeclaration', 'name': 'total_count', 'range': [2331, 2337], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2331, 2341], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2332, 2341], 'children': []}, {'type': 'CallExpression', 'name': 'len', 'range': [2333, 2337], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2335, 2349], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2339, 2378], 'children': [{'type': 'NewExpression', 'name': 'FeaturedAgentResponse', 'range': [2340, 2378], 'children': [{'type': 'ObjectExpression', 'name': 'featured_agents', 'range': [2342, 2346], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2343, 2357], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'total_count', 'range': [2348, 2351], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2349, 2361], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'page', 'range': [2353, 2356], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2354, 2358], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'page_size', 'range': [2358, 2361], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2359, 2367], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'total_pages', 'range': [2363, 2375], 'children': [{'type': 'BinaryExpression', 'name': '/', 'range': [2364, 2374], 'children': [{'type': 'BinaryExpression', 'name': '+', 'range': [2365, 2370], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2366, 2376], 'children': []}, {'type': 'BinaryExpression', 'name': '-', 'range': [2367, 2370], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2368, 2376], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [2369, 2370], 'children': []}]}]}, {'type': 'Identifier', 'name': 'page_size', 'range': [2372, 2380], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2380, 2400], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [2381, 2395], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2383, 2385], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2386, 2400], 'children': [{'type': 'Comment', 'name': 'Log the error or handle it as needed', 'range': [2387, 2395], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2396, 2400], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [2397, 2399], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2401, 2415], 'children': [{'type': 'Identifier', 'name': 'ValueError', 'range': [2402, 2411], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2404, 2406], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2407, 2415], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [2408, 2415], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2409, 2415], 'children': [{'type': 'Literal', 'name': '"Invalid input parameter: {str(e)}"', 'range': [2410, 2412], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2416, 2437], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [2417, 2426], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2419, 2421], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2422, 2437], 'children': [{'type': 'Comment', 'name': 'Catch any other unexpected exceptions', 'range': [2423, 2428], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2429, 2437], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2430, 2437], 'children': [{'type': 'Literal', 'name': '"Unexpected error occurred: {str(e)}"', 'range': [2431, 2433], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:29:37,989 - INFO - Starting Step 3: AST simplification
2025-01-08 10:29:38,371 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_agent_featured', 'range': [2726, 2811], 'children': [{'type': 'FunctionDecl', 'name': 'get_agent_featured', 'range': [2726, 2811], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [2726, 2730], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [2727, 2730], 'children': []}, {'type': 'FunctionName', 'name': 'get_agent_featured', 'range': [2728, 2744], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2729, 2733], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2730, 2733], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2731, 2733], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [2734, 2743], 'children': [{'type': 'Type', 'name': 'prisma.models.FeaturedAgent', 'range': [2736, 2740], 'children': []}, {'type': 'UnionType', 'name': '|', 'range': [2741, 2742], 'children': []}, {'type': 'Type', 'name': 'None', 'range': [2742, 2743], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [2744, 2811], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [2745, 2747], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2749, 2811], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [2751, 2778], 'children': [{'type': 'AssignmentExpression', 'name': 'featured_agent', 'range': [2752, 2777], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2754, 2777], 'children': [{'type': 'CallExpression', 'name': 'find_unique', 'range': [2765, 2777], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.FeaturedAgent.prisma', 'range': [2755, 2764], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2766, 2777], 'children': [{'type': 'KeywordArgument', 'name': 'where', 'range': [2768, 2774], 'children': [{'type': 'ObjectExpression', 'name': 'object', 'range': [2770, 2774], 'children': [{'type': 'Property', 'name': 'agentId', 'range': [2771, 2773], 'children': []}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2779, 2781], 'children': [{'type': 'Identifier', 'name': 'featured_agent', 'range': [2780, 2781], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2782, 2798], 'children': [{'type': 'ExceptionType', 'name': 'PrismaError', 'range': [2783, 2787], 'children': []}, {'type': 'Alias', 'name': 'e', 'range': [2788, 2789], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [2792, 2798], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2793, 2798], 'children': [{'type': 'TemplateLiteral', 'name': 'f-string', 'range': [2795, 2797], 'children': []}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2799, 2811], 'children': [{'type': 'ExceptionType', 'name': 'Exception', 'range': [2800, 2801], 'children': []}, {'type': 'Alias', 'name': 'e', 'range': [2802, 2803], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [2805, 2811], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2806, 2811], 'children': [{'type': 'TemplateLiteral', 'name': 'f-string', 'range': [2808, 2810], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:38,371 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:39,019 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_top_agents_by_downloads', 'range': [1603, 1947], 'children': [{'type': 'FunctionDecl', 'name': 'get_top_agents_by_downloads', 'range': [1603, 1947], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1603, 1607], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1604, 1607], 'children': []}, {'type': 'Identifier', 'name': 'get_top_agents_by_downloads', 'range': [1605, 1639], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [1606, 1639], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [1608, 1612], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [1609, 1612], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [1615, 1619], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [1616, 1619], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [1622, 1636], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [1623, 1636], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'market.model.ListResponse[prisma.models.AnalyticsTracker]', 'range': [1640, 1653], 'children': []}, {'type': 'Block', 'name': '', 'range': [1655, 1947], 'children': [{'type': 'TryStatement', 'name': '', 'range': [1660, 1947], 'children': [{'type': 'Block', 'name': '', 'range': [1662, 1888], 'children': [{'type': 'ExpressionStatement', 'name': 'skip = (page - 1) * page_size', 'range': [1667, 1676], 'children': []}, {'type': 'TryStatement', 'name': '', 'range': [1683, 1787], 'children': [{'type': 'Block', 'name': '', 'range': [1685, 1770], 'children': [{'type': 'ExpressionStatement', 'name': 'analytics = await prisma.models.AnalyticsTracker.prisma().find_many(...)', 'range': [1708, 1770], 'children': []}]}, {'type': 'CatchClause', 'name': 'PrismaError', 'range': [1771, 1787], 'children': [{'type': 'Block', 'name': '', 'range': [1779, 1787], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [1781, 1787], 'children': []}]}]}]}, {'type': 'TryStatement', 'name': '', 'range': [1789, 1843], 'children': [{'type': 'Block', 'name': '', 'range': [1791, 1826], 'children': [{'type': 'ExpressionStatement', 'name': 'total_count = await prisma.models.AnalyticsTracker.prisma().count(...)', 'range': [1792, 1826], 'children': []}]}, {'type': 'CatchClause', 'name': 'PrismaError', 'range': [1827, 1843], 'children': [{'type': 'Block', 'name': '', 'range': [1835, 1843], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [1837, 1843], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return market.model.ListResponse(...)', 'range': [1845, 1888], 'children': []}]}, {'type': 'CatchClause', 'name': 'AgentQueryError', 'range': [1890, 1910], 'children': [{'type': 'Block', 'name': '', 'range': [1894, 1910], 'children': [{'type': 'ThrowStatement', 'name': 'raise e from e', 'range': [1906, 1910], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'ValueError', 'range': [1911, 1925], 'children': [{'type': 'Block', 'name': '', 'range': [1915, 1925], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Invalid input parameter: {str(e)}") from e', 'range': [1917, 1925], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'Exception', 'range': [1926, 1947], 'children': [{'type': 'Block', 'name': '', 'range': [1930, 1947], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}") from e', 'range': [1939, 1947], 'children': []}]}]}]}]}]}]}
2025-01-08 10:29:39,019 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:40,029 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_agent_details', 'range': [1070, 1192], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_agent_details', 'range': [1070, 1192], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1070, 1070], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1071, 1071], 'children': []}, {'type': 'FunctionName', 'name': 'get_agent_details', 'range': [1072, 1072], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1073, 1085], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [1074, 1076], 'children': [{'type': 'ParameterName', 'name': 'agent_id', 'range': [1074, 1074], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1076, 1076], 'children': []}]}, {'type': 'Parameter', 'name': 'version', 'range': [1078, 1084], 'children': [{'type': 'ParameterName', 'name': 'version', 'range': [1078, 1078], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int | None', 'range': [1080, 1082], 'children': []}, {'type': 'DefaultValue', 'name': 'None', 'range': [1084, 1084], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [1086, 1086], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [1087, 1192], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [1088, 1090], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [1092, 1192], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [1093, 1162], 'children': [{'type': 'Assignment', 'name': 'query', 'range': [1095, 1101], 'children': [{'type': 'VariableName', 'name': 'query', 'range': [1095, 1095], 'children': []}, {'type': 'Dictionary', 'name': 'dictionary', 'range': [1097, 1101], 'children': [{'type': 'KeyValuePair', 'name': 'id', 'range': [1098, 1100], 'children': [{'type': 'Key', 'name': 'id', 'range': [1098, 1098], 'children': []}, {'type': 'Value', 'name': 'agent_id', 'range': [1100, 1100], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1103, 1120], 'children': [{'type': 'Condition', 'name': 'version is not None', 'range': [1104, 1107], 'children': []}, {'type': 'IfBlock', 'name': 'if_block', 'range': [1108, 1120], 'children': [{'type': 'Assignment', 'name': 'query["version"]', 'range': [1110, 1115], 'children': [{'type': 'VariableName', 'name': 'query', 'range': [1110, 1110], 'children': []}, {'type': 'Index', 'name': 'version', 'range': [1112, 1112], 'children': []}, {'type': 'Value', 'name': 'version', 'range': [1115, 1115], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'agent', 'range': [1122, 1145], 'children': [{'type': 'VariableName', 'name': 'agent', 'range': [1122, 1122], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1124, 1124], 'children': []}, {'type': 'MethodCall', 'name': 'prisma.models.Agents.prisma().find_first', 'range': [1125, 1140], 'children': [{'type': 'Object', 'name': 'prisma', 'range': [1125, 1125], 'children': []}, {'type': 'Property', 'name': 'models', 'range': [1127, 1127], 'children': []}, {'type': 'Property', 'name': 'Agents', 'range': [1129, 1129], 'children': []}, {'type': 'MethodCall', 'name': 'prisma', 'range': [1131, 1133], 'children': []}, {'type': 'MethodCall', 'name': 'find_first', 'range': [1135, 1140], 'children': [{'type': 'Argument', 'name': 'where', 'range': [1137, 1139], 'children': [{'type': 'VariableName', 'name': 'query', 'range': [1139, 1139], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1147, 1157], 'children': [{'type': 'Condition', 'name': 'not agent', 'range': [1148, 1149], 'children': []}, {'type': 'IfBlock', 'name': 'if_block', 'range': [1150, 1157], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [1152, 1156], 'children': [{'type': 'ExceptionName', 'name': 'AgentQueryError', 'range': [1153, 1153], 'children': []}, {'type': 'Argument', 'name': '"Agent not found"', 'range': [1155, 1155], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1159, 1161], 'children': [{'type': 'VariableName', 'name': 'agent', 'range': [1160, 1160], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1163, 1179], 'children': [{'type': 'ExceptionType', 'name': 'PrismaError', 'range': [1168, 1168], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [1169, 1169], 'children': []}, {'type': 'VariableName', 'name': 'e', 'range': [1170, 1170], 'children': []}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [1171, 1179], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [1173, 1178], 'children': [{'type': 'ExceptionName', 'name': 'AgentQueryError', 'range': [1174, 1174], 'children': []}, {'type': 'Argument', 'name': 'f"Database query failed: {str(e)}"', 'range': [1176, 1177], 'children': []}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1180, 1192], 'children': [{'type': 'ExceptionType', 'name': 'Exception', 'range': [1181, 1181], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [1182, 1182], 'children': []}, {'type': 'VariableName', 'name': 'e', 'range': [1183, 1183], 'children': []}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [1184, 1192], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [1186, 1191], 'children': [{'type': 'ExceptionName', 'name': 'AgentQueryError', 'range': [1187, 1187], 'children': []}, {'type': 'Argument', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [1189, 1190], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:40,030 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:41,922 - INFO - Step 5 result: {'type': 'Program', 'name': 'update_agent_entry', 'range': [421, 573], 'children': [{'type': 'FunctionDecl', 'name': 'update_agent_entry', 'range': [421, 573], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [421, 421], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [422, 422], 'children': []}, {'type': 'Identifier', 'name': 'update_agent_entry', 'range': [423, 423], 'children': []}, {'type': 'Parameter', 'name': 'agent_id', 'range': [426, 428], 'children': [{'type': 'Identifier', 'name': 'agent_id', 'range': [426, 426], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [428, 428], 'children': []}]}, {'type': 'Parameter', 'name': 'version', 'range': [431, 433], 'children': [{'type': 'Identifier', 'name': 'version', 'range': [431, 431], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [433, 433], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_state', 'range': [436, 442], 'children': [{'type': 'Identifier', 'name': 'submission_state', 'range': [436, 436], 'children': []}, {'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [438, 442], 'children': []}]}, {'type': 'Parameter', 'name': 'comments', 'range': [445, 451], 'children': [{'type': 'Identifier', 'name': 'comments', 'range': [445, 445], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str | None', 'range': [447, 451], 'children': []}]}, {'type': 'ReturnType', 'name': '-> prisma.models.Agents | None', 'range': [455, 463], 'children': []}, {'type': 'Docstring', 'name': '""" \\n     Update an existing agent entry in the database. \\n  \\n     Args: \\n         agent_id (str): The ID of the agent. \\n         version (int): The version of the agent. \\n         submission_state (prisma.enums.SubmissionStatus): The submission state of the agent. \\n     """', 'range': [466, 468], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [471, 572], 'children': [{'type': 'Block', 'name': '', 'range': [473, 538], 'children': [{'type': 'AssignmentExpression', 'name': 'agent = await prisma.models.Agents.prisma().update(where={"id": agent_id}, data={"version": version, "submissionStatus": submission_state, "submissionReviewDate": datetime.datetime.now(datetime.timezone.utc), "submissionReviewComments": comments})', 'range': [474, 537], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except prisma.errors.PrismaError as e', 'range': [543, 558], 'children': [{'type': 'RaiseStatement', 'name': 'raise AgentQueryError(f"Agent Update Failed Database query failed: {str(e)}")', 'range': [553, 558], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except Exception as e', 'range': [560, 571], 'children': [{'type': 'RaiseStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [566, 571], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return agent', 'range': [540, 542], 'children': []}]}]}
2025-01-08 10:29:41,923 - INFO - Completed main AST analysis flow
2025-01-08 10:29:41,924 - INFO - Successfully processed chunk
2025-01-08 10:29:45,207 - INFO - Step 4 result: {'type': 'Program', 'name': 'set_agent_featured', 'range': [1948, 2144], 'children': [{'type': 'FunctionDecl', 'name': 'set_agent_featured', 'range': [1948, 2144], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1948, 1952], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1949, 1952], 'children': []}, {'type': 'FunctionName', 'name': 'set_agent_featured', 'range': [1950, 1974], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1951, 1974], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [1953, 1955], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1955, 1956], 'children': []}, {'type': 'Parameter', 'name': 'is_active', 'range': [1957, 1959], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [1959, 1960], 'children': []}, {'type': 'DefaultValue', 'name': 'True', 'range': [1961, 1962], 'children': []}, {'type': 'Parameter', 'name': 'featured_categories', 'range': [1963, 1965], 'children': []}, {'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [1965, 1969], 'children': []}, {'type': 'DefaultValue', 'name': '["featured"]', 'range': [1970, 1972], 'children': []}]}, {'type': 'ReturnType', 'name': 'prisma.models.FeaturedAgent', 'range': [1975, 1982], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [1984, 1988], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [1990, 2131], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [1990, 1991], 'children': []}, {'type': 'Block', 'name': 'try_block', 'range': [1992, 2131], 'children': [{'type': 'Assignment', 'name': 'agent', 'range': [1993, 2015], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [1995, 1996], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.Agents.prisma().find_unique', 'range': [1996, 2015], 'children': [{'type': 'Argument', 'name': 'where', 'range': [2008, 2014], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [2017, 2028], 'children': [{'type': 'Condition', 'name': 'not agent', 'range': [2018, 2020], 'children': []}, {'type': 'Block', 'name': 'if_block', 'range': [2021, 2028], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2022, 2027], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2023, 2027], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'featured', 'range': [2030, 2110], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [2032, 2033], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.FeaturedAgent.prisma().upsert', 'range': [2033, 2110], 'children': [{'type': 'Argument', 'name': 'where', 'range': [2046, 2052], 'children': []}, {'type': 'Argument', 'name': 'data', 'range': [2055, 2106], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2111, 2113], 'children': [{'type': 'ReturnValue', 'name': 'featured', 'range': [2112, 2113], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2115, 2131], 'children': [{'type': 'Exception', 'name': 'PrismaError', 'range': [2116, 2120], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2121, 2131], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2125, 2130], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2126, 2130], 'children': []}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2132, 2144], 'children': [{'type': 'Exception', 'name': 'Exception', 'range': [2133, 2135], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2136, 2144], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2138, 2143], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2139, 2143], 'children': []}]}]}]}]}]}]}
2025-01-08 10:29:45,207 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:46,115 - INFO - Step 4 result: {'type': 'Program', 'name': 'remove_featured_category', 'range': [2438, 2616], 'children': [{'type': 'FunctionDecl', 'name': 'remove_featured_category', 'range': [2438, 2616], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2438, 2442], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2439, 2442], 'children': []}, {'type': 'Identifier', 'name': 'remove_featured_category', 'range': [2440, 2461], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2441, 2451], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2443, 2446], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2445, 2446], 'children': []}]}, {'type': 'Parameter', 'name': 'category', 'range': [2447, 2450], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2449, 2450], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [2452, 2461], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.models.FeaturedAgent|None', 'range': [2454, 2461], 'children': []}]}, {'type': 'Docstring', 'name': 'docstring', 'range': [2463, 2465], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2467, 2616], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [2467, 2616], 'children': [{'type': 'Block', 'name': 'try_body', 'range': [2469, 2585], 'children': [{'type': 'Comment', 'name': 'get the existing categories', 'range': [2470, 2475], 'children': []}, {'type': 'Assignment', 'name': 'featured_agent', 'range': [2476, 2511], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2478, 2511], 'children': [{'type': 'CallExpression', 'name': 'find_unique', 'range': [2489, 2510], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2494, 2498], 'children': []}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2503, 2507], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [2513, 2524], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [2514, 2515], 'children': []}, {'type': 'Block', 'name': 'consequent', 'range': [2517, 2524], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2518, 2523], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2519, 2523], 'children': []}]}]}]}, {'type': 'Comment', 'name': 'remove the category from the list', 'range': [2526, 2533], 'children': []}, {'type': 'ExpressionStatement', 'name': 'featured_agent.featuredCategories.remove', 'range': [2534, 2542], 'children': [{'type': 'CallExpression', 'name': 'remove', 'range': [2538, 2541], 'children': []}]}, {'type': 'Assignment', 'name': 'featured_agent', 'range': [2544, 2581], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2546, 2581], 'children': [{'type': 'CallExpression', 'name': 'update', 'range': [2557, 2580], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2562, 2566], 'children': []}, {'type': 'ObjectExpression', 'name': 'data', 'range': [2571, 2577], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2583, 2585], 'children': []}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2587, 2603], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2592, 2595], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2596, 2603], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2597, 2602], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2598, 2602], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2604, 2616], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [2605, 2608], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2609, 2616], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2610, 2615], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2611, 2615], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:46,116 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:46,732 - INFO - Step 4 result: {'type': 'Program', 'name': 'search_db', 'range': [1193, 1602], 'children': [{'type': 'FunctionDecl', 'name': 'search_db', 'range': [1193, 1602], 'children': [{'type': 'Parameter', 'name': 'query', 'range': [1198, 1200], 'children': []}, {'type': 'Parameter', 'name': 'page', 'range': [1203, 1207], 'children': []}, {'type': 'Parameter', 'name': 'page_size', 'range': [1210, 1214], 'children': []}, {'type': 'Parameter', 'name': 'categories', 'range': [1217, 1228], 'children': []}, {'type': 'Parameter', 'name': 'description_threshold', 'range': [1231, 1235], 'children': []}, {'type': 'Parameter', 'name': 'sort_by', 'range': [1238, 1242], 'children': []}, {'type': 'Parameter', 'name': 'sort_order', 'range': [1245, 1261], 'children': []}, {'type': 'Parameter', 'name': 'submission_status', 'range': [1264, 1278], 'children': []}, {'type': 'ReturnType', 'name': 'market.model.ListResponse[market.utils.extension_types.AgentsWithRank]', 'range': [1284, 1297], 'children': []}, {'type': 'Block', 'name': 'FunctionBody', 'range': [1299, 1602], 'children': [{'type': 'TryStatement', 'name': 'Try', 'range': [1312, 1602], 'children': [{'type': 'Block', 'name': 'TryBlock', 'range': [1314, 1572], 'children': [{'type': 'VariableDecl', 'name': 'offset', 'range': [1315, 1324], 'children': []}, {'type': 'VariableDecl', 'name': 'category_filter', 'range': [1326, 1329], 'children': []}, {'type': 'IfStatement', 'name': 'If', 'range': [1330, 1357], 'children': [{'type': 'Block', 'name': 'IfBlock', 'range': [1333, 1357], 'children': [{'type': 'VariableDecl', 'name': 'category_conditions', 'range': [1334, 1343], 'children': []}, {'type': 'AssignmentExpression', 'name': 'category_filter', 'range': [1345, 1357], 'children': []}]}]}, {'type': 'Comment', 'name': 'Construct the ORDER BY clause based on the sort_by parameter', 'range': [1359, 1369], 'children': []}, {'type': 'IfStatement', 'name': 'If', 'range': [1371, 1404], 'children': [{'type': 'Block', 'name': 'IfBlock', 'range': [1380, 1385], 'children': [{'type': 'VariableDecl', 'name': 'order_by_clause', 'range': [1381, 1385], 'children': []}]}, {'type': 'ElseIfStatement', 'name': 'Elif', 'range': [1386, 1397], 'children': [{'type': 'Block', 'name': 'ElseIfBlock', 'range': [1392, 1397], 'children': [{'type': 'VariableDecl', 'name': 'order_by_clause', 'range': [1393, 1397], 'children': []}]}]}, {'type': 'ElseStatement', 'name': 'Else', 'range': [1398, 1404], 'children': [{'type': 'Block', 'name': 'ElseBlock', 'range': [1400, 1404], 'children': [{'type': 'VariableDecl', 'name': 'order_by_clause', 'range': [1401, 1404], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'submission_status_filter', 'range': [1406, 1414], 'children': []}, {'type': 'VariableDecl', 'name': 'sql_query', 'range': [1416, 1432], 'children': []}, {'type': 'VariableDecl', 'name': 'results', 'range': [1434, 1465], 'children': []}, {'type': 'ReturnStatement', 'name': 'Return', 'range': [1528, 1571], 'children': []}]}, {'type': 'CatchStatement', 'name': 'Except', 'range': [1573, 1589], 'children': [{'type': 'Block', 'name': 'CatchBlock', 'range': [1582, 1589], 'children': [{'type': 'ThrowStatement', 'name': 'Raise', 'range': [1583, 1589], 'children': []}]}]}, {'type': 'CatchStatement', 'name': 'Except', 'range': [1590, 1602], 'children': [{'type': 'Block', 'name': 'CatchBlock', 'range': [1595, 1602], 'children': [{'type': 'ThrowStatement', 'name': 'Raise', 'range': [1596, 1602], 'children': []}]}]}]}]}]}, {'type': 'ClassDecl', 'name': 'CountResponse', 'range': [1467, 1479], 'children': [{'type': 'Property', 'name': 'count', 'range': [1476, 1478], 'children': []}]}]}
2025-01-08 10:29:46,732 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:51,939 - INFO - Step 4 result: {'type': 'Program', 'name': 'add_featured_category', 'range': [2617, 2725], 'children': [{'type': 'FunctionDecl', 'name': 'add_featured_category', 'range': [2617, 2725], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [2617, 2621], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [2618, 2621], 'children': []}, {'type': 'Identifier', 'name': 'add_featured_category', 'range': [2619, 2637], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2620, 2630], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2622, 2624], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2624, 2627], 'children': []}, {'type': 'Parameter', 'name': 'category', 'range': [2626, 2628], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2628, 2630], 'children': []}]}, {'type': 'ReturnType', 'name': '->', 'range': [2631, 2633], 'children': []}, {'type': 'ReturnTypeValue', 'name': 'prisma.models.FeaturedAgent|None', 'range': [2633, 2639], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [2642, 2644], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2646, 2725], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [2646, 2649], 'children': []}, {'type': 'Block', 'name': 'try_block', 'range': [2649, 2694], 'children': [{'type': 'Assignment', 'name': 'featured_agent', 'range': [2649, 2690], 'children': [{'type': 'Identifier', 'name': 'featured_agent', 'range': [2649, 2662], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [2651, 2655], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.FeaturedAgent.prisma().update', 'range': [2652, 2689], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [2663, 2689], 'children': [{'type': 'KeywordArgument', 'name': 'where', 'range': [2665, 2671], 'children': []}, {'type': 'KeywordArgument', 'name': 'data', 'range': [2674, 2686], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2692, 2694], 'children': [{'type': 'Identifier', 'name': 'featured_agent', 'range': [2693, 2694], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2696, 2712], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [2696, 2702], 'children': []}, {'type': 'Identifier', 'name': 'prisma.errors.PrismaError', 'range': [2697, 2701], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [2702, 2704], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2703, 2704], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2704, 2712], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2706, 2711], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [2707, 2711], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2708, 2711], 'children': [{'type': 'Literal', 'name': 'f"Database query failed: {str(e)}"', 'range': [2709, 2711], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2713, 2725], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [2713, 2717], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [2714, 2717], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [2715, 2717], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2716, 2717], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2717, 2725], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2719, 2724], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [2720, 2724], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2721, 2724], 'children': [{'type': 'Literal', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [2722, 2724], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:51,939 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:54,543 - INFO - Step 3 result: {'type': 'Program', 'name': 'create_agent_installed_event', 'range': [3165, 3268], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_agent_installed_event', 'range': [3165, 3268], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3165, 3169], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3166, 3169], 'children': []}, {'type': 'Identifier', 'name': 'create_agent_installed_event', 'range': [3167, 3191], 'children': []}, {'type': 'Parameter', 'name': 'event_data', 'range': [3170, 3176], 'children': [{'type': 'Identifier', 'name': 'event_data', 'range': [3170, 3176], 'children': []}, {'type': 'Type', 'name': 'market.model.AgentInstalledFromMarketplaceEventData', 'range': [3172, 3176], 'children': []}]}, {'type': 'Block', 'name': 'try', 'range': [3182, 3268], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [3182, 3185], 'children': []}, {'type': 'ExpressionStatement', 'name': 'await prisma.models.InstallTracker.prisma().create(data={...})', 'range': [3185, 3237], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [3185, 3190], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.InstallTracker.prisma().create', 'range': [3190, 3237], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.InstallTracker.prisma', 'range': [3190, 3193], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [3190, 3196], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [3197, 3202], 'children': []}, {'type': 'Identifier', 'name': 'InstallTracker', 'range': [3203, 3216], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [3217, 3222], 'children': []}]}, {'type': 'CallExpression', 'name': 'create', 'range': [3222, 3237], 'children': [{'type': 'Identifier', 'name': 'create', 'range': [3222, 3227], 'children': []}, {'type': 'ObjectExpression', 'name': 'data', 'range': [3228, 3235], 'children': [{'type': 'Property', 'name': 'installedAgentId', 'range': [3228, 3231], 'children': [{'type': 'Identifier', 'name': 'installedAgentId', 'range': [3228, 3243], 'children': []}, {'type': 'Identifier', 'name': 'event_data.installed_agent_id', 'range': [3244, 3261], 'children': []}]}, {'type': 'Property', 'name': 'marketplaceAgentId', 'range': [3231, 3234], 'children': [{'type': 'Identifier', 'name': 'marketplaceAgentId', 'range': [3231, 3248], 'children': []}, {'type': 'Identifier', 'name': 'event_data.marketplace_agent_id', 'range': [3249, 3266], 'children': []}]}, {'type': 'Property', 'name': 'installationLocation', 'range': [3234, 3235], 'children': [{'type': 'Identifier', 'name': 'installationLocation', 'range': [3234, 3253], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.enums.InstallationLocation', 'range': [3254, 3265], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [3254, 3259], 'children': []}, {'type': 'Identifier', 'name': 'enums', 'range': [3260, 3265], 'children': []}, {'type': 'Identifier', 'name': 'InstallationLocation', 'range': [3266, 3283], 'children': []}, {'type': 'Identifier', 'name': 'event_data.installation_location.name', 'range': [3284, 3307], 'children': []}]}]}]}]}]}]}, {'type': 'Block', 'name': 'except', 'range': [3239, 3268], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [3239, 3245], 'children': []}, {'type': 'Identifier', 'name': 'prisma.errors.PrismaError', 'range': [3245, 3261], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3263, 3264], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [3265, 3268], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [3265, 3270], 'children': []}, {'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3270, 3287], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [3270, 3284], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Database query failed: {str(e)}"', 'range': [3285, 3307], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [3299, 3302], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3303, 3304], 'children': []}]}]}]}]}, {'type': 'Block', 'name': 'except', 'range': [3256, 3268], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [3256, 3262], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [3262, 3271], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3273, 3274], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [3275, 3268], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [3275, 3280], 'children': []}, {'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3280, 3297], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [3280, 3294], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [3295, 3317], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [3309, 3312], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3313, 3314], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:54,543 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:59,415 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_not_featured_agents', 'range': [2812, 3020], 'children': [{'type': 'FunctionDecl', 'name': 'get_not_featured_agents', 'range': [2812, 3020], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2812, 2816], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2813, 2816], 'children': []}, {'type': 'Identifier', 'name': 'get_not_featured_agents', 'range': [2814, 2834], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2815, 2829], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [2817, 2821], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [2819, 2821], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [2823, 2827], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [2825, 2827], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'typing.List[prisma.models.Agents]', 'range': [2830, 2841], 'children': []}, {'type': 'Docstring', 'name': 'Retrieve a list of not featured agents from the database.', 'range': [2844, 2846], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2848, 3020], 'children': [{'type': 'Block', 'name': 'try_block', 'range': [2850, 2987], 'children': [{'type': 'Assignment', 'name': 'agents', 'range': [2851, 2863], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2853, 2859], 'children': [{'type': 'CallExpression', 'name': 'get_client', 'range': [2854, 2860], 'children': []}]}, {'type': 'CallExpression', 'name': 'query_raw', 'range': [2861, 2986], 'children': [{'type': 'StringLiteral', 'name': 'query', 'range': [2865, 2974], 'children': []}, {'type': 'Assignment', 'name': 'model', 'range': [2977, 2984], 'children': [{'type': 'Identifier', 'name': 'prisma.models.Agents', 'range': [2979, 2983], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2988, 2990], 'children': [{'type': 'Identifier', 'name': 'agents', 'range': [2989, 2990], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2991, 3007], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2992, 2996], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2999, 3007], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3001, 3006], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3002, 3006], 'children': [{'type': 'StringLiteral', 'name': 'Database query failed: {str(e)}', 'range': [3004, 3005], 'children': []}]}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [3008, 3020], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [3009, 3011], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [3012, 3020], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3014, 3019], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3015, 3019], 'children': [{'type': 'StringLiteral', 'name': 'Unexpected error occurred: {str(e)}', 'range': [3017, 3018], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:59,415 - INFO - Completed main AST analysis flow
2025-01-08 10:29:59,415 - INFO - Successfully processed chunk
2025-01-08 10:29:59,911 - INFO - Step 3 result: {'type': 'Program', 'name': 'create_agent_entry', 'range': [235, 420], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_agent_entry', 'range': [235, 420], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [235, 239], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [236, 239], 'children': []}, {'type': 'FunctionName', 'name': 'create_agent_entry', 'range': [237, 253], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [238, 299], 'children': [{'type': 'Parameter', 'name': 'name', 'range': [240, 243], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [242, 243], 'children': []}]}, {'type': 'Parameter', 'name': 'description', 'range': [245, 248], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [247, 248], 'children': []}]}, {'type': 'Parameter', 'name': 'author', 'range': [250, 253], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [252, 253], 'children': []}]}, {'type': 'Parameter', 'name': 'keywords', 'range': [255, 263], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.List[str]', 'range': [257, 263], 'children': []}]}, {'type': 'Parameter', 'name': 'categories', 'range': [265, 273], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.List[str]', 'range': [267, 273], 'children': []}]}, {'type': 'Parameter', 'name': 'graph', 'range': [275, 280], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.Json', 'range': [277, 280], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_state', 'range': [282, 297], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [284, 297], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [300, 301], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [302, 304], 'children': []}, {'type': 'TryBlock', 'name': 'try_block', 'range': [306, 406], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [306, 309], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [310, 384], 'children': [{'type': 'Assignment', 'name': 'assignment', 'range': [309, 384], 'children': [{'type': 'Variable', 'name': 'agent', 'range': [309, 314], 'children': []}, {'type': 'AwaitExpression', 'name': 'await_expression', 'range': [311, 384], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [312, 384], 'children': [{'type': 'MemberExpression', 'name': 'member_expression', 'range': [312, 319], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [312, 318], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [313, 319], 'children': []}, {'type': 'Identifier', 'name': 'Agents', 'range': [314, 320], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [317, 323], 'children': []}]}, {'type': 'CallExpression', 'name': 'call_expression', 'range': [319, 384], 'children': [{'type': 'Identifier', 'name': 'create', 'range': [322, 328], 'children': []}, {'type': 'ObjectExpression', 'name': 'object_expression', 'range': [324, 383], 'children': [{'type': 'Property', 'name': 'data', 'range': [325, 381], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [327, 381], 'children': [{'type': 'Property', 'name': 'name', 'range': [329, 332], 'children': [{'type': 'Identifier', 'name': 'name', 'range': [331, 332], 'children': []}]}, {'type': 'Property', 'name': 'description', 'range': [334, 337], 'children': [{'type': 'Identifier', 'name': 'description', 'range': [336, 337], 'children': []}]}, {'type': 'Property', 'name': 'author', 'range': [339, 342], 'children': [{'type': 'Identifier', 'name': 'author', 'range': [341, 342], 'children': []}]}, {'type': 'Property', 'name': 'keywords', 'range': [344, 347], 'children': [{'type': 'Identifier', 'name': 'keywords', 'range': [346, 347], 'children': []}]}, {'type': 'Property', 'name': 'categories', 'range': [349, 352], 'children': [{'type': 'Identifier', 'name': 'categories', 'range': [351, 352], 'children': []}]}, {'type': 'Property', 'name': 'graph', 'range': [354, 357], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [356, 357], 'children': []}]}, {'type': 'Property', 'name': 'AnalyticsTracker', 'range': [359, 373], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [361, 373], 'children': [{'type': 'Property', 'name': 'create', 'range': [362, 372], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [364, 372], 'children': [{'type': 'Property', 'name': 'downloads', 'range': [365, 368], 'children': [{'type': 'Literal', 'name': '0', 'range': [367, 368], 'children': []}]}, {'type': 'Property', 'name': 'views', 'range': [369, 372], 'children': [{'type': 'Literal', 'name': '0', 'range': [371, 372], 'children': []}]}]}]}]}]}, {'type': 'Property', 'name': 'submissionStatus', 'range': [376, 379], 'children': [{'type': 'Identifier', 'name': 'submission_state', 'range': [378, 379], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return_statement', 'range': [386, 388], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [387, 388], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [390, 406], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [390, 396], 'children': []}, {'type': 'ExceptionType', 'name': 'PrismaError', 'range': [391, 396], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [396, 398], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [397, 398], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [399, 406], 'children': [{'type': 'RaiseStatement', 'name': 'raise_statement', 'range': [400, 405], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [401, 405], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [401, 415], 'children': []}, {'type': 'TemplateLiteral', 'name': 'template_literal', 'range': [403, 405], 'children': [{'type': 'TemplateElement', 'name': 'template_element', 'range': [404, 405], 'children': []}]}]}]}]}]}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [407, 419], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [407, 411], 'children': []}, {'type': 'ExceptionType', 'name': 'Exception', 'range': [408, 411], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [411, 413], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [412, 413], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [414, 419], 'children': [{'type': 'RaiseStatement', 'name': 'raise_statement', 'range': [413, 418], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [414, 418], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [414, 428], 'children': []}, {'type': 'TemplateLiteral', 'name': 'template_literal', 'range': [416, 418], 'children': [{'type': 'TemplateElement', 'name': 'template_element', 'range': [417, 418], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:29:59,911 - INFO - Starting Step 4: AST normalization
2025-01-08 10:30:04,911 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_agent_featured', 'range': [2726, 2811], 'children': [{'type': 'FunctionDecl', 'name': 'get_agent_featured', 'range': [2726, 2811], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [2726, 2730], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [2727, 2730], 'children': []}, {'type': 'FunctionName', 'name': 'get_agent_featured', 'range': [2728, 2744], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2729, 2733], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2730, 2733], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2731, 2733], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [2734, 2743], 'children': [{'type': 'Type', 'name': 'prisma.models.FeaturedAgent', 'range': [2736, 2740], 'children': []}, {'type': 'UnionType', 'name': '|', 'range': [2741, 2742], 'children': []}, {'type': 'Type', 'name': 'None', 'range': [2742, 2743], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [2744, 2811], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [2745, 2747], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2749, 2811], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [2751, 2778], 'children': [{'type': 'AssignmentExpression', 'name': 'featured_agent', 'range': [2752, 2777], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2754, 2777], 'children': [{'type': 'CallExpression', 'name': 'find_unique', 'range': [2765, 2777], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.FeaturedAgent.prisma', 'range': [2755, 2764], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2766, 2777], 'children': [{'type': 'KeywordArgument', 'name': 'where', 'range': [2768, 2774], 'children': [{'type': 'ObjectExpression', 'name': 'object', 'range': [2770, 2774], 'children': [{'type': 'Property', 'name': 'agentId', 'range': [2771, 2773], 'children': []}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2779, 2781], 'children': [{'type': 'Identifier', 'name': 'featured_agent', 'range': [2780, 2781], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2782, 2798], 'children': [{'type': 'ExceptionType', 'name': 'PrismaError', 'range': [2783, 2787], 'children': []}, {'type': 'Alias', 'name': 'e', 'range': [2788, 2789], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [2792, 2798], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2793, 2798], 'children': [{'type': 'TemplateLiteral', 'name': 'f-string', 'range': [2795, 2797], 'children': []}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2799, 2811], 'children': [{'type': 'ExceptionType', 'name': 'Exception', 'range': [2800, 2801], 'children': []}, {'type': 'Alias', 'name': 'e', 'range': [2802, 2803], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [2805, 2811], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2806, 2811], 'children': [{'type': 'TemplateLiteral', 'name': 'f-string', 'range': [2808, 2810], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:30:04,911 - INFO - Completed main AST analysis flow
2025-01-08 10:30:04,916 - INFO - Successfully processed chunk
2025-01-08 10:30:07,937 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_top_agents_by_downloads', 'range': [1603, 1947], 'children': [{'type': 'FunctionDecl', 'name': 'get_top_agents_by_downloads', 'range': [1603, 1947], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1603, 1607], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1604, 1607], 'children': []}, {'type': 'Identifier', 'name': 'get_top_agents_by_downloads', 'range': [1605, 1639], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [1606, 1639], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [1608, 1612], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [1609, 1612], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [1615, 1619], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [1616, 1619], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [1622, 1636], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [1623, 1636], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'market.model.ListResponse[prisma.models.AnalyticsTracker]', 'range': [1640, 1653], 'children': []}, {'type': 'Block', 'name': '', 'range': [1655, 1947], 'children': [{'type': 'TryStatement', 'name': '', 'range': [1660, 1947], 'children': [{'type': 'Block', 'name': '', 'range': [1662, 1888], 'children': [{'type': 'ExpressionStatement', 'name': 'skip = (page - 1) * page_size', 'range': [1667, 1676], 'children': []}, {'type': 'TryStatement', 'name': '', 'range': [1683, 1787], 'children': [{'type': 'Block', 'name': '', 'range': [1685, 1770], 'children': [{'type': 'ExpressionStatement', 'name': 'analytics = await prisma.models.AnalyticsTracker.prisma().find_many(...)', 'range': [1708, 1770], 'children': []}]}, {'type': 'CatchClause', 'name': 'PrismaError', 'range': [1771, 1787], 'children': [{'type': 'Block', 'name': '', 'range': [1779, 1787], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [1781, 1787], 'children': []}]}]}]}, {'type': 'TryStatement', 'name': '', 'range': [1789, 1843], 'children': [{'type': 'Block', 'name': '', 'range': [1791, 1826], 'children': [{'type': 'ExpressionStatement', 'name': 'total_count = await prisma.models.AnalyticsTracker.prisma().count(...)', 'range': [1792, 1826], 'children': []}]}, {'type': 'CatchClause', 'name': 'PrismaError', 'range': [1827, 1843], 'children': [{'type': 'Block', 'name': '', 'range': [1835, 1843], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [1837, 1843], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return market.model.ListResponse(...)', 'range': [1845, 1888], 'children': []}]}, {'type': 'CatchClause', 'name': 'AgentQueryError', 'range': [1890, 1910], 'children': [{'type': 'Block', 'name': '', 'range': [1894, 1910], 'children': [{'type': 'ThrowStatement', 'name': 'raise e from e', 'range': [1906, 1910], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'ValueError', 'range': [1911, 1925], 'children': [{'type': 'Block', 'name': '', 'range': [1915, 1925], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Invalid input parameter: {str(e)}") from e', 'range': [1917, 1925], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'Exception', 'range': [1926, 1947], 'children': [{'type': 'Block', 'name': '', 'range': [1930, 1947], 'children': [{'type': 'ThrowStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}") from e', 'range': [1939, 1947], 'children': []}]}]}]}]}]}]}
2025-01-08 10:30:07,937 - INFO - Completed main AST analysis flow
2025-01-08 10:30:07,939 - INFO - Successfully processed chunk
2025-01-08 10:30:15,951 - INFO - Step 5 result: {'type': 'Program', 'name': 'search_db', 'range': [1193, 1602], 'children': [{'type': 'FunctionDecl', 'name': 'search_db', 'range': [1193, 1602], 'children': [{'type': 'Parameter', 'name': 'query', 'range': [1198, 1200], 'children': []}, {'type': 'Parameter', 'name': 'page', 'range': [1203, 1207], 'children': []}, {'type': 'Parameter', 'name': 'page_size', 'range': [1210, 1214], 'children': []}, {'type': 'Parameter', 'name': 'categories', 'range': [1217, 1228], 'children': []}, {'type': 'Parameter', 'name': 'description_threshold', 'range': [1231, 1235], 'children': []}, {'type': 'Parameter', 'name': 'sort_by', 'range': [1238, 1242], 'children': []}, {'type': 'Parameter', 'name': 'sort_order', 'range': [1245, 1261], 'children': []}, {'type': 'Parameter', 'name': 'submission_status', 'range': [1264, 1278], 'children': []}, {'type': 'ReturnType', 'name': 'market.model.ListResponse[market.utils.extension_types.AgentsWithRank]', 'range': [1284, 1297], 'children': []}, {'type': 'Block', 'name': 'FunctionBody', 'range': [1299, 1602], 'children': [{'type': 'TryStatement', 'name': 'Try', 'range': [1312, 1602], 'children': [{'type': 'Block', 'name': 'TryBlock', 'range': [1314, 1572], 'children': [{'type': 'VariableDecl', 'name': 'offset', 'range': [1315, 1324], 'children': []}, {'type': 'VariableDecl', 'name': 'category_filter', 'range': [1326, 1329], 'children': []}, {'type': 'IfStatement', 'name': 'If', 'range': [1330, 1357], 'children': [{'type': 'Block', 'name': 'IfBlock', 'range': [1333, 1357], 'children': [{'type': 'VariableDecl', 'name': 'category_conditions', 'range': [1334, 1343], 'children': []}, {'type': 'AssignmentExpression', 'name': 'category_filter', 'range': [1345, 1357], 'children': []}]}]}, {'type': 'Comment', 'name': 'Construct the ORDER BY clause based on the sort_by parameter', 'range': [1359, 1369], 'children': []}, {'type': 'IfStatement', 'name': 'If', 'range': [1371, 1404], 'children': [{'type': 'Block', 'name': 'IfBlock', 'range': [1380, 1385], 'children': [{'type': 'VariableDecl', 'name': 'order_by_clause', 'range': [1381, 1385], 'children': []}]}, {'type': 'ElseIfStatement', 'name': 'Elif', 'range': [1386, 1397], 'children': [{'type': 'Block', 'name': 'ElseIfBlock', 'range': [1392, 1397], 'children': [{'type': 'VariableDecl', 'name': 'order_by_clause', 'range': [1393, 1397], 'children': []}]}]}, {'type': 'ElseStatement', 'name': 'Else', 'range': [1398, 1404], 'children': [{'type': 'Block', 'name': 'ElseBlock', 'range': [1400, 1404], 'children': [{'type': 'VariableDecl', 'name': 'order_by_clause', 'range': [1401, 1404], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'submission_status_filter', 'range': [1406, 1414], 'children': []}, {'type': 'VariableDecl', 'name': 'sql_query', 'range': [1416, 1432], 'children': []}, {'type': 'VariableDecl', 'name': 'results', 'range': [1434, 1465], 'children': []}, {'type': 'ReturnStatement', 'name': 'Return', 'range': [1528, 1571], 'children': []}]}, {'type': 'CatchStatement', 'name': 'Except', 'range': [1573, 1589], 'children': [{'type': 'Block', 'name': 'CatchBlock', 'range': [1582, 1589], 'children': [{'type': 'ThrowStatement', 'name': 'Raise', 'range': [1583, 1589], 'children': []}]}]}, {'type': 'CatchStatement', 'name': 'Except', 'range': [1590, 1602], 'children': [{'type': 'Block', 'name': 'CatchBlock', 'range': [1595, 1602], 'children': [{'type': 'ThrowStatement', 'name': 'Raise', 'range': [1596, 1602], 'children': []}]}]}]}]}]}, {'type': 'ClassDecl', 'name': 'CountResponse', 'range': [1467, 1479], 'children': [{'type': 'Property', 'name': 'count', 'range': [1476, 1478], 'children': []}]}]}
2025-01-08 10:30:15,951 - INFO - Completed main AST analysis flow
2025-01-08 10:30:15,954 - INFO - Successfully processed chunk
2025-01-08 10:30:16,866 - INFO - Step 5 result: {'type': 'Program', 'name': 'set_agent_featured', 'range': [1948, 2144], 'children': [{'type': 'FunctionDecl', 'name': 'set_agent_featured', 'range': [1948, 2144], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1948, 1952], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1949, 1952], 'children': []}, {'type': 'FunctionName', 'name': 'set_agent_featured', 'range': [1950, 1974], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1951, 1974], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [1953, 1955], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1955, 1956], 'children': []}, {'type': 'Parameter', 'name': 'is_active', 'range': [1957, 1959], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [1959, 1960], 'children': []}, {'type': 'DefaultValue', 'name': 'True', 'range': [1961, 1962], 'children': []}, {'type': 'Parameter', 'name': 'featured_categories', 'range': [1963, 1965], 'children': []}, {'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [1965, 1969], 'children': []}, {'type': 'DefaultValue', 'name': '["featured"]', 'range': [1970, 1972], 'children': []}]}, {'type': 'ReturnType', 'name': 'prisma.models.FeaturedAgent', 'range': [1975, 1982], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [1984, 1988], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [1990, 2131], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [1990, 1991], 'children': []}, {'type': 'Block', 'name': 'try_block', 'range': [1992, 2131], 'children': [{'type': 'Assignment', 'name': 'agent', 'range': [1993, 2015], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [1995, 1996], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.Agents.prisma().find_unique', 'range': [1996, 2015], 'children': [{'type': 'Argument', 'name': 'where', 'range': [2008, 2014], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [2017, 2028], 'children': [{'type': 'Condition', 'name': 'not agent', 'range': [2018, 2020], 'children': []}, {'type': 'Block', 'name': 'if_block', 'range': [2021, 2028], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2022, 2027], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2023, 2027], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'featured', 'range': [2030, 2110], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [2032, 2033], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.FeaturedAgent.prisma().upsert', 'range': [2033, 2110], 'children': [{'type': 'Argument', 'name': 'where', 'range': [2046, 2052], 'children': []}, {'type': 'Argument', 'name': 'data', 'range': [2055, 2106], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2111, 2113], 'children': [{'type': 'ReturnValue', 'name': 'featured', 'range': [2112, 2113], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2115, 2131], 'children': [{'type': 'Exception', 'name': 'PrismaError', 'range': [2116, 2120], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2121, 2131], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2125, 2130], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2126, 2130], 'children': []}]}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [2132, 2144], 'children': [{'type': 'Exception', 'name': 'Exception', 'range': [2133, 2135], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2136, 2144], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2138, 2143], 'children': [{'type': 'Exception', 'name': 'AgentQueryError', 'range': [2139, 2143], 'children': []}]}]}]}]}]}]}
2025-01-08 10:30:16,866 - INFO - Completed main AST analysis flow
2025-01-08 10:30:16,868 - INFO - Successfully processed chunk
2025-01-08 10:30:17,748 - INFO - Step 5 result: {'type': 'Program', 'name': 'remove_featured_category', 'range': [2438, 2616], 'children': [{'type': 'FunctionDecl', 'name': 'remove_featured_category', 'range': [2438, 2616], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2438, 2442], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2439, 2442], 'children': []}, {'type': 'Identifier', 'name': 'remove_featured_category', 'range': [2440, 2461], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2441, 2451], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2443, 2446], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2445, 2446], 'children': []}]}, {'type': 'Parameter', 'name': 'category', 'range': [2447, 2450], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2449, 2450], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [2452, 2461], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.models.FeaturedAgent|None', 'range': [2454, 2461], 'children': []}]}, {'type': 'Docstring', 'name': 'docstring', 'range': [2463, 2465], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2467, 2616], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [2467, 2616], 'children': [{'type': 'Block', 'name': 'try_body', 'range': [2469, 2585], 'children': [{'type': 'Comment', 'name': 'get the existing categories', 'range': [2470, 2475], 'children': []}, {'type': 'Assignment', 'name': 'featured_agent', 'range': [2476, 2511], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2478, 2511], 'children': [{'type': 'CallExpression', 'name': 'find_unique', 'range': [2489, 2510], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2494, 2498], 'children': []}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2503, 2507], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [2513, 2524], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [2514, 2515], 'children': []}, {'type': 'Block', 'name': 'consequent', 'range': [2517, 2524], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2518, 2523], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2519, 2523], 'children': []}]}]}]}, {'type': 'Comment', 'name': 'remove the category from the list', 'range': [2526, 2533], 'children': []}, {'type': 'ExpressionStatement', 'name': 'featured_agent.featuredCategories.remove', 'range': [2534, 2542], 'children': [{'type': 'CallExpression', 'name': 'remove', 'range': [2538, 2541], 'children': []}]}, {'type': 'Assignment', 'name': 'featured_agent', 'range': [2544, 2581], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2546, 2581], 'children': [{'type': 'CallExpression', 'name': 'update', 'range': [2557, 2580], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2562, 2566], 'children': []}, {'type': 'ObjectExpression', 'name': 'data', 'range': [2571, 2577], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2583, 2585], 'children': []}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2587, 2603], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2592, 2595], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2596, 2603], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2597, 2602], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2598, 2602], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2604, 2616], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [2605, 2608], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [2609, 2616], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2610, 2615], 'children': [{'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [2611, 2615], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:30:17,748 - INFO - Completed main AST analysis flow
2025-01-08 10:30:17,750 - INFO - Successfully processed chunk
2025-01-08 10:30:22,875 - INFO - Step 5 result: {'type': 'Program', 'name': 'add_featured_category', 'range': [2617, 2725], 'children': [{'type': 'FunctionDecl', 'name': 'add_featured_category', 'range': [2617, 2725], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [2617, 2621], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [2618, 2621], 'children': []}, {'type': 'Identifier', 'name': 'add_featured_category', 'range': [2619, 2637], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2620, 2630], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [2622, 2624], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2624, 2627], 'children': []}, {'type': 'Parameter', 'name': 'category', 'range': [2626, 2628], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2628, 2630], 'children': []}]}, {'type': 'ReturnType', 'name': '->', 'range': [2631, 2633], 'children': []}, {'type': 'ReturnTypeValue', 'name': 'prisma.models.FeaturedAgent|None', 'range': [2633, 2639], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [2642, 2644], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2646, 2725], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [2646, 2649], 'children': []}, {'type': 'Block', 'name': 'try_block', 'range': [2649, 2694], 'children': [{'type': 'Assignment', 'name': 'featured_agent', 'range': [2649, 2690], 'children': [{'type': 'Identifier', 'name': 'featured_agent', 'range': [2649, 2662], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [2651, 2655], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.FeaturedAgent.prisma().update', 'range': [2652, 2689], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [2663, 2689], 'children': [{'type': 'KeywordArgument', 'name': 'where', 'range': [2665, 2671], 'children': []}, {'type': 'KeywordArgument', 'name': 'data', 'range': [2674, 2686], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2692, 2694], 'children': [{'type': 'Identifier', 'name': 'featured_agent', 'range': [2693, 2694], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2696, 2712], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [2696, 2702], 'children': []}, {'type': 'Identifier', 'name': 'prisma.errors.PrismaError', 'range': [2697, 2701], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [2702, 2704], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2703, 2704], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2704, 2712], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2706, 2711], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [2707, 2711], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2708, 2711], 'children': [{'type': 'Literal', 'name': 'f"Database query failed: {str(e)}"', 'range': [2709, 2711], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2713, 2725], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [2713, 2717], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [2714, 2717], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [2715, 2717], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2716, 2717], 'children': []}, {'type': 'Block', 'name': 'except_block', 'range': [2717, 2725], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [2719, 2724], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [2720, 2724], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [2721, 2724], 'children': [{'type': 'Literal', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [2722, 2724], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:30:22,875 - INFO - Completed main AST analysis flow
2025-01-08 10:30:22,876 - INFO - Successfully processed chunk
2025-01-08 10:30:23,691 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_agents', 'range': [574, 1069], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_agents', 'range': [574, 1069], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [574, 578], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [575, 578], 'children': []}, {'type': 'FunctionName', 'name': 'get_agents', 'range': [576, 585], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [577, 679], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [579, 583], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [580, 583], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [586, 590], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [587, 590], 'children': []}]}, {'type': 'Parameter', 'name': 'name', 'range': [593, 599], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [594, 599], 'children': []}]}, {'type': 'Parameter', 'name': 'keyword', 'range': [602, 608], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [603, 608], 'children': []}]}, {'type': 'Parameter', 'name': 'category', 'range': [611, 617], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [612, 617], 'children': []}]}, {'type': 'Parameter', 'name': 'description', 'range': [620, 626], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [621, 626], 'children': []}]}, {'type': 'Parameter', 'name': 'description_threshold', 'range': [629, 633], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [630, 633], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [636, 651], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [637, 651], 'children': []}]}, {'type': 'Parameter', 'name': 'sort_by', 'range': [653, 657], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [654, 657], 'children': []}]}, {'type': 'Parameter', 'name': 'sort_order', 'range': [660, 676], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.Literal["desc"] | typing.Literal["asc"]', 'range': [661, 676], 'children': []}]}]}, {'type': 'ReturnTypeAnnotation', 'name': 'return_type', 'range': [680, 681], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [682, 1069], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [682, 691], 'children': []}, {'type': 'TryStatement', 'name': 'try_statement', 'range': [694, 1069], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [694, 1017], 'children': [{'type': 'Comment', 'name': 'Define the base query', 'range': [697, 702], 'children': []}, {'type': 'VariableDeclaration', 'name': 'query', 'range': [703, 706], 'children': []}, {'type': 'Comment', 'name': 'Add optional filters', 'range': [709, 713], 'children': []}, {'type': 'IfStatement', 'name': 'if_name', 'range': [714, 732], 'children': [{'type': 'Condition', 'name': 'name', 'range': [715, 716], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [717, 732], 'children': [{'type': 'AssignmentExpression', 'name': 'query["name"]', 'range': [718, 731], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_keyword', 'range': [733, 747], 'children': [{'type': 'Condition', 'name': 'keyword', 'range': [734, 735], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [736, 747], 'children': [{'type': 'AssignmentExpression', 'name': 'query["keywords"]', 'range': [737, 746], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_category', 'range': [748, 762], 'children': [{'type': 'Condition', 'name': 'category', 'range': [749, 750], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [751, 762], 'children': [{'type': 'AssignmentExpression', 'name': 'query["categories"]', 'range': [752, 761], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': 'query["submissionStatus"]', 'range': [763, 770], 'children': []}, {'type': 'Comment', 'name': 'Define sorting', 'range': [772, 775], 'children': []}, {'type': 'VariableDeclaration', 'name': 'order', 'range': [776, 783], 'children': []}, {'type': 'Comment', 'name': 'Calculate pagination', 'range': [785, 788], 'children': []}, {'type': 'VariableDeclaration', 'name': 'skip', 'range': [789, 798], 'children': []}, {'type': 'Comment', 'name': 'Execute the query', 'range': [800, 804], 'children': []}, {'type': 'TryStatement', 'name': 'try_execute_query', 'range': [805, 870], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [805, 853], 'children': [{'type': 'VariableDeclaration', 'name': 'agents', 'range': [808, 852], 'children': []}]}, {'type': 'CatchClause', 'name': 'catch_prisma_error', 'range': [854, 870], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [860, 861], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [862, 870], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [864, 869], 'children': []}]}]}]}, {'type': 'Comment', 'name': 'Apply fuzzy search on description if provided', 'range': [872, 880], 'children': []}, {'type': 'IfStatement', 'name': 'if_description', 'range': [881, 960], 'children': [{'type': 'Condition', 'name': 'description', 'range': [882, 883], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [884, 960], 'children': [{'type': 'TryStatement', 'name': 'try_fuzzy_search', 'range': [885, 959], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [885, 947], 'children': [{'type': 'VariableDeclaration', 'name': 'filtered_agents', 'range': [888, 892], 'children': []}, {'type': 'ForStatement', 'name': 'for_agent_in_agents', 'range': [893, 943], 'children': [{'type': 'Initialization', 'name': 'agent', 'range': [894, 895], 'children': []}, {'type': 'Condition', 'name': 'agents', 'range': [896, 897], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [898, 943], 'children': [{'type': 'IfStatement', 'name': 'if_fuzzy_match', 'range': [899, 935], 'children': [{'type': 'Condition', 'name': 'fuzzy_match', 'range': [900, 933], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [936, 943], 'children': [{'type': 'ExpressionStatement', 'name': 'filtered_agents.append(agent)', 'range': [937, 942], 'children': []}]}]}]}]}, {'type': 'AssignmentExpression', 'name': 'agents', 'range': [944, 946], 'children': []}]}, {'type': 'CatchClause', 'name': 'catch_AttributeError', 'range': [949, 959], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [950, 951], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [952, 959], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [954, 958], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': 'Get total count for pagination info', 'range': [962, 969], 'children': []}, {'type': 'VariableDeclaration', 'name': 'total_count', 'range': [970, 976], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [978, 1015], 'children': [{'type': 'ObjectExpression', 'name': 'return_object', 'range': [979, 1015], 'children': [{'type': 'Property', 'name': 'agents', 'range': [981, 983], 'children': []}, {'type': 'Property', 'name': 'total_count', 'range': [986, 988], 'children': []}, {'type': 'Property', 'name': 'page', 'range': [991, 993], 'children': []}, {'type': 'Property', 'name': 'page_size', 'range': [996, 998], 'children': []}, {'type': 'Property', 'name': 'total_pages', 'range': [1001, 1013], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'catch_AgentQueryError', 'range': [1018, 1036], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1020, 1021], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1022, 1036], 'children': [{'type': 'Comment', 'name': 'Log the error or handle it as needed', 'range': [1024, 1033], 'children': []}, {'type': 'ThrowStatement', 'name': 'throw_e', 'range': [1034, 1035], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'catch_ValueError', 'range': [1037, 1049], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1039, 1040], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1041, 1049], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [1043, 1048], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'catch_Exception', 'range': [1050, 1069], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1052, 1053], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1054, 1069], 'children': [{'type': 'Comment', 'name': 'Catch any other unexpected exceptions', 'range': [1056, 1062], 'children': []}, {'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [1063, 1068], 'children': []}]}]}]}]}]}]}
2025-01-08 10:30:23,691 - INFO - Starting Step 4: AST normalization
2025-01-08 10:30:23,706 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_agent_details', 'range': [1070, 1192], 'children': [{'type': 'FunctionDecl', 'name': 'get_agent_details', 'range': [1070, 1192], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1070, 1070], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1071, 1071], 'children': []}, {'type': 'Identifier', 'name': 'get_agent_details', 'range': [1072, 1072], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1073, 1085], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [1074, 1076], 'children': [{'type': 'Identifier', 'name': 'agent_id', 'range': [1074, 1074], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1076, 1076], 'children': []}]}, {'type': 'Parameter', 'name': 'version', 'range': [1078, 1084], 'children': [{'type': 'Identifier', 'name': 'version', 'range': [1078, 1078], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int | None', 'range': [1080, 1082], 'children': []}, {'type': 'Literal', 'name': 'None', 'range': [1084, 1084], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [1086, 1086], 'children': []}, {'type': 'BlockStatement', 'name': 'body', 'range': [1087, 1192], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [1088, 1090], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [1092, 1192], 'children': [{'type': 'BlockStatement', 'name': 'try_block', 'range': [1093, 1162], 'children': [{'type': 'AssignmentExpression', 'name': 'query', 'range': [1095, 1101], 'children': [{'type': 'Identifier', 'name': 'query', 'range': [1095, 1095], 'children': []}, {'type': 'ObjectExpression', 'name': 'dictionary', 'range': [1097, 1101], 'children': [{'type': 'Property', 'name': 'id', 'range': [1098, 1100], 'children': [{'type': 'Identifier', 'name': 'id', 'range': [1098, 1098], 'children': []}, {'type': 'Identifier', 'name': 'agent_id', 'range': [1100, 1100], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1103, 1120], 'children': [{'type': 'BinaryExpression', 'name': 'version is not None', 'range': [1104, 1107], 'children': []}, {'type': 'BlockStatement', 'name': 'if_block', 'range': [1108, 1120], 'children': [{'type': 'AssignmentExpression', 'name': 'query["version"]', 'range': [1110, 1115], 'children': [{'type': 'Identifier', 'name': 'query', 'range': [1110, 1110], 'children': []}, {'type': 'Literal', 'name': 'version', 'range': [1112, 1112], 'children': []}, {'type': 'Identifier', 'name': 'version', 'range': [1115, 1115], 'children': []}]}]}]}, {'type': 'AssignmentExpression', 'name': 'agent', 'range': [1122, 1145], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [1122, 1122], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1124, 1124], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.Agents.prisma().find_first', 'range': [1125, 1140], 'children': [{'type': 'MemberExpression', 'name': 'prisma', 'range': [1125, 1125], 'children': []}, {'type': 'MemberExpression', 'name': 'models', 'range': [1127, 1127], 'children': []}, {'type': 'MemberExpression', 'name': 'Agents', 'range': [1129, 1129], 'children': []}, {'type': 'CallExpression', 'name': 'prisma', 'range': [1131, 1133], 'children': []}, {'type': 'CallExpression', 'name': 'find_first', 'range': [1135, 1140], 'children': [{'type': 'Argument', 'name': 'where', 'range': [1137, 1139], 'children': [{'type': 'Identifier', 'name': 'query', 'range': [1139, 1139], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1147, 1157], 'children': [{'type': 'UnaryExpression', 'name': 'not agent', 'range': [1148, 1149], 'children': []}, {'type': 'BlockStatement', 'name': 'if_block', 'range': [1150, 1157], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1152, 1156], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [1153, 1153], 'children': []}, {'type': 'Literal', 'name': '"Agent not found"', 'range': [1155, 1155], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1159, 1161], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [1160, 1160], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1163, 1179], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1168, 1168], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1170, 1170], 'children': []}, {'type': 'BlockStatement', 'name': 'except_block', 'range': [1171, 1179], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1173, 1178], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [1174, 1174], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Database query failed: {str(e)}"', 'range': [1176, 1177], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1180, 1192], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1181, 1181], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1183, 1183], 'children': []}, {'type': 'BlockStatement', 'name': 'except_block', 'range': [1184, 1192], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1186, 1191], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [1187, 1187], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [1189, 1190], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:30:23,706 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:30:34,533 - INFO - Step 4 result: {'type': 'Program', 'name': 'create_agent_installed_event', 'range': [3165, 3268], 'children': [{'type': 'FunctionDecl', 'name': 'create_agent_installed_event', 'range': [3165, 3268], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3165, 3169], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3166, 3169], 'children': []}, {'type': 'Identifier', 'name': 'create_agent_installed_event', 'range': [3167, 3191], 'children': []}, {'type': 'Parameter', 'name': 'event_data', 'range': [3170, 3176], 'children': [{'type': 'Identifier', 'name': 'event_data', 'range': [3170, 3176], 'children': []}, {'type': 'Type', 'name': 'market.model.AgentInstalledFromMarketplaceEventData', 'range': [3172, 3176], 'children': []}]}, {'type': 'Block', 'name': 'try', 'range': [3182, 3268], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [3182, 3185], 'children': []}, {'type': 'ExpressionStatement', 'name': 'await prisma.models.InstallTracker.prisma().create(data={...})', 'range': [3185, 3237], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [3185, 3190], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.InstallTracker.prisma().create', 'range': [3190, 3237], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.InstallTracker.prisma', 'range': [3190, 3193], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [3190, 3196], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [3197, 3202], 'children': []}, {'type': 'Identifier', 'name': 'InstallTracker', 'range': [3203, 3216], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [3217, 3222], 'children': []}]}, {'type': 'CallExpression', 'name': 'create', 'range': [3222, 3237], 'children': [{'type': 'Identifier', 'name': 'create', 'range': [3222, 3227], 'children': []}, {'type': 'ObjectExpression', 'name': 'data', 'range': [3228, 3235], 'children': [{'type': 'Property', 'name': 'installedAgentId', 'range': [3228, 3231], 'children': [{'type': 'Identifier', 'name': 'installedAgentId', 'range': [3228, 3243], 'children': []}, {'type': 'Identifier', 'name': 'event_data.installed_agent_id', 'range': [3244, 3261], 'children': []}]}, {'type': 'Property', 'name': 'marketplaceAgentId', 'range': [3231, 3234], 'children': [{'type': 'Identifier', 'name': 'marketplaceAgentId', 'range': [3231, 3248], 'children': []}, {'type': 'Identifier', 'name': 'event_data.marketplace_agent_id', 'range': [3249, 3266], 'children': []}]}, {'type': 'Property', 'name': 'installationLocation', 'range': [3234, 3235], 'children': [{'type': 'Identifier', 'name': 'installationLocation', 'range': [3234, 3253], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.enums.InstallationLocation', 'range': [3254, 3265], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [3254, 3259], 'children': []}, {'type': 'Identifier', 'name': 'enums', 'range': [3260, 3265], 'children': []}, {'type': 'Identifier', 'name': 'InstallationLocation', 'range': [3266, 3283], 'children': []}, {'type': 'Identifier', 'name': 'event_data.installation_location.name', 'range': [3284, 3307], 'children': []}]}]}]}]}]}]}, {'type': 'Block', 'name': 'except', 'range': [3239, 3268], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [3239, 3245], 'children': []}, {'type': 'Identifier', 'name': 'prisma.errors.PrismaError', 'range': [3245, 3261], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3263, 3264], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [3265, 3268], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [3265, 3270], 'children': []}, {'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3270, 3287], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [3270, 3284], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Database query failed: {str(e)}"', 'range': [3285, 3307], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [3299, 3302], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3303, 3304], 'children': []}]}]}]}]}, {'type': 'Block', 'name': 'except', 'range': [3256, 3268], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [3256, 3262], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [3262, 3271], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3273, 3274], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [3275, 3268], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [3275, 3280], 'children': []}, {'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3280, 3297], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [3280, 3294], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [3295, 3317], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [3309, 3312], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3313, 3314], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:30:34,533 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:30:56,759 - INFO - Step 4 result: {'type': 'Program', 'name': 'create_agent_entry', 'range': [235, 420], 'children': [{'type': 'FunctionDecl', 'name': 'create_agent_entry', 'range': [235, 420], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [235, 239], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [236, 239], 'children': []}, {'type': 'FunctionName', 'name': 'create_agent_entry', 'range': [237, 253], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [238, 299], 'children': [{'type': 'Parameter', 'name': 'name', 'range': [240, 243], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [242, 243], 'children': []}]}, {'type': 'Parameter', 'name': 'description', 'range': [245, 248], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [247, 248], 'children': []}]}, {'type': 'Parameter', 'name': 'author', 'range': [250, 253], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [252, 253], 'children': []}]}, {'type': 'Parameter', 'name': 'keywords', 'range': [255, 263], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.List[str]', 'range': [257, 263], 'children': []}]}, {'type': 'Parameter', 'name': 'categories', 'range': [265, 273], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.List[str]', 'range': [267, 273], 'children': []}]}, {'type': 'Parameter', 'name': 'graph', 'range': [275, 280], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.Json', 'range': [277, 280], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_state', 'range': [282, 297], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [284, 297], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [300, 301], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [302, 304], 'children': []}, {'type': 'TryStatement', 'name': 'try_block', 'range': [306, 406], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [306, 309], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [310, 384], 'children': [{'type': 'AssignmentExpression', 'name': 'assignment', 'range': [309, 384], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [309, 314], 'children': []}, {'type': 'AwaitExpression', 'name': 'await_expression', 'range': [311, 384], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [312, 384], 'children': [{'type': 'MemberExpression', 'name': 'member_expression', 'range': [312, 319], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [312, 318], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [313, 319], 'children': []}, {'type': 'Identifier', 'name': 'Agents', 'range': [314, 320], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [317, 323], 'children': []}]}, {'type': 'CallExpression', 'name': 'call_expression', 'range': [319, 384], 'children': [{'type': 'Identifier', 'name': 'create', 'range': [322, 328], 'children': []}, {'type': 'ObjectExpression', 'name': 'object_expression', 'range': [324, 383], 'children': [{'type': 'Property', 'name': 'data', 'range': [325, 381], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [327, 381], 'children': [{'type': 'Property', 'name': 'name', 'range': [329, 332], 'children': [{'type': 'Identifier', 'name': 'name', 'range': [331, 332], 'children': []}]}, {'type': 'Property', 'name': 'description', 'range': [334, 337], 'children': [{'type': 'Identifier', 'name': 'description', 'range': [336, 337], 'children': []}]}, {'type': 'Property', 'name': 'author', 'range': [339, 342], 'children': [{'type': 'Identifier', 'name': 'author', 'range': [341, 342], 'children': []}]}, {'type': 'Property', 'name': 'keywords', 'range': [344, 347], 'children': [{'type': 'Identifier', 'name': 'keywords', 'range': [346, 347], 'children': []}]}, {'type': 'Property', 'name': 'categories', 'range': [349, 352], 'children': [{'type': 'Identifier', 'name': 'categories', 'range': [351, 352], 'children': []}]}, {'type': 'Property', 'name': 'graph', 'range': [354, 357], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [356, 357], 'children': []}]}, {'type': 'Property', 'name': 'AnalyticsTracker', 'range': [359, 373], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [361, 373], 'children': [{'type': 'Property', 'name': 'create', 'range': [362, 372], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [364, 372], 'children': [{'type': 'Property', 'name': 'downloads', 'range': [365, 368], 'children': [{'type': 'Literal', 'name': '0', 'range': [367, 368], 'children': []}]}, {'type': 'Property', 'name': 'views', 'range': [369, 372], 'children': [{'type': 'Literal', 'name': '0', 'range': [371, 372], 'children': []}]}]}]}]}]}, {'type': 'Property', 'name': 'submissionStatus', 'range': [376, 379], 'children': [{'type': 'Identifier', 'name': 'submission_state', 'range': [378, 379], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return_statement', 'range': [386, 388], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [387, 388], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except_block', 'range': [390, 406], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [390, 396], 'children': []}, {'type': 'Identifier', 'name': 'PrismaError', 'range': [391, 396], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [396, 398], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [397, 398], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [399, 406], 'children': [{'type': 'ThrowStatement', 'name': 'raise_statement', 'range': [400, 405], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [401, 405], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [401, 415], 'children': []}, {'type': 'TemplateLiteral', 'name': 'template_literal', 'range': [403, 405], 'children': [{'type': 'TemplateElement', 'name': 'template_element', 'range': [404, 405], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except_block', 'range': [407, 419], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [407, 411], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [408, 411], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [411, 413], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [412, 413], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [414, 419], 'children': [{'type': 'ThrowStatement', 'name': 'raise_statement', 'range': [413, 418], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [414, 418], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [414, 428], 'children': []}, {'type': 'TemplateLiteral', 'name': 'template_literal', 'range': [416, 418], 'children': [{'type': 'TemplateElement', 'name': 'template_element', 'range': [417, 418], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:30:56,759 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:31:07,351 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_featured_agents', 'range': [2145, 2437], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_featured_agents', 'range': [2145, 2437], 'children': [{'type': 'FunctionSignature', 'name': 'get_featured_agents', 'range': [2145, 2193], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2145, 2149], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2146, 2149], 'children': []}, {'type': 'Identifier', 'name': 'get_featured_agents', 'range': [2147, 2167], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2148, 2188], 'children': [{'type': 'Parameter', 'name': 'category', 'range': [2150, 2154], 'children': [{'type': 'Identifier', 'name': 'category', 'range': [2150, 2157], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2151, 2154], 'children': []}, {'type': 'DefaultValue', 'name': '"featured"', 'range': [2153, 2154], 'children': []}]}, {'type': 'Parameter', 'name': 'page', 'range': [2157, 2161], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2157, 2161], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [2158, 2161], 'children': []}, {'type': 'DefaultValue', 'name': '1', 'range': [2160, 2161], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [2164, 2168], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2164, 2172], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [2165, 2168], 'children': []}, {'type': 'DefaultValue', 'name': '10', 'range': [2167, 2168], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [2171, 2185], 'children': [{'type': 'Identifier', 'name': 'submission_status', 'range': [2171, 2187], 'children': []}, {'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [2172, 2185], 'children': []}, {'type': 'DefaultValue', 'name': 'prisma.enums.SubmissionStatus.APPROVED', 'range': [2178, 2185], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'FeaturedAgentResponse', 'range': [2190, 2193], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [2194, 2437], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [2194, 2198], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2200, 2437], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2202, 2378], 'children': [{'type': 'Comment', 'name': 'Calculate pagination', 'range': [2203, 2206], 'children': []}, {'type': 'VariableDeclaration', 'name': 'skip', 'range': [2207, 2216], 'children': [{'type': 'Identifier', 'name': 'skip', 'range': [2207, 2211], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2208, 2211], 'children': []}, {'type': 'BinaryExpression', 'name': '*', 'range': [2209, 2215], 'children': [{'type': 'BinaryExpression', 'name': '-', 'range': [2210, 2213], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2210, 2214], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [2212, 2213], 'children': []}]}, {'type': 'Identifier', 'name': 'page_size', 'range': [2214, 2218], 'children': []}]}]}, {'type': 'Comment', 'name': 'Execute the query', 'range': [2218, 2222], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2223, 2321], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2225, 2304], 'children': [{'type': 'VariableDeclaration', 'name': 'featured_agents', 'range': [2226, 2304], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2226, 2240], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2227, 2240], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [2228, 2304], 'children': [{'type': 'CallExpression', 'name': 'find_many', 'range': [2229, 2304], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.FeaturedAgent.prisma', 'range': [2229, 2238], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [2229, 2235], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [2230, 2236], 'children': []}, {'type': 'Identifier', 'name': 'FeaturedAgent', 'range': [2231, 2244], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [2232, 2238], 'children': []}]}, {'type': 'CallExpression', 'name': 'find_many', 'range': [2239, 2304], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2241, 2273], 'children': [{'type': 'Property', 'name': 'featuredCategories', 'range': [2242, 2252], 'children': [{'type': 'Identifier', 'name': 'featuredCategories', 'range': [2242, 2258], 'children': []}, {'type': 'ObjectExpression', 'name': 'has', 'range': [2248, 2252], 'children': [{'type': 'Identifier', 'name': 'category', 'range': [2249, 2256], 'children': []}]}]}, {'type': 'Property', 'name': 'isActive', 'range': [2255, 2258], 'children': [{'type': 'Identifier', 'name': 'isActive', 'range': [2255, 2263], 'children': []}, {'type': 'BooleanLiteral', 'name': 'True', 'range': [2256, 2260], 'children': []}]}, {'type': 'Property', 'name': 'agent', 'range': [2260, 2270], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [2260, 2265], 'children': []}, {'type': 'ObjectExpression', 'name': 'is', 'range': [2262, 2270], 'children': [{'type': 'Property', 'name': 'submissionStatus', 'range': [2263, 2269], 'children': [{'type': 'Identifier', 'name': 'submissionStatus', 'range': [2263, 2279], 'children': []}, {'type': 'Identifier', 'name': 'submission_status', 'range': [2266, 2279], 'children': []}]}]}]}]}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2276, 2290], 'children': [{'type': 'Property', 'name': 'agent', 'range': [2277, 2289], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [2277, 2282], 'children': []}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2281, 2289], 'children': [{'type': 'Property', 'name': 'AnalyticsTracker', 'range': [2282, 2288], 'children': [{'type': 'Identifier', 'name': 'AnalyticsTracker', 'range': [2282, 2298], 'children': []}, {'type': 'BooleanLiteral', 'name': 'True', 'range': [2286, 2288], 'children': []}]}]}]}]}, {'type': 'Property', 'name': 'skip', 'range': [2293, 2296], 'children': [{'type': 'Identifier', 'name': 'skip', 'range': [2293, 2297], 'children': []}]}, {'type': 'Property', 'name': 'take', 'range': [2298, 2301], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2298, 2306], 'children': []}]}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2305, 2321], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2306, 2317], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2311, 2313], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2314, 2321], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [2315, 2321], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2316, 2321], 'children': [{'type': 'Literal', 'name': '"Database query failed: {str(e)}"', 'range': [2318, 2320], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': 'Get total count for pagination info', 'range': [2323, 2330], 'children': []}, {'type': 'VariableDeclaration', 'name': 'total_count', 'range': [2331, 2337], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2331, 2341], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2332, 2341], 'children': []}, {'type': 'CallExpression', 'name': 'len', 'range': [2333, 2337], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2335, 2349], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2339, 2378], 'children': [{'type': 'NewExpression', 'name': 'FeaturedAgentResponse', 'range': [2340, 2378], 'children': [{'type': 'ObjectExpression', 'name': 'featured_agents', 'range': [2342, 2346], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2343, 2357], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'total_count', 'range': [2348, 2351], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2349, 2361], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'page', 'range': [2353, 2356], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2354, 2358], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'page_size', 'range': [2358, 2361], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2359, 2367], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'total_pages', 'range': [2363, 2375], 'children': [{'type': 'BinaryExpression', 'name': '/', 'range': [2364, 2374], 'children': [{'type': 'BinaryExpression', 'name': '+', 'range': [2365, 2370], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2366, 2376], 'children': []}, {'type': 'BinaryExpression', 'name': '-', 'range': [2367, 2370], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2368, 2376], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [2369, 2370], 'children': []}]}]}, {'type': 'Identifier', 'name': 'page_size', 'range': [2372, 2380], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2380, 2400], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [2381, 2395], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2383, 2385], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2386, 2400], 'children': [{'type': 'Comment', 'name': 'Log the error or handle it as needed', 'range': [2387, 2395], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2396, 2400], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [2397, 2399], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2401, 2415], 'children': [{'type': 'Identifier', 'name': 'ValueError', 'range': [2402, 2411], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2404, 2406], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2407, 2415], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [2408, 2415], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2409, 2415], 'children': [{'type': 'Literal', 'name': '"Invalid input parameter: {str(e)}"', 'range': [2410, 2412], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2416, 2437], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [2417, 2426], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2419, 2421], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2422, 2437], 'children': [{'type': 'Comment', 'name': 'Catch any other unexpected exceptions', 'range': [2423, 2428], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2429, 2437], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2430, 2437], 'children': [{'type': 'Literal', 'name': '"Unexpected error occurred: {str(e)}"', 'range': [2431, 2433], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:31:07,351 - INFO - Starting Step 4: AST normalization
2025-01-08 10:31:07,684 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_agent_details', 'range': [1070, 1192], 'children': [{'type': 'FunctionDecl', 'name': 'get_agent_details', 'range': [1070, 1192], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1070, 1070], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1071, 1071], 'children': []}, {'type': 'Identifier', 'name': 'get_agent_details', 'range': [1072, 1072], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1073, 1085], 'children': [{'type': 'Parameter', 'name': 'agent_id', 'range': [1074, 1076], 'children': [{'type': 'Identifier', 'name': 'agent_id', 'range': [1074, 1074], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1076, 1076], 'children': []}]}, {'type': 'Parameter', 'name': 'version', 'range': [1078, 1084], 'children': [{'type': 'Identifier', 'name': 'version', 'range': [1078, 1078], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int | None', 'range': [1080, 1082], 'children': []}, {'type': 'Literal', 'name': 'None', 'range': [1084, 1084], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [1086, 1086], 'children': []}, {'type': 'BlockStatement', 'name': 'body', 'range': [1087, 1192], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [1088, 1090], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [1092, 1192], 'children': [{'type': 'BlockStatement', 'name': 'try_block', 'range': [1093, 1162], 'children': [{'type': 'AssignmentExpression', 'name': 'query', 'range': [1095, 1101], 'children': [{'type': 'Identifier', 'name': 'query', 'range': [1095, 1095], 'children': []}, {'type': 'ObjectExpression', 'name': 'dictionary', 'range': [1097, 1101], 'children': [{'type': 'Property', 'name': 'id', 'range': [1098, 1100], 'children': [{'type': 'Identifier', 'name': 'id', 'range': [1098, 1098], 'children': []}, {'type': 'Identifier', 'name': 'agent_id', 'range': [1100, 1100], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1103, 1120], 'children': [{'type': 'BinaryExpression', 'name': 'version is not None', 'range': [1104, 1107], 'children': []}, {'type': 'BlockStatement', 'name': 'if_block', 'range': [1108, 1120], 'children': [{'type': 'AssignmentExpression', 'name': 'query["version"]', 'range': [1110, 1115], 'children': [{'type': 'Identifier', 'name': 'query', 'range': [1110, 1110], 'children': []}, {'type': 'Literal', 'name': 'version', 'range': [1112, 1112], 'children': []}, {'type': 'Identifier', 'name': 'version', 'range': [1115, 1115], 'children': []}]}]}]}, {'type': 'AssignmentExpression', 'name': 'agent', 'range': [1122, 1145], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [1122, 1122], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1124, 1124], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.Agents.prisma().find_first', 'range': [1125, 1140], 'children': [{'type': 'MemberExpression', 'name': 'prisma', 'range': [1125, 1125], 'children': []}, {'type': 'MemberExpression', 'name': 'models', 'range': [1127, 1127], 'children': []}, {'type': 'MemberExpression', 'name': 'Agents', 'range': [1129, 1129], 'children': []}, {'type': 'CallExpression', 'name': 'prisma', 'range': [1131, 1133], 'children': []}, {'type': 'CallExpression', 'name': 'find_first', 'range': [1135, 1140], 'children': [{'type': 'Argument', 'name': 'where', 'range': [1137, 1139], 'children': [{'type': 'Identifier', 'name': 'query', 'range': [1139, 1139], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1147, 1157], 'children': [{'type': 'UnaryExpression', 'name': 'not agent', 'range': [1148, 1149], 'children': []}, {'type': 'BlockStatement', 'name': 'if_block', 'range': [1150, 1157], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1152, 1156], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [1153, 1153], 'children': []}, {'type': 'Literal', 'name': '"Agent not found"', 'range': [1155, 1155], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1159, 1161], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [1160, 1160], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1163, 1179], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1168, 1168], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1170, 1170], 'children': []}, {'type': 'BlockStatement', 'name': 'except_block', 'range': [1171, 1179], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1173, 1178], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [1174, 1174], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Database query failed: {str(e)}"', 'range': [1176, 1177], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1180, 1192], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1181, 1181], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1183, 1183], 'children': []}, {'type': 'BlockStatement', 'name': 'except_block', 'range': [1184, 1192], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1186, 1191], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [1187, 1187], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [1189, 1190], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:31:07,684 - INFO - Completed main AST analysis flow
2025-01-08 10:31:07,686 - INFO - Successfully processed chunk
2025-01-08 10:31:14,416 - INFO - Step 5 result: {'type': 'Program', 'name': 'create_agent_installed_event', 'range': [3165, 3268], 'children': [{'type': 'FunctionDecl', 'name': 'create_agent_installed_event', 'range': [3165, 3268], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3165, 3169], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3166, 3169], 'children': []}, {'type': 'Identifier', 'name': 'create_agent_installed_event', 'range': [3167, 3191], 'children': []}, {'type': 'Parameter', 'name': 'event_data', 'range': [3170, 3176], 'children': [{'type': 'Identifier', 'name': 'event_data', 'range': [3170, 3176], 'children': []}, {'type': 'Type', 'name': 'market.model.AgentInstalledFromMarketplaceEventData', 'range': [3172, 3176], 'children': []}]}, {'type': 'Block', 'name': 'try', 'range': [3182, 3268], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [3182, 3185], 'children': []}, {'type': 'ExpressionStatement', 'name': 'await prisma.models.InstallTracker.prisma().create(data={...})', 'range': [3185, 3237], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [3185, 3190], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.models.InstallTracker.prisma().create', 'range': [3190, 3237], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.InstallTracker.prisma', 'range': [3190, 3193], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [3190, 3196], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [3197, 3202], 'children': []}, {'type': 'Identifier', 'name': 'InstallTracker', 'range': [3203, 3216], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [3217, 3222], 'children': []}]}, {'type': 'CallExpression', 'name': 'create', 'range': [3222, 3237], 'children': [{'type': 'Identifier', 'name': 'create', 'range': [3222, 3227], 'children': []}, {'type': 'ObjectExpression', 'name': 'data', 'range': [3228, 3235], 'children': [{'type': 'Property', 'name': 'installedAgentId', 'range': [3228, 3231], 'children': [{'type': 'Identifier', 'name': 'installedAgentId', 'range': [3228, 3243], 'children': []}, {'type': 'Identifier', 'name': 'event_data.installed_agent_id', 'range': [3244, 3261], 'children': []}]}, {'type': 'Property', 'name': 'marketplaceAgentId', 'range': [3231, 3234], 'children': [{'type': 'Identifier', 'name': 'marketplaceAgentId', 'range': [3231, 3248], 'children': []}, {'type': 'Identifier', 'name': 'event_data.marketplace_agent_id', 'range': [3249, 3266], 'children': []}]}, {'type': 'Property', 'name': 'installationLocation', 'range': [3234, 3235], 'children': [{'type': 'Identifier', 'name': 'installationLocation', 'range': [3234, 3253], 'children': []}, {'type': 'CallExpression', 'name': 'prisma.enums.InstallationLocation', 'range': [3254, 3265], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [3254, 3259], 'children': []}, {'type': 'Identifier', 'name': 'enums', 'range': [3260, 3265], 'children': []}, {'type': 'Identifier', 'name': 'InstallationLocation', 'range': [3266, 3283], 'children': []}, {'type': 'Identifier', 'name': 'event_data.installation_location.name', 'range': [3284, 3307], 'children': []}]}]}]}]}]}]}, {'type': 'Block', 'name': 'except', 'range': [3239, 3268], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [3239, 3245], 'children': []}, {'type': 'Identifier', 'name': 'prisma.errors.PrismaError', 'range': [3245, 3261], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3263, 3264], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Database query failed: {str(e)}")', 'range': [3265, 3268], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [3265, 3270], 'children': []}, {'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3270, 3287], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [3270, 3284], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Database query failed: {str(e)}"', 'range': [3285, 3307], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [3299, 3302], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3303, 3304], 'children': []}]}]}]}]}, {'type': 'Block', 'name': 'except', 'range': [3256, 3268], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [3256, 3262], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [3262, 3271], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3273, 3274], 'children': []}, {'type': 'ExpressionStatement', 'name': 'raise AgentQueryError(f"Unexpected error occurred: {str(e)}")', 'range': [3275, 3268], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [3275, 3280], 'children': []}, {'type': 'CallExpression', 'name': 'AgentQueryError', 'range': [3280, 3297], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [3280, 3294], 'children': []}, {'type': 'TemplateLiteral', 'name': 'f"Unexpected error occurred: {str(e)}"', 'range': [3295, 3317], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [3309, 3312], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [3313, 3314], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:31:14,416 - INFO - Completed main AST analysis flow
2025-01-08 10:31:14,418 - INFO - Successfully processed chunk
2025-01-08 10:31:32,652 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_agents', 'range': [574, 1069], 'children': [{'type': 'FunctionDecl', 'name': 'get_agents', 'range': [574, 1069], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [574, 578], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [575, 578], 'children': []}, {'type': 'FunctionName', 'name': 'get_agents', 'range': [576, 585], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [577, 679], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [579, 583], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [580, 583], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [586, 590], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [587, 590], 'children': []}]}, {'type': 'Parameter', 'name': 'name', 'range': [593, 599], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [594, 599], 'children': []}]}, {'type': 'Parameter', 'name': 'keyword', 'range': [602, 608], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [603, 608], 'children': []}]}, {'type': 'Parameter', 'name': 'category', 'range': [611, 617], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [612, 617], 'children': []}]}, {'type': 'Parameter', 'name': 'description', 'range': [620, 626], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [621, 626], 'children': []}]}, {'type': 'Parameter', 'name': 'description_threshold', 'range': [629, 633], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [630, 633], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [636, 651], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [637, 651], 'children': []}]}, {'type': 'Parameter', 'name': 'sort_by', 'range': [653, 657], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [654, 657], 'children': []}]}, {'type': 'Parameter', 'name': 'sort_order', 'range': [660, 676], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.Literal["desc"] | typing.Literal["asc"]', 'range': [661, 676], 'children': []}]}]}, {'type': 'ReturnTypeAnnotation', 'name': 'return_type', 'range': [680, 681], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [682, 1069], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [682, 691], 'children': []}, {'type': 'TryStatement', 'name': 'try_statement', 'range': [694, 1069], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [694, 1017], 'children': [{'type': 'Comment', 'name': 'Define the base query', 'range': [697, 702], 'children': []}, {'type': 'VariableDecl', 'name': 'query', 'range': [703, 706], 'children': []}, {'type': 'Comment', 'name': 'Add optional filters', 'range': [709, 713], 'children': []}, {'type': 'IfStatement', 'name': 'if_name', 'range': [714, 732], 'children': [{'type': 'Condition', 'name': 'name', 'range': [715, 716], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [717, 732], 'children': [{'type': 'AssignmentExpression', 'name': 'query["name"]', 'range': [718, 731], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_keyword', 'range': [733, 747], 'children': [{'type': 'Condition', 'name': 'keyword', 'range': [734, 735], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [736, 747], 'children': [{'type': 'AssignmentExpression', 'name': 'query["keywords"]', 'range': [737, 746], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_category', 'range': [748, 762], 'children': [{'type': 'Condition', 'name': 'category', 'range': [749, 750], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [751, 762], 'children': [{'type': 'AssignmentExpression', 'name': 'query["categories"]', 'range': [752, 761], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': 'query["submissionStatus"]', 'range': [763, 770], 'children': []}, {'type': 'Comment', 'name': 'Define sorting', 'range': [772, 775], 'children': []}, {'type': 'VariableDecl', 'name': 'order', 'range': [776, 783], 'children': []}, {'type': 'Comment', 'name': 'Calculate pagination', 'range': [785, 788], 'children': []}, {'type': 'VariableDecl', 'name': 'skip', 'range': [789, 798], 'children': []}, {'type': 'Comment', 'name': 'Execute the query', 'range': [800, 804], 'children': []}, {'type': 'TryStatement', 'name': 'try_execute_query', 'range': [805, 870], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [805, 853], 'children': [{'type': 'VariableDecl', 'name': 'agents', 'range': [808, 852], 'children': []}]}, {'type': 'CatchClause', 'name': 'catch_prisma_error', 'range': [854, 870], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [860, 861], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [862, 870], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [864, 869], 'children': []}]}]}]}, {'type': 'Comment', 'name': 'Apply fuzzy search on description if provided', 'range': [872, 880], 'children': []}, {'type': 'IfStatement', 'name': 'if_description', 'range': [881, 960], 'children': [{'type': 'Condition', 'name': 'description', 'range': [882, 883], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [884, 960], 'children': [{'type': 'TryStatement', 'name': 'try_fuzzy_search', 'range': [885, 959], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [885, 947], 'children': [{'type': 'VariableDecl', 'name': 'filtered_agents', 'range': [888, 892], 'children': []}, {'type': 'ForStatement', 'name': 'for_agent_in_agents', 'range': [893, 943], 'children': [{'type': 'Initialization', 'name': 'agent', 'range': [894, 895], 'children': []}, {'type': 'Condition', 'name': 'agents', 'range': [896, 897], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [898, 943], 'children': [{'type': 'IfStatement', 'name': 'if_fuzzy_match', 'range': [899, 935], 'children': [{'type': 'Condition', 'name': 'fuzzy_match', 'range': [900, 933], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [936, 943], 'children': [{'type': 'ExpressionStatement', 'name': 'filtered_agents.append(agent)', 'range': [937, 942], 'children': []}]}]}]}]}, {'type': 'AssignmentExpression', 'name': 'agents', 'range': [944, 946], 'children': []}]}, {'type': 'CatchClause', 'name': 'catch_AttributeError', 'range': [949, 959], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [950, 951], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [952, 959], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [954, 958], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': 'Get total count for pagination info', 'range': [962, 969], 'children': []}, {'type': 'VariableDecl', 'name': 'total_count', 'range': [970, 976], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [978, 1015], 'children': [{'type': 'ObjectExpression', 'name': 'return_object', 'range': [979, 1015], 'children': [{'type': 'Property', 'name': 'agents', 'range': [981, 983], 'children': []}, {'type': 'Property', 'name': 'total_count', 'range': [986, 988], 'children': []}, {'type': 'Property', 'name': 'page', 'range': [991, 993], 'children': []}, {'type': 'Property', 'name': 'page_size', 'range': [996, 998], 'children': []}, {'type': 'Property', 'name': 'total_pages', 'range': [1001, 1013], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'catch_AgentQueryError', 'range': [1018, 1036], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1020, 1021], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1022, 1036], 'children': [{'type': 'Comment', 'name': 'Log the error or handle it as needed', 'range': [1024, 1033], 'children': []}, {'type': 'ThrowStatement', 'name': 'throw_e', 'range': [1034, 1035], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'catch_ValueError', 'range': [1037, 1049], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1039, 1040], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1041, 1049], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [1043, 1048], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'catch_Exception', 'range': [1050, 1069], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1052, 1053], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1054, 1069], 'children': [{'type': 'Comment', 'name': 'Catch any other unexpected exceptions', 'range': [1056, 1062], 'children': []}, {'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [1063, 1068], 'children': []}]}]}]}]}]}]}
2025-01-08 10:31:32,652 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:31:52,197 - INFO - Step 5 result: {'type': 'Program', 'name': 'create_agent_entry', 'range': [235, 420], 'children': [{'type': 'FunctionDecl', 'name': 'create_agent_entry', 'range': [235, 420], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [235, 239], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [236, 239], 'children': []}, {'type': 'FunctionName', 'name': 'create_agent_entry', 'range': [237, 253], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [238, 299], 'children': [{'type': 'Parameter', 'name': 'name', 'range': [240, 243], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [242, 243], 'children': []}]}, {'type': 'Parameter', 'name': 'description', 'range': [245, 248], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [247, 248], 'children': []}]}, {'type': 'Parameter', 'name': 'author', 'range': [250, 253], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [252, 253], 'children': []}]}, {'type': 'Parameter', 'name': 'keywords', 'range': [255, 263], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.List[str]', 'range': [257, 263], 'children': []}]}, {'type': 'Parameter', 'name': 'categories', 'range': [265, 273], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.List[str]', 'range': [267, 273], 'children': []}]}, {'type': 'Parameter', 'name': 'graph', 'range': [275, 280], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.Json', 'range': [277, 280], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_state', 'range': [282, 297], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [284, 297], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [300, 301], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [302, 304], 'children': []}, {'type': 'TryStatement', 'name': 'try_block', 'range': [306, 406], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [306, 309], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [310, 384], 'children': [{'type': 'AssignmentExpression', 'name': 'assignment', 'range': [309, 384], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [309, 314], 'children': []}, {'type': 'AwaitExpression', 'name': 'await_expression', 'range': [311, 384], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [312, 384], 'children': [{'type': 'MemberExpression', 'name': 'member_expression', 'range': [312, 319], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [312, 318], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [313, 319], 'children': []}, {'type': 'Identifier', 'name': 'Agents', 'range': [314, 320], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [317, 323], 'children': []}]}, {'type': 'CallExpression', 'name': 'call_expression', 'range': [319, 384], 'children': [{'type': 'Identifier', 'name': 'create', 'range': [322, 328], 'children': []}, {'type': 'ObjectExpression', 'name': 'object_expression', 'range': [324, 383], 'children': [{'type': 'Property', 'name': 'data', 'range': [325, 381], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [327, 381], 'children': [{'type': 'Property', 'name': 'name', 'range': [329, 332], 'children': [{'type': 'Identifier', 'name': 'name', 'range': [331, 332], 'children': []}]}, {'type': 'Property', 'name': 'description', 'range': [334, 337], 'children': [{'type': 'Identifier', 'name': 'description', 'range': [336, 337], 'children': []}]}, {'type': 'Property', 'name': 'author', 'range': [339, 342], 'children': [{'type': 'Identifier', 'name': 'author', 'range': [341, 342], 'children': []}]}, {'type': 'Property', 'name': 'keywords', 'range': [344, 347], 'children': [{'type': 'Identifier', 'name': 'keywords', 'range': [346, 347], 'children': []}]}, {'type': 'Property', 'name': 'categories', 'range': [349, 352], 'children': [{'type': 'Identifier', 'name': 'categories', 'range': [351, 352], 'children': []}]}, {'type': 'Property', 'name': 'graph', 'range': [354, 357], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [356, 357], 'children': []}]}, {'type': 'Property', 'name': 'AnalyticsTracker', 'range': [359, 373], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [361, 373], 'children': [{'type': 'Property', 'name': 'create', 'range': [362, 372], 'children': [{'type': 'ObjectExpression', 'name': 'object_expression', 'range': [364, 372], 'children': [{'type': 'Property', 'name': 'downloads', 'range': [365, 368], 'children': [{'type': 'Literal', 'name': '0', 'range': [367, 368], 'children': []}]}, {'type': 'Property', 'name': 'views', 'range': [369, 372], 'children': [{'type': 'Literal', 'name': '0', 'range': [371, 372], 'children': []}]}]}]}]}]}, {'type': 'Property', 'name': 'submissionStatus', 'range': [376, 379], 'children': [{'type': 'Identifier', 'name': 'submission_state', 'range': [378, 379], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return_statement', 'range': [386, 388], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [387, 388], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except_block', 'range': [390, 406], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [390, 396], 'children': []}, {'type': 'Identifier', 'name': 'PrismaError', 'range': [391, 396], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [396, 398], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [397, 398], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [399, 406], 'children': [{'type': 'ThrowStatement', 'name': 'raise_statement', 'range': [400, 405], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [401, 405], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [401, 415], 'children': []}, {'type': 'TemplateLiteral', 'name': 'template_literal', 'range': [403, 405], 'children': [{'type': 'TemplateElement', 'name': 'template_element', 'range': [404, 405], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except_block', 'range': [407, 419], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [407, 411], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [408, 411], 'children': []}, {'type': 'AsKeyword', 'name': 'as', 'range': [411, 413], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [412, 413], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [414, 419], 'children': [{'type': 'ThrowStatement', 'name': 'raise_statement', 'range': [413, 418], 'children': [{'type': 'CallExpression', 'name': 'call_expression', 'range': [414, 418], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [414, 428], 'children': []}, {'type': 'TemplateLiteral', 'name': 'template_literal', 'range': [416, 418], 'children': [{'type': 'TemplateElement', 'name': 'template_element', 'range': [417, 418], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:31:52,197 - INFO - Completed main AST analysis flow
2025-01-08 10:31:52,198 - INFO - Successfully processed chunk
2025-01-08 10:32:35,366 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_featured_agents', 'range': [2145, 2437], 'children': [{'type': 'FunctionDecl', 'name': 'get_featured_agents', 'range': [2145, 2437], 'children': [{'type': 'FunctionSignature', 'name': 'get_featured_agents', 'range': [2145, 2193], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2145, 2149], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2146, 2149], 'children': []}, {'type': 'Identifier', 'name': 'get_featured_agents', 'range': [2147, 2167], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2148, 2188], 'children': [{'type': 'Parameter', 'name': 'category', 'range': [2150, 2154], 'children': [{'type': 'Identifier', 'name': 'category', 'range': [2150, 2157], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2151, 2154], 'children': []}, {'type': 'DefaultValue', 'name': '"featured"', 'range': [2153, 2154], 'children': []}]}, {'type': 'Parameter', 'name': 'page', 'range': [2157, 2161], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2157, 2161], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [2158, 2161], 'children': []}, {'type': 'DefaultValue', 'name': '1', 'range': [2160, 2161], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [2164, 2168], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2164, 2172], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [2165, 2168], 'children': []}, {'type': 'DefaultValue', 'name': '10', 'range': [2167, 2168], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [2171, 2185], 'children': [{'type': 'Identifier', 'name': 'submission_status', 'range': [2171, 2187], 'children': []}, {'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [2172, 2185], 'children': []}, {'type': 'DefaultValue', 'name': 'prisma.enums.SubmissionStatus.APPROVED', 'range': [2178, 2185], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'FeaturedAgentResponse', 'range': [2190, 2193], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [2194, 2437], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [2194, 2198], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2200, 2437], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2202, 2378], 'children': [{'type': 'Comment', 'name': 'Calculate pagination', 'range': [2203, 2206], 'children': []}, {'type': 'VariableDeclaration', 'name': 'skip', 'range': [2207, 2216], 'children': [{'type': 'Identifier', 'name': 'skip', 'range': [2207, 2211], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2208, 2211], 'children': []}, {'type': 'BinaryExpression', 'name': '*', 'range': [2209, 2215], 'children': [{'type': 'BinaryExpression', 'name': '-', 'range': [2210, 2213], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2210, 2214], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [2212, 2213], 'children': []}]}, {'type': 'Identifier', 'name': 'page_size', 'range': [2214, 2218], 'children': []}]}]}, {'type': 'Comment', 'name': 'Execute the query', 'range': [2218, 2222], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2223, 2321], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2225, 2304], 'children': [{'type': 'VariableDeclaration', 'name': 'featured_agents', 'range': [2226, 2304], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2226, 2240], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2227, 2240], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [2228, 2304], 'children': [{'type': 'CallExpression', 'name': 'find_many', 'range': [2229, 2304], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.FeaturedAgent.prisma', 'range': [2229, 2238], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [2229, 2235], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [2230, 2236], 'children': []}, {'type': 'Identifier', 'name': 'FeaturedAgent', 'range': [2231, 2244], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [2232, 2238], 'children': []}]}, {'type': 'CallExpression', 'name': 'find_many', 'range': [2239, 2304], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2241, 2273], 'children': [{'type': 'Property', 'name': 'featuredCategories', 'range': [2242, 2252], 'children': [{'type': 'Identifier', 'name': 'featuredCategories', 'range': [2242, 2258], 'children': []}, {'type': 'ObjectExpression', 'name': 'has', 'range': [2248, 2252], 'children': [{'type': 'Identifier', 'name': 'category', 'range': [2249, 2256], 'children': []}]}]}, {'type': 'Property', 'name': 'isActive', 'range': [2255, 2258], 'children': [{'type': 'Identifier', 'name': 'isActive', 'range': [2255, 2263], 'children': []}, {'type': 'BooleanLiteral', 'name': 'True', 'range': [2256, 2260], 'children': []}]}, {'type': 'Property', 'name': 'agent', 'range': [2260, 2270], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [2260, 2265], 'children': []}, {'type': 'ObjectExpression', 'name': 'is', 'range': [2262, 2270], 'children': [{'type': 'Property', 'name': 'submissionStatus', 'range': [2263, 2269], 'children': [{'type': 'Identifier', 'name': 'submissionStatus', 'range': [2263, 2279], 'children': []}, {'type': 'Identifier', 'name': 'submission_status', 'range': [2266, 2279], 'children': []}]}]}]}]}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2276, 2290], 'children': [{'type': 'Property', 'name': 'agent', 'range': [2277, 2289], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [2277, 2282], 'children': []}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2281, 2289], 'children': [{'type': 'Property', 'name': 'AnalyticsTracker', 'range': [2282, 2288], 'children': [{'type': 'Identifier', 'name': 'AnalyticsTracker', 'range': [2282, 2298], 'children': []}, {'type': 'BooleanLiteral', 'name': 'True', 'range': [2286, 2288], 'children': []}]}]}]}]}, {'type': 'Property', 'name': 'skip', 'range': [2293, 2296], 'children': [{'type': 'Identifier', 'name': 'skip', 'range': [2293, 2297], 'children': []}]}, {'type': 'Property', 'name': 'take', 'range': [2298, 2301], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2298, 2306], 'children': []}]}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2305, 2321], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2306, 2317], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2311, 2313], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2314, 2321], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [2315, 2321], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2316, 2321], 'children': [{'type': 'Literal', 'name': '"Database query failed: {str(e)}"', 'range': [2318, 2320], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': 'Get total count for pagination info', 'range': [2323, 2330], 'children': []}, {'type': 'VariableDeclaration', 'name': 'total_count', 'range': [2331, 2337], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2331, 2341], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2332, 2341], 'children': []}, {'type': 'CallExpression', 'name': 'len', 'range': [2333, 2337], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2335, 2349], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2339, 2378], 'children': [{'type': 'NewExpression', 'name': 'FeaturedAgentResponse', 'range': [2340, 2378], 'children': [{'type': 'ObjectExpression', 'name': 'featured_agents', 'range': [2342, 2346], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2343, 2357], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'total_count', 'range': [2348, 2351], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2349, 2361], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'page', 'range': [2353, 2356], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2354, 2358], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'page_size', 'range': [2358, 2361], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2359, 2367], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'total_pages', 'range': [2363, 2375], 'children': [{'type': 'BinaryExpression', 'name': '/', 'range': [2364, 2374], 'children': [{'type': 'BinaryExpression', 'name': '+', 'range': [2365, 2370], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2366, 2376], 'children': []}, {'type': 'BinaryExpression', 'name': '-', 'range': [2367, 2370], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2368, 2376], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [2369, 2370], 'children': []}]}]}, {'type': 'Identifier', 'name': 'page_size', 'range': [2372, 2380], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2380, 2400], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [2381, 2395], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2383, 2385], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2386, 2400], 'children': [{'type': 'Comment', 'name': 'Log the error or handle it as needed', 'range': [2387, 2395], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2396, 2400], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [2397, 2399], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2401, 2415], 'children': [{'type': 'Identifier', 'name': 'ValueError', 'range': [2402, 2411], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2404, 2406], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2407, 2415], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [2408, 2415], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2409, 2415], 'children': [{'type': 'Literal', 'name': '"Invalid input parameter: {str(e)}"', 'range': [2410, 2412], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2416, 2437], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [2417, 2426], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2419, 2421], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2422, 2437], 'children': [{'type': 'Comment', 'name': 'Catch any other unexpected exceptions', 'range': [2423, 2428], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2429, 2437], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2430, 2437], 'children': [{'type': 'Literal', 'name': '"Unexpected error occurred: {str(e)}"', 'range': [2431, 2433], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:32:35,366 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:32:39,875 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_agents', 'range': [574, 1069], 'children': [{'type': 'FunctionDecl', 'name': 'get_agents', 'range': [574, 1069], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [574, 578], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [575, 578], 'children': []}, {'type': 'FunctionName', 'name': 'get_agents', 'range': [576, 585], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [577, 679], 'children': [{'type': 'Parameter', 'name': 'page', 'range': [579, 583], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [580, 583], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [586, 590], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [587, 590], 'children': []}]}, {'type': 'Parameter', 'name': 'name', 'range': [593, 599], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [594, 599], 'children': []}]}, {'type': 'Parameter', 'name': 'keyword', 'range': [602, 608], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [603, 608], 'children': []}]}, {'type': 'Parameter', 'name': 'category', 'range': [611, 617], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [612, 617], 'children': []}]}, {'type': 'Parameter', 'name': 'description', 'range': [620, 626], 'children': [{'type': 'TypeAnnotation', 'name': 'str | None', 'range': [621, 626], 'children': []}]}, {'type': 'Parameter', 'name': 'description_threshold', 'range': [629, 633], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [630, 633], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [636, 651], 'children': [{'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [637, 651], 'children': []}]}, {'type': 'Parameter', 'name': 'sort_by', 'range': [653, 657], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [654, 657], 'children': []}]}, {'type': 'Parameter', 'name': 'sort_order', 'range': [660, 676], 'children': [{'type': 'TypeAnnotation', 'name': 'typing.Literal["desc"] | typing.Literal["asc"]', 'range': [661, 676], 'children': []}]}]}, {'type': 'ReturnTypeAnnotation', 'name': 'return_type', 'range': [680, 681], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [682, 1069], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [682, 691], 'children': []}, {'type': 'TryStatement', 'name': 'try_statement', 'range': [694, 1069], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [694, 1017], 'children': [{'type': 'Comment', 'name': 'Define the base query', 'range': [697, 702], 'children': []}, {'type': 'VariableDecl', 'name': 'query', 'range': [703, 706], 'children': []}, {'type': 'Comment', 'name': 'Add optional filters', 'range': [709, 713], 'children': []}, {'type': 'IfStatement', 'name': 'if_name', 'range': [714, 732], 'children': [{'type': 'Condition', 'name': 'name', 'range': [715, 716], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [717, 732], 'children': [{'type': 'AssignmentExpression', 'name': 'query["name"]', 'range': [718, 731], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_keyword', 'range': [733, 747], 'children': [{'type': 'Condition', 'name': 'keyword', 'range': [734, 735], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [736, 747], 'children': [{'type': 'AssignmentExpression', 'name': 'query["keywords"]', 'range': [737, 746], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if_category', 'range': [748, 762], 'children': [{'type': 'Condition', 'name': 'category', 'range': [749, 750], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [751, 762], 'children': [{'type': 'AssignmentExpression', 'name': 'query["categories"]', 'range': [752, 761], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': 'query["submissionStatus"]', 'range': [763, 770], 'children': []}, {'type': 'Comment', 'name': 'Define sorting', 'range': [772, 775], 'children': []}, {'type': 'VariableDecl', 'name': 'order', 'range': [776, 783], 'children': []}, {'type': 'Comment', 'name': 'Calculate pagination', 'range': [785, 788], 'children': []}, {'type': 'VariableDecl', 'name': 'skip', 'range': [789, 798], 'children': []}, {'type': 'Comment', 'name': 'Execute the query', 'range': [800, 804], 'children': []}, {'type': 'TryStatement', 'name': 'try_execute_query', 'range': [805, 870], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [805, 853], 'children': [{'type': 'VariableDecl', 'name': 'agents', 'range': [808, 852], 'children': []}]}, {'type': 'CatchClause', 'name': 'catch_prisma_error', 'range': [854, 870], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [860, 861], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [862, 870], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [864, 869], 'children': []}]}]}]}, {'type': 'Comment', 'name': 'Apply fuzzy search on description if provided', 'range': [872, 880], 'children': []}, {'type': 'IfStatement', 'name': 'if_description', 'range': [881, 960], 'children': [{'type': 'Condition', 'name': 'description', 'range': [882, 883], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [884, 960], 'children': [{'type': 'TryStatement', 'name': 'try_fuzzy_search', 'range': [885, 959], 'children': [{'type': 'TryBlock', 'name': 'try_block', 'range': [885, 947], 'children': [{'type': 'VariableDecl', 'name': 'filtered_agents', 'range': [888, 892], 'children': []}, {'type': 'ForStatement', 'name': 'for_agent_in_agents', 'range': [893, 943], 'children': [{'type': 'Initialization', 'name': 'agent', 'range': [894, 895], 'children': []}, {'type': 'Condition', 'name': 'agents', 'range': [896, 897], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [898, 943], 'children': [{'type': 'IfStatement', 'name': 'if_fuzzy_match', 'range': [899, 935], 'children': [{'type': 'Condition', 'name': 'fuzzy_match', 'range': [900, 933], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [936, 943], 'children': [{'type': 'ExpressionStatement', 'name': 'filtered_agents.append(agent)', 'range': [937, 942], 'children': []}]}]}]}]}, {'type': 'AssignmentExpression', 'name': 'agents', 'range': [944, 946], 'children': []}]}, {'type': 'CatchClause', 'name': 'catch_AttributeError', 'range': [949, 959], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [950, 951], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [952, 959], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [954, 958], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': 'Get total count for pagination info', 'range': [962, 969], 'children': []}, {'type': 'VariableDecl', 'name': 'total_count', 'range': [970, 976], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [978, 1015], 'children': [{'type': 'ObjectExpression', 'name': 'return_object', 'range': [979, 1015], 'children': [{'type': 'Property', 'name': 'agents', 'range': [981, 983], 'children': []}, {'type': 'Property', 'name': 'total_count', 'range': [986, 988], 'children': []}, {'type': 'Property', 'name': 'page', 'range': [991, 993], 'children': []}, {'type': 'Property', 'name': 'page_size', 'range': [996, 998], 'children': []}, {'type': 'Property', 'name': 'total_pages', 'range': [1001, 1013], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'catch_AgentQueryError', 'range': [1018, 1036], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1020, 1021], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1022, 1036], 'children': [{'type': 'Comment', 'name': 'Log the error or handle it as needed', 'range': [1024, 1033], 'children': []}, {'type': 'ThrowStatement', 'name': 'throw_e', 'range': [1034, 1035], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'catch_ValueError', 'range': [1037, 1049], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1039, 1040], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1041, 1049], 'children': [{'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [1043, 1048], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'catch_Exception', 'range': [1050, 1069], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [1052, 1053], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [1054, 1069], 'children': [{'type': 'Comment', 'name': 'Catch any other unexpected exceptions', 'range': [1056, 1062], 'children': []}, {'type': 'ThrowStatement', 'name': 'throw_AgentQueryError', 'range': [1063, 1068], 'children': []}]}]}]}]}]}]}
2025-01-08 10:32:39,876 - INFO - Completed main AST analysis flow
2025-01-08 10:32:39,878 - INFO - Successfully processed chunk
2025-01-08 10:34:04,625 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_featured_agents', 'range': [2145, 2437], 'children': [{'type': 'FunctionDecl', 'name': 'get_featured_agents', 'range': [2145, 2437], 'children': [{'type': 'FunctionSignature', 'name': 'get_featured_agents', 'range': [2145, 2193], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [2145, 2149], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [2146, 2149], 'children': []}, {'type': 'Identifier', 'name': 'get_featured_agents', 'range': [2147, 2167], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [2148, 2188], 'children': [{'type': 'Parameter', 'name': 'category', 'range': [2150, 2154], 'children': [{'type': 'Identifier', 'name': 'category', 'range': [2150, 2157], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [2151, 2154], 'children': []}, {'type': 'DefaultValue', 'name': '"featured"', 'range': [2153, 2154], 'children': []}]}, {'type': 'Parameter', 'name': 'page', 'range': [2157, 2161], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2157, 2161], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [2158, 2161], 'children': []}, {'type': 'DefaultValue', 'name': '1', 'range': [2160, 2161], 'children': []}]}, {'type': 'Parameter', 'name': 'page_size', 'range': [2164, 2168], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2164, 2172], 'children': []}, {'type': 'TypeAnnotation', 'name': 'int', 'range': [2165, 2168], 'children': []}, {'type': 'DefaultValue', 'name': '10', 'range': [2167, 2168], 'children': []}]}, {'type': 'Parameter', 'name': 'submission_status', 'range': [2171, 2185], 'children': [{'type': 'Identifier', 'name': 'submission_status', 'range': [2171, 2187], 'children': []}, {'type': 'TypeAnnotation', 'name': 'prisma.enums.SubmissionStatus', 'range': [2172, 2185], 'children': []}, {'type': 'DefaultValue', 'name': 'prisma.enums.SubmissionStatus.APPROVED', 'range': [2178, 2185], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'FeaturedAgentResponse', 'range': [2190, 2193], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [2194, 2437], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [2194, 2198], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2200, 2437], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2202, 2378], 'children': [{'type': 'Comment', 'name': 'Calculate pagination', 'range': [2203, 2206], 'children': []}, {'type': 'VariableDeclaration', 'name': 'skip', 'range': [2207, 2216], 'children': [{'type': 'Identifier', 'name': 'skip', 'range': [2207, 2211], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2208, 2211], 'children': []}, {'type': 'BinaryExpression', 'name': '*', 'range': [2209, 2215], 'children': [{'type': 'BinaryExpression', 'name': '-', 'range': [2210, 2213], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2210, 2214], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [2212, 2213], 'children': []}]}, {'type': 'Identifier', 'name': 'page_size', 'range': [2214, 2218], 'children': []}]}]}, {'type': 'Comment', 'name': 'Execute the query', 'range': [2218, 2222], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [2223, 2321], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2225, 2304], 'children': [{'type': 'VariableDeclaration', 'name': 'featured_agents', 'range': [2226, 2304], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2226, 2240], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2227, 2240], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [2228, 2304], 'children': [{'type': 'CallExpression', 'name': 'find_many', 'range': [2229, 2304], 'children': [{'type': 'MemberExpression', 'name': 'prisma.models.FeaturedAgent.prisma', 'range': [2229, 2238], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [2229, 2235], 'children': []}, {'type': 'Identifier', 'name': 'models', 'range': [2230, 2236], 'children': []}, {'type': 'Identifier', 'name': 'FeaturedAgent', 'range': [2231, 2244], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [2232, 2238], 'children': []}]}, {'type': 'CallExpression', 'name': 'find_many', 'range': [2239, 2304], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [2241, 2273], 'children': [{'type': 'Property', 'name': 'featuredCategories', 'range': [2242, 2252], 'children': [{'type': 'Identifier', 'name': 'featuredCategories', 'range': [2242, 2258], 'children': []}, {'type': 'ObjectExpression', 'name': 'has', 'range': [2248, 2252], 'children': [{'type': 'Identifier', 'name': 'category', 'range': [2249, 2256], 'children': []}]}]}, {'type': 'Property', 'name': 'isActive', 'range': [2255, 2258], 'children': [{'type': 'Identifier', 'name': 'isActive', 'range': [2255, 2263], 'children': []}, {'type': 'BooleanLiteral', 'name': 'True', 'range': [2256, 2260], 'children': []}]}, {'type': 'Property', 'name': 'agent', 'range': [2260, 2270], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [2260, 2265], 'children': []}, {'type': 'ObjectExpression', 'name': 'is', 'range': [2262, 2270], 'children': [{'type': 'Property', 'name': 'submissionStatus', 'range': [2263, 2269], 'children': [{'type': 'Identifier', 'name': 'submissionStatus', 'range': [2263, 2279], 'children': []}, {'type': 'Identifier', 'name': 'submission_status', 'range': [2266, 2279], 'children': []}]}]}]}]}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2276, 2290], 'children': [{'type': 'Property', 'name': 'agent', 'range': [2277, 2289], 'children': [{'type': 'Identifier', 'name': 'agent', 'range': [2277, 2282], 'children': []}, {'type': 'ObjectExpression', 'name': 'include', 'range': [2281, 2289], 'children': [{'type': 'Property', 'name': 'AnalyticsTracker', 'range': [2282, 2288], 'children': [{'type': 'Identifier', 'name': 'AnalyticsTracker', 'range': [2282, 2298], 'children': []}, {'type': 'BooleanLiteral', 'name': 'True', 'range': [2286, 2288], 'children': []}]}]}]}]}, {'type': 'Property', 'name': 'skip', 'range': [2293, 2296], 'children': [{'type': 'Identifier', 'name': 'skip', 'range': [2293, 2297], 'children': []}]}, {'type': 'Property', 'name': 'take', 'range': [2298, 2301], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2298, 2306], 'children': []}]}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2305, 2321], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [2306, 2317], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2311, 2313], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2314, 2321], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [2315, 2321], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2316, 2321], 'children': [{'type': 'Literal', 'name': '"Database query failed: {str(e)}"', 'range': [2318, 2320], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': 'Get total count for pagination info', 'range': [2323, 2330], 'children': []}, {'type': 'VariableDeclaration', 'name': 'total_count', 'range': [2331, 2337], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2331, 2341], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [2332, 2341], 'children': []}, {'type': 'CallExpression', 'name': 'len', 'range': [2333, 2337], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2335, 2349], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2339, 2378], 'children': [{'type': 'NewExpression', 'name': 'FeaturedAgentResponse', 'range': [2340, 2378], 'children': [{'type': 'ObjectExpression', 'name': 'featured_agents', 'range': [2342, 2346], 'children': [{'type': 'Identifier', 'name': 'featured_agents', 'range': [2343, 2357], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'total_count', 'range': [2348, 2351], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2349, 2361], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'page', 'range': [2353, 2356], 'children': [{'type': 'Identifier', 'name': 'page', 'range': [2354, 2358], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'page_size', 'range': [2358, 2361], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2359, 2367], 'children': []}]}, {'type': 'ObjectExpression', 'name': 'total_pages', 'range': [2363, 2375], 'children': [{'type': 'BinaryExpression', 'name': '/', 'range': [2364, 2374], 'children': [{'type': 'BinaryExpression', 'name': '+', 'range': [2365, 2370], 'children': [{'type': 'Identifier', 'name': 'total_count', 'range': [2366, 2376], 'children': []}, {'type': 'BinaryExpression', 'name': '-', 'range': [2367, 2370], 'children': [{'type': 'Identifier', 'name': 'page_size', 'range': [2368, 2376], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [2369, 2370], 'children': []}]}]}, {'type': 'Identifier', 'name': 'page_size', 'range': [2372, 2380], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2380, 2400], 'children': [{'type': 'Identifier', 'name': 'AgentQueryError', 'range': [2381, 2395], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2383, 2385], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2386, 2400], 'children': [{'type': 'Comment', 'name': 'Log the error or handle it as needed', 'range': [2387, 2395], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2396, 2400], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [2397, 2399], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2401, 2415], 'children': [{'type': 'Identifier', 'name': 'ValueError', 'range': [2402, 2411], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2404, 2406], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2407, 2415], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [2408, 2415], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2409, 2415], 'children': [{'type': 'Literal', 'name': '"Invalid input parameter: {str(e)}"', 'range': [2410, 2412], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2416, 2437], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [2417, 2426], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [2419, 2421], 'children': []}, {'type': 'Block', 'name': 'catchBlock', 'range': [2422, 2437], 'children': [{'type': 'Comment', 'name': 'Catch any other unexpected exceptions', 'range': [2423, 2428], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2429, 2437], 'children': [{'type': 'NewExpression', 'name': 'AgentQueryError', 'range': [2430, 2437], 'children': [{'type': 'Literal', 'name': '"Unexpected error occurred: {str(e)}"', 'range': [2431, 2433], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:34:04,626 - INFO - Completed main AST analysis flow
2025-01-08 10:34:04,628 - INFO - Successfully processed chunk
2025-01-08 10:34:04,867 - INFO - Starting code generation from AST
2025-01-08 10:34:05,602 - ERROR - Error in get_code_from_ast: Error code: 400 - {'error': {'message': "This model's maximum context length is 65536 tokens. However, you requested 87239 tokens (79047 in the messages, 8192 in the completion). Please reduce the length of the messages or completion.", 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_request_error'}}
2025-01-08 10:34:05,602 - INFO - Starting static code similarity comparison
2025-01-08 10:34:05,614 - INFO - Static similarity result: {'final_score': 20.37, 'length_similarity': 0.0, 'token_similarity': 0.0, 'structure_similarity': 0.0, 'function_similarity': 100, 'complexity_similarity': 3.7, 'variable_similarity': 100}
