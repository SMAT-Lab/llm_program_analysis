2025-01-08 09:46:53,919 - INFO - Processing sample 74
2025-01-08 09:46:53,919 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 09:47:00,933 - INFO - Successfully split code into 9 top-level declarations
2025-01-08 09:47:00,937 - INFO - Processing chunk #0 (size=500 chars, start_index=0)
2025-01-08 09:47:00,937 - INFO - Processing chunk with 500 chars starting at index 0
2025-01-08 09:47:00,937 - INFO - Starting main AST analysis flow
2025-01-08 09:47:00,937 - INFO - Tokenized code into 92 tokens
2025-01-08 09:47:00,938 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:47:00,942 - INFO - Processing chunk #1 (size=532 chars, start_index=92)
2025-01-08 09:47:00,942 - INFO - Processing chunk with 532 chars starting at index 92
2025-01-08 09:47:00,942 - INFO - Starting main AST analysis flow
2025-01-08 09:47:00,943 - INFO - Processing chunk #2 (size=327 chars, start_index=157)
2025-01-08 09:47:00,944 - INFO - Tokenized code into 65 tokens
2025-01-08 09:47:00,945 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:47:00,945 - INFO - Processing chunk #3 (size=528 chars, start_index=207)
2025-01-08 09:47:00,944 - INFO - Processing chunk with 327 chars starting at index 157
2025-01-08 09:47:00,947 - INFO - Processing chunk #4 (size=1839 chars, start_index=301)
2025-01-08 09:47:00,947 - INFO - Processing chunk with 528 chars starting at index 207
2025-01-08 09:47:00,948 - INFO - Processing chunk #5 (size=349 chars, start_index=599)
2025-01-08 09:47:00,948 - INFO - Starting main AST analysis flow
2025-01-08 09:47:00,948 - INFO - Processing chunk #6 (size=416 chars, start_index=659)
2025-01-08 09:47:00,949 - INFO - Processing chunk #7 (size=1236 chars, start_index=728)
2025-01-08 09:47:00,950 - INFO - Processing chunk with 1839 chars starting at index 301
2025-01-08 09:47:00,956 - INFO - Starting main AST analysis flow
2025-01-08 09:47:00,951 - INFO - Starting main AST analysis flow
2025-01-08 09:47:00,951 - INFO - Processing chunk with 349 chars starting at index 599
2025-01-08 09:47:00,955 - INFO - Tokenized code into 50 tokens
2025-01-08 09:47:00,956 - INFO - Processing chunk with 416 chars starting at index 659
2025-01-08 09:47:00,956 - INFO - Processing chunk with 1236 chars starting at index 728
2025-01-08 09:47:00,950 - INFO - Processing chunk #8 (size=442 chars, start_index=939)
2025-01-08 09:47:00,957 - INFO - Tokenized code into 298 tokens
2025-01-08 09:47:00,958 - INFO - Tokenized code into 94 tokens
2025-01-08 09:47:00,958 - INFO - Starting main AST analysis flow
2025-01-08 09:47:00,958 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:47:00,959 - INFO - Starting main AST analysis flow
2025-01-08 09:47:00,959 - INFO - Starting main AST analysis flow
2025-01-08 09:47:00,959 - INFO - Processing chunk with 442 chars starting at index 939
2025-01-08 09:47:00,959 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:47:00,960 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:47:00,960 - INFO - Tokenized code into 60 tokens
2025-01-08 09:47:00,965 - INFO - Tokenized code into 69 tokens
2025-01-08 09:47:00,965 - INFO - Tokenized code into 211 tokens
2025-01-08 09:47:00,966 - INFO - Starting main AST analysis flow
2025-01-08 09:47:00,975 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:47:00,976 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:47:00,976 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:47:00,976 - INFO - Tokenized code into 68 tokens
2025-01-08 09:47:00,990 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:47:03,086 - INFO - Step 1 result: {'type': 'Program', 'name': 'revoke_tokens', 'range': [599, 658], 'children': []}
2025-01-08 09:47:03,086 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:47:03,093 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_login_url', 'range': [207, 300], 'children': []}
2025-01-08 09:47:03,093 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:47:03,120 - INFO - Step 1 result: {'type': 'Program', 'name': '__init__', 'range': [157, 206], 'children': []}
2025-01-08 09:47:03,120 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:47:03,131 - INFO - Step 1 result: {'type': 'Program', 'name': '_refresh_tokens', 'range': [728, 938], 'children': []}
2025-01-08 09:47:03,131 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:47:03,158 - INFO - Step 1 result: {'type': 'Program', 'name': '_request_email', 'range': [659, 726], 'children': []}
2025-01-08 09:47:03,158 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:47:03,188 - INFO - Step 1 result: {'type': 'Program', 'name': 'exchange_code_for_tokens', 'range': [301, 598], 'children': []}
2025-01-08 09:47:03,188 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:47:03,737 - INFO - Step 1 result: {'type': 'Program', 'name': '_setup_oauth_flow', 'range': [939, 1006], 'children': []}
2025-01-08 09:47:03,737 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:47:06,615 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [92, 156], 'children': [{'type': 'ClassDeclaration', 'name': 'GoogleOAuthHandler', 'range': [105, 111], 'children': []}, {'type': 'VariableDeclaration', 'name': 'PROVIDER_NAME', 'range': [119, 124], 'children': []}, {'type': 'VariableDeclaration', 'name': 'EMAIL_ENDPOINT', 'range': [125, 128], 'children': []}, {'type': 'VariableDeclaration', 'name': 'DEFAULT_SCOPES', 'range': [129, 143], 'children': []}]}
2025-01-08 09:47:06,615 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:47:08,872 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 91], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [4, 19], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [20, 32], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [33, 41], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [42, 48], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [49, 53], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [55, 63], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [64, 72], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [74, 79], 'children': []}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [81, 89], 'children': []}]}
2025-01-08 09:47:08,872 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:47:19,119 - INFO - Step 2 result: {'nodes': [{'type': 'ClassDeclaration', 'name': 'GoogleOAuthHandler', 'range': [105, 111], 'children': [{'type': 'Inheritance', 'name': 'BaseOAuthHandler', 'range': [107, 109], 'children': []}, {'type': 'Docstring', 'name': '', 'range': [112, 114], 'children': []}, {'type': 'Comment', 'name': '# noqa', 'range': [115, 117], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'PROVIDER_NAME', 'range': [119, 124], 'children': [{'type': 'Assignment', 'name': '=', 'range': [120, 121], 'children': [{'type': 'Value', 'name': 'ProviderName.GOOGLE', 'range': [121, 123], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'EMAIL_ENDPOINT', 'range': [125, 128], 'children': [{'type': 'Assignment', 'name': '=', 'range': [126, 127], 'children': [{'type': 'Value', 'name': '"https://www.googleapis.com/oauth2/v2/userinfo"', 'range': [127, 127], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'DEFAULT_SCOPES', 'range': [129, 143], 'children': [{'type': 'Assignment', 'name': '=', 'range': [130, 131], 'children': [{'type': 'Array', 'name': '', 'range': [131, 142], 'children': [{'type': 'Value', 'name': '"https://www.googleapis.com/auth/userinfo.email"', 'range': [133, 133], 'children': []}, {'type': 'Value', 'name': '"https://www.googleapis.com/auth/userinfo.profile"', 'range': [136, 136], 'children': []}, {'type': 'Value', 'name': '"openid"', 'range': [139, 139], 'children': []}]}]}]}]}
2025-01-08 09:47:19,119 - INFO - Starting Step 3: AST simplification
2025-01-08 09:47:19,152 - INFO - Step 2 result: {'type': 'Program', 'name': '_setup_oauth_flow', 'range': [939, 1006], 'children': [{'type': 'FunctionDeclaration', 'name': '_setup_oauth_flow', 'range': [939, 1006], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [942, 942], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [944, 949], 'children': [{'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [946, 949], 'children': []}]}, {'type': 'ReturnType', 'name': 'Flow', 'range': [953, 953], 'children': []}, {'type': 'Block', 'name': '', 'range': [955, 1006], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [956, 1004], 'children': [{'type': 'CallExpression', 'name': 'Flow.from_client_config', 'range': [957, 1004], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [962, 996], 'children': [{'type': 'Property', 'name': 'web', 'range': [964, 994], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [966, 994], 'children': [{'type': 'Property', 'name': 'client_id', 'range': [968, 972], 'children': [{'type': 'MemberExpression', 'name': 'self.client_id', 'range': [970, 972], 'children': []}]}, {'type': 'Property', 'name': 'client_secret', 'range': [975, 979], 'children': [{'type': 'MemberExpression', 'name': 'self.client_secret', 'range': [977, 979], 'children': []}]}, {'type': 'Property', 'name': 'auth_uri', 'range': [982, 984], 'children': [{'type': 'StringLiteral', 'name': 'https://accounts.google.com/o/oauth2/auth', 'range': [984, 984], 'children': []}]}, {'type': 'Property', 'name': 'token_uri', 'range': [987, 991], 'children': [{'type': 'MemberExpression', 'name': 'self.token_uri', 'range': [989, 991], 'children': []}]}]}]}]}, {'type': 'Argument', 'name': 'scopes', 'range': [999, 1001], 'children': []}]}]}]}]}]}
2025-01-08 09:47:19,152 - INFO - Starting Step 3: AST simplification
2025-01-08 09:47:22,425 - INFO - Step 2 result: {'type': 'Program', 'name': 'revoke_tokens', 'range': [599, 658], 'children': [{'type': 'FunctionDeclaration', 'name': 'revoke_tokens', 'range': [599, 658], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [601, 607], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [602, 602], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [604, 606], 'children': []}]}, {'type': 'ReturnType', 'name': 'bool', 'range': [610, 610], 'children': []}, {'type': 'Block', 'name': 'function_body', 'range': [612, 658], 'children': [{'type': 'VariableDeclaration', 'name': 'session', 'range': [613, 618], 'children': [{'type': 'Assignment', 'name': '=', 'range': [614, 614], 'children': []}, {'type': 'FunctionCall', 'name': 'AuthorizedSession', 'range': [615, 618], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [616, 618], 'children': [{'type': 'Argument', 'name': 'credentials', 'range': [617, 617], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'session.post', 'range': [620, 654], 'children': [{'type': 'FunctionCall', 'name': 'post', 'range': [622, 654], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [623, 654], 'children': [{'type': 'Argument', 'name': 'self.revoke_uri', 'range': [625, 627], 'children': []}, {'type': 'KeywordArgument', 'name': 'params', 'range': [630, 642], 'children': [{'type': 'Dictionary', 'name': 'params', 'range': [632, 642], 'children': [{'type': 'KeyValuePair', 'name': 'token', 'range': [633, 641], 'children': [{'type': 'Value', 'name': 'credentials.access_token.get_secret_value()', 'range': [635, 641], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [645, 651], 'children': [{'type': 'Dictionary', 'name': 'headers', 'range': [647, 651], 'children': [{'type': 'KeyValuePair', 'name': 'content-type', 'range': [648, 650], 'children': [{'type': 'Value', 'name': 'application/x-www-form-urlencoded', 'range': [650, 650], 'children': []}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [656, 657], 'children': [{'type': 'ReturnValue', 'name': 'True', 'range': [657, 657], 'children': []}]}]}]}]}
2025-01-08 09:47:22,426 - INFO - Starting Step 3: AST simplification
2025-01-08 09:47:22,888 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_login_url', 'range': [207, 300], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_login_url', 'range': [207, 226], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [210, 210], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [212, 217], 'children': [{'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [214, 217], 'children': []}]}, {'type': 'Parameter', 'name': 'state', 'range': [219, 221], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [221, 221], 'children': []}]}, {'type': 'ReturnType', 'name': 'str', 'range': [225, 225], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [227, 300], 'children': [{'type': 'VariableDeclaration', 'name': 'all_scopes', 'range': [228, 240], 'children': [{'type': 'Assignment', 'name': '=', 'range': [229, 229], 'children': []}, {'type': 'Expression', 'name': 'list(set(scopes + self.DEFAULT_SCOPES))', 'range': [230, 240], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [242, 248], 'children': [{'type': 'CallExpression', 'name': 'debug', 'range': [244, 248], 'children': [{'type': 'Argument', 'name': 'f"Setting up OAuth flow with scopes: {all_scopes}"', 'range': [246, 247], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'flow', 'range': [250, 258], 'children': [{'type': 'Assignment', 'name': '=', 'range': [251, 251], 'children': []}, {'type': 'Expression', 'name': 'self._setup_oauth_flow(all_scopes)', 'range': [252, 258], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'flow.redirect_uri', 'range': [259, 266], 'children': [{'type': 'Assignment', 'name': '=', 'range': [262, 262], 'children': []}, {'type': 'Expression', 'name': 'self.redirect_uri', 'range': [263, 266], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'authorization_url', 'range': [267, 297], 'children': [{'type': 'Assignment', 'name': '=', 'range': [270, 270], 'children': []}, {'type': 'Expression', 'name': 'flow.authorization_url(access_type="offline", include_granted_scopes="true", state=state, prompt="consent")', 'range': [271, 297], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [298, 300], 'children': [{'type': 'Expression', 'name': 'authorization_url', 'range': [299, 299], 'children': []}]}]}]}
2025-01-08 09:47:22,888 - INFO - Starting Step 3: AST simplification
2025-01-08 09:47:24,976 - INFO - Step 2 result: {'type': 'Program', 'name': 'exchange_code_for_tokens', 'range': [301, 598], 'children': [{'type': 'FunctionDeclaration', 'name': 'exchange_code_for_tokens', 'range': [301, 598], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [303, 318], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [305, 305], 'children': []}, {'type': 'Parameter', 'name': 'code', 'range': [307, 309], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [311, 316], 'children': []}]}, {'type': 'ReturnType', 'name': 'OAuth2Credentials', 'range': [319, 321], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [322, 598], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [324, 330], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow = self._setup_oauth_flow', 'range': [342, 349], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow.redirect_uri = self.redirect_uri', 'range': [351, 358], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [360, 365], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow.oauth2session.scope = None', 'range': [375, 381], 'children': []}, {'type': 'AssignmentExpression', 'name': 'token = flow.fetch_token', 'range': [383, 392], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [394, 399], 'children': []}, {'type': 'AssignmentExpression', 'name': 'granted_scopes = token.get', 'range': [411, 426], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [429, 435], 'children': []}, {'type': 'AssignmentExpression', 'name': 'google_creds = flow.credentials', 'range': [438, 443], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [444, 450], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [453, 458], 'children': []}, {'type': 'AssignmentExpression', 'name': 'username = self._request_email', 'range': [460, 467], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [469, 475], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.token', 'range': [478, 482], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.refresh_token', 'range': [483, 487], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.expiry', 'range': [488, 492], 'children': []}, {'type': 'AssertStatement', 'name': 'assert granted_scopes', 'range': [493, 495], 'children': []}, {'type': 'AssignmentExpression', 'name': 'credentials = OAuth2Credentials', 'range': [505, 583], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [585, 593], 'children': []}, {'type': 'ReturnStatement', 'name': 'return credentials', 'range': [596, 597], 'children': []}]}]}]}
2025-01-08 09:47:24,976 - INFO - Starting Step 3: AST simplification
2025-01-08 09:47:26,334 - INFO - Step 2 result: {'type': 'Program', 'name': '__init__', 'range': [157, 206], 'children': [{'type': 'FunctionDeclaration', 'name': '__init__', 'range': [157, 206], 'children': [{'type': 'ParameterList', 'name': '', 'range': [159, 173], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [160, 160], 'children': []}, {'type': 'Parameter', 'name': 'client_id', 'range': [162, 164], 'children': []}, {'type': 'Parameter', 'name': 'client_secret', 'range': [166, 168], 'children': []}, {'type': 'Parameter', 'name': 'redirect_uri', 'range': [170, 172], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [174, 206], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [176, 180], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [176, 178], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [176, 176], 'children': []}, {'type': 'Identifier', 'name': 'client_id', 'range': [178, 178], 'children': []}]}, {'type': 'Identifier', 'name': 'client_id', 'range': [180, 180], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [182, 186], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [182, 184], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [182, 182], 'children': []}, {'type': 'Identifier', 'name': 'client_secret', 'range': [184, 184], 'children': []}]}, {'type': 'Identifier', 'name': 'client_secret', 'range': [186, 186], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [188, 192], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [188, 190], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [188, 188], 'children': []}, {'type': 'Identifier', 'name': 'redirect_uri', 'range': [190, 190], 'children': []}]}, {'type': 'Identifier', 'name': 'redirect_uri', 'range': [192, 192], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [194, 198], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [194, 196], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [194, 194], 'children': []}, {'type': 'Identifier', 'name': 'token_uri', 'range': [196, 196], 'children': []}]}, {'type': 'Literal', 'name': '"https://oauth2.googleapis.com/token"', 'range': [198, 198], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [200, 204], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [200, 202], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [200, 200], 'children': []}, {'type': 'Identifier', 'name': 'revoke_uri', 'range': [202, 202], 'children': []}]}, {'type': 'Literal', 'name': '"https://oauth2.googleapis.com/revoke"', 'range': [204, 204], 'children': []}]}]}]}]}
2025-01-08 09:47:26,334 - INFO - Starting Step 3: AST simplification
2025-01-08 09:47:31,431 - INFO - Step 3 result: {'nodes': [{'type': 'ClassDeclaration', 'name': 'GoogleOAuthHandler', 'range': [105, 111], 'children': [{'type': 'Inheritance', 'name': 'BaseOAuthHandler', 'range': [107, 109], 'children': []}, {'type': 'Docstring', 'name': '', 'range': [112, 114], 'children': []}, {'type': 'Comment', 'name': '# noqa', 'range': [115, 117], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'PROVIDER_NAME', 'range': [119, 124], 'children': [{'type': 'Assignment', 'name': '=', 'range': [120, 121], 'children': [{'type': 'Value', 'name': 'ProviderName.GOOGLE', 'range': [121, 123], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'EMAIL_ENDPOINT', 'range': [125, 128], 'children': [{'type': 'Assignment', 'name': '=', 'range': [126, 127], 'children': [{'type': 'Value', 'name': '"https://www.googleapis.com/oauth2/v2/userinfo"', 'range': [127, 127], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'DEFAULT_SCOPES', 'range': [129, 143], 'children': [{'type': 'Assignment', 'name': '=', 'range': [130, 131], 'children': [{'type': 'Array', 'name': '', 'range': [131, 142], 'children': [{'type': 'Value', 'name': '"https://www.googleapis.com/auth/userinfo.email"', 'range': [133, 133], 'children': []}, {'type': 'Value', 'name': '"https://www.googleapis.com/auth/userinfo.profile"', 'range': [136, 136], 'children': []}, {'type': 'Value', 'name': '"openid"', 'range': [139, 139], 'children': []}]}]}]}]}
2025-01-08 09:47:31,431 - INFO - Starting Step 4: AST normalization
2025-01-08 09:47:31,758 - INFO - Step 2 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [4, 19], 'children': [{'type': 'ImportSpecifier', 'name': 'google.auth.external_account_authorized_user', 'range': [5, 9], 'children': [{'type': 'ImportAlias', 'name': 'Credentials', 'alias': 'ExternalAccountCredentials', 'range': [13, 15], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [20, 32], 'children': [{'type': 'ImportSpecifier', 'name': 'google.auth.transport.requests', 'range': [21, 27], 'children': [{'type': 'ImportSpecifier', 'name': 'AuthorizedSession', 'range': [29, 29], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Request', 'range': [31, 31], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [33, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'google.oauth2.credentials', 'range': [34, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'Credentials', 'range': [40, 40], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [42, 48], 'children': [{'type': 'ImportSpecifier', 'name': 'google_auth_oauthlib.flow', 'range': [43, 45], 'children': [{'type': 'ImportSpecifier', 'name': 'Flow', 'range': [47, 47], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [49, 53], 'children': [{'type': 'ImportSpecifier', 'name': 'pydantic', 'range': [50, 50], 'children': [{'type': 'ImportSpecifier', 'name': 'SecretStr', 'range': [52, 52], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [55, 63], 'children': [{'type': 'ImportSpecifier', 'name': 'backend.data.model', 'range': [56, 60], 'children': [{'type': 'ImportSpecifier', 'name': 'OAuth2Credentials', 'range': [62, 62], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [64, 72], 'children': [{'type': 'ImportSpecifier', 'name': 'backend.integrations.providers', 'range': [65, 69], 'children': [{'type': 'ImportSpecifier', 'name': 'ProviderName', 'range': [71, 71], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [74, 79], 'children': [{'type': 'ImportSpecifier', 'name': '.base', 'range': [75, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseOAuthHandler', 'range': [78, 78], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [81, 89], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [82, 88], 'children': [{'type': 'CallExpression', 'name': 'logging.getLogger', 'range': [83, 87], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [87, 87], 'children': []}]}]}]}]}
2025-01-08 09:47:31,759 - INFO - Starting Step 3: AST simplification
2025-01-08 09:47:31,923 - INFO - Step 2 result: {'type': 'Program', 'name': '_request_email', 'range': [659, 726], 'children': [{'type': 'FunctionDeclaration', 'name': '_request_email', 'range': [659, 726], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [661, 671], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [663, 663], 'children': []}, {'type': 'Parameter', 'name': 'creds', 'range': [665, 669], 'children': [{'type': 'TypeAnnotation', 'name': 'Credentials | ExternalAccountCredentials', 'range': [667, 669], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'str | None', 'range': [672, 676], 'children': []}, {'type': 'BlockStatement', 'name': 'body', 'range': [678, 726], 'children': [{'type': 'VariableDeclaration', 'name': 'session', 'range': [679, 684], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [680, 684], 'children': [{'type': 'NewExpression', 'name': 'AuthorizedSession', 'range': [681, 684], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [683, 684], 'children': [{'type': 'Identifier', 'name': 'creds', 'range': [683, 683], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'response', 'range': [686, 695], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [687, 695], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [690, 695], 'children': [{'type': 'MemberExpression', 'name': 'session.get', 'range': [688, 690], 'children': [{'type': 'Identifier', 'name': 'session', 'range': [688, 688], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [692, 695], 'children': [{'type': 'MemberExpression', 'name': 'self.EMAIL_ENDPOINT', 'range': [692, 694], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [692, 692], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [697, 715], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [698, 702], 'children': [{'type': 'MemberExpression', 'name': 'response.ok', 'range': [699, 701], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [699, 699], 'children': []}]}]}, {'type': 'BlockStatement', 'name': 'consequent', 'range': [703, 715], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [704, 712], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [706, 712], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [704, 706], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [704, 704], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [708, 712], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to get user email. Status code: {response.status_code}"', 'range': [709, 710], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [714, 715], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [715, 715], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [717, 726], 'children': [{'type': 'MemberExpression', 'name': 'response.json', 'range': [718, 720], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [718, 718], 'children': []}]}, {'type': 'CallExpression', 'name': 'json', 'range': [720, 725], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [722, 725], 'children': [{'type': 'StringLiteral', 'name': '"email"', 'range': [724, 724], 'children': []}]}]}]}]}]}]}
2025-01-08 09:47:31,923 - INFO - Starting Step 3: AST simplification
2025-01-08 09:47:34,167 - INFO - Step 3 result: {'type': 'Program', 'name': '_setup_oauth_flow', 'range': [939, 1006], 'children': [{'type': 'FunctionDeclaration', 'name': '_setup_oauth_flow', 'range': [939, 1006], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [942, 942], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [944, 949], 'children': [{'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [946, 949], 'children': []}]}, {'type': 'ReturnType', 'name': 'Flow', 'range': [953, 953], 'children': []}, {'type': 'Block', 'name': '', 'range': [955, 1006], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [956, 1004], 'children': [{'type': 'CallExpression', 'name': 'Flow.from_client_config', 'range': [957, 1004], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [962, 996], 'children': [{'type': 'Property', 'name': 'web', 'range': [964, 994], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [966, 994], 'children': [{'type': 'Property', 'name': 'client_id', 'range': [968, 972], 'children': [{'type': 'MemberExpression', 'name': 'self.client_id', 'range': [970, 972], 'children': []}]}, {'type': 'Property', 'name': 'client_secret', 'range': [975, 979], 'children': [{'type': 'MemberExpression', 'name': 'self.client_secret', 'range': [977, 979], 'children': []}]}, {'type': 'Property', 'name': 'auth_uri', 'range': [982, 984], 'children': [{'type': 'StringLiteral', 'name': 'https://accounts.google.com/o/oauth2/auth', 'range': [984, 984], 'children': []}]}, {'type': 'Property', 'name': 'token_uri', 'range': [987, 991], 'children': [{'type': 'MemberExpression', 'name': 'self.token_uri', 'range': [989, 991], 'children': []}]}]}]}]}, {'type': 'Argument', 'name': 'scopes', 'range': [999, 1001], 'children': []}]}]}]}]}]}
2025-01-08 09:47:34,167 - INFO - Starting Step 4: AST normalization
2025-01-08 09:47:41,733 - INFO - Step 3 result: {'type': 'Program', 'name': 'revoke_tokens', 'range': [599, 658], 'children': [{'type': 'FunctionDeclaration', 'name': 'revoke_tokens', 'range': [599, 658], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [601, 607], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [602, 602], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [604, 606], 'children': []}]}, {'type': 'ReturnType', 'name': 'bool', 'range': [610, 610], 'children': []}, {'type': 'Block', 'name': 'function_body', 'range': [612, 658], 'children': [{'type': 'VariableDeclaration', 'name': 'session', 'range': [613, 618], 'children': [{'type': 'Assignment', 'name': '=', 'range': [614, 614], 'children': []}, {'type': 'FunctionCall', 'name': 'AuthorizedSession', 'range': [615, 618], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [616, 618], 'children': [{'type': 'Argument', 'name': 'credentials', 'range': [617, 617], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'session.post', 'range': [620, 654], 'children': [{'type': 'FunctionCall', 'name': 'post', 'range': [622, 654], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [623, 654], 'children': [{'type': 'Argument', 'name': 'self.revoke_uri', 'range': [625, 627], 'children': []}, {'type': 'KeywordArgument', 'name': 'params', 'range': [630, 642], 'children': [{'type': 'Dictionary', 'name': 'params', 'range': [632, 642], 'children': [{'type': 'KeyValuePair', 'name': 'token', 'range': [633, 641], 'children': [{'type': 'Value', 'name': 'credentials.access_token.get_secret_value', 'range': [635, 641], 'children': []}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [645, 651], 'children': [{'type': 'Dictionary', 'name': 'headers', 'range': [647, 651], 'children': [{'type': 'KeyValuePair', 'name': 'content-type', 'range': [648, 650], 'children': [{'type': 'Value', 'name': 'application/x-www-form-urlencoded', 'range': [650, 650], 'children': []}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [656, 657], 'children': [{'type': 'ReturnValue', 'name': 'True', 'range': [657, 657], 'children': []}]}]}]}]}
2025-01-08 09:47:41,734 - INFO - Starting Step 4: AST normalization
2025-01-08 09:47:42,855 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_login_url', 'range': [207, 300], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_login_url', 'range': [207, 226], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [210, 210], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [212, 217], 'children': [{'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [214, 217], 'children': []}]}, {'type': 'Parameter', 'name': 'state', 'range': [219, 221], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [221, 221], 'children': []}]}, {'type': 'ReturnType', 'name': 'str', 'range': [225, 225], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [227, 300], 'children': [{'type': 'VariableDeclaration', 'name': 'all_scopes', 'range': [228, 240], 'children': [{'type': 'Assignment', 'name': '=', 'range': [229, 229], 'children': []}, {'type': 'Expression', 'name': 'list(set(scopes + self.DEFAULT_SCOPES))', 'range': [230, 240], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [242, 248], 'children': [{'type': 'CallExpression', 'name': 'debug', 'range': [244, 248], 'children': [{'type': 'Argument', 'name': 'f"Setting up OAuth flow with scopes: {all_scopes}"', 'range': [246, 247], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'flow', 'range': [250, 258], 'children': [{'type': 'Assignment', 'name': '=', 'range': [251, 251], 'children': []}, {'type': 'Expression', 'name': 'self._setup_oauth_flow(all_scopes)', 'range': [252, 258], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'flow.redirect_uri', 'range': [259, 266], 'children': [{'type': 'Assignment', 'name': '=', 'range': [262, 262], 'children': []}, {'type': 'Expression', 'name': 'self.redirect_uri', 'range': [263, 266], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'authorization_url', 'range': [267, 297], 'children': [{'type': 'Assignment', 'name': '=', 'range': [270, 270], 'children': []}, {'type': 'Expression', 'name': 'flow.authorization_url(access_type="offline", include_granted_scopes="true", state=state, prompt="consent")', 'range': [271, 297], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [298, 300], 'children': [{'type': 'Expression', 'name': 'authorization_url', 'range': [299, 299], 'children': []}]}]}]}
2025-01-08 09:47:42,855 - INFO - Starting Step 4: AST normalization
2025-01-08 09:47:44,059 - INFO - Step 4 result: {'nodes': [{'type': 'ClassDecl', 'name': 'GoogleOAuthHandler', 'range': [105, 111], 'children': [{'type': 'Inheritance', 'name': 'BaseOAuthHandler', 'range': [107, 109], 'children': []}, {'type': 'Docstring', 'name': '', 'range': [112, 114], 'children': []}, {'type': 'Comment', 'name': '# noqa', 'range': [115, 117], 'children': []}]}, {'type': 'VariableDecl', 'name': 'PROVIDER_NAME', 'range': [119, 124], 'children': [{'type': 'Assignment', 'name': '=', 'range': [120, 121], 'children': [{'type': 'Literal', 'name': 'ProviderName.GOOGLE', 'range': [121, 123], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'EMAIL_ENDPOINT', 'range': [125, 128], 'children': [{'type': 'Assignment', 'name': '=', 'range': [126, 127], 'children': [{'type': 'Literal', 'name': '"https://www.googleapis.com/oauth2/v2/userinfo"', 'range': [127, 127], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'DEFAULT_SCOPES', 'range': [129, 143], 'children': [{'type': 'Assignment', 'name': '=', 'range': [130, 131], 'children': [{'type': 'Array', 'name': '', 'range': [131, 142], 'children': [{'type': 'Literal', 'name': '"https://www.googleapis.com/auth/userinfo.email"', 'range': [133, 133], 'children': []}, {'type': 'Literal', 'name': '"https://www.googleapis.com/auth/userinfo.profile"', 'range': [136, 136], 'children': []}, {'type': 'Literal', 'name': '"openid"', 'range': [139, 139], 'children': []}]}]}]}]}
2025-01-08 09:47:44,060 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:47:47,279 - INFO - Step 3 result: {'type': 'Program', 'name': 'exchange_code_for_tokens', 'range': [301, 598], 'children': [{'type': 'FunctionDeclaration', 'name': 'exchange_code_for_tokens', 'range': [301, 598], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [303, 318], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [305, 305], 'children': []}, {'type': 'Parameter', 'name': 'code', 'range': [307, 309], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [311, 316], 'children': []}]}, {'type': 'ReturnType', 'name': 'OAuth2Credentials', 'range': [319, 321], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [322, 598], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [324, 330], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow = self._setup_oauth_flow', 'range': [342, 349], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow.redirect_uri = self.redirect_uri', 'range': [351, 358], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [360, 365], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow.oauth2session.scope = None', 'range': [375, 381], 'children': []}, {'type': 'AssignmentExpression', 'name': 'token = flow.fetch_token', 'range': [383, 392], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [394, 399], 'children': []}, {'type': 'AssignmentExpression', 'name': 'granted_scopes = token.get', 'range': [411, 426], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [429, 435], 'children': []}, {'type': 'AssignmentExpression', 'name': 'google_creds = flow.credentials', 'range': [438, 443], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [444, 450], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [453, 458], 'children': []}, {'type': 'AssignmentExpression', 'name': 'username = self._request_email', 'range': [460, 467], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [469, 475], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.token', 'range': [478, 482], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.refresh_token', 'range': [483, 487], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.expiry', 'range': [488, 492], 'children': []}, {'type': 'AssertStatement', 'name': 'assert granted_scopes', 'range': [493, 495], 'children': []}, {'type': 'AssignmentExpression', 'name': 'credentials = OAuth2Credentials', 'range': [505, 583], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [585, 593], 'children': []}, {'type': 'ReturnStatement', 'name': 'return credentials', 'range': [596, 597], 'children': []}]}]}]}
2025-01-08 09:47:47,280 - INFO - Starting Step 4: AST normalization
2025-01-08 09:47:48,911 - INFO - Step 2 result: {'type': 'Program', 'name': '_refresh_tokens', 'range': [728, 938], 'children': [{'type': 'FunctionDeclaration', 'name': '_refresh_tokens', 'range': [728, 937], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [730, 736], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [731, 731], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [733, 735], 'children': []}]}, {'type': 'ReturnType', 'name': 'OAuth2Credentials', 'range': [737, 739], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [740, 937], 'children': [{'type': 'Comment', 'name': 'Google credentials should ALWAYS have a refresh token', 'range': [742, 751], 'children': []}, {'type': 'AssertStatement', 'name': 'assert', 'range': [752, 756], 'children': [{'type': 'Expression', 'name': 'credentials.refresh_token', 'range': [753, 755], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'google_creds', 'range': [758, 813], 'children': [{'type': 'Assignment', 'name': '=', 'range': [759, 813], 'children': [{'type': 'NewExpression', 'name': 'Credentials', 'range': [760, 813], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [761, 813], 'children': [{'type': 'NamedArgument', 'name': 'token', 'range': [763, 771], 'children': [{'type': 'Expression', 'name': 'credentials.access_token.get_secret_value()', 'range': [765, 771], 'children': []}]}, {'type': 'NamedArgument', 'name': 'refresh_token', 'range': [774, 782], 'children': [{'type': 'Expression', 'name': 'credentials.refresh_token.get_secret_value()', 'range': [776, 782], 'children': []}]}, {'type': 'NamedArgument', 'name': 'token_uri', 'range': [785, 790], 'children': [{'type': 'Expression', 'name': 'self.token_uri', 'range': [787, 790], 'children': []}]}, {'type': 'NamedArgument', 'name': 'client_id', 'range': [792, 797], 'children': [{'type': 'Expression', 'name': 'self.client_id', 'range': [794, 797], 'children': []}]}, {'type': 'NamedArgument', 'name': 'client_secret', 'range': [799, 804], 'children': [{'type': 'Expression', 'name': 'self.client_secret', 'range': [801, 804], 'children': []}]}, {'type': 'NamedArgument', 'name': 'scopes', 'range': [806, 811], 'children': [{'type': 'Expression', 'name': 'credentials.scopes', 'range': [808, 811], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': "Google's OAuth library is poorly typed so we need some of these:", 'range': [815, 831], 'children': []}, {'type': 'AssertStatement', 'name': 'assert', 'range': [832, 836], 'children': [{'type': 'Expression', 'name': 'google_creds.refresh_token', 'range': [833, 835], 'children': []}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [837, 841], 'children': [{'type': 'Expression', 'name': 'google_creds.scopes', 'range': [838, 840], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'google_creds.refresh(Request())', 'range': [843, 850], 'children': [{'type': 'CallExpression', 'name': 'refresh', 'range': [845, 850], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [846, 850], 'children': [{'type': 'NewExpression', 'name': 'Request', 'range': [847, 849], 'children': []}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [852, 856], 'children': [{'type': 'Expression', 'name': 'google_creds.expiry', 'range': [853, 855], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [858, 937], 'children': [{'type': 'NewExpression', 'name': 'OAuth2Credentials', 'range': [859, 936], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [860, 936], 'children': [{'type': 'NamedArgument', 'name': 'provider', 'range': [862, 867], 'children': [{'type': 'Expression', 'name': 'self.PROVIDER_NAME', 'range': [864, 867], 'children': []}]}, {'type': 'NamedArgument', 'name': 'id', 'range': [869, 874], 'children': [{'type': 'Expression', 'name': 'credentials.id', 'range': [871, 874], 'children': []}]}, {'type': 'NamedArgument', 'name': 'title', 'range': [876, 881], 'children': [{'type': 'Expression', 'name': 'credentials.title', 'range': [878, 881], 'children': []}]}, {'type': 'NamedArgument', 'name': 'username', 'range': [883, 888], 'children': [{'type': 'Expression', 'name': 'credentials.username', 'range': [885, 888], 'children': []}]}, {'type': 'NamedArgument', 'name': 'access_token', 'range': [890, 897], 'children': [{'type': 'NewExpression', 'name': 'SecretStr', 'range': [892, 897], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [893, 897], 'children': [{'type': 'Expression', 'name': 'google_creds.token', 'range': [894, 896], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'refresh_token', 'range': [900, 907], 'children': [{'type': 'NewExpression', 'name': 'SecretStr', 'range': [902, 907], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [903, 907], 'children': [{'type': 'Expression', 'name': 'google_creds.refresh_token', 'range': [904, 906], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'access_token_expires_at', 'range': [910, 921], 'children': [{'type': 'CallExpression', 'name': 'int', 'range': [912, 921], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [913, 921], 'children': [{'type': 'CallExpression', 'name': 'timestamp', 'range': [918, 920], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'refresh_token_expires_at', 'range': [924, 927], 'children': [{'type': 'Expression', 'name': 'None', 'range': [926, 926], 'children': []}]}, {'type': 'NamedArgument', 'name': 'scopes', 'range': [929, 934], 'children': [{'type': 'Expression', 'name': 'google_creds.scopes', 'range': [931, 933], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:47:48,911 - INFO - Starting Step 3: AST simplification
2025-01-08 09:47:49,519 - INFO - Step 3 result: {'type': 'Program', 'name': '__init__', 'range': [157, 206], 'children': [{'type': 'FunctionDeclaration', 'name': '__init__', 'range': [157, 206], 'children': [{'type': 'ParameterList', 'name': '', 'range': [159, 173], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [160, 160], 'children': []}, {'type': 'Parameter', 'name': 'client_id', 'range': [162, 164], 'children': []}, {'type': 'Parameter', 'name': 'client_secret', 'range': [166, 168], 'children': []}, {'type': 'Parameter', 'name': 'redirect_uri', 'range': [170, 172], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [174, 206], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [176, 180], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [176, 178], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [176, 176], 'children': []}, {'type': 'Identifier', 'name': 'client_id', 'range': [178, 178], 'children': []}]}, {'type': 'Identifier', 'name': 'client_id', 'range': [180, 180], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [182, 186], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [182, 184], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [182, 182], 'children': []}, {'type': 'Identifier', 'name': 'client_secret', 'range': [184, 184], 'children': []}]}, {'type': 'Identifier', 'name': 'client_secret', 'range': [186, 186], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [188, 192], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [188, 190], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [188, 188], 'children': []}, {'type': 'Identifier', 'name': 'redirect_uri', 'range': [190, 190], 'children': []}]}, {'type': 'Identifier', 'name': 'redirect_uri', 'range': [192, 192], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [194, 198], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [194, 196], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [194, 194], 'children': []}, {'type': 'Identifier', 'name': 'token_uri', 'range': [196, 196], 'children': []}]}, {'type': 'Literal', 'name': '"https://oauth2.googleapis.com/token"', 'range': [198, 198], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [200, 204], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [200, 202], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [200, 200], 'children': []}, {'type': 'Identifier', 'name': 'revoke_uri', 'range': [202, 202], 'children': []}]}, {'type': 'Literal', 'name': '"https://oauth2.googleapis.com/revoke"', 'range': [204, 204], 'children': []}]}]}]}]}
2025-01-08 09:47:49,519 - INFO - Starting Step 4: AST normalization
2025-01-08 09:47:49,566 - INFO - Step 4 result: {'type': 'Program', 'name': '_setup_oauth_flow', 'range': [939, 1006], 'children': [{'type': 'FunctionDecl', 'name': '_setup_oauth_flow', 'range': [939, 1006], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [942, 942], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [944, 949], 'children': [{'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [946, 949], 'children': []}]}, {'type': 'ReturnType', 'name': 'Flow', 'range': [953, 953], 'children': []}, {'type': 'Block', 'name': '', 'range': [955, 1006], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [956, 1004], 'children': [{'type': 'CallExpression', 'name': 'Flow.from_client_config', 'range': [957, 1004], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [962, 996], 'children': [{'type': 'Property', 'name': 'web', 'range': [964, 994], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [966, 994], 'children': [{'type': 'Property', 'name': 'client_id', 'range': [968, 972], 'children': [{'type': 'MemberExpression', 'name': 'self.client_id', 'range': [970, 972], 'children': []}]}, {'type': 'Property', 'name': 'client_secret', 'range': [975, 979], 'children': [{'type': 'MemberExpression', 'name': 'self.client_secret', 'range': [977, 979], 'children': []}]}, {'type': 'Property', 'name': 'auth_uri', 'range': [982, 984], 'children': [{'type': 'StringLiteral', 'name': 'https://accounts.google.com/o/oauth2/auth', 'range': [984, 984], 'children': []}]}, {'type': 'Property', 'name': 'token_uri', 'range': [987, 991], 'children': [{'type': 'MemberExpression', 'name': 'self.token_uri', 'range': [989, 991], 'children': []}]}]}]}]}, {'type': 'Argument', 'name': 'scopes', 'range': [999, 1001], 'children': []}]}]}]}]}]}
2025-01-08 09:47:49,566 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:47:55,487 - INFO - Step 3 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [4, 19], 'children': [{'type': 'ImportSpecifier', 'name': 'google.auth.external_account_authorized_user', 'range': [5, 9], 'children': [{'type': 'ImportAlias', 'name': 'Credentials', 'alias': 'ExternalAccountCredentials', 'range': [13, 15], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [20, 32], 'children': [{'type': 'ImportSpecifier', 'name': 'google.auth.transport.requests', 'range': [21, 27], 'children': [{'type': 'ImportSpecifier', 'name': 'AuthorizedSession', 'range': [29, 29], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Request', 'range': [31, 31], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [33, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'google.oauth2.credentials', 'range': [34, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'Credentials', 'range': [40, 40], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [42, 48], 'children': [{'type': 'ImportSpecifier', 'name': 'google_auth_oauthlib.flow', 'range': [43, 45], 'children': [{'type': 'ImportSpecifier', 'name': 'Flow', 'range': [47, 47], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [49, 53], 'children': [{'type': 'ImportSpecifier', 'name': 'pydantic', 'range': [50, 50], 'children': [{'type': 'ImportSpecifier', 'name': 'SecretStr', 'range': [52, 52], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [55, 63], 'children': [{'type': 'ImportSpecifier', 'name': 'backend.data.model', 'range': [56, 60], 'children': [{'type': 'ImportSpecifier', 'name': 'OAuth2Credentials', 'range': [62, 62], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [64, 72], 'children': [{'type': 'ImportSpecifier', 'name': 'backend.integrations.providers', 'range': [65, 69], 'children': [{'type': 'ImportSpecifier', 'name': 'ProviderName', 'range': [71, 71], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [74, 79], 'children': [{'type': 'ImportSpecifier', 'name': '.base', 'range': [75, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseOAuthHandler', 'range': [78, 78], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [81, 89], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [82, 88], 'children': [{'type': 'CallExpression', 'name': 'logging.getLogger', 'range': [83, 87], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [87, 87], 'children': []}]}]}]}]}
2025-01-08 09:47:55,487 - INFO - Starting Step 4: AST normalization
2025-01-08 09:47:57,177 - INFO - Step 5 result: {'type': 'Program', 'name': 'MainProgram', 'range': [105, 143], 'children': [{'type': 'ClassDecl', 'name': 'GoogleOAuthHandler', 'range': [105, 111], 'children': [{'type': 'Inheritance', 'name': 'BaseOAuthHandler', 'range': [107, 109], 'children': []}, {'type': 'Docstring', 'name': '', 'range': [112, 114], 'children': []}, {'type': 'Comment', 'name': '# noqa', 'range': [115, 117], 'children': []}]}, {'type': 'VariableDecl', 'name': 'PROVIDER_NAME', 'range': [119, 124], 'children': [{'type': 'Assignment', 'name': '=', 'range': [120, 121], 'children': [{'type': 'Literal', 'name': 'ProviderName.GOOGLE', 'range': [121, 123], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'EMAIL_ENDPOINT', 'range': [125, 128], 'children': [{'type': 'Assignment', 'name': '=', 'range': [126, 127], 'children': [{'type': 'Literal', 'name': '"https://www.googleapis.com/oauth2/v2/userinfo"', 'range': [127, 127], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'DEFAULT_SCOPES', 'range': [129, 143], 'children': [{'type': 'Assignment', 'name': '=', 'range': [130, 131], 'children': [{'type': 'Array', 'name': '', 'range': [131, 142], 'children': [{'type': 'Literal', 'name': '"https://www.googleapis.com/auth/userinfo.email"', 'range': [133, 133], 'children': []}, {'type': 'Literal', 'name': '"https://www.googleapis.com/auth/userinfo.profile"', 'range': [136, 136], 'children': []}, {'type': 'Literal', 'name': '"openid"', 'range': [139, 139], 'children': []}]}]}]}]}
2025-01-08 09:47:57,177 - INFO - Completed main AST analysis flow
2025-01-08 09:47:57,178 - INFO - Successfully processed chunk
2025-01-08 09:48:00,575 - INFO - Step 3 result: {'type': 'Program', 'name': '_request_email', 'range': [659, 726], 'children': [{'type': 'FunctionDeclaration', 'name': '_request_email', 'range': [659, 726], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [661, 671], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [663, 663], 'children': []}, {'type': 'Parameter', 'name': 'creds', 'range': [665, 669], 'children': [{'type': 'TypeAnnotation', 'name': 'Credentials | ExternalAccountCredentials', 'range': [667, 669], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'str | None', 'range': [672, 676], 'children': []}, {'type': 'BlockStatement', 'name': 'body', 'range': [678, 726], 'children': [{'type': 'VariableDeclaration', 'name': 'session', 'range': [679, 684], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [680, 684], 'children': [{'type': 'NewExpression', 'name': 'AuthorizedSession', 'range': [681, 684], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [683, 684], 'children': [{'type': 'Identifier', 'name': 'creds', 'range': [683, 683], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'response', 'range': [686, 695], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [687, 695], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [690, 695], 'children': [{'type': 'MemberExpression', 'name': 'session.get', 'range': [688, 690], 'children': [{'type': 'Identifier', 'name': 'session', 'range': [688, 688], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [692, 695], 'children': [{'type': 'MemberExpression', 'name': 'self.EMAIL_ENDPOINT', 'range': [692, 694], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [692, 692], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [697, 715], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [698, 702], 'children': [{'type': 'MemberExpression', 'name': 'response.ok', 'range': [699, 701], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [699, 699], 'children': []}]}]}, {'type': 'BlockStatement', 'name': 'consequent', 'range': [703, 715], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [704, 712], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [706, 712], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [704, 706], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [704, 704], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [708, 712], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to get user email. Status code: {response.status_code}"', 'range': [709, 710], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [714, 715], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [715, 715], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [717, 726], 'children': [{'type': 'MemberExpression', 'name': 'response.json', 'range': [718, 720], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [718, 718], 'children': []}]}, {'type': 'CallExpression', 'name': 'json', 'range': [720, 725], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [722, 725], 'children': [{'type': 'StringLiteral', 'name': '"email"', 'range': [724, 724], 'children': []}]}]}]}]}]}]}
2025-01-08 09:48:00,575 - INFO - Starting Step 4: AST normalization
2025-01-08 09:48:01,873 - INFO - Step 4 result: {'type': 'Program', 'name': 'revoke_tokens', 'range': [599, 658], 'children': [{'type': 'FunctionDecl', 'name': 'revoke_tokens', 'range': [599, 658], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [601, 607], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [602, 602], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [604, 606], 'children': []}]}, {'type': 'ReturnType', 'name': 'bool', 'range': [610, 610], 'children': []}, {'type': 'Block', 'name': 'function_body', 'range': [612, 658], 'children': [{'type': 'VariableDecl', 'name': 'session', 'range': [613, 618], 'children': [{'type': 'Assignment', 'name': '=', 'range': [614, 614], 'children': []}, {'type': 'CallExpression', 'name': 'AuthorizedSession', 'range': [615, 618], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [616, 618], 'children': [{'type': 'Argument', 'name': 'credentials', 'range': [617, 617], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'session.post', 'range': [620, 654], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [622, 654], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [623, 654], 'children': [{'type': 'Argument', 'name': 'self.revoke_uri', 'range': [625, 627], 'children': []}, {'type': 'KeywordArgument', 'name': 'params', 'range': [630, 642], 'children': [{'type': 'Dictionary', 'name': 'params', 'range': [632, 642], 'children': [{'type': 'KeyValuePair', 'name': 'token', 'range': [633, 641], 'children': [{'type': 'CallExpression', 'name': 'get_secret_value', 'range': [635, 641], 'children': [{'type': 'MemberExpression', 'name': 'access_token', 'range': [635, 641], 'children': [{'type': 'Identifier', 'name': 'credentials', 'range': [635, 641], 'children': []}]}]}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [645, 651], 'children': [{'type': 'Dictionary', 'name': 'headers', 'range': [647, 651], 'children': [{'type': 'KeyValuePair', 'name': 'content-type', 'range': [648, 650], 'children': [{'type': 'Literal', 'name': 'application/x-www-form-urlencoded', 'range': [650, 650], 'children': []}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [656, 657], 'children': [{'type': 'Literal', 'name': 'True', 'range': [657, 657], 'children': []}]}]}]}]}
2025-01-08 09:48:01,873 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:48:02,068 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_login_url', 'range': [207, 300], 'children': [{'type': 'FunctionDecl', 'name': 'get_login_url', 'range': [207, 226], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [210, 210], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [212, 217], 'children': [{'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [214, 217], 'children': []}]}, {'type': 'Parameter', 'name': 'state', 'range': [219, 221], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [221, 221], 'children': []}]}, {'type': 'ReturnType', 'name': 'str', 'range': [225, 225], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [227, 300], 'children': [{'type': 'VariableDecl', 'name': 'all_scopes', 'range': [228, 240], 'children': [{'type': 'Assignment', 'name': '=', 'range': [229, 229], 'children': []}, {'type': 'CallExpression', 'name': 'list(set(scopes + self.DEFAULT_SCOPES))', 'range': [230, 240], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [242, 248], 'children': [{'type': 'CallExpression', 'name': 'debug', 'range': [244, 248], 'children': [{'type': 'Literal', 'name': 'f"Setting up OAuth flow with scopes: {all_scopes}"', 'range': [246, 247], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'flow', 'range': [250, 258], 'children': [{'type': 'Assignment', 'name': '=', 'range': [251, 251], 'children': []}, {'type': 'CallExpression', 'name': 'self._setup_oauth_flow(all_scopes)', 'range': [252, 258], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'flow.redirect_uri', 'range': [259, 266], 'children': [{'type': 'Assignment', 'name': '=', 'range': [262, 262], 'children': []}, {'type': 'Identifier', 'name': 'self.redirect_uri', 'range': [263, 266], 'children': []}]}, {'type': 'VariableDecl', 'name': 'authorization_url', 'range': [267, 297], 'children': [{'type': 'Assignment', 'name': '=', 'range': [270, 270], 'children': []}, {'type': 'CallExpression', 'name': 'flow.authorization_url(access_type="offline", include_granted_scopes="true", state=state, prompt="consent")', 'range': [271, 297], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [298, 300], 'children': [{'type': 'Identifier', 'name': 'authorization_url', 'range': [299, 299], 'children': []}]}]}]}
2025-01-08 09:48:02,068 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:48:04,846 - INFO - Step 5 result: {'type': 'Program', 'name': '_setup_oauth_flow', 'range': [939, 1006], 'children': [{'type': 'FunctionDecl', 'name': '_setup_oauth_flow', 'range': [939, 1006], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [942, 942], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [944, 949], 'children': [{'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [946, 949], 'children': []}]}, {'type': 'ReturnType', 'name': 'Flow', 'range': [953, 953], 'children': []}, {'type': 'Block', 'name': '', 'range': [955, 1006], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [956, 1004], 'children': [{'type': 'CallExpression', 'name': 'Flow.from_client_config', 'range': [957, 1004], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [962, 996], 'children': [{'type': 'Property', 'name': 'web', 'range': [964, 994], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [966, 994], 'children': [{'type': 'Property', 'name': 'client_id', 'range': [968, 972], 'children': [{'type': 'MemberExpression', 'name': 'self.client_id', 'range': [970, 972], 'children': []}]}, {'type': 'Property', 'name': 'client_secret', 'range': [975, 979], 'children': [{'type': 'MemberExpression', 'name': 'self.client_secret', 'range': [977, 979], 'children': []}]}, {'type': 'Property', 'name': 'auth_uri', 'range': [982, 984], 'children': [{'type': 'StringLiteral', 'name': 'https://accounts.google.com/o/oauth2/auth', 'range': [984, 984], 'children': []}]}, {'type': 'Property', 'name': 'token_uri', 'range': [987, 991], 'children': [{'type': 'MemberExpression', 'name': 'self.token_uri', 'range': [989, 991], 'children': []}]}]}]}]}, {'type': 'Argument', 'name': 'scopes', 'range': [999, 1001], 'children': []}]}]}]}]}]}
2025-01-08 09:48:04,847 - INFO - Completed main AST analysis flow
2025-01-08 09:48:04,847 - INFO - Successfully processed chunk
2025-01-08 09:48:08,237 - INFO - Step 4 result: {'type': 'Program', 'name': 'exchange_code_for_tokens', 'range': [301, 598], 'children': [{'type': 'FunctionDecl', 'name': 'exchange_code_for_tokens', 'range': [301, 598], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [303, 318], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [305, 305], 'children': []}, {'type': 'Parameter', 'name': 'code', 'range': [307, 309], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [311, 316], 'children': []}]}, {'type': 'ReturnType', 'name': 'OAuth2Credentials', 'range': [319, 321], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [322, 598], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [324, 330], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow = self._setup_oauth_flow', 'range': [342, 349], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow.redirect_uri = self.redirect_uri', 'range': [351, 358], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [360, 365], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow.oauth2session.scope = None', 'range': [375, 381], 'children': []}, {'type': 'AssignmentExpression', 'name': 'token = flow.fetch_token', 'range': [383, 392], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [394, 399], 'children': []}, {'type': 'AssignmentExpression', 'name': 'granted_scopes = token.get', 'range': [411, 426], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [429, 435], 'children': []}, {'type': 'AssignmentExpression', 'name': 'google_creds = flow.credentials', 'range': [438, 443], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [444, 450], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [453, 458], 'children': []}, {'type': 'AssignmentExpression', 'name': 'username = self._request_email', 'range': [460, 467], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [469, 475], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.token', 'range': [478, 482], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.refresh_token', 'range': [483, 487], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.expiry', 'range': [488, 492], 'children': []}, {'type': 'AssertStatement', 'name': 'assert granted_scopes', 'range': [493, 495], 'children': []}, {'type': 'AssignmentExpression', 'name': 'credentials = OAuth2Credentials', 'range': [505, 583], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [585, 593], 'children': []}, {'type': 'ReturnStatement', 'name': 'return credentials', 'range': [596, 597], 'children': []}]}]}]}
2025-01-08 09:48:08,237 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:48:13,544 - INFO - Step 4 result: {'type': 'Program', 'name': '__init__', 'range': [157, 206], 'children': [{'type': 'FunctionDecl', 'name': '__init__', 'range': [157, 206], 'children': [{'type': 'ParameterList', 'name': '', 'range': [159, 173], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [160, 160], 'children': []}, {'type': 'Parameter', 'name': 'client_id', 'range': [162, 164], 'children': []}, {'type': 'Parameter', 'name': 'client_secret', 'range': [166, 168], 'children': []}, {'type': 'Parameter', 'name': 'redirect_uri', 'range': [170, 172], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [174, 206], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [176, 180], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [176, 178], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [176, 176], 'children': []}, {'type': 'Identifier', 'name': 'client_id', 'range': [178, 178], 'children': []}]}, {'type': 'Identifier', 'name': 'client_id', 'range': [180, 180], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [182, 186], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [182, 184], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [182, 182], 'children': []}, {'type': 'Identifier', 'name': 'client_secret', 'range': [184, 184], 'children': []}]}, {'type': 'Identifier', 'name': 'client_secret', 'range': [186, 186], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [188, 192], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [188, 190], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [188, 188], 'children': []}, {'type': 'Identifier', 'name': 'redirect_uri', 'range': [190, 190], 'children': []}]}, {'type': 'Identifier', 'name': 'redirect_uri', 'range': [192, 192], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [194, 198], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [194, 196], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [194, 194], 'children': []}, {'type': 'Identifier', 'name': 'token_uri', 'range': [196, 196], 'children': []}]}, {'type': 'Literal', 'name': '"https://oauth2.googleapis.com/token"', 'range': [198, 198], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [200, 204], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [200, 202], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [200, 200], 'children': []}, {'type': 'Identifier', 'name': 'revoke_uri', 'range': [202, 202], 'children': []}]}, {'type': 'Literal', 'name': '"https://oauth2.googleapis.com/revoke"', 'range': [204, 204], 'children': []}]}]}]}]}
2025-01-08 09:48:13,544 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:48:18,939 - INFO - Step 4 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [4, 19], 'children': [{'type': 'ImportSpecifier', 'name': 'google.auth.external_account_authorized_user', 'range': [5, 9], 'children': [{'type': 'ImportAlias', 'name': 'Credentials', 'alias': 'ExternalAccountCredentials', 'range': [13, 15], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [20, 32], 'children': [{'type': 'ImportSpecifier', 'name': 'google.auth.transport.requests', 'range': [21, 27], 'children': [{'type': 'ImportSpecifier', 'name': 'AuthorizedSession', 'range': [29, 29], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Request', 'range': [31, 31], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [33, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'google.oauth2.credentials', 'range': [34, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'Credentials', 'range': [40, 40], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [42, 48], 'children': [{'type': 'ImportSpecifier', 'name': 'google_auth_oauthlib.flow', 'range': [43, 45], 'children': [{'type': 'ImportSpecifier', 'name': 'Flow', 'range': [47, 47], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [49, 53], 'children': [{'type': 'ImportSpecifier', 'name': 'pydantic', 'range': [50, 50], 'children': [{'type': 'ImportSpecifier', 'name': 'SecretStr', 'range': [52, 52], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [55, 63], 'children': [{'type': 'ImportSpecifier', 'name': 'backend.data.model', 'range': [56, 60], 'children': [{'type': 'ImportSpecifier', 'name': 'OAuth2Credentials', 'range': [62, 62], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [64, 72], 'children': [{'type': 'ImportSpecifier', 'name': 'backend.integrations.providers', 'range': [65, 69], 'children': [{'type': 'ImportSpecifier', 'name': 'ProviderName', 'range': [71, 71], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [74, 79], 'children': [{'type': 'ImportSpecifier', 'name': '.base', 'range': [75, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseOAuthHandler', 'range': [78, 78], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [81, 89], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [82, 88], 'children': [{'type': 'CallExpression', 'name': 'logging.getLogger', 'range': [83, 87], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [87, 87], 'children': []}]}]}]}]}
2025-01-08 09:48:18,940 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:48:22,892 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_login_url', 'range': [207, 300], 'children': [{'type': 'FunctionDecl', 'name': 'get_login_url', 'range': [207, 226], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [210, 210], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [212, 217], 'children': [{'type': 'TypeAnnotation', 'name': 'list[str]', 'range': [214, 217], 'children': []}]}, {'type': 'Parameter', 'name': 'state', 'range': [219, 221], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [221, 221], 'children': []}]}, {'type': 'ReturnType', 'name': 'str', 'range': [225, 225], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [227, 300], 'children': [{'type': 'VariableDecl', 'name': 'all_scopes', 'range': [228, 240], 'children': [{'type': 'Assignment', 'name': '=', 'range': [229, 229], 'children': []}, {'type': 'CallExpression', 'name': 'list(set(scopes + self.DEFAULT_SCOPES))', 'range': [230, 240], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [242, 248], 'children': [{'type': 'CallExpression', 'name': 'debug', 'range': [244, 248], 'children': [{'type': 'Literal', 'name': 'f"Setting up OAuth flow with scopes: {all_scopes}"', 'range': [246, 247], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'flow', 'range': [250, 258], 'children': [{'type': 'Assignment', 'name': '=', 'range': [251, 251], 'children': []}, {'type': 'CallExpression', 'name': 'self._setup_oauth_flow(all_scopes)', 'range': [252, 258], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'flow.redirect_uri', 'range': [259, 266], 'children': [{'type': 'Assignment', 'name': '=', 'range': [262, 262], 'children': []}, {'type': 'Identifier', 'name': 'self.redirect_uri', 'range': [263, 266], 'children': []}]}, {'type': 'VariableDecl', 'name': 'authorization_url', 'range': [267, 297], 'children': [{'type': 'Assignment', 'name': '=', 'range': [270, 270], 'children': []}, {'type': 'CallExpression', 'name': 'flow.authorization_url(access_type="offline", include_granted_scopes="true", state=state, prompt="consent")', 'range': [271, 297], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [298, 300], 'children': [{'type': 'Identifier', 'name': 'authorization_url', 'range': [299, 299], 'children': []}]}]}]}
2025-01-08 09:48:22,893 - INFO - Completed main AST analysis flow
2025-01-08 09:48:22,893 - INFO - Successfully processed chunk
2025-01-08 09:48:22,967 - INFO - Step 5 result: {'type': 'Program', 'name': 'revoke_tokens', 'range': [599, 658], 'children': [{'type': 'FunctionDecl', 'name': 'revoke_tokens', 'range': [599, 658], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [601, 607], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [602, 602], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [604, 606], 'children': []}]}, {'type': 'ReturnType', 'name': 'bool', 'range': [610, 610], 'children': []}, {'type': 'Block', 'name': 'function_body', 'range': [612, 658], 'children': [{'type': 'VariableDecl', 'name': 'session', 'range': [613, 618], 'children': [{'type': 'Assignment', 'name': '=', 'range': [614, 614], 'children': []}, {'type': 'CallExpression', 'name': 'AuthorizedSession', 'range': [615, 618], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [616, 618], 'children': [{'type': 'Argument', 'name': 'credentials', 'range': [617, 617], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'session.post', 'range': [620, 654], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [622, 654], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [623, 654], 'children': [{'type': 'Argument', 'name': 'self.revoke_uri', 'range': [625, 627], 'children': []}, {'type': 'KeywordArgument', 'name': 'params', 'range': [630, 642], 'children': [{'type': 'Dictionary', 'name': 'params', 'range': [632, 642], 'children': [{'type': 'KeyValuePair', 'name': 'token', 'range': [633, 641], 'children': [{'type': 'CallExpression', 'name': 'get_secret_value', 'range': [635, 641], 'children': [{'type': 'MemberExpression', 'name': 'access_token', 'range': [635, 641], 'children': [{'type': 'Identifier', 'name': 'credentials', 'range': [635, 641], 'children': []}]}]}]}]}]}, {'type': 'KeywordArgument', 'name': 'headers', 'range': [645, 651], 'children': [{'type': 'Dictionary', 'name': 'headers', 'range': [647, 651], 'children': [{'type': 'KeyValuePair', 'name': 'content-type', 'range': [648, 650], 'children': [{'type': 'Literal', 'name': 'application/x-www-form-urlencoded', 'range': [650, 650], 'children': []}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [656, 657], 'children': [{'type': 'Literal', 'name': 'True', 'range': [657, 657], 'children': []}]}]}]}]}
2025-01-08 09:48:22,968 - INFO - Completed main AST analysis flow
2025-01-08 09:48:22,968 - INFO - Successfully processed chunk
2025-01-08 09:48:28,645 - INFO - Step 4 result: {'type': 'Program', 'name': '_request_email', 'range': [659, 726], 'children': [{'type': 'FunctionDecl', 'name': '_request_email', 'range': [659, 726], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [661, 671], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [663, 663], 'children': []}, {'type': 'Parameter', 'name': 'creds', 'range': [665, 669], 'children': [{'type': 'TypeAnnotation', 'name': 'Credentials | ExternalAccountCredentials', 'range': [667, 669], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'str | None', 'range': [672, 676], 'children': []}, {'type': 'BlockStatement', 'name': 'body', 'range': [678, 726], 'children': [{'type': 'VariableDecl', 'name': 'session', 'range': [679, 684], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [680, 684], 'children': [{'type': 'NewExpression', 'name': 'AuthorizedSession', 'range': [681, 684], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [683, 684], 'children': [{'type': 'Identifier', 'name': 'creds', 'range': [683, 683], 'children': []}]}]}]}]}, {'type': 'VariableDecl', 'name': 'response', 'range': [686, 695], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [687, 695], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [690, 695], 'children': [{'type': 'MemberExpression', 'name': 'session.get', 'range': [688, 690], 'children': [{'type': 'Identifier', 'name': 'session', 'range': [688, 688], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [692, 695], 'children': [{'type': 'MemberExpression', 'name': 'self.EMAIL_ENDPOINT', 'range': [692, 694], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [692, 692], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [697, 715], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [698, 702], 'children': [{'type': 'MemberExpression', 'name': 'response.ok', 'range': [699, 701], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [699, 699], 'children': []}]}]}, {'type': 'BlockStatement', 'name': 'consequent', 'range': [703, 715], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [704, 712], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [706, 712], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [704, 706], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [704, 704], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [708, 712], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to get user email. Status code: {response.status_code}"', 'range': [709, 710], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [714, 715], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [715, 715], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [717, 726], 'children': [{'type': 'MemberExpression', 'name': 'response.json', 'range': [718, 720], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [718, 718], 'children': []}]}, {'type': 'CallExpression', 'name': 'json', 'range': [720, 725], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [722, 725], 'children': [{'type': 'StringLiteral', 'name': '"email"', 'range': [724, 724], 'children': []}]}]}]}]}]}]}
2025-01-08 09:48:28,645 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:48:30,404 - INFO - Step 5 result: {'type': 'Program', 'name': 'exchange_code_for_tokens', 'range': [301, 598], 'children': [{'type': 'FunctionDecl', 'name': 'exchange_code_for_tokens', 'range': [301, 598], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [303, 318], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [305, 305], 'children': []}, {'type': 'Parameter', 'name': 'code', 'range': [307, 309], 'children': []}, {'type': 'Parameter', 'name': 'scopes', 'range': [311, 316], 'children': []}]}, {'type': 'ReturnType', 'name': 'OAuth2Credentials', 'range': [319, 321], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [322, 598], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [324, 330], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow = self._setup_oauth_flow', 'range': [342, 349], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow.redirect_uri = self.redirect_uri', 'range': [351, 358], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [360, 365], 'children': []}, {'type': 'AssignmentExpression', 'name': 'flow.oauth2session.scope = None', 'range': [375, 381], 'children': []}, {'type': 'AssignmentExpression', 'name': 'token = flow.fetch_token', 'range': [383, 392], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [394, 399], 'children': []}, {'type': 'AssignmentExpression', 'name': 'granted_scopes = token.get', 'range': [411, 426], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [429, 435], 'children': []}, {'type': 'AssignmentExpression', 'name': 'google_creds = flow.credentials', 'range': [438, 443], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [444, 450], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [453, 458], 'children': []}, {'type': 'AssignmentExpression', 'name': 'username = self._request_email', 'range': [460, 467], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [469, 475], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.token', 'range': [478, 482], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.refresh_token', 'range': [483, 487], 'children': []}, {'type': 'AssertStatement', 'name': 'assert google_creds.expiry', 'range': [488, 492], 'children': []}, {'type': 'AssertStatement', 'name': 'assert granted_scopes', 'range': [493, 495], 'children': []}, {'type': 'AssignmentExpression', 'name': 'credentials = OAuth2Credentials', 'range': [505, 583], 'children': []}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [585, 593], 'children': []}, {'type': 'ReturnStatement', 'name': 'return credentials', 'range': [596, 597], 'children': []}]}]}]}
2025-01-08 09:48:30,405 - INFO - Completed main AST analysis flow
2025-01-08 09:48:30,405 - INFO - Successfully processed chunk
2025-01-08 09:48:33,878 - INFO - Step 3 result: {'type': 'Program', 'name': '_refresh_tokens', 'range': [728, 938], 'children': [{'type': 'FunctionDeclaration', 'name': '_refresh_tokens', 'range': [728, 937], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [730, 736], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [731, 731], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [733, 735], 'children': []}]}, {'type': 'ReturnType', 'name': 'OAuth2Credentials', 'range': [737, 739], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [740, 937], 'children': [{'type': 'Comment', 'name': 'Google credentials should ALWAYS have a refresh token', 'range': [742, 751], 'children': []}, {'type': 'AssertStatement', 'name': 'assert', 'range': [752, 756], 'children': [{'type': 'Expression', 'name': 'credentials.refresh_token', 'range': [753, 755], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'google_creds', 'range': [758, 813], 'children': [{'type': 'Assignment', 'name': '=', 'range': [759, 813], 'children': [{'type': 'NewExpression', 'name': 'Credentials', 'range': [760, 813], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [761, 813], 'children': [{'type': 'NamedArgument', 'name': 'token', 'range': [763, 771], 'children': [{'type': 'Expression', 'name': 'credentials.access_token.get_secret_value', 'range': [765, 771], 'children': []}]}, {'type': 'NamedArgument', 'name': 'refresh_token', 'range': [774, 782], 'children': [{'type': 'Expression', 'name': 'credentials.refresh_token.get_secret_value', 'range': [776, 782], 'children': []}]}, {'type': 'NamedArgument', 'name': 'token_uri', 'range': [785, 790], 'children': [{'type': 'Expression', 'name': 'self.token_uri', 'range': [787, 790], 'children': []}]}, {'type': 'NamedArgument', 'name': 'client_id', 'range': [792, 797], 'children': [{'type': 'Expression', 'name': 'self.client_id', 'range': [794, 797], 'children': []}]}, {'type': 'NamedArgument', 'name': 'client_secret', 'range': [799, 804], 'children': [{'type': 'Expression', 'name': 'self.client_secret', 'range': [801, 804], 'children': []}]}, {'type': 'NamedArgument', 'name': 'scopes', 'range': [806, 811], 'children': [{'type': 'Expression', 'name': 'credentials.scopes', 'range': [808, 811], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': "Google's OAuth library is poorly typed so we need some of these:", 'range': [815, 831], 'children': []}, {'type': 'AssertStatement', 'name': 'assert', 'range': [832, 836], 'children': [{'type': 'Expression', 'name': 'google_creds.refresh_token', 'range': [833, 835], 'children': []}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [837, 841], 'children': [{'type': 'Expression', 'name': 'google_creds.scopes', 'range': [838, 840], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'google_creds.refresh', 'range': [843, 850], 'children': [{'type': 'CallExpression', 'name': 'refresh', 'range': [845, 850], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [846, 850], 'children': [{'type': 'NewExpression', 'name': 'Request', 'range': [847, 849], 'children': []}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [852, 856], 'children': [{'type': 'Expression', 'name': 'google_creds.expiry', 'range': [853, 855], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [858, 937], 'children': [{'type': 'NewExpression', 'name': 'OAuth2Credentials', 'range': [859, 936], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [860, 936], 'children': [{'type': 'NamedArgument', 'name': 'provider', 'range': [862, 867], 'children': [{'type': 'Expression', 'name': 'self.PROVIDER_NAME', 'range': [864, 867], 'children': []}]}, {'type': 'NamedArgument', 'name': 'id', 'range': [869, 874], 'children': [{'type': 'Expression', 'name': 'credentials.id', 'range': [871, 874], 'children': []}]}, {'type': 'NamedArgument', 'name': 'title', 'range': [876, 881], 'children': [{'type': 'Expression', 'name': 'credentials.title', 'range': [878, 881], 'children': []}]}, {'type': 'NamedArgument', 'name': 'username', 'range': [883, 888], 'children': [{'type': 'Expression', 'name': 'credentials.username', 'range': [885, 888], 'children': []}]}, {'type': 'NamedArgument', 'name': 'access_token', 'range': [890, 897], 'children': [{'type': 'NewExpression', 'name': 'SecretStr', 'range': [892, 897], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [893, 897], 'children': [{'type': 'Expression', 'name': 'google_creds.token', 'range': [894, 896], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'refresh_token', 'range': [900, 907], 'children': [{'type': 'NewExpression', 'name': 'SecretStr', 'range': [902, 907], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [903, 907], 'children': [{'type': 'Expression', 'name': 'google_creds.refresh_token', 'range': [904, 906], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'access_token_expires_at', 'range': [910, 921], 'children': [{'type': 'CallExpression', 'name': 'int', 'range': [912, 921], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [913, 921], 'children': [{'type': 'CallExpression', 'name': 'timestamp', 'range': [918, 920], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'refresh_token_expires_at', 'range': [924, 927], 'children': [{'type': 'Expression', 'name': 'None', 'range': [926, 926], 'children': []}]}, {'type': 'NamedArgument', 'name': 'scopes', 'range': [929, 934], 'children': [{'type': 'Expression', 'name': 'google_creds.scopes', 'range': [931, 933], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:48:33,878 - INFO - Starting Step 4: AST normalization
2025-01-08 09:48:37,290 - INFO - Step 5 result: {'type': 'Program', 'name': '__init__', 'range': [157, 206], 'children': [{'type': 'FunctionDecl', 'name': '__init__', 'range': [157, 206], 'children': [{'type': 'ParameterList', 'name': '', 'range': [159, 173], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [160, 160], 'children': []}, {'type': 'Parameter', 'name': 'client_id', 'range': [162, 164], 'children': []}, {'type': 'Parameter', 'name': 'client_secret', 'range': [166, 168], 'children': []}, {'type': 'Parameter', 'name': 'redirect_uri', 'range': [170, 172], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [174, 206], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [176, 180], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [176, 178], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [176, 176], 'children': []}, {'type': 'Identifier', 'name': 'client_id', 'range': [178, 178], 'children': []}]}, {'type': 'Identifier', 'name': 'client_id', 'range': [180, 180], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [182, 186], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [182, 184], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [182, 182], 'children': []}, {'type': 'Identifier', 'name': 'client_secret', 'range': [184, 184], 'children': []}]}, {'type': 'Identifier', 'name': 'client_secret', 'range': [186, 186], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [188, 192], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [188, 190], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [188, 188], 'children': []}, {'type': 'Identifier', 'name': 'redirect_uri', 'range': [190, 190], 'children': []}]}, {'type': 'Identifier', 'name': 'redirect_uri', 'range': [192, 192], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [194, 198], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [194, 196], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [194, 194], 'children': []}, {'type': 'Identifier', 'name': 'token_uri', 'range': [196, 196], 'children': []}]}, {'type': 'Literal', 'name': '"https://oauth2.googleapis.com/token"', 'range': [198, 198], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [200, 204], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [200, 202], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [200, 200], 'children': []}, {'type': 'Identifier', 'name': 'revoke_uri', 'range': [202, 202], 'children': []}]}, {'type': 'Literal', 'name': '"https://oauth2.googleapis.com/revoke"', 'range': [204, 204], 'children': []}]}]}]}]}
2025-01-08 09:48:37,290 - INFO - Completed main AST analysis flow
2025-01-08 09:48:37,291 - INFO - Successfully processed chunk
2025-01-08 09:48:42,807 - INFO - Step 5 result: {'type': 'Program', 'name': 'MainOrSomething', 'range': [0, 89], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [4, 19], 'children': [{'type': 'ImportSpecifier', 'name': 'google.auth.external_account_authorized_user', 'range': [5, 9], 'children': [{'type': 'ImportAlias', 'name': 'Credentials', 'alias': 'ExternalAccountCredentials', 'range': [13, 15], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [20, 32], 'children': [{'type': 'ImportSpecifier', 'name': 'google.auth.transport.requests', 'range': [21, 27], 'children': [{'type': 'ImportSpecifier', 'name': 'AuthorizedSession', 'range': [29, 29], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Request', 'range': [31, 31], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [33, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'google.oauth2.credentials', 'range': [34, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'Credentials', 'range': [40, 40], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [42, 48], 'children': [{'type': 'ImportSpecifier', 'name': 'google_auth_oauthlib.flow', 'range': [43, 45], 'children': [{'type': 'ImportSpecifier', 'name': 'Flow', 'range': [47, 47], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [49, 53], 'children': [{'type': 'ImportSpecifier', 'name': 'pydantic', 'range': [50, 50], 'children': [{'type': 'ImportSpecifier', 'name': 'SecretStr', 'range': [52, 52], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [55, 63], 'children': [{'type': 'ImportSpecifier', 'name': 'backend.data.model', 'range': [56, 60], 'children': [{'type': 'ImportSpecifier', 'name': 'OAuth2Credentials', 'range': [62, 62], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [64, 72], 'children': [{'type': 'ImportSpecifier', 'name': 'backend.integrations.providers', 'range': [65, 69], 'children': [{'type': 'ImportSpecifier', 'name': 'ProviderName', 'range': [71, 71], 'children': []}]}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [74, 79], 'children': [{'type': 'ImportSpecifier', 'name': '.base', 'range': [75, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseOAuthHandler', 'range': [78, 78], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [81, 89], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [82, 88], 'children': [{'type': 'CallExpression', 'name': 'logging.getLogger', 'range': [83, 87], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [87, 87], 'children': []}]}]}]}]}
2025-01-08 09:48:42,807 - INFO - Completed main AST analysis flow
2025-01-08 09:48:42,808 - INFO - Successfully processed chunk
2025-01-08 09:48:57,037 - INFO - Step 5 result: {'type': 'Program', 'name': '_request_email', 'range': [659, 726], 'children': [{'type': 'FunctionDecl', 'name': '_request_email', 'range': [659, 726], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [661, 671], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [663, 663], 'children': []}, {'type': 'Parameter', 'name': 'creds', 'range': [665, 669], 'children': [{'type': 'TypeAnnotation', 'name': 'Credentials | ExternalAccountCredentials', 'range': [667, 669], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'str | None', 'range': [672, 676], 'children': []}, {'type': 'BlockStatement', 'name': 'body', 'range': [678, 726], 'children': [{'type': 'VariableDecl', 'name': 'session', 'range': [679, 684], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [680, 684], 'children': [{'type': 'NewExpression', 'name': 'AuthorizedSession', 'range': [681, 684], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [683, 684], 'children': [{'type': 'Identifier', 'name': 'creds', 'range': [683, 683], 'children': []}]}]}]}]}, {'type': 'VariableDecl', 'name': 'response', 'range': [686, 695], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [687, 695], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [690, 695], 'children': [{'type': 'MemberExpression', 'name': 'session.get', 'range': [688, 690], 'children': [{'type': 'Identifier', 'name': 'session', 'range': [688, 688], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [692, 695], 'children': [{'type': 'MemberExpression', 'name': 'self.EMAIL_ENDPOINT', 'range': [692, 694], 'children': [{'type': 'Identifier', 'name': 'self', 'range': [692, 692], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [697, 715], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [698, 702], 'children': [{'type': 'MemberExpression', 'name': 'response.ok', 'range': [699, 701], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [699, 699], 'children': []}]}]}, {'type': 'BlockStatement', 'name': 'consequent', 'range': [703, 715], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [704, 712], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [706, 712], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [704, 706], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [704, 704], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [708, 712], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to get user email. Status code: {response.status_code}"', 'range': [709, 710], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [714, 715], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [715, 715], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [717, 726], 'children': [{'type': 'MemberExpression', 'name': 'response.json', 'range': [718, 720], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [718, 718], 'children': []}]}, {'type': 'CallExpression', 'name': 'json', 'range': [720, 725], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [722, 725], 'children': [{'type': 'StringLiteral', 'name': '"email"', 'range': [724, 724], 'children': []}]}]}]}]}]}]}
2025-01-08 09:48:57,037 - INFO - Completed main AST analysis flow
2025-01-08 09:48:57,038 - INFO - Successfully processed chunk
2025-01-08 09:49:20,722 - INFO - Step 4 result: {'type': 'Program', 'name': '_refresh_tokens', 'range': [728, 938], 'children': [{'type': 'FunctionDecl', 'name': '_refresh_tokens', 'range': [728, 937], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [730, 736], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [731, 731], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [733, 735], 'children': []}]}, {'type': 'ReturnType', 'name': 'OAuth2Credentials', 'range': [737, 739], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [740, 937], 'children': [{'type': 'Comment', 'name': 'Google credentials should ALWAYS have a refresh token', 'range': [742, 751], 'children': []}, {'type': 'AssertStatement', 'name': 'assert', 'range': [752, 756], 'children': [{'type': 'Identifier', 'name': 'credentials.refresh_token', 'range': [753, 755], 'children': []}]}, {'type': 'VariableDecl', 'name': 'google_creds', 'range': [758, 813], 'children': [{'type': 'Assignment', 'name': '=', 'range': [759, 813], 'children': [{'type': 'NewExpression', 'name': 'Credentials', 'range': [760, 813], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [761, 813], 'children': [{'type': 'NamedArgument', 'name': 'token', 'range': [763, 771], 'children': [{'type': 'CallExpression', 'name': 'get_secret_value', 'range': [765, 771], 'children': [{'type': 'Identifier', 'name': 'credentials.access_token', 'range': [765, 771], 'children': []}]}]}, {'type': 'NamedArgument', 'name': 'refresh_token', 'range': [774, 782], 'children': [{'type': 'CallExpression', 'name': 'get_secret_value', 'range': [776, 782], 'children': [{'type': 'Identifier', 'name': 'credentials.refresh_token', 'range': [776, 782], 'children': []}]}]}, {'type': 'NamedArgument', 'name': 'token_uri', 'range': [785, 790], 'children': [{'type': 'Identifier', 'name': 'self.token_uri', 'range': [787, 790], 'children': []}]}, {'type': 'NamedArgument', 'name': 'client_id', 'range': [792, 797], 'children': [{'type': 'Identifier', 'name': 'self.client_id', 'range': [794, 797], 'children': []}]}, {'type': 'NamedArgument', 'name': 'client_secret', 'range': [799, 804], 'children': [{'type': 'Identifier', 'name': 'self.client_secret', 'range': [801, 804], 'children': []}]}, {'type': 'NamedArgument', 'name': 'scopes', 'range': [806, 811], 'children': [{'type': 'Identifier', 'name': 'credentials.scopes', 'range': [808, 811], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': "Google's OAuth library is poorly typed so we need some of these:", 'range': [815, 831], 'children': []}, {'type': 'AssertStatement', 'name': 'assert', 'range': [832, 836], 'children': [{'type': 'Identifier', 'name': 'google_creds.refresh_token', 'range': [833, 835], 'children': []}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [837, 841], 'children': [{'type': 'Identifier', 'name': 'google_creds.scopes', 'range': [838, 840], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'google_creds.refresh', 'range': [843, 850], 'children': [{'type': 'CallExpression', 'name': 'refresh', 'range': [845, 850], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [846, 850], 'children': [{'type': 'NewExpression', 'name': 'Request', 'range': [847, 849], 'children': []}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [852, 856], 'children': [{'type': 'Identifier', 'name': 'google_creds.expiry', 'range': [853, 855], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [858, 937], 'children': [{'type': 'NewExpression', 'name': 'OAuth2Credentials', 'range': [859, 936], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [860, 936], 'children': [{'type': 'NamedArgument', 'name': 'provider', 'range': [862, 867], 'children': [{'type': 'Identifier', 'name': 'self.PROVIDER_NAME', 'range': [864, 867], 'children': []}]}, {'type': 'NamedArgument', 'name': 'id', 'range': [869, 874], 'children': [{'type': 'Identifier', 'name': 'credentials.id', 'range': [871, 874], 'children': []}]}, {'type': 'NamedArgument', 'name': 'title', 'range': [876, 881], 'children': [{'type': 'Identifier', 'name': 'credentials.title', 'range': [878, 881], 'children': []}]}, {'type': 'NamedArgument', 'name': 'username', 'range': [883, 888], 'children': [{'type': 'Identifier', 'name': 'credentials.username', 'range': [885, 888], 'children': []}]}, {'type': 'NamedArgument', 'name': 'access_token', 'range': [890, 897], 'children': [{'type': 'NewExpression', 'name': 'SecretStr', 'range': [892, 897], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [893, 897], 'children': [{'type': 'Identifier', 'name': 'google_creds.token', 'range': [894, 896], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'refresh_token', 'range': [900, 907], 'children': [{'type': 'NewExpression', 'name': 'SecretStr', 'range': [902, 907], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [903, 907], 'children': [{'type': 'Identifier', 'name': 'google_creds.refresh_token', 'range': [904, 906], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'access_token_expires_at', 'range': [910, 921], 'children': [{'type': 'CallExpression', 'name': 'int', 'range': [912, 921], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [913, 921], 'children': [{'type': 'CallExpression', 'name': 'timestamp', 'range': [918, 920], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'refresh_token_expires_at', 'range': [924, 927], 'children': [{'type': 'Literal', 'name': 'None', 'range': [926, 926], 'children': []}]}, {'type': 'NamedArgument', 'name': 'scopes', 'range': [929, 934], 'children': [{'type': 'Identifier', 'name': 'google_creds.scopes', 'range': [931, 933], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:49:20,723 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:50:07,277 - INFO - Step 5 result: {'type': 'Program', 'name': '_refresh_tokens', 'range': [728, 938], 'children': [{'type': 'FunctionDecl', 'name': '_refresh_tokens', 'range': [728, 937], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [730, 736], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [731, 731], 'children': []}, {'type': 'Parameter', 'name': 'credentials', 'range': [733, 735], 'children': []}]}, {'type': 'ReturnType', 'name': 'OAuth2Credentials', 'range': [737, 739], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [740, 937], 'children': [{'type': 'Comment', 'name': 'Google credentials should ALWAYS have a refresh token', 'range': [742, 751], 'children': []}, {'type': 'AssertStatement', 'name': 'assert', 'range': [752, 756], 'children': [{'type': 'Identifier', 'name': 'credentials.refresh_token', 'range': [753, 755], 'children': []}]}, {'type': 'VariableDecl', 'name': 'google_creds', 'range': [758, 813], 'children': [{'type': 'Assignment', 'name': '=', 'range': [759, 813], 'children': [{'type': 'NewExpression', 'name': 'Credentials', 'range': [760, 813], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [761, 813], 'children': [{'type': 'NamedArgument', 'name': 'token', 'range': [763, 771], 'children': [{'type': 'CallExpression', 'name': 'get_secret_value', 'range': [765, 771], 'children': [{'type': 'Identifier', 'name': 'credentials.access_token', 'range': [765, 771], 'children': []}]}]}, {'type': 'NamedArgument', 'name': 'refresh_token', 'range': [774, 782], 'children': [{'type': 'CallExpression', 'name': 'get_secret_value', 'range': [776, 782], 'children': [{'type': 'Identifier', 'name': 'credentials.refresh_token', 'range': [776, 782], 'children': []}]}]}, {'type': 'NamedArgument', 'name': 'token_uri', 'range': [785, 790], 'children': [{'type': 'Identifier', 'name': 'self.token_uri', 'range': [787, 790], 'children': []}]}, {'type': 'NamedArgument', 'name': 'client_id', 'range': [792, 797], 'children': [{'type': 'Identifier', 'name': 'self.client_id', 'range': [794, 797], 'children': []}]}, {'type': 'NamedArgument', 'name': 'client_secret', 'range': [799, 804], 'children': [{'type': 'Identifier', 'name': 'self.client_secret', 'range': [801, 804], 'children': []}]}, {'type': 'NamedArgument', 'name': 'scopes', 'range': [806, 811], 'children': [{'type': 'Identifier', 'name': 'credentials.scopes', 'range': [808, 811], 'children': []}]}]}]}]}]}, {'type': 'Comment', 'name': "Google's OAuth library is poorly typed so we need some of these:", 'range': [815, 831], 'children': []}, {'type': 'AssertStatement', 'name': 'assert', 'range': [832, 836], 'children': [{'type': 'Identifier', 'name': 'google_creds.refresh_token', 'range': [833, 835], 'children': []}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [837, 841], 'children': [{'type': 'Identifier', 'name': 'google_creds.scopes', 'range': [838, 840], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'google_creds.refresh', 'range': [843, 850], 'children': [{'type': 'CallExpression', 'name': 'refresh', 'range': [845, 850], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [846, 850], 'children': [{'type': 'NewExpression', 'name': 'Request', 'range': [847, 849], 'children': []}]}]}]}, {'type': 'AssertStatement', 'name': 'assert', 'range': [852, 856], 'children': [{'type': 'Identifier', 'name': 'google_creds.expiry', 'range': [853, 855], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [858, 937], 'children': [{'type': 'NewExpression', 'name': 'OAuth2Credentials', 'range': [859, 936], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [860, 936], 'children': [{'type': 'NamedArgument', 'name': 'provider', 'range': [862, 867], 'children': [{'type': 'Identifier', 'name': 'self.PROVIDER_NAME', 'range': [864, 867], 'children': []}]}, {'type': 'NamedArgument', 'name': 'id', 'range': [869, 874], 'children': [{'type': 'Identifier', 'name': 'credentials.id', 'range': [871, 874], 'children': []}]}, {'type': 'NamedArgument', 'name': 'title', 'range': [876, 881], 'children': [{'type': 'Identifier', 'name': 'credentials.title', 'range': [878, 881], 'children': []}]}, {'type': 'NamedArgument', 'name': 'username', 'range': [883, 888], 'children': [{'type': 'Identifier', 'name': 'credentials.username', 'range': [885, 888], 'children': []}]}, {'type': 'NamedArgument', 'name': 'access_token', 'range': [890, 897], 'children': [{'type': 'NewExpression', 'name': 'SecretStr', 'range': [892, 897], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [893, 897], 'children': [{'type': 'Identifier', 'name': 'google_creds.token', 'range': [894, 896], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'refresh_token', 'range': [900, 907], 'children': [{'type': 'NewExpression', 'name': 'SecretStr', 'range': [902, 907], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [903, 907], 'children': [{'type': 'Identifier', 'name': 'google_creds.refresh_token', 'range': [904, 906], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'access_token_expires_at', 'range': [910, 921], 'children': [{'type': 'CallExpression', 'name': 'int', 'range': [912, 921], 'children': [{'type': 'ArgumentList', 'name': 'arguments', 'range': [913, 921], 'children': [{'type': 'CallExpression', 'name': 'timestamp', 'range': [918, 920], 'children': []}]}]}]}, {'type': 'NamedArgument', 'name': 'refresh_token_expires_at', 'range': [924, 927], 'children': [{'type': 'Literal', 'name': 'None', 'range': [926, 926], 'children': []}]}, {'type': 'NamedArgument', 'name': 'scopes', 'range': [929, 934], 'children': [{'type': 'Identifier', 'name': 'google_creds.scopes', 'range': [931, 933], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:50:07,277 - INFO - Completed main AST analysis flow
2025-01-08 09:50:07,278 - INFO - Successfully processed chunk
2025-01-08 09:50:07,326 - INFO - Starting code generation from AST
2025-01-08 10:20:08,985 - ERROR - Error in get_code_from_ast: Expecting value: line 30 column 1 (char 29)
2025-01-08 10:20:08,985 - INFO - Starting static code similarity comparison
2025-01-08 10:20:08,988 - INFO - Static similarity result: {'final_score': 22.5, 'length_similarity': 0.0, 'token_similarity': 0.0, 'structure_similarity': 0.0, 'function_similarity': 100, 'complexity_similarity': 25.0, 'variable_similarity': 100}
