2025-01-08 09:16:35,015 - INFO - Processing sample 19
2025-01-08 09:16:35,015 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 09:16:47,103 - INFO - Successfully split code into 6 top-level declarations
2025-01-08 09:16:47,106 - INFO - Processing chunk #0 (size=375 chars, start_index=0)
2025-01-08 09:16:47,106 - INFO - Processing chunk with 375 chars starting at index 0
2025-01-08 09:16:47,106 - INFO - Starting main AST analysis flow
2025-01-08 09:16:47,106 - INFO - Tokenized code into 78 tokens
2025-01-08 09:16:47,106 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:16:47,107 - INFO - Processing chunk #1 (size=171 chars, start_index=78)
2025-01-08 09:16:47,108 - INFO - Processing chunk with 171 chars starting at index 78
2025-01-08 09:16:47,108 - INFO - Starting main AST analysis flow
2025-01-08 09:16:47,108 - INFO - Tokenized code into 45 tokens
2025-01-08 09:16:47,108 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:16:47,117 - INFO - Processing chunk #2 (size=36 chars, start_index=123)
2025-01-08 09:16:47,117 - INFO - Processing chunk with 36 chars starting at index 123
2025-01-08 09:16:47,117 - INFO - Starting main AST analysis flow
2025-01-08 09:16:47,117 - INFO - Tokenized code into 13 tokens
2025-01-08 09:16:47,118 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:16:47,118 - INFO - Processing chunk #3 (size=1250 chars, start_index=136)
2025-01-08 09:16:47,119 - INFO - Processing chunk with 1250 chars starting at index 136
2025-01-08 09:16:47,119 - INFO - Starting main AST analysis flow
2025-01-08 09:16:47,119 - INFO - Tokenized code into 241 tokens
2025-01-08 09:16:47,119 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:16:47,126 - INFO - Processing chunk #4 (size=873 chars, start_index=377)
2025-01-08 09:16:47,127 - INFO - Processing chunk with 873 chars starting at index 377
2025-01-08 09:16:47,127 - INFO - Starting main AST analysis flow
2025-01-08 09:16:47,127 - INFO - Tokenized code into 183 tokens
2025-01-08 09:16:47,127 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:16:47,132 - INFO - Processing chunk #5 (size=1292 chars, start_index=560)
2025-01-08 09:16:47,133 - INFO - Processing chunk with 1292 chars starting at index 560
2025-01-08 09:16:47,133 - INFO - Starting main AST analysis flow
2025-01-08 09:16:47,133 - INFO - Tokenized code into 257 tokens
2025-01-08 09:16:47,134 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:16:54,792 - INFO - Step 1 result: {'type': 'Program', 'name': 'DateTimeEncoder', 'range': [78, 122], 'children': [{'type': 'FunctionDeclaration', 'name': 'default', 'range': [87, 121], 'children': []}]}
2025-01-08 09:16:54,792 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:16:57,702 - INFO - Step 1 result: {'type': 'Program', 'name': 'RedisEventBus', 'range': [377, 559], 'children': [{'type': 'ClassDeclaration', 'name': 'RedisEventBus', 'range': [377, 386], 'children': []}, {'type': 'FunctionDeclaration', 'name': 'connection', 'range': [400, 418], 'children': []}, {'type': 'FunctionDeclaration', 'name': 'publish_event', 'range': [420, 458], 'children': []}, {'type': 'FunctionDeclaration', 'name': 'listen_events', 'range': [460, 557], 'children': []}]}
2025-01-08 09:16:57,703 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:16:59,327 - INFO - Step 1 result: {'type': 'Program', 'name': 'AsyncRedisEventBus', 'range': [560, 816], 'children': [{'type': 'ClassDeclaration', 'name': 'AsyncRedisEventBus', 'range': [560, 569], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'connection', 'range': [580, 603], 'children': []}, {'type': 'FunctionDeclaration', 'name': 'publish_event', 'range': [605, 650], 'children': []}, {'type': 'FunctionDeclaration', 'name': 'listen_events', 'range': [652, 752], 'children': []}, {'type': 'FunctionDeclaration', 'name': 'wait_for_event', 'range': [754, 815], 'children': []}]}
2025-01-08 09:16:59,328 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:17:01,134 - INFO - Step 1 result: {'type': 'Program', 'name': 'BaseRedisEventBus', 'range': [136, 376], 'children': [{'type': 'ClassDeclaration', 'name': 'BaseRedisEventBus', 'range': [136, 145], 'children': []}, {'type': 'FunctionDeclaration', 'name': 'event_bus_name', 'range': [162, 173], 'children': []}, {'type': 'FunctionDeclaration', 'name': '_serialize_message', 'range': [175, 232], 'children': []}, {'type': 'FunctionDeclaration', 'name': '_deserialize_message', 'range': [234, 324], 'children': []}, {'type': 'FunctionDeclaration', 'name': '_get_pubsub_channel', 'range': [325, 375], 'children': []}]}
2025-01-08 09:17:01,134 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:17:01,305 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [123, 135], 'children': [{'type': 'VariableDeclaration', 'name': 'M', 'range': [123, 132], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [124, 132], 'children': [{'type': 'Identifier', 'name': 'TypeVar', 'range': [125, 125], 'children': []}, {'type': 'Literal', 'name': '"M"', 'range': [127, 127], 'children': []}, {'type': 'Identifier', 'name': 'bound', 'range': [129, 129], 'children': []}, {'type': 'Identifier', 'name': 'BaseModel', 'range': [131, 131], 'children': []}]}]}]}
2025-01-08 09:17:01,306 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:17:04,215 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 77], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 8], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 15], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [16, 20], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 35], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [37, 41], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [42, 52], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 59], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [61, 67], 'children': []}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [69, 77], 'children': []}]}
2025-01-08 09:17:04,215 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:17:14,684 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [123, 135], 'children': [{'type': 'VariableDeclaration', 'name': 'M', 'range': [123, 132], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [124, 132], 'children': [{'type': 'Identifier', 'name': 'TypeVar', 'range': [125, 125], 'children': []}, {'type': 'CallExpression', 'name': '', 'range': [126, 132], 'children': [{'type': 'Literal', 'name': '"M"', 'range': [127, 127], 'children': []}, {'type': 'KeywordArgument', 'name': 'bound', 'range': [129, 131], 'children': [{'type': 'Identifier', 'name': 'BaseModel', 'range': [131, 131], 'children': []}]}]}]}]}]}
2025-01-08 09:17:14,684 - INFO - Starting Step 3: AST simplification
2025-01-08 09:17:28,610 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [123, 135], 'children': [{'type': 'VariableDeclaration', 'name': 'M', 'range': [123, 132], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [124, 132], 'children': [{'type': 'Identifier', 'name': 'TypeVar', 'range': [125, 125], 'children': []}, {'type': 'CallExpression', 'name': '', 'range': [126, 132], 'children': [{'type': 'Literal', 'name': '"M"', 'range': [127, 127], 'children': []}, {'type': 'KeywordArgument', 'name': 'bound', 'range': [129, 131], 'children': [{'type': 'Identifier', 'name': 'BaseModel', 'range': [131, 131], 'children': []}]}]}]}]}]}
2025-01-08 09:17:28,610 - INFO - Starting Step 4: AST normalization
2025-01-08 09:17:29,291 - INFO - Step 2 result: {'type': 'Program', 'name': 'DateTimeEncoder', 'range': [78, 122], 'children': [{'type': 'FunctionDeclaration', 'name': 'default', 'range': [87, 121], 'children': [{'type': 'ParameterList', 'name': '', 'range': [89, 93], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [90, 90], 'children': []}, {'type': 'Parameter', 'name': 'o', 'range': [92, 92], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [94, 121], 'children': [{'type': 'IfStatement', 'name': '', 'range': [96, 111], 'children': [{'type': 'Condition', 'name': '', 'range': [97, 102], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [97, 102], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [98, 102], 'children': [{'type': 'Argument', 'name': 'o', 'range': [99, 99], 'children': []}, {'type': 'Argument', 'name': 'datetime', 'range': [101, 101], 'children': []}]}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [103, 111], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [105, 110], 'children': [{'type': 'CallExpression', 'name': 'isoformat', 'range': [106, 110], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [106, 108], 'children': [{'type': 'Identifier', 'name': 'o', 'range': [106, 106], 'children': []}, {'type': 'Identifier', 'name': 'isoformat', 'range': [108, 108], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [112, 120], 'children': [{'type': 'CallExpression', 'name': 'default', 'range': [113, 120], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [113, 117], 'children': [{'type': 'CallExpression', 'name': 'super', 'range': [113, 115], 'children': []}, {'type': 'Identifier', 'name': 'default', 'range': [117, 117], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [118, 120], 'children': [{'type': 'Argument', 'name': 'o', 'range': [119, 119], 'children': []}]}]}]}]}]}]}
2025-01-08 09:17:29,292 - INFO - Starting Step 3: AST simplification
2025-01-08 09:17:36,140 - INFO - Step 2 result: {'nodes': [{'type': 'ClassDeclaration', 'name': 'RedisEventBus', 'range': [377, 386], 'children': [{'type': 'Inheritance', 'name': 'BaseRedisEventBus[M], ABC', 'range': [379, 386], 'children': []}]}, {'type': 'FunctionDeclaration', 'name': 'connection', 'range': [400, 418], 'children': [{'type': 'ReturnType', 'name': '-> redis.Redis', 'range': [405, 410], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [411, 418], 'children': [{'type': 'ReturnStatement', 'name': 'return redis.get_redis()', 'range': [412, 417], 'children': []}]}]}, {'type': 'FunctionDeclaration', 'name': 'publish_event', 'range': [420, 458], 'children': [{'type': 'Parameters', 'name': 'self, event: M, channel_key: str', 'range': [422, 432], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [433, 458], 'children': [{'type': 'Assignment', 'name': 'message, full_channel_name = self._serialize_message(event, channel_key)', 'range': [435, 446], 'children': []}, {'type': 'MethodCall', 'name': 'self.connection.publish(full_channel_name, message)', 'range': [448, 457], 'children': []}]}]}, {'type': 'FunctionDeclaration', 'name': 'listen_events', 'range': [460, 557], 'children': [{'type': 'Parameters', 'name': 'self, channel_key: str', 'range': [462, 468], 'children': []}, {'type': 'ReturnType', 'name': '-> Generator[M, None, None]', 'range': [469, 478], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [479, 557], 'children': [{'type': 'Assignment', 'name': 'pubsub, full_channel_name = self._get_pubsub_channel(self.connection, channel_key)', 'range': [481, 496], 'children': []}, {'type': 'AssertStatement', 'name': 'assert isinstance(pubsub, PubSub)', 'range': [498, 504], 'children': []}, {'type': 'IfStatement', 'name': 'if "*" in channel_key:', 'range': [507, 511], 'children': [{'type': 'MethodCall', 'name': 'pubsub.psubscribe(full_channel_name)', 'range': [513, 518], 'children': []}]}, {'type': 'ElseStatement', 'name': 'else:', 'range': [520, 521], 'children': [{'type': 'MethodCall', 'name': 'pubsub.subscribe(full_channel_name)', 'range': [523, 528], 'children': []}]}, {'type': 'ForLoop', 'name': 'for message in pubsub.listen():', 'range': [531, 539], 'children': [{'type': 'IfStatement', 'name': 'if event := self._deserialize_message(message, channel_key):', 'range': [541, 553], 'children': [{'type': 'YieldStatement', 'name': 'yield event', 'range': [555, 556], 'children': []}]}]}]}]}]}
2025-01-08 09:17:36,140 - INFO - Starting Step 3: AST simplification
2025-01-08 09:17:42,047 - INFO - Step 2 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'json', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 8], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [7, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 15], 'children': [{'type': 'ImportSpecifier', 'name': 'ABC', 'range': [12, 12], 'children': []}, {'type': 'ImportSpecifier', 'name': 'abstractmethod', 'range': [14, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [16, 20], 'children': [{'type': 'ImportSpecifier', 'name': 'datetime', 'range': [19, 19], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 35], 'children': [{'type': 'ImportSpecifier', 'name': 'Any', 'range': [24, 24], 'children': []}, {'type': 'ImportSpecifier', 'name': 'AsyncGenerator', 'range': [26, 26], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Generator', 'range': [28, 28], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Generic', 'range': [30, 30], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Optional', 'range': [32, 32], 'children': []}, {'type': 'ImportSpecifier', 'name': 'TypeVar', 'range': [34, 34], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [37, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseModel', 'range': [40, 40], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [42, 52], 'children': [{'type': 'ImportSpecifier', 'name': 'AsyncPubSub', 'range': [51, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 59], 'children': [{'type': 'ImportSpecifier', 'name': 'PubSub', 'range': [58, 58], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [61, 67], 'children': [{'type': 'ImportSpecifier', 'name': 'redis', 'range': [66, 66], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [69, 77], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [70, 77], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [73, 76], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [75, 75], 'children': []}]}]}]}]}
2025-01-08 09:17:42,048 - INFO - Starting Step 3: AST simplification
2025-01-08 09:17:44,260 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [123, 135], 'children': [{'type': 'VariableDeclaration', 'name': 'M', 'range': [123, 132], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [124, 132], 'children': [{'type': 'Identifier', 'name': 'TypeVar', 'range': [125, 125], 'children': []}, {'type': 'CallExpression', 'name': '', 'range': [126, 132], 'children': [{'type': 'Literal', 'name': '"M"', 'range': [127, 127], 'children': []}, {'type': 'KeywordArgument', 'name': 'bound', 'range': [129, 131], 'children': [{'type': 'Identifier', 'name': 'BaseModel', 'range': [131, 131], 'children': []}]}]}]}]}]}
2025-01-08 09:17:44,260 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:17:48,033 - INFO - Step 2 result: {'type': 'Program', 'name': 'BaseRedisEventBus', 'range': [136, 376], 'children': [{'type': 'ClassDeclaration', 'name': 'BaseRedisEventBus', 'range': [136, 145], 'children': [{'type': 'GenericType', 'name': 'Generic', 'range': [139, 142], 'children': [{'type': 'TypeParameter', 'name': 'M', 'range': [141, 141], 'children': []}]}, {'type': 'Inheritance', 'name': 'ABC', 'range': [144, 144], 'children': []}]}, {'type': 'FunctionDeclaration', 'name': 'event_bus_name', 'range': [162, 173], 'children': [{'type': 'Decorator', 'name': '@property', 'range': [156, 157], 'children': []}, {'type': 'Decorator', 'name': '@abstractmethod', 'range': [159, 160], 'children': []}, {'type': 'ReturnType', 'name': 'str', 'range': [169, 169], 'children': []}]}, {'type': 'FunctionDeclaration', 'name': '_serialize_message', 'range': [175, 232], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [178, 178], 'children': []}, {'type': 'Parameter', 'name': 'item', 'range': [180, 180], 'children': [{'type': 'TypeAnnotation', 'name': 'M', 'range': [182, 182], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [184, 184], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [186, 186], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple', 'range': [190, 190], 'children': [{'type': 'TypeParameter', 'name': 'str', 'range': [192, 192], 'children': []}, {'type': 'TypeParameter', 'name': 'str', 'range': [194, 194], 'children': []}]}]}, {'type': 'FunctionDeclaration', 'name': '_deserialize_message', 'range': [234, 324], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [237, 237], 'children': []}, {'type': 'Parameter', 'name': 'msg', 'range': [239, 239], 'children': [{'type': 'TypeAnnotation', 'name': 'Any', 'range': [241, 241], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [243, 243], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [245, 245], 'children': []}]}, {'type': 'ReturnType', 'name': 'M', 'range': [249, 249], 'children': [{'type': 'TypeParameter', 'name': 'None', 'range': [251, 251], 'children': []}]}]}, {'type': 'FunctionDeclaration', 'name': '_get_pubsub_channel', 'range': [325, 375], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [329, 329], 'children': []}, {'type': 'Parameter', 'name': 'connection', 'range': [331, 331], 'children': [{'type': 'TypeAnnotation', 'name': 'redis.Redis', 'range': [333, 335], 'children': []}, {'type': 'TypeAnnotation', 'name': 'redis.AsyncRedis', 'range': [337, 339], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [341, 341], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [343, 343], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple', 'range': [348, 348], 'children': [{'type': 'TypeParameter', 'name': 'PubSub', 'range': [350, 350], 'children': []}, {'type': 'TypeParameter', 'name': 'AsyncPubSub', 'range': [352, 352], 'children': []}, {'type': 'TypeParameter', 'name': 'str', 'range': [354, 354], 'children': []}]}]}]}
2025-01-08 09:17:48,034 - INFO - Starting Step 3: AST simplification
2025-01-08 09:17:57,188 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [123, 135], 'children': [{'type': 'VariableDeclaration', 'name': 'M', 'range': [123, 132], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [124, 132], 'children': [{'type': 'Identifier', 'name': 'TypeVar', 'range': [125, 125], 'children': []}, {'type': 'CallExpression', 'name': '', 'range': [126, 132], 'children': [{'type': 'Literal', 'name': '"M"', 'range': [127, 127], 'children': []}, {'type': 'KeywordArgument', 'name': 'bound', 'range': [129, 131], 'children': [{'type': 'Identifier', 'name': 'BaseModel', 'range': [131, 131], 'children': []}]}]}]}]}]}
2025-01-08 09:17:57,189 - INFO - Completed main AST analysis flow
2025-01-08 09:17:57,189 - INFO - Successfully processed chunk
2025-01-08 09:18:03,775 - INFO - Step 3 result: {'type': 'Program', 'name': 'DateTimeEncoder', 'range': [78, 122], 'children': [{'type': 'FunctionDeclaration', 'name': 'default', 'range': [87, 121], 'children': [{'type': 'ParameterList', 'name': '', 'range': [89, 93], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [90, 90], 'children': []}, {'type': 'Parameter', 'name': 'o', 'range': [92, 92], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [94, 121], 'children': [{'type': 'IfStatement', 'name': '', 'range': [96, 111], 'children': [{'type': 'Condition', 'name': '', 'range': [97, 102], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [97, 102], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [98, 102], 'children': [{'type': 'Argument', 'name': 'o', 'range': [99, 99], 'children': []}, {'type': 'Argument', 'name': 'datetime', 'range': [101, 101], 'children': []}]}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [103, 111], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [105, 110], 'children': [{'type': 'CallExpression', 'name': 'isoformat', 'range': [106, 110], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [106, 108], 'children': [{'type': 'Identifier', 'name': 'o', 'range': [106, 106], 'children': []}, {'type': 'Identifier', 'name': 'isoformat', 'range': [108, 108], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [112, 120], 'children': [{'type': 'CallExpression', 'name': 'default', 'range': [113, 120], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [113, 117], 'children': [{'type': 'CallExpression', 'name': 'super', 'range': [113, 115], 'children': []}, {'type': 'Identifier', 'name': 'default', 'range': [117, 117], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [118, 120], 'children': [{'type': 'Argument', 'name': 'o', 'range': [119, 119], 'children': []}]}]}]}]}]}]}
2025-01-08 09:18:03,776 - INFO - Starting Step 4: AST normalization
2025-01-08 09:18:17,002 - INFO - Step 3 result: {'nodes': [{'type': 'ClassDeclaration', 'name': 'RedisEventBus', 'range': [377, 386], 'children': [{'type': 'Inheritance', 'name': 'BaseRedisEventBus[M] ABC', 'range': [379, 386], 'children': []}]}, {'type': 'FunctionDeclaration', 'name': 'connection', 'range': [400, 418], 'children': [{'type': 'ReturnType', 'name': '-> redis.Redis', 'range': [405, 410], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [411, 418], 'children': [{'type': 'ReturnStatement', 'name': 'return redis.get_redis()', 'range': [412, 417], 'children': []}]}]}, {'type': 'FunctionDeclaration', 'name': 'publish_event', 'range': [420, 458], 'children': [{'type': 'Parameters', 'name': 'self event: M channel_key: str', 'range': [422, 432], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [433, 458], 'children': [{'type': 'Assignment', 'name': 'message full_channel_name = self._serialize_message(event channel_key)', 'range': [435, 446], 'children': []}, {'type': 'MethodCall', 'name': 'self.connection.publish(full_channel_name message)', 'range': [448, 457], 'children': []}]}]}, {'type': 'FunctionDeclaration', 'name': 'listen_events', 'range': [460, 557], 'children': [{'type': 'Parameters', 'name': 'self channel_key: str', 'range': [462, 468], 'children': []}, {'type': 'ReturnType', 'name': '-> Generator[M None None]', 'range': [469, 478], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [479, 557], 'children': [{'type': 'Assignment', 'name': 'pubsub full_channel_name = self._get_pubsub_channel(self.connection channel_key)', 'range': [481, 496], 'children': []}, {'type': 'AssertStatement', 'name': 'assert isinstance(pubsub PubSub)', 'range': [498, 504], 'children': []}, {'type': 'IfStatement', 'name': 'if "*" in channel_key', 'range': [507, 511], 'children': [{'type': 'MethodCall', 'name': 'pubsub.psubscribe(full_channel_name)', 'range': [513, 518], 'children': []}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [520, 521], 'children': [{'type': 'MethodCall', 'name': 'pubsub.subscribe(full_channel_name)', 'range': [523, 528], 'children': []}]}, {'type': 'ForLoop', 'name': 'for message in pubsub.listen()', 'range': [531, 539], 'children': [{'type': 'IfStatement', 'name': 'if event := self._deserialize_message(message channel_key)', 'range': [541, 553], 'children': [{'type': 'YieldStatement', 'name': 'yield event', 'range': [555, 556], 'children': []}]}]}]}]}]}
2025-01-08 09:18:17,002 - INFO - Starting Step 4: AST normalization
2025-01-08 09:18:17,494 - INFO - Step 2 result: {'type': 'Program', 'name': 'AsyncRedisEventBus', 'range': [560, 816], 'children': [{'type': 'ClassDeclaration', 'name': 'AsyncRedisEventBus', 'range': [560, 569], 'children': [{'type': 'Inheritance', 'name': 'BaseRedisEventBus', 'range': [563, 569], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'connection', 'range': [580, 603], 'children': [{'type': 'ReturnType', 'name': 'redis.AsyncRedis', 'range': [589, 594], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [595, 603], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [596, 603], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [597, 603], 'children': [{'type': 'CallExpression', 'name': 'redis.get_redis_async', 'range': [598, 603], 'children': []}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'publish_event', 'range': [605, 650], 'children': [{'type': 'Parameters', 'name': '', 'range': [608, 618], 'children': [{'type': 'Parameter', 'name': 'event', 'range': [611, 613], 'children': []}, {'type': 'Parameter', 'name': 'channel_key', 'range': [615, 617], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [619, 650], 'children': [{'type': 'VariableDeclaration', 'name': 'message, full_channel_name', 'range': [621, 633], 'children': [{'type': 'CallExpression', 'name': 'self._serialize_message', 'range': [625, 633], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'connection', 'range': [634, 640], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [636, 640], 'children': [{'type': 'MemberExpression', 'name': 'self.connection', 'range': [637, 640], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [641, 650], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [641, 650], 'children': [{'type': 'CallExpression', 'name': 'connection.publish', 'range': [642, 650], 'children': []}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'listen_events', 'range': [652, 752], 'children': [{'type': 'Parameters', 'name': '', 'range': [655, 661], 'children': [{'type': 'Parameter', 'name': 'channel_key', 'range': [658, 660], 'children': []}]}, {'type': 'ReturnType', 'name': 'AsyncGenerator[M, None]', 'range': [662, 670], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [671, 752], 'children': [{'type': 'VariableDeclaration', 'name': 'pubsub, full_channel_name', 'range': [672, 689], 'children': [{'type': 'CallExpression', 'name': 'self._get_pubsub_channel', 'range': [676, 689], 'children': []}]}, {'type': 'AssertStatement', 'name': '', 'range': [690, 697], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [691, 697], 'children': []}]}, {'type': 'IfStatement', 'name': '', 'range': [699, 723], 'children': [{'type': 'Condition', 'name': '', 'range': [700, 703], 'children': []}, {'type': 'Block', 'name': '', 'range': [704, 712], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [705, 712], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [705, 712], 'children': [{'type': 'CallExpression', 'name': 'pubsub.psubscribe', 'range': [706, 712], 'children': []}]}]}]}, {'type': 'ElseStatement', 'name': '', 'range': [713, 723], 'children': [{'type': 'Block', 'name': '', 'range': [714, 723], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [716, 723], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [716, 723], 'children': [{'type': 'CallExpression', 'name': 'pubsub.subscribe', 'range': [717, 723], 'children': []}]}]}]}]}]}, {'type': 'ForStatement', 'name': '', 'range': [725, 752], 'children': [{'type': 'Initialization', 'name': 'message', 'range': [727, 728], 'children': []}, {'type': 'Condition', 'name': '', 'range': [729, 734], 'children': []}, {'type': 'Block', 'name': '', 'range': [735, 752], 'children': [{'type': 'IfStatement', 'name': '', 'range': [736, 748], 'children': [{'type': 'Condition', 'name': '', 'range': [737, 739], 'children': []}, {'type': 'Block', 'name': '', 'range': [740, 748], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [740, 748], 'children': [{'type': 'CallExpression', 'name': 'self._deserialize_message', 'range': [742, 748], 'children': []}]}]}]}, {'type': 'YieldStatement', 'name': '', 'range': [750, 752], 'children': []}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'wait_for_event', 'range': [754, 815], 'children': [{'type': 'Parameters', 'name': '', 'range': [757, 773], 'children': [{'type': 'Parameter', 'name': 'channel_key', 'range': [761, 763], 'children': []}, {'type': 'Parameter', 'name': 'timeout', 'range': [765, 772], 'children': []}]}, {'type': 'ReturnType', 'name': 'M | None', 'range': [775, 780], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [781, 815], 'children': [{'type': 'TryStatement', 'name': '', 'range': [782, 815], 'children': [{'type': 'Block', 'name': '', 'range': [783, 808], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [785, 808], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [786, 808], 'children': [{'type': 'CallExpression', 'name': 'asyncio.wait_for', 'range': [787, 808], 'children': []}]}]}]}, {'type': 'CatchStatement', 'name': 'TimeoutError', 'range': [809, 815], 'children': [{'type': 'Block', 'name': '', 'range': [810, 815], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [813, 815], 'children': []}]}]}]}]}]}]}
2025-01-08 09:18:17,494 - INFO - Starting Step 3: AST simplification
2025-01-08 09:18:22,195 - INFO - Step 3 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'json', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 8], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [7, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 15], 'children': [{'type': 'ImportSpecifier', 'name': 'ABC', 'range': [12, 12], 'children': []}, {'type': 'ImportSpecifier', 'name': 'abstractmethod', 'range': [14, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [16, 20], 'children': [{'type': 'ImportSpecifier', 'name': 'datetime', 'range': [19, 19], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 35], 'children': [{'type': 'ImportSpecifier', 'name': 'Any', 'range': [24, 24], 'children': []}, {'type': 'ImportSpecifier', 'name': 'AsyncGenerator', 'range': [26, 26], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Generator', 'range': [28, 28], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Generic', 'range': [30, 30], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Optional', 'range': [32, 32], 'children': []}, {'type': 'ImportSpecifier', 'name': 'TypeVar', 'range': [34, 34], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [37, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseModel', 'range': [40, 40], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [42, 52], 'children': [{'type': 'ImportSpecifier', 'name': 'AsyncPubSub', 'range': [51, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 59], 'children': [{'type': 'ImportSpecifier', 'name': 'PubSub', 'range': [58, 58], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [61, 67], 'children': [{'type': 'ImportSpecifier', 'name': 'redis', 'range': [66, 66], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [69, 77], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [70, 77], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [73, 76], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [75, 75], 'children': []}]}]}]}]}
2025-01-08 09:18:22,196 - INFO - Starting Step 4: AST normalization
2025-01-08 09:18:33,818 - INFO - Step 3 result: {'type': 'Program', 'name': 'BaseRedisEventBus', 'range': [136, 376], 'children': [{'type': 'ClassDeclaration', 'name': 'BaseRedisEventBus', 'range': [136, 145], 'children': [{'type': 'GenericType', 'name': 'Generic', 'range': [139, 142], 'children': [{'type': 'TypeParameter', 'name': 'M', 'range': [141, 141], 'children': []}]}, {'type': 'Inheritance', 'name': 'ABC', 'range': [144, 144], 'children': []}]}, {'type': 'FunctionDeclaration', 'name': 'event_bus_name', 'range': [162, 173], 'children': [{'type': 'Decorator', 'name': '@property', 'range': [156, 157], 'children': []}, {'type': 'Decorator', 'name': '@abstractmethod', 'range': [159, 160], 'children': []}, {'type': 'ReturnType', 'name': 'str', 'range': [169, 169], 'children': []}]}, {'type': 'FunctionDeclaration', 'name': '_serialize_message', 'range': [175, 232], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [178, 178], 'children': []}, {'type': 'Parameter', 'name': 'item', 'range': [180, 180], 'children': [{'type': 'TypeAnnotation', 'name': 'M', 'range': [182, 182], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [184, 184], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [186, 186], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple', 'range': [190, 190], 'children': [{'type': 'TypeParameter', 'name': 'str', 'range': [192, 192], 'children': []}, {'type': 'TypeParameter', 'name': 'str', 'range': [194, 194], 'children': []}]}]}, {'type': 'FunctionDeclaration', 'name': '_deserialize_message', 'range': [234, 324], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [237, 237], 'children': []}, {'type': 'Parameter', 'name': 'msg', 'range': [239, 239], 'children': [{'type': 'TypeAnnotation', 'name': 'Any', 'range': [241, 241], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [243, 243], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [245, 245], 'children': []}]}, {'type': 'ReturnType', 'name': 'M', 'range': [249, 249], 'children': [{'type': 'TypeParameter', 'name': 'None', 'range': [251, 251], 'children': []}]}]}, {'type': 'FunctionDeclaration', 'name': '_get_pubsub_channel', 'range': [325, 375], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [329, 329], 'children': []}, {'type': 'Parameter', 'name': 'connection', 'range': [331, 331], 'children': [{'type': 'TypeAnnotation', 'name': 'redis.Redis', 'range': [333, 335], 'children': []}, {'type': 'TypeAnnotation', 'name': 'redis.AsyncRedis', 'range': [337, 339], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [341, 341], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [343, 343], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple', 'range': [348, 348], 'children': [{'type': 'TypeParameter', 'name': 'PubSub', 'range': [350, 350], 'children': []}, {'type': 'TypeParameter', 'name': 'AsyncPubSub', 'range': [352, 352], 'children': []}, {'type': 'TypeParameter', 'name': 'str', 'range': [354, 354], 'children': []}]}]}]}
2025-01-08 09:18:33,819 - INFO - Starting Step 4: AST normalization
2025-01-08 09:18:35,133 - INFO - Step 4 result: {'type': 'Program', 'name': 'DateTimeEncoder', 'range': [78, 122], 'children': [{'type': 'FunctionDecl', 'name': 'default', 'range': [87, 121], 'children': [{'type': 'ParameterList', 'name': '', 'range': [89, 93], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [90, 90], 'children': []}, {'type': 'Parameter', 'name': 'o', 'range': [92, 92], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [94, 121], 'children': [{'type': 'IfStatement', 'name': '', 'range': [96, 111], 'children': [{'type': 'Condition', 'name': '', 'range': [97, 102], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [97, 102], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [98, 102], 'children': [{'type': 'Argument', 'name': 'o', 'range': [99, 99], 'children': []}, {'type': 'Argument', 'name': 'datetime', 'range': [101, 101], 'children': []}]}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [103, 111], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [105, 110], 'children': [{'type': 'CallExpression', 'name': 'isoformat', 'range': [106, 110], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [106, 108], 'children': [{'type': 'Identifier', 'name': 'o', 'range': [106, 106], 'children': []}, {'type': 'Identifier', 'name': 'isoformat', 'range': [108, 108], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [112, 120], 'children': [{'type': 'CallExpression', 'name': 'default', 'range': [113, 120], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [113, 117], 'children': [{'type': 'CallExpression', 'name': 'super', 'range': [113, 115], 'children': []}, {'type': 'Identifier', 'name': 'default', 'range': [117, 117], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [118, 120], 'children': [{'type': 'Argument', 'name': 'o', 'range': [119, 119], 'children': []}]}]}]}]}]}]}
2025-01-08 09:18:35,134 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:18:53,414 - INFO - Step 4 result: {'nodes': [{'type': 'ClassDecl', 'name': 'RedisEventBus', 'range': [377, 386], 'children': [{'type': 'Inheritance', 'name': 'BaseRedisEventBus[M] ABC', 'range': [379, 386], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'connection', 'range': [400, 418], 'children': [{'type': 'ReturnType', 'name': '-> redis.Redis', 'range': [405, 410], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [411, 418], 'children': [{'type': 'ReturnStatement', 'name': 'return redis.get_redis()', 'range': [412, 417], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': 'publish_event', 'range': [420, 458], 'children': [{'type': 'Parameters', 'name': 'self event: M channel_key: str', 'range': [422, 432], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [433, 458], 'children': [{'type': 'Assignment', 'name': 'message full_channel_name = self._serialize_message(event channel_key)', 'range': [435, 446], 'children': []}, {'type': 'CallExpression', 'name': 'self.connection.publish(full_channel_name message)', 'range': [448, 457], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': 'listen_events', 'range': [460, 557], 'children': [{'type': 'Parameters', 'name': 'self channel_key: str', 'range': [462, 468], 'children': []}, {'type': 'ReturnType', 'name': '-> Generator[M None None]', 'range': [469, 478], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [479, 557], 'children': [{'type': 'Assignment', 'name': 'pubsub full_channel_name = self._get_pubsub_channel(self.connection channel_key)', 'range': [481, 496], 'children': []}, {'type': 'AssertStatement', 'name': 'assert isinstance(pubsub PubSub)', 'range': [498, 504], 'children': []}, {'type': 'IfStatement', 'name': 'if "*" in channel_key', 'range': [507, 511], 'children': [{'type': 'CallExpression', 'name': 'pubsub.psubscribe(full_channel_name)', 'range': [513, 518], 'children': []}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [520, 521], 'children': [{'type': 'CallExpression', 'name': 'pubsub.subscribe(full_channel_name)', 'range': [523, 528], 'children': []}]}, {'type': 'ForStatement', 'name': 'for message in pubsub.listen()', 'range': [531, 539], 'children': [{'type': 'IfStatement', 'name': 'if event := self._deserialize_message(message channel_key)', 'range': [541, 553], 'children': [{'type': 'YieldStatement', 'name': 'yield event', 'range': [555, 556], 'children': []}]}]}]}]}]}
2025-01-08 09:18:53,414 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:19:01,357 - INFO - Step 4 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'json', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 8], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [7, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 15], 'children': [{'type': 'ImportSpecifier', 'name': 'ABC', 'range': [12, 12], 'children': []}, {'type': 'ImportSpecifier', 'name': 'abstractmethod', 'range': [14, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [16, 20], 'children': [{'type': 'ImportSpecifier', 'name': 'datetime', 'range': [19, 19], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 35], 'children': [{'type': 'ImportSpecifier', 'name': 'Any', 'range': [24, 24], 'children': []}, {'type': 'ImportSpecifier', 'name': 'AsyncGenerator', 'range': [26, 26], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Generator', 'range': [28, 28], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Generic', 'range': [30, 30], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Optional', 'range': [32, 32], 'children': []}, {'type': 'ImportSpecifier', 'name': 'TypeVar', 'range': [34, 34], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [37, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseModel', 'range': [40, 40], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [42, 52], 'children': [{'type': 'ImportSpecifier', 'name': 'AsyncPubSub', 'range': [51, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 59], 'children': [{'type': 'ImportSpecifier', 'name': 'PubSub', 'range': [58, 58], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [61, 67], 'children': [{'type': 'ImportSpecifier', 'name': 'redis', 'range': [66, 66], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [69, 77], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [70, 77], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [73, 76], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [75, 75], 'children': []}]}]}]}]}
2025-01-08 09:19:01,357 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:19:07,072 - INFO - Step 5 result: {'type': 'Program', 'name': 'DateTimeEncoder', 'range': [78, 122], 'children': [{'type': 'FunctionDecl', 'name': 'default', 'range': [87, 121], 'children': [{'type': 'ParameterList', 'name': '', 'range': [89, 93], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [90, 90], 'children': []}, {'type': 'Parameter', 'name': 'o', 'range': [92, 92], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [94, 121], 'children': [{'type': 'IfStatement', 'name': '', 'range': [96, 111], 'children': [{'type': 'Condition', 'name': '', 'range': [97, 102], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [97, 102], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [98, 102], 'children': [{'type': 'Argument', 'name': 'o', 'range': [99, 99], 'children': []}, {'type': 'Argument', 'name': 'datetime', 'range': [101, 101], 'children': []}]}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [103, 111], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [105, 110], 'children': [{'type': 'CallExpression', 'name': 'isoformat', 'range': [106, 110], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [106, 108], 'children': [{'type': 'Identifier', 'name': 'o', 'range': [106, 106], 'children': []}, {'type': 'Identifier', 'name': 'isoformat', 'range': [108, 108], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [112, 120], 'children': [{'type': 'CallExpression', 'name': 'default', 'range': [113, 120], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [113, 117], 'children': [{'type': 'CallExpression', 'name': 'super', 'range': [113, 115], 'children': []}, {'type': 'Identifier', 'name': 'default', 'range': [117, 117], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [118, 120], 'children': [{'type': 'Argument', 'name': 'o', 'range': [119, 119], 'children': []}]}]}]}]}]}]}
2025-01-08 09:19:07,072 - INFO - Completed main AST analysis flow
2025-01-08 09:19:07,073 - INFO - Successfully processed chunk
2025-01-08 09:19:20,638 - INFO - Step 4 result: {'type': 'Program', 'name': 'BaseRedisEventBus', 'range': [136, 376], 'children': [{'type': 'ClassDecl', 'name': 'BaseRedisEventBus', 'range': [136, 145], 'children': [{'type': 'GenericType', 'name': 'Generic', 'range': [139, 142], 'children': [{'type': 'TypeParameter', 'name': 'M', 'range': [141, 141], 'children': []}]}, {'type': 'Inheritance', 'name': 'ABC', 'range': [144, 144], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'event_bus_name', 'range': [162, 173], 'children': [{'type': 'Decorator', 'name': '@property', 'range': [156, 157], 'children': []}, {'type': 'Decorator', 'name': '@abstractmethod', 'range': [159, 160], 'children': []}, {'type': 'ReturnType', 'name': 'str', 'range': [169, 169], 'children': []}]}, {'type': 'FunctionDecl', 'name': '_serialize_message', 'range': [175, 232], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [178, 178], 'children': []}, {'type': 'Parameter', 'name': 'item', 'range': [180, 180], 'children': [{'type': 'TypeAnnotation', 'name': 'M', 'range': [182, 182], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [184, 184], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [186, 186], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple', 'range': [190, 190], 'children': [{'type': 'TypeParameter', 'name': 'str', 'range': [192, 192], 'children': []}, {'type': 'TypeParameter', 'name': 'str', 'range': [194, 194], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': '_deserialize_message', 'range': [234, 324], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [237, 237], 'children': []}, {'type': 'Parameter', 'name': 'msg', 'range': [239, 239], 'children': [{'type': 'TypeAnnotation', 'name': 'Any', 'range': [241, 241], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [243, 243], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [245, 245], 'children': []}]}, {'type': 'ReturnType', 'name': 'M', 'range': [249, 249], 'children': [{'type': 'TypeParameter', 'name': 'None', 'range': [251, 251], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': '_get_pubsub_channel', 'range': [325, 375], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [329, 329], 'children': []}, {'type': 'Parameter', 'name': 'connection', 'range': [331, 331], 'children': [{'type': 'TypeAnnotation', 'name': 'redis.Redis', 'range': [333, 335], 'children': []}, {'type': 'TypeAnnotation', 'name': 'redis.AsyncRedis', 'range': [337, 339], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [341, 341], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [343, 343], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple', 'range': [348, 348], 'children': [{'type': 'TypeParameter', 'name': 'PubSub', 'range': [350, 350], 'children': []}, {'type': 'TypeParameter', 'name': 'AsyncPubSub', 'range': [352, 352], 'children': []}, {'type': 'TypeParameter', 'name': 'str', 'range': [354, 354], 'children': []}]}]}]}
2025-01-08 09:19:20,638 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:19:30,609 - INFO - Step 5 result: {'nodes': [{'type': 'Program', 'name': 'RedisEventBus', 'range': [377, 557], 'children': [{'type': 'ClassDecl', 'name': 'RedisEventBus', 'range': [377, 386], 'children': [{'type': 'Inheritance', 'name': 'BaseRedisEventBus[M] ABC', 'range': [379, 386], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'connection', 'range': [400, 418], 'children': [{'type': 'ReturnType', 'name': '-> redis.Redis', 'range': [405, 410], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [411, 418], 'children': [{'type': 'ReturnStatement', 'name': 'return redis.get_redis()', 'range': [412, 417], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': 'publish_event', 'range': [420, 458], 'children': [{'type': 'Parameters', 'name': 'self event: M channel_key: str', 'range': [422, 432], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [433, 458], 'children': [{'type': 'Assignment', 'name': 'message full_channel_name = self._serialize_message(event channel_key)', 'range': [435, 446], 'children': []}, {'type': 'CallExpression', 'name': 'self.connection.publish(full_channel_name message)', 'range': [448, 457], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': 'listen_events', 'range': [460, 557], 'children': [{'type': 'Parameters', 'name': 'self channel_key: str', 'range': [462, 468], 'children': []}, {'type': 'ReturnType', 'name': '-> Generator[M None None]', 'range': [469, 478], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [479, 557], 'children': [{'type': 'Assignment', 'name': 'pubsub full_channel_name = self._get_pubsub_channel(self.connection channel_key)', 'range': [481, 496], 'children': []}, {'type': 'AssertStatement', 'name': 'assert isinstance(pubsub PubSub)', 'range': [498, 504], 'children': []}, {'type': 'IfStatement', 'name': 'if "*" in channel_key', 'range': [507, 511], 'children': [{'type': 'CallExpression', 'name': 'pubsub.psubscribe(full_channel_name)', 'range': [513, 518], 'children': []}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [520, 521], 'children': [{'type': 'CallExpression', 'name': 'pubsub.subscribe(full_channel_name)', 'range': [523, 528], 'children': []}]}, {'type': 'ForStatement', 'name': 'for message in pubsub.listen()', 'range': [531, 539], 'children': [{'type': 'IfStatement', 'name': 'if event := self._deserialize_message(message channel_key)', 'range': [541, 553], 'children': [{'type': 'YieldStatement', 'name': 'yield event', 'range': [555, 556], 'children': []}]}]}]}]}]}]}
2025-01-08 09:19:30,610 - INFO - Completed main AST analysis flow
2025-01-08 09:19:30,610 - INFO - Successfully processed chunk
2025-01-08 09:19:36,553 - INFO - Step 3 result: {'type': 'Program', 'name': 'AsyncRedisEventBus', 'range': [560, 816], 'children': [{'type': 'ClassDeclaration', 'name': 'AsyncRedisEventBus', 'range': [560, 569], 'children': [{'type': 'Inheritance', 'name': 'BaseRedisEventBus', 'range': [563, 569], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'connection', 'range': [580, 603], 'children': [{'type': 'ReturnType', 'name': 'redis.AsyncRedis', 'range': [589, 594], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [595, 603], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [596, 603], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [597, 603], 'children': [{'type': 'CallExpression', 'name': 'redis.get_redis_async', 'range': [598, 603], 'children': []}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'publish_event', 'range': [605, 650], 'children': [{'type': 'Parameters', 'name': '', 'range': [608, 618], 'children': [{'type': 'Parameter', 'name': 'event', 'range': [611, 613], 'children': []}, {'type': 'Parameter', 'name': 'channel_key', 'range': [615, 617], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [619, 650], 'children': [{'type': 'VariableDeclaration', 'name': 'message, full_channel_name', 'range': [621, 633], 'children': [{'type': 'CallExpression', 'name': 'self._serialize_message', 'range': [625, 633], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'connection', 'range': [634, 640], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [636, 640], 'children': [{'type': 'MemberExpression', 'name': 'self.connection', 'range': [637, 640], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [641, 650], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [641, 650], 'children': [{'type': 'CallExpression', 'name': 'connection.publish', 'range': [642, 650], 'children': []}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'listen_events', 'range': [652, 752], 'children': [{'type': 'Parameters', 'name': '', 'range': [655, 661], 'children': [{'type': 'Parameter', 'name': 'channel_key', 'range': [658, 660], 'children': []}]}, {'type': 'ReturnType', 'name': 'AsyncGenerator[M, None]', 'range': [662, 670], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [671, 752], 'children': [{'type': 'VariableDeclaration', 'name': 'pubsub, full_channel_name', 'range': [672, 689], 'children': [{'type': 'CallExpression', 'name': 'self._get_pubsub_channel', 'range': [676, 689], 'children': []}]}, {'type': 'AssertStatement', 'name': '', 'range': [690, 697], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [691, 697], 'children': []}]}, {'type': 'IfStatement', 'name': '', 'range': [699, 723], 'children': [{'type': 'Condition', 'name': '', 'range': [700, 703], 'children': []}, {'type': 'Block', 'name': '', 'range': [704, 712], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [705, 712], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [705, 712], 'children': [{'type': 'CallExpression', 'name': 'pubsub.psubscribe', 'range': [706, 712], 'children': []}]}]}]}, {'type': 'ElseStatement', 'name': '', 'range': [713, 723], 'children': [{'type': 'Block', 'name': '', 'range': [714, 723], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [716, 723], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [716, 723], 'children': [{'type': 'CallExpression', 'name': 'pubsub.subscribe', 'range': [717, 723], 'children': []}]}]}]}]}]}, {'type': 'ForStatement', 'name': '', 'range': [725, 752], 'children': [{'type': 'Initialization', 'name': 'message', 'range': [727, 728], 'children': []}, {'type': 'Condition', 'name': '', 'range': [729, 734], 'children': []}, {'type': 'Block', 'name': '', 'range': [735, 752], 'children': [{'type': 'IfStatement', 'name': '', 'range': [736, 748], 'children': [{'type': 'Condition', 'name': '', 'range': [737, 739], 'children': []}, {'type': 'Block', 'name': '', 'range': [740, 748], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [740, 748], 'children': [{'type': 'CallExpression', 'name': 'self._deserialize_message', 'range': [742, 748], 'children': []}]}]}]}, {'type': 'YieldStatement', 'name': '', 'range': [750, 752], 'children': []}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'wait_for_event', 'range': [754, 815], 'children': [{'type': 'Parameters', 'name': '', 'range': [757, 773], 'children': [{'type': 'Parameter', 'name': 'channel_key', 'range': [761, 763], 'children': []}, {'type': 'Parameter', 'name': 'timeout', 'range': [765, 772], 'children': []}]}, {'type': 'ReturnType', 'name': 'M | None', 'range': [775, 780], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [781, 815], 'children': [{'type': 'TryStatement', 'name': '', 'range': [782, 815], 'children': [{'type': 'Block', 'name': '', 'range': [783, 808], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [785, 808], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [786, 808], 'children': [{'type': 'CallExpression', 'name': 'asyncio.wait_for', 'range': [787, 808], 'children': []}]}]}]}, {'type': 'CatchStatement', 'name': 'TimeoutError', 'range': [809, 815], 'children': [{'type': 'Block', 'name': '', 'range': [810, 815], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [813, 815], 'children': []}]}]}]}]}]}]}
2025-01-08 09:19:36,554 - INFO - Starting Step 4: AST normalization
2025-01-08 09:19:42,272 - INFO - Step 5 result: {'nodes': [{'type': 'Program', 'name': 'MainProgram', 'range': [0, 77], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'json', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 8], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [7, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 15], 'children': [{'type': 'ImportSpecifier', 'name': 'ABC', 'range': [12, 12], 'children': []}, {'type': 'ImportSpecifier', 'name': 'abstractmethod', 'range': [14, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [16, 20], 'children': [{'type': 'ImportSpecifier', 'name': 'datetime', 'range': [19, 19], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 35], 'children': [{'type': 'ImportSpecifier', 'name': 'Any', 'range': [24, 24], 'children': []}, {'type': 'ImportSpecifier', 'name': 'AsyncGenerator', 'range': [26, 26], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Generator', 'range': [28, 28], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Generic', 'range': [30, 30], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Optional', 'range': [32, 32], 'children': []}, {'type': 'ImportSpecifier', 'name': 'TypeVar', 'range': [34, 34], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [37, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseModel', 'range': [40, 40], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [42, 52], 'children': [{'type': 'ImportSpecifier', 'name': 'AsyncPubSub', 'range': [51, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 59], 'children': [{'type': 'ImportSpecifier', 'name': 'PubSub', 'range': [58, 58], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [61, 67], 'children': [{'type': 'ImportSpecifier', 'name': 'redis', 'range': [66, 66], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [69, 77], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [70, 77], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [73, 76], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [75, 75], 'children': []}]}]}]}]}]}
2025-01-08 09:19:42,272 - INFO - Completed main AST analysis flow
2025-01-08 09:19:42,273 - INFO - Successfully processed chunk
2025-01-08 09:20:07,359 - INFO - Step 5 result: {'type': 'Program', 'name': 'BaseRedisEventBus', 'range': [136, 376], 'children': [{'type': 'ClassDecl', 'name': 'BaseRedisEventBus', 'range': [136, 145], 'children': [{'type': 'GenericType', 'name': 'Generic', 'range': [139, 142], 'children': [{'type': 'TypeParameter', 'name': 'M', 'range': [141, 141], 'children': []}]}, {'type': 'Inheritance', 'name': 'ABC', 'range': [144, 144], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'event_bus_name', 'range': [162, 173], 'children': [{'type': 'Decorator', 'name': '@property', 'range': [156, 157], 'children': []}, {'type': 'Decorator', 'name': '@abstractmethod', 'range': [159, 160], 'children': []}, {'type': 'ReturnType', 'name': 'str', 'range': [169, 169], 'children': []}]}, {'type': 'FunctionDecl', 'name': '_serialize_message', 'range': [175, 232], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [178, 178], 'children': []}, {'type': 'Parameter', 'name': 'item', 'range': [180, 180], 'children': [{'type': 'TypeAnnotation', 'name': 'M', 'range': [182, 182], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [184, 184], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [186, 186], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple', 'range': [190, 190], 'children': [{'type': 'TypeParameter', 'name': 'str', 'range': [192, 192], 'children': []}, {'type': 'TypeParameter', 'name': 'str', 'range': [194, 194], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': '_deserialize_message', 'range': [234, 324], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [237, 237], 'children': []}, {'type': 'Parameter', 'name': 'msg', 'range': [239, 239], 'children': [{'type': 'TypeAnnotation', 'name': 'Any', 'range': [241, 241], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [243, 243], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [245, 245], 'children': []}]}, {'type': 'ReturnType', 'name': 'M', 'range': [249, 249], 'children': [{'type': 'TypeParameter', 'name': 'None', 'range': [251, 251], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': '_get_pubsub_channel', 'range': [325, 375], 'children': [{'type': 'Parameter', 'name': 'self', 'range': [329, 329], 'children': []}, {'type': 'Parameter', 'name': 'connection', 'range': [331, 331], 'children': [{'type': 'TypeAnnotation', 'name': 'redis.Redis', 'range': [333, 335], 'children': []}, {'type': 'TypeAnnotation', 'name': 'redis.AsyncRedis', 'range': [337, 339], 'children': []}]}, {'type': 'Parameter', 'name': 'channel_key', 'range': [341, 341], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [343, 343], 'children': []}]}, {'type': 'ReturnType', 'name': 'tuple', 'range': [348, 348], 'children': [{'type': 'TypeParameter', 'name': 'PubSub', 'range': [350, 350], 'children': []}, {'type': 'TypeParameter', 'name': 'AsyncPubSub', 'range': [352, 352], 'children': []}, {'type': 'TypeParameter', 'name': 'str', 'range': [354, 354], 'children': []}]}]}]}
2025-01-08 09:20:07,360 - INFO - Completed main AST analysis flow
2025-01-08 09:20:07,361 - INFO - Successfully processed chunk
2025-01-08 09:20:56,468 - INFO - Step 4 result: {'type': 'Program', 'name': 'AsyncRedisEventBus', 'range': [560, 816], 'children': [{'type': 'ClassDecl', 'name': 'AsyncRedisEventBus', 'range': [560, 569], 'children': [{'type': 'Inheritance', 'name': 'BaseRedisEventBus', 'range': [563, 569], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'connection', 'range': [580, 603], 'children': [{'type': 'ReturnType', 'name': 'redis.AsyncRedis', 'range': [589, 594], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [595, 603], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [596, 603], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [597, 603], 'children': [{'type': 'CallExpression', 'name': 'redis.get_redis_async', 'range': [598, 603], 'children': []}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'publish_event', 'range': [605, 650], 'children': [{'type': 'Parameters', 'name': '', 'range': [608, 618], 'children': [{'type': 'Parameter', 'name': 'event', 'range': [611, 613], 'children': []}, {'type': 'Parameter', 'name': 'channel_key', 'range': [615, 617], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [619, 650], 'children': [{'type': 'VariableDecl', 'name': 'message, full_channel_name', 'range': [621, 633], 'children': [{'type': 'CallExpression', 'name': 'self._serialize_message', 'range': [625, 633], 'children': []}]}, {'type': 'VariableDecl', 'name': 'connection', 'range': [634, 640], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [636, 640], 'children': [{'type': 'MemberExpression', 'name': 'self.connection', 'range': [637, 640], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [641, 650], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [641, 650], 'children': [{'type': 'CallExpression', 'name': 'connection.publish', 'range': [642, 650], 'children': []}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'listen_events', 'range': [652, 752], 'children': [{'type': 'Parameters', 'name': '', 'range': [655, 661], 'children': [{'type': 'Parameter', 'name': 'channel_key', 'range': [658, 660], 'children': []}]}, {'type': 'ReturnType', 'name': 'AsyncGenerator[M, None]', 'range': [662, 670], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [671, 752], 'children': [{'type': 'VariableDecl', 'name': 'pubsub, full_channel_name', 'range': [672, 689], 'children': [{'type': 'CallExpression', 'name': 'self._get_pubsub_channel', 'range': [676, 689], 'children': []}]}, {'type': 'AssertStatement', 'name': '', 'range': [690, 697], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [691, 697], 'children': []}]}, {'type': 'IfStatement', 'name': '', 'range': [699, 723], 'children': [{'type': 'Condition', 'name': '', 'range': [700, 703], 'children': []}, {'type': 'Block', 'name': '', 'range': [704, 712], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [705, 712], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [705, 712], 'children': [{'type': 'CallExpression', 'name': 'pubsub.psubscribe', 'range': [706, 712], 'children': []}]}]}]}, {'type': 'ElseStatement', 'name': '', 'range': [713, 723], 'children': [{'type': 'Block', 'name': '', 'range': [714, 723], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [716, 723], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [716, 723], 'children': [{'type': 'CallExpression', 'name': 'pubsub.subscribe', 'range': [717, 723], 'children': []}]}]}]}]}]}, {'type': 'ForStatement', 'name': '', 'range': [725, 752], 'children': [{'type': 'Initialization', 'name': 'message', 'range': [727, 728], 'children': []}, {'type': 'Condition', 'name': '', 'range': [729, 734], 'children': []}, {'type': 'Block', 'name': '', 'range': [735, 752], 'children': [{'type': 'IfStatement', 'name': '', 'range': [736, 748], 'children': [{'type': 'Condition', 'name': '', 'range': [737, 739], 'children': []}, {'type': 'Block', 'name': '', 'range': [740, 748], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [740, 748], 'children': [{'type': 'CallExpression', 'name': 'self._deserialize_message', 'range': [742, 748], 'children': []}]}]}]}, {'type': 'YieldStatement', 'name': '', 'range': [750, 752], 'children': []}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'wait_for_event', 'range': [754, 815], 'children': [{'type': 'Parameters', 'name': '', 'range': [757, 773], 'children': [{'type': 'Parameter', 'name': 'channel_key', 'range': [761, 763], 'children': []}, {'type': 'Parameter', 'name': 'timeout', 'range': [765, 772], 'children': []}]}, {'type': 'ReturnType', 'name': 'M | None', 'range': [775, 780], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [781, 815], 'children': [{'type': 'TryStatement', 'name': '', 'range': [782, 815], 'children': [{'type': 'Block', 'name': '', 'range': [783, 808], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [785, 808], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [786, 808], 'children': [{'type': 'CallExpression', 'name': 'asyncio.wait_for', 'range': [787, 808], 'children': []}]}]}]}, {'type': 'CatchStatement', 'name': 'TimeoutError', 'range': [809, 815], 'children': [{'type': 'Block', 'name': '', 'range': [810, 815], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [813, 815], 'children': []}]}]}]}]}]}]}
2025-01-08 09:20:56,469 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:22:16,928 - INFO - Step 5 result: {'type': 'Program', 'name': 'AsyncRedisEventBus', 'range': [560, 815], 'children': [{'type': 'ClassDecl', 'name': 'AsyncRedisEventBus', 'range': [560, 569], 'children': [{'type': 'Inheritance', 'name': 'BaseRedisEventBus', 'range': [563, 569], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'connection', 'range': [580, 603], 'children': [{'type': 'ReturnType', 'name': 'redis.AsyncRedis', 'range': [589, 594], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [595, 603], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [596, 603], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [597, 603], 'children': [{'type': 'CallExpression', 'name': 'redis.get_redis_async', 'range': [598, 603], 'children': []}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'publish_event', 'range': [605, 650], 'children': [{'type': 'Parameters', 'name': '', 'range': [608, 618], 'children': [{'type': 'Parameter', 'name': 'event', 'range': [611, 613], 'children': []}, {'type': 'Parameter', 'name': 'channel_key', 'range': [615, 617], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [619, 650], 'children': [{'type': 'VariableDecl', 'name': 'message, full_channel_name', 'range': [621, 633], 'children': [{'type': 'CallExpression', 'name': 'self._serialize_message', 'range': [625, 633], 'children': []}]}, {'type': 'VariableDecl', 'name': 'connection', 'range': [634, 640], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [636, 640], 'children': [{'type': 'MemberExpression', 'name': 'self.connection', 'range': [637, 640], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [641, 650], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [641, 650], 'children': [{'type': 'CallExpression', 'name': 'connection.publish', 'range': [642, 650], 'children': []}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'listen_events', 'range': [652, 752], 'children': [{'type': 'Parameters', 'name': '', 'range': [655, 661], 'children': [{'type': 'Parameter', 'name': 'channel_key', 'range': [658, 660], 'children': []}]}, {'type': 'ReturnType', 'name': 'AsyncGenerator[M, None]', 'range': [662, 670], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [671, 752], 'children': [{'type': 'VariableDecl', 'name': 'pubsub, full_channel_name', 'range': [672, 689], 'children': [{'type': 'CallExpression', 'name': 'self._get_pubsub_channel', 'range': [676, 689], 'children': []}]}, {'type': 'AssertStatement', 'name': '', 'range': [690, 697], 'children': [{'type': 'CallExpression', 'name': 'isinstance', 'range': [691, 697], 'children': []}]}, {'type': 'IfStatement', 'name': '', 'range': [699, 723], 'children': [{'type': 'Condition', 'name': '', 'range': [700, 703], 'children': []}, {'type': 'Block', 'name': '', 'range': [704, 712], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [705, 712], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [705, 712], 'children': [{'type': 'CallExpression', 'name': 'pubsub.psubscribe', 'range': [706, 712], 'children': []}]}]}]}, {'type': 'ElseStatement', 'name': '', 'range': [713, 723], 'children': [{'type': 'Block', 'name': '', 'range': [714, 723], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [716, 723], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [716, 723], 'children': [{'type': 'CallExpression', 'name': 'pubsub.subscribe', 'range': [717, 723], 'children': []}]}]}]}]}]}, {'type': 'ForStatement', 'name': '', 'range': [725, 752], 'children': [{'type': 'Initialization', 'name': 'message', 'range': [727, 728], 'children': []}, {'type': 'Condition', 'name': '', 'range': [729, 734], 'children': []}, {'type': 'Block', 'name': '', 'range': [735, 752], 'children': [{'type': 'IfStatement', 'name': '', 'range': [736, 748], 'children': [{'type': 'Condition', 'name': '', 'range': [737, 739], 'children': []}, {'type': 'Block', 'name': '', 'range': [740, 748], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [740, 748], 'children': [{'type': 'CallExpression', 'name': 'self._deserialize_message', 'range': [742, 748], 'children': []}]}]}]}, {'type': 'YieldStatement', 'name': '', 'range': [750, 752], 'children': []}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'wait_for_event', 'range': [754, 815], 'children': [{'type': 'Parameters', 'name': '', 'range': [757, 773], 'children': [{'type': 'Parameter', 'name': 'channel_key', 'range': [761, 763], 'children': []}, {'type': 'Parameter', 'name': 'timeout', 'range': [765, 772], 'children': []}]}, {'type': 'ReturnType', 'name': 'M | None', 'range': [775, 780], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [781, 815], 'children': [{'type': 'TryStatement', 'name': '', 'range': [782, 815], 'children': [{'type': 'Block', 'name': '', 'range': [783, 808], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [785, 808], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [786, 808], 'children': [{'type': 'CallExpression', 'name': 'asyncio.wait_for', 'range': [787, 808], 'children': []}]}]}]}, {'type': 'CatchStatement', 'name': 'TimeoutError', 'range': [809, 815], 'children': [{'type': 'Block', 'name': '', 'range': [810, 815], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [813, 815], 'children': []}]}]}]}]}]}]}
2025-01-08 09:22:16,928 - INFO - Completed main AST analysis flow
2025-01-08 09:22:16,930 - INFO - Successfully processed chunk
2025-01-08 09:22:16,957 - INFO - Starting code generation from AST
2025-01-08 09:22:50,307 - INFO - Successfully generated code from AST
2025-01-08 09:22:50,309 - INFO - Starting static code similarity comparison
2025-01-08 09:22:50,322 - INFO - Static similarity result: {'final_score': 93.29, 'length_similarity': 90.63, 'token_similarity': 92.06, 'structure_similarity': 88.3, 'function_similarity': 100, 'complexity_similarity': 100.0, 'variable_similarity': 100}
