2025-01-08 10:27:27,256 - INFO - Processing sample 21
2025-01-08 10:27:27,256 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 10:27:52,354 - INFO - Successfully split code into 35 top-level declarations
2025-01-08 10:27:52,881 - INFO - Processing chunk #0 (size=1643 chars, start_index=0)
2025-01-08 10:27:52,884 - INFO - Processing chunk with 1643 chars starting at index 0
2025-01-08 10:27:52,884 - INFO - Starting main AST analysis flow
2025-01-08 10:27:52,973 - INFO - Tokenized code into 278 tokens
2025-01-08 10:27:52,973 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:53,037 - INFO - Processing chunk #1 (size=116 chars, start_index=278)
2025-01-08 10:27:53,041 - INFO - Processing chunk with 116 chars starting at index 278
2025-01-08 10:27:53,041 - INFO - Starting main AST analysis flow
2025-01-08 10:27:53,041 - INFO - Tokenized code into 19 tokens
2025-01-08 10:27:53,075 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:58,917 - INFO - Processing chunk #2 (size=122 chars, start_index=297)
2025-01-08 10:27:58,923 - INFO - Processing chunk with 122 chars starting at index 297
2025-01-08 10:27:58,927 - INFO - Starting main AST analysis flow
2025-01-08 10:27:58,928 - INFO - Tokenized code into 19 tokens
2025-01-08 10:27:58,935 - INFO - Processing chunk #3 (size=167 chars, start_index=316)
2025-01-08 10:27:58,944 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:58,954 - INFO - Processing chunk with 167 chars starting at index 316
2025-01-08 10:27:58,957 - INFO - Processing chunk #4 (size=323 chars, start_index=346)
2025-01-08 10:27:58,961 - INFO - Processing chunk #5 (size=242 chars, start_index=424)
2025-01-08 10:27:58,967 - INFO - Processing chunk #6 (size=323 chars, start_index=477)
2025-01-08 10:27:58,967 - INFO - Starting main AST analysis flow
2025-01-08 10:27:58,968 - INFO - Processing chunk #7 (size=481 chars, start_index=580)
2025-01-08 10:27:58,971 - INFO - Processing chunk with 323 chars starting at index 346
2025-01-08 10:27:58,974 - INFO - Processing chunk #8 (size=334 chars, start_index=691)
2025-01-08 10:27:58,975 - INFO - Processing chunk with 242 chars starting at index 424
2025-01-08 10:27:58,979 - INFO - Processing chunk #9 (size=63 chars, start_index=777)
2025-01-08 10:27:58,981 - INFO - Processing chunk with 323 chars starting at index 477
2025-01-08 10:27:58,984 - INFO - Processing chunk #10 (size=271 chars, start_index=789)
2025-01-08 10:27:58,989 - INFO - Tokenized code into 30 tokens
2025-01-08 10:27:59,291 - INFO - Processing chunk #11 (size=661 chars, start_index=857)
2025-01-08 10:27:59,331 - INFO - Processing chunk with 481 chars starting at index 580
2025-01-08 10:27:59,369 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,370 - INFO - Processing chunk #12 (size=599 chars, start_index=1004)
2025-01-08 10:27:59,408 - INFO - Processing chunk with 334 chars starting at index 691
2025-01-08 10:27:59,431 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,456 - INFO - Processing chunk with 63 chars starting at index 777
2025-01-08 10:27:59,466 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,475 - INFO - Processing chunk with 271 chars starting at index 789
2025-01-08 10:27:59,489 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,501 - INFO - Processing chunk with 661 chars starting at index 857
2025-01-08 10:27:59,502 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,507 - INFO - Tokenized code into 78 tokens
2025-01-08 10:27:59,509 - INFO - Processing chunk with 599 chars starting at index 1004
2025-01-08 10:27:59,511 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,513 - INFO - Tokenized code into 53 tokens
2025-01-08 10:27:59,654 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,515 - INFO - Tokenized code into 103 tokens
2025-01-08 10:27:59,515 - INFO - Processing chunk #13 (size=310 chars, start_index=1133)
2025-01-08 10:27:59,518 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,525 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,668 - INFO - Tokenized code into 147 tokens
2025-01-08 10:27:59,530 - INFO - Processing chunk #14 (size=1286 chars, start_index=1204)
2025-01-08 10:27:59,540 - INFO - Processing chunk #15 (size=606 chars, start_index=1419)
2025-01-08 10:27:59,550 - INFO - Processing chunk #16 (size=2326 chars, start_index=1540)
2025-01-08 10:27:59,682 - INFO - Processing chunk with 2326 chars starting at index 1540
2025-01-08 10:27:59,590 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,684 - INFO - Tokenized code into 129 tokens
2025-01-08 10:27:59,684 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,650 - INFO - Tokenized code into 86 tokens
2025-01-08 10:27:59,686 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,514 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,689 - INFO - Tokenized code into 12 tokens
2025-01-08 10:27:59,689 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,659 - INFO - Processing chunk with 310 chars starting at index 1133
2025-01-08 10:27:59,661 - INFO - Processing chunk #21 (size=564 chars, start_index=2530)
2025-01-08 10:27:59,662 - INFO - Tokenized code into 68 tokens
2025-01-08 10:27:59,667 - INFO - Processing chunk #22 (size=307 chars, start_index=2641)
2025-01-08 10:27:59,530 - INFO - Tokenized code into 111 tokens
2025-01-08 10:27:59,723 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,670 - INFO - Processing chunk #23 (size=421 chars, start_index=2716)
2025-01-08 10:27:59,730 - INFO - Processing chunk with 421 chars starting at index 2716
2025-01-08 10:27:59,678 - INFO - Processing chunk with 1286 chars starting at index 1204
2025-01-08 10:27:59,679 - INFO - Processing chunk #25 (size=115 chars, start_index=2886)
2025-01-08 10:27:59,679 - INFO - Processing chunk with 606 chars starting at index 1419
2025-01-08 10:27:59,680 - INFO - Processing chunk #26 (size=767 chars, start_index=2913)
2025-01-08 10:27:59,573 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,682 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,621 - INFO - Processing chunk #17 (size=1420 chars, start_index=1950)
2025-01-08 10:27:59,645 - INFO - Processing chunk #18 (size=623 chars, start_index=2182)
2025-01-08 10:27:59,763 - INFO - Processing chunk with 623 chars starting at index 2182
2025-01-08 10:27:59,686 - INFO - Processing chunk #28 (size=376 chars, start_index=3147)
2025-01-08 10:27:59,653 - INFO - Processing chunk #19 (size=709 chars, start_index=2328)
2025-01-08 10:27:59,764 - INFO - Processing chunk with 709 chars starting at index 2328
2025-01-08 10:27:59,655 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,693 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,785 - INFO - Tokenized code into 71 tokens
2025-01-08 10:27:59,699 - INFO - Processing chunk #30 (size=549 chars, start_index=3394)
2025-01-08 10:27:59,704 - INFO - Processing chunk with 564 chars starting at index 2530
2025-01-08 10:27:59,706 - INFO - Processing chunk #31 (size=688 chars, start_index=3512)
2025-01-08 10:27:59,706 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,710 - INFO - Processing chunk #32 (size=784 chars, start_index=3654)
2025-01-08 10:27:59,722 - INFO - Processing chunk with 307 chars starting at index 2641
2025-01-08 10:27:59,670 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,678 - INFO - Processing chunk #24 (size=337 chars, start_index=2810)
2025-01-08 10:27:59,730 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,733 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,734 - INFO - Processing chunk with 115 chars starting at index 2886
2025-01-08 10:27:59,740 - INFO - Processing chunk #33 (size=790 chars, start_index=3810)
2025-01-08 10:27:59,740 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,743 - INFO - Processing chunk #34 (size=895 chars, start_index=3966)
2025-01-08 10:27:59,749 - INFO - Processing chunk with 767 chars starting at index 2913
2025-01-08 10:27:59,761 - INFO - Tokenized code into 410 tokens
2025-01-08 10:27:59,763 - INFO - Processing chunk with 1420 chars starting at index 1950
2025-01-08 10:27:59,763 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,903 - INFO - Tokenized code into 146 tokens
2025-01-08 10:27:59,903 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,656 - INFO - Processing chunk #20 (size=279 chars, start_index=2460)
2025-01-08 10:27:59,769 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,699 - INFO - Processing chunk #29 (size=818 chars, start_index=3234)
2025-01-08 10:27:59,905 - INFO - Processing chunk with 818 chars starting at index 3234
2025-01-08 10:27:59,787 - INFO - Processing chunk with 549 chars starting at index 3394
2025-01-08 10:27:59,909 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,807 - INFO - Processing chunk with 688 chars starting at index 3512
2025-01-08 10:27:59,825 - INFO - Processing chunk with 784 chars starting at index 3654
2025-01-08 10:27:59,837 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,856 - INFO - Processing chunk with 337 chars starting at index 2810
2025-01-08 10:27:59,862 - INFO - Tokenized code into 94 tokens
2025-01-08 10:27:59,872 - INFO - Tokenized code into 215 tokens
2025-01-08 10:27:59,874 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,875 - INFO - Processing chunk with 790 chars starting at index 3810
2025-01-08 10:27:59,878 - INFO - Tokenized code into 121 tokens
2025-01-08 10:27:59,902 - INFO - Processing chunk with 895 chars starting at index 3966
2025-01-08 10:27:59,902 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,902 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,903 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,684 - INFO - Processing chunk #27 (size=352 chars, start_index=3064)
2025-01-08 10:27:59,917 - INFO - Processing chunk with 352 chars starting at index 3064
2025-01-08 10:27:59,917 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,904 - INFO - Tokenized code into 132 tokens
2025-01-08 10:27:59,785 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,905 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,920 - INFO - Tokenized code into 160 tokens
2025-01-08 10:27:59,795 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,909 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,927 - INFO - Tokenized code into 142 tokens
2025-01-08 10:27:59,910 - INFO - Tokenized code into 75 tokens
2025-01-08 10:27:59,910 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,928 - INFO - Tokenized code into 76 tokens
2025-01-08 10:27:59,928 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,911 - INFO - Tokenized code into 27 tokens
2025-01-08 10:27:59,911 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,911 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,911 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,930 - INFO - Tokenized code into 167 tokens
2025-01-08 10:27:59,913 - INFO - Tokenized code into 232 tokens
2025-01-08 10:27:59,764 - INFO - Processing chunk with 376 chars starting at index 3147
2025-01-08 10:27:59,942 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,904 - INFO - Processing chunk with 279 chars starting at index 2460
2025-01-08 10:27:59,918 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,920 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,909 - INFO - Tokenized code into 118 tokens
2025-01-08 10:28:00,037 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,927 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,909 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,927 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,910 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,910 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,928 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,929 - INFO - Tokenized code into 156 tokens
2025-01-08 10:27:59,930 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,912 - INFO - Tokenized code into 151 tokens
2025-01-08 10:28:00,274 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,918 - INFO - Tokenized code into 83 tokens
2025-01-08 10:28:00,279 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,954 - INFO - Starting main AST analysis flow
2025-01-08 10:27:59,926 - INFO - Tokenized code into 111 tokens
2025-01-08 10:28:00,113 - INFO - Tokenized code into 156 tokens
2025-01-08 10:28:00,239 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,940 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:59,955 - INFO - Tokenized code into 87 tokens
2025-01-08 10:28:00,751 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:28:00,354 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:28:00,480 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:28:00,351 - INFO - Tokenized code into 70 tokens
2025-01-08 10:28:00,768 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:28:03,016 - INFO - Step 1 result: {'type': 'Program', 'name': 'execution_manager_client', 'range': [278, 296], 'children': [{'type': 'FunctionDeclaration', 'name': 'execution_manager_client', 'range': [281, 295], 'children': [{'type': 'ReturnStatement', 'range': [290, 294], 'children': [{'type': 'CallExpression', 'callee': {'type': 'Identifier', 'name': 'get_service_client'}, 'arguments': [{'type': 'Identifier', 'name': 'ExecutionManager'}], 'range': [291, 294]}]}]}]}
2025-01-08 10:28:03,016 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:09,916 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [789, 812], 'children': []}
2025-01-08 10:28:09,916 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,101 - INFO - Step 1 result: {'type': 'Program', 'name': 'do_create_graph', 'range': [1204, 1418], 'children': []}
2025-01-08 10:28:10,102 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,137 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [3512, 3653], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_api_key', 'range': [3555, 3653], 'children': []}]}
2025-01-08 10:28:10,137 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,155 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2530, 2558], 'children': []}
2025-01-08 10:28:10,155 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,408 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [1133, 1158], 'children': []}
2025-01-08 10:28:10,408 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,476 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [691, 708], 'children': []}
2025-01-08 10:28:10,476 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,493 - INFO - Step 1 result: {'type': 'Program', 'name': 'delete_api_key', 'range': [3654, 3809], 'children': []}
2025-01-08 10:28:10,493 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,550 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2716, 2747], 'children': []}
2025-01-08 10:28:10,550 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,607 - INFO - Step 1 result: {'type': 'Program', 'name': 'DeleteGraphResponse', 'range': [777, 788], 'children': []}
2025-01-08 10:28:10,608 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,642 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2641, 2672], 'children': []}
2025-01-08 10:28:10,643 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,715 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2810, 2841], 'children': []}
2025-01-08 10:28:10,715 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,717 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [477, 579], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_graph_blocks', 'range': [502, 579], 'children': []}]}
2025-01-08 10:28:10,717 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,747 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [580, 608], 'children': []}
2025-01-08 10:28:10,747 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,959 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2460, 2488], 'children': []}
2025-01-08 10:28:10,959 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:10,961 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2182, 2211], 'children': []}
2025-01-08 10:28:10,963 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,027 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2913, 3063], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_schedule', 'range': [2943, 3063], 'children': []}]}
2025-01-08 10:28:11,027 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,112 - INFO - Step 1 result: {'type': 'Program', 'name': 'stop_graph_run', 'range': [2328, 2459], 'children': []}
2025-01-08 10:28:11,112 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,116 - INFO - Step 1 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [3810, 3852], 'children': []}
2025-01-08 10:28:11,116 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,131 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_api_keys', 'range': [3394, 3511], 'children': []}
2025-01-08 10:28:11,131 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,177 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [857, 1003], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_graph', 'range': [914, 1003], 'children': []}]}
2025-01-08 10:28:11,177 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,234 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [424, 476], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_or_create_user_route', 'range': [447, 476], 'children': []}]}
2025-01-08 10:28:11,234 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,338 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [3147, 3233], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_execution_schedules', 'range': [3177, 3233], 'children': []}]}
2025-01-08 10:28:11,339 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,532 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [1004, 1132], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_graph_all_versions', 'range': [1066, 1132], 'children': []}]}
2025-01-08 10:28:11,532 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,995 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [1419, 1539], 'children': [{'type': 'FunctionDeclaration', 'name': 'delete_graph', 'range': [1446, 1539], 'children': []}, {'type': 'FunctionDeclaration', 'name': 'get_credentials', 'range': [1491, 1512], 'children': []}]}
2025-01-08 10:28:12,000 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:12,095 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [1950, 2181], 'children': [{'type': 'FunctionDeclaration', 'name': 'set_graph_active_version', 'range': [1980, 2146], 'children': []}, {'type': 'FunctionDeclaration', 'name': 'get_credentials', 'range': [2065, 2086], 'children': []}]}
2025-01-08 10:28:12,100 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:12,165 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [1540, 1949], 'children': [{'type': 'FunctionDeclaration', 'name': 'update_graph', 'range': [1599, 1949], 'children': []}]}
2025-01-08 10:28:12,258 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:12,705 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [316, 345], 'children': [{'type': 'VariableDeclaration', 'name': 'settings', 'range': [316, 320], 'children': []}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [322, 329], 'children': []}, {'type': 'VariableDeclaration', 'name': 'integration_creds_manager', 'range': [331, 335], 'children': []}, {'type': 'VariableDeclaration', 'name': '_user_credit_model', 'range': [339, 343], 'children': []}]}
2025-01-08 10:28:12,818 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:12,953 - INFO - Step 1 result: {'type': 'Program', 'name': 'execution_scheduler_client', 'range': [297, 315], 'children': [{'type': 'FunctionDeclaration', 'name': 'execution_scheduler_client', 'range': [300, 314], 'children': [{'type': 'ReturnStatement', 'range': [309, 313], 'children': [{'type': 'CallExpression', 'range': [310, 313], 'children': [{'type': 'Identifier', 'name': 'get_service_client', 'range': [310, 310]}, {'type': 'Identifier', 'name': 'ExecutionScheduler', 'range': [312, 312]}]}]}]}]}
2025-01-08 10:28:12,958 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:12,977 - INFO - Step 1 result: {'type': 'Program', 'name': 'ScheduleCreationRequest', 'range': [2886, 2912], 'children': [{'type': 'ClassDeclaration', 'name': 'ScheduleCreationRequest', 'range': [2886, 2912], 'children': [{'type': 'Property', 'name': 'cron', 'range': [2895, 2897], 'children': []}, {'type': 'Property', 'name': 'input_data', 'range': [2899, 2906], 'children': []}, {'type': 'Property', 'name': 'graph_id', 'range': [2908, 2910], 'children': []}]}]}
2025-01-08 10:28:12,977 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:13,451 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 277], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 10], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [11, 21], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [23, 25], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [26, 34], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [35, 43], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [44, 52], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 61], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [62, 68], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [70, 76], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [77, 85], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [86, 94], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [95, 103], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [104, 112], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [113, 153], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [154, 164], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [165, 175], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [176, 184], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [185, 195], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [196, 204], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [205, 223], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [224, 249], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [250, 258], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [259, 267], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [268, 276], 'children': []}]}
2025-01-08 10:28:13,451 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:14,036 - INFO - Step 2 result: {'type': 'Program', 'name': 'execution_manager_client', 'range': [278, 296], 'children': [{'type': 'FunctionDeclaration', 'name': 'execution_manager_client', 'range': [281, 295], 'children': [{'type': 'ReturnStatement', 'range': [290, 294], 'children': [{'type': 'CallExpression', 'callee': {'type': 'Identifier', 'name': 'get_service_client', 'range': [291, 291]}, 'arguments': [{'type': 'Identifier', 'name': 'ExecutionManager', 'range': [293, 293]}], 'range': [291, 294]}]}]}]}
2025-01-08 10:28:14,091 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:14,914 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [3064, 3146], 'children': [{'type': 'FunctionDeclaration', 'name': 'delete_schedule', 'range': [3094, 3146], 'children': [{'type': 'Parameter', 'name': 'schedule_id', 'range': [3098, 3100]}, {'type': 'Parameter', 'name': 'user_id', 'range': [3103, 3113]}, {'type': 'ReturnType', 'name': 'dict', 'range': [3119, 3124]}, {'type': 'FunctionCall', 'name': 'execution_scheduler_client', 'range': [3127, 3138]}, {'type': 'ReturnStatement', 'name': '', 'range': [3140, 3145]}]}]}
2025-01-08 10:28:14,915 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:17,313 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [346, 423], 'children': [{'type': 'VariableDeclaration', 'name': 'v1_router', 'range': [346, 350], 'children': []}, {'type': 'FunctionCall', 'name': 'include_router', 'range': [353, 381], 'children': [{'type': 'Argument', 'name': 'backend.server.integrations.router.router', 'range': [358, 366], 'children': []}, {'type': 'Argument', 'name': 'prefix', 'range': [369, 371], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [374, 378], 'children': []}]}, {'type': 'FunctionCall', 'name': 'include_router', 'range': [384, 422], 'children': [{'type': 'Argument', 'name': 'backend.server.routers.analytics.router', 'range': [389, 397], 'children': []}, {'type': 'Argument', 'name': 'prefix', 'range': [400, 402], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [405, 409], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [412, 419], 'children': []}]}]}
2025-01-08 10:28:17,313 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:20,513 - INFO - Step 1 result: {'type': 'Program', 'name': 'create_api_key', 'range': [3234, 3393], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_api_key', 'range': [3277, 3393], 'children': [{'type': 'Decorator', 'name': 'v1_router.post', 'range': [3234, 3276], 'children': []}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3277, 3282], 'children': []}, {'type': 'FunctionSignature', 'name': 'create_api_key', 'range': [3283, 3308], 'children': [{'type': 'Parameter', 'name': 'request', 'range': [3288, 3291], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [3292, 3303], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3309, 3393], 'children': [{'type': 'TryStatement', 'name': '', 'range': [3314, 3364], 'children': [{'type': 'Block', 'name': '', 'range': [3315, 3364], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key, plain_text', 'range': [3317, 3321], 'children': []}, {'type': 'FunctionCall', 'name': 'generate_api_key', 'range': [3321, 3351], 'children': []}, {'type': 'ReturnStatement', 'name': '', 'range': [3353, 3364], 'children': []}]}]}, {'type': 'CatchStatement', 'name': '', 'range': [3365, 3393], 'children': [{'type': 'Block', 'name': '', 'range': [3369, 3393], 'children': [{'type': 'FunctionCall', 'name': 'logger.error', 'range': [3371, 3377], 'children': []}, {'type': 'ThrowStatement', 'name': '', 'range': [3379, 3393], 'children': []}]}]}]}]}]}
2025-01-08 10:28:20,513 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:21,552 - INFO - Step 2 result: {'type': 'Program', 'name': 'DeleteGraphResponse', 'range': [777, 788], 'children': [{'type': 'ClassDeclaration', 'name': 'DeleteGraphResponse', 'range': [777, 788], 'children': [{'type': 'TypedDict', 'name': 'DeleteGraphResponse', 'range': [779, 781], 'children': []}, {'type': 'FieldDeclaration', 'name': 'version_counts', 'range': [784, 786], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [786, 786], 'children': []}]}]}]}
2025-01-08 10:28:21,553 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:22,379 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [691, 708], 'children': [{'type': 'FunctionCall', 'name': 'get', 'range': [694, 708], 'children': [{'type': 'Argument', 'name': 'path', 'range': [696, 698], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [700, 707], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [703, 706], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [705, 705], 'children': []}]}]}]}]}
2025-01-08 10:28:22,379 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:23,081 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2530, 2558], 'children': [{'type': 'FunctionCall', 'name': 'get', 'range': [2533, 2558], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2536, 2538], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2541, 2545], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2548, 2555], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [2551, 2554], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2553, 2553], 'children': []}]}]}]}]}
2025-01-08 10:28:23,081 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:23,131 - INFO - Step 1 result: {'type': 'Program', 'name': 'update_permissions', 'range': [3966, 4132], 'children': [{'type': 'FunctionDeclaration', 'name': 'update_permissions', 'range': [3966, 4132], 'children': [{'type': 'Decorator', 'name': 'v1_router.put', 'range': [3966, 4007], 'children': []}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [4009, 4013], 'children': []}, {'type': 'FunctionSignature', 'name': 'update_permissions', 'range': [4015, 4050], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [4020, 4022], 'children': []}, {'type': 'Parameter', 'name': 'request', 'range': [4025, 4027], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [4030, 4040], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [4051, 4132], 'children': [{'type': 'TryStatement', 'name': '', 'range': [4056, 4132], 'children': [{'type': 'Block', 'name': '', 'range': [4058, 4071], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [4059, 4070], 'children': []}]}, {'type': 'CatchClause', 'name': 'APIKeyNotFoundError', 'range': [4072, 4087], 'children': [{'type': 'Block', 'name': '', 'range': [4074, 4087], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [4076, 4086], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'APIKeyPermissionError', 'range': [4088, 4103], 'children': [{'type': 'Block', 'name': '', 'range': [4090, 4103], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [4092, 4102], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'APIKeyError', 'range': [4104, 4132], 'children': [{'type': 'Block', 'name': '', 'range': [4108, 4132], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [4110, 4116], 'children': []}, {'type': 'RaiseStatement', 'name': '', 'range': [4118, 4131], 'children': []}]}]}]}]}]}]}
2025-01-08 10:28:23,139 - INFO - Step 3 result: {'type': 'Program', 'name': 'execution_manager_client', 'range': [278, 296], 'children': [{'type': 'FunctionDeclaration', 'name': 'execution_manager_client', 'range': [281, 295], 'children': [{'type': 'ReturnStatement', 'range': [290, 294], 'children': [{'type': 'CallExpression', 'callee': {'type': 'Identifier', 'name': 'get_service_client', 'range': [291, 291]}, 'arguments': [{'type': 'Identifier', 'name': 'ExecutionManager', 'range': [293, 293]}], 'range': [291, 294]}]}]}]}
2025-01-08 10:28:23,140 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:23,141 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:23,374 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2460, 2488], 'children': [{'type': 'Decorator', 'name': '@', 'range': [2460, 2460], 'children': []}, {'type': 'FunctionCall', 'name': 'v1_router.get', 'range': [2461, 2488], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2466, 2468], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2471, 2475], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2478, 2485], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [2481, 2484], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2483, 2483], 'children': []}]}]}]}]}
2025-01-08 10:28:23,374 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:24,543 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [789, 812], 'children': [{'type': 'FunctionCall', 'name': 'get', 'range': [789, 812], 'children': [{'type': 'Argument', 'name': 'path', 'range': [794, 796], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [798, 802], 'children': [{'type': 'List', 'name': '', 'range': [800, 802], 'children': [{'type': 'StringLiteral', 'name': '"graphs"', 'range': [801, 801], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [804, 811], 'children': [{'type': 'List', 'name': '', 'range': [806, 811], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [807, 810], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [809, 809], 'children': []}]}]}]}]}]}
2025-01-08 10:28:24,544 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:25,246 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [1133, 1158], 'children': [{'type': 'FunctionCall', 'name': 'post', 'range': [1136, 1158], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1139, 1141], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [1143, 1147], 'children': [{'type': 'List', 'name': '', 'range': [1145, 1147], 'children': [{'type': 'StringLiteral', 'name': '"graphs"', 'range': [1146, 1146], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [1149, 1156], 'children': [{'type': 'List', 'name': '', 'range': [1151, 1156], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [1152, 1155], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [1154, 1154], 'children': []}]}]}]}]}]}
2025-01-08 10:28:25,247 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:25,996 - INFO - Step 2 result: {'type': 'Program', 'name': 'ScheduleCreationRequest', 'range': [2886, 2912], 'children': [{'type': 'ClassDeclaration', 'name': 'ScheduleCreationRequest', 'range': [2886, 2912], 'children': [{'type': 'Property', 'name': 'cron', 'range': [2895, 2897], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2897, 2897], 'children': []}]}, {'type': 'Property', 'name': 'input_data', 'range': [2899, 2906], 'children': [{'type': 'TypeAnnotation', 'name': 'dict', 'range': [2901, 2901], 'children': [{'type': 'TypeArgument', 'name': 'Any', 'range': [2903, 2903], 'children': []}, {'type': 'TypeArgument', 'name': 'Any', 'range': [2905, 2905], 'children': []}]}]}, {'type': 'Property', 'name': 'graph_id', 'range': [2908, 2910], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2910, 2910], 'children': []}]}]}]}
2025-01-08 10:28:25,996 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:27,140 - INFO - Step 3 result: {'type': 'Program', 'name': 'DeleteGraphResponse', 'range': [777, 788], 'children': [{'type': 'ClassDeclaration', 'name': 'DeleteGraphResponse', 'range': [777, 788], 'children': [{'type': 'TypedDict', 'name': 'DeleteGraphResponse', 'range': [779, 781], 'children': []}, {'type': 'FieldDeclaration', 'name': 'version_counts', 'range': [784, 786], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [786, 786], 'children': []}]}]}]}
2025-01-08 10:28:27,140 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:27,656 - INFO - Step 2 result: {'nodes': [{'type': 'VariableDeclaration', 'name': 'settings', 'range': [316, 320], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [317, 320], 'children': [{'type': 'CallExpression', 'name': 'Settings', 'range': [318, 320], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [322, 329], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [323, 329], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [324, 329], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [328, 329], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'integration_creds_manager', 'range': [331, 335], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [332, 335], 'children': [{'type': 'CallExpression', 'name': 'IntegrationCredentialsManager', 'range': [333, 335], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': '_user_credit_model', 'range': [339, 343], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [340, 343], 'children': [{'type': 'CallExpression', 'name': 'get_user_credit_model', 'range': [341, 343], 'children': []}]}]}]}
2025-01-08 10:28:27,656 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:27,852 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [1950, 2181], 'children': [{'type': 'FunctionDeclaration', 'name': 'set_graph_active_version', 'range': [1980, 2146], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1985, 1987], 'children': []}, {'type': 'Parameter', 'name': 'request_body', 'range': [1990, 1992], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1995, 2005], 'children': []}, {'type': 'AssignmentExpression', 'name': 'new_active_version', 'range': [2011, 2015], 'children': []}, {'type': 'AssignmentExpression', 'name': 'new_active_graph', 'range': [2017, 2033], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [2035, 2048], 'children': []}, {'type': 'AssignmentExpression', 'name': 'current_active_graph', 'range': [2050, 2062], 'children': []}, {'type': 'AwaitExpression', 'name': '', 'range': [2100, 2112], 'children': []}, {'type': 'AwaitExpression', 'name': '', 'range': [2124, 2145], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [2147, 2180], 'children': []}]}, {'type': 'FunctionDeclaration', 'name': 'get_credentials', 'range': [2065, 2086], 'children': [{'type': 'Parameter', 'name': 'credentials_id', 'range': [2068, 2070], 'children': []}, {'type': 'ReturnStatement', 'name': '', 'range': [2077, 2085], 'children': []}]}]}
2025-01-08 10:28:27,852 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:28,036 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2182, 2211], 'children': [{'type': 'FunctionDeclaration', 'name': 'execute_graph', 'range': [2212, 2261], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2216, 2218], 'children': []}, {'type': 'Parameter', 'name': 'node_input', 'range': [2221, 2228], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2231, 2241], 'children': []}, {'type': 'ReturnType', 'name': 'dict', 'range': [2247, 2252], 'children': []}]}, {'type': 'TryStatement', 'name': 'try', 'range': [2262, 2327], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2264, 2292], 'children': [{'type': 'Assignment', 'name': 'graph_exec', 'range': [2265, 2282], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2284, 2292], 'children': []}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2293, 2327], 'children': [{'type': 'Block', 'name': 'catchBlock', 'range': [2298, 2327], 'children': [{'type': 'Assignment', 'name': 'msg', 'range': [2299, 2315], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2316, 2327], 'children': []}]}]}]}]}
2025-01-08 10:28:28,036 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:28,496 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [424, 476], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_or_create_user_route', 'range': [447, 476], 'children': [{'type': 'Parameter', 'name': 'user_data', 'range': [451, 458], 'children': [{'type': 'TypeAnnotation', 'name': 'dict', 'range': [453, 453], 'children': []}, {'type': 'DefaultValue', 'name': 'Depends', 'range': [455, 458], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [457, 457], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [461, 476], 'children': [{'type': 'VariableDeclaration', 'name': 'user', 'range': [462, 468], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [463, 468], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [464, 468], 'children': [{'type': 'CallExpression', 'name': 'get_or_create_user', 'range': [465, 468], 'children': [{'type': 'Argument', 'name': 'user_data', 'range': [467, 467], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [470, 475], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [472, 475], 'children': [{'type': 'Identifier', 'name': 'user', 'range': [471, 471], 'children': []}, {'type': 'CallExpression', 'name': 'model_dump', 'range': [473, 475], 'children': []}]}]}]}]}]}
2025-01-08 10:28:28,496 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:28,888 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2810, 2841], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_new_template', 'range': [2842, 2885], 'children': [{'type': 'Parameter', 'name': 'create_graph', 'range': [2847, 2849], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2851, 2861], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2853, 2861], 'children': [{'type': 'Type', 'name': 'str', 'range': [2855, 2855], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [2857, 2861], 'children': [{'type': 'FunctionCall', 'name': 'get_user_id', 'range': [2859, 2861], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'graph_db.GraphModel', 'range': [2866, 2868], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [2871, 2885], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [2871, 2885], 'children': [{'type': 'FunctionCall', 'name': 'do_create_graph', 'range': [2873, 2884], 'children': [{'type': 'Argument', 'name': 'create_graph', 'range': [2875, 2875], 'children': []}, {'type': 'Argument', 'name': 'is_template', 'range': [2877, 2879], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2881, 2883], 'children': []}]}]}]}]}]}
2025-01-08 10:28:28,889 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:29,486 - INFO - Step 4 result: {'type': 'Program', 'name': 'execution_manager_client', 'range': [278, 296], 'children': [{'type': 'FunctionDecl', 'name': 'execution_manager_client', 'range': [281, 295], 'children': [{'type': 'ReturnStatement', 'range': [290, 294], 'children': [{'type': 'CallExpression', 'callee': {'type': 'Identifier', 'name': 'get_service_client', 'range': [291, 291]}, 'arguments': [{'type': 'Identifier', 'name': 'ExecutionManager', 'range': [293, 293]}], 'range': [291, 294]}]}]}]}
2025-01-08 10:28:29,486 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:29,556 - INFO - Step 2 result: {'type': 'Program', 'name': 'execution_scheduler_client', 'range': [297, 315], 'children': [{'type': 'FunctionDeclaration', 'name': 'execution_scheduler_client', 'range': [300, 314], 'children': [{'type': 'FunctionSignature', 'range': [300, 307], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [300, 300]}, {'type': 'Identifier', 'name': 'execution_scheduler_client', 'range': [301, 301]}, {'type': 'Punctuation', 'name': '(', 'range': [302, 302]}, {'type': 'Punctuation', 'name': ')', 'range': [303, 303]}, {'type': 'Operator', 'name': '->', 'range': [304, 305]}, {'type': 'Identifier', 'name': 'ExecutionScheduler', 'range': [306, 306]}, {'type': 'Punctuation', 'name': ':', 'range': [307, 307]}]}, {'type': 'FunctionBody', 'range': [308, 314], 'children': [{'type': 'ReturnStatement', 'range': [309, 313], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [309, 309]}, {'type': 'CallExpression', 'range': [310, 313], 'children': [{'type': 'Identifier', 'name': 'get_service_client', 'range': [310, 310]}, {'type': 'Punctuation', 'name': '(', 'range': [311, 311]}, {'type': 'Identifier', 'name': 'ExecutionScheduler', 'range': [312, 312]}, {'type': 'Punctuation', 'name': ')', 'range': [313, 313]}]}]}]}]}]}
2025-01-08 10:28:29,556 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:30,999 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [580, 608], 'children': [{'type': 'FunctionDeclaration', 'name': 'execute_graph_block', 'range': [610, 690], 'children': [{'type': 'Parameter', 'name': 'block_id', 'range': [613, 615], 'children': []}, {'type': 'Parameter', 'name': 'data', 'range': [617, 619], 'children': []}, {'type': 'ReturnType', 'name': 'CompletedBlockOutput', 'range': [621, 623], 'children': []}, {'type': 'Assignment', 'name': 'obj', 'range': [626, 638], 'children': [{'type': 'FunctionCall', 'name': 'get_block', 'range': [634, 637], 'children': [{'type': 'Argument', 'name': 'block_id', 'range': [636, 636], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [639, 656], 'children': [{'type': 'Condition', 'name': 'not obj', 'range': [640, 641], 'children': []}, {'type': 'RaiseStatement', 'name': 'HTTPException', 'range': [644, 655], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [647, 649], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [651, 654], 'children': []}]}]}, {'type': 'Assignment', 'name': 'output', 'range': [658, 664], 'children': [{'type': 'FunctionCall', 'name': 'defaultdict', 'range': [660, 663], 'children': [{'type': 'Argument', 'name': 'list', 'range': [662, 662], 'children': []}]}]}, {'type': 'ForLoop', 'name': '', 'range': [665, 687], 'children': [{'type': 'Iteration', 'name': 'name, data in obj.execute(data)', 'range': [666, 675], 'children': []}, {'type': 'Assignment', 'name': 'output[name].append(data)', 'range': [678, 686], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'output', 'range': [688, 689], 'children': []}]}]}
2025-01-08 10:28:30,999 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:31,038 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [3147, 3233], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_execution_schedules', 'range': [3177, 3233], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [3181, 3191], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3183, 3191], 'children': [{'type': 'Type', 'name': 'str', 'range': [3185, 3186], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [3187, 3191], 'children': [{'type': 'FunctionCall', 'name': 'get_user_id', 'range': [3189, 3190], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'graph_id', 'range': [3194, 3200], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3196, 3196], 'children': []}, {'type': 'OptionalType', 'name': 'None', 'range': [3198, 3200], 'children': []}]}, {'type': 'ReturnType', 'name': 'list', 'range': [3206, 3211], 'children': [{'type': 'Type', 'name': 'scheduler.JobInfo', 'range': [3208, 3211], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3214, 3233], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [3214, 3233], 'children': [{'type': 'FunctionCall', 'name': 'execution_scheduler_client', 'range': [3215, 3217], 'children': []}, {'type': 'MethodCall', 'name': 'get_execution_schedules', 'range': [3219, 3232], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [3222, 3224], 'children': []}, {'type': 'Argument', 'name': 'graph_id', 'range': [3227, 3229], 'children': []}]}]}]}]}]}
2025-01-08 10:28:31,038 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:31,710 - INFO - Step 2 result: {'type': 'Program', 'name': 'stop_graph_run', 'range': [2328, 2459], 'children': [{'type': 'FunctionDeclaration', 'name': 'stop_graph_run', 'range': [2358, 2459], 'children': [{'type': 'Decorator', 'name': '@v1_router.post', 'range': [2328, 2357], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2334, 2336], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2339, 2343], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2346, 2353], 'children': []}]}, {'type': 'Parameter', 'name': 'graph_exec_id', 'range': [2363, 2365], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2367, 2377], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated[str, Depends(get_user_id)]', 'range': [2369, 2377], 'children': []}]}, {'type': 'ReturnType', 'name': 'Sequence[execution_db.ExecutionResult]', 'range': [2382, 2387], 'children': []}, {'type': 'Block', 'name': 'FunctionBody', 'range': [2389, 2459], 'children': [{'type': 'IfStatement', 'name': 'if not await graph_db.get_execution', 'range': [2390, 2417], 'children': [{'type': 'Condition', 'name': 'not await graph_db.get_execution(user_id=user_id, execution_id=graph_exec_id)', 'range': [2391, 2404], 'children': []}, {'type': 'Block', 'name': 'IfBody', 'range': [2405, 2417], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(404, detail=f"Agent execution #{graph_exec_id} not found")', 'range': [2407, 2416], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'await asyncio.to_thread(lambda: execution_manager_client().cancel_execution(graph_exec_id))', 'range': [2419, 2437], 'children': []}, {'type': 'ReturnStatement', 'name': 'return await execution_db.get_execution_results(graph_exec_id)', 'range': [2451, 2458], 'children': []}]}]}]}
2025-01-08 10:28:31,710 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:32,429 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [789, 812], 'children': [{'type': 'FunctionCall', 'name': 'get', 'range': [789, 812], 'children': [{'type': 'Argument', 'name': 'path', 'range': [794, 796], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [798, 802], 'children': [{'type': 'List', 'name': '', 'range': [800, 802], 'children': [{'type': 'StringLiteral', 'name': '"graphs"', 'range': [801, 801], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [804, 811], 'children': [{'type': 'List', 'name': '', 'range': [806, 811], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [807, 810], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [809, 809], 'children': []}]}]}]}]}]}
2025-01-08 10:28:32,429 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:32,496 - INFO - Step 4 result: {'type': 'Program', 'name': 'DeleteGraphResponse', 'range': [777, 788], 'children': [{'type': 'ClassDecl', 'name': 'DeleteGraphResponse', 'range': [777, 788], 'children': [{'type': 'TypedDict', 'name': 'DeleteGraphResponse', 'range': [779, 781], 'children': []}, {'type': 'FieldDecl', 'name': 'version_counts', 'range': [784, 786], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [786, 786], 'children': []}]}]}]}
2025-01-08 10:28:32,496 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:33,204 - INFO - Step 2 result: {'type': 'Program', 'name': 'delete_api_key', 'range': [3654, 3809], 'children': [{'type': 'Decorator', 'name': 'v1_router.delete', 'range': [3654, 3695], 'children': [{'type': 'Argument', 'name': 'path', 'range': [3658, 3660], 'children': []}, {'type': 'Argument', 'name': 'response_model', 'range': [3663, 3675], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [3678, 3682], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [3685, 3692], 'children': []}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3697, 3701], 'children': [{'type': 'Argument', 'name': 'flag', 'range': [3699, 3700], 'children': []}]}, {'type': 'FunctionDef', 'name': 'delete_api_key', 'range': [3703, 3809], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [3708, 3710], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [3712, 3722], 'children': []}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [3725, 3730], 'children': []}, {'type': 'Docstring', 'name': 'Revoke an API key', 'range': [3733, 3735], 'children': []}, {'type': 'TryBlock', 'name': 'try', 'range': [3737, 3809], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [3740, 3747], 'children': []}, {'type': 'ExceptBlock', 'name': 'except APIKeyNotFoundError', 'range': [3749, 3764], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3753, 3763], 'children': []}]}, {'type': 'ExceptBlock', 'name': 'except APIKeyPermissionError', 'range': [3765, 3780], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3769, 3779], 'children': []}]}, {'type': 'ExceptBlock', 'name': 'except APIKeyError as e', 'range': [3781, 3809], 'children': [{'type': 'LogStatement', 'name': 'logger.error', 'range': [3787, 3793], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3795, 3808], 'children': []}]}]}]}]}
2025-01-08 10:28:33,204 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:33,340 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [3064, 3146], 'children': [{'type': 'FunctionDeclaration', 'name': 'delete_schedule', 'range': [3094, 3146], 'children': [{'type': 'Parameter', 'name': 'schedule_id', 'range': [3098, 3100], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3100, 3100]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [3103, 3113], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3105, 3113], 'children': [{'type': 'Type', 'name': 'str', 'range': [3107, 3107]}, {'type': 'FunctionCall', 'name': 'Depends', 'range': [3109, 3112], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [3111, 3111]}]}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [3119, 3124], 'children': [{'type': 'Type', 'name': 'Any', 'range': [3121, 3121]}, {'type': 'Type', 'name': 'Any', 'range': [3123, 3123]}]}, {'type': 'FunctionCall', 'name': 'execution_scheduler_client', 'range': [3127, 3138], 'children': [{'type': 'FunctionCall', 'name': 'delete_schedule', 'range': [3131, 3138], 'children': [{'type': 'Argument', 'name': 'schedule_id', 'range': [3133, 3133]}, {'type': 'KeywordArgument', 'name': 'user_id', 'range': [3135, 3137], 'children': [{'type': 'Variable', 'name': 'user_id', 'range': [3137, 3137]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [3140, 3145], 'children': [{'type': 'Dictionary', 'name': '', 'range': [3141, 3145], 'children': [{'type': 'KeyValuePair', 'name': 'id', 'range': [3142, 3144], 'children': [{'type': 'Variable', 'name': 'schedule_id', 'range': [3144, 3144]}]}]}]}]}]}
2025-01-08 10:28:33,340 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:33,967 - INFO - Step 3 result: {'type': 'Program', 'name': 'ScheduleCreationRequest', 'range': [2886, 2912], 'children': [{'type': 'ClassDeclaration', 'name': 'ScheduleCreationRequest', 'range': [2886, 2912], 'children': [{'type': 'Property', 'name': 'cron', 'range': [2895, 2897], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2897, 2897], 'children': []}]}, {'type': 'Property', 'name': 'input_data', 'range': [2899, 2906], 'children': [{'type': 'TypeAnnotation', 'name': 'dict', 'range': [2901, 2901], 'children': [{'type': 'TypeArgument', 'name': 'Any', 'range': [2903, 2903], 'children': []}, {'type': 'TypeArgument', 'name': 'Any', 'range': [2905, 2905], 'children': []}]}]}, {'type': 'Property', 'name': 'graph_id', 'range': [2908, 2910], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2910, 2910], 'children': []}]}]}]}
2025-01-08 10:28:33,968 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:34,344 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_api_keys', 'range': [3394, 3511], 'children': [{'type': 'Decorator', 'name': 'v1_router.get', 'range': [3394, 3435], 'children': [{'type': 'Argument', 'name': 'path', 'range': [3400, 3400], 'children': []}, {'type': 'Argument', 'name': 'response_model', 'range': [3403, 3415], 'children': [{'type': 'Type', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3405, 3415], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [3418, 3422], 'children': [{'type': 'List', 'name': '["api-keys"]', 'range': [3420, 3422], 'children': []}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [3425, 3432], 'children': [{'type': 'List', 'name': '[Depends(auth_middleware)]', 'range': [3427, 3432], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3437, 3441], 'children': [{'type': 'Argument', 'name': '"api-keys-enabled"', 'range': [3440, 3440], 'children': []}]}, {'type': 'Function', 'name': 'get_api_keys', 'range': [3443, 3511], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [3448, 3458], 'children': [{'type': 'Type', 'name': 'Annotated[str, Depends(get_user_id)]', 'range': [3450, 3458], 'children': []}]}, {'type': 'ReturnType', 'name': 'list[APIKeyWithoutHash]', 'range': [3463, 3466], 'children': []}, {'type': 'Docstring', 'name': '"List all API keys for the user"', 'range': [3469, 3471], 'children': []}, {'type': 'TryBlock', 'name': 'try', 'range': [3473, 3511], 'children': [{'type': 'ReturnStatement', 'name': 'return await list_user_api_keys(user_id)', 'range': [3476, 3481], 'children': []}, {'type': 'ExceptBlock', 'name': 'except APIKeyError as e', 'range': [3483, 3511], 'children': [{'type': 'LogStatement', 'name': 'logger.error(f"Failed to list API keys: {str(e)}")', 'range': [3489, 3495], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3497, 3510], 'children': []}]}]}]}]}
2025-01-08 10:28:34,344 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:34,347 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [1133, 1158], 'children': [{'type': 'FunctionCall', 'name': 'post', 'range': [1136, 1158], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1139, 1141], 'children': [{'type': 'StringLiteral', 'name': '"/graphs"', 'range': [1141, 1141], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [1143, 1147], 'children': [{'type': 'List', 'name': '', 'range': [1145, 1147], 'children': [{'type': 'StringLiteral', 'name': '"graphs"', 'range': [1146, 1146], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [1149, 1156], 'children': [{'type': 'List', 'name': '', 'range': [1151, 1156], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [1152, 1155], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [1154, 1154], 'children': []}]}]}]}]}]}
2025-01-08 10:28:34,349 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:34,937 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2641, 2672], 'children': [{'type': 'FunctionCall', 'name': 'get', 'range': [2641, 2672], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2647, 2649], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2652, 2658], 'children': [{'type': 'List', 'name': '', 'range': [2654, 2658], 'children': [{'type': 'StringLiteral', 'name': '"graphs"', 'range': [2655, 2655], 'children': []}, {'type': 'StringLiteral', 'name': '"templates"', 'range': [2657, 2657], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [2661, 2668], 'children': [{'type': 'List', 'name': '', 'range': [2663, 2668], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [2664, 2667], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2666, 2666], 'children': []}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'get_templates', 'range': [2673, 2715], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2678, 2688], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2680, 2688], 'children': [{'type': 'Type', 'name': 'str', 'range': [2682, 2682], 'children': []}, {'type': 'FunctionCall', 'name': 'Depends', 'range': [2684, 2687], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [2686, 2686], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'Sequence', 'range': [2693, 2698], 'children': [{'type': 'Type', 'name': 'graph_db.GraphModel', 'range': [2695, 2697], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2701, 2714], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2702, 2714], 'children': [{'type': 'FunctionCall', 'name': 'graph_db.get_graphs', 'range': [2703, 2714], 'children': [{'type': 'Argument', 'name': 'filter_by', 'range': [2707, 2709], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2711, 2713], 'children': []}]}]}]}]}]}
2025-01-08 10:28:34,942 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:35,224 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [346, 423], 'children': [{'type': 'VariableDeclaration', 'name': 'v1_router', 'range': [346, 350], 'children': [{'type': 'Assignment', 'name': '=', 'range': [347, 347], 'children': []}, {'type': 'FunctionCall', 'name': 'APIRouter', 'range': [348, 350], 'children': []}]}, {'type': 'FunctionCall', 'name': 'include_router', 'range': [353, 381], 'children': [{'type': 'Argument', 'name': 'backend.server.integrations.router.router', 'range': [358, 366], 'children': []}, {'type': 'Argument', 'name': 'prefix', 'range': [369, 371], 'children': [{'type': 'StringLiteral', 'name': '"/integrations"', 'range': [371, 371], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [374, 378], 'children': [{'type': 'ArrayLiteral', 'name': '["integrations"]', 'range': [376, 378], 'children': [{'type': 'StringLiteral', 'name': '"integrations"', 'range': [377, 377], 'children': []}]}]}]}, {'type': 'FunctionCall', 'name': 'include_router', 'range': [384, 422], 'children': [{'type': 'Argument', 'name': 'backend.server.routers.analytics.router', 'range': [389, 397], 'children': []}, {'type': 'Argument', 'name': 'prefix', 'range': [400, 402], 'children': [{'type': 'StringLiteral', 'name': '"/analytics"', 'range': [402, 402], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [405, 409], 'children': [{'type': 'ArrayLiteral', 'name': '["analytics"]', 'range': [407, 409], 'children': [{'type': 'StringLiteral', 'name': '"analytics"', 'range': [408, 408], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [412, 419], 'children': [{'type': 'ArrayLiteral', 'name': '[Depends(auth_middleware)]', 'range': [414, 419], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [415, 419], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [417, 417], 'children': []}]}]}]}]}]}
2025-01-08 10:28:35,224 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:35,367 - INFO - Step 5 result: {'type': 'Program', 'name': 'execution_manager_client', 'range': [278, 296], 'children': [{'type': 'FunctionDecl', 'name': 'execution_manager_client', 'range': [281, 295], 'children': [{'type': 'ReturnStatement', 'range': [290, 294], 'children': [{'type': 'CallExpression', 'callee': {'type': 'Identifier', 'name': 'get_service_client', 'range': [291, 291]}, 'arguments': [{'type': 'Identifier', 'name': 'ExecutionManager', 'range': [293, 293]}], 'range': [291, 294]}]}]}]}
2025-01-08 10:28:35,368 - INFO - Completed main AST analysis flow
2025-01-08 10:28:35,368 - INFO - Successfully processed chunk
2025-01-08 10:28:38,018 - INFO - Step 3 result: {'nodes': [{'type': 'VariableDeclaration', 'name': 'settings', 'range': [316, 320], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [317, 320], 'children': [{'type': 'CallExpression', 'name': 'Settings', 'range': [318, 320], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [322, 329], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [323, 329], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [324, 329], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [328, 329], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'integration_creds_manager', 'range': [331, 335], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [332, 335], 'children': [{'type': 'CallExpression', 'name': 'IntegrationCredentialsManager', 'range': [333, 335], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': '_user_credit_model', 'range': [339, 343], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [340, 343], 'children': [{'type': 'CallExpression', 'name': 'get_user_credit_model', 'range': [341, 343], 'children': []}]}]}]}
2025-01-08 10:28:38,019 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:38,154 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2460, 2488], 'children': [{'type': 'Decorator', 'name': '@', 'range': [2460, 2460], 'children': []}, {'type': 'FunctionCall', 'name': 'v1_router.get', 'range': [2461, 2488], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2466, 2468], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2471, 2475], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2478, 2485], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [2481, 2484], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2483, 2483], 'children': []}]}]}]}, {'type': 'FunctionDefinition', 'name': 'get_executions', 'range': [2490, 2529], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2495, 2505], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2497, 2505], 'children': [{'type': 'Type', 'name': 'str', 'range': [2499, 2499], 'children': []}, {'type': 'FunctionCall', 'name': 'Depends', 'range': [2501, 2504], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [2503, 2503], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'list', 'range': [2511, 2516], 'children': [{'type': 'Type', 'name': 'graph_db.GraphExecution', 'range': [2513, 2516], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2519, 2528], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2520, 2520], 'children': [{'type': 'FunctionCall', 'name': 'graph_db.get_executions', 'range': [2521, 2528], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [2525, 2527], 'children': []}]}]}]}]}]}
2025-01-08 10:28:38,166 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:38,326 - INFO - Step 5 result: {'type': 'Program', 'name': 'DeleteGraphResponse', 'range': [777, 788], 'children': [{'type': 'ClassDecl', 'name': 'DeleteGraphResponse', 'range': [777, 788], 'children': [{'type': 'TypedDict', 'name': 'DeleteGraphResponse', 'range': [779, 781], 'children': []}, {'type': 'FieldDecl', 'name': 'version_counts', 'range': [784, 786], 'children': [{'type': 'TypeAnnotation', 'name': 'int', 'range': [786, 786], 'children': []}]}]}]}
2025-01-08 10:28:38,326 - INFO - Completed main AST analysis flow
2025-01-08 10:28:38,326 - INFO - Successfully processed chunk
2025-01-08 10:28:38,359 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2913, 3063], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_schedule', 'range': [2943, 3063], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2948, 2958], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2950, 2958], 'children': [{'type': 'Type', 'name': 'str', 'range': [2952, 2953], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [2954, 2958], 'children': [{'type': 'FunctionCall', 'name': 'get_user_id', 'range': [2956, 2957], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'schedule', 'range': [2961, 2964], 'children': [{'type': 'TypeAnnotation', 'name': 'ScheduleCreationRequest', 'range': [2963, 2964], 'children': []}]}, {'type': 'ReturnType', 'name': 'scheduler.JobInfo', 'range': [2969, 2971], 'children': []}, {'type': 'Block', 'name': '', 'range': [2974, 3063], 'children': [{'type': 'VariableDeclaration', 'name': 'graph', 'range': [2974, 2988], 'children': [{'type': 'FunctionCall', 'name': 'graph_db.get_graph', 'range': [2977, 2988], 'children': [{'type': 'Argument', 'name': 'schedule.graph_id', 'range': [2981, 2983], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2985, 2987], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [2990, 3009], 'children': [{'type': 'Condition', 'name': 'not graph', 'range': [2991, 2992], 'children': []}, {'type': 'Block', 'name': '', 'range': [2994, 3009], 'children': [{'type': 'RaiseStatement', 'name': 'HTTPException', 'range': [2995, 3008], 'children': [{'type': 'Argument', 'name': 'status_code=404', 'range': [2999, 3001], 'children': []}, {'type': 'Argument', 'name': 'detail=f"Graph #{schedule.graph_id} not found."', 'range': [3003, 3006], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [3011, 3063], 'children': [{'type': 'FunctionCall', 'name': 'asyncio.to_thread', 'range': [3013, 3062], 'children': [{'type': 'Lambda', 'name': '', 'range': [3018, 3061], 'children': [{'type': 'FunctionCall', 'name': 'execution_scheduler_client.add_execution_schedule', 'range': [3024, 3060], 'children': [{'type': 'Argument', 'name': 'graph_id=schedule.graph_id', 'range': [3027, 3031], 'children': []}, {'type': 'Argument', 'name': 'graph_version=graph.version', 'range': [3034, 3038], 'children': []}, {'type': 'Argument', 'name': 'cron=schedule.cron', 'range': [3041, 3045], 'children': []}, {'type': 'Argument', 'name': 'input_data=schedule.input_data', 'range': [3048, 3052], 'children': []}, {'type': 'Argument', 'name': 'user_id=user_id', 'range': [3055, 3057], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:28:38,359 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:38,388 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [691, 708], 'children': [{'type': 'FunctionCall', 'name': 'get', 'range': [694, 708], 'children': [{'type': 'Argument', 'name': 'path', 'range': [696, 698], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [700, 707], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [703, 706], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [705, 705], 'children': []}]}]}]}, {'type': 'FunctionDefinition', 'name': 'get_user_credits', 'range': [710, 776], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [715, 725], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [717, 725], 'children': [{'type': 'Type', 'name': 'str', 'range': [719, 719], 'children': []}, {'type': 'FunctionCall', 'name': 'Depends', 'range': [721, 724], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [723, 723], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [731, 736], 'children': [{'type': 'Type', 'name': 'str', 'range': [733, 733], 'children': []}, {'type': 'Type', 'name': 'int', 'range': [735, 735], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [759, 775], 'children': [{'type': 'Dictionary', 'name': 'credits', 'range': [760, 775], 'children': [{'type': 'KeyValuePair', 'name': 'credits', 'range': [761, 774], 'children': [{'type': 'FunctionCall', 'name': 'max', 'range': [763, 774], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [765, 771], 'children': [{'type': 'FunctionCall', 'name': 'get_or_refill_credit', 'range': [768, 771], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [770, 770], 'children': []}]}]}, {'type': 'Literal', 'name': '0', 'range': [773, 773], 'children': []}]}]}]}]}]}]}
2025-01-08 10:28:38,389 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:38,577 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2716, 2747], 'children': [{'type': 'Decorator', 'name': '@v1_router.get', 'range': [2716, 2747], 'children': [{'type': 'CallExpression', 'name': '', 'range': [2720, 2746], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2722, 2724], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2727, 2733], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2729, 2733], 'children': [{'type': 'Literal', 'name': '"templates"', 'range': [2730, 2730], 'children': []}, {'type': 'Literal', 'name': '"graphs"', 'range': [2732, 2732], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [2736, 2743], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2738, 2743], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [2739, 2742], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2741, 2741], 'children': []}]}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'get_template', 'range': [2748, 2809], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2753, 2755], 'children': []}, {'type': 'Parameter', 'name': 'version', 'range': [2757, 2763], 'children': []}, {'type': 'ReturnType', 'name': '-> graph_db.GraphModel', 'range': [2766, 2771], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [2772, 2809], 'children': [{'type': 'VariableDeclaration', 'name': 'graph', 'range': [2773, 2787], 'children': [{'type': 'CallExpression', 'name': 'await graph_db.get_graph', 'range': [2775, 2787], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [2780, 2780], 'children': []}, {'type': 'Argument', 'name': 'version', 'range': [2782, 2782], 'children': []}, {'type': 'Argument', 'name': 'template', 'range': [2784, 2786], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [2789, 2805], 'children': [{'type': 'Condition', 'name': 'not graph', 'range': [2790, 2791], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [2792, 2805], 'children': [{'type': 'ThrowStatement', 'name': 'raise HTTPException', 'range': [2794, 2805], 'children': [{'type': 'CallExpression', 'name': '', 'range': [2796, 2805], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [2797, 2799], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [2801, 2804], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return graph', 'range': [2807, 2808], 'children': []}]}]}]}
2025-01-08 10:28:38,578 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:38,713 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2182, 2211], 'children': [{'type': 'FunctionDeclaration', 'name': 'execute_graph', 'range': [2212, 2261], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2216, 2218], 'children': []}, {'type': 'Parameter', 'name': 'node_input', 'range': [2221, 2228], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2231, 2241], 'children': []}, {'type': 'ReturnType', 'name': 'dict', 'range': [2247, 2252], 'children': []}]}, {'type': 'TryStatement', 'name': 'try', 'range': [2262, 2327], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2264, 2292], 'children': [{'type': 'Assignment', 'name': 'graph_exec', 'range': [2265, 2282], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2284, 2292], 'children': []}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2293, 2327], 'children': [{'type': 'Block', 'name': 'catchBlock', 'range': [2298, 2327], 'children': [{'type': 'Assignment', 'name': 'msg', 'range': [2299, 2315], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2316, 2327], 'children': []}]}]}]}]}
2025-01-08 10:28:38,714 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:38,973 - INFO - Step 3 result: {'type': 'Program', 'name': 'execution_scheduler_client', 'range': [297, 315], 'children': [{'type': 'FunctionDeclaration', 'name': 'execution_scheduler_client', 'range': [300, 314], 'children': [{'type': 'FunctionSignature', 'range': [300, 307], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [300, 300]}, {'type': 'Identifier', 'name': 'execution_scheduler_client', 'range': [301, 301]}, {'type': 'Operator', 'name': '->', 'range': [304, 305]}, {'type': 'Identifier', 'name': 'ExecutionScheduler', 'range': [306, 306]}]}, {'type': 'FunctionBody', 'range': [308, 314], 'children': [{'type': 'ReturnStatement', 'range': [309, 313], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [309, 309]}, {'type': 'CallExpression', 'range': [310, 313], 'children': [{'type': 'Identifier', 'name': 'get_service_client', 'range': [310, 310]}, {'type': 'Identifier', 'name': 'ExecutionScheduler', 'range': [312, 312]}]}]}]}]}]}
2025-01-08 10:28:38,974 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:39,485 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [1950, 2181], 'children': [{'type': 'FunctionDeclaration', 'name': 'set_graph_active_version', 'range': [1980, 2146], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1985, 1987], 'children': []}, {'type': 'Parameter', 'name': 'request_body', 'range': [1990, 1992], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1995, 2005], 'children': []}, {'type': 'AssignmentExpression', 'name': 'new_active_version', 'range': [2011, 2015], 'children': []}, {'type': 'AssignmentExpression', 'name': 'new_active_graph', 'range': [2017, 2033], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [2035, 2048], 'children': []}, {'type': 'AssignmentExpression', 'name': 'current_active_graph', 'range': [2050, 2062], 'children': []}, {'type': 'AwaitExpression', 'name': '', 'range': [2100, 2112], 'children': []}, {'type': 'AwaitExpression', 'name': '', 'range': [2124, 2145], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [2147, 2180], 'children': []}]}, {'type': 'FunctionDeclaration', 'name': 'get_credentials', 'range': [2065, 2086], 'children': [{'type': 'Parameter', 'name': 'credentials_id', 'range': [2068, 2070], 'children': []}, {'type': 'ReturnStatement', 'name': '', 'range': [2077, 2085], 'children': []}]}]}
2025-01-08 10:28:39,486 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:40,451 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [1419, 1539], 'children': [{'type': 'FunctionDeclaration', 'name': 'delete_graph', 'range': [1446, 1539], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1451, 1453], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1455, 1465], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [1457, 1465], 'children': [{'type': 'Type', 'name': 'str', 'range': [1459, 1460], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [1461, 1465], 'children': [{'type': 'FunctionCall', 'name': 'get_user_id', 'range': [1463, 1464], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'DeleteGraphResponse', 'range': [1469, 1470], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [1472, 1539], 'children': [{'type': 'IfStatement', 'name': '', 'range': [1473, 1489], 'children': [{'type': 'AssignmentExpression', 'name': 'active_version', 'range': [1474, 1487], 'children': [{'type': 'FunctionCall', 'name': 'graph_db.get_graph', 'range': [1477, 1487], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [1482, 1483], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [1485, 1486], 'children': []}]}]}]}, {'type': 'FunctionCall', 'name': 'on_graph_deactivate', 'range': [1514, 1521], 'children': [{'type': 'Argument', 'name': 'active_version', 'range': [1517, 1518], 'children': []}, {'type': 'Argument', 'name': 'get_credentials', 'range': [1519, 1520], 'children': []}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1523, 1539], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1524, 1538], 'children': [{'type': 'Property', 'name': 'version_counts', 'range': [1525, 1537], 'children': [{'type': 'FunctionCall', 'name': 'graph_db.delete_graph', 'range': [1527, 1537], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [1532, 1533], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [1535, 1536], 'children': []}]}]}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'get_credentials', 'range': [1491, 1512], 'children': [{'type': 'Parameter', 'name': 'credentials_id', 'range': [1494, 1496], 'children': []}, {'type': 'ReturnType', 'name': 'Credentials | None', 'range': [1498, 1500], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [1502, 1512], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [1503, 1512], 'children': [{'type': 'FunctionCall', 'name': 'integration_creds_manager.get', 'range': [1504, 1511], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [1508, 1509], 'children': []}, {'type': 'Argument', 'name': 'credentials_id', 'range': [1510, 1511], 'children': []}]}]}]}]}]}
2025-01-08 10:28:40,451 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:40,898 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2810, 2841], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_new_template', 'range': [2842, 2885], 'children': [{'type': 'Parameter', 'name': 'create_graph', 'range': [2847, 2849], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2851, 2861], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2853, 2861], 'children': [{'type': 'Type', 'name': 'str', 'range': [2855, 2855], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [2857, 2861], 'children': [{'type': 'FunctionCall', 'name': 'get_user_id', 'range': [2859, 2861], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'graph_db.GraphModel', 'range': [2866, 2868], 'children': []}, {'type': 'FunctionBody', 'name': '', 'range': [2871, 2885], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [2871, 2885], 'children': [{'type': 'FunctionCall', 'name': 'do_create_graph', 'range': [2873, 2884], 'children': [{'type': 'Argument', 'name': 'create_graph', 'range': [2875, 2875], 'children': []}, {'type': 'Argument', 'name': 'is_template', 'range': [2877, 2879], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2881, 2883], 'children': []}]}]}]}]}]}
2025-01-08 10:28:40,898 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:40,937 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [424, 476], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_or_create_user_route', 'range': [447, 476], 'children': [{'type': 'Parameter', 'name': 'user_data', 'range': [451, 458], 'children': [{'type': 'TypeAnnotation', 'name': 'dict', 'range': [453, 453], 'children': []}, {'type': 'DefaultValue', 'name': 'Depends', 'range': [455, 458], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [457, 457], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [461, 476], 'children': [{'type': 'VariableDeclaration', 'name': 'user', 'range': [462, 468], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [463, 468], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [464, 468], 'children': [{'type': 'CallExpression', 'name': 'get_or_create_user', 'range': [465, 468], 'children': [{'type': 'Argument', 'name': 'user_data', 'range': [467, 467], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [470, 475], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [472, 475], 'children': [{'type': 'Identifier', 'name': 'user', 'range': [471, 471], 'children': []}, {'type': 'CallExpression', 'name': 'model_dump', 'range': [473, 475], 'children': []}]}]}]}]}]}
2025-01-08 10:28:40,937 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:41,363 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [789, 812], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [789, 812], 'children': [{'type': 'Literal', 'name': 'path', 'range': [794, 796], 'children': []}, {'type': 'Literal', 'name': 'tags', 'range': [798, 802], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [800, 802], 'children': [{'type': 'Literal', 'name': '"graphs"', 'range': [801, 801], 'children': []}]}]}, {'type': 'Literal', 'name': 'dependencies', 'range': [804, 811], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [806, 811], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [807, 810], 'children': [{'type': 'Identifier', 'name': 'auth_middleware', 'range': [809, 809], 'children': []}]}]}]}]}]}
2025-01-08 10:28:41,363 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:43,810 - INFO - Step 4 result: {'type': 'Program', 'name': 'ScheduleCreationRequest', 'range': [2886, 2912], 'children': [{'type': 'ClassDecl', 'name': 'ScheduleCreationRequest', 'range': [2886, 2912], 'children': [{'type': 'Property', 'name': 'cron', 'range': [2895, 2897], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2897, 2897], 'children': []}]}, {'type': 'Property', 'name': 'input_data', 'range': [2899, 2906], 'children': [{'type': 'TypeAnnotation', 'name': 'dict', 'range': [2901, 2901], 'children': [{'type': 'TypeArgument', 'name': 'Any', 'range': [2903, 2903], 'children': []}, {'type': 'TypeArgument', 'name': 'Any', 'range': [2905, 2905], 'children': []}]}]}, {'type': 'Property', 'name': 'graph_id', 'range': [2908, 2910], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2910, 2910], 'children': []}]}]}]}
2025-01-08 10:28:43,810 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:43,883 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2530, 2558], 'children': [{'type': 'FunctionCall', 'name': 'get', 'range': [2533, 2558], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2536, 2538], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2541, 2545], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2548, 2555], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [2551, 2554], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2553, 2553], 'children': []}]}]}]}, {'type': 'FunctionDefinition', 'name': 'get_graph_run_node_execution_results', 'range': [2560, 2640], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2565, 2567], 'children': []}, {'type': 'Parameter', 'name': 'graph_exec_id', 'range': [2570, 2572], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2575, 2585], 'children': [{'type': 'FunctionCall', 'name': 'Annotated', 'range': [2577, 2585], 'children': [{'type': 'Argument', 'name': 'str', 'range': [2579, 2579], 'children': []}, {'type': 'FunctionCall', 'name': 'Depends', 'range': [2581, 2584], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [2583, 2583], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'Sequence', 'range': [2591, 2596], 'children': []}, {'type': 'Statement', 'name': 'graph', 'range': [2599, 2611], 'children': [{'type': 'FunctionCall', 'name': 'get_graph', 'range': [2604, 2611], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [2606, 2606], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2608, 2610], 'children': []}]}]}, {'type': 'Conditional', 'name': 'if', 'range': [2613, 2629], 'children': [{'type': 'Statement', 'name': 'raise', 'range': [2618, 2629], 'children': [{'type': 'FunctionCall', 'name': 'HTTPException', 'range': [2619, 2629], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [2621, 2623], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [2625, 2628], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2632, 2639], 'children': [{'type': 'FunctionCall', 'name': 'get_execution_results', 'range': [2636, 2639], 'children': [{'type': 'Argument', 'name': 'graph_exec_id', 'range': [2638, 2638], 'children': []}]}]}]}]}
2025-01-08 10:28:43,886 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:44,893 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [3147, 3233], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_execution_schedules', 'range': [3177, 3233], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [3181, 3191], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3183, 3191], 'children': [{'type': 'Type', 'name': 'str', 'range': [3185, 3186], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [3187, 3191], 'children': [{'type': 'FunctionCall', 'name': 'get_user_id', 'range': [3189, 3190], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'graph_id', 'range': [3194, 3200], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3196, 3196], 'children': []}, {'type': 'OptionalType', 'name': 'None', 'range': [3198, 3200], 'children': []}]}, {'type': 'ReturnType', 'name': 'list', 'range': [3206, 3211], 'children': [{'type': 'Type', 'name': 'scheduler.JobInfo', 'range': [3208, 3211], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3214, 3233], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [3214, 3233], 'children': [{'type': 'FunctionCall', 'name': 'execution_scheduler_client', 'range': [3215, 3217], 'children': []}, {'type': 'MethodCall', 'name': 'get_execution_schedules', 'range': [3219, 3232], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [3222, 3224], 'children': []}, {'type': 'Argument', 'name': 'graph_id', 'range': [3227, 3229], 'children': []}]}]}]}]}]}
2025-01-08 10:28:44,893 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:45,054 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [1133, 1158], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [1136, 1158], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1139, 1141], 'children': [{'type': 'Literal', 'name': '"/graphs"', 'range': [1141, 1141], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [1143, 1147], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1145, 1147], 'children': [{'type': 'Literal', 'name': '"graphs"', 'range': [1146, 1146], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [1149, 1156], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1151, 1156], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [1152, 1155], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [1154, 1154], 'children': []}]}]}]}]}]}
2025-01-08 10:28:45,055 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:45,197 - INFO - Step 2 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [3810, 3852], 'children': [{'type': 'Decorator', 'name': '@v1_router.post', 'range': [3810, 3852], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [3813, 3851], 'children': [{'type': 'StringLiteral', 'name': '"/api-keys/{key_id}/suspend"', 'range': [3816, 3816], 'children': []}, {'type': 'KeywordArgument', 'name': 'response_model', 'range': [3819, 3831], 'children': [{'type': 'TypeExpression', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3821, 3831], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'tags', 'range': [3834, 3838], 'children': [{'type': 'ListLiteral', 'name': '["api-keys"]', 'range': [3836, 3838], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'dependencies', 'range': [3841, 3848], 'children': [{'type': 'ListLiteral', 'name': '[Depends(auth_middleware)]', 'range': [3843, 3848], 'children': []}]}]}]}, {'type': 'Decorator', 'name': '@feature_flag', 'range': [3853, 3857], 'children': [{'type': 'CallExpression', 'name': 'feature_flag', 'range': [3854, 3857], 'children': [{'type': 'StringLiteral', 'name': '"api-keys-enabled"', 'range': [3856, 3856], 'children': []}]}]}, {'type': 'FunctionDeclaration', 'name': 'suspend_key', 'range': [3859, 3965], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3859, 3859], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3860, 3860], 'children': []}, {'type': 'Identifier', 'name': 'suspend_key', 'range': [3861, 3861], 'children': []}, {'type': 'ParameterList', 'name': 'key_id: str, user_id: Annotated[str, Depends(get_user_id)]', 'range': [3862, 3879], 'children': [{'type': 'Parameter', 'name': 'key_id: str', 'range': [3864, 3866], 'children': []}, {'type': 'Parameter', 'name': 'user_id: Annotated[str, Depends(get_user_id)]', 'range': [3868, 3878], 'children': []}]}, {'type': 'ReturnType', 'name': '-> Optional[APIKeyWithoutHash]', 'range': [3881, 3886], 'children': []}, {'type': 'Docstring', 'name': '"Suspend an API key"', 'range': [3889, 3891], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [3893, 3965], 'children': [{'type': 'Block', 'name': 'try block', 'range': [3895, 3904], 'children': [{'type': 'ReturnStatement', 'name': 'return await suspend_api_key(key_id, user_id)', 'range': [3896, 3903], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except APIKeyNotFoundError', 'range': [3905, 3920], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3908, 3920], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=404, detail="API key not found")', 'range': [3909, 3919], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except APIKeyPermissionError', 'range': [3921, 3936], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3924, 3936], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=403, detail="Permission denied")', 'range': [3925, 3935], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except APIKeyError as e', 'range': [3937, 3965], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3942, 3965], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Failed to suspend API key: {str(e)}")', 'range': [3943, 3949], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3951, 3964], 'children': []}]}]}]}]}]}
2025-01-08 10:28:45,197 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:45,462 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [580, 608], 'children': [{'type': 'FunctionDeclaration', 'name': 'execute_graph_block', 'range': [610, 690], 'children': [{'type': 'Parameter', 'name': 'block_id', 'range': [613, 615], 'children': []}, {'type': 'Parameter', 'name': 'data', 'range': [617, 619], 'children': []}, {'type': 'ReturnType', 'name': 'CompletedBlockOutput', 'range': [621, 623], 'children': []}, {'type': 'Assignment', 'name': 'obj', 'range': [626, 638], 'children': [{'type': 'FunctionCall', 'name': 'get_block', 'range': [634, 637], 'children': [{'type': 'Argument', 'name': 'block_id', 'range': [636, 636], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [639, 656], 'children': [{'type': 'Condition', 'name': 'not obj', 'range': [640, 641], 'children': []}, {'type': 'RaiseStatement', 'name': 'HTTPException', 'range': [644, 655], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [647, 649], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [651, 654], 'children': []}]}]}, {'type': 'Assignment', 'name': 'output', 'range': [658, 664], 'children': [{'type': 'FunctionCall', 'name': 'defaultdict', 'range': [660, 663], 'children': [{'type': 'Argument', 'name': 'list', 'range': [662, 662], 'children': []}]}]}, {'type': 'ForLoop', 'name': '', 'range': [665, 687], 'children': [{'type': 'Iteration', 'name': 'name, data in obj.execute(data)', 'range': [666, 675], 'children': []}, {'type': 'Assignment', 'name': 'output[name].append(data)', 'range': [678, 686], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'output', 'range': [688, 689], 'children': []}]}]}
2025-01-08 10:28:45,463 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:45,637 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [477, 579], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_graph_blocks', 'range': [502, 579], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [502, 517], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [502, 505], 'children': []}, {'type': 'FunctionName', 'name': 'get_graph_blocks', 'range': [503, 517], 'children': []}, {'type': 'Parameters', 'name': '', 'range': [504, 505], 'children': []}, {'type': 'ReturnType', 'name': '', 'range': [506, 517], 'children': [{'type': 'Keyword', 'name': '->', 'range': [506, 508], 'children': []}, {'type': 'Type', 'name': 'Sequence', 'range': [508, 517], 'children': [{'type': 'GenericType', 'name': 'dict', 'range': [510, 515], 'children': [{'type': 'Type', 'name': 'Any', 'range': [512, 515], 'children': []}]}]}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [518, 579], 'children': [{'type': 'VariableDeclaration', 'name': 'blocks', 'range': [519, 541], 'children': [{'type': 'Assignment', 'name': '=', 'range': [520, 541], 'children': [{'type': 'ListComprehension', 'name': '', 'range': [521, 541], 'children': [{'type': 'Expression', 'name': 'block', 'range': [522, 540], 'children': [{'type': 'FunctionCall', 'name': 'block', 'range': [522, 540], 'children': [{'type': 'FunctionName', 'name': 'block', 'range': [522, 527], 'children': []}, {'type': 'Parameters', 'name': '', 'range': [523, 540], 'children': []}]}]}, {'type': 'ForLoop', 'name': '', 'range': [525, 540], 'children': [{'type': 'Variable', 'name': 'block', 'range': [526, 531], 'children': []}, {'type': 'InKeyword', 'name': 'in', 'range': [527, 529], 'children': []}, {'type': 'Expression', 'name': 'backend.data.block.get_blocks().values()', 'range': [528, 540], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'costs', 'range': [543, 548], 'children': [{'type': 'Assignment', 'name': '=', 'range': [544, 548], 'children': [{'type': 'FunctionCall', 'name': 'get_block_costs', 'range': [545, 548], 'children': [{'type': 'FunctionName', 'name': 'get_block_costs', 'range': [545, 548], 'children': []}, {'type': 'Parameters', 'name': '', 'range': [546, 548], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [549, 579], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [549, 555], 'children': []}, {'type': 'ListComprehension', 'name': '', 'range': [550, 579], 'children': [{'type': 'Expression', 'name': '', 'range': [551, 573], 'children': [{'type': 'Dictionary', 'name': '', 'range': [551, 573], 'children': [{'type': 'KeyValuePair', 'name': '', 'range': [552, 562], 'children': [{'type': 'Expression', 'name': '*b.to_dict()', 'range': [552, 562], 'children': []}]}, {'type': 'KeyValuePair', 'name': '', 'range': [560, 572], 'children': [{'type': 'Key', 'name': 'costs', 'range': [560, 565], 'children': []}, {'type': 'Expression', 'name': 'costs.get(b.id, [])', 'range': [562, 572], 'children': []}]}]}]}, {'type': 'ForLoop', 'name': '', 'range': [574, 579], 'children': [{'type': 'Variable', 'name': 'b', 'range': [575, 576], 'children': []}, {'type': 'InKeyword', 'name': 'in', 'range': [576, 578], 'children': []}, {'type': 'Expression', 'name': 'blocks', 'range': [577, 579], 'children': []}]}]}]}]}]}]}
2025-01-08 10:28:45,637 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:46,338 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [857, 1003], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_graph', 'range': [914, 1003], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [914, 959], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [914, 919], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [915, 918], 'children': []}, {'type': 'Identifier', 'name': 'get_graph', 'range': [916, 925], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [917, 953], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [919, 922], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [920, 921], 'children': [{'type': 'Type', 'name': 'str', 'range': [921, 924], 'children': []}]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [924, 935], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [925, 934], 'children': [{'type': 'Type', 'name': 'Annotated', 'range': [926, 935], 'children': [{'type': 'Type', 'name': 'str', 'range': [928, 931], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [930, 933], 'children': [{'type': 'FunctionCall', 'name': 'get_user_id', 'range': [932, 933], 'children': []}]}]}]}]}, {'type': 'Parameter', 'name': 'version', 'range': [937, 943], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [938, 942], 'children': [{'type': 'Type', 'name': 'int', 'range': [939, 942], 'children': []}, {'type': 'Type', 'name': 'None', 'range': [941, 944], 'children': []}]}]}, {'type': 'Parameter', 'name': 'hide_credentials', 'range': [946, 950], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [947, 949], 'children': [{'type': 'Type', 'name': 'bool', 'range': [948, 951], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [954, 959], 'children': [{'type': 'Type', 'name': 'graph_db.GraphModel', 'range': [956, 959], 'children': []}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [960, 1003], 'children': [{'type': 'VariableDeclaration', 'name': 'graph', 'range': [961, 981], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [963, 968], 'children': []}, {'type': 'FunctionCall', 'name': 'graph_db.get_graph', 'range': [964, 981], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [969, 970], 'children': []}, {'type': 'Argument', 'name': 'version', 'range': [971, 972], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [973, 975], 'children': []}, {'type': 'Argument', 'name': 'for_export', 'range': [977, 979], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [983, 1000], 'children': [{'type': 'Condition', 'name': '', 'range': [983, 986], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [984, 985], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [985, 986], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [987, 1000], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [988, 999], 'children': [{'type': 'FunctionCall', 'name': 'HTTPException', 'range': [989, 999], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [991, 993], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [995, 998], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1001, 1003], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1002, 1003], 'children': []}]}]}]}]}
2025-01-08 10:28:46,338 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:46,650 - INFO - Step 3 result: {'type': 'Program', 'name': 'stop_graph_run', 'range': [2328, 2459], 'children': [{'type': 'FunctionDeclaration', 'name': 'stop_graph_run', 'range': [2358, 2459], 'children': [{'type': 'Decorator', 'name': '@v1_router.post', 'range': [2328, 2357], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2334, 2336], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2339, 2343], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2346, 2353], 'children': []}]}, {'type': 'Parameter', 'name': 'graph_exec_id', 'range': [2363, 2365], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2367, 2377], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated[str, Depends(get_user_id)]', 'range': [2369, 2377], 'children': []}]}, {'type': 'ReturnType', 'name': 'Sequence[execution_db.ExecutionResult]', 'range': [2382, 2387], 'children': []}, {'type': 'Block', 'name': 'FunctionBody', 'range': [2389, 2459], 'children': [{'type': 'IfStatement', 'name': 'if not await graph_db.get_execution', 'range': [2390, 2417], 'children': [{'type': 'Condition', 'name': 'not await graph_db.get_execution(user_id=user_id, execution_id=graph_exec_id)', 'range': [2391, 2404], 'children': []}, {'type': 'Block', 'name': 'IfBody', 'range': [2405, 2417], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(404, detail=f"Agent execution #{graph_exec_id} not found")', 'range': [2407, 2416], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'await asyncio.to_thread(lambda: execution_manager_client().cancel_execution(graph_exec_id))', 'range': [2419, 2437], 'children': []}, {'type': 'ReturnStatement', 'name': 'return await execution_db.get_execution_results(graph_exec_id)', 'range': [2451, 2458], 'children': []}]}]}]}
2025-01-08 10:28:46,650 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:46,733 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [1004, 1132], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_graph_all_versions', 'range': [1066, 1132], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [1066, 1096], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1066, 1071], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1067, 1070], 'children': []}, {'type': 'Identifier', 'name': 'get_graph_all_versions', 'range': [1068, 1089], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [1069, 1086], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1071, 1074], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [1072, 1073], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [1073, 1076], 'children': []}]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1075, 1085], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [1076, 1085], 'children': [{'type': 'Identifier', 'name': 'Annotated', 'range': [1077, 1086], 'children': []}, {'type': 'TypeArgumentList', 'name': '', 'range': [1078, 1085], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [1079, 1082], 'children': []}, {'type': 'Identifier', 'name': 'Depends', 'range': [1081, 1088], 'children': []}]}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [1088, 1096], 'children': [{'type': 'Identifier', 'name': 'Sequence', 'range': [1090, 1097], 'children': []}, {'type': 'TypeArgumentList', 'name': '', 'range': [1091, 1096], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1092, 1099], 'children': []}, {'type': 'Identifier', 'name': 'GraphModel', 'range': [1094, 1103], 'children': []}]}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [1097, 1132], 'children': [{'type': 'VariableDeclaration', 'name': 'graphs', 'range': [1098, 1111], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [1100, 1105], 'children': []}, {'type': 'Identifier', 'name': 'graph_db', 'range': [1101, 1108], 'children': []}, {'type': 'Identifier', 'name': 'get_graph_all_versions', 'range': [1103, 1126], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1104, 1110], 'children': [{'type': 'Identifier', 'name': 'graph_id', 'range': [1105, 1112], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1107, 1114], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [1112, 1129], 'children': [{'type': 'Condition', 'name': '', 'range': [1113, 1115], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [1113, 1117], 'children': [{'type': 'Identifier', 'name': 'graphs', 'range': [1114, 1120], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [1115, 1129], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1117, 1128], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1118, 1131], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1119, 1127], 'children': [{'type': 'AssignmentExpression', 'name': 'status_code', 'range': [1120, 1123], 'children': [{'type': 'NumericLiteral', 'name': '404', 'range': [1122, 1125], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'detail', 'range': [1124, 1127], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [1126, 1127], 'children': [{'type': 'TemplateElement', 'name': 'Graph #{graph_id} not found.', 'range': [1127, 1128], 'children': []}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1130, 1132], 'children': [{'type': 'Identifier', 'name': 'graphs', 'range': [1131, 1132], 'children': []}]}]}]}]}
2025-01-08 10:28:46,733 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:47,244 - INFO - Step 4 result: {'type': 'Program', 'name': 'execution_scheduler_client', 'range': [297, 315], 'children': [{'type': 'FunctionDecl', 'name': 'execution_scheduler_client', 'range': [300, 314], 'children': [{'type': 'FunctionSignature', 'range': [300, 307], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [300, 300]}, {'type': 'Identifier', 'name': 'execution_scheduler_client', 'range': [301, 301]}, {'type': 'Operator', 'name': '->', 'range': [304, 305]}, {'type': 'Identifier', 'name': 'ExecutionScheduler', 'range': [306, 306]}]}, {'type': 'FunctionBody', 'range': [308, 314], 'children': [{'type': 'ReturnStatement', 'range': [309, 313], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [309, 309]}, {'type': 'CallExpression', 'range': [310, 313], 'children': [{'type': 'Identifier', 'name': 'get_service_client', 'range': [310, 310]}, {'type': 'Identifier', 'name': 'ExecutionScheduler', 'range': [312, 312]}]}]}]}]}]}
2025-01-08 10:28:47,245 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:48,243 - INFO - Step 4 result: {'nodes': [{'type': 'VariableDecl', 'name': 'settings', 'range': [316, 320], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [317, 320], 'children': [{'type': 'CallExpression', 'name': 'Settings', 'range': [318, 320], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'logger', 'range': [322, 329], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [323, 329], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [324, 329], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [328, 329], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'integration_creds_manager', 'range': [331, 335], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [332, 335], 'children': [{'type': 'CallExpression', 'name': 'IntegrationCredentialsManager', 'range': [333, 335], 'children': []}]}]}, {'type': 'VariableDecl', 'name': '_user_credit_model', 'range': [339, 343], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [340, 343], 'children': [{'type': 'CallExpression', 'name': 'get_user_credit_model', 'range': [341, 343], 'children': []}]}]}]}
2025-01-08 10:28:48,258 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:48,887 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [789, 812], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [789, 812], 'children': [{'type': 'Literal', 'name': 'path', 'range': [794, 796], 'children': []}, {'type': 'Literal', 'name': 'tags', 'range': [798, 802], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [800, 802], 'children': [{'type': 'Literal', 'name': '"graphs"', 'range': [801, 801], 'children': []}]}]}, {'type': 'Literal', 'name': 'dependencies', 'range': [804, 811], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [806, 811], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [807, 810], 'children': [{'type': 'Identifier', 'name': 'auth_middleware', 'range': [809, 809], 'children': []}]}]}]}]}]}
2025-01-08 10:28:48,888 - INFO - Completed main AST analysis flow
2025-01-08 10:28:48,888 - INFO - Successfully processed chunk
2025-01-08 10:28:49,365 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [3064, 3146], 'children': [{'type': 'FunctionDeclaration', 'name': 'delete_schedule', 'range': [3094, 3146], 'children': [{'type': 'Parameter', 'name': 'schedule_id', 'range': [3098, 3100], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3100, 3100]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [3103, 3113], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3105, 3113], 'children': [{'type': 'Type', 'name': 'str', 'range': [3107, 3107]}, {'type': 'FunctionCall', 'name': 'Depends', 'range': [3109, 3112], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [3111, 3111]}]}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [3119, 3124], 'children': [{'type': 'Type', 'name': 'Any', 'range': [3121, 3121]}, {'type': 'Type', 'name': 'Any', 'range': [3123, 3123]}]}, {'type': 'FunctionCall', 'name': 'execution_scheduler_client', 'range': [3127, 3138], 'children': [{'type': 'FunctionCall', 'name': 'delete_schedule', 'range': [3131, 3138], 'children': [{'type': 'Argument', 'name': 'schedule_id', 'range': [3133, 3133]}, {'type': 'KeywordArgument', 'name': 'user_id', 'range': [3135, 3137], 'children': [{'type': 'Variable', 'name': 'user_id', 'range': [3137, 3137]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [3140, 3145], 'children': [{'type': 'Dictionary', 'name': '', 'range': [3141, 3145], 'children': [{'type': 'KeyValuePair', 'name': 'id', 'range': [3142, 3144], 'children': [{'type': 'Variable', 'name': 'schedule_id', 'range': [3144, 3144]}]}]}]}]}]}
2025-01-08 10:28:49,365 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:49,483 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [3512, 3653], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_api_key', 'range': [3555, 3653], 'children': [{'type': 'Decorator', 'name': 'feature_flag', 'range': [3555, 3559], 'children': [{'type': 'Argument', 'name': '"api-keys-enabled"', 'range': [3558, 3559], 'children': []}]}, {'type': 'FunctionSignature', 'name': '', 'range': [3561, 3585], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3561, 3561], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3562, 3562], 'children': []}, {'type': 'FunctionName', 'name': 'get_api_key', 'range': [3563, 3563], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [3564, 3581], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [3566, 3568], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3568, 3568], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [3570, 3580], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3572, 3580], 'children': [{'type': 'TypeArgument', 'name': 'str', 'range': [3574, 3574], 'children': []}, {'type': 'TypeArgument', 'name': 'Depends', 'range': [3576, 3580], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [3578, 3578], 'children': []}]}]}]}]}, {'type': 'ReturnType', 'name': 'APIKeyWithoutHash', 'range': [3585, 3585], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3587, 3653], 'children': [{'type': 'Docstring', 'name': '"Get a specific API key"', 'range': [3588, 3590], 'children': []}, {'type': 'TryStatement', 'name': '', 'range': [3592, 3653], 'children': [{'type': 'TryBlock', 'name': '', 'range': [3592, 3624], 'children': [{'type': 'Assignment', 'name': 'api_key', 'range': [3595, 3603], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [3597, 3597], 'children': [{'type': 'FunctionCall', 'name': 'get_api_key_by_id', 'range': [3598, 3603], 'children': [{'type': 'Argument', 'name': 'key_id', 'range': [3600, 3600], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [3602, 3602], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [3605, 3621], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [3606, 3607], 'children': []}, {'type': 'IfBlock', 'name': '', 'range': [3608, 3621], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3610, 3620], 'children': [{'type': 'FunctionCall', 'name': 'HTTPException', 'range': [3611, 3620], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [3613, 3615], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [3617, 3619], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [3622, 3623], 'children': [{'type': 'Variable', 'name': 'api_key', 'range': [3623, 3623], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': '', 'range': [3625, 3653], 'children': [{'type': 'Exception', 'name': 'APIKeyError', 'range': [3626, 3626], 'children': []}, {'type': 'AsClause', 'name': 'as e', 'range': [3627, 3628], 'children': []}, {'type': 'ExceptBlockBody', 'name': '', 'range': [3629, 3653], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [3631, 3637], 'children': [{'type': 'FunctionCall', 'name': 'logger.error', 'range': [3631, 3637], 'children': [{'type': 'Argument', 'name': 'f"Failed to get API key: {str(e)}"', 'range': [3635, 3636], 'children': []}]}]}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [3639, 3652], 'children': [{'type': 'FunctionCall', 'name': 'HTTPException', 'range': [3640, 3652], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [3642, 3644], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [3646, 3648], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:28:49,484 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:49,768 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2182, 2211], 'children': [{'type': 'FunctionDecl', 'name': 'execute_graph', 'range': [2212, 2261], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2216, 2218], 'children': []}, {'type': 'Parameter', 'name': 'node_input', 'range': [2221, 2228], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2231, 2241], 'children': []}, {'type': 'ReturnType', 'name': 'dict', 'range': [2247, 2252], 'children': []}]}, {'type': 'TryStatement', 'name': 'try', 'range': [2262, 2327], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2264, 2292], 'children': [{'type': 'AssignmentExpression', 'name': 'graph_exec', 'range': [2265, 2282], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2284, 2292], 'children': []}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2293, 2327], 'children': [{'type': 'Block', 'name': 'catchBlock', 'range': [2298, 2327], 'children': [{'type': 'AssignmentExpression', 'name': 'msg', 'range': [2299, 2315], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2316, 2327], 'children': []}]}]}]}]}
2025-01-08 10:28:49,768 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:49,885 - INFO - Step 2 result: {'type': 'Program', 'name': 'create_api_key', 'range': [3234, 3393], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_api_key', 'range': [3277, 3393], 'children': [{'type': 'Decorator', 'name': 'v1_router.post', 'range': [3234, 3276], 'children': [{'type': 'FunctionCall', 'name': 'post', 'range': [3237, 3275], 'children': [{'type': 'Argument', 'name': '"/api-keys"', 'range': [3240, 3240], 'children': []}, {'type': 'Argument', 'name': 'response_model=list[CreateAPIKeyResponse]|dict[str, str]', 'range': [3243, 3255], 'children': []}, {'type': 'Argument', 'name': 'tags=["api-keys"]', 'range': [3258, 3262], 'children': []}, {'type': 'Argument', 'name': 'dependencies=[Depends(auth_middleware)]', 'range': [3265, 3272], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3277, 3282], 'children': [{'type': 'FunctionCall', 'name': 'feature_flag', 'range': [3278, 3281], 'children': [{'type': 'Argument', 'name': '"api-keys-enabled"', 'range': [3280, 3280], 'children': []}]}]}, {'type': 'FunctionSignature', 'name': 'create_api_key', 'range': [3283, 3308], 'children': [{'type': 'Parameter', 'name': 'request: CreateAPIKeyRequest', 'range': [3288, 3291], 'children': []}, {'type': 'Parameter', 'name': 'user_id: Annotated[str, Depends(get_user_id)]', 'range': [3292, 3303], 'children': []}, {'type': 'ReturnType', 'name': '-> CreateAPIKeyResponse', 'range': [3305, 3307], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3309, 3393], 'children': [{'type': 'TryStatement', 'name': '', 'range': [3314, 3364], 'children': [{'type': 'Block', 'name': '', 'range': [3315, 3364], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key, plain_text = await generate_api_key', 'range': [3317, 3321], 'children': [{'type': 'FunctionCall', 'name': 'generate_api_key', 'range': [3321, 3351], 'children': [{'type': 'Argument', 'name': 'name=request.name', 'range': [3325, 3329], 'children': []}, {'type': 'Argument', 'name': 'user_id=user_id', 'range': [3332, 3334], 'children': []}, {'type': 'Argument', 'name': 'permissions=request.permissions', 'range': [3337, 3341], 'children': []}, {'type': 'Argument', 'name': 'description=request.description', 'range': [3344, 3348], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return CreateAPIKeyResponse(api_key=api_key, plain_text_key=plain_text)', 'range': [3353, 3364], 'children': [{'type': 'FunctionCall', 'name': 'CreateAPIKeyResponse', 'range': [3355, 3363], 'children': [{'type': 'Argument', 'name': 'api_key=api_key', 'range': [3356, 3358], 'children': []}, {'type': 'Argument', 'name': 'plain_text_key=plain_text', 'range': [3360, 3362], 'children': []}]}]}]}]}, {'type': 'CatchStatement', 'name': '', 'range': [3365, 3393], 'children': [{'type': 'Block', 'name': '', 'range': [3369, 3393], 'children': [{'type': 'FunctionCall', 'name': 'logger.error', 'range': [3371, 3377], 'children': [{'type': 'Argument', 'name': 'f"Failed to create API key: {str(e)}"', 'range': [3375, 3376], 'children': []}]}, {'type': 'ThrowStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3379, 3393], 'children': [{'type': 'FunctionCall', 'name': 'HTTPException', 'range': [3381, 3392], 'children': [{'type': 'Argument', 'name': 'status_code=400', 'range': [3382, 3384], 'children': []}, {'type': 'Argument', 'name': 'detail=str(e)', 'range': [3386, 3391], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:28:49,885 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:50,833 - INFO - Step 3 result: {'type': 'Program', 'name': 'delete_api_key', 'range': [3654, 3809], 'children': [{'type': 'Decorator', 'name': 'v1_router.delete', 'range': [3654, 3695], 'children': [{'type': 'Argument', 'name': 'path', 'range': [3658, 3660], 'children': []}, {'type': 'Argument', 'name': 'response_model', 'range': [3663, 3675], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [3678, 3682], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [3685, 3692], 'children': []}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3697, 3701], 'children': [{'type': 'Argument', 'name': 'flag', 'range': [3699, 3700], 'children': []}]}, {'type': 'FunctionDef', 'name': 'delete_api_key', 'range': [3703, 3809], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [3708, 3710], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [3712, 3722], 'children': []}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [3725, 3730], 'children': []}, {'type': 'Docstring', 'name': 'Revoke an API key', 'range': [3733, 3735], 'children': []}, {'type': 'TryBlock', 'name': 'try', 'range': [3737, 3809], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [3740, 3747], 'children': []}, {'type': 'ExceptBlock', 'name': 'except APIKeyNotFoundError', 'range': [3749, 3764], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3753, 3763], 'children': []}]}, {'type': 'ExceptBlock', 'name': 'except APIKeyPermissionError', 'range': [3765, 3780], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3769, 3779], 'children': []}]}, {'type': 'ExceptBlock', 'name': 'except APIKeyError as e', 'range': [3781, 3809], 'children': [{'type': 'LogStatement', 'name': 'logger.error', 'range': [3787, 3793], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3795, 3808], 'children': []}]}]}]}]}
2025-01-08 10:28:50,833 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:51,000 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [1950, 2181], 'children': [{'type': 'FunctionDecl', 'name': 'set_graph_active_version', 'range': [1980, 2146], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1985, 1987], 'children': []}, {'type': 'Parameter', 'name': 'request_body', 'range': [1990, 1992], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1995, 2005], 'children': []}, {'type': 'AssignmentExpression', 'name': 'new_active_version', 'range': [2011, 2015], 'children': []}, {'type': 'AssignmentExpression', 'name': 'new_active_graph', 'range': [2017, 2033], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [2035, 2048], 'children': []}, {'type': 'AssignmentExpression', 'name': 'current_active_graph', 'range': [2050, 2062], 'children': []}, {'type': 'AwaitExpression', 'name': '', 'range': [2100, 2112], 'children': []}, {'type': 'AwaitExpression', 'name': '', 'range': [2124, 2145], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [2147, 2180], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'get_credentials', 'range': [2065, 2086], 'children': [{'type': 'Parameter', 'name': 'credentials_id', 'range': [2068, 2070], 'children': []}, {'type': 'ReturnStatement', 'name': '', 'range': [2077, 2085], 'children': []}]}]}
2025-01-08 10:28:51,000 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:51,728 - INFO - Step 5 result: {'type': 'Program', 'name': 'ScheduleCreationRequest', 'range': [2886, 2912], 'children': [{'type': 'ClassDecl', 'name': 'ScheduleCreationRequest', 'range': [2886, 2912], 'children': [{'type': 'Property', 'name': 'cron', 'range': [2895, 2897], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2897, 2897], 'children': []}]}, {'type': 'Property', 'name': 'input_data', 'range': [2899, 2906], 'children': [{'type': 'TypeAnnotation', 'name': 'dict', 'range': [2901, 2901], 'children': [{'type': 'TypeArgument', 'name': 'Any', 'range': [2903, 2903], 'children': []}, {'type': 'TypeArgument', 'name': 'Any', 'range': [2905, 2905], 'children': []}]}]}, {'type': 'Property', 'name': 'graph_id', 'range': [2908, 2910], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [2910, 2910], 'children': []}]}]}]}
2025-01-08 10:28:51,728 - INFO - Completed main AST analysis flow
2025-01-08 10:28:51,729 - INFO - Successfully processed chunk
2025-01-08 10:28:51,912 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [346, 423], 'children': [{'type': 'VariableDeclaration', 'name': 'v1_router', 'range': [346, 350], 'children': [{'type': 'Assignment', 'name': '=', 'range': [347, 347], 'children': []}, {'type': 'FunctionCall', 'name': 'APIRouter', 'range': [348, 350], 'children': []}]}, {'type': 'FunctionCall', 'name': 'include_router', 'range': [353, 381], 'children': [{'type': 'Argument', 'name': 'backend.server.integrations.router.router', 'range': [358, 366], 'children': []}, {'type': 'Argument', 'name': 'prefix', 'range': [369, 371], 'children': [{'type': 'StringLiteral', 'name': '"/integrations"', 'range': [371, 371], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [374, 378], 'children': [{'type': 'ArrayLiteral', 'name': '["integrations"]', 'range': [376, 378], 'children': [{'type': 'StringLiteral', 'name': '"integrations"', 'range': [377, 377], 'children': []}]}]}]}, {'type': 'FunctionCall', 'name': 'include_router', 'range': [384, 422], 'children': [{'type': 'Argument', 'name': 'backend.server.routers.analytics.router', 'range': [389, 397], 'children': []}, {'type': 'Argument', 'name': 'prefix', 'range': [400, 402], 'children': [{'type': 'StringLiteral', 'name': '"/analytics"', 'range': [402, 402], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [405, 409], 'children': [{'type': 'ArrayLiteral', 'name': '["analytics"]', 'range': [407, 409], 'children': [{'type': 'StringLiteral', 'name': '"analytics"', 'range': [408, 408], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [412, 419], 'children': [{'type': 'ArrayLiteral', 'name': '[Depends(auth_middleware)]', 'range': [414, 419], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [415, 419], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [417, 417], 'children': []}]}]}]}]}]}
2025-01-08 10:28:51,912 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:52,154 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2810, 2841], 'children': [{'type': 'FunctionDecl', 'name': 'create_new_template', 'range': [2842, 2885], 'children': [{'type': 'Parameter', 'name': 'create_graph', 'range': [2847, 2849], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2851, 2861], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2853, 2861], 'children': [{'type': 'Type', 'name': 'str', 'range': [2855, 2855], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [2857, 2861], 'children': [{'type': 'CallExpression', 'name': 'get_user_id', 'range': [2859, 2861], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'graph_db.GraphModel', 'range': [2866, 2868], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [2871, 2885], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [2871, 2885], 'children': [{'type': 'CallExpression', 'name': 'do_create_graph', 'range': [2873, 2884], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [2875, 2875], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [2877, 2879], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [2881, 2883], 'children': []}]}]}]}]}]}
2025-01-08 10:28:52,155 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:52,340 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_api_keys', 'range': [3394, 3511], 'children': [{'type': 'Decorator', 'name': 'v1_router.get', 'range': [3394, 3435], 'children': [{'type': 'Argument', 'name': 'path', 'range': [3400, 3400], 'children': []}, {'type': 'Argument', 'name': 'response_model', 'range': [3403, 3415], 'children': [{'type': 'Type', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3405, 3415], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [3418, 3422], 'children': [{'type': 'List', 'name': '["api-keys"]', 'range': [3420, 3422], 'children': []}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [3425, 3432], 'children': [{'type': 'List', 'name': '[Depends(auth_middleware)]', 'range': [3427, 3432], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3437, 3441], 'children': [{'type': 'Argument', 'name': '"api-keys-enabled"', 'range': [3440, 3440], 'children': []}]}, {'type': 'Function', 'name': 'get_api_keys', 'range': [3443, 3511], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [3448, 3458], 'children': [{'type': 'Type', 'name': 'Annotated[str, Depends(get_user_id)]', 'range': [3450, 3458], 'children': []}]}, {'type': 'ReturnType', 'name': 'list[APIKeyWithoutHash]', 'range': [3463, 3466], 'children': []}, {'type': 'Docstring', 'name': '"List all API keys for the user"', 'range': [3469, 3471], 'children': []}, {'type': 'TryBlock', 'name': 'try', 'range': [3473, 3511], 'children': [{'type': 'ReturnStatement', 'name': 'return await list_user_api_keys(user_id)', 'range': [3476, 3481], 'children': []}, {'type': 'ExceptBlock', 'name': 'except APIKeyError as e', 'range': [3483, 3511], 'children': [{'type': 'LogStatement', 'name': 'logger.error(f"Failed to list API keys: {str(e)}")', 'range': [3489, 3495], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3497, 3510], 'children': []}]}]}]}]}
2025-01-08 10:28:52,340 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:52,576 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [424, 476], 'children': [{'type': 'FunctionDecl', 'name': 'get_or_create_user_route', 'range': [447, 476], 'children': [{'type': 'Parameter', 'name': 'user_data', 'range': [451, 458], 'children': [{'type': 'TypeAnnotation', 'name': 'dict', 'range': [453, 453], 'children': []}, {'type': 'DefaultValue', 'name': 'Depends', 'range': [455, 458], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [457, 457], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [461, 476], 'children': [{'type': 'VariableDecl', 'name': 'user', 'range': [462, 468], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [463, 468], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [464, 468], 'children': [{'type': 'CallExpression', 'name': 'get_or_create_user', 'range': [465, 468], 'children': [{'type': 'Argument', 'name': 'user_data', 'range': [467, 467], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [470, 475], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [472, 475], 'children': [{'type': 'Identifier', 'name': 'user', 'range': [471, 471], 'children': []}, {'type': 'CallExpression', 'name': 'model_dump', 'range': [473, 475], 'children': []}]}]}]}]}]}
2025-01-08 10:28:52,576 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:53,173 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2641, 2672], 'children': [{'type': 'FunctionCall', 'name': 'get', 'range': [2641, 2672], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2647, 2649], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2652, 2658], 'children': [{'type': 'List', 'name': '', 'range': [2654, 2658], 'children': [{'type': 'StringLiteral', 'name': '"graphs"', 'range': [2655, 2655], 'children': []}, {'type': 'StringLiteral', 'name': '"templates"', 'range': [2657, 2657], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [2661, 2668], 'children': [{'type': 'List', 'name': '', 'range': [2663, 2668], 'children': [{'type': 'FunctionCall', 'name': 'Depends', 'range': [2664, 2667], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2666, 2666], 'children': []}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'get_templates', 'range': [2673, 2715], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2678, 2688], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2680, 2688], 'children': [{'type': 'Type', 'name': 'str', 'range': [2682, 2682], 'children': []}, {'type': 'FunctionCall', 'name': 'Depends', 'range': [2684, 2687], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [2686, 2686], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'Sequence', 'range': [2693, 2698], 'children': [{'type': 'Type', 'name': 'graph_db.GraphModel', 'range': [2695, 2697], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2701, 2714], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2702, 2714], 'children': [{'type': 'FunctionCall', 'name': 'graph_db.get_graphs', 'range': [2703, 2714], 'children': [{'type': 'Argument', 'name': 'filter_by', 'range': [2707, 2709], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2711, 2713], 'children': []}]}]}]}]}]}
2025-01-08 10:28:53,174 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:53,776 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [1133, 1158], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [1136, 1158], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1139, 1141], 'children': [{'type': 'Literal', 'name': '"/graphs"', 'range': [1141, 1141], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [1143, 1147], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1145, 1147], 'children': [{'type': 'Literal', 'name': '"graphs"', 'range': [1146, 1146], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [1149, 1156], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1151, 1156], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [1152, 1155], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [1154, 1154], 'children': []}]}]}]}]}]}
2025-01-08 10:28:53,777 - INFO - Completed main AST analysis flow
2025-01-08 10:28:53,777 - INFO - Successfully processed chunk
2025-01-08 10:28:53,925 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2460, 2488], 'children': [{'type': 'Decorator', 'name': '@', 'range': [2460, 2460], 'children': []}, {'type': 'CallExpression', 'name': 'v1_router.get', 'range': [2461, 2488], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2466, 2468], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2471, 2475], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2478, 2485], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [2481, 2484], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2483, 2483], 'children': []}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_executions', 'range': [2490, 2529], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2495, 2505], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2497, 2505], 'children': [{'type': 'Type', 'name': 'str', 'range': [2499, 2499], 'children': []}, {'type': 'CallExpression', 'name': 'Depends', 'range': [2501, 2504], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [2503, 2503], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'list', 'range': [2511, 2516], 'children': [{'type': 'Type', 'name': 'graph_db.GraphExecution', 'range': [2513, 2516], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2519, 2528], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2520, 2520], 'children': [{'type': 'CallExpression', 'name': 'graph_db.get_executions', 'range': [2521, 2528], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [2525, 2527], 'children': []}]}]}]}]}]}
2025-01-08 10:28:53,925 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:54,164 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [1540, 1949], 'children': [{'type': 'FunctionDeclaration', 'name': 'update_graph', 'range': [1599, 1949], 'children': [{'type': 'Decorator', 'name': '@v1_router.put', 'range': [1540, 1565], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1546, 1548], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [1550, 1554], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [1556, 1563], 'children': []}]}, {'type': 'Decorator', 'name': '@v1_router.put', 'range': [1567, 1597], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1573, 1575], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [1578, 1584], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [1587, 1594], 'children': []}]}, {'type': 'FunctionSignature', 'name': 'update_graph', 'range': [1599, 1635], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1604, 1606], 'children': []}, {'type': 'Parameter', 'name': 'graph', 'range': [1609, 1614], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1616, 1627], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [1636, 1949], 'children': [{'type': 'Comment', 'name': '# Sanity check', 'range': [1637, 1640], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1641, 1663], 'children': [{'type': 'Condition', 'name': '', 'range': [1642, 1651], 'children': []}, {'type': 'Body', 'name': '', 'range': [1652, 1663], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1654, 1662], 'children': []}]}]}, {'type': 'Comment', 'name': '# Determine new version', 'range': [1665, 1669], 'children': []}, {'type': 'VariableDeclaration', 'name': 'existing_versions', 'range': [1670, 1683], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1684, 1699], 'children': [{'type': 'Condition', 'name': '', 'range': [1685, 1686], 'children': []}, {'type': 'Body', 'name': '', 'range': [1687, 1699], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1689, 1698], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'latest_version_number', 'range': [1700, 1712], 'children': []}, {'type': 'Assignment', 'name': 'graph.version', 'range': [1713, 1720], 'children': []}, {'type': 'VariableDeclaration', 'name': 'latest_version_graph', 'range': [1722, 1741], 'children': []}, {'type': 'VariableDeclaration', 'name': 'current_active_version', 'range': [1742, 1760], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1761, 1783], 'children': [{'type': 'Condition', 'name': '', 'range': [1762, 1769], 'children': []}, {'type': 'Body', 'name': '', 'range': [1770, 1783], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1772, 1782], 'children': []}]}]}, {'type': 'Assignment', 'name': 'graph.is_active', 'range': [1784, 1792], 'children': []}, {'type': 'Assignment', 'name': 'graph', 'range': [1793, 1803], 'children': []}, {'type': 'MethodCall', 'name': 'graph.reassign_ids', 'range': [1804, 1812], 'children': []}, {'type': 'VariableDeclaration', 'name': 'new_graph_version', 'range': [1814, 1827], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1829, 1918], 'children': [{'type': 'Condition', 'name': '', 'range': [1830, 1833], 'children': []}, {'type': 'Body', 'name': '', 'range': [1834, 1918], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_credentials', 'range': [1836, 1857], 'children': []}, {'type': 'Comment', 'name': '# Handle activation of the new graph first to ensure continuity', 'range': [1859, 1870], 'children': []}, {'type': 'Assignment', 'name': 'new_graph_version', 'range': [1871, 1886], 'children': []}, {'type': 'Comment', 'name': '# Ensure new version is the only active version', 'range': [1887, 1896], 'children': []}, {'type': 'MethodCall', 'name': 'graph_db.set_graph_active_version', 'range': [1897, 1917], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [1919, 1946], 'children': [{'type': 'Condition', 'name': '', 'range': [1920, 1921], 'children': []}, {'type': 'Body', 'name': '', 'range': [1922, 1946], 'children': [{'type': 'Comment', 'name': '# Handle deactivation of the previously active version', 'range': [1923, 1931], 'children': []}, {'type': 'MethodCall', 'name': 'on_graph_deactivate', 'range': [1932, 1945], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1947, 1949], 'children': []}]}]}]}
2025-01-08 10:28:54,165 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:54,855 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [691, 708], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [694, 708], 'children': [{'type': 'Argument', 'name': 'path', 'range': [696, 698], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [700, 707], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [703, 706], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [705, 705], 'children': []}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_user_credits', 'range': [710, 776], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [715, 725], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [717, 725], 'children': [{'type': 'Type', 'name': 'str', 'range': [719, 719], 'children': []}, {'type': 'CallExpression', 'name': 'Depends', 'range': [721, 724], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [723, 723], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [731, 736], 'children': [{'type': 'Type', 'name': 'str', 'range': [733, 733], 'children': []}, {'type': 'Type', 'name': 'int', 'range': [735, 735], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [759, 775], 'children': [{'type': 'Dictionary', 'name': 'credits', 'range': [760, 775], 'children': [{'type': 'KeyValuePair', 'name': 'credits', 'range': [761, 774], 'children': [{'type': 'CallExpression', 'name': 'max', 'range': [763, 774], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [765, 771], 'children': [{'type': 'CallExpression', 'name': 'get_or_refill_credit', 'range': [768, 771], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [770, 770], 'children': []}]}]}, {'type': 'Literal', 'name': '0', 'range': [773, 773], 'children': []}]}]}]}]}]}]}
2025-01-08 10:28:54,855 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:55,888 - INFO - Step 5 result: {'type': 'Program', 'name': 'execution_scheduler_client', 'range': [297, 315], 'children': [{'type': 'FunctionDecl', 'name': 'execution_scheduler_client', 'range': [300, 314], 'children': [{'type': 'FunctionSignature', 'range': [300, 307], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [300, 300]}, {'type': 'Identifier', 'name': 'execution_scheduler_client', 'range': [301, 301]}, {'type': 'Operator', 'name': '->', 'range': [304, 305]}, {'type': 'Identifier', 'name': 'ExecutionScheduler', 'range': [306, 306]}]}, {'type': 'FunctionBody', 'range': [308, 314], 'children': [{'type': 'ReturnStatement', 'range': [309, 313], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [309, 309]}, {'type': 'CallExpression', 'range': [310, 313], 'children': [{'type': 'Identifier', 'name': 'get_service_client', 'range': [310, 310]}, {'type': 'Identifier', 'name': 'ExecutionScheduler', 'range': [312, 312]}]}]}]}]}]}
2025-01-08 10:28:55,888 - INFO - Completed main AST analysis flow
2025-01-08 10:28:55,889 - INFO - Successfully processed chunk
2025-01-08 10:28:57,969 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [3147, 3233], 'children': [{'type': 'FunctionDecl', 'name': 'get_execution_schedules', 'range': [3177, 3233], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [3181, 3191], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3183, 3191], 'children': [{'type': 'Type', 'name': 'str', 'range': [3185, 3186], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [3187, 3191], 'children': [{'type': 'CallExpression', 'name': 'get_user_id', 'range': [3189, 3190], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'graph_id', 'range': [3194, 3200], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3196, 3196], 'children': []}, {'type': 'OptionalType', 'name': 'None', 'range': [3198, 3200], 'children': []}]}, {'type': 'ReturnType', 'name': 'list', 'range': [3206, 3211], 'children': [{'type': 'Type', 'name': 'scheduler.JobInfo', 'range': [3208, 3211], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3214, 3233], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [3214, 3233], 'children': [{'type': 'CallExpression', 'name': 'execution_scheduler_client', 'range': [3215, 3217], 'children': []}, {'type': 'MethodCall', 'name': 'get_execution_schedules', 'range': [3219, 3232], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [3222, 3224], 'children': []}, {'type': 'Argument', 'name': 'graph_id', 'range': [3227, 3229], 'children': []}]}]}]}]}]}
2025-01-08 10:28:57,969 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:58,662 - INFO - Step 5 result: {'nodes': [{'type': 'Program', 'name': 'MainProgram', 'range': [316, 343], 'children': [{'type': 'VariableDecl', 'name': 'settings', 'range': [316, 320], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [317, 320], 'children': [{'type': 'CallExpression', 'name': 'Settings', 'range': [318, 320], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'logger', 'range': [322, 329], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [323, 329], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [324, 329], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [328, 329], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'integration_creds_manager', 'range': [331, 335], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [332, 335], 'children': [{'type': 'CallExpression', 'name': 'IntegrationCredentialsManager', 'range': [333, 335], 'children': []}]}]}, {'type': 'VariableDecl', 'name': '_user_credit_model', 'range': [339, 343], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [340, 343], 'children': [{'type': 'CallExpression', 'name': 'get_user_credit_model', 'range': [341, 343], 'children': []}]}]}]}]}
2025-01-08 10:28:58,662 - INFO - Completed main AST analysis flow
2025-01-08 10:28:58,662 - INFO - Successfully processed chunk
2025-01-08 10:28:59,061 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2716, 2747], 'children': [{'type': 'Decorator', 'name': '@v1_router.get', 'range': [2716, 2747], 'children': [{'type': 'CallExpression', 'name': '', 'range': [2720, 2746], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2722, 2724], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2727, 2733], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2729, 2733], 'children': [{'type': 'Literal', 'name': '"templates"', 'range': [2730, 2730], 'children': []}, {'type': 'Literal', 'name': '"graphs"', 'range': [2732, 2732], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [2736, 2743], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2738, 2743], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [2739, 2742], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2741, 2741], 'children': []}]}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'get_template', 'range': [2748, 2809], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2753, 2755], 'children': []}, {'type': 'Parameter', 'name': 'version', 'range': [2757, 2763], 'children': []}, {'type': 'ReturnType', 'name': '-> graph_db.GraphModel', 'range': [2766, 2771], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [2772, 2809], 'children': [{'type': 'VariableDeclaration', 'name': 'graph', 'range': [2773, 2787], 'children': [{'type': 'CallExpression', 'name': 'await graph_db.get_graph', 'range': [2775, 2787], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [2780, 2780], 'children': []}, {'type': 'Argument', 'name': 'version', 'range': [2782, 2782], 'children': []}, {'type': 'Argument', 'name': 'template', 'range': [2784, 2786], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [2789, 2805], 'children': [{'type': 'Condition', 'name': 'not graph', 'range': [2790, 2791], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [2792, 2805], 'children': [{'type': 'ThrowStatement', 'name': 'raise HTTPException', 'range': [2794, 2805], 'children': [{'type': 'CallExpression', 'name': '', 'range': [2796, 2805], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [2797, 2799], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [2801, 2804], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return graph', 'range': [2807, 2808], 'children': []}]}]}]}
2025-01-08 10:28:59,061 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:59,434 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [580, 608], 'children': [{'type': 'FunctionDecl', 'name': 'execute_graph_block', 'range': [610, 690], 'children': [{'type': 'Parameter', 'name': 'block_id', 'range': [613, 615], 'children': []}, {'type': 'Parameter', 'name': 'data', 'range': [617, 619], 'children': []}, {'type': 'ReturnType', 'name': 'CompletedBlockOutput', 'range': [621, 623], 'children': []}, {'type': 'Assignment', 'name': 'obj', 'range': [626, 638], 'children': [{'type': 'CallExpression', 'name': 'get_block', 'range': [634, 637], 'children': [{'type': 'Argument', 'name': 'block_id', 'range': [636, 636], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [639, 656], 'children': [{'type': 'Condition', 'name': 'not obj', 'range': [640, 641], 'children': []}, {'type': 'RaiseStatement', 'name': 'HTTPException', 'range': [644, 655], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [647, 649], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [651, 654], 'children': []}]}]}, {'type': 'Assignment', 'name': 'output', 'range': [658, 664], 'children': [{'type': 'CallExpression', 'name': 'defaultdict', 'range': [660, 663], 'children': [{'type': 'Argument', 'name': 'list', 'range': [662, 662], 'children': []}]}]}, {'type': 'ForStatement', 'name': '', 'range': [665, 687], 'children': [{'type': 'Iteration', 'name': 'name, data in obj.execute(data)', 'range': [666, 675], 'children': []}, {'type': 'Assignment', 'name': 'output[name].append(data)', 'range': [678, 686], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'output', 'range': [688, 689], 'children': []}]}]}
2025-01-08 10:28:59,434 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:00,848 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2913, 3063], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_schedule', 'range': [2943, 3063], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2948, 2958], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2950, 2958], 'children': [{'type': 'Type', 'name': 'str', 'range': [2952, 2953], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [2954, 2958], 'children': [{'type': 'FunctionCall', 'name': 'get_user_id', 'range': [2956, 2957], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'schedule', 'range': [2961, 2964], 'children': [{'type': 'TypeAnnotation', 'name': 'ScheduleCreationRequest', 'range': [2963, 2964], 'children': []}]}, {'type': 'ReturnType', 'name': 'scheduler.JobInfo', 'range': [2969, 2971], 'children': []}, {'type': 'Block', 'name': '', 'range': [2974, 3063], 'children': [{'type': 'VariableDeclaration', 'name': 'graph', 'range': [2974, 2988], 'children': [{'type': 'FunctionCall', 'name': 'graph_db.get_graph', 'range': [2977, 2988], 'children': [{'type': 'Argument', 'name': 'schedule.graph_id', 'range': [2981, 2983], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2985, 2987], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [2990, 3009], 'children': [{'type': 'Condition', 'name': 'not graph', 'range': [2991, 2992], 'children': []}, {'type': 'Block', 'name': '', 'range': [2994, 3009], 'children': [{'type': 'RaiseStatement', 'name': 'HTTPException', 'range': [2995, 3008], 'children': [{'type': 'Argument', 'name': 'status_code=404', 'range': [2999, 3001], 'children': []}, {'type': 'Argument', 'name': 'detail=f"Graph #{schedule.graph_id} not found."', 'range': [3003, 3006], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [3011, 3063], 'children': [{'type': 'FunctionCall', 'name': 'asyncio.to_thread', 'range': [3013, 3062], 'children': [{'type': 'Lambda', 'name': '', 'range': [3018, 3061], 'children': [{'type': 'FunctionCall', 'name': 'execution_scheduler_client.add_execution_schedule', 'range': [3024, 3060], 'children': [{'type': 'Argument', 'name': 'graph_id=schedule.graph_id', 'range': [3027, 3031], 'children': []}, {'type': 'Argument', 'name': 'graph_version=graph.version', 'range': [3034, 3038], 'children': []}, {'type': 'Argument', 'name': 'cron=schedule.cron', 'range': [3041, 3045], 'children': []}, {'type': 'Argument', 'name': 'input_data=schedule.input_data', 'range': [3048, 3052], 'children': []}, {'type': 'Argument', 'name': 'user_id=user_id', 'range': [3055, 3057], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:00,849 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:00,872 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2182, 2327], 'children': [{'type': 'FunctionDecl', 'name': 'execute_graph', 'range': [2212, 2261], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2216, 2218], 'children': []}, {'type': 'Parameter', 'name': 'node_input', 'range': [2221, 2228], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2231, 2241], 'children': []}, {'type': 'ReturnType', 'name': 'dict', 'range': [2247, 2252], 'children': []}]}, {'type': 'TryStatement', 'name': 'try', 'range': [2262, 2327], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [2264, 2292], 'children': [{'type': 'AssignmentExpression', 'name': 'graph_exec', 'range': [2265, 2282], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2284, 2292], 'children': []}]}, {'type': 'CatchClause', 'name': 'except', 'range': [2293, 2327], 'children': [{'type': 'Block', 'name': 'catchBlock', 'range': [2298, 2327], 'children': [{'type': 'AssignmentExpression', 'name': 'msg', 'range': [2299, 2315], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [2316, 2327], 'children': []}]}]}]}]}
2025-01-08 10:29:00,872 - INFO - Completed main AST analysis flow
2025-01-08 10:29:00,872 - INFO - Successfully processed chunk
2025-01-08 10:29:01,298 - INFO - Step 4 result: {'type': 'Program', 'name': 'stop_graph_run', 'range': [2328, 2459], 'children': [{'type': 'FunctionDecl', 'name': 'stop_graph_run', 'range': [2358, 2459], 'children': [{'type': 'Decorator', 'name': '@v1_router.post', 'range': [2328, 2357], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2334, 2336], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2339, 2343], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2346, 2353], 'children': []}]}, {'type': 'Parameter', 'name': 'graph_exec_id', 'range': [2363, 2365], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2367, 2377], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated[str, Depends(get_user_id)]', 'range': [2369, 2377], 'children': []}]}, {'type': 'ReturnType', 'name': 'Sequence[execution_db.ExecutionResult]', 'range': [2382, 2387], 'children': []}, {'type': 'Block', 'name': 'FunctionBody', 'range': [2389, 2459], 'children': [{'type': 'IfStatement', 'name': 'if not await graph_db.get_execution', 'range': [2390, 2417], 'children': [{'type': 'Condition', 'name': 'not await graph_db.get_execution(user_id=user_id, execution_id=graph_exec_id)', 'range': [2391, 2404], 'children': []}, {'type': 'Block', 'name': 'IfBody', 'range': [2405, 2417], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(404, detail=f"Agent execution #{graph_exec_id} not found")', 'range': [2407, 2416], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'await asyncio.to_thread(lambda: execution_manager_client().cancel_execution(graph_exec_id))', 'range': [2419, 2437], 'children': []}, {'type': 'ReturnStatement', 'name': 'return await execution_db.get_execution_results(graph_exec_id)', 'range': [2451, 2458], 'children': []}]}]}]}
2025-01-08 10:29:01,298 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:01,854 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [1950, 2181], 'children': [{'type': 'FunctionDecl', 'name': 'set_graph_active_version', 'range': [1980, 2146], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1985, 1987], 'children': []}, {'type': 'Parameter', 'name': 'request_body', 'range': [1990, 1992], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1995, 2005], 'children': []}, {'type': 'AssignmentExpression', 'name': 'new_active_version', 'range': [2011, 2015], 'children': []}, {'type': 'AssignmentExpression', 'name': 'new_active_graph', 'range': [2017, 2033], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [2035, 2048], 'children': []}, {'type': 'AssignmentExpression', 'name': 'current_active_graph', 'range': [2050, 2062], 'children': []}, {'type': 'AwaitExpression', 'name': '', 'range': [2100, 2112], 'children': []}, {'type': 'AwaitExpression', 'name': '', 'range': [2124, 2145], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [2147, 2180], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'get_credentials', 'range': [2065, 2086], 'children': [{'type': 'Parameter', 'name': 'credentials_id', 'range': [2068, 2070], 'children': []}, {'type': 'ReturnStatement', 'name': '', 'range': [2077, 2085], 'children': []}]}]}
2025-01-08 10:29:01,854 - INFO - Completed main AST analysis flow
2025-01-08 10:29:01,855 - INFO - Successfully processed chunk
2025-01-08 10:29:03,151 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2810, 2885], 'children': [{'type': 'FunctionDecl', 'name': 'create_new_template', 'range': [2842, 2885], 'children': [{'type': 'Parameter', 'name': 'create_graph', 'range': [2847, 2849], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2851, 2861], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2853, 2861], 'children': [{'type': 'Type', 'name': 'str', 'range': [2855, 2855], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [2857, 2861], 'children': [{'type': 'CallExpression', 'name': 'get_user_id', 'range': [2859, 2861], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'graph_db.GraphModel', 'range': [2866, 2868], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [2871, 2885], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [2871, 2885], 'children': [{'type': 'CallExpression', 'name': 'do_create_graph', 'range': [2873, 2884], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [2875, 2875], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [2877, 2879], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [2881, 2883], 'children': []}]}]}]}]}]}
2025-01-08 10:29:03,152 - INFO - Completed main AST analysis flow
2025-01-08 10:29:03,152 - INFO - Successfully processed chunk
2025-01-08 10:29:03,219 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2530, 2558], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [2533, 2558], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2536, 2538], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2541, 2545], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2548, 2555], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [2551, 2554], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2553, 2553], 'children': []}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_graph_run_node_execution_results', 'range': [2560, 2640], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2565, 2567], 'children': []}, {'type': 'Parameter', 'name': 'graph_exec_id', 'range': [2570, 2572], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2575, 2585], 'children': [{'type': 'CallExpression', 'name': 'Annotated', 'range': [2577, 2585], 'children': [{'type': 'Argument', 'name': 'str', 'range': [2579, 2579], 'children': []}, {'type': 'CallExpression', 'name': 'Depends', 'range': [2581, 2584], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [2583, 2583], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'Sequence', 'range': [2591, 2596], 'children': []}, {'type': 'Statement', 'name': 'graph', 'range': [2599, 2611], 'children': [{'type': 'CallExpression', 'name': 'get_graph', 'range': [2604, 2611], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [2606, 2606], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2608, 2610], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [2613, 2629], 'children': [{'type': 'Statement', 'name': 'raise', 'range': [2618, 2629], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [2619, 2629], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [2621, 2623], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [2625, 2628], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2632, 2639], 'children': [{'type': 'CallExpression', 'name': 'get_execution_results', 'range': [2636, 2639], 'children': [{'type': 'Argument', 'name': 'graph_exec_id', 'range': [2638, 2638], 'children': []}]}]}]}]}
2025-01-08 10:29:03,219 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:03,522 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [3064, 3146], 'children': [{'type': 'FunctionDecl', 'name': 'delete_schedule', 'range': [3094, 3146], 'children': [{'type': 'Parameter', 'name': 'schedule_id', 'range': [3098, 3100], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3100, 3100]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [3103, 3113], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3105, 3113], 'children': [{'type': 'Type', 'name': 'str', 'range': [3107, 3107]}, {'type': 'CallExpression', 'name': 'Depends', 'range': [3109, 3112], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [3111, 3111]}]}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [3119, 3124], 'children': [{'type': 'Type', 'name': 'Any', 'range': [3121, 3121]}, {'type': 'Type', 'name': 'Any', 'range': [3123, 3123]}]}, {'type': 'CallExpression', 'name': 'execution_scheduler_client', 'range': [3127, 3138], 'children': [{'type': 'CallExpression', 'name': 'delete_schedule', 'range': [3131, 3138], 'children': [{'type': 'Argument', 'name': 'schedule_id', 'range': [3133, 3133]}, {'type': 'KeywordArgument', 'name': 'user_id', 'range': [3135, 3137], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [3137, 3137]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [3140, 3145], 'children': [{'type': 'Dictionary', 'name': '', 'range': [3141, 3145], 'children': [{'type': 'KeyValuePair', 'name': 'id', 'range': [3142, 3144], 'children': [{'type': 'Identifier', 'name': 'schedule_id', 'range': [3144, 3144]}]}]}]}]}]}
2025-01-08 10:29:03,522 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:04,141 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [1419, 1539], 'children': [{'type': 'FunctionDeclaration', 'name': 'delete_graph', 'range': [1446, 1539], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1451, 1453], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1455, 1465], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [1457, 1465], 'children': [{'type': 'Type', 'name': 'str', 'range': [1459, 1460], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [1461, 1465], 'children': [{'type': 'FunctionCall', 'name': 'get_user_id', 'range': [1463, 1464], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'DeleteGraphResponse', 'range': [1469, 1470], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [1472, 1539], 'children': [{'type': 'IfStatement', 'name': '', 'range': [1473, 1489], 'children': [{'type': 'AssignmentExpression', 'name': 'active_version', 'range': [1474, 1487], 'children': [{'type': 'FunctionCall', 'name': 'graph_db.get_graph', 'range': [1477, 1487], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [1482, 1483], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [1485, 1486], 'children': []}]}]}]}, {'type': 'FunctionCall', 'name': 'on_graph_deactivate', 'range': [1514, 1521], 'children': [{'type': 'Argument', 'name': 'active_version', 'range': [1517, 1518], 'children': []}, {'type': 'Argument', 'name': 'get_credentials', 'range': [1519, 1520], 'children': []}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1523, 1539], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1524, 1538], 'children': [{'type': 'Property', 'name': 'version_counts', 'range': [1525, 1537], 'children': [{'type': 'FunctionCall', 'name': 'graph_db.delete_graph', 'range': [1527, 1537], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [1532, 1533], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [1535, 1536], 'children': []}]}]}]}]}]}]}, {'type': 'FunctionDeclaration', 'name': 'get_credentials', 'range': [1491, 1512], 'children': [{'type': 'Parameter', 'name': 'credentials_id', 'range': [1494, 1496], 'children': []}, {'type': 'ReturnType', 'name': 'Credentials | None', 'range': [1498, 1500], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [1502, 1512], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [1503, 1512], 'children': [{'type': 'FunctionCall', 'name': 'integration_creds_manager.get', 'range': [1504, 1511], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [1508, 1509], 'children': []}, {'type': 'Argument', 'name': 'credentials_id', 'range': [1510, 1511], 'children': []}]}]}]}]}]}
2025-01-08 10:29:04,141 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:04,151 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [424, 476], 'children': [{'type': 'FunctionDecl', 'name': 'get_or_create_user_route', 'range': [447, 476], 'children': [{'type': 'Parameter', 'name': 'user_data', 'range': [451, 458], 'children': [{'type': 'TypeAnnotation', 'name': 'dict', 'range': [453, 453], 'children': []}, {'type': 'DefaultValue', 'name': 'Depends', 'range': [455, 458], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [457, 457], 'children': []}]}]}, {'type': 'BlockStatement', 'name': '', 'range': [461, 476], 'children': [{'type': 'VariableDecl', 'name': 'user', 'range': [462, 468], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [463, 468], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [464, 468], 'children': [{'type': 'CallExpression', 'name': 'get_or_create_user', 'range': [465, 468], 'children': [{'type': 'Argument', 'name': 'user_data', 'range': [467, 467], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [470, 475], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [472, 475], 'children': [{'type': 'Identifier', 'name': 'user', 'range': [471, 471], 'children': []}, {'type': 'CallExpression', 'name': 'model_dump', 'range': [473, 475], 'children': []}]}]}]}]}]}
2025-01-08 10:29:04,151 - INFO - Completed main AST analysis flow
2025-01-08 10:29:04,151 - INFO - Successfully processed chunk
2025-01-08 10:29:06,787 - INFO - Step 4 result: {'type': 'Program', 'name': 'delete_api_key', 'range': [3654, 3809], 'children': [{'type': 'Decorator', 'name': 'v1_router.delete', 'range': [3654, 3695], 'children': [{'type': 'Argument', 'name': 'path', 'range': [3658, 3660], 'children': []}, {'type': 'Argument', 'name': 'response_model', 'range': [3663, 3675], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [3678, 3682], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [3685, 3692], 'children': []}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3697, 3701], 'children': [{'type': 'Argument', 'name': 'flag', 'range': [3699, 3700], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'delete_api_key', 'range': [3703, 3809], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [3708, 3710], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [3712, 3722], 'children': []}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [3725, 3730], 'children': []}, {'type': 'Docstring', 'name': 'Revoke an API key', 'range': [3733, 3735], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [3737, 3809], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [3740, 3747], 'children': []}, {'type': 'CatchClause', 'name': 'except APIKeyNotFoundError', 'range': [3749, 3764], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3753, 3763], 'children': []}]}, {'type': 'CatchClause', 'name': 'except APIKeyPermissionError', 'range': [3765, 3780], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3769, 3779], 'children': []}]}, {'type': 'CatchClause', 'name': 'except APIKeyError as e', 'range': [3781, 3809], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [3787, 3793], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3795, 3808], 'children': []}]}]}]}]}
2025-01-08 10:29:06,787 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:07,091 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [346, 423], 'children': [{'type': 'VariableDeclaration', 'name': 'v1_router', 'range': [346, 350], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [347, 347], 'children': []}, {'type': 'CallExpression', 'name': 'APIRouter', 'range': [348, 350], 'children': []}]}, {'type': 'CallExpression', 'name': 'include_router', 'range': [353, 381], 'children': [{'type': 'Identifier', 'name': 'backend.server.integrations.router.router', 'range': [358, 366], 'children': []}, {'type': 'Identifier', 'name': 'prefix', 'range': [369, 371], 'children': [{'type': 'Literal', 'name': '"/integrations"', 'range': [371, 371], 'children': []}]}, {'type': 'Identifier', 'name': 'tags', 'range': [374, 378], 'children': [{'type': 'ArrayExpression', 'name': '["integrations"]', 'range': [376, 378], 'children': [{'type': 'Literal', 'name': '"integrations"', 'range': [377, 377], 'children': []}]}]}]}, {'type': 'CallExpression', 'name': 'include_router', 'range': [384, 422], 'children': [{'type': 'Identifier', 'name': 'backend.server.routers.analytics.router', 'range': [389, 397], 'children': []}, {'type': 'Identifier', 'name': 'prefix', 'range': [400, 402], 'children': [{'type': 'Literal', 'name': '"/analytics"', 'range': [402, 402], 'children': []}]}, {'type': 'Identifier', 'name': 'tags', 'range': [405, 409], 'children': [{'type': 'ArrayExpression', 'name': '["analytics"]', 'range': [407, 409], 'children': [{'type': 'Literal', 'name': '"analytics"', 'range': [408, 408], 'children': []}]}]}, {'type': 'Identifier', 'name': 'dependencies', 'range': [412, 419], 'children': [{'type': 'ArrayExpression', 'name': '[Depends(auth_middleware)]', 'range': [414, 419], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [415, 419], 'children': [{'type': 'Identifier', 'name': 'auth_middleware', 'range': [417, 417], 'children': []}]}]}]}]}]}
2025-01-08 10:29:07,091 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:08,809 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2460, 2529], 'children': [{'type': 'Decorator', 'name': '@', 'range': [2460, 2460], 'children': []}, {'type': 'CallExpression', 'name': 'v1_router.get', 'range': [2461, 2488], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2466, 2468], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2471, 2475], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2478, 2485], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [2481, 2484], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2483, 2483], 'children': []}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_executions', 'range': [2490, 2529], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2495, 2505], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2497, 2505], 'children': [{'type': 'Type', 'name': 'str', 'range': [2499, 2499], 'children': []}, {'type': 'CallExpression', 'name': 'Depends', 'range': [2501, 2504], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [2503, 2503], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'list', 'range': [2511, 2516], 'children': [{'type': 'Type', 'name': 'graph_db.GraphExecution', 'range': [2513, 2516], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2519, 2528], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2520, 2520], 'children': [{'type': 'CallExpression', 'name': 'graph_db.get_executions', 'range': [2521, 2528], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [2525, 2527], 'children': []}]}]}]}]}]}
2025-01-08 10:29:08,809 - INFO - Completed main AST analysis flow
2025-01-08 10:29:08,810 - INFO - Successfully processed chunk
2025-01-08 10:29:09,359 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_api_keys', 'range': [3394, 3511], 'children': [{'type': 'Decorator', 'name': 'v1_router.get', 'range': [3394, 3435], 'children': [{'type': 'Argument', 'name': 'path', 'range': [3400, 3400], 'children': []}, {'type': 'Argument', 'name': 'response_model', 'range': [3403, 3415], 'children': [{'type': 'Type', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3405, 3415], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [3418, 3422], 'children': [{'type': 'List', 'name': '["api-keys"]', 'range': [3420, 3422], 'children': []}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [3425, 3432], 'children': [{'type': 'List', 'name': '[Depends(auth_middleware)]', 'range': [3427, 3432], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3437, 3441], 'children': [{'type': 'Argument', 'name': '"api-keys-enabled"', 'range': [3440, 3440], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'get_api_keys', 'range': [3443, 3511], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [3448, 3458], 'children': [{'type': 'Type', 'name': 'Annotated[str, Depends(get_user_id)]', 'range': [3450, 3458], 'children': []}]}, {'type': 'ReturnType', 'name': 'list[APIKeyWithoutHash]', 'range': [3463, 3466], 'children': []}, {'type': 'Docstring', 'name': '"List all API keys for the user"', 'range': [3469, 3471], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [3473, 3511], 'children': [{'type': 'ReturnStatement', 'name': 'return await list_user_api_keys(user_id)', 'range': [3476, 3481], 'children': []}, {'type': 'CatchClause', 'name': 'except APIKeyError as e', 'range': [3483, 3511], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Failed to list API keys: {str(e)}")', 'range': [3489, 3495], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3497, 3510], 'children': []}]}]}]}]}
2025-01-08 10:29:09,360 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:09,506 - INFO - Step 2 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [0, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [3, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'defaultdict', 'range': [7, 9], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [11, 21], 'children': [{'type': 'ImportSpecifier', 'name': 'TYPE_CHECKING', 'range': [12, 14], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Annotated', 'range': [16, 16], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Any', 'range': [18, 18], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Sequence', 'range': [20, 20], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [23, 25], 'children': [{'type': 'ImportSpecifier', 'name': 'pydantic', 'range': [23, 24], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [26, 34], 'children': [{'type': 'ImportSpecifier', 'name': 'auth_middleware', 'range': [27, 33], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [35, 43], 'children': [{'type': 'ImportSpecifier', 'name': 'feature_flag', 'range': [36, 42], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [44, 52], 'children': [{'type': 'ImportSpecifier', 'name': 'thread_cached', 'range': [45, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 61], 'children': [{'type': 'ImportSpecifier', 'name': 'APIRouter', 'range': [54, 56], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Depends', 'range': [58, 58], 'children': []}, {'type': 'ImportSpecifier', 'name': 'HTTPException', 'range': [60, 60], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [62, 68], 'children': [{'type': 'ImportSpecifier', 'name': 'Optional', 'range': [63, 65], 'children': []}, {'type': 'ImportSpecifier', 'name': 'TypedDict', 'range': [67, 67], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [70, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'block', 'range': [71, 75], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [77, 85], 'children': [{'type': 'ImportSpecifier', 'name': 'router', 'range': [78, 84], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [86, 94], 'children': [{'type': 'ImportSpecifier', 'name': 'analytics', 'range': [87, 93], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [95, 103], 'children': [{'type': 'ImportSpecifier', 'name': 'execution_db', 'range': [96, 102], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [104, 112], 'children': [{'type': 'ImportSpecifier', 'name': 'graph_db', 'range': [105, 111], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [113, 153], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyError', 'range': [122, 122], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyNotFoundError', 'range': [125, 125], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyPermissionError', 'range': [128, 128], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWithoutHash', 'range': [131, 131], 'children': []}, {'type': 'ImportSpecifier', 'name': 'generate_api_key', 'range': [134, 134], 'children': []}, {'type': 'ImportSpecifier', 'name': 'get_api_key_by_id', 'range': [137, 137], 'children': []}, {'type': 'ImportSpecifier', 'name': 'list_user_api_keys', 'range': [140, 140], 'children': []}, {'type': 'ImportSpecifier', 'name': 'revoke_api_key', 'range': [143, 143], 'children': []}, {'type': 'ImportSpecifier', 'name': 'suspend_api_key', 'range': [146, 146], 'children': []}, {'type': 'ImportSpecifier', 'name': 'update_api_key_permissions', 'range': [149, 149], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [154, 164], 'children': [{'type': 'ImportSpecifier', 'name': 'BlockInput', 'range': [155, 161], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CompletedBlockOutput', 'range': [163, 163], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [165, 175], 'children': [{'type': 'ImportSpecifier', 'name': 'get_block_costs', 'range': [166, 172], 'children': []}, {'type': 'ImportSpecifier', 'name': 'get_user_credit_model', 'range': [174, 174], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [176, 184], 'children': [{'type': 'ImportSpecifier', 'name': 'get_or_create_user', 'range': [177, 183], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [185, 195], 'children': [{'type': 'ImportSpecifier', 'name': 'ExecutionManager', 'range': [186, 190], 'children': []}, {'type': 'ImportSpecifier', 'name': 'ExecutionScheduler', 'range': [192, 192], 'children': []}, {'type': 'ImportSpecifier', 'name': 'scheduler', 'range': [194, 194], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [196, 204], 'children': [{'type': 'ImportSpecifier', 'name': 'IntegrationCredentialsManager', 'range': [197, 203], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [205, 223], 'children': [{'type': 'ImportSpecifier', 'name': 'on_graph_activate', 'range': [206, 216], 'children': []}, {'type': 'ImportSpecifier', 'name': 'on_graph_deactivate', 'range': [218, 218], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [224, 249], 'children': [{'type': 'ImportSpecifier', 'name': 'CreateAPIKeyRequest', 'range': [225, 233], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CreateAPIKeyResponse', 'range': [235, 235], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CreateGraph', 'range': [237, 239], 'children': []}, {'type': 'ImportSpecifier', 'name': 'SetGraphActiveVersion', 'range': [241, 242], 'children': []}, {'type': 'ImportSpecifier', 'name': 'UpdatePermissionsRequest', 'range': [244, 246], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [250, 258], 'children': [{'type': 'ImportSpecifier', 'name': 'get_user_id', 'range': [251, 257], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [259, 267], 'children': [{'type': 'ImportSpecifier', 'name': 'get_service_client', 'range': [260, 266], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [268, 276], 'children': [{'type': 'ImportSpecifier', 'name': 'Settings', 'range': [269, 275], 'children': []}]}]}
2025-01-08 10:29:09,506 - INFO - Starting Step 3: AST simplification
2025-01-08 10:29:10,101 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [691, 776], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [694, 708], 'children': [{'type': 'Argument', 'name': 'path', 'range': [696, 698], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [700, 707], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [703, 706], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [705, 705], 'children': []}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_user_credits', 'range': [710, 776], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [715, 725], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [717, 725], 'children': [{'type': 'Type', 'name': 'str', 'range': [719, 719], 'children': []}, {'type': 'CallExpression', 'name': 'Depends', 'range': [721, 724], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [723, 723], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [731, 736], 'children': [{'type': 'Type', 'name': 'str', 'range': [733, 733], 'children': []}, {'type': 'Type', 'name': 'int', 'range': [735, 735], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [759, 775], 'children': [{'type': 'Dictionary', 'name': 'credits', 'range': [760, 775], 'children': [{'type': 'KeyValuePair', 'name': 'credits', 'range': [761, 774], 'children': [{'type': 'CallExpression', 'name': 'max', 'range': [763, 774], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [765, 771], 'children': [{'type': 'CallExpression', 'name': 'get_or_refill_credit', 'range': [768, 771], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [770, 770], 'children': []}]}]}, {'type': 'Literal', 'name': '0', 'range': [773, 773], 'children': []}]}]}]}]}]}]}
2025-01-08 10:29:10,101 - INFO - Completed main AST analysis flow
2025-01-08 10:29:10,102 - INFO - Successfully processed chunk
2025-01-08 10:29:10,415 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [477, 579], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_graph_blocks', 'range': [502, 579], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [502, 517], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [502, 505], 'children': []}, {'type': 'FunctionName', 'name': 'get_graph_blocks', 'range': [503, 517], 'children': []}, {'type': 'ReturnType', 'name': '', 'range': [506, 517], 'children': [{'type': 'Keyword', 'name': '->', 'range': [506, 508], 'children': []}, {'type': 'Type', 'name': 'Sequence', 'range': [508, 517], 'children': [{'type': 'GenericType', 'name': 'dict', 'range': [510, 515], 'children': [{'type': 'Type', 'name': 'Any', 'range': [512, 515], 'children': []}]}]}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [518, 579], 'children': [{'type': 'VariableDeclaration', 'name': 'blocks', 'range': [519, 541], 'children': [{'type': 'Assignment', 'name': '=', 'range': [520, 541], 'children': [{'type': 'ListComprehension', 'name': '', 'range': [521, 541], 'children': [{'type': 'Expression', 'name': 'block', 'range': [522, 540], 'children': [{'type': 'FunctionCall', 'name': 'block', 'range': [522, 540], 'children': [{'type': 'FunctionName', 'name': 'block', 'range': [522, 527], 'children': []}]}]}, {'type': 'ForLoop', 'name': '', 'range': [525, 540], 'children': [{'type': 'Variable', 'name': 'block', 'range': [526, 531], 'children': []}, {'type': 'Expression', 'name': 'backend.data.block.get_blocks().values()', 'range': [528, 540], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'costs', 'range': [543, 548], 'children': [{'type': 'Assignment', 'name': '=', 'range': [544, 548], 'children': [{'type': 'FunctionCall', 'name': 'get_block_costs', 'range': [545, 548], 'children': [{'type': 'FunctionName', 'name': 'get_block_costs', 'range': [545, 548], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [549, 579], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [549, 555], 'children': []}, {'type': 'ListComprehension', 'name': '', 'range': [550, 579], 'children': [{'type': 'Expression', 'name': '', 'range': [551, 573], 'children': [{'type': 'Dictionary', 'name': '', 'range': [551, 573], 'children': [{'type': 'KeyValuePair', 'name': '', 'range': [552, 562], 'children': [{'type': 'Expression', 'name': '*b.to_dict()', 'range': [552, 562], 'children': []}]}, {'type': 'KeyValuePair', 'name': '', 'range': [560, 572], 'children': [{'type': 'Key', 'name': 'costs', 'range': [560, 565], 'children': []}, {'type': 'Expression', 'name': 'costs.get(b.id, [])', 'range': [562, 572], 'children': []}]}]}]}, {'type': 'ForLoop', 'name': '', 'range': [574, 579], 'children': [{'type': 'Variable', 'name': 'b', 'range': [575, 576], 'children': []}, {'type': 'Expression', 'name': 'blocks', 'range': [577, 579], 'children': []}]}]}]}]}]}]}
2025-01-08 10:29:10,415 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:10,971 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [3147, 3233], 'children': [{'type': 'FunctionDecl', 'name': 'get_execution_schedules', 'range': [3177, 3233], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [3181, 3191], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3183, 3191], 'children': [{'type': 'Type', 'name': 'str', 'range': [3185, 3186], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [3187, 3191], 'children': [{'type': 'CallExpression', 'name': 'get_user_id', 'range': [3189, 3190], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'graph_id', 'range': [3194, 3200], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3196, 3196], 'children': []}, {'type': 'OptionalType', 'name': 'None', 'range': [3198, 3200], 'children': []}]}, {'type': 'ReturnType', 'name': 'list', 'range': [3206, 3211], 'children': [{'type': 'Type', 'name': 'scheduler.JobInfo', 'range': [3208, 3211], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3214, 3233], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [3214, 3233], 'children': [{'type': 'CallExpression', 'name': 'execution_scheduler_client', 'range': [3215, 3217], 'children': []}, {'type': 'MethodCall', 'name': 'get_execution_schedules', 'range': [3219, 3232], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [3222, 3224], 'children': []}, {'type': 'Argument', 'name': 'graph_id', 'range': [3227, 3229], 'children': []}]}]}]}]}]}
2025-01-08 10:29:10,971 - INFO - Completed main AST analysis flow
2025-01-08 10:29:10,972 - INFO - Successfully processed chunk
2025-01-08 10:29:11,434 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2641, 2672], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [2641, 2672], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2647, 2649], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2652, 2658], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2654, 2658], 'children': [{'type': 'Literal', 'name': '"graphs"', 'range': [2655, 2655], 'children': []}, {'type': 'Literal', 'name': '"templates"', 'range': [2657, 2657], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [2661, 2668], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2663, 2668], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [2664, 2667], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2666, 2666], 'children': []}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_templates', 'range': [2673, 2715], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2678, 2688], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2680, 2688], 'children': [{'type': 'Type', 'name': 'str', 'range': [2682, 2682], 'children': []}, {'type': 'CallExpression', 'name': 'Depends', 'range': [2684, 2687], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [2686, 2686], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'Sequence', 'range': [2693, 2698], 'children': [{'type': 'Type', 'name': 'graph_db.GraphModel', 'range': [2695, 2697], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2701, 2714], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2702, 2714], 'children': [{'type': 'CallExpression', 'name': 'graph_db.get_graphs', 'range': [2703, 2714], 'children': [{'type': 'Argument', 'name': 'filter_by', 'range': [2707, 2709], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2711, 2713], 'children': []}]}]}]}]}]}
2025-01-08 10:29:11,434 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:12,494 - INFO - Step 2 result: {'type': 'Program', 'name': 'update_permissions', 'range': [3966, 4132], 'children': [{'type': 'FunctionDeclaration', 'name': 'update_permissions', 'range': [3966, 4132], 'children': [{'type': 'Decorator', 'name': 'v1_router.put', 'range': [3966, 4007], 'children': [{'type': 'CallExpression', 'name': '', 'range': [3966, 4007], 'children': [{'type': 'MemberExpression', 'name': 'v1_router.put', 'range': [3966, 3969], 'children': []}, {'type': 'StringLiteral', 'name': '"/api-keys/{key_id}/permissions"', 'range': [3972, 3972], 'children': []}, {'type': 'Keyword', 'name': 'response_model', 'range': [3975, 3975], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [3976, 3976], 'children': [{'type': 'TypeExpression', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3977, 3987], 'children': []}]}, {'type': 'Keyword', 'name': 'tags', 'range': [3990, 3990], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [3991, 3991], 'children': [{'type': 'ArrayExpression', 'name': '["api-keys"]', 'range': [3992, 3994], 'children': []}]}, {'type': 'Keyword', 'name': 'dependencies', 'range': [3997, 3997], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [3998, 3998], 'children': [{'type': 'ArrayExpression', 'name': '[Depends(auth_middleware)]', 'range': [3999, 4004], 'children': []}]}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [4009, 4013], 'children': [{'type': 'CallExpression', 'name': '', 'range': [4009, 4013], 'children': [{'type': 'StringLiteral', 'name': '"api-keys-enabled"', 'range': [4012, 4012], 'children': []}]}]}, {'type': 'FunctionSignature', 'name': 'update_permissions', 'range': [4015, 4050], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [4020, 4022], 'children': [{'type': 'TypeAnnotation', 'name': ': str', 'range': [4021, 4022], 'children': []}]}, {'type': 'Parameter', 'name': 'request', 'range': [4025, 4027], 'children': [{'type': 'TypeAnnotation', 'name': ': UpdatePermissionsRequest', 'range': [4026, 4027], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [4030, 4040], 'children': [{'type': 'TypeAnnotation', 'name': ': Annotated[str, Depends(get_user_id)]', 'range': [4031, 4040], 'children': []}]}, {'type': 'ReturnTypeAnnotation', 'name': '-> Optional[APIKeyWithoutHash]', 'range': [4044, 4050], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [4051, 4132], 'children': [{'type': 'TryStatement', 'name': '', 'range': [4056, 4132], 'children': [{'type': 'Block', 'name': '', 'range': [4058, 4071], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [4059, 4070], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [4060, 4070], 'children': [{'type': 'CallExpression', 'name': 'update_api_key_permissions', 'range': [4061, 4070], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [4063, 4063], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [4065, 4065], 'children': []}, {'type': 'MemberExpression', 'name': 'request.permissions', 'range': [4067, 4069], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyNotFoundError', 'range': [4072, 4087], 'children': [{'type': 'Block', 'name': '', 'range': [4074, 4087], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [4076, 4086], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4077, 4086], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4079, 4079], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [4080, 4080], 'children': [{'type': 'NumericLiteral', 'name': '404', 'range': [4081, 4081], 'children': []}]}, {'type': 'Keyword', 'name': 'detail', 'range': [4083, 4083], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [4084, 4084], 'children': [{'type': 'StringLiteral', 'name': '"API key not found"', 'range': [4085, 4085], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyPermissionError', 'range': [4088, 4103], 'children': [{'type': 'Block', 'name': '', 'range': [4090, 4103], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [4092, 4102], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4093, 4102], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4095, 4095], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [4096, 4096], 'children': [{'type': 'NumericLiteral', 'name': '403', 'range': [4097, 4097], 'children': []}]}, {'type': 'Keyword', 'name': 'detail', 'range': [4099, 4099], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [4100, 4100], 'children': [{'type': 'StringLiteral', 'name': '"Permission denied"', 'range': [4101, 4101], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyError', 'range': [4104, 4132], 'children': [{'type': 'Block', 'name': '', 'range': [4108, 4132], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [4110, 4116], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [4110, 4116], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to update API key permissions: {str(e)}"', 'range': [4114, 4115], 'children': []}]}]}, {'type': 'RaiseStatement', 'name': '', 'range': [4118, 4131], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4119, 4131], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4121, 4121], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [4122, 4122], 'children': [{'type': 'NumericLiteral', 'name': '400', 'range': [4123, 4123], 'children': []}]}, {'type': 'Keyword', 'name': 'detail', 'range': [4125, 4125], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [4126, 4126], 'children': [{'type': 'CallExpression', 'name': 'str', 'range': [4127, 4130], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [4129, 4129], 'children': []}]}]}]}]}]}]}]}]}]}]}
2025-01-08 10:29:12,494 - INFO - Starting Step 3: AST simplification
2025-01-08 10:29:12,850 - INFO - Step 3 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [3810, 3852], 'children': [{'type': 'Decorator', 'name': '@v1_router.post', 'range': [3810, 3852], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [3813, 3851], 'children': [{'type': 'StringLiteral', 'name': '"/api-keys/{key_id}/suspend"', 'range': [3816, 3816], 'children': []}, {'type': 'KeywordArgument', 'name': 'response_model', 'range': [3819, 3831], 'children': [{'type': 'TypeExpression', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3821, 3831], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'tags', 'range': [3834, 3838], 'children': [{'type': 'ListLiteral', 'name': '["api-keys"]', 'range': [3836, 3838], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'dependencies', 'range': [3841, 3848], 'children': [{'type': 'ListLiteral', 'name': '[Depends(auth_middleware)]', 'range': [3843, 3848], 'children': []}]}]}]}, {'type': 'Decorator', 'name': '@feature_flag', 'range': [3853, 3857], 'children': [{'type': 'CallExpression', 'name': 'feature_flag', 'range': [3854, 3857], 'children': [{'type': 'StringLiteral', 'name': '"api-keys-enabled"', 'range': [3856, 3856], 'children': []}]}]}, {'type': 'FunctionDeclaration', 'name': 'suspend_key', 'range': [3859, 3965], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3859, 3859], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3860, 3860], 'children': []}, {'type': 'Identifier', 'name': 'suspend_key', 'range': [3861, 3861], 'children': []}, {'type': 'ParameterList', 'name': 'key_id: str, user_id: Annotated[str, Depends(get_user_id)]', 'range': [3862, 3879], 'children': [{'type': 'Parameter', 'name': 'key_id: str', 'range': [3864, 3866], 'children': []}, {'type': 'Parameter', 'name': 'user_id: Annotated[str, Depends(get_user_id)]', 'range': [3868, 3878], 'children': []}]}, {'type': 'ReturnType', 'name': '-> Optional[APIKeyWithoutHash]', 'range': [3881, 3886], 'children': []}, {'type': 'Docstring', 'name': '"Suspend an API key"', 'range': [3889, 3891], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [3893, 3965], 'children': [{'type': 'Block', 'name': 'try block', 'range': [3895, 3904], 'children': [{'type': 'ReturnStatement', 'name': 'return await suspend_api_key(key_id, user_id)', 'range': [3896, 3903], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except APIKeyNotFoundError', 'range': [3905, 3920], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3908, 3920], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=404, detail="API key not found")', 'range': [3909, 3919], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except APIKeyPermissionError', 'range': [3921, 3936], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3924, 3936], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=403, detail="Permission denied")', 'range': [3925, 3935], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except APIKeyError as e', 'range': [3937, 3965], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3942, 3965], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Failed to suspend API key: {str(e)}")', 'range': [3943, 3949], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3951, 3964], 'children': []}]}]}]}]}]}
2025-01-08 10:29:12,850 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:14,337 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [580, 690], 'children': [{'type': 'FunctionDecl', 'name': 'execute_graph_block', 'range': [610, 690], 'children': [{'type': 'Parameter', 'name': 'block_id', 'range': [613, 615], 'children': []}, {'type': 'Parameter', 'name': 'data', 'range': [617, 619], 'children': []}, {'type': 'ReturnType', 'name': 'CompletedBlockOutput', 'range': [621, 623], 'children': []}, {'type': 'Assignment', 'name': 'obj', 'range': [626, 638], 'children': [{'type': 'CallExpression', 'name': 'get_block', 'range': [634, 637], 'children': [{'type': 'Argument', 'name': 'block_id', 'range': [636, 636], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [639, 656], 'children': [{'type': 'Condition', 'name': 'not obj', 'range': [640, 641], 'children': []}, {'type': 'RaiseStatement', 'name': 'HTTPException', 'range': [644, 655], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [647, 649], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [651, 654], 'children': []}]}]}, {'type': 'Assignment', 'name': 'output', 'range': [658, 664], 'children': [{'type': 'CallExpression', 'name': 'defaultdict', 'range': [660, 663], 'children': [{'type': 'Argument', 'name': 'list', 'range': [662, 662], 'children': []}]}]}, {'type': 'ForStatement', 'name': '', 'range': [665, 687], 'children': [{'type': 'Iteration', 'name': 'name, data in obj.execute(data)', 'range': [666, 675], 'children': []}, {'type': 'Assignment', 'name': 'output[name].append(data)', 'range': [678, 686], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'output', 'range': [688, 689], 'children': []}]}]}
2025-01-08 10:29:14,337 - INFO - Completed main AST analysis flow
2025-01-08 10:29:14,337 - INFO - Successfully processed chunk
2025-01-08 10:29:14,917 - INFO - Step 5 result: {'type': 'Program', 'name': 'stop_graph_run', 'range': [2328, 2459], 'children': [{'type': 'FunctionDecl', 'name': 'stop_graph_run', 'range': [2358, 2459], 'children': [{'type': 'Decorator', 'name': '@v1_router.post', 'range': [2328, 2357], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2334, 2336], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2339, 2343], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2346, 2353], 'children': []}]}, {'type': 'Parameter', 'name': 'graph_exec_id', 'range': [2363, 2365], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2367, 2377], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated[str, Depends(get_user_id)]', 'range': [2369, 2377], 'children': []}]}, {'type': 'ReturnType', 'name': 'Sequence[execution_db.ExecutionResult]', 'range': [2382, 2387], 'children': []}, {'type': 'Block', 'name': 'FunctionBody', 'range': [2389, 2459], 'children': [{'type': 'IfStatement', 'name': 'if not await graph_db.get_execution', 'range': [2390, 2417], 'children': [{'type': 'Condition', 'name': 'not await graph_db.get_execution(user_id=user_id, execution_id=graph_exec_id)', 'range': [2391, 2404], 'children': []}, {'type': 'Block', 'name': 'IfBody', 'range': [2405, 2417], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(404, detail=f"Agent execution #{graph_exec_id} not found")', 'range': [2407, 2416], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'await asyncio.to_thread(lambda: execution_manager_client().cancel_execution(graph_exec_id))', 'range': [2419, 2437], 'children': []}, {'type': 'ReturnStatement', 'name': 'return await execution_db.get_execution_results(graph_exec_id)', 'range': [2451, 2458], 'children': []}]}]}]}
2025-01-08 10:29:14,918 - INFO - Completed main AST analysis flow
2025-01-08 10:29:14,918 - INFO - Successfully processed chunk
2025-01-08 10:29:15,201 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [857, 1003], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_graph', 'range': [914, 1003], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [914, 959], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [914, 919], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [915, 918], 'children': []}, {'type': 'Identifier', 'name': 'get_graph', 'range': [916, 925], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [917, 953], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [919, 922], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [920, 921], 'children': [{'type': 'Type', 'name': 'str', 'range': [921, 924], 'children': []}]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [924, 935], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [925, 934], 'children': [{'type': 'Type', 'name': 'Annotated', 'range': [926, 935], 'children': [{'type': 'Type', 'name': 'str', 'range': [928, 931], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [930, 933], 'children': [{'type': 'FunctionCall', 'name': 'get_user_id', 'range': [932, 933], 'children': []}]}]}]}]}, {'type': 'Parameter', 'name': 'version', 'range': [937, 943], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [938, 942], 'children': [{'type': 'Type', 'name': 'int', 'range': [939, 942], 'children': []}, {'type': 'Type', 'name': 'None', 'range': [941, 944], 'children': []}]}]}, {'type': 'Parameter', 'name': 'hide_credentials', 'range': [946, 950], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [947, 949], 'children': [{'type': 'Type', 'name': 'bool', 'range': [948, 951], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [954, 959], 'children': [{'type': 'Type', 'name': 'graph_db.GraphModel', 'range': [956, 959], 'children': []}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [960, 1003], 'children': [{'type': 'VariableDeclaration', 'name': 'graph', 'range': [961, 981], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [963, 968], 'children': []}, {'type': 'FunctionCall', 'name': 'graph_db.get_graph', 'range': [964, 981], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [969, 970], 'children': []}, {'type': 'Argument', 'name': 'version', 'range': [971, 972], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [973, 975], 'children': []}, {'type': 'Argument', 'name': 'for_export', 'range': [977, 979], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [983, 1000], 'children': [{'type': 'Condition', 'name': '', 'range': [983, 986], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [984, 985], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [985, 986], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [987, 1000], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [988, 999], 'children': [{'type': 'FunctionCall', 'name': 'HTTPException', 'range': [989, 999], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [991, 993], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [995, 998], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1001, 1003], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1002, 1003], 'children': []}]}]}]}]}
2025-01-08 10:29:15,201 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:17,400 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [3064, 3146], 'children': [{'type': 'FunctionDecl', 'name': 'delete_schedule', 'range': [3094, 3146], 'children': [{'type': 'Parameter', 'name': 'schedule_id', 'range': [3098, 3100], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3100, 3100]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [3103, 3113], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3105, 3113], 'children': [{'type': 'Type', 'name': 'str', 'range': [3107, 3107]}, {'type': 'CallExpression', 'name': 'Depends', 'range': [3109, 3112], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [3111, 3111]}]}]}]}, {'type': 'ReturnType', 'name': 'dict', 'range': [3119, 3124], 'children': [{'type': 'Type', 'name': 'Any', 'range': [3121, 3121]}, {'type': 'Type', 'name': 'Any', 'range': [3123, 3123]}]}, {'type': 'CallExpression', 'name': 'execution_scheduler_client', 'range': [3127, 3138], 'children': [{'type': 'CallExpression', 'name': 'delete_schedule', 'range': [3131, 3138], 'children': [{'type': 'Argument', 'name': 'schedule_id', 'range': [3133, 3133]}, {'type': 'KeywordArgument', 'name': 'user_id', 'range': [3135, 3137], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [3137, 3137]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [3140, 3145], 'children': [{'type': 'Dictionary', 'name': '', 'range': [3141, 3145], 'children': [{'type': 'KeyValuePair', 'name': 'id', 'range': [3142, 3144], 'children': [{'type': 'Identifier', 'name': 'schedule_id', 'range': [3144, 3144]}]}]}]}]}]}
2025-01-08 10:29:17,400 - INFO - Completed main AST analysis flow
2025-01-08 10:29:17,401 - INFO - Successfully processed chunk
2025-01-08 10:29:17,549 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [1004, 1132], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_graph_all_versions', 'range': [1066, 1132], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [1066, 1096], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1066, 1071], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1067, 1070], 'children': []}, {'type': 'Identifier', 'name': 'get_graph_all_versions', 'range': [1068, 1089], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [1069, 1086], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1071, 1074], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [1072, 1073], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [1073, 1076], 'children': []}]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1075, 1085], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [1076, 1085], 'children': [{'type': 'Identifier', 'name': 'Annotated', 'range': [1077, 1086], 'children': []}, {'type': 'TypeArgumentList', 'name': '', 'range': [1078, 1085], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [1079, 1082], 'children': []}, {'type': 'Identifier', 'name': 'Depends', 'range': [1081, 1088], 'children': []}]}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [1088, 1096], 'children': [{'type': 'Identifier', 'name': 'Sequence', 'range': [1090, 1097], 'children': []}, {'type': 'TypeArgumentList', 'name': '', 'range': [1091, 1096], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1092, 1099], 'children': []}, {'type': 'Identifier', 'name': 'GraphModel', 'range': [1094, 1103], 'children': []}]}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [1097, 1132], 'children': [{'type': 'VariableDeclaration', 'name': 'graphs', 'range': [1098, 1111], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [1100, 1105], 'children': []}, {'type': 'Identifier', 'name': 'graph_db', 'range': [1101, 1108], 'children': []}, {'type': 'Identifier', 'name': 'get_graph_all_versions', 'range': [1103, 1126], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1104, 1110], 'children': [{'type': 'Identifier', 'name': 'graph_id', 'range': [1105, 1112], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1107, 1114], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [1112, 1129], 'children': [{'type': 'Condition', 'name': '', 'range': [1113, 1115], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [1113, 1117], 'children': [{'type': 'Identifier', 'name': 'graphs', 'range': [1114, 1120], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [1115, 1129], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1117, 1128], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1118, 1131], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1119, 1127], 'children': [{'type': 'AssignmentExpression', 'name': 'status_code', 'range': [1120, 1123], 'children': [{'type': 'NumericLiteral', 'name': '404', 'range': [1122, 1125], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'detail', 'range': [1124, 1127], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [1126, 1127], 'children': [{'type': 'TemplateElement', 'name': 'Graph #{graph_id} not found.', 'range': [1127, 1128], 'children': []}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1130, 1132], 'children': [{'type': 'Identifier', 'name': 'graphs', 'range': [1131, 1132], 'children': []}]}]}]}]}
2025-01-08 10:29:17,549 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:17,952 - INFO - Step 3 result: {'type': 'Program', 'name': 'create_api_key', 'range': [3234, 3393], 'children': [{'type': 'FunctionDeclaration', 'name': 'create_api_key', 'range': [3277, 3393], 'children': [{'type': 'Decorator', 'name': 'v1_router.post', 'range': [3234, 3276], 'children': [{'type': 'FunctionCall', 'name': 'post', 'range': [3237, 3275], 'children': [{'type': 'Argument', 'name': '"/api-keys"', 'range': [3240, 3240], 'children': []}, {'type': 'Argument', 'name': 'response_model=list[CreateAPIKeyResponse]|dict[str, str]', 'range': [3243, 3255], 'children': []}, {'type': 'Argument', 'name': 'tags=["api-keys"]', 'range': [3258, 3262], 'children': []}, {'type': 'Argument', 'name': 'dependencies=[Depends(auth_middleware)]', 'range': [3265, 3272], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3277, 3282], 'children': [{'type': 'FunctionCall', 'name': 'feature_flag', 'range': [3278, 3281], 'children': [{'type': 'Argument', 'name': '"api-keys-enabled"', 'range': [3280, 3280], 'children': []}]}]}, {'type': 'FunctionSignature', 'name': 'create_api_key', 'range': [3283, 3308], 'children': [{'type': 'Parameter', 'name': 'request: CreateAPIKeyRequest', 'range': [3288, 3291], 'children': []}, {'type': 'Parameter', 'name': 'user_id: Annotated[str, Depends(get_user_id)]', 'range': [3292, 3303], 'children': []}, {'type': 'ReturnType', 'name': '-> CreateAPIKeyResponse', 'range': [3305, 3307], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3309, 3393], 'children': [{'type': 'TryStatement', 'name': '', 'range': [3314, 3364], 'children': [{'type': 'Block', 'name': '', 'range': [3315, 3364], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key, plain_text = await generate_api_key', 'range': [3317, 3321], 'children': [{'type': 'FunctionCall', 'name': 'generate_api_key', 'range': [3321, 3351], 'children': [{'type': 'Argument', 'name': 'name=request.name', 'range': [3325, 3329], 'children': []}, {'type': 'Argument', 'name': 'user_id=user_id', 'range': [3332, 3334], 'children': []}, {'type': 'Argument', 'name': 'permissions=request.permissions', 'range': [3337, 3341], 'children': []}, {'type': 'Argument', 'name': 'description=request.description', 'range': [3344, 3348], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return CreateAPIKeyResponse(api_key=api_key, plain_text_key=plain_text)', 'range': [3353, 3364], 'children': [{'type': 'FunctionCall', 'name': 'CreateAPIKeyResponse', 'range': [3355, 3363], 'children': [{'type': 'Argument', 'name': 'api_key=api_key', 'range': [3356, 3358], 'children': []}, {'type': 'Argument', 'name': 'plain_text_key=plain_text', 'range': [3360, 3362], 'children': []}]}]}]}]}, {'type': 'CatchStatement', 'name': '', 'range': [3365, 3393], 'children': [{'type': 'Block', 'name': '', 'range': [3369, 3393], 'children': [{'type': 'FunctionCall', 'name': 'logger.error', 'range': [3371, 3377], 'children': [{'type': 'Argument', 'name': 'f"Failed to create API key: {str(e)}"', 'range': [3375, 3376], 'children': []}]}, {'type': 'ThrowStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3379, 3393], 'children': [{'type': 'FunctionCall', 'name': 'HTTPException', 'range': [3381, 3392], 'children': [{'type': 'Argument', 'name': 'status_code=400', 'range': [3382, 3384], 'children': []}, {'type': 'Argument', 'name': 'detail=str(e)', 'range': [3386, 3391], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:17,952 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:21,186 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2716, 2747], 'children': [{'type': 'Decorator', 'name': '@v1_router.get', 'range': [2716, 2747], 'children': [{'type': 'CallExpression', 'name': '', 'range': [2720, 2746], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2722, 2724], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2727, 2733], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2729, 2733], 'children': [{'type': 'Literal', 'name': '"templates"', 'range': [2730, 2730], 'children': []}, {'type': 'Literal', 'name': '"graphs"', 'range': [2732, 2732], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [2736, 2743], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2738, 2743], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [2739, 2742], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2741, 2741], 'children': []}]}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_template', 'range': [2748, 2809], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2753, 2755], 'children': []}, {'type': 'Parameter', 'name': 'version', 'range': [2757, 2763], 'children': []}, {'type': 'ReturnType', 'name': '-> graph_db.GraphModel', 'range': [2766, 2771], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [2772, 2809], 'children': [{'type': 'VariableDeclaration', 'name': 'graph', 'range': [2773, 2787], 'children': [{'type': 'CallExpression', 'name': 'await graph_db.get_graph', 'range': [2775, 2787], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [2780, 2780], 'children': []}, {'type': 'Argument', 'name': 'version', 'range': [2782, 2782], 'children': []}, {'type': 'Argument', 'name': 'template', 'range': [2784, 2786], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [2789, 2805], 'children': [{'type': 'Condition', 'name': 'not graph', 'range': [2790, 2791], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [2792, 2805], 'children': [{'type': 'ThrowStatement', 'name': 'raise HTTPException', 'range': [2794, 2805], 'children': [{'type': 'CallExpression', 'name': '', 'range': [2796, 2805], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [2797, 2799], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [2801, 2804], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return graph', 'range': [2807, 2808], 'children': []}]}]}]}
2025-01-08 10:29:21,186 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:21,516 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [3512, 3653], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_api_key', 'range': [3555, 3653], 'children': [{'type': 'Decorator', 'name': 'feature_flag', 'range': [3555, 3559], 'children': [{'type': 'Argument', 'name': 'api-keys-enabled', 'range': [3558, 3559], 'children': []}]}, {'type': 'FunctionSignature', 'name': '', 'range': [3561, 3585], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3561, 3561], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3562, 3562], 'children': []}, {'type': 'FunctionName', 'name': 'get_api_key', 'range': [3563, 3563], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [3564, 3581], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [3566, 3568], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3568, 3568], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [3570, 3580], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3572, 3580], 'children': [{'type': 'TypeArgument', 'name': 'str', 'range': [3574, 3574], 'children': []}, {'type': 'TypeArgument', 'name': 'Depends', 'range': [3576, 3580], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [3578, 3578], 'children': []}]}]}]}]}, {'type': 'ReturnType', 'name': 'APIKeyWithoutHash', 'range': [3585, 3585], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3587, 3653], 'children': [{'type': 'Docstring', 'name': 'Get a specific API key', 'range': [3588, 3590], 'children': []}, {'type': 'TryStatement', 'name': '', 'range': [3592, 3653], 'children': [{'type': 'TryBlock', 'name': '', 'range': [3592, 3624], 'children': [{'type': 'Assignment', 'name': 'api_key', 'range': [3595, 3603], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [3597, 3597], 'children': [{'type': 'FunctionCall', 'name': 'get_api_key_by_id', 'range': [3598, 3603], 'children': [{'type': 'Argument', 'name': 'key_id', 'range': [3600, 3600], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [3602, 3602], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [3605, 3621], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [3606, 3607], 'children': []}, {'type': 'IfBlock', 'name': '', 'range': [3608, 3621], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3610, 3620], 'children': [{'type': 'FunctionCall', 'name': 'HTTPException', 'range': [3611, 3620], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [3613, 3615], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [3617, 3619], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [3622, 3623], 'children': [{'type': 'Variable', 'name': 'api_key', 'range': [3623, 3623], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': '', 'range': [3625, 3653], 'children': [{'type': 'Exception', 'name': 'APIKeyError', 'range': [3626, 3626], 'children': []}, {'type': 'AsClause', 'name': 'e', 'range': [3627, 3628], 'children': []}, {'type': 'ExceptBlockBody', 'name': '', 'range': [3629, 3653], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [3631, 3637], 'children': [{'type': 'FunctionCall', 'name': 'logger.error', 'range': [3631, 3637], 'children': [{'type': 'Argument', 'name': 'Failed to get API key: {str(e)}', 'range': [3635, 3636], 'children': []}]}]}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [3639, 3652], 'children': [{'type': 'FunctionCall', 'name': 'HTTPException', 'range': [3640, 3652], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [3642, 3644], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [3646, 3648], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:29:21,516 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:22,458 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2913, 3063], 'children': [{'type': 'FunctionDecl', 'name': 'create_schedule', 'range': [2943, 3063], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2948, 2958], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2950, 2958], 'children': [{'type': 'Type', 'name': 'str', 'range': [2952, 2953], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [2954, 2958], 'children': [{'type': 'CallExpression', 'name': 'get_user_id', 'range': [2956, 2957], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'schedule', 'range': [2961, 2964], 'children': [{'type': 'TypeAnnotation', 'name': 'ScheduleCreationRequest', 'range': [2963, 2964], 'children': []}]}, {'type': 'ReturnType', 'name': 'scheduler.JobInfo', 'range': [2969, 2971], 'children': []}, {'type': 'Block', 'name': '', 'range': [2974, 3063], 'children': [{'type': 'VariableDecl', 'name': 'graph', 'range': [2974, 2988], 'children': [{'type': 'CallExpression', 'name': 'graph_db.get_graph', 'range': [2977, 2988], 'children': [{'type': 'Argument', 'name': 'schedule.graph_id', 'range': [2981, 2983], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2985, 2987], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [2990, 3009], 'children': [{'type': 'Condition', 'name': 'not graph', 'range': [2991, 2992], 'children': []}, {'type': 'Block', 'name': '', 'range': [2994, 3009], 'children': [{'type': 'RaiseStatement', 'name': 'HTTPException', 'range': [2995, 3008], 'children': [{'type': 'Argument', 'name': 'status_code=404', 'range': [2999, 3001], 'children': []}, {'type': 'Argument', 'name': 'detail=f"Graph #{schedule.graph_id} not found."', 'range': [3003, 3006], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [3011, 3063], 'children': [{'type': 'CallExpression', 'name': 'asyncio.to_thread', 'range': [3013, 3062], 'children': [{'type': 'Lambda', 'name': '', 'range': [3018, 3061], 'children': [{'type': 'CallExpression', 'name': 'execution_scheduler_client.add_execution_schedule', 'range': [3024, 3060], 'children': [{'type': 'Argument', 'name': 'graph_id=schedule.graph_id', 'range': [3027, 3031], 'children': []}, {'type': 'Argument', 'name': 'graph_version=graph.version', 'range': [3034, 3038], 'children': []}, {'type': 'Argument', 'name': 'cron=schedule.cron', 'range': [3041, 3045], 'children': []}, {'type': 'Argument', 'name': 'input_data=schedule.input_data', 'range': [3048, 3052], 'children': []}, {'type': 'Argument', 'name': 'user_id=user_id', 'range': [3055, 3057], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:22,459 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:22,627 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2530, 2640], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [2533, 2558], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2536, 2538], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2541, 2545], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [2548, 2555], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [2551, 2554], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2553, 2553], 'children': []}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_graph_run_node_execution_results', 'range': [2560, 2640], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2565, 2567], 'children': []}, {'type': 'Parameter', 'name': 'graph_exec_id', 'range': [2570, 2572], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [2575, 2585], 'children': [{'type': 'CallExpression', 'name': 'Annotated', 'range': [2577, 2585], 'children': [{'type': 'Argument', 'name': 'str', 'range': [2579, 2579], 'children': []}, {'type': 'CallExpression', 'name': 'Depends', 'range': [2581, 2584], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [2583, 2583], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'Sequence', 'range': [2591, 2596], 'children': []}, {'type': 'Statement', 'name': 'graph', 'range': [2599, 2611], 'children': [{'type': 'CallExpression', 'name': 'get_graph', 'range': [2604, 2611], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [2606, 2606], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2608, 2610], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [2613, 2629], 'children': [{'type': 'Statement', 'name': 'raise', 'range': [2618, 2629], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [2619, 2629], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [2621, 2623], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [2625, 2628], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2632, 2639], 'children': [{'type': 'CallExpression', 'name': 'get_execution_results', 'range': [2636, 2639], 'children': [{'type': 'Argument', 'name': 'graph_exec_id', 'range': [2638, 2638], 'children': []}]}]}]}]}
2025-01-08 10:29:22,627 - INFO - Completed main AST analysis flow
2025-01-08 10:29:22,627 - INFO - Successfully processed chunk
2025-01-08 10:29:23,502 - INFO - Step 5 result: {'type': 'Program', 'name': 'delete_api_key', 'range': [3654, 3809], 'children': [{'type': 'Decorator', 'name': 'v1_router.delete', 'range': [3654, 3695], 'children': [{'type': 'Argument', 'name': 'path', 'range': [3658, 3660], 'children': []}, {'type': 'Argument', 'name': 'response_model', 'range': [3663, 3675], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [3678, 3682], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [3685, 3692], 'children': []}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3697, 3701], 'children': [{'type': 'Argument', 'name': 'flag', 'range': [3699, 3700], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'delete_api_key', 'range': [3703, 3809], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [3708, 3710], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [3712, 3722], 'children': []}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [3725, 3730], 'children': []}, {'type': 'Docstring', 'name': 'Revoke an API key', 'range': [3733, 3735], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [3737, 3809], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [3740, 3747], 'children': []}, {'type': 'CatchClause', 'name': 'except APIKeyNotFoundError', 'range': [3749, 3764], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3753, 3763], 'children': []}]}, {'type': 'CatchClause', 'name': 'except APIKeyPermissionError', 'range': [3765, 3780], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3769, 3779], 'children': []}]}, {'type': 'CatchClause', 'name': 'except APIKeyError as e', 'range': [3781, 3809], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [3787, 3793], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException', 'range': [3795, 3808], 'children': []}]}]}]}]}
2025-01-08 10:29:23,502 - INFO - Completed main AST analysis flow
2025-01-08 10:29:23,503 - INFO - Successfully processed chunk
2025-01-08 10:29:23,565 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [346, 423], 'children': [{'type': 'VariableDeclaration', 'name': 'v1_router', 'range': [346, 350], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [347, 347], 'children': []}, {'type': 'CallExpression', 'name': 'APIRouter', 'range': [348, 350], 'children': []}]}, {'type': 'CallExpression', 'name': 'include_router', 'range': [353, 381], 'children': [{'type': 'Identifier', 'name': 'backend.server.integrations.router.router', 'range': [358, 366], 'children': []}, {'type': 'Identifier', 'name': 'prefix', 'range': [369, 371], 'children': [{'type': 'Literal', 'name': '"/integrations"', 'range': [371, 371], 'children': []}]}, {'type': 'Identifier', 'name': 'tags', 'range': [374, 378], 'children': [{'type': 'ArrayExpression', 'name': '["integrations"]', 'range': [376, 378], 'children': [{'type': 'Literal', 'name': '"integrations"', 'range': [377, 377], 'children': []}]}]}]}, {'type': 'CallExpression', 'name': 'include_router', 'range': [384, 422], 'children': [{'type': 'Identifier', 'name': 'backend.server.routers.analytics.router', 'range': [389, 397], 'children': []}, {'type': 'Identifier', 'name': 'prefix', 'range': [400, 402], 'children': [{'type': 'Literal', 'name': '"/analytics"', 'range': [402, 402], 'children': []}]}, {'type': 'Identifier', 'name': 'tags', 'range': [405, 409], 'children': [{'type': 'ArrayExpression', 'name': '["analytics"]', 'range': [407, 409], 'children': [{'type': 'Literal', 'name': '"analytics"', 'range': [408, 408], 'children': []}]}]}, {'type': 'Identifier', 'name': 'dependencies', 'range': [412, 419], 'children': [{'type': 'ArrayExpression', 'name': '[Depends(auth_middleware)]', 'range': [414, 419], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [415, 419], 'children': [{'type': 'Identifier', 'name': 'auth_middleware', 'range': [417, 417], 'children': []}]}]}]}]}]}
2025-01-08 10:29:23,565 - INFO - Completed main AST analysis flow
2025-01-08 10:29:23,566 - INFO - Successfully processed chunk
2025-01-08 10:29:26,536 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_api_keys', 'range': [3394, 3511], 'children': [{'type': 'Decorator', 'name': 'v1_router.get', 'range': [3394, 3435], 'children': [{'type': 'Argument', 'name': 'path', 'range': [3400, 3400], 'children': []}, {'type': 'Argument', 'name': 'response_model', 'range': [3403, 3415], 'children': [{'type': 'Type', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3405, 3415], 'children': []}]}, {'type': 'Argument', 'name': 'tags', 'range': [3418, 3422], 'children': [{'type': 'List', 'name': '["api-keys"]', 'range': [3420, 3422], 'children': []}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [3425, 3432], 'children': [{'type': 'List', 'name': '[Depends(auth_middleware)]', 'range': [3427, 3432], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3437, 3441], 'children': [{'type': 'Argument', 'name': '"api-keys-enabled"', 'range': [3440, 3440], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'get_api_keys', 'range': [3443, 3511], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [3448, 3458], 'children': [{'type': 'Type', 'name': 'Annotated[str, Depends(get_user_id)]', 'range': [3450, 3458], 'children': []}]}, {'type': 'ReturnType', 'name': 'list[APIKeyWithoutHash]', 'range': [3463, 3466], 'children': []}, {'type': 'Docstring', 'name': '"List all API keys for the user"', 'range': [3469, 3471], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [3473, 3511], 'children': [{'type': 'ReturnStatement', 'name': 'return await list_user_api_keys(user_id)', 'range': [3476, 3481], 'children': []}, {'type': 'CatchClause', 'name': 'except APIKeyError as e', 'range': [3483, 3511], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Failed to list API keys: {str(e)}")', 'range': [3489, 3495], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3497, 3510], 'children': []}]}]}]}]}
2025-01-08 10:29:26,536 - INFO - Completed main AST analysis flow
2025-01-08 10:29:26,536 - INFO - Successfully processed chunk
2025-01-08 10:29:27,479 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [1419, 1539], 'children': [{'type': 'FunctionDecl', 'name': 'delete_graph', 'range': [1446, 1539], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1451, 1453], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1455, 1465], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [1457, 1465], 'children': [{'type': 'Type', 'name': 'str', 'range': [1459, 1460], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [1461, 1465], 'children': [{'type': 'CallExpression', 'name': 'get_user_id', 'range': [1463, 1464], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'DeleteGraphResponse', 'range': [1469, 1470], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [1472, 1539], 'children': [{'type': 'IfStatement', 'name': '', 'range': [1473, 1489], 'children': [{'type': 'AssignmentExpression', 'name': 'active_version', 'range': [1474, 1487], 'children': [{'type': 'CallExpression', 'name': 'graph_db.get_graph', 'range': [1477, 1487], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [1482, 1483], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [1485, 1486], 'children': []}]}]}]}, {'type': 'CallExpression', 'name': 'on_graph_deactivate', 'range': [1514, 1521], 'children': [{'type': 'Argument', 'name': 'active_version', 'range': [1517, 1518], 'children': []}, {'type': 'Argument', 'name': 'get_credentials', 'range': [1519, 1520], 'children': []}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1523, 1539], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1524, 1538], 'children': [{'type': 'Property', 'name': 'version_counts', 'range': [1525, 1537], 'children': [{'type': 'CallExpression', 'name': 'graph_db.delete_graph', 'range': [1527, 1537], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [1532, 1533], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [1535, 1536], 'children': []}]}]}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_credentials', 'range': [1491, 1512], 'children': [{'type': 'Parameter', 'name': 'credentials_id', 'range': [1494, 1496], 'children': []}, {'type': 'ReturnType', 'name': 'Credentials | None', 'range': [1498, 1500], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [1502, 1512], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [1503, 1512], 'children': [{'type': 'CallExpression', 'name': 'integration_creds_manager.get', 'range': [1504, 1511], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [1508, 1509], 'children': []}, {'type': 'Argument', 'name': 'credentials_id', 'range': [1510, 1511], 'children': []}]}]}]}]}]}
2025-01-08 10:29:27,480 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:29,633 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2641, 2715], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [2641, 2672], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2647, 2649], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2652, 2658], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2654, 2658], 'children': [{'type': 'Literal', 'name': '"graphs"', 'range': [2655, 2655], 'children': []}, {'type': 'Literal', 'name': '"templates"', 'range': [2657, 2657], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [2661, 2668], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2663, 2668], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [2664, 2667], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2666, 2666], 'children': []}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_templates', 'range': [2673, 2715], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2678, 2688], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2680, 2688], 'children': [{'type': 'Type', 'name': 'str', 'range': [2682, 2682], 'children': []}, {'type': 'CallExpression', 'name': 'Depends', 'range': [2684, 2687], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [2686, 2686], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'Sequence', 'range': [2693, 2698], 'children': [{'type': 'Type', 'name': 'graph_db.GraphModel', 'range': [2695, 2697], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [2701, 2714], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [2702, 2714], 'children': [{'type': 'CallExpression', 'name': 'graph_db.get_graphs', 'range': [2703, 2714], 'children': [{'type': 'Argument', 'name': 'filter_by', 'range': [2707, 2709], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2711, 2713], 'children': []}]}]}]}]}]}
2025-01-08 10:29:29,633 - INFO - Completed main AST analysis flow
2025-01-08 10:29:29,633 - INFO - Successfully processed chunk
2025-01-08 10:29:30,187 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [1540, 1949], 'children': [{'type': 'FunctionDeclaration', 'name': 'update_graph', 'range': [1599, 1949], 'children': [{'type': 'Decorator', 'name': '@v1_router.put', 'range': [1540, 1565], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1546, 1548], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [1550, 1554], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [1556, 1563], 'children': []}]}, {'type': 'Decorator', 'name': '@v1_router.put', 'range': [1567, 1597], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1573, 1575], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [1578, 1584], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [1587, 1594], 'children': []}]}, {'type': 'FunctionSignature', 'name': 'update_graph', 'range': [1599, 1635], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1604, 1606], 'children': []}, {'type': 'Parameter', 'name': 'graph', 'range': [1609, 1614], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1616, 1627], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [1636, 1949], 'children': [{'type': 'Comment', 'name': '# Sanity check', 'range': [1637, 1640], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1641, 1663], 'children': [{'type': 'Condition', 'name': '', 'range': [1642, 1651], 'children': []}, {'type': 'Body', 'name': '', 'range': [1652, 1663], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1654, 1662], 'children': []}]}]}, {'type': 'Comment', 'name': '# Determine new version', 'range': [1665, 1669], 'children': []}, {'type': 'VariableDeclaration', 'name': 'existing_versions', 'range': [1670, 1683], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1684, 1699], 'children': [{'type': 'Condition', 'name': '', 'range': [1685, 1686], 'children': []}, {'type': 'Body', 'name': '', 'range': [1687, 1699], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1689, 1698], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'latest_version_number', 'range': [1700, 1712], 'children': []}, {'type': 'Assignment', 'name': 'graph.version', 'range': [1713, 1720], 'children': []}, {'type': 'VariableDeclaration', 'name': 'latest_version_graph', 'range': [1722, 1741], 'children': []}, {'type': 'VariableDeclaration', 'name': 'current_active_version', 'range': [1742, 1760], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1761, 1783], 'children': [{'type': 'Condition', 'name': '', 'range': [1762, 1769], 'children': []}, {'type': 'Body', 'name': '', 'range': [1770, 1783], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1772, 1782], 'children': []}]}]}, {'type': 'Assignment', 'name': 'graph.is_active', 'range': [1784, 1792], 'children': []}, {'type': 'Assignment', 'name': 'graph', 'range': [1793, 1803], 'children': []}, {'type': 'MethodCall', 'name': 'graph.reassign_ids', 'range': [1804, 1812], 'children': []}, {'type': 'VariableDeclaration', 'name': 'new_graph_version', 'range': [1814, 1827], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1829, 1918], 'children': [{'type': 'Condition', 'name': '', 'range': [1830, 1833], 'children': []}, {'type': 'Body', 'name': '', 'range': [1834, 1918], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_credentials', 'range': [1836, 1857], 'children': []}, {'type': 'Comment', 'name': '# Handle activation of the new graph first to ensure continuity', 'range': [1859, 1870], 'children': []}, {'type': 'Assignment', 'name': 'new_graph_version', 'range': [1871, 1886], 'children': []}, {'type': 'Comment', 'name': '# Ensure new version is the only active version', 'range': [1887, 1896], 'children': []}, {'type': 'MethodCall', 'name': 'graph_db.set_graph_active_version', 'range': [1897, 1917], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [1919, 1946], 'children': [{'type': 'Condition', 'name': '', 'range': [1920, 1921], 'children': []}, {'type': 'Body', 'name': '', 'range': [1922, 1946], 'children': [{'type': 'Comment', 'name': '# Handle deactivation of the previously active version', 'range': [1923, 1931], 'children': []}, {'type': 'MethodCall', 'name': 'on_graph_deactivate', 'range': [1932, 1945], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1947, 1949], 'children': []}]}]}]}
2025-01-08 10:29:30,187 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:36,004 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [477, 579], 'children': [{'type': 'FunctionDecl', 'name': 'get_graph_blocks', 'range': [502, 579], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [502, 517], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [502, 505], 'children': []}, {'type': 'Identifier', 'name': 'get_graph_blocks', 'range': [503, 517], 'children': []}, {'type': 'ReturnType', 'name': '', 'range': [506, 517], 'children': [{'type': 'Keyword', 'name': '->', 'range': [506, 508], 'children': []}, {'type': 'Type', 'name': 'Sequence', 'range': [508, 517], 'children': [{'type': 'GenericType', 'name': 'dict', 'range': [510, 515], 'children': [{'type': 'Type', 'name': 'Any', 'range': [512, 515], 'children': []}]}]}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [518, 579], 'children': [{'type': 'VariableDecl', 'name': 'blocks', 'range': [519, 541], 'children': [{'type': 'Assignment', 'name': '=', 'range': [520, 541], 'children': [{'type': 'ListComprehension', 'name': '', 'range': [521, 541], 'children': [{'type': 'Expression', 'name': 'block', 'range': [522, 540], 'children': [{'type': 'CallExpression', 'name': 'block', 'range': [522, 540], 'children': [{'type': 'Identifier', 'name': 'block', 'range': [522, 527], 'children': []}]}]}, {'type': 'ForStatement', 'name': '', 'range': [525, 540], 'children': [{'type': 'Variable', 'name': 'block', 'range': [526, 531], 'children': []}, {'type': 'Expression', 'name': 'backend.data.block.get_blocks().values()', 'range': [528, 540], 'children': []}]}]}]}]}, {'type': 'VariableDecl', 'name': 'costs', 'range': [543, 548], 'children': [{'type': 'Assignment', 'name': '=', 'range': [544, 548], 'children': [{'type': 'CallExpression', 'name': 'get_block_costs', 'range': [545, 548], 'children': [{'type': 'Identifier', 'name': 'get_block_costs', 'range': [545, 548], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [549, 579], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [549, 555], 'children': []}, {'type': 'ListComprehension', 'name': '', 'range': [550, 579], 'children': [{'type': 'Expression', 'name': '', 'range': [551, 573], 'children': [{'type': 'Dictionary', 'name': '', 'range': [551, 573], 'children': [{'type': 'KeyValuePair', 'name': '', 'range': [552, 562], 'children': [{'type': 'Expression', 'name': '*b.to_dict()', 'range': [552, 562], 'children': []}]}, {'type': 'KeyValuePair', 'name': '', 'range': [560, 572], 'children': [{'type': 'Key', 'name': 'costs', 'range': [560, 565], 'children': []}, {'type': 'Expression', 'name': 'costs.get(b.id, [])', 'range': [562, 572], 'children': []}]}]}]}, {'type': 'ForStatement', 'name': '', 'range': [574, 579], 'children': [{'type': 'Variable', 'name': 'b', 'range': [575, 576], 'children': []}, {'type': 'Expression', 'name': 'blocks', 'range': [577, 579], 'children': []}]}]}]}]}]}]}
2025-01-08 10:29:36,005 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:39,419 - INFO - Step 4 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [3810, 3852], 'children': [{'type': 'Decorator', 'name': '@v1_router.post', 'range': [3810, 3852], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [3813, 3851], 'children': [{'type': 'Literal', 'name': '"/api-keys/{key_id}/suspend"', 'range': [3816, 3816], 'children': []}, {'type': 'KeywordArgument', 'name': 'response_model', 'range': [3819, 3831], 'children': [{'type': 'TypeExpression', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3821, 3831], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'tags', 'range': [3834, 3838], 'children': [{'type': 'Literal', 'name': '["api-keys"]', 'range': [3836, 3838], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'dependencies', 'range': [3841, 3848], 'children': [{'type': 'Literal', 'name': '[Depends(auth_middleware)]', 'range': [3843, 3848], 'children': []}]}]}]}, {'type': 'Decorator', 'name': '@feature_flag', 'range': [3853, 3857], 'children': [{'type': 'CallExpression', 'name': 'feature_flag', 'range': [3854, 3857], 'children': [{'type': 'Literal', 'name': '"api-keys-enabled"', 'range': [3856, 3856], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': 'suspend_key', 'range': [3859, 3965], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3859, 3859], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3860, 3860], 'children': []}, {'type': 'Identifier', 'name': 'suspend_key', 'range': [3861, 3861], 'children': []}, {'type': 'ParameterList', 'name': 'key_id: str, user_id: Annotated[str, Depends(get_user_id)]', 'range': [3862, 3879], 'children': [{'type': 'Parameter', 'name': 'key_id: str', 'range': [3864, 3866], 'children': []}, {'type': 'Parameter', 'name': 'user_id: Annotated[str, Depends(get_user_id)]', 'range': [3868, 3878], 'children': []}]}, {'type': 'ReturnType', 'name': '-> Optional[APIKeyWithoutHash]', 'range': [3881, 3886], 'children': []}, {'type': 'Docstring', 'name': '"Suspend an API key"', 'range': [3889, 3891], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [3893, 3965], 'children': [{'type': 'Block', 'name': 'try block', 'range': [3895, 3904], 'children': [{'type': 'ReturnStatement', 'name': 'return await suspend_api_key(key_id, user_id)', 'range': [3896, 3903], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except APIKeyNotFoundError', 'range': [3905, 3920], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3908, 3920], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=404, detail="API key not found")', 'range': [3909, 3919], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except APIKeyPermissionError', 'range': [3921, 3936], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3924, 3936], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=403, detail="Permission denied")', 'range': [3925, 3935], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except APIKeyError as e', 'range': [3937, 3965], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3942, 3965], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Failed to suspend API key: {str(e)}")', 'range': [3943, 3949], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3951, 3964], 'children': []}]}]}]}]}]}
2025-01-08 10:29:39,420 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:41,510 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.get', 'range': [2716, 2809], 'children': [{'type': 'Decorator', 'name': '@v1_router.get', 'range': [2716, 2747], 'children': [{'type': 'CallExpression', 'name': '', 'range': [2720, 2746], 'children': [{'type': 'Argument', 'name': 'path', 'range': [2722, 2724], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [2727, 2733], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2729, 2733], 'children': [{'type': 'Literal', 'name': '"templates"', 'range': [2730, 2730], 'children': []}, {'type': 'Literal', 'name': '"graphs"', 'range': [2732, 2732], 'children': []}]}]}, {'type': 'Argument', 'name': 'dependencies', 'range': [2736, 2743], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [2738, 2743], 'children': [{'type': 'CallExpression', 'name': 'Depends', 'range': [2739, 2742], 'children': [{'type': 'Argument', 'name': 'auth_middleware', 'range': [2741, 2741], 'children': []}]}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_template', 'range': [2748, 2809], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [2753, 2755], 'children': []}, {'type': 'Parameter', 'name': 'version', 'range': [2757, 2763], 'children': []}, {'type': 'ReturnType', 'name': '-> graph_db.GraphModel', 'range': [2766, 2771], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [2772, 2809], 'children': [{'type': 'VariableDeclaration', 'name': 'graph', 'range': [2773, 2787], 'children': [{'type': 'CallExpression', 'name': 'await graph_db.get_graph', 'range': [2775, 2787], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [2780, 2780], 'children': []}, {'type': 'Argument', 'name': 'version', 'range': [2782, 2782], 'children': []}, {'type': 'Argument', 'name': 'template', 'range': [2784, 2786], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [2789, 2805], 'children': [{'type': 'Condition', 'name': 'not graph', 'range': [2790, 2791], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [2792, 2805], 'children': [{'type': 'ThrowStatement', 'name': 'raise HTTPException', 'range': [2794, 2805], 'children': [{'type': 'CallExpression', 'name': '', 'range': [2796, 2805], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [2797, 2799], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [2801, 2804], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return graph', 'range': [2807, 2808], 'children': []}]}]}]}
2025-01-08 10:29:41,511 - INFO - Completed main AST analysis flow
2025-01-08 10:29:41,512 - INFO - Successfully processed chunk
2025-01-08 10:29:43,180 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [857, 1003], 'children': [{'type': 'FunctionDecl', 'name': 'get_graph', 'range': [914, 1003], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [914, 959], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [914, 919], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [915, 918], 'children': []}, {'type': 'Identifier', 'name': 'get_graph', 'range': [916, 925], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [917, 953], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [919, 922], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [920, 921], 'children': [{'type': 'Type', 'name': 'str', 'range': [921, 924], 'children': []}]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [924, 935], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [925, 934], 'children': [{'type': 'Type', 'name': 'Annotated', 'range': [926, 935], 'children': [{'type': 'Type', 'name': 'str', 'range': [928, 931], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [930, 933], 'children': [{'type': 'CallExpression', 'name': 'get_user_id', 'range': [932, 933], 'children': []}]}]}]}]}, {'type': 'Parameter', 'name': 'version', 'range': [937, 943], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [938, 942], 'children': [{'type': 'Type', 'name': 'int', 'range': [939, 942], 'children': []}, {'type': 'Type', 'name': 'None', 'range': [941, 944], 'children': []}]}]}, {'type': 'Parameter', 'name': 'hide_credentials', 'range': [946, 950], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [947, 949], 'children': [{'type': 'Type', 'name': 'bool', 'range': [948, 951], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [954, 959], 'children': [{'type': 'Type', 'name': 'graph_db.GraphModel', 'range': [956, 959], 'children': []}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [960, 1003], 'children': [{'type': 'VariableDeclaration', 'name': 'graph', 'range': [961, 981], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [963, 968], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.get_graph', 'range': [964, 981], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [969, 970], 'children': []}, {'type': 'Argument', 'name': 'version', 'range': [971, 972], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [973, 975], 'children': []}, {'type': 'Argument', 'name': 'for_export', 'range': [977, 979], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [983, 1000], 'children': [{'type': 'Condition', 'name': '', 'range': [983, 986], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [984, 985], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [985, 986], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [987, 1000], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [988, 999], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [989, 999], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [991, 993], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [995, 998], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1001, 1003], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1002, 1003], 'children': []}]}]}]}]}
2025-01-08 10:29:43,181 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:43,834 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [2913, 3063], 'children': [{'type': 'FunctionDecl', 'name': 'create_schedule', 'range': [2943, 3063], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [2948, 2958], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [2950, 2958], 'children': [{'type': 'Type', 'name': 'str', 'range': [2952, 2953], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [2954, 2958], 'children': [{'type': 'CallExpression', 'name': 'get_user_id', 'range': [2956, 2957], 'children': []}]}]}]}, {'type': 'Parameter', 'name': 'schedule', 'range': [2961, 2964], 'children': [{'type': 'TypeAnnotation', 'name': 'ScheduleCreationRequest', 'range': [2963, 2964], 'children': []}]}, {'type': 'ReturnType', 'name': 'scheduler.JobInfo', 'range': [2969, 2971], 'children': []}, {'type': 'Block', 'name': '', 'range': [2974, 3063], 'children': [{'type': 'VariableDecl', 'name': 'graph', 'range': [2974, 2988], 'children': [{'type': 'CallExpression', 'name': 'graph_db.get_graph', 'range': [2977, 2988], 'children': [{'type': 'Argument', 'name': 'schedule.graph_id', 'range': [2981, 2983], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [2985, 2987], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [2990, 3009], 'children': [{'type': 'Condition', 'name': 'not graph', 'range': [2991, 2992], 'children': []}, {'type': 'Block', 'name': '', 'range': [2994, 3009], 'children': [{'type': 'RaiseStatement', 'name': 'HTTPException', 'range': [2995, 3008], 'children': [{'type': 'Argument', 'name': 'status_code=404', 'range': [2999, 3001], 'children': []}, {'type': 'Argument', 'name': 'detail=f"Graph #{schedule.graph_id} not found."', 'range': [3003, 3006], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [3011, 3063], 'children': [{'type': 'CallExpression', 'name': 'asyncio.to_thread', 'range': [3013, 3062], 'children': [{'type': 'Lambda', 'name': '', 'range': [3018, 3061], 'children': [{'type': 'CallExpression', 'name': 'execution_scheduler_client.add_execution_schedule', 'range': [3024, 3060], 'children': [{'type': 'Argument', 'name': 'graph_id=schedule.graph_id', 'range': [3027, 3031], 'children': []}, {'type': 'Argument', 'name': 'graph_version=graph.version', 'range': [3034, 3038], 'children': []}, {'type': 'Argument', 'name': 'cron=schedule.cron', 'range': [3041, 3045], 'children': []}, {'type': 'Argument', 'name': 'input_data=schedule.input_data', 'range': [3048, 3052], 'children': []}, {'type': 'Argument', 'name': 'user_id=user_id', 'range': [3055, 3057], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:43,834 - INFO - Completed main AST analysis flow
2025-01-08 10:29:43,835 - INFO - Successfully processed chunk
2025-01-08 10:29:44,087 - INFO - Step 4 result: {'type': 'Program', 'name': 'create_api_key', 'range': [3234, 3393], 'children': [{'type': 'FunctionDecl', 'name': 'create_api_key', 'range': [3277, 3393], 'children': [{'type': 'Decorator', 'name': 'v1_router.post', 'range': [3234, 3276], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [3237, 3275], 'children': [{'type': 'Literal', 'name': '"/api-keys"', 'range': [3240, 3240], 'children': []}, {'type': 'Literal', 'name': 'response_model=list[CreateAPIKeyResponse]|dict[str, str]', 'range': [3243, 3255], 'children': []}, {'type': 'Literal', 'name': 'tags=["api-keys"]', 'range': [3258, 3262], 'children': []}, {'type': 'Literal', 'name': 'dependencies=[Depends(auth_middleware)]', 'range': [3265, 3272], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3277, 3282], 'children': [{'type': 'CallExpression', 'name': 'feature_flag', 'range': [3278, 3281], 'children': [{'type': 'Literal', 'name': '"api-keys-enabled"', 'range': [3280, 3280], 'children': []}]}]}, {'type': 'FunctionSignature', 'name': 'create_api_key', 'range': [3283, 3308], 'children': [{'type': 'Parameter', 'name': 'request: CreateAPIKeyRequest', 'range': [3288, 3291], 'children': []}, {'type': 'Parameter', 'name': 'user_id: Annotated[str, Depends(get_user_id)]', 'range': [3292, 3303], 'children': []}, {'type': 'ReturnType', 'name': '-> CreateAPIKeyResponse', 'range': [3305, 3307], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [3309, 3393], 'children': [{'type': 'TryStatement', 'name': '', 'range': [3314, 3364], 'children': [{'type': 'BlockStatement', 'name': '', 'range': [3315, 3364], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key, plain_text = await generate_api_key', 'range': [3317, 3321], 'children': [{'type': 'CallExpression', 'name': 'generate_api_key', 'range': [3321, 3351], 'children': [{'type': 'Literal', 'name': 'name=request.name', 'range': [3325, 3329], 'children': []}, {'type': 'Literal', 'name': 'user_id=user_id', 'range': [3332, 3334], 'children': []}, {'type': 'Literal', 'name': 'permissions=request.permissions', 'range': [3337, 3341], 'children': []}, {'type': 'Literal', 'name': 'description=request.description', 'range': [3344, 3348], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return CreateAPIKeyResponse(api_key=api_key, plain_text_key=plain_text)', 'range': [3353, 3364], 'children': [{'type': 'CallExpression', 'name': 'CreateAPIKeyResponse', 'range': [3355, 3363], 'children': [{'type': 'Literal', 'name': 'api_key=api_key', 'range': [3356, 3358], 'children': []}, {'type': 'Literal', 'name': 'plain_text_key=plain_text', 'range': [3360, 3362], 'children': []}]}]}]}]}, {'type': 'CatchStatement', 'name': '', 'range': [3365, 3393], 'children': [{'type': 'BlockStatement', 'name': '', 'range': [3369, 3393], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [3371, 3377], 'children': [{'type': 'Literal', 'name': 'f"Failed to create API key: {str(e)}"', 'range': [3375, 3376], 'children': []}]}, {'type': 'ThrowStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3379, 3393], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [3381, 3392], 'children': [{'type': 'Literal', 'name': 'status_code=400', 'range': [3382, 3384], 'children': []}, {'type': 'Literal', 'name': 'detail=str(e)', 'range': [3386, 3391], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:44,088 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:47,781 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [1004, 1132], 'children': [{'type': 'FunctionDecl', 'name': 'get_graph_all_versions', 'range': [1066, 1132], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [1066, 1096], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1066, 1071], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1067, 1070], 'children': []}, {'type': 'Identifier', 'name': 'get_graph_all_versions', 'range': [1068, 1089], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [1069, 1086], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1071, 1074], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [1072, 1073], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [1073, 1076], 'children': []}]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1075, 1085], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [1076, 1085], 'children': [{'type': 'Identifier', 'name': 'Annotated', 'range': [1077, 1086], 'children': []}, {'type': 'TypeArgumentList', 'name': '', 'range': [1078, 1085], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [1079, 1082], 'children': []}, {'type': 'Identifier', 'name': 'Depends', 'range': [1081, 1088], 'children': []}]}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [1088, 1096], 'children': [{'type': 'Identifier', 'name': 'Sequence', 'range': [1090, 1097], 'children': []}, {'type': 'TypeArgumentList', 'name': '', 'range': [1091, 1096], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1092, 1099], 'children': []}, {'type': 'Identifier', 'name': 'GraphModel', 'range': [1094, 1103], 'children': []}]}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [1097, 1132], 'children': [{'type': 'VariableDeclaration', 'name': 'graphs', 'range': [1098, 1111], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [1100, 1105], 'children': []}, {'type': 'CallExpression', 'name': '', 'range': [1101, 1110], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1101, 1108], 'children': []}, {'type': 'Identifier', 'name': 'get_graph_all_versions', 'range': [1103, 1126], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1104, 1110], 'children': [{'type': 'Identifier', 'name': 'graph_id', 'range': [1105, 1112], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1107, 1114], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [1112, 1129], 'children': [{'type': 'Condition', 'name': '', 'range': [1113, 1115], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [1113, 1117], 'children': [{'type': 'Identifier', 'name': 'graphs', 'range': [1114, 1120], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [1115, 1129], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1117, 1128], 'children': [{'type': 'CallExpression', 'name': '', 'range': [1118, 1127], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1118, 1131], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1119, 1127], 'children': [{'type': 'AssignmentExpression', 'name': 'status_code', 'range': [1120, 1123], 'children': [{'type': 'Literal', 'name': '404', 'range': [1122, 1125], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'detail', 'range': [1124, 1127], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [1126, 1127], 'children': [{'type': 'TemplateElement', 'name': 'Graph #{graph_id} not found.', 'range': [1127, 1128], 'children': []}]}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1130, 1132], 'children': [{'type': 'Identifier', 'name': 'graphs', 'range': [1131, 1132], 'children': []}]}]}]}]}
2025-01-08 10:29:47,781 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:49,595 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [1419, 1539], 'children': [{'type': 'FunctionDecl', 'name': 'delete_graph', 'range': [1446, 1539], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1451, 1453], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1455, 1465], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [1457, 1465], 'children': [{'type': 'Type', 'name': 'str', 'range': [1459, 1460], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [1461, 1465], 'children': [{'type': 'CallExpression', 'name': 'get_user_id', 'range': [1463, 1464], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': 'DeleteGraphResponse', 'range': [1469, 1470], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [1472, 1539], 'children': [{'type': 'IfStatement', 'name': '', 'range': [1473, 1489], 'children': [{'type': 'AssignmentExpression', 'name': 'active_version', 'range': [1474, 1487], 'children': [{'type': 'CallExpression', 'name': 'graph_db.get_graph', 'range': [1477, 1487], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [1482, 1483], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [1485, 1486], 'children': []}]}]}]}, {'type': 'CallExpression', 'name': 'on_graph_deactivate', 'range': [1514, 1521], 'children': [{'type': 'Argument', 'name': 'active_version', 'range': [1517, 1518], 'children': []}, {'type': 'Argument', 'name': 'get_credentials', 'range': [1519, 1520], 'children': []}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1523, 1539], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1524, 1538], 'children': [{'type': 'Property', 'name': 'version_counts', 'range': [1525, 1537], 'children': [{'type': 'CallExpression', 'name': 'graph_db.delete_graph', 'range': [1527, 1537], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [1532, 1533], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [1535, 1536], 'children': []}]}]}]}]}]}]}, {'type': 'FunctionDecl', 'name': 'get_credentials', 'range': [1491, 1512], 'children': [{'type': 'Parameter', 'name': 'credentials_id', 'range': [1494, 1496], 'children': []}, {'type': 'ReturnType', 'name': 'Credentials | None', 'range': [1498, 1500], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [1502, 1512], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [1503, 1512], 'children': [{'type': 'CallExpression', 'name': 'integration_creds_manager.get', 'range': [1504, 1511], 'children': [{'type': 'Argument', 'name': 'user_id', 'range': [1508, 1509], 'children': []}, {'type': 'Argument', 'name': 'credentials_id', 'range': [1510, 1511], 'children': []}]}]}]}]}]}
2025-01-08 10:29:49,596 - INFO - Completed main AST analysis flow
2025-01-08 10:29:49,597 - INFO - Successfully processed chunk
2025-01-08 10:29:52,399 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [3512, 3653], 'children': [{'type': 'FunctionDecl', 'name': 'get_api_key', 'range': [3555, 3653], 'children': [{'type': 'Decorator', 'name': 'feature_flag', 'range': [3555, 3559], 'children': [{'type': 'Argument', 'name': 'api-keys-enabled', 'range': [3558, 3559], 'children': []}]}, {'type': 'FunctionSignature', 'name': '', 'range': [3561, 3585], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3561, 3561], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3562, 3562], 'children': []}, {'type': 'Identifier', 'name': 'get_api_key', 'range': [3563, 3563], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [3564, 3581], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [3566, 3568], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3568, 3568], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [3570, 3580], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3572, 3580], 'children': [{'type': 'TypeArgument', 'name': 'str', 'range': [3574, 3574], 'children': []}, {'type': 'TypeArgument', 'name': 'Depends', 'range': [3576, 3580], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [3578, 3578], 'children': []}]}]}]}]}, {'type': 'ReturnType', 'name': 'APIKeyWithoutHash', 'range': [3585, 3585], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3587, 3653], 'children': [{'type': 'Docstring', 'name': 'Get a specific API key', 'range': [3588, 3590], 'children': []}, {'type': 'TryStatement', 'name': '', 'range': [3592, 3653], 'children': [{'type': 'TryBlock', 'name': '', 'range': [3592, 3624], 'children': [{'type': 'Assignment', 'name': 'api_key', 'range': [3595, 3603], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [3597, 3597], 'children': [{'type': 'CallExpression', 'name': 'get_api_key_by_id', 'range': [3598, 3603], 'children': [{'type': 'Argument', 'name': 'key_id', 'range': [3600, 3600], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [3602, 3602], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [3605, 3621], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [3606, 3607], 'children': []}, {'type': 'IfBlock', 'name': '', 'range': [3608, 3621], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3610, 3620], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [3611, 3620], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [3613, 3615], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [3617, 3619], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [3622, 3623], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [3623, 3623], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': '', 'range': [3625, 3653], 'children': [{'type': 'Exception', 'name': 'APIKeyError', 'range': [3626, 3626], 'children': []}, {'type': 'AsClause', 'name': 'e', 'range': [3627, 3628], 'children': []}, {'type': 'ExceptBlockBody', 'name': '', 'range': [3629, 3653], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [3631, 3637], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [3631, 3637], 'children': [{'type': 'Argument', 'name': 'Failed to get API key: {str(e)}', 'range': [3635, 3636], 'children': []}]}]}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [3639, 3652], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [3640, 3652], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [3642, 3644], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [3646, 3648], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:29:52,400 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:54,004 - INFO - Step 3 result: {'type': 'Program', 'name': 'update_permissions', 'range': [3966, 4132], 'children': [{'type': 'FunctionDeclaration', 'name': 'update_permissions', 'range': [3966, 4132], 'children': [{'type': 'Decorator', 'name': 'v1_router.put', 'range': [3966, 4007], 'children': [{'type': 'CallExpression', 'name': '', 'range': [3966, 4007], 'children': [{'type': 'MemberExpression', 'name': 'v1_router.put', 'range': [3966, 3969], 'children': []}, {'type': 'StringLiteral', 'name': '"/api-keys/{key_id}/permissions"', 'range': [3972, 3972], 'children': []}, {'type': 'Keyword', 'name': 'response_model', 'range': [3975, 3975], 'children': []}, {'type': 'TypeExpression', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3977, 3987], 'children': []}, {'type': 'Keyword', 'name': 'tags', 'range': [3990, 3990], 'children': []}, {'type': 'ArrayExpression', 'name': '["api-keys"]', 'range': [3992, 3994], 'children': []}, {'type': 'Keyword', 'name': 'dependencies', 'range': [3997, 3997], 'children': []}, {'type': 'ArrayExpression', 'name': '[Depends(auth_middleware)]', 'range': [3999, 4004], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [4009, 4013], 'children': [{'type': 'CallExpression', 'name': '', 'range': [4009, 4013], 'children': [{'type': 'StringLiteral', 'name': '"api-keys-enabled"', 'range': [4012, 4012], 'children': []}]}]}, {'type': 'FunctionSignature', 'name': 'update_permissions', 'range': [4015, 4050], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [4020, 4022], 'children': [{'type': 'TypeAnnotation', 'name': ': str', 'range': [4021, 4022], 'children': []}]}, {'type': 'Parameter', 'name': 'request', 'range': [4025, 4027], 'children': [{'type': 'TypeAnnotation', 'name': ': UpdatePermissionsRequest', 'range': [4026, 4027], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [4030, 4040], 'children': [{'type': 'TypeAnnotation', 'name': ': Annotated[str, Depends(get_user_id)]', 'range': [4031, 4040], 'children': []}]}, {'type': 'ReturnTypeAnnotation', 'name': '-> Optional[APIKeyWithoutHash]', 'range': [4044, 4050], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [4051, 4132], 'children': [{'type': 'TryStatement', 'name': '', 'range': [4056, 4132], 'children': [{'type': 'Block', 'name': '', 'range': [4058, 4071], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [4059, 4070], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [4060, 4070], 'children': [{'type': 'CallExpression', 'name': 'update_api_key_permissions', 'range': [4061, 4070], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [4063, 4063], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [4065, 4065], 'children': []}, {'type': 'MemberExpression', 'name': 'request.permissions', 'range': [4067, 4069], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyNotFoundError', 'range': [4072, 4087], 'children': [{'type': 'Block', 'name': '', 'range': [4074, 4087], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [4076, 4086], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4077, 4086], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4079, 4079], 'children': []}, {'type': 'NumericLiteral', 'name': '404', 'range': [4081, 4081], 'children': []}, {'type': 'Keyword', 'name': 'detail', 'range': [4083, 4083], 'children': []}, {'type': 'StringLiteral', 'name': '"API key not found"', 'range': [4085, 4085], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyPermissionError', 'range': [4088, 4103], 'children': [{'type': 'Block', 'name': '', 'range': [4090, 4103], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [4092, 4102], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4093, 4102], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4095, 4095], 'children': []}, {'type': 'NumericLiteral', 'name': '403', 'range': [4097, 4097], 'children': []}, {'type': 'Keyword', 'name': 'detail', 'range': [4099, 4099], 'children': []}, {'type': 'StringLiteral', 'name': '"Permission denied"', 'range': [4101, 4101], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyError', 'range': [4104, 4132], 'children': [{'type': 'Block', 'name': '', 'range': [4108, 4132], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [4110, 4116], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [4110, 4116], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to update API key permissions: {str(e)}"', 'range': [4114, 4115], 'children': []}]}]}, {'type': 'RaiseStatement', 'name': '', 'range': [4118, 4131], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4119, 4131], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4121, 4121], 'children': []}, {'type': 'NumericLiteral', 'name': '400', 'range': [4123, 4123], 'children': []}, {'type': 'Keyword', 'name': 'detail', 'range': [4125, 4125], 'children': []}, {'type': 'CallExpression', 'name': 'str', 'range': [4127, 4130], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [4129, 4129], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:29:54,004 - INFO - Starting Step 4: AST normalization
2025-01-08 10:30:00,016 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [477, 579], 'children': [{'type': 'FunctionDecl', 'name': 'get_graph_blocks', 'range': [502, 579], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [502, 517], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [502, 505], 'children': []}, {'type': 'Identifier', 'name': 'get_graph_blocks', 'range': [503, 517], 'children': []}, {'type': 'ReturnType', 'name': '', 'range': [506, 517], 'children': [{'type': 'Keyword', 'name': '->', 'range': [506, 508], 'children': []}, {'type': 'Type', 'name': 'Sequence', 'range': [508, 517], 'children': [{'type': 'GenericType', 'name': 'dict', 'range': [510, 515], 'children': [{'type': 'Type', 'name': 'Any', 'range': [512, 515], 'children': []}]}]}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [518, 579], 'children': [{'type': 'VariableDecl', 'name': 'blocks', 'range': [519, 541], 'children': [{'type': 'Assignment', 'name': '=', 'range': [520, 541], 'children': [{'type': 'ListComprehension', 'name': '', 'range': [521, 541], 'children': [{'type': 'Expression', 'name': 'block', 'range': [522, 540], 'children': [{'type': 'CallExpression', 'name': 'block', 'range': [522, 540], 'children': [{'type': 'Identifier', 'name': 'block', 'range': [522, 527], 'children': []}]}]}, {'type': 'ForStatement', 'name': '', 'range': [525, 540], 'children': [{'type': 'Variable', 'name': 'block', 'range': [526, 531], 'children': []}, {'type': 'Expression', 'name': 'backend.data.block.get_blocks().values()', 'range': [528, 540], 'children': []}]}]}]}]}, {'type': 'VariableDecl', 'name': 'costs', 'range': [543, 548], 'children': [{'type': 'Assignment', 'name': '=', 'range': [544, 548], 'children': [{'type': 'CallExpression', 'name': 'get_block_costs', 'range': [545, 548], 'children': [{'type': 'Identifier', 'name': 'get_block_costs', 'range': [545, 548], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [549, 579], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [549, 555], 'children': []}, {'type': 'ListComprehension', 'name': '', 'range': [550, 579], 'children': [{'type': 'Expression', 'name': '', 'range': [551, 573], 'children': [{'type': 'Dictionary', 'name': '', 'range': [551, 573], 'children': [{'type': 'KeyValuePair', 'name': '', 'range': [552, 562], 'children': [{'type': 'Expression', 'name': '*b.to_dict()', 'range': [552, 562], 'children': []}]}, {'type': 'KeyValuePair', 'name': '', 'range': [560, 572], 'children': [{'type': 'Key', 'name': 'costs', 'range': [560, 565], 'children': []}, {'type': 'Expression', 'name': 'costs.get(b.id, [])', 'range': [562, 572], 'children': []}]}]}]}, {'type': 'ForStatement', 'name': '', 'range': [574, 579], 'children': [{'type': 'Variable', 'name': 'b', 'range': [575, 576], 'children': []}, {'type': 'Expression', 'name': 'blocks', 'range': [577, 579], 'children': []}]}]}]}]}]}]}
2025-01-08 10:30:00,016 - INFO - Completed main AST analysis flow
2025-01-08 10:30:00,017 - INFO - Successfully processed chunk
2025-01-08 10:30:00,328 - INFO - Step 3 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [0, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [3, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'defaultdict', 'range': [7, 9], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [11, 21], 'children': [{'type': 'ImportSpecifier', 'name': 'TYPE_CHECKING', 'range': [12, 14], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Annotated', 'range': [16, 16], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Any', 'range': [18, 18], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Sequence', 'range': [20, 20], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [23, 25], 'children': [{'type': 'ImportSpecifier', 'name': 'pydantic', 'range': [23, 24], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [26, 34], 'children': [{'type': 'ImportSpecifier', 'name': 'auth_middleware', 'range': [27, 33], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [35, 43], 'children': [{'type': 'ImportSpecifier', 'name': 'feature_flag', 'range': [36, 42], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [44, 52], 'children': [{'type': 'ImportSpecifier', 'name': 'thread_cached', 'range': [45, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 61], 'children': [{'type': 'ImportSpecifier', 'name': 'APIRouter', 'range': [54, 56], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Depends', 'range': [58, 58], 'children': []}, {'type': 'ImportSpecifier', 'name': 'HTTPException', 'range': [60, 60], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [62, 68], 'children': [{'type': 'ImportSpecifier', 'name': 'Optional', 'range': [63, 65], 'children': []}, {'type': 'ImportSpecifier', 'name': 'TypedDict', 'range': [67, 67], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [70, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'block', 'range': [71, 75], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [77, 85], 'children': [{'type': 'ImportSpecifier', 'name': 'router', 'range': [78, 84], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [86, 94], 'children': [{'type': 'ImportSpecifier', 'name': 'analytics', 'range': [87, 93], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [95, 103], 'children': [{'type': 'ImportSpecifier', 'name': 'execution_db', 'range': [96, 102], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [104, 112], 'children': [{'type': 'ImportSpecifier', 'name': 'graph_db', 'range': [105, 111], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [113, 153], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyError', 'range': [122, 122], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyNotFoundError', 'range': [125, 125], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyPermissionError', 'range': [128, 128], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWithoutHash', 'range': [131, 131], 'children': []}, {'type': 'ImportSpecifier', 'name': 'generate_api_key', 'range': [134, 134], 'children': []}, {'type': 'ImportSpecifier', 'name': 'get_api_key_by_id', 'range': [137, 137], 'children': []}, {'type': 'ImportSpecifier', 'name': 'list_user_api_keys', 'range': [140, 140], 'children': []}, {'type': 'ImportSpecifier', 'name': 'revoke_api_key', 'range': [143, 143], 'children': []}, {'type': 'ImportSpecifier', 'name': 'suspend_api_key', 'range': [146, 146], 'children': []}, {'type': 'ImportSpecifier', 'name': 'update_api_key_permissions', 'range': [149, 149], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [154, 164], 'children': [{'type': 'ImportSpecifier', 'name': 'BlockInput', 'range': [155, 161], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CompletedBlockOutput', 'range': [163, 163], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [165, 175], 'children': [{'type': 'ImportSpecifier', 'name': 'get_block_costs', 'range': [166, 172], 'children': []}, {'type': 'ImportSpecifier', 'name': 'get_user_credit_model', 'range': [174, 174], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [176, 184], 'children': [{'type': 'ImportSpecifier', 'name': 'get_or_create_user', 'range': [177, 183], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [185, 195], 'children': [{'type': 'ImportSpecifier', 'name': 'ExecutionManager', 'range': [186, 190], 'children': []}, {'type': 'ImportSpecifier', 'name': 'ExecutionScheduler', 'range': [192, 192], 'children': []}, {'type': 'ImportSpecifier', 'name': 'scheduler', 'range': [194, 194], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [196, 204], 'children': [{'type': 'ImportSpecifier', 'name': 'IntegrationCredentialsManager', 'range': [197, 203], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [205, 223], 'children': [{'type': 'ImportSpecifier', 'name': 'on_graph_activate', 'range': [206, 216], 'children': []}, {'type': 'ImportSpecifier', 'name': 'on_graph_deactivate', 'range': [218, 218], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [224, 249], 'children': [{'type': 'ImportSpecifier', 'name': 'CreateAPIKeyRequest', 'range': [225, 233], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CreateAPIKeyResponse', 'range': [235, 235], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CreateGraph', 'range': [237, 239], 'children': []}, {'type': 'ImportSpecifier', 'name': 'SetGraphActiveVersion', 'range': [241, 242], 'children': []}, {'type': 'ImportSpecifier', 'name': 'UpdatePermissionsRequest', 'range': [244, 246], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [250, 258], 'children': [{'type': 'ImportSpecifier', 'name': 'get_user_id', 'range': [251, 257], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [259, 267], 'children': [{'type': 'ImportSpecifier', 'name': 'get_service_client', 'range': [260, 266], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [268, 276], 'children': [{'type': 'ImportSpecifier', 'name': 'Settings', 'range': [269, 275], 'children': []}]}]}
2025-01-08 10:30:00,329 - INFO - Starting Step 4: AST normalization
2025-01-08 10:30:04,958 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [1540, 1949], 'children': [{'type': 'FunctionDecl', 'name': 'update_graph', 'range': [1599, 1949], 'children': [{'type': 'Decorator', 'name': '@v1_router.put', 'range': [1540, 1565], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1546, 1548], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [1550, 1554], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [1556, 1563], 'children': []}]}, {'type': 'Decorator', 'name': '@v1_router.put', 'range': [1567, 1597], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1573, 1575], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [1578, 1584], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [1587, 1594], 'children': []}]}, {'type': 'FunctionSignature', 'name': 'update_graph', 'range': [1599, 1635], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1604, 1606], 'children': []}, {'type': 'Parameter', 'name': 'graph', 'range': [1609, 1614], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1616, 1627], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [1636, 1949], 'children': [{'type': 'Comment', 'name': '# Sanity check', 'range': [1637, 1640], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1641, 1663], 'children': [{'type': 'Condition', 'name': '', 'range': [1642, 1651], 'children': []}, {'type': 'Body', 'name': '', 'range': [1652, 1663], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1654, 1662], 'children': []}]}]}, {'type': 'Comment', 'name': '# Determine new version', 'range': [1665, 1669], 'children': []}, {'type': 'VariableDecl', 'name': 'existing_versions', 'range': [1670, 1683], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1684, 1699], 'children': [{'type': 'Condition', 'name': '', 'range': [1685, 1686], 'children': []}, {'type': 'Body', 'name': '', 'range': [1687, 1699], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1689, 1698], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'latest_version_number', 'range': [1700, 1712], 'children': []}, {'type': 'Assignment', 'name': 'graph.version', 'range': [1713, 1720], 'children': []}, {'type': 'VariableDecl', 'name': 'latest_version_graph', 'range': [1722, 1741], 'children': []}, {'type': 'VariableDecl', 'name': 'current_active_version', 'range': [1742, 1760], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1761, 1783], 'children': [{'type': 'Condition', 'name': '', 'range': [1762, 1769], 'children': []}, {'type': 'Body', 'name': '', 'range': [1770, 1783], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1772, 1782], 'children': []}]}]}, {'type': 'Assignment', 'name': 'graph.is_active', 'range': [1784, 1792], 'children': []}, {'type': 'Assignment', 'name': 'graph', 'range': [1793, 1803], 'children': []}, {'type': 'CallExpression', 'name': 'graph.reassign_ids', 'range': [1804, 1812], 'children': []}, {'type': 'VariableDecl', 'name': 'new_graph_version', 'range': [1814, 1827], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1829, 1918], 'children': [{'type': 'Condition', 'name': '', 'range': [1830, 1833], 'children': []}, {'type': 'Body', 'name': '', 'range': [1834, 1918], 'children': [{'type': 'FunctionDecl', 'name': 'get_credentials', 'range': [1836, 1857], 'children': []}, {'type': 'Comment', 'name': '# Handle activation of the new graph first to ensure continuity', 'range': [1859, 1870], 'children': []}, {'type': 'Assignment', 'name': 'new_graph_version', 'range': [1871, 1886], 'children': []}, {'type': 'Comment', 'name': '# Ensure new version is the only active version', 'range': [1887, 1896], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.set_graph_active_version', 'range': [1897, 1917], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [1919, 1946], 'children': [{'type': 'Condition', 'name': '', 'range': [1920, 1921], 'children': []}, {'type': 'Body', 'name': '', 'range': [1922, 1946], 'children': [{'type': 'Comment', 'name': '# Handle deactivation of the previously active version', 'range': [1923, 1931], 'children': []}, {'type': 'CallExpression', 'name': 'on_graph_deactivate', 'range': [1932, 1945], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1947, 1949], 'children': []}]}]}]}
2025-01-08 10:30:04,959 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:30:06,063 - INFO - Step 5 result: {'type': 'Program', 'name': 'v1_router.post', 'range': [3810, 3965], 'children': [{'type': 'Decorator', 'name': '@v1_router.post', 'range': [3810, 3852], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [3813, 3851], 'children': [{'type': 'Literal', 'name': '"/api-keys/{key_id}/suspend"', 'range': [3816, 3816], 'children': []}, {'type': 'KeywordArgument', 'name': 'response_model', 'range': [3819, 3831], 'children': [{'type': 'TypeExpression', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3821, 3831], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'tags', 'range': [3834, 3838], 'children': [{'type': 'Literal', 'name': '["api-keys"]', 'range': [3836, 3838], 'children': []}]}, {'type': 'KeywordArgument', 'name': 'dependencies', 'range': [3841, 3848], 'children': [{'type': 'Literal', 'name': '[Depends(auth_middleware)]', 'range': [3843, 3848], 'children': []}]}]}]}, {'type': 'Decorator', 'name': '@feature_flag', 'range': [3853, 3857], 'children': [{'type': 'CallExpression', 'name': 'feature_flag', 'range': [3854, 3857], 'children': [{'type': 'Literal', 'name': '"api-keys-enabled"', 'range': [3856, 3856], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': 'suspend_key', 'range': [3859, 3965], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3859, 3859], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3860, 3860], 'children': []}, {'type': 'Identifier', 'name': 'suspend_key', 'range': [3861, 3861], 'children': []}, {'type': 'ParameterList', 'name': 'key_id: str, user_id: Annotated[str, Depends(get_user_id)]', 'range': [3862, 3879], 'children': [{'type': 'Parameter', 'name': 'key_id: str', 'range': [3864, 3866], 'children': []}, {'type': 'Parameter', 'name': 'user_id: Annotated[str, Depends(get_user_id)]', 'range': [3868, 3878], 'children': []}]}, {'type': 'ReturnType', 'name': '-> Optional[APIKeyWithoutHash]', 'range': [3881, 3886], 'children': []}, {'type': 'Docstring', 'name': '"Suspend an API key"', 'range': [3889, 3891], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [3893, 3965], 'children': [{'type': 'Block', 'name': 'try block', 'range': [3895, 3904], 'children': [{'type': 'ReturnStatement', 'name': 'return await suspend_api_key(key_id, user_id)', 'range': [3896, 3903], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except APIKeyNotFoundError', 'range': [3905, 3920], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3908, 3920], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=404, detail="API key not found")', 'range': [3909, 3919], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except APIKeyPermissionError', 'range': [3921, 3936], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3924, 3936], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=403, detail="Permission denied")', 'range': [3925, 3935], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except APIKeyError as e', 'range': [3937, 3965], 'children': [{'type': 'Block', 'name': 'except block', 'range': [3942, 3965], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Failed to suspend API key: {str(e)}")', 'range': [3943, 3949], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3951, 3964], 'children': []}]}]}]}]}]}
2025-01-08 10:30:06,063 - INFO - Completed main AST analysis flow
2025-01-08 10:30:06,065 - INFO - Successfully processed chunk
2025-01-08 10:30:11,139 - INFO - Step 5 result: {'type': 'Program', 'name': 'create_api_key', 'range': [3234, 3393], 'children': [{'type': 'FunctionDecl', 'name': 'create_api_key', 'range': [3277, 3393], 'children': [{'type': 'Decorator', 'name': 'v1_router.post', 'range': [3234, 3276], 'children': [{'type': 'CallExpression', 'name': 'post', 'range': [3237, 3275], 'children': [{'type': 'Literal', 'name': '"/api-keys"', 'range': [3240, 3240], 'children': []}, {'type': 'Literal', 'name': 'response_model=list[CreateAPIKeyResponse]|dict[str, str]', 'range': [3243, 3255], 'children': []}, {'type': 'Literal', 'name': 'tags=["api-keys"]', 'range': [3258, 3262], 'children': []}, {'type': 'Literal', 'name': 'dependencies=[Depends(auth_middleware)]', 'range': [3265, 3272], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [3277, 3282], 'children': [{'type': 'CallExpression', 'name': 'feature_flag', 'range': [3278, 3281], 'children': [{'type': 'Literal', 'name': '"api-keys-enabled"', 'range': [3280, 3280], 'children': []}]}]}, {'type': 'FunctionSignature', 'name': 'create_api_key', 'range': [3283, 3308], 'children': [{'type': 'Parameter', 'name': 'request: CreateAPIKeyRequest', 'range': [3288, 3291], 'children': []}, {'type': 'Parameter', 'name': 'user_id: Annotated[str, Depends(get_user_id)]', 'range': [3292, 3303], 'children': []}, {'type': 'ReturnType', 'name': '-> CreateAPIKeyResponse', 'range': [3305, 3307], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [3309, 3393], 'children': [{'type': 'TryStatement', 'name': '', 'range': [3314, 3364], 'children': [{'type': 'BlockStatement', 'name': '', 'range': [3315, 3364], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key, plain_text = await generate_api_key', 'range': [3317, 3321], 'children': [{'type': 'CallExpression', 'name': 'generate_api_key', 'range': [3321, 3351], 'children': [{'type': 'Literal', 'name': 'name=request.name', 'range': [3325, 3329], 'children': []}, {'type': 'Literal', 'name': 'user_id=user_id', 'range': [3332, 3334], 'children': []}, {'type': 'Literal', 'name': 'permissions=request.permissions', 'range': [3337, 3341], 'children': []}, {'type': 'Literal', 'name': 'description=request.description', 'range': [3344, 3348], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return CreateAPIKeyResponse(api_key=api_key, plain_text_key=plain_text)', 'range': [3353, 3364], 'children': [{'type': 'CallExpression', 'name': 'CreateAPIKeyResponse', 'range': [3355, 3363], 'children': [{'type': 'Literal', 'name': 'api_key=api_key', 'range': [3356, 3358], 'children': []}, {'type': 'Literal', 'name': 'plain_text_key=plain_text', 'range': [3360, 3362], 'children': []}]}]}]}]}, {'type': 'CatchStatement', 'name': '', 'range': [3365, 3393], 'children': [{'type': 'BlockStatement', 'name': '', 'range': [3369, 3393], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [3371, 3377], 'children': [{'type': 'Literal', 'name': 'f"Failed to create API key: {str(e)}"', 'range': [3375, 3376], 'children': []}]}, {'type': 'ThrowStatement', 'name': 'raise HTTPException(status_code=400, detail=str(e))', 'range': [3379, 3393], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [3381, 3392], 'children': [{'type': 'Literal', 'name': 'status_code=400', 'range': [3382, 3384], 'children': []}, {'type': 'Literal', 'name': 'detail=str(e)', 'range': [3386, 3391], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:30:11,140 - INFO - Completed main AST analysis flow
2025-01-08 10:30:11,143 - INFO - Successfully processed chunk
2025-01-08 10:30:11,147 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [857, 1003], 'children': [{'type': 'FunctionDecl', 'name': 'get_graph', 'range': [914, 1003], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [914, 959], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [914, 919], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [915, 918], 'children': []}, {'type': 'Identifier', 'name': 'get_graph', 'range': [916, 925], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [917, 953], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [919, 922], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [920, 921], 'children': [{'type': 'Type', 'name': 'str', 'range': [921, 924], 'children': []}]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [924, 935], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [925, 934], 'children': [{'type': 'Type', 'name': 'Annotated', 'range': [926, 935], 'children': [{'type': 'Type', 'name': 'str', 'range': [928, 931], 'children': []}, {'type': 'Dependency', 'name': 'Depends', 'range': [930, 933], 'children': [{'type': 'CallExpression', 'name': 'get_user_id', 'range': [932, 933], 'children': []}]}]}]}]}, {'type': 'Parameter', 'name': 'version', 'range': [937, 943], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [938, 942], 'children': [{'type': 'Type', 'name': 'int', 'range': [939, 942], 'children': []}, {'type': 'Type', 'name': 'None', 'range': [941, 944], 'children': []}]}]}, {'type': 'Parameter', 'name': 'hide_credentials', 'range': [946, 950], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [947, 949], 'children': [{'type': 'Type', 'name': 'bool', 'range': [948, 951], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [954, 959], 'children': [{'type': 'Type', 'name': 'graph_db.GraphModel', 'range': [956, 959], 'children': []}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [960, 1003], 'children': [{'type': 'VariableDeclaration', 'name': 'graph', 'range': [961, 981], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [963, 968], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.get_graph', 'range': [964, 981], 'children': [{'type': 'Argument', 'name': 'graph_id', 'range': [969, 970], 'children': []}, {'type': 'Argument', 'name': 'version', 'range': [971, 972], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [973, 975], 'children': []}, {'type': 'Argument', 'name': 'for_export', 'range': [977, 979], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [983, 1000], 'children': [{'type': 'Condition', 'name': '', 'range': [983, 986], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [984, 985], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [985, 986], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [987, 1000], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [988, 999], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [989, 999], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [991, 993], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [995, 998], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1001, 1003], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1002, 1003], 'children': []}]}]}]}]}
2025-01-08 10:30:11,147 - INFO - Completed main AST analysis flow
2025-01-08 10:30:11,150 - INFO - Successfully processed chunk
2025-01-08 10:30:19,227 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [1004, 1132], 'children': [{'type': 'FunctionDecl', 'name': 'get_graph_all_versions', 'range': [1066, 1132], 'children': [{'type': 'FunctionSignature', 'name': '', 'range': [1066, 1096], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1066, 1071], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1067, 1070], 'children': []}, {'type': 'Identifier', 'name': 'get_graph_all_versions', 'range': [1068, 1089], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [1069, 1086], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1071, 1074], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [1072, 1073], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [1073, 1076], 'children': []}]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1075, 1085], 'children': [{'type': 'TypeAnnotation', 'name': '', 'range': [1076, 1085], 'children': [{'type': 'Identifier', 'name': 'Annotated', 'range': [1077, 1086], 'children': []}, {'type': 'TypeArgumentList', 'name': '', 'range': [1078, 1085], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [1079, 1082], 'children': []}, {'type': 'Identifier', 'name': 'Depends', 'range': [1081, 1088], 'children': []}]}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [1088, 1096], 'children': [{'type': 'Identifier', 'name': 'Sequence', 'range': [1090, 1097], 'children': []}, {'type': 'TypeArgumentList', 'name': '', 'range': [1091, 1096], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1092, 1099], 'children': []}, {'type': 'Identifier', 'name': 'GraphModel', 'range': [1094, 1103], 'children': []}]}]}]}, {'type': 'FunctionBody', 'name': '', 'range': [1097, 1132], 'children': [{'type': 'VariableDeclaration', 'name': 'graphs', 'range': [1098, 1111], 'children': [{'type': 'Keyword', 'name': 'await', 'range': [1100, 1105], 'children': []}, {'type': 'CallExpression', 'name': '', 'range': [1101, 1110], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1101, 1108], 'children': []}, {'type': 'Identifier', 'name': 'get_graph_all_versions', 'range': [1103, 1126], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1104, 1110], 'children': [{'type': 'Identifier', 'name': 'graph_id', 'range': [1105, 1112], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1107, 1114], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [1112, 1129], 'children': [{'type': 'Condition', 'name': '', 'range': [1113, 1115], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [1113, 1117], 'children': [{'type': 'Identifier', 'name': 'graphs', 'range': [1114, 1120], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [1115, 1129], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1117, 1128], 'children': [{'type': 'CallExpression', 'name': '', 'range': [1118, 1127], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1118, 1131], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [1119, 1127], 'children': [{'type': 'AssignmentExpression', 'name': 'status_code', 'range': [1120, 1123], 'children': [{'type': 'Literal', 'name': '404', 'range': [1122, 1125], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'detail', 'range': [1124, 1127], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [1126, 1127], 'children': [{'type': 'TemplateElement', 'name': 'Graph #{graph_id} not found.', 'range': [1127, 1128], 'children': []}]}]}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1130, 1132], 'children': [{'type': 'Identifier', 'name': 'graphs', 'range': [1131, 1132], 'children': []}]}]}]}]}
2025-01-08 10:30:19,227 - INFO - Completed main AST analysis flow
2025-01-08 10:30:19,230 - INFO - Successfully processed chunk
2025-01-08 10:30:21,656 - INFO - Step 2 result: {'type': 'Program', 'name': 'do_create_graph', 'range': [1204, 1418], 'children': [{'type': 'FunctionDeclaration', 'name': 'do_create_graph', 'range': [1204, 1418], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1204, 1204], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1205, 1205], 'children': []}, {'type': 'Identifier', 'name': 'do_create_graph', 'range': [1206, 1206], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1207, 1207], 'children': []}, {'type': 'Parameter', 'name': 'create_graph', 'range': [1209, 1211], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1209, 1209], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1210, 1210], 'children': []}, {'type': 'TypeAnnotation', 'name': 'CreateGraph', 'range': [1211, 1211], 'children': []}]}, {'type': 'Parameter', 'name': 'is_template', 'range': [1214, 1216], 'children': [{'type': 'Identifier', 'name': 'is_template', 'range': [1214, 1214], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1215, 1215], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [1216, 1216], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1230, 1232], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [1230, 1230], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1231, 1231], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1232, 1232], 'children': []}]}, {'type': 'Punctuation', 'name': ')', 'range': [1235, 1235], 'children': []}, {'type': 'ReturnType', 'name': '->', 'range': [1236, 1237], 'children': []}, {'type': 'TypeAnnotation', 'name': 'graph_db.GraphModel', 'range': [1238, 1240], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1238, 1238], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1239, 1239], 'children': []}, {'type': 'Identifier', 'name': 'GraphModel', 'range': [1240, 1240], 'children': []}]}, {'type': 'Punctuation', 'name': ':', 'range': [1241, 1241], 'children': []}, {'type': 'Block', 'name': 'FunctionBody', 'range': [1242, 1418], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [1243, 1261], 'children': [{'type': 'Expression', 'name': 'create_graph.graph', 'range': [1244, 1247], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1244, 1244], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1245, 1245], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1246, 1246], 'children': []}]}, {'type': 'Punctuation', 'name': ':', 'range': [1247, 1247], 'children': []}, {'type': 'Assignment', 'name': 'graph = graph_db.make_graph_model(create_graph.graph, user_id)', 'range': [1249, 1260], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1249, 1249], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1250, 1250], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.make_graph_model', 'range': [1251, 1260], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1251, 1251], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1252, 1252], 'children': []}, {'type': 'Identifier', 'name': 'make_graph_model', 'range': [1253, 1253], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1254, 1254], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1255, 1255], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1256, 1256], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1257, 1257], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1258, 1258], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1259, 1259], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1260, 1260], 'children': []}]}]}]}, {'type': 'ElifStatement', 'name': 'elif', 'range': [1262, 1306], 'children': [{'type': 'Expression', 'name': 'create_graph.template_id', 'range': [1263, 1266], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1263, 1263], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1264, 1264], 'children': []}, {'type': 'Identifier', 'name': 'template_id', 'range': [1265, 1265], 'children': []}]}, {'type': 'Punctuation', 'name': ':', 'range': [1266, 1266], 'children': []}, {'type': 'Assignment', 'name': 'graph = await graph_db.get_graph(create_graph.template_id, create_graph.template_version, template=True, user_id=user_id)', 'range': [1277, 1305], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1277, 1277], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1278, 1278], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1279, 1279], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.get_graph', 'range': [1280, 1305], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1280, 1280], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1281, 1281], 'children': []}, {'type': 'Identifier', 'name': 'get_graph', 'range': [1282, 1282], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1283, 1283], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1285, 1285], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1286, 1286], 'children': []}, {'type': 'Identifier', 'name': 'template_id', 'range': [1287, 1287], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1288, 1288], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1290, 1290], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1291, 1291], 'children': []}, {'type': 'Identifier', 'name': 'template_version', 'range': [1292, 1292], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1293, 1293], 'children': []}, {'type': 'Keyword', 'name': 'template', 'range': [1295, 1295], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1296, 1296], 'children': []}, {'type': 'Boolean', 'name': 'True', 'range': [1297, 1297], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1298, 1298], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1300, 1300], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1301, 1301], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1302, 1302], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1305, 1305], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1307, 1324], 'children': [{'type': 'Expression', 'name': 'not graph', 'range': [1308, 1309], 'children': [{'type': 'Keyword', 'name': 'not', 'range': [1308, 1308], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1309, 1309], 'children': []}]}, {'type': 'Punctuation', 'name': ':', 'range': [1310, 1310], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(400, detail=f"Template #{create_graph.template_id} not found")', 'range': [1312, 1323], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1312, 1312], 'children': []}, {'type': 'CallExpression', 'name': 'HTTPException', 'range': [1313, 1323], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1313, 1313], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1314, 1314], 'children': []}, {'type': 'NumericLiteral', 'name': '400', 'range': [1316, 1316], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1317, 1317], 'children': []}, {'type': 'Identifier', 'name': 'detail', 'range': [1318, 1318], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1319, 1319], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Template #{create_graph.template_id} not found"', 'range': [1320, 1321], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1323, 1323], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'graph.version = 1', 'range': [1325, 1329], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1325, 1325], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1326, 1326], 'children': []}, {'type': 'Identifier', 'name': 'version', 'range': [1327, 1327], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1328, 1328], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [1329, 1329], 'children': []}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [1331, 1347], 'children': [{'type': 'Punctuation', 'name': ':', 'range': [1332, 1332], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=400, detail="Either graph or template_id must be provided.")', 'range': [1334, 1346], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1334, 1334], 'children': []}, {'type': 'CallExpression', 'name': 'HTTPException', 'range': [1335, 1346], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1335, 1335], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1336, 1336], 'children': []}, {'type': 'Identifier', 'name': 'status_code', 'range': [1338, 1338], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1339, 1339], 'children': []}, {'type': 'NumericLiteral', 'name': '400', 'range': [1340, 1340], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1341, 1341], 'children': []}, {'type': 'Identifier', 'name': 'detail', 'range': [1342, 1342], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1343, 1343], 'children': []}, {'type': 'StringLiteral', 'name': '"Either graph or template_id must be provided."', 'range': [1344, 1344], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1346, 1346], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'graph.is_template = is_template', 'range': [1349, 1353], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1349, 1349], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1350, 1350], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1351, 1351], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1352, 1352], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1353, 1353], 'children': []}]}, {'type': 'Assignment', 'name': 'graph.is_active = not is_template', 'range': [1355, 1361], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1355, 1355], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1356, 1356], 'children': []}, {'type': 'Identifier', 'name': 'is_active', 'range': [1357, 1357], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1358, 1358], 'children': []}, {'type': 'Keyword', 'name': 'not', 'range': [1359, 1359], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1360, 1360], 'children': []}]}, {'type': 'CallExpression', 'name': 'graph.reassign_ids(user_id=user_id, reassign_graph_id=True)', 'range': [1363, 1373], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1363, 1363], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1364, 1364], 'children': []}, {'type': 'Identifier', 'name': 'reassign_ids', 'range': [1365, 1365], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1366, 1366], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1367, 1367], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1368, 1368], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1369, 1369], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1370, 1370], 'children': []}, {'type': 'Identifier', 'name': 'reassign_graph_id', 'range': [1371, 1371], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1372, 1372], 'children': []}, {'type': 'Boolean', 'name': 'True', 'range': [1373, 1373], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1373, 1373], 'children': []}]}, {'type': 'Assignment', 'name': 'graph = await graph_db.create_graph(graph, user_id=user_id)', 'range': [1376, 1388], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1376, 1376], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1377, 1377], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1378, 1378], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.create_graph', 'range': [1379, 1388], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1379, 1379], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1380, 1380], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1381, 1381], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1382, 1382], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1383, 1383], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1384, 1384], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1385, 1385], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1386, 1386], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1387, 1387], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1388, 1388], 'children': []}]}]}, {'type': 'Assignment', 'name': 'graph = await on_graph_activate(graph, get_credentials=lambda id: integration_creds_manager.get(user_id, id))', 'range': [1390, 1415], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1390, 1390], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1391, 1391], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1392, 1392], 'children': []}, {'type': 'CallExpression', 'name': 'on_graph_activate', 'range': [1393, 1415], 'children': [{'type': 'Identifier', 'name': 'on_graph_activate', 'range': [1393, 1393], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1394, 1394], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1396, 1396], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1397, 1397], 'children': []}, {'type': 'LambdaExpression', 'name': 'get_credentials=lambda id: integration_creds_manager.get(user_id, id)', 'range': [1399, 1414], 'children': [{'type': 'Identifier', 'name': 'get_credentials', 'range': [1399, 1399], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1400, 1400], 'children': []}, {'type': 'Keyword', 'name': 'lambda', 'range': [1401, 1401], 'children': []}, {'type': 'Identifier', 'name': 'id', 'range': [1402, 1402], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1403, 1403], 'children': []}, {'type': 'CallExpression', 'name': 'integration_creds_manager.get', 'range': [1404, 1414], 'children': [{'type': 'Identifier', 'name': 'integration_creds_manager', 'range': [1404, 1404], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1405, 1405], 'children': []}, {'type': 'Identifier', 'name': 'get', 'range': [1406, 1406], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1407, 1407], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1408, 1408], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1409, 1409], 'children': []}, {'type': 'Identifier', 'name': 'id', 'range': [1410, 1410], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1414, 1414], 'children': []}]}]}, {'type': 'Punctuation', 'name': ')', 'range': [1415, 1415], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return graph', 'range': [1416, 1417], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [1416, 1416], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1417, 1417], 'children': []}]}]}]}]}
2025-01-08 10:30:21,656 - INFO - Starting Step 3: AST simplification
2025-01-08 10:30:23,208 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [3512, 3653], 'children': [{'type': 'FunctionDecl', 'name': 'get_api_key', 'range': [3555, 3653], 'children': [{'type': 'Decorator', 'name': 'feature_flag', 'range': [3555, 3559], 'children': [{'type': 'Argument', 'name': 'api-keys-enabled', 'range': [3558, 3559], 'children': []}]}, {'type': 'FunctionSignature', 'name': '', 'range': [3561, 3585], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [3561, 3561], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [3562, 3562], 'children': []}, {'type': 'Identifier', 'name': 'get_api_key', 'range': [3563, 3563], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [3564, 3581], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [3566, 3568], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [3568, 3568], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [3570, 3580], 'children': [{'type': 'TypeAnnotation', 'name': 'Annotated', 'range': [3572, 3580], 'children': [{'type': 'TypeArgument', 'name': 'str', 'range': [3574, 3574], 'children': []}, {'type': 'TypeArgument', 'name': 'Depends', 'range': [3576, 3580], 'children': [{'type': 'Argument', 'name': 'get_user_id', 'range': [3578, 3578], 'children': []}]}]}]}]}, {'type': 'ReturnType', 'name': 'APIKeyWithoutHash', 'range': [3585, 3585], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [3587, 3653], 'children': [{'type': 'Docstring', 'name': 'Get a specific API key', 'range': [3588, 3590], 'children': []}, {'type': 'TryStatement', 'name': '', 'range': [3592, 3653], 'children': [{'type': 'TryBlock', 'name': '', 'range': [3592, 3624], 'children': [{'type': 'Assignment', 'name': 'api_key', 'range': [3595, 3603], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [3597, 3597], 'children': [{'type': 'CallExpression', 'name': 'get_api_key_by_id', 'range': [3598, 3603], 'children': [{'type': 'Argument', 'name': 'key_id', 'range': [3600, 3600], 'children': []}, {'type': 'Argument', 'name': 'user_id', 'range': [3602, 3602], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [3605, 3621], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [3606, 3607], 'children': []}, {'type': 'IfBlock', 'name': '', 'range': [3608, 3621], 'children': [{'type': 'RaiseStatement', 'name': 'raise', 'range': [3610, 3620], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [3611, 3620], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [3613, 3615], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [3617, 3619], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [3622, 3623], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [3623, 3623], 'children': []}]}]}, {'type': 'ExceptBlock', 'name': '', 'range': [3625, 3653], 'children': [{'type': 'Exception', 'name': 'APIKeyError', 'range': [3626, 3626], 'children': []}, {'type': 'AsClause', 'name': 'e', 'range': [3627, 3628], 'children': []}, {'type': 'ExceptBlockBody', 'name': '', 'range': [3629, 3653], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [3631, 3637], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [3631, 3637], 'children': [{'type': 'Argument', 'name': 'Failed to get API key: {str(e)}', 'range': [3635, 3636], 'children': []}]}]}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [3639, 3652], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [3640, 3652], 'children': [{'type': 'Argument', 'name': 'status_code', 'range': [3642, 3644], 'children': []}, {'type': 'Argument', 'name': 'detail', 'range': [3646, 3648], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:30:23,208 - INFO - Completed main AST analysis flow
2025-01-08 10:30:23,209 - INFO - Successfully processed chunk
2025-01-08 10:30:36,219 - INFO - Step 4 result: {'type': 'Program', 'name': 'update_permissions', 'range': [3966, 4132], 'children': [{'type': 'FunctionDecl', 'name': 'update_permissions', 'range': [3966, 4132], 'children': [{'type': 'Decorator', 'name': 'v1_router.put', 'range': [3966, 4007], 'children': [{'type': 'CallExpression', 'name': '', 'range': [3966, 4007], 'children': [{'type': 'MemberExpression', 'name': 'v1_router.put', 'range': [3966, 3969], 'children': []}, {'type': 'Literal', 'name': '"/api-keys/{key_id}/permissions"', 'range': [3972, 3972], 'children': []}, {'type': 'Keyword', 'name': 'response_model', 'range': [3975, 3975], 'children': []}, {'type': 'TypeExpression', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3977, 3987], 'children': []}, {'type': 'Keyword', 'name': 'tags', 'range': [3990, 3990], 'children': []}, {'type': 'ArrayExpression', 'name': '["api-keys"]', 'range': [3992, 3994], 'children': []}, {'type': 'Keyword', 'name': 'dependencies', 'range': [3997, 3997], 'children': []}, {'type': 'ArrayExpression', 'name': '[Depends(auth_middleware)]', 'range': [3999, 4004], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [4009, 4013], 'children': [{'type': 'CallExpression', 'name': '', 'range': [4009, 4013], 'children': [{'type': 'Literal', 'name': '"api-keys-enabled"', 'range': [4012, 4012], 'children': []}]}]}, {'type': 'FunctionSignature', 'name': 'update_permissions', 'range': [4015, 4050], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [4020, 4022], 'children': [{'type': 'TypeAnnotation', 'name': ': str', 'range': [4021, 4022], 'children': []}]}, {'type': 'Parameter', 'name': 'request', 'range': [4025, 4027], 'children': [{'type': 'TypeAnnotation', 'name': ': UpdatePermissionsRequest', 'range': [4026, 4027], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [4030, 4040], 'children': [{'type': 'TypeAnnotation', 'name': ': Annotated[str, Depends(get_user_id)]', 'range': [4031, 4040], 'children': []}]}, {'type': 'ReturnTypeAnnotation', 'name': '-> Optional[APIKeyWithoutHash]', 'range': [4044, 4050], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [4051, 4132], 'children': [{'type': 'TryStatement', 'name': '', 'range': [4056, 4132], 'children': [{'type': 'Block', 'name': '', 'range': [4058, 4071], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [4059, 4070], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [4060, 4070], 'children': [{'type': 'CallExpression', 'name': 'update_api_key_permissions', 'range': [4061, 4070], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [4063, 4063], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [4065, 4065], 'children': []}, {'type': 'MemberExpression', 'name': 'request.permissions', 'range': [4067, 4069], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyNotFoundError', 'range': [4072, 4087], 'children': [{'type': 'Block', 'name': '', 'range': [4074, 4087], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [4076, 4086], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4077, 4086], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4079, 4079], 'children': []}, {'type': 'Literal', 'name': '404', 'range': [4081, 4081], 'children': []}, {'type': 'Keyword', 'name': 'detail', 'range': [4083, 4083], 'children': []}, {'type': 'Literal', 'name': '"API key not found"', 'range': [4085, 4085], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyPermissionError', 'range': [4088, 4103], 'children': [{'type': 'Block', 'name': '', 'range': [4090, 4103], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [4092, 4102], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4093, 4102], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4095, 4095], 'children': []}, {'type': 'Literal', 'name': '403', 'range': [4097, 4097], 'children': []}, {'type': 'Keyword', 'name': 'detail', 'range': [4099, 4099], 'children': []}, {'type': 'Literal', 'name': '"Permission denied"', 'range': [4101, 4101], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyError', 'range': [4104, 4132], 'children': [{'type': 'Block', 'name': '', 'range': [4108, 4132], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [4110, 4116], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [4110, 4116], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to update API key permissions: {str(e)}"', 'range': [4114, 4115], 'children': []}]}]}, {'type': 'RaiseStatement', 'name': '', 'range': [4118, 4131], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4119, 4131], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4121, 4121], 'children': []}, {'type': 'Literal', 'name': '400', 'range': [4123, 4123], 'children': []}, {'type': 'Keyword', 'name': 'detail', 'range': [4125, 4125], 'children': []}, {'type': 'CallExpression', 'name': 'str', 'range': [4127, 4130], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [4129, 4129], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:30:36,219 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:30:40,905 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [1540, 1949], 'children': [{'type': 'FunctionDecl', 'name': 'update_graph', 'range': [1599, 1949], 'children': [{'type': 'Decorator', 'name': '@v1_router.put', 'range': [1540, 1565], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1546, 1548], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [1550, 1554], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [1556, 1563], 'children': []}]}, {'type': 'Decorator', 'name': '@v1_router.put', 'range': [1567, 1597], 'children': [{'type': 'Argument', 'name': 'path', 'range': [1573, 1575], 'children': []}, {'type': 'Argument', 'name': 'tags', 'range': [1578, 1584], 'children': []}, {'type': 'Argument', 'name': 'dependencies', 'range': [1587, 1594], 'children': []}]}, {'type': 'FunctionSignature', 'name': 'update_graph', 'range': [1599, 1635], 'children': [{'type': 'Parameter', 'name': 'graph_id', 'range': [1604, 1606], 'children': []}, {'type': 'Parameter', 'name': 'graph', 'range': [1609, 1614], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1616, 1627], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [1636, 1949], 'children': [{'type': 'Comment', 'name': '# Sanity check', 'range': [1637, 1640], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1641, 1663], 'children': [{'type': 'Condition', 'name': '', 'range': [1642, 1651], 'children': []}, {'type': 'Body', 'name': '', 'range': [1652, 1663], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1654, 1662], 'children': []}]}]}, {'type': 'Comment', 'name': '# Determine new version', 'range': [1665, 1669], 'children': []}, {'type': 'VariableDecl', 'name': 'existing_versions', 'range': [1670, 1683], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1684, 1699], 'children': [{'type': 'Condition', 'name': '', 'range': [1685, 1686], 'children': []}, {'type': 'Body', 'name': '', 'range': [1687, 1699], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1689, 1698], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'latest_version_number', 'range': [1700, 1712], 'children': []}, {'type': 'Assignment', 'name': 'graph.version', 'range': [1713, 1720], 'children': []}, {'type': 'VariableDecl', 'name': 'latest_version_graph', 'range': [1722, 1741], 'children': []}, {'type': 'VariableDecl', 'name': 'current_active_version', 'range': [1742, 1760], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1761, 1783], 'children': [{'type': 'Condition', 'name': '', 'range': [1762, 1769], 'children': []}, {'type': 'Body', 'name': '', 'range': [1770, 1783], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [1772, 1782], 'children': []}]}]}, {'type': 'Assignment', 'name': 'graph.is_active', 'range': [1784, 1792], 'children': []}, {'type': 'Assignment', 'name': 'graph', 'range': [1793, 1803], 'children': []}, {'type': 'CallExpression', 'name': 'graph.reassign_ids', 'range': [1804, 1812], 'children': []}, {'type': 'VariableDecl', 'name': 'new_graph_version', 'range': [1814, 1827], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [1829, 1918], 'children': [{'type': 'Condition', 'name': '', 'range': [1830, 1833], 'children': []}, {'type': 'Body', 'name': '', 'range': [1834, 1918], 'children': [{'type': 'FunctionDecl', 'name': 'get_credentials', 'range': [1836, 1857], 'children': []}, {'type': 'Comment', 'name': '# Handle activation of the new graph first to ensure continuity', 'range': [1859, 1870], 'children': []}, {'type': 'Assignment', 'name': 'new_graph_version', 'range': [1871, 1886], 'children': []}, {'type': 'Comment', 'name': '# Ensure new version is the only active version', 'range': [1887, 1896], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.set_graph_active_version', 'range': [1897, 1917], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [1919, 1946], 'children': [{'type': 'Condition', 'name': '', 'range': [1920, 1921], 'children': []}, {'type': 'Body', 'name': '', 'range': [1922, 1946], 'children': [{'type': 'Comment', 'name': '# Handle deactivation of the previously active version', 'range': [1923, 1931], 'children': []}, {'type': 'CallExpression', 'name': 'on_graph_deactivate', 'range': [1932, 1945], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [1947, 1949], 'children': []}]}]}]}
2025-01-08 10:30:40,905 - INFO - Completed main AST analysis flow
2025-01-08 10:30:40,908 - INFO - Successfully processed chunk
2025-01-08 10:30:49,963 - INFO - Step 4 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [0, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [3, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'defaultdict', 'range': [7, 9], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [11, 21], 'children': [{'type': 'ImportSpecifier', 'name': 'TYPE_CHECKING', 'range': [12, 14], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Annotated', 'range': [16, 16], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Any', 'range': [18, 18], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Sequence', 'range': [20, 20], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [23, 25], 'children': [{'type': 'ImportSpecifier', 'name': 'pydantic', 'range': [23, 24], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [26, 34], 'children': [{'type': 'ImportSpecifier', 'name': 'auth_middleware', 'range': [27, 33], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [35, 43], 'children': [{'type': 'ImportSpecifier', 'name': 'feature_flag', 'range': [36, 42], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [44, 52], 'children': [{'type': 'ImportSpecifier', 'name': 'thread_cached', 'range': [45, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 61], 'children': [{'type': 'ImportSpecifier', 'name': 'APIRouter', 'range': [54, 56], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Depends', 'range': [58, 58], 'children': []}, {'type': 'ImportSpecifier', 'name': 'HTTPException', 'range': [60, 60], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [62, 68], 'children': [{'type': 'ImportSpecifier', 'name': 'Optional', 'range': [63, 65], 'children': []}, {'type': 'ImportSpecifier', 'name': 'TypedDict', 'range': [67, 67], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [70, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'block', 'range': [71, 75], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [77, 85], 'children': [{'type': 'ImportSpecifier', 'name': 'router', 'range': [78, 84], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [86, 94], 'children': [{'type': 'ImportSpecifier', 'name': 'analytics', 'range': [87, 93], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [95, 103], 'children': [{'type': 'ImportSpecifier', 'name': 'execution_db', 'range': [96, 102], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [104, 112], 'children': [{'type': 'ImportSpecifier', 'name': 'graph_db', 'range': [105, 111], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [113, 153], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyError', 'range': [122, 122], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyNotFoundError', 'range': [125, 125], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyPermissionError', 'range': [128, 128], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWithoutHash', 'range': [131, 131], 'children': []}, {'type': 'ImportSpecifier', 'name': 'generate_api_key', 'range': [134, 134], 'children': []}, {'type': 'ImportSpecifier', 'name': 'get_api_key_by_id', 'range': [137, 137], 'children': []}, {'type': 'ImportSpecifier', 'name': 'list_user_api_keys', 'range': [140, 140], 'children': []}, {'type': 'ImportSpecifier', 'name': 'revoke_api_key', 'range': [143, 143], 'children': []}, {'type': 'ImportSpecifier', 'name': 'suspend_api_key', 'range': [146, 146], 'children': []}, {'type': 'ImportSpecifier', 'name': 'update_api_key_permissions', 'range': [149, 149], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [154, 164], 'children': [{'type': 'ImportSpecifier', 'name': 'BlockInput', 'range': [155, 161], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CompletedBlockOutput', 'range': [163, 163], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [165, 175], 'children': [{'type': 'ImportSpecifier', 'name': 'get_block_costs', 'range': [166, 172], 'children': []}, {'type': 'ImportSpecifier', 'name': 'get_user_credit_model', 'range': [174, 174], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [176, 184], 'children': [{'type': 'ImportSpecifier', 'name': 'get_or_create_user', 'range': [177, 183], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [185, 195], 'children': [{'type': 'ImportSpecifier', 'name': 'ExecutionManager', 'range': [186, 190], 'children': []}, {'type': 'ImportSpecifier', 'name': 'ExecutionScheduler', 'range': [192, 192], 'children': []}, {'type': 'ImportSpecifier', 'name': 'scheduler', 'range': [194, 194], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [196, 204], 'children': [{'type': 'ImportSpecifier', 'name': 'IntegrationCredentialsManager', 'range': [197, 203], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [205, 223], 'children': [{'type': 'ImportSpecifier', 'name': 'on_graph_activate', 'range': [206, 216], 'children': []}, {'type': 'ImportSpecifier', 'name': 'on_graph_deactivate', 'range': [218, 218], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [224, 249], 'children': [{'type': 'ImportSpecifier', 'name': 'CreateAPIKeyRequest', 'range': [225, 233], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CreateAPIKeyResponse', 'range': [235, 235], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CreateGraph', 'range': [237, 239], 'children': []}, {'type': 'ImportSpecifier', 'name': 'SetGraphActiveVersion', 'range': [241, 242], 'children': []}, {'type': 'ImportSpecifier', 'name': 'UpdatePermissionsRequest', 'range': [244, 246], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [250, 258], 'children': [{'type': 'ImportSpecifier', 'name': 'get_user_id', 'range': [251, 257], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [259, 267], 'children': [{'type': 'ImportSpecifier', 'name': 'get_service_client', 'range': [260, 266], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [268, 276], 'children': [{'type': 'ImportSpecifier', 'name': 'Settings', 'range': [269, 275], 'children': []}]}]}
2025-01-08 10:30:49,964 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:31:18,596 - INFO - Step 5 result: {'type': 'Program', 'name': 'update_permissions', 'range': [3966, 4132], 'children': [{'type': 'FunctionDecl', 'name': 'update_permissions', 'range': [3966, 4132], 'children': [{'type': 'Decorator', 'name': 'v1_router.put', 'range': [3966, 4007], 'children': [{'type': 'CallExpression', 'name': '', 'range': [3966, 4007], 'children': [{'type': 'MemberExpression', 'name': 'v1_router.put', 'range': [3966, 3969], 'children': []}, {'type': 'Literal', 'name': '"/api-keys/{key_id}/permissions"', 'range': [3972, 3972], 'children': []}, {'type': 'Keyword', 'name': 'response_model', 'range': [3975, 3975], 'children': []}, {'type': 'TypeExpression', 'name': 'list[APIKeyWithoutHash] | dict[str, str]', 'range': [3977, 3987], 'children': []}, {'type': 'Keyword', 'name': 'tags', 'range': [3990, 3990], 'children': []}, {'type': 'ArrayExpression', 'name': '["api-keys"]', 'range': [3992, 3994], 'children': []}, {'type': 'Keyword', 'name': 'dependencies', 'range': [3997, 3997], 'children': []}, {'type': 'ArrayExpression', 'name': '[Depends(auth_middleware)]', 'range': [3999, 4004], 'children': []}]}]}, {'type': 'Decorator', 'name': 'feature_flag', 'range': [4009, 4013], 'children': [{'type': 'CallExpression', 'name': '', 'range': [4009, 4013], 'children': [{'type': 'Literal', 'name': '"api-keys-enabled"', 'range': [4012, 4012], 'children': []}]}]}, {'type': 'FunctionSignature', 'name': 'update_permissions', 'range': [4015, 4050], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [4020, 4022], 'children': [{'type': 'TypeAnnotation', 'name': ': str', 'range': [4021, 4022], 'children': []}]}, {'type': 'Parameter', 'name': 'request', 'range': [4025, 4027], 'children': [{'type': 'TypeAnnotation', 'name': ': UpdatePermissionsRequest', 'range': [4026, 4027], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [4030, 4040], 'children': [{'type': 'TypeAnnotation', 'name': ': Annotated[str, Depends(get_user_id)]', 'range': [4031, 4040], 'children': []}]}, {'type': 'ReturnTypeAnnotation', 'name': '-> Optional[APIKeyWithoutHash]', 'range': [4044, 4050], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [4051, 4132], 'children': [{'type': 'TryStatement', 'name': '', 'range': [4056, 4132], 'children': [{'type': 'Block', 'name': '', 'range': [4058, 4071], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [4059, 4070], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [4060, 4070], 'children': [{'type': 'CallExpression', 'name': 'update_api_key_permissions', 'range': [4061, 4070], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [4063, 4063], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [4065, 4065], 'children': []}, {'type': 'MemberExpression', 'name': 'request.permissions', 'range': [4067, 4069], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyNotFoundError', 'range': [4072, 4087], 'children': [{'type': 'Block', 'name': '', 'range': [4074, 4087], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [4076, 4086], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4077, 4086], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4079, 4079], 'children': []}, {'type': 'Literal', 'name': '404', 'range': [4081, 4081], 'children': []}, {'type': 'Keyword', 'name': 'detail', 'range': [4083, 4083], 'children': []}, {'type': 'Literal', 'name': '"API key not found"', 'range': [4085, 4085], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyPermissionError', 'range': [4088, 4103], 'children': [{'type': 'Block', 'name': '', 'range': [4090, 4103], 'children': [{'type': 'RaiseStatement', 'name': '', 'range': [4092, 4102], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4093, 4102], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4095, 4095], 'children': []}, {'type': 'Literal', 'name': '403', 'range': [4097, 4097], 'children': []}, {'type': 'Keyword', 'name': 'detail', 'range': [4099, 4099], 'children': []}, {'type': 'Literal', 'name': '"Permission denied"', 'range': [4101, 4101], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'APIKeyError', 'range': [4104, 4132], 'children': [{'type': 'Block', 'name': '', 'range': [4108, 4132], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [4110, 4116], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [4110, 4116], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to update API key permissions: {str(e)}"', 'range': [4114, 4115], 'children': []}]}]}, {'type': 'RaiseStatement', 'name': '', 'range': [4118, 4131], 'children': [{'type': 'CallExpression', 'name': 'HTTPException', 'range': [4119, 4131], 'children': [{'type': 'Keyword', 'name': 'status_code', 'range': [4121, 4121], 'children': []}, {'type': 'Literal', 'name': '400', 'range': [4123, 4123], 'children': []}, {'type': 'Keyword', 'name': 'detail', 'range': [4125, 4125], 'children': []}, {'type': 'CallExpression', 'name': 'str', 'range': [4127, 4130], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [4129, 4129], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 10:31:18,597 - INFO - Completed main AST analysis flow
2025-01-08 10:31:18,599 - INFO - Successfully processed chunk
2025-01-08 10:31:39,867 - INFO - Step 5 result: {'type': 'Program', 'name': 'MainProgram', 'range': [0, 276], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [0, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [3, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'defaultdict', 'range': [7, 9], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [11, 21], 'children': [{'type': 'ImportSpecifier', 'name': 'TYPE_CHECKING', 'range': [12, 14], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Annotated', 'range': [16, 16], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Any', 'range': [18, 18], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Sequence', 'range': [20, 20], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [23, 25], 'children': [{'type': 'ImportSpecifier', 'name': 'pydantic', 'range': [23, 24], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [26, 34], 'children': [{'type': 'ImportSpecifier', 'name': 'auth_middleware', 'range': [27, 33], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [35, 43], 'children': [{'type': 'ImportSpecifier', 'name': 'feature_flag', 'range': [36, 42], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [44, 52], 'children': [{'type': 'ImportSpecifier', 'name': 'thread_cached', 'range': [45, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 61], 'children': [{'type': 'ImportSpecifier', 'name': 'APIRouter', 'range': [54, 56], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Depends', 'range': [58, 58], 'children': []}, {'type': 'ImportSpecifier', 'name': 'HTTPException', 'range': [60, 60], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [62, 68], 'children': [{'type': 'ImportSpecifier', 'name': 'Optional', 'range': [63, 65], 'children': []}, {'type': 'ImportSpecifier', 'name': 'TypedDict', 'range': [67, 67], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [70, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'block', 'range': [71, 75], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [77, 85], 'children': [{'type': 'ImportSpecifier', 'name': 'router', 'range': [78, 84], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [86, 94], 'children': [{'type': 'ImportSpecifier', 'name': 'analytics', 'range': [87, 93], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [95, 103], 'children': [{'type': 'ImportSpecifier', 'name': 'execution_db', 'range': [96, 102], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [104, 112], 'children': [{'type': 'ImportSpecifier', 'name': 'graph_db', 'range': [105, 111], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [113, 153], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyError', 'range': [122, 122], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyNotFoundError', 'range': [125, 125], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyPermissionError', 'range': [128, 128], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWithoutHash', 'range': [131, 131], 'children': []}, {'type': 'ImportSpecifier', 'name': 'generate_api_key', 'range': [134, 134], 'children': []}, {'type': 'ImportSpecifier', 'name': 'get_api_key_by_id', 'range': [137, 137], 'children': []}, {'type': 'ImportSpecifier', 'name': 'list_user_api_keys', 'range': [140, 140], 'children': []}, {'type': 'ImportSpecifier', 'name': 'revoke_api_key', 'range': [143, 143], 'children': []}, {'type': 'ImportSpecifier', 'name': 'suspend_api_key', 'range': [146, 146], 'children': []}, {'type': 'ImportSpecifier', 'name': 'update_api_key_permissions', 'range': [149, 149], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [154, 164], 'children': [{'type': 'ImportSpecifier', 'name': 'BlockInput', 'range': [155, 161], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CompletedBlockOutput', 'range': [163, 163], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [165, 175], 'children': [{'type': 'ImportSpecifier', 'name': 'get_block_costs', 'range': [166, 172], 'children': []}, {'type': 'ImportSpecifier', 'name': 'get_user_credit_model', 'range': [174, 174], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [176, 184], 'children': [{'type': 'ImportSpecifier', 'name': 'get_or_create_user', 'range': [177, 183], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [185, 195], 'children': [{'type': 'ImportSpecifier', 'name': 'ExecutionManager', 'range': [186, 190], 'children': []}, {'type': 'ImportSpecifier', 'name': 'ExecutionScheduler', 'range': [192, 192], 'children': []}, {'type': 'ImportSpecifier', 'name': 'scheduler', 'range': [194, 194], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [196, 204], 'children': [{'type': 'ImportSpecifier', 'name': 'IntegrationCredentialsManager', 'range': [197, 203], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [205, 223], 'children': [{'type': 'ImportSpecifier', 'name': 'on_graph_activate', 'range': [206, 216], 'children': []}, {'type': 'ImportSpecifier', 'name': 'on_graph_deactivate', 'range': [218, 218], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [224, 249], 'children': [{'type': 'ImportSpecifier', 'name': 'CreateAPIKeyRequest', 'range': [225, 233], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CreateAPIKeyResponse', 'range': [235, 235], 'children': []}, {'type': 'ImportSpecifier', 'name': 'CreateGraph', 'range': [237, 239], 'children': []}, {'type': 'ImportSpecifier', 'name': 'SetGraphActiveVersion', 'range': [241, 242], 'children': []}, {'type': 'ImportSpecifier', 'name': 'UpdatePermissionsRequest', 'range': [244, 246], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [250, 258], 'children': [{'type': 'ImportSpecifier', 'name': 'get_user_id', 'range': [251, 257], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [259, 267], 'children': [{'type': 'ImportSpecifier', 'name': 'get_service_client', 'range': [260, 266], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [268, 276], 'children': [{'type': 'ImportSpecifier', 'name': 'Settings', 'range': [269, 275], 'children': []}]}]}
2025-01-08 10:31:39,867 - INFO - Completed main AST analysis flow
2025-01-08 10:31:39,870 - INFO - Successfully processed chunk
2025-01-08 10:31:42,991 - INFO - Step 3 result: {'type': 'Program', 'name': 'do_create_graph', 'range': [1204, 1418], 'children': [{'type': 'FunctionDeclaration', 'name': 'do_create_graph', 'range': [1204, 1418], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1204, 1204], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1205, 1205], 'children': []}, {'type': 'Identifier', 'name': 'do_create_graph', 'range': [1206, 1206], 'children': []}, {'type': 'Parameter', 'name': 'create_graph', 'range': [1209, 1211], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1209, 1209], 'children': []}, {'type': 'TypeAnnotation', 'name': 'CreateGraph', 'range': [1211, 1211], 'children': []}]}, {'type': 'Parameter', 'name': 'is_template', 'range': [1214, 1216], 'children': [{'type': 'Identifier', 'name': 'is_template', 'range': [1214, 1214], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [1216, 1216], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1230, 1232], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [1230, 1230], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1232, 1232], 'children': []}]}, {'type': 'ReturnType', 'name': '->', 'range': [1236, 1237], 'children': []}, {'type': 'TypeAnnotation', 'name': 'graph_db.GraphModel', 'range': [1238, 1240], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1238, 1238], 'children': []}, {'type': 'Identifier', 'name': 'GraphModel', 'range': [1240, 1240], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [1242, 1418], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [1243, 1261], 'children': [{'type': 'Expression', 'name': 'create_graph.graph', 'range': [1244, 1247], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1244, 1244], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1246, 1246], 'children': []}]}, {'type': 'Assignment', 'name': 'graph = graph_db.make_graph_model(create_graph.graph, user_id)', 'range': [1249, 1260], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1249, 1249], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.make_graph_model', 'range': [1251, 1260], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1251, 1251], 'children': []}, {'type': 'Identifier', 'name': 'make_graph_model', 'range': [1253, 1253], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1255, 1255], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1257, 1257], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1259, 1259], 'children': []}]}]}]}, {'type': 'ElifStatement', 'name': 'elif', 'range': [1262, 1306], 'children': [{'type': 'Expression', 'name': 'create_graph.template_id', 'range': [1263, 1266], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1263, 1263], 'children': []}, {'type': 'Identifier', 'name': 'template_id', 'range': [1265, 1265], 'children': []}]}, {'type': 'Assignment', 'name': 'graph = await graph_db.get_graph(create_graph.template_id, create_graph.template_version, template=True, user_id=user_id)', 'range': [1277, 1305], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1277, 1277], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1279, 1279], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.get_graph', 'range': [1280, 1305], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1280, 1280], 'children': []}, {'type': 'Identifier', 'name': 'get_graph', 'range': [1282, 1282], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1285, 1285], 'children': []}, {'type': 'Identifier', 'name': 'template_id', 'range': [1287, 1287], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1290, 1290], 'children': []}, {'type': 'Identifier', 'name': 'template_version', 'range': [1292, 1292], 'children': []}, {'type': 'Keyword', 'name': 'template', 'range': [1295, 1295], 'children': []}, {'type': 'Boolean', 'name': 'True', 'range': [1297, 1297], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1300, 1300], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1302, 1302], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1307, 1324], 'children': [{'type': 'Expression', 'name': 'not graph', 'range': [1308, 1309], 'children': [{'type': 'Keyword', 'name': 'not', 'range': [1308, 1308], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1309, 1309], 'children': []}]}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(400, detail=f"Template #{create_graph.template_id} not found")', 'range': [1312, 1323], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1312, 1312], 'children': []}, {'type': 'CallExpression', 'name': 'HTTPException', 'range': [1313, 1323], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1313, 1313], 'children': []}, {'type': 'NumericLiteral', 'name': '400', 'range': [1316, 1316], 'children': []}, {'type': 'Identifier', 'name': 'detail', 'range': [1318, 1318], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Template #{create_graph.template_id} not found"', 'range': [1320, 1321], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'graph.version = 1', 'range': [1325, 1329], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1325, 1325], 'children': []}, {'type': 'Identifier', 'name': 'version', 'range': [1327, 1327], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [1329, 1329], 'children': []}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [1331, 1347], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=400, detail="Either graph or template_id must be provided.")', 'range': [1334, 1346], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1334, 1334], 'children': []}, {'type': 'CallExpression', 'name': 'HTTPException', 'range': [1335, 1346], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1335, 1335], 'children': []}, {'type': 'Identifier', 'name': 'status_code', 'range': [1338, 1338], 'children': []}, {'type': 'NumericLiteral', 'name': '400', 'range': [1340, 1340], 'children': []}, {'type': 'Identifier', 'name': 'detail', 'range': [1342, 1342], 'children': []}, {'type': 'StringLiteral', 'name': '"Either graph or template_id must be provided."', 'range': [1344, 1344], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'graph.is_template = is_template', 'range': [1349, 1353], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1349, 1349], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1351, 1351], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1353, 1353], 'children': []}]}, {'type': 'Assignment', 'name': 'graph.is_active = not is_template', 'range': [1355, 1361], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1355, 1355], 'children': []}, {'type': 'Identifier', 'name': 'is_active', 'range': [1357, 1357], 'children': []}, {'type': 'Keyword', 'name': 'not', 'range': [1359, 1359], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1360, 1360], 'children': []}]}, {'type': 'CallExpression', 'name': 'graph.reassign_ids(user_id=user_id, reassign_graph_id=True)', 'range': [1363, 1373], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1363, 1363], 'children': []}, {'type': 'Identifier', 'name': 'reassign_ids', 'range': [1365, 1365], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1367, 1367], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1369, 1369], 'children': []}, {'type': 'Identifier', 'name': 'reassign_graph_id', 'range': [1371, 1371], 'children': []}, {'type': 'Boolean', 'name': 'True', 'range': [1373, 1373], 'children': []}]}, {'type': 'Assignment', 'name': 'graph = await graph_db.create_graph(graph, user_id=user_id)', 'range': [1376, 1388], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1376, 1376], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1378, 1378], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.create_graph', 'range': [1379, 1388], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1379, 1379], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1381, 1381], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1383, 1383], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1385, 1385], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1387, 1387], 'children': []}]}]}, {'type': 'Assignment', 'name': 'graph = await on_graph_activate(graph, get_credentials=lambda id: integration_creds_manager.get(user_id, id))', 'range': [1390, 1415], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1390, 1390], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1392, 1392], 'children': []}, {'type': 'CallExpression', 'name': 'on_graph_activate', 'range': [1393, 1415], 'children': [{'type': 'Identifier', 'name': 'on_graph_activate', 'range': [1393, 1393], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1396, 1396], 'children': []}, {'type': 'LambdaExpression', 'name': 'get_credentials=lambda id: integration_creds_manager.get(user_id, id)', 'range': [1399, 1414], 'children': [{'type': 'Identifier', 'name': 'get_credentials', 'range': [1399, 1399], 'children': []}, {'type': 'Keyword', 'name': 'lambda', 'range': [1401, 1401], 'children': []}, {'type': 'Identifier', 'name': 'id', 'range': [1402, 1402], 'children': []}, {'type': 'CallExpression', 'name': 'integration_creds_manager.get', 'range': [1404, 1414], 'children': [{'type': 'Identifier', 'name': 'integration_creds_manager', 'range': [1404, 1404], 'children': []}, {'type': 'Identifier', 'name': 'get', 'range': [1406, 1406], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1408, 1408], 'children': []}, {'type': 'Identifier', 'name': 'id', 'range': [1410, 1410], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return graph', 'range': [1416, 1417], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [1416, 1416], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1417, 1417], 'children': []}]}]}]}]}
2025-01-08 10:31:42,992 - INFO - Starting Step 4: AST normalization
2025-01-08 10:33:03,477 - INFO - Step 4 result: {'type': 'Program', 'name': 'do_create_graph', 'range': [1204, 1418], 'children': [{'type': 'FunctionDecl', 'name': 'do_create_graph', 'range': [1204, 1418], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1204, 1204], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1205, 1205], 'children': []}, {'type': 'Identifier', 'name': 'do_create_graph', 'range': [1206, 1206], 'children': []}, {'type': 'Parameter', 'name': 'create_graph', 'range': [1209, 1211], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1209, 1209], 'children': []}, {'type': 'TypeAnnotation', 'name': 'CreateGraph', 'range': [1211, 1211], 'children': []}]}, {'type': 'Parameter', 'name': 'is_template', 'range': [1214, 1216], 'children': [{'type': 'Identifier', 'name': 'is_template', 'range': [1214, 1214], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [1216, 1216], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1230, 1232], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [1230, 1230], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1232, 1232], 'children': []}]}, {'type': 'ReturnType', 'name': '->', 'range': [1236, 1237], 'children': []}, {'type': 'TypeAnnotation', 'name': 'graph_db.GraphModel', 'range': [1238, 1240], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1238, 1238], 'children': []}, {'type': 'Identifier', 'name': 'GraphModel', 'range': [1240, 1240], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [1242, 1418], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [1243, 1261], 'children': [{'type': 'BinaryExpression', 'name': 'create_graph.graph', 'range': [1244, 1247], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1244, 1244], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1246, 1246], 'children': []}]}, {'type': 'Assignment', 'name': 'graph = graph_db.make_graph_model(create_graph.graph, user_id)', 'range': [1249, 1260], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1249, 1249], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.make_graph_model', 'range': [1251, 1260], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1251, 1251], 'children': []}, {'type': 'Identifier', 'name': 'make_graph_model', 'range': [1253, 1253], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1255, 1255], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1257, 1257], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1259, 1259], 'children': []}]}]}]}, {'type': 'ElifStatement', 'name': 'elif', 'range': [1262, 1306], 'children': [{'type': 'BinaryExpression', 'name': 'create_graph.template_id', 'range': [1263, 1266], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1263, 1263], 'children': []}, {'type': 'Identifier', 'name': 'template_id', 'range': [1265, 1265], 'children': []}]}, {'type': 'Assignment', 'name': 'graph = await graph_db.get_graph(create_graph.template_id, create_graph.template_version, template=True, user_id=user_id)', 'range': [1277, 1305], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1277, 1277], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1279, 1279], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.get_graph', 'range': [1280, 1305], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1280, 1280], 'children': []}, {'type': 'Identifier', 'name': 'get_graph', 'range': [1282, 1282], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1285, 1285], 'children': []}, {'type': 'Identifier', 'name': 'template_id', 'range': [1287, 1287], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1290, 1290], 'children': []}, {'type': 'Identifier', 'name': 'template_version', 'range': [1292, 1292], 'children': []}, {'type': 'Keyword', 'name': 'template', 'range': [1295, 1295], 'children': []}, {'type': 'Boolean', 'name': 'True', 'range': [1297, 1297], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1300, 1300], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1302, 1302], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1307, 1324], 'children': [{'type': 'UnaryExpression', 'name': 'not graph', 'range': [1308, 1309], 'children': [{'type': 'Keyword', 'name': 'not', 'range': [1308, 1308], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1309, 1309], 'children': []}]}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(400, detail=f"Template #{create_graph.template_id} not found")', 'range': [1312, 1323], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1312, 1312], 'children': []}, {'type': 'CallExpression', 'name': 'HTTPException', 'range': [1313, 1323], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1313, 1313], 'children': []}, {'type': 'NumericLiteral', 'name': '400', 'range': [1316, 1316], 'children': []}, {'type': 'Identifier', 'name': 'detail', 'range': [1318, 1318], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Template #{create_graph.template_id} not found"', 'range': [1320, 1321], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'graph.version = 1', 'range': [1325, 1329], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1325, 1325], 'children': []}, {'type': 'Identifier', 'name': 'version', 'range': [1327, 1327], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [1329, 1329], 'children': []}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [1331, 1347], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=400, detail="Either graph or template_id must be provided.")', 'range': [1334, 1346], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1334, 1334], 'children': []}, {'type': 'CallExpression', 'name': 'HTTPException', 'range': [1335, 1346], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1335, 1335], 'children': []}, {'type': 'Identifier', 'name': 'status_code', 'range': [1338, 1338], 'children': []}, {'type': 'NumericLiteral', 'name': '400', 'range': [1340, 1340], 'children': []}, {'type': 'Identifier', 'name': 'detail', 'range': [1342, 1342], 'children': []}, {'type': 'StringLiteral', 'name': '"Either graph or template_id must be provided."', 'range': [1344, 1344], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'graph.is_template = is_template', 'range': [1349, 1353], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1349, 1349], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1351, 1351], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1353, 1353], 'children': []}]}, {'type': 'Assignment', 'name': 'graph.is_active = not is_template', 'range': [1355, 1361], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1355, 1355], 'children': []}, {'type': 'Identifier', 'name': 'is_active', 'range': [1357, 1357], 'children': []}, {'type': 'UnaryExpression', 'name': 'not is_template', 'range': [1359, 1360], 'children': [{'type': 'Keyword', 'name': 'not', 'range': [1359, 1359], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1360, 1360], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'graph.reassign_ids(user_id=user_id, reassign_graph_id=True)', 'range': [1363, 1373], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1363, 1363], 'children': []}, {'type': 'Identifier', 'name': 'reassign_ids', 'range': [1365, 1365], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1367, 1367], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1369, 1369], 'children': []}, {'type': 'Identifier', 'name': 'reassign_graph_id', 'range': [1371, 1371], 'children': []}, {'type': 'Boolean', 'name': 'True', 'range': [1373, 1373], 'children': []}]}, {'type': 'Assignment', 'name': 'graph = await graph_db.create_graph(graph, user_id=user_id)', 'range': [1376, 1388], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1376, 1376], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1378, 1378], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.create_graph', 'range': [1379, 1388], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1379, 1379], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1381, 1381], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1383, 1383], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1385, 1385], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1387, 1387], 'children': []}]}]}, {'type': 'Assignment', 'name': 'graph = await on_graph_activate(graph, get_credentials=lambda id: integration_creds_manager.get(user_id, id))', 'range': [1390, 1415], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1390, 1390], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1392, 1392], 'children': []}, {'type': 'CallExpression', 'name': 'on_graph_activate', 'range': [1393, 1415], 'children': [{'type': 'Identifier', 'name': 'on_graph_activate', 'range': [1393, 1393], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1396, 1396], 'children': []}, {'type': 'LambdaExpression', 'name': 'get_credentials=lambda id: integration_creds_manager.get(user_id, id)', 'range': [1399, 1414], 'children': [{'type': 'Identifier', 'name': 'get_credentials', 'range': [1399, 1399], 'children': []}, {'type': 'Keyword', 'name': 'lambda', 'range': [1401, 1401], 'children': []}, {'type': 'Identifier', 'name': 'id', 'range': [1402, 1402], 'children': []}, {'type': 'CallExpression', 'name': 'integration_creds_manager.get', 'range': [1404, 1414], 'children': [{'type': 'Identifier', 'name': 'integration_creds_manager', 'range': [1404, 1404], 'children': []}, {'type': 'Identifier', 'name': 'get', 'range': [1406, 1406], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1408, 1408], 'children': []}, {'type': 'Identifier', 'name': 'id', 'range': [1410, 1410], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return graph', 'range': [1416, 1417], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [1416, 1416], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1417, 1417], 'children': []}]}]}]}]}
2025-01-08 10:33:03,477 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:34:23,760 - INFO - Step 5 result: {'type': 'Program', 'name': 'do_create_graph', 'range': [1204, 1418], 'children': [{'type': 'FunctionDecl', 'name': 'do_create_graph', 'range': [1204, 1418], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1204, 1204], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1205, 1205], 'children': []}, {'type': 'Identifier', 'name': 'do_create_graph', 'range': [1206, 1206], 'children': []}, {'type': 'Parameter', 'name': 'create_graph', 'range': [1209, 1211], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1209, 1209], 'children': []}, {'type': 'TypeAnnotation', 'name': 'CreateGraph', 'range': [1211, 1211], 'children': []}]}, {'type': 'Parameter', 'name': 'is_template', 'range': [1214, 1216], 'children': [{'type': 'Identifier', 'name': 'is_template', 'range': [1214, 1214], 'children': []}, {'type': 'TypeAnnotation', 'name': 'bool', 'range': [1216, 1216], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1230, 1232], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [1230, 1230], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1232, 1232], 'children': []}]}, {'type': 'ReturnType', 'name': '->', 'range': [1236, 1237], 'children': []}, {'type': 'TypeAnnotation', 'name': 'graph_db.GraphModel', 'range': [1238, 1240], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1238, 1238], 'children': []}, {'type': 'Identifier', 'name': 'GraphModel', 'range': [1240, 1240], 'children': []}]}, {'type': 'Block', 'name': 'FunctionBody', 'range': [1242, 1418], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [1243, 1261], 'children': [{'type': 'BinaryExpression', 'name': 'create_graph.graph', 'range': [1244, 1247], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1244, 1244], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1246, 1246], 'children': []}]}, {'type': 'Assignment', 'name': 'graph = graph_db.make_graph_model(create_graph.graph, user_id)', 'range': [1249, 1260], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1249, 1249], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.make_graph_model', 'range': [1251, 1260], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1251, 1251], 'children': []}, {'type': 'Identifier', 'name': 'make_graph_model', 'range': [1253, 1253], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1255, 1255], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1257, 1257], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1259, 1259], 'children': []}]}]}]}, {'type': 'ElifStatement', 'name': 'elif', 'range': [1262, 1306], 'children': [{'type': 'BinaryExpression', 'name': 'create_graph.template_id', 'range': [1263, 1266], 'children': [{'type': 'Identifier', 'name': 'create_graph', 'range': [1263, 1263], 'children': []}, {'type': 'Identifier', 'name': 'template_id', 'range': [1265, 1265], 'children': []}]}, {'type': 'Assignment', 'name': 'graph = await graph_db.get_graph(create_graph.template_id, create_graph.template_version, template=True, user_id=user_id)', 'range': [1277, 1305], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1277, 1277], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1279, 1279], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.get_graph', 'range': [1280, 1305], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1280, 1280], 'children': []}, {'type': 'Identifier', 'name': 'get_graph', 'range': [1282, 1282], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1285, 1285], 'children': []}, {'type': 'Identifier', 'name': 'template_id', 'range': [1287, 1287], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1290, 1290], 'children': []}, {'type': 'Identifier', 'name': 'template_version', 'range': [1292, 1292], 'children': []}, {'type': 'Keyword', 'name': 'template', 'range': [1295, 1295], 'children': []}, {'type': 'Boolean', 'name': 'True', 'range': [1297, 1297], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1300, 1300], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1302, 1302], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1307, 1324], 'children': [{'type': 'UnaryExpression', 'name': 'not graph', 'range': [1308, 1309], 'children': [{'type': 'Keyword', 'name': 'not', 'range': [1308, 1308], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1309, 1309], 'children': []}]}, {'type': 'RaiseStatement', 'name': 'raise HTTPException(400, detail=f"Template #{create_graph.template_id} not found")', 'range': [1312, 1323], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1312, 1312], 'children': []}, {'type': 'CallExpression', 'name': 'HTTPException', 'range': [1313, 1323], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1313, 1313], 'children': []}, {'type': 'NumericLiteral', 'name': '400', 'range': [1316, 1316], 'children': []}, {'type': 'Identifier', 'name': 'detail', 'range': [1318, 1318], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Template #{create_graph.template_id} not found"', 'range': [1320, 1321], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'graph.version = 1', 'range': [1325, 1329], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1325, 1325], 'children': []}, {'type': 'Identifier', 'name': 'version', 'range': [1327, 1327], 'children': []}, {'type': 'NumericLiteral', 'name': '1', 'range': [1329, 1329], 'children': []}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [1331, 1347], 'children': [{'type': 'RaiseStatement', 'name': 'raise HTTPException(status_code=400, detail="Either graph or template_id must be provided.")', 'range': [1334, 1346], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1334, 1334], 'children': []}, {'type': 'CallExpression', 'name': 'HTTPException', 'range': [1335, 1346], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [1335, 1335], 'children': []}, {'type': 'Identifier', 'name': 'status_code', 'range': [1338, 1338], 'children': []}, {'type': 'NumericLiteral', 'name': '400', 'range': [1340, 1340], 'children': []}, {'type': 'Identifier', 'name': 'detail', 'range': [1342, 1342], 'children': []}, {'type': 'StringLiteral', 'name': '"Either graph or template_id must be provided."', 'range': [1344, 1344], 'children': []}]}]}]}, {'type': 'Assignment', 'name': 'graph.is_template = is_template', 'range': [1349, 1353], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1349, 1349], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1351, 1351], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1353, 1353], 'children': []}]}, {'type': 'Assignment', 'name': 'graph.is_active = not is_template', 'range': [1355, 1361], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1355, 1355], 'children': []}, {'type': 'Identifier', 'name': 'is_active', 'range': [1357, 1357], 'children': []}, {'type': 'UnaryExpression', 'name': 'not is_template', 'range': [1359, 1360], 'children': [{'type': 'Keyword', 'name': 'not', 'range': [1359, 1359], 'children': []}, {'type': 'Identifier', 'name': 'is_template', 'range': [1360, 1360], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'graph.reassign_ids(user_id=user_id, reassign_graph_id=True)', 'range': [1363, 1373], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1363, 1363], 'children': []}, {'type': 'Identifier', 'name': 'reassign_ids', 'range': [1365, 1365], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1367, 1367], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1369, 1369], 'children': []}, {'type': 'Identifier', 'name': 'reassign_graph_id', 'range': [1371, 1371], 'children': []}, {'type': 'Boolean', 'name': 'True', 'range': [1373, 1373], 'children': []}]}, {'type': 'Assignment', 'name': 'graph = await graph_db.create_graph(graph, user_id=user_id)', 'range': [1376, 1388], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1376, 1376], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1378, 1378], 'children': []}, {'type': 'CallExpression', 'name': 'graph_db.create_graph', 'range': [1379, 1388], 'children': [{'type': 'Identifier', 'name': 'graph_db', 'range': [1379, 1379], 'children': []}, {'type': 'Identifier', 'name': 'create_graph', 'range': [1381, 1381], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1383, 1383], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1385, 1385], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1387, 1387], 'children': []}]}]}, {'type': 'Assignment', 'name': 'graph = await on_graph_activate(graph, get_credentials=lambda id: integration_creds_manager.get(user_id, id))', 'range': [1390, 1415], 'children': [{'type': 'Identifier', 'name': 'graph', 'range': [1390, 1390], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1392, 1392], 'children': []}, {'type': 'CallExpression', 'name': 'on_graph_activate', 'range': [1393, 1415], 'children': [{'type': 'Identifier', 'name': 'on_graph_activate', 'range': [1393, 1393], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1396, 1396], 'children': []}, {'type': 'LambdaExpression', 'name': 'get_credentials=lambda id: integration_creds_manager.get(user_id, id)', 'range': [1399, 1414], 'children': [{'type': 'Identifier', 'name': 'get_credentials', 'range': [1399, 1399], 'children': []}, {'type': 'Keyword', 'name': 'lambda', 'range': [1401, 1401], 'children': []}, {'type': 'Identifier', 'name': 'id', 'range': [1402, 1402], 'children': []}, {'type': 'CallExpression', 'name': 'integration_creds_manager.get', 'range': [1404, 1414], 'children': [{'type': 'Identifier', 'name': 'integration_creds_manager', 'range': [1404, 1404], 'children': []}, {'type': 'Identifier', 'name': 'get', 'range': [1406, 1406], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1408, 1408], 'children': []}, {'type': 'Identifier', 'name': 'id', 'range': [1410, 1410], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return graph', 'range': [1416, 1417], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [1416, 1416], 'children': []}, {'type': 'Identifier', 'name': 'graph', 'range': [1417, 1417], 'children': []}]}]}]}]}
2025-01-08 10:34:23,761 - INFO - Completed main AST analysis flow
2025-01-08 10:34:23,763 - INFO - Successfully processed chunk
2025-01-08 10:34:24,111 - INFO - Starting code generation from AST
2025-01-08 10:34:24,703 - ERROR - Error in get_code_from_ast: Error code: 400 - {'error': {'message': "This model's maximum context length is 65536 tokens. However, you requested 73311 tokens (65119 in the messages, 8192 in the completion). Please reduce the length of the messages or completion.", 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_request_error'}}
2025-01-08 10:34:24,704 - INFO - Starting static code similarity comparison
2025-01-08 10:34:24,717 - INFO - Static similarity result: {'final_score': 20.32, 'length_similarity': 0.0, 'token_similarity': 0.0, 'structure_similarity': 0.0, 'function_similarity': 100, 'complexity_similarity': 3.23, 'variable_similarity': 100}
