2025-01-08 10:22:05,128 - INFO - Processing sample 156
2025-01-08 10:22:05,128 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 10:22:07,599 - INFO - Successfully split code into 2 top-level declarations
2025-01-08 10:22:07,601 - INFO - Processing chunk #0 (size=141 chars, start_index=0)
2025-01-08 10:22:07,602 - INFO - Processing chunk with 141 chars starting at index 0
2025-01-08 10:22:07,602 - INFO - Starting main AST analysis flow
2025-01-08 10:22:07,602 - INFO - Tokenized code into 25 tokens
2025-01-08 10:22:07,602 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:07,603 - INFO - Processing chunk #1 (size=905 chars, start_index=25)
2025-01-08 10:22:07,603 - INFO - Processing chunk with 905 chars starting at index 25
2025-01-08 10:22:07,604 - INFO - Starting main AST analysis flow
2025-01-08 10:22:07,604 - INFO - Tokenized code into 168 tokens
2025-01-08 10:22:07,604 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:22:09,241 - INFO - Step 1 result: {'type': 'Program', 'name': 'rate_limit_middleware', 'range': [25, 192], 'children': []}
2025-01-08 10:22:09,241 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:13,092 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 24], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 6], 'children': [{'type': 'ImportSpecifier', 'name': 'HTTPException', 'range': [3, 3], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Request', 'range': [5, 5], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [7, 15], 'children': [{'type': 'ImportSpecifier', 'name': 'RequestResponseEndpoint', 'range': [14, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [17, 22], 'children': [{'type': 'ImportSpecifier', 'name': 'RateLimiter', 'range': [21, 21], 'children': []}]}]}
2025-01-08 10:22:13,092 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:22:18,672 - INFO - Step 2 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 6], 'children': [{'type': 'ImportSpecifier', 'name': 'HTTPException', 'range': [3, 3], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Request', 'range': [5, 5], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [7, 15], 'children': [{'type': 'ImportSpecifier', 'name': 'RequestResponseEndpoint', 'range': [14, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [17, 22], 'children': [{'type': 'ImportSpecifier', 'name': 'RateLimiter', 'range': [21, 21], 'children': []}]}]}
2025-01-08 10:22:18,672 - INFO - Starting Step 3: AST simplification
2025-01-08 10:22:24,222 - INFO - Step 3 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 6], 'children': [{'type': 'ImportSpecifier', 'name': 'HTTPException', 'range': [3, 3], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Request', 'range': [5, 5], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [7, 15], 'children': [{'type': 'ImportSpecifier', 'name': 'RequestResponseEndpoint', 'range': [14, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [17, 22], 'children': [{'type': 'ImportSpecifier', 'name': 'RateLimiter', 'range': [21, 21], 'children': []}]}]}
2025-01-08 10:22:24,222 - INFO - Starting Step 4: AST normalization
2025-01-08 10:22:29,633 - INFO - Step 4 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 6], 'children': [{'type': 'ImportSpecifier', 'name': 'HTTPException', 'range': [3, 3], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Request', 'range': [5, 5], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [7, 15], 'children': [{'type': 'ImportSpecifier', 'name': 'RequestResponseEndpoint', 'range': [14, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [17, 22], 'children': [{'type': 'ImportSpecifier', 'name': 'RateLimiter', 'range': [21, 21], 'children': []}]}]}
2025-01-08 10:22:29,633 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:22:35,639 - INFO - Step 5 result: {'nodes': [{'type': 'Program', 'name': 'MainOrSomething', 'range': [0, 22], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 6], 'children': [{'type': 'ImportSpecifier', 'name': 'HTTPException', 'range': [3, 3], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Request', 'range': [5, 5], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [7, 15], 'children': [{'type': 'ImportSpecifier', 'name': 'RequestResponseEndpoint', 'range': [14, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [17, 22], 'children': [{'type': 'ImportSpecifier', 'name': 'RateLimiter', 'range': [21, 21], 'children': []}]}]}]}
2025-01-08 10:22:35,639 - INFO - Completed main AST analysis flow
2025-01-08 10:22:35,640 - INFO - Successfully processed chunk
2025-01-08 10:23:00,645 - INFO - Step 2 result: {'type': 'Program', 'name': 'rate_limit_middleware', 'range': [25, 192], 'children': [{'type': 'FunctionDeclaration', 'name': 'rate_limit_middleware', 'range': [25, 192], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [25, 29], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [26, 29], 'children': []}, {'type': 'FunctionName', 'name': 'rate_limit_middleware', 'range': [27, 47], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [28, 36], 'children': [{'type': 'Parameter', 'name': 'request', 'range': [29, 35], 'children': []}, {'type': 'Parameter', 'name': 'call_next', 'range': [33, 35], 'children': []}]}, {'type': 'Colon', 'name': ':', 'range': [37, 38], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [39, 41], 'children': []}, {'type': 'Newline', 'name': '\\n', 'range': [42, 43], 'children': []}, {'type': 'Assignment', 'name': 'limiter', 'range': [43, 47], 'children': [{'type': 'Variable', 'name': 'limiter', 'range': [43, 50], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [44, 45], 'children': []}, {'type': 'FunctionCall', 'name': 'RateLimiter', 'range': [45, 47], 'children': []}]}, {'type': 'Newline', 'name': '\\n', 'range': [48, 49], 'children': []}, {'type': 'IfStatement', 'name': 'if', 'range': [50, 70], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [51, 61], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [51, 54], 'children': []}, {'type': 'AttributeAccess', 'name': 'request.url.path.startswith', 'range': [52, 61], 'children': []}]}, {'type': 'Colon', 'name': ':', 'range': [62, 63], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [64, 70], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [65, 70], 'children': []}, {'type': 'FunctionCall', 'name': 'call_next', 'range': [66, 70], 'children': []}]}]}, {'type': 'Newline', 'name': '\\n', 'range': [71, 72], 'children': []}, {'type': 'Assignment', 'name': 'api_key', 'range': [72, 82], 'children': [{'type': 'Variable', 'name': 'api_key', 'range': [72, 79], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [73, 74], 'children': []}, {'type': 'AttributeAccess', 'name': 'request.headers.get', 'range': [74, 82], 'children': []}]}, {'type': 'Newline', 'name': '\\n', 'range': [83, 84], 'children': []}, {'type': 'IfStatement', 'name': 'if', 'range': [84, 94], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [85, 86], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [85, 86], 'children': []}, {'type': 'Variable', 'name': 'api_key', 'range': [85, 86], 'children': []}]}, {'type': 'Colon', 'name': ':', 'range': [87, 88], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [89, 94], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [90, 94], 'children': []}, {'type': 'FunctionCall', 'name': 'call_next', 'range': [91, 94], 'children': []}]}]}, {'type': 'Newline', 'name': '\\n', 'range': [95, 96], 'children': []}, {'type': 'Assignment', 'name': 'api_key', 'range': [96, 106], 'children': [{'type': 'Variable', 'name': 'api_key', 'range': [96, 103], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [97, 98], 'children': []}, {'type': 'MethodCall', 'name': 'api_key.replace', 'range': [98, 106], 'children': []}]}, {'type': 'Newline', 'name': '\\n', 'range': [107, 108], 'children': []}, {'type': 'Assignment', 'name': 'is_allowed, remaining, reset_time', 'range': [108, 121], 'children': [{'type': 'Variable', 'name': 'is_allowed', 'range': [108, 118], 'children': []}, {'type': 'Comma', 'name': ',', 'range': [109, 110], 'children': []}, {'type': 'Variable', 'name': 'remaining', 'range': [110, 118], 'children': []}, {'type': 'Comma', 'name': ',', 'range': [111, 112], 'children': []}, {'type': 'Variable', 'name': 'reset_time', 'range': [112, 121], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [113, 114], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [114, 119], 'children': []}, {'type': 'MethodCall', 'name': 'limiter.check_rate_limit', 'range': [115, 121], 'children': []}]}, {'type': 'Newline', 'name': '\\n', 'range': [122, 123], 'children': []}, {'type': 'IfStatement', 'name': 'if', 'range': [123, 141], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [124, 125], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [124, 125], 'children': []}, {'type': 'Variable', 'name': 'is_allowed', 'range': [124, 125], 'children': []}]}, {'type': 'Colon', 'name': ':', 'range': [126, 127], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [128, 141], 'children': [{'type': 'Exception', 'name': 'HTTPException', 'range': [129, 141], 'children': []}]}]}, {'type': 'Newline', 'name': '\\n', 'range': [142, 143], 'children': []}, {'type': 'Assignment', 'name': 'response', 'range': [143, 150], 'children': [{'type': 'Variable', 'name': 'response', 'range': [143, 150], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [144, 145], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [145, 150], 'children': []}, {'type': 'FunctionCall', 'name': 'call_next', 'range': [146, 150], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Limit"]', 'range': [151, 164], 'children': [{'type': 'AttributeAccess', 'name': 'response.headers', 'range': [151, 164], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [157, 158], 'children': []}, {'type': 'FunctionCall', 'name': 'str', 'range': [158, 164], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Remaining"]', 'range': [165, 176], 'children': [{'type': 'AttributeAccess', 'name': 'response.headers', 'range': [165, 176], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [171, 172], 'children': []}, {'type': 'FunctionCall', 'name': 'str', 'range': [172, 176], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Reset"]', 'range': [177, 188], 'children': [{'type': 'AttributeAccess', 'name': 'response.headers', 'range': [177, 188], 'children': []}, {'type': 'AssignmentOperator', 'name': '=', 'range': [183, 184], 'children': []}, {'type': 'FunctionCall', 'name': 'str', 'range': [184, 188], 'children': []}]}, {'type': 'Newline', 'name': '\\n', 'range': [189, 190], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [190, 192], 'children': [{'type': 'Variable', 'name': 'response', 'range': [191, 192], 'children': []}]}]}]}
2025-01-08 10:23:00,645 - INFO - Starting Step 3: AST simplification
2025-01-08 10:23:39,461 - INFO - Step 3 result: {'type': 'Program', 'name': 'rate_limit_middleware', 'range': [25, 192], 'children': [{'type': 'FunctionDeclaration', 'name': 'rate_limit_middleware', 'range': [25, 192], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [25, 29], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [26, 29], 'children': []}, {'type': 'FunctionName', 'name': 'rate_limit_middleware', 'range': [27, 47], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [28, 36], 'children': [{'type': 'Parameter', 'name': 'request', 'range': [29, 35], 'children': []}, {'type': 'Parameter', 'name': 'call_next', 'range': [33, 35], 'children': []}]}, {'type': 'Colon', 'name': ':', 'range': [37, 38], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [39, 41], 'children': []}, {'type': 'Assignment', 'name': 'limiter', 'range': [43, 47], 'children': [{'type': 'Variable', 'name': 'limiter', 'range': [43, 50], 'children': []}, {'type': 'FunctionCall', 'name': 'RateLimiter', 'range': [45, 47], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [50, 70], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [51, 61], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [51, 54], 'children': []}, {'type': 'AttributeAccess', 'name': 'request.url.path.startswith', 'range': [52, 61], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [64, 70], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [65, 70], 'children': []}, {'type': 'FunctionCall', 'name': 'call_next', 'range': [66, 70], 'children': []}]}]}, {'type': 'Assignment', 'name': 'api_key', 'range': [72, 82], 'children': [{'type': 'Variable', 'name': 'api_key', 'range': [72, 79], 'children': []}, {'type': 'AttributeAccess', 'name': 'request.headers.get', 'range': [74, 82], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [84, 94], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [85, 86], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [85, 86], 'children': []}, {'type': 'Variable', 'name': 'api_key', 'range': [85, 86], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [89, 94], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [90, 94], 'children': []}, {'type': 'FunctionCall', 'name': 'call_next', 'range': [91, 94], 'children': []}]}]}, {'type': 'Assignment', 'name': 'api_key', 'range': [96, 106], 'children': [{'type': 'Variable', 'name': 'api_key', 'range': [96, 103], 'children': []}, {'type': 'MethodCall', 'name': 'api_key.replace', 'range': [98, 106], 'children': []}]}, {'type': 'Assignment', 'name': 'is_allowed, remaining, reset_time', 'range': [108, 121], 'children': [{'type': 'Variable', 'name': 'is_allowed', 'range': [108, 118], 'children': []}, {'type': 'Variable', 'name': 'remaining', 'range': [110, 118], 'children': []}, {'type': 'Variable', 'name': 'reset_time', 'range': [112, 121], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [114, 119], 'children': []}, {'type': 'MethodCall', 'name': 'limiter.check_rate_limit', 'range': [115, 121], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [123, 141], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [124, 125], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [124, 125], 'children': []}, {'type': 'Variable', 'name': 'is_allowed', 'range': [124, 125], 'children': []}]}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [128, 141], 'children': [{'type': 'Exception', 'name': 'HTTPException', 'range': [129, 141], 'children': []}]}]}, {'type': 'Assignment', 'name': 'response', 'range': [143, 150], 'children': [{'type': 'Variable', 'name': 'response', 'range': [143, 150], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [145, 150], 'children': []}, {'type': 'FunctionCall', 'name': 'call_next', 'range': [146, 150], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Limit"]', 'range': [151, 164], 'children': [{'type': 'AttributeAccess', 'name': 'response.headers', 'range': [151, 164], 'children': []}, {'type': 'FunctionCall', 'name': 'str', 'range': [158, 164], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Remaining"]', 'range': [165, 176], 'children': [{'type': 'AttributeAccess', 'name': 'response.headers', 'range': [165, 176], 'children': []}, {'type': 'FunctionCall', 'name': 'str', 'range': [172, 176], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Reset"]', 'range': [177, 188], 'children': [{'type': 'AttributeAccess', 'name': 'response.headers', 'range': [177, 188], 'children': []}, {'type': 'FunctionCall', 'name': 'str', 'range': [184, 188], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [190, 192], 'children': [{'type': 'Variable', 'name': 'response', 'range': [191, 192], 'children': []}]}]}]}
2025-01-08 10:23:39,461 - INFO - Starting Step 4: AST normalization
2025-01-08 10:24:17,114 - INFO - Step 4 result: {'type': 'Program', 'name': 'rate_limit_middleware', 'range': [25, 192], 'children': [{'type': 'FunctionDecl', 'name': 'rate_limit_middleware', 'range': [25, 192], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [25, 29], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [26, 29], 'children': []}, {'type': 'Identifier', 'name': 'rate_limit_middleware', 'range': [27, 47], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [28, 36], 'children': [{'type': 'Identifier', 'name': 'request', 'range': [29, 35], 'children': []}, {'type': 'Identifier', 'name': 'call_next', 'range': [33, 35], 'children': []}]}, {'type': 'Colon', 'name': ':', 'range': [37, 38], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [39, 41], 'children': []}, {'type': 'Assignment', 'name': 'limiter', 'range': [43, 47], 'children': [{'type': 'Identifier', 'name': 'limiter', 'range': [43, 50], 'children': []}, {'type': 'CallExpression', 'name': 'RateLimiter', 'range': [45, 47], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [50, 70], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [51, 61], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [51, 54], 'children': []}, {'type': 'CallExpression', 'name': 'request.url.path.startswith', 'range': [52, 61], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [64, 70], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [65, 70], 'children': []}, {'type': 'CallExpression', 'name': 'call_next', 'range': [66, 70], 'children': []}]}]}, {'type': 'Assignment', 'name': 'api_key', 'range': [72, 82], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [72, 79], 'children': []}, {'type': 'CallExpression', 'name': 'request.headers.get', 'range': [74, 82], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [84, 94], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [85, 86], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [85, 86], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [85, 86], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [89, 94], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [90, 94], 'children': []}, {'type': 'CallExpression', 'name': 'call_next', 'range': [91, 94], 'children': []}]}]}, {'type': 'Assignment', 'name': 'api_key', 'range': [96, 106], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [96, 103], 'children': []}, {'type': 'CallExpression', 'name': 'api_key.replace', 'range': [98, 106], 'children': []}]}, {'type': 'Assignment', 'name': 'is_allowed, remaining, reset_time', 'range': [108, 121], 'children': [{'type': 'Identifier', 'name': 'is_allowed', 'range': [108, 118], 'children': []}, {'type': 'Identifier', 'name': 'remaining', 'range': [110, 118], 'children': []}, {'type': 'Identifier', 'name': 'reset_time', 'range': [112, 121], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [114, 119], 'children': []}, {'type': 'CallExpression', 'name': 'limiter.check_rate_limit', 'range': [115, 121], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [123, 141], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [124, 125], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [124, 125], 'children': []}, {'type': 'Identifier', 'name': 'is_allowed', 'range': [124, 125], 'children': []}]}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [128, 141], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [129, 141], 'children': []}]}]}, {'type': 'Assignment', 'name': 'response', 'range': [143, 150], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [143, 150], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [145, 150], 'children': []}, {'type': 'CallExpression', 'name': 'call_next', 'range': [146, 150], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Limit"]', 'range': [151, 164], 'children': [{'type': 'MemberExpression', 'name': 'response.headers', 'range': [151, 164], 'children': []}, {'type': 'CallExpression', 'name': 'str', 'range': [158, 164], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Remaining"]', 'range': [165, 176], 'children': [{'type': 'MemberExpression', 'name': 'response.headers', 'range': [165, 176], 'children': []}, {'type': 'CallExpression', 'name': 'str', 'range': [172, 176], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Reset"]', 'range': [177, 188], 'children': [{'type': 'MemberExpression', 'name': 'response.headers', 'range': [177, 188], 'children': []}, {'type': 'CallExpression', 'name': 'str', 'range': [184, 188], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [190, 192], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [191, 192], 'children': []}]}]}]}
2025-01-08 10:24:17,115 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:24:56,513 - INFO - Step 5 result: {'type': 'Program', 'name': 'rate_limit_middleware', 'range': [25, 192], 'children': [{'type': 'FunctionDecl', 'name': 'rate_limit_middleware', 'range': [25, 192], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [25, 29], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [26, 29], 'children': []}, {'type': 'Identifier', 'name': 'rate_limit_middleware', 'range': [27, 47], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [28, 36], 'children': [{'type': 'Identifier', 'name': 'request', 'range': [29, 35], 'children': []}, {'type': 'Identifier', 'name': 'call_next', 'range': [33, 35], 'children': []}]}, {'type': 'Colon', 'name': ':', 'range': [37, 38], 'children': []}, {'type': 'Docstring', 'name': 'docstring', 'range': [39, 41], 'children': []}, {'type': 'Assignment', 'name': 'limiter', 'range': [43, 47], 'children': [{'type': 'Identifier', 'name': 'limiter', 'range': [43, 50], 'children': []}, {'type': 'CallExpression', 'name': 'RateLimiter', 'range': [45, 47], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [50, 70], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [51, 61], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [51, 54], 'children': []}, {'type': 'CallExpression', 'name': 'request.url.path.startswith', 'range': [52, 61], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [64, 70], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [65, 70], 'children': []}, {'type': 'CallExpression', 'name': 'call_next', 'range': [66, 70], 'children': []}]}]}, {'type': 'Assignment', 'name': 'api_key', 'range': [72, 82], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [72, 79], 'children': []}, {'type': 'CallExpression', 'name': 'request.headers.get', 'range': [74, 82], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [84, 94], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [85, 86], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [85, 86], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [85, 86], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [89, 94], 'children': [{'type': 'AwaitKeyword', 'name': 'await', 'range': [90, 94], 'children': []}, {'type': 'CallExpression', 'name': 'call_next', 'range': [91, 94], 'children': []}]}]}, {'type': 'Assignment', 'name': 'api_key', 'range': [96, 106], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [96, 103], 'children': []}, {'type': 'CallExpression', 'name': 'api_key.replace', 'range': [98, 106], 'children': []}]}, {'type': 'Assignment', 'name': 'is_allowed, remaining, reset_time', 'range': [108, 121], 'children': [{'type': 'Identifier', 'name': 'is_allowed', 'range': [108, 118], 'children': []}, {'type': 'Identifier', 'name': 'remaining', 'range': [110, 118], 'children': []}, {'type': 'Identifier', 'name': 'reset_time', 'range': [112, 121], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [114, 119], 'children': []}, {'type': 'CallExpression', 'name': 'limiter.check_rate_limit', 'range': [115, 121], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [123, 141], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [124, 125], 'children': [{'type': 'NotKeyword', 'name': 'not', 'range': [124, 125], 'children': []}, {'type': 'Identifier', 'name': 'is_allowed', 'range': [124, 125], 'children': []}]}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [128, 141], 'children': [{'type': 'Identifier', 'name': 'HTTPException', 'range': [129, 141], 'children': []}]}]}, {'type': 'Assignment', 'name': 'response', 'range': [143, 150], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [143, 150], 'children': []}, {'type': 'AwaitKeyword', 'name': 'await', 'range': [145, 150], 'children': []}, {'type': 'CallExpression', 'name': 'call_next', 'range': [146, 150], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Limit"]', 'range': [151, 164], 'children': [{'type': 'MemberExpression', 'name': 'response.headers', 'range': [151, 164], 'children': []}, {'type': 'CallExpression', 'name': 'str', 'range': [158, 164], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Remaining"]', 'range': [165, 176], 'children': [{'type': 'MemberExpression', 'name': 'response.headers', 'range': [165, 176], 'children': []}, {'type': 'CallExpression', 'name': 'str', 'range': [172, 176], 'children': []}]}, {'type': 'Assignment', 'name': 'response.headers["X-RateLimit-Reset"]', 'range': [177, 188], 'children': [{'type': 'MemberExpression', 'name': 'response.headers', 'range': [177, 188], 'children': []}, {'type': 'CallExpression', 'name': 'str', 'range': [184, 188], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [190, 192], 'children': [{'type': 'Identifier', 'name': 'response', 'range': [191, 192], 'children': []}]}]}]}
2025-01-08 10:24:56,513 - INFO - Completed main AST analysis flow
2025-01-08 10:24:56,513 - INFO - Successfully processed chunk
2025-01-08 10:24:56,522 - INFO - Starting code generation from AST
2025-01-08 10:25:01,313 - INFO - Successfully generated code from AST
2025-01-08 10:25:01,313 - INFO - Starting static code similarity comparison
2025-01-08 10:25:01,315 - INFO - Static similarity result: {'final_score': 91.38, 'length_similarity': 86.67, 'token_similarity': 89.29, 'structure_similarity': 86.36, 'function_similarity': 100, 'complexity_similarity': 100.0, 'variable_similarity': 100}
