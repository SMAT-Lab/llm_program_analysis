2025-01-08 09:22:25,737 - INFO - Processing sample 45
2025-01-08 09:22:25,738 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 09:22:43,645 - INFO - Successfully split code into 15 top-level declarations
2025-01-08 09:22:43,650 - INFO - Processing chunk #0 (size=539 chars, start_index=0)
2025-01-08 09:22:43,652 - INFO - Processing chunk with 539 chars starting at index 0
2025-01-08 09:22:43,652 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,652 - INFO - Tokenized code into 101 tokens
2025-01-08 09:22:43,652 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,658 - INFO - Processing chunk #1 (size=88 chars, start_index=101)
2025-01-08 09:22:43,658 - INFO - Processing chunk with 88 chars starting at index 101
2025-01-08 09:22:43,658 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,659 - INFO - Processing chunk #2 (size=96 chars, start_index=115)
2025-01-08 09:22:43,659 - INFO - Tokenized code into 14 tokens
2025-01-08 09:22:43,660 - INFO - Processing chunk #3 (size=126 chars, start_index=129)
2025-01-08 09:22:43,660 - INFO - Processing chunk with 96 chars starting at index 115
2025-01-08 09:22:43,661 - INFO - Processing chunk #4 (size=99 chars, start_index=143)
2025-01-08 09:22:43,661 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,662 - INFO - Processing chunk #5 (size=1172 chars, start_index=157)
2025-01-08 09:22:43,663 - INFO - Processing chunk with 126 chars starting at index 129
2025-01-08 09:22:43,663 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,664 - INFO - Processing chunk #6 (size=1125 chars, start_index=370)
2025-01-08 09:22:43,664 - INFO - Processing chunk with 99 chars starting at index 143
2025-01-08 09:22:43,665 - INFO - Processing chunk #7 (size=1275 chars, start_index=565)
2025-01-08 09:22:43,666 - INFO - Processing chunk with 1172 chars starting at index 157
2025-01-08 09:22:43,671 - INFO - Processing chunk #8 (size=1062 chars, start_index=770)
2025-01-08 09:22:43,671 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,672 - INFO - Tokenized code into 14 tokens
2025-01-08 09:22:43,673 - INFO - Processing chunk #9 (size=1261 chars, start_index=940)
2025-01-08 09:22:43,673 - INFO - Processing chunk with 1125 chars starting at index 370
2025-01-08 09:22:43,674 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,674 - INFO - Processing chunk with 1275 chars starting at index 565
2025-01-08 09:22:43,676 - INFO - Processing chunk #10 (size=671 chars, start_index=1140)
2025-01-08 09:22:43,677 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,678 - INFO - Processing chunk #11 (size=1203 chars, start_index=1253)
2025-01-08 09:22:43,686 - INFO - Processing chunk with 1062 chars starting at index 770
2025-01-08 09:22:43,696 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,688 - INFO - Processing chunk #12 (size=269 chars, start_index=1440)
2025-01-08 09:22:43,688 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,689 - INFO - Processing chunk with 1261 chars starting at index 940
2025-01-08 09:22:43,690 - INFO - Processing chunk #13 (size=652 chars, start_index=1483)
2025-01-08 09:22:43,690 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,691 - INFO - Tokenized code into 14 tokens
2025-01-08 09:22:43,691 - INFO - Processing chunk #14 (size=1341 chars, start_index=1593)
2025-01-08 09:22:43,692 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,694 - INFO - Processing chunk with 671 chars starting at index 1140
2025-01-08 09:22:43,695 - INFO - Tokenized code into 213 tokens
2025-01-08 09:22:43,695 - INFO - Processing chunk with 1203 chars starting at index 1253
2025-01-08 09:22:43,687 - INFO - Tokenized code into 14 tokens
2025-01-08 09:22:43,696 - INFO - Tokenized code into 170 tokens
2025-01-08 09:22:43,696 - INFO - Processing chunk with 269 chars starting at index 1440
2025-01-08 09:22:43,700 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,701 - INFO - Processing chunk with 652 chars starting at index 1483
2025-01-08 09:22:43,702 - INFO - Tokenized code into 195 tokens
2025-01-08 09:22:43,702 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,703 - INFO - Processing chunk with 1341 chars starting at index 1593
2025-01-08 09:22:43,703 - INFO - Tokenized code into 205 tokens
2025-01-08 09:22:43,704 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,704 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,704 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,704 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,705 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,705 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,706 - INFO - Tokenized code into 200 tokens
2025-01-08 09:22:43,706 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,706 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,707 - INFO - Starting main AST analysis flow
2025-01-08 09:22:43,708 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,712 - INFO - Tokenized code into 113 tokens
2025-01-08 09:22:43,717 - INFO - Tokenized code into 187 tokens
2025-01-08 09:22:43,724 - INFO - Tokenized code into 43 tokens
2025-01-08 09:22:43,728 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,729 - INFO - Tokenized code into 110 tokens
2025-01-08 09:22:43,745 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,740 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,740 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,740 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:43,734 - INFO - Tokenized code into 198 tokens
2025-01-08 09:22:43,757 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:22:54,133 - INFO - Step 1 result: {'type': 'Program', 'name': 'APIKeyNotFoundError', 'range': [115, 128], 'children': []}
2025-01-08 09:22:54,134 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:54,360 - INFO - Step 1 result: {'type': 'Program', 'name': 'APIKeyError', 'range': [101, 114], 'children': []}
2025-01-08 09:22:54,360 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:54,404 - INFO - Step 1 result: {'type': 'Program', 'name': 'validate_api_key', 'range': [770, 939], 'children': []}
2025-01-08 09:22:54,404 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:54,418 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_api_key_by_id', 'range': [1483, 1592], 'children': []}
2025-01-08 09:22:54,419 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:55,156 - INFO - Step 1 result: {'type': 'Program', 'name': 'suspend_api_key', 'range': [1253, 1439], 'children': []}
2025-01-08 09:22:55,157 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:55,213 - INFO - Step 1 result: {'type': 'Program', 'name': 'APIKeyValidationError', 'range': [143, 156], 'children': []}
2025-01-08 09:22:55,213 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:55,268 - INFO - Step 1 result: {'type': 'Program', 'name': 'revoke_api_key', 'range': [940, 1139], 'children': []}
2025-01-08 09:22:55,268 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:55,491 - INFO - Step 1 result: {'type': 'Program', 'name': 'list_user_api_keys', 'range': [1140, 1252], 'children': []}
2025-01-08 09:22:55,492 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:55,557 - INFO - Step 1 result: {'type': 'Program', 'name': 'generate_api_key', 'range': [565, 769], 'children': []}
2025-01-08 09:22:55,558 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:55,886 - INFO - Step 1 result: {'type': 'Program', 'name': 'has_permission', 'range': [1440, 1482], 'children': []}
2025-01-08 09:22:55,886 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:55,954 - INFO - Step 1 result: {'type': 'Program', 'name': 'update_api_key_permissions', 'range': [1593, 1790], 'children': []}
2025-01-08 09:22:55,954 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:22:57,206 - INFO - Step 1 result: {'type': 'Program', 'name': 'APIKeyPermissionError', 'range': [129, 142], 'children': []}
2025-01-08 09:22:57,207 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:23:05,083 - INFO - Step 2 result: {'type': 'Program', 'name': 'APIKeyError', 'range': [101, 114], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyError', 'range': [101, 114], 'children': [{'type': 'Inheritance', 'name': 'Exception', 'range': [103, 105], 'children': []}, {'type': 'Docstring', 'name': '"Base exception for API key operations"', 'range': [108, 110], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [113, 113], 'children': []}]}]}
2025-01-08 09:23:05,083 - INFO - Starting Step 3: AST simplification
2025-01-08 09:23:05,128 - INFO - Step 2 result: {'type': 'Program', 'name': 'APIKeyNotFoundError', 'range': [115, 128], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyNotFoundError', 'range': [115, 128], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [117, 119], 'children': []}, {'type': 'Docstring', 'name': '"Raised when an API key is not found"', 'range': [122, 124], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [127, 127], 'children': []}]}]}
2025-01-08 09:23:05,128 - INFO - Starting Step 3: AST simplification
2025-01-08 09:23:06,733 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 100], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 12], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 19], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 29], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [30, 38], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [39, 45], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [46, 54], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [55, 75], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [76, 80], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [82, 90], 'children': []}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [92, 100], 'children': []}]}
2025-01-08 09:23:06,733 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:23:07,237 - INFO - Step 2 result: {'type': 'Program', 'name': 'APIKeyPermissionError', 'range': [129, 142], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyPermissionError', 'range': [129, 142], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [131, 133], 'children': []}, {'type': 'Docstring', 'name': '"Raised when there are permission issues with API key operations"', 'range': [136, 138], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [141, 141], 'children': []}]}]}
2025-01-08 09:23:07,237 - INFO - Starting Step 3: AST simplification
2025-01-08 09:23:08,827 - INFO - Step 1 result: {'type': 'Program', 'name': 'APIKey', 'range': [157, 369], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKey', 'range': [157, 216], 'children': [{'type': 'PropertyDeclaration', 'name': 'name', 'range': [164, 166], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'prefix', 'range': [168, 170], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'key', 'range': [172, 174], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'status', 'range': [176, 183], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'permissions', 'range': [184, 190], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'postfix', 'range': [191, 193], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'created_at', 'range': [195, 197], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'last_used_at', 'range': [199, 206], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'revoked_at', 'range': [208, 215], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'description', 'range': [217, 224], 'children': []}, {'type': 'PropertyDeclaration', 'name': 'user_id', 'range': [226, 228], 'children': []}]}, {'type': 'MethodDeclaration', 'name': 'from_db', 'range': [231, 368], 'children': []}]}
2025-01-08 09:23:08,828 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:23:09,000 - INFO - Step 2 result: {'type': 'Program', 'name': 'APIKeyValidationError', 'range': [143, 156], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyValidationError', 'range': [143, 156], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [145, 147], 'children': []}, {'type': 'Docstring', 'name': '"Raised when API key validation fails"', 'range': [150, 152], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [155, 155], 'children': []}]}]}
2025-01-08 09:23:09,000 - INFO - Starting Step 3: AST simplification
2025-01-08 09:23:23,644 - INFO - Step 3 result: {'type': 'Program', 'name': 'APIKeyNotFoundError', 'range': [115, 128], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyNotFoundError', 'range': [115, 128], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [117, 119], 'children': []}, {'type': 'Docstring', 'name': '"Raised when an API key is not found"', 'range': [122, 124], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [127, 127], 'children': []}]}]}
2025-01-08 09:23:23,644 - INFO - Starting Step 4: AST normalization
2025-01-08 09:23:23,871 - INFO - Step 3 result: {'type': 'Program', 'name': 'APIKeyValidationError', 'range': [143, 156], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyValidationError', 'range': [143, 156], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [145, 147], 'children': []}, {'type': 'Docstring', 'name': '"Raised when API key validation fails"', 'range': [150, 152], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [155, 155], 'children': []}]}]}
2025-01-08 09:23:23,871 - INFO - Starting Step 4: AST normalization
2025-01-08 09:23:24,337 - INFO - Step 3 result: {'type': 'Program', 'name': 'APIKeyError', 'range': [101, 114], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyError', 'range': [101, 114], 'children': [{'type': 'Inheritance', 'name': 'Exception', 'range': [103, 105], 'children': []}, {'type': 'Docstring', 'name': '"Base exception for API key operations"', 'range': [108, 110], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [113, 113], 'children': []}]}]}
2025-01-08 09:23:24,337 - INFO - Starting Step 4: AST normalization
2025-01-08 09:23:24,560 - INFO - Step 3 result: {'type': 'Program', 'name': 'APIKeyPermissionError', 'range': [129, 142], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyPermissionError', 'range': [129, 142], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [131, 133], 'children': []}, {'type': 'Docstring', 'name': '"Raised when there are permission issues with API key operations"', 'range': [136, 138], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [141, 141], 'children': []}]}]}
2025-01-08 09:23:24,560 - INFO - Starting Step 4: AST normalization
2025-01-08 09:23:29,243 - INFO - Step 2 result: {'type': 'Program', 'name': 'has_permission', 'range': [1440, 1482], 'children': [{'type': 'FunctionDeclaration', 'name': 'has_permission', 'range': [1440, 1482], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [1442, 1450], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [1443, 1445], 'children': []}, {'type': 'Parameter', 'name': 'required_permission', 'range': [1447, 1449], 'children': []}]}, {'type': 'ReturnType', 'name': 'bool', 'range': [1451, 1453], 'children': []}, {'type': 'Block', 'name': 'function_body', 'range': [1455, 1482], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1456, 1479], 'children': [{'type': 'Block', 'name': 'try_block', 'range': [1458, 1465], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1459, 1465], 'children': [{'type': 'BinaryExpression', 'name': 'in', 'range': [1460, 1464], 'children': [{'type': 'Identifier', 'name': 'required_permission', 'range': [1460, 1460], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [1462, 1464], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1462, 1462], 'children': []}, {'type': 'Identifier', 'name': 'permissions', 'range': [1464, 1464], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1466, 1479], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1467, 1467], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1469, 1469], 'children': []}, {'type': 'Block', 'name': 'catch_block', 'range': [1471, 1479], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1472, 1478], 'children': [{'type': 'CallExpression', 'name': '(', 'range': [1475, 1478], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1476, 1477], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1480, 1482], 'children': [{'type': 'BooleanLiteral', 'name': 'False', 'range': [1481, 1481], 'children': []}]}]}]}]}
2025-01-08 09:23:29,243 - INFO - Starting Step 3: AST simplification
2025-01-08 09:23:34,634 - INFO - Step 1 result: {'type': 'Program', 'name': 'APIKeyWithoutHash', 'range': [370, 564], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyWithoutHash', 'range': [370, 432], 'children': [{'type': 'Property', 'name': 'id', 'range': [377, 379]}, {'type': 'Property', 'name': 'name', 'range': [381, 383]}, {'type': 'Property', 'name': 'prefix', 'range': [385, 387]}, {'type': 'Property', 'name': 'postfix', 'range': [389, 391]}, {'type': 'Property', 'name': 'status', 'range': [393, 395]}, {'type': 'Property', 'name': 'permissions', 'range': [397, 402]}, {'type': 'Property', 'name': 'created_at', 'range': [404, 406]}, {'type': 'Property', 'name': 'last_used_at', 'range': [408, 413]}, {'type': 'Property', 'name': 'revoked_at', 'range': [415, 420]}, {'type': 'Property', 'name': 'description', 'range': [422, 427]}, {'type': 'Property', 'name': 'user_id', 'range': [429, 431]}]}, {'type': 'MethodDeclaration', 'name': 'from_db', 'range': [434, 564], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [440, 442]}, {'type': 'BlockStatement', 'range': [446, 564], 'children': [{'type': 'TryStatement', 'range': [446, 564], 'children': [{'type': 'BlockStatement', 'range': [448, 543], 'children': [{'type': 'ReturnStatement', 'range': [449, 542], 'children': [{'type': 'NewExpression', 'range': [450, 542], 'children': [{'type': 'Property', 'name': 'id', 'range': [453, 457]}, {'type': 'Property', 'name': 'name', 'range': [460, 464]}, {'type': 'Property', 'name': 'prefix', 'range': [467, 471]}, {'type': 'Property', 'name': 'postfix', 'range': [474, 478]}, {'type': 'Property', 'name': 'status', 'range': [481, 487]}, {'type': 'Property', 'name': 'permissions', 'range': [491, 503]}, {'type': 'Property', 'name': 'created_at', 'range': [507, 511]}, {'type': 'Property', 'name': 'last_used_at', 'range': [514, 518]}, {'type': 'Property', 'name': 'revoked_at', 'range': [521, 525]}, {'type': 'Property', 'name': 'description', 'range': [528, 532]}, {'type': 'Property', 'name': 'user_id', 'range': [535, 539]}]}]}]}, {'type': 'CatchClause', 'range': [544, 564], 'children': [{'type': 'BlockStatement', 'range': [548, 564], 'children': [{'type': 'ExpressionStatement', 'range': [550, 556], 'children': [{'type': 'CallExpression', 'range': [550, 556], 'children': [{'type': 'MemberExpression', 'range': [550, 552], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [550, 550]}, {'type': 'Identifier', 'name': 'error', 'range': [552, 552]}]}, {'type': 'Literal', 'value': 'Error creating APIKeyWithoutHash from db: {str(e)}', 'range': [554, 555]}]}]}, {'type': 'ThrowStatement', 'range': [558, 564], 'children': [{'type': 'NewExpression', 'range': [559, 563], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [559, 559]}, {'type': 'Literal', 'value': 'Failed to create API key object: {str(e)}', 'range': [561, 562]}]}]}]}]}]}]}]}]}
2025-01-08 09:23:34,634 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:23:35,831 - INFO - Step 2 result: {'type': 'Program', 'name': 'list_user_api_keys', 'range': [1140, 1252], 'children': [{'type': 'FunctionDeclaration', 'name': 'list_user_api_keys', 'range': [1140, 1252], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1140, 1140], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1141, 1141], 'children': []}, {'type': 'FunctionName', 'name': 'list_user_api_keys', 'range': [1142, 1142], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1143, 1147], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [1144, 1144], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [1146, 1146], 'children': []}]}]}, {'type': 'ReturnType', 'name': '-> List[APIKeyWithoutHash]', 'range': [1148, 1154], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [1155, 1252], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1156, 1252], 'children': [{'type': 'TryBlock', 'name': 'tryBlock', 'range': [1158, 1210], 'children': [{'type': 'VariableDeclaration', 'name': 'where_clause', 'range': [1159, 1167], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyWhereInput', 'range': [1161, 1161], 'children': []}, {'type': 'ObjectLiteral', 'name': '{"userId": user_id}', 'range': [1163, 1167], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'api_keys', 'range': [1170, 1194], 'children': [{'type': 'AwaitExpression', 'name': 'await PrismaAPIKey.prisma().find_many', 'range': [1172, 1194], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return [APIKeyWithoutHash.from_db(key) for key in api_keys]', 'range': [1197, 1209], 'children': []}]}, {'type': 'CatchClause', 'name': 'except PrismaError as e', 'range': [1211, 1231], 'children': [{'type': 'BlockStatement', 'name': 'catchBlock', 'range': [1216, 1231], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Database error while listing API keys: {str(e)}")', 'range': [1217, 1223], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise APIKeyError(f"Failed to list API keys: {str(e)}")', 'range': [1225, 1230], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except Exception as e', 'range': [1232, 1252], 'children': [{'type': 'BlockStatement', 'name': 'catchBlock', 'range': [1237, 1252], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Unexpected error while listing API keys: {str(e)}")', 'range': [1238, 1244], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise APIKeyError(f"Failed to list API keys: {str(e)}")', 'range': [1246, 1251], 'children': []}]}]}]}]}]}]}
2025-01-08 09:23:35,832 - INFO - Starting Step 3: AST simplification
2025-01-08 09:23:44,086 - INFO - Step 2 result: {'type': 'Program', 'name': 'generate_api_key', 'range': [565, 769], 'children': [{'type': 'FunctionDeclaration', 'name': 'generate_api_key', 'range': [565, 769], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [565, 569], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [566, 569], 'children': []}, {'type': 'FunctionName', 'name': 'generate_api_key', 'range': [567, 598], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [568, 598], 'children': [{'type': 'Parameter', 'name': 'name', 'range': [570, 573], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [575, 578], 'children': []}, {'type': 'Parameter', 'name': 'permissions', 'range': [580, 586], 'children': []}, {'type': 'Parameter', 'name': 'description', 'range': [588, 596], 'children': []}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [599, 607], 'children': [{'type': 'TupleType', 'name': 'tuple', 'range': [601, 606], 'children': [{'type': 'Type', 'name': 'APIKeyWithoutHash', 'range': [603, 603], 'children': []}, {'type': 'Type', 'name': 'str', 'range': [605, 605], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [608, 769], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [609, 611], 'children': []}, {'type': 'TryBlock', 'name': 'try_block', 'range': [613, 748], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [613, 616], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [617, 748], 'children': [{'type': 'Assignment', 'name': 'api_manager', 'range': [616, 621], 'children': []}, {'type': 'Assignment', 'name': 'key', 'range': [622, 629], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [633, 710], 'children': [{'type': 'CallExpression', 'name': 'create', 'range': [640, 709], 'children': [{'type': 'Argument', 'name': 'data', 'range': [643, 707], 'children': []}]}]}, {'type': 'Assignment', 'name': 'api_key_without_hash', 'range': [712, 720], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [721, 727], 'children': []}]}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [728, 748], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [728, 732], 'children': []}, {'type': 'Exception', 'name': 'PrismaError', 'range': [729, 732], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [733, 748], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [736, 740], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [742, 748], 'children': []}]}]}]}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [749, 769], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [749, 753], 'children': []}, {'type': 'Exception', 'name': 'Exception', 'range': [750, 753], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [754, 769], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [757, 761], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [763, 769], 'children': []}]}]}]}]}]}
2025-01-08 09:23:44,086 - INFO - Starting Step 3: AST simplification
2025-01-08 09:23:54,343 - INFO - Step 2 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'uuid', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 12], 'children': [{'type': 'ImportSpecifier', 'name': 'datetime', 'range': [7, 7], 'children': []}, {'type': 'ImportSpecifier', 'name': 'timezone', 'range': [11, 11], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 19], 'children': [{'type': 'ImportSpecifier', 'name': 'List', 'range': [16, 16], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Optional', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 29], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyManager', 'range': [28, 28], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [30, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyPermission', 'range': [35, 35], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyStatus', 'range': [37, 37], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [39, 45], 'children': [{'type': 'ImportSpecifier', 'name': 'PrismaError', 'range': [44, 44], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [46, 54], 'children': [{'type': 'ImportSpecifier', 'name': 'PrismaAPIKey', 'range': [53, 53], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [55, 75], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyCreateInput', 'range': [62, 62], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyUpdateInput', 'range': [65, 65], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWhereInput', 'range': [68, 68], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWhereUniqueInput', 'range': [71, 71], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [76, 80], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseModel', 'range': [79, 79], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [82, 90], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseDbModel', 'range': [89, 89], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [92, 100], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [93, 99], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [94, 99], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [98, 98], 'children': []}]}]}]}]}
2025-01-08 09:23:54,344 - INFO - Starting Step 3: AST simplification
2025-01-08 09:23:56,383 - INFO - Step 4 result: {'type': 'Program', 'name': 'APIKeyValidationError', 'range': [143, 156], 'children': [{'type': 'ClassDecl', 'name': 'APIKeyValidationError', 'range': [143, 156], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [145, 147], 'children': []}, {'type': 'Docstring', 'name': '"Raised when API key validation fails"', 'range': [150, 152], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [155, 155], 'children': []}]}]}
2025-01-08 09:23:56,383 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:23:56,828 - INFO - Step 4 result: {'type': 'Program', 'name': 'APIKeyPermissionError', 'range': [129, 142], 'children': [{'type': 'ClassDecl', 'name': 'APIKeyPermissionError', 'range': [129, 142], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [131, 133], 'children': []}, {'type': 'Docstring', 'name': '"Raised when there are permission issues with API key operations"', 'range': [136, 138], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [141, 141], 'children': []}]}]}
2025-01-08 09:23:56,828 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:23:57,415 - INFO - Step 4 result: {'type': 'Program', 'name': 'APIKeyError', 'range': [101, 114], 'children': [{'type': 'ClassDecl', 'name': 'APIKeyError', 'range': [101, 114], 'children': [{'type': 'Inheritance', 'name': 'Exception', 'range': [103, 105], 'children': []}, {'type': 'Docstring', 'name': '"Base exception for API key operations"', 'range': [108, 110], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [113, 113], 'children': []}]}]}
2025-01-08 09:23:57,415 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:23:59,421 - INFO - Step 4 result: {'type': 'Program', 'name': 'APIKeyNotFoundError', 'range': [115, 128], 'children': [{'type': 'ClassDecl', 'name': 'APIKeyNotFoundError', 'range': [115, 128], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [117, 119], 'children': []}, {'type': 'Docstring', 'name': '"Raised when an API key is not found"', 'range': [122, 124], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [127, 127], 'children': []}]}]}
2025-01-08 09:23:59,421 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:24:01,643 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_api_key_by_id', 'range': [1483, 1592], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_api_key_by_id', 'range': [1483, 1592], 'children': [{'type': 'FunctionSignature', 'name': 'get_api_key_by_id', 'range': [1483, 1501], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1483, 1488], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1484, 1487], 'children': []}, {'type': 'Identifier', 'name': 'get_api_key_by_id', 'range': [1485, 1501], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1486, 1494], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [1487, 1489], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1491, 1493], 'children': []}]}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [1495, 1501], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [1502, 1592], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1503, 1571], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [1505, 1550], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key', 'range': [1506, 1531], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1506, 1513], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1507, 1508], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1508, 1531], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().find_first', 'range': [1509, 1531], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1509, 1520], 'children': []}, {'type': 'CallExpression', 'name': 'prisma', 'range': [1510, 1513], 'children': []}, {'type': 'CallExpression', 'name': 'find_first', 'range': [1514, 1531], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [1518, 1529], 'children': [{'type': 'Property', 'name': 'id', 'range': [1522, 1524], 'children': []}, {'type': 'Property', 'name': 'userId', 'range': [1526, 1528], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1534, 1541], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [1535, 1536], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1536, 1541], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1538, 1541], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1539, 1540], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1540, 1541], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1543, 1550], 'children': [{'type': 'CallExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1544, 1550], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1544, 1559], 'children': []}, {'type': 'CallExpression', 'name': 'from_db', 'range': [1545, 1550], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1548, 1550], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1551, 1571], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1552, 1563], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [1555, 1571], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1557, 1564], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1557, 1564], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1561, 1563], 'children': []}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1565, 1571], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1566, 1571], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1568, 1570], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1572, 1592], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1573, 1582], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [1576, 1592], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1578, 1585], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1578, 1585], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1582, 1584], 'children': []}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1586, 1592], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1587, 1592], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1589, 1591], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:24:01,643 - INFO - Starting Step 3: AST simplification
2025-01-08 09:24:19,283 - INFO - Step 3 result: {'type': 'Program', 'name': 'has_permission', 'range': [1440, 1482], 'children': [{'type': 'FunctionDeclaration', 'name': 'has_permission', 'range': [1440, 1482], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [1442, 1450], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [1443, 1445], 'children': []}, {'type': 'Parameter', 'name': 'required_permission', 'range': [1447, 1449], 'children': []}]}, {'type': 'ReturnType', 'name': 'bool', 'range': [1451, 1453], 'children': []}, {'type': 'Block', 'name': 'function_body', 'range': [1455, 1482], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1456, 1479], 'children': [{'type': 'Block', 'name': 'try_block', 'range': [1458, 1465], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1459, 1465], 'children': [{'type': 'BinaryExpression', 'name': 'in', 'range': [1460, 1464], 'children': [{'type': 'Identifier', 'name': 'required_permission', 'range': [1460, 1460], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [1462, 1464], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1462, 1462], 'children': []}, {'type': 'Identifier', 'name': 'permissions', 'range': [1464, 1464], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1466, 1479], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1467, 1467], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1469, 1469], 'children': []}, {'type': 'Block', 'name': 'catch_block', 'range': [1471, 1479], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1472, 1478], 'children': [{'type': 'CallExpression', 'name': '(', 'range': [1475, 1478], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1476, 1477], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1480, 1482], 'children': [{'type': 'BooleanLiteral', 'name': 'False', 'range': [1481, 1481], 'children': []}]}]}]}]}
2025-01-08 09:24:19,283 - INFO - Starting Step 4: AST normalization
2025-01-08 09:24:22,055 - INFO - Step 5 result: {'type': 'Program', 'name': 'APIKeyPermissionError', 'range': [129, 142], 'children': [{'type': 'ClassDecl', 'name': 'APIKeyPermissionError', 'range': [129, 142], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [131, 133], 'children': []}, {'type': 'Docstring', 'name': '"Raised when there are permission issues with API key operations"', 'range': [136, 138], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [141, 141], 'children': []}]}]}
2025-01-08 09:24:22,055 - INFO - Completed main AST analysis flow
2025-01-08 09:24:22,055 - INFO - Successfully processed chunk
2025-01-08 09:24:22,389 - INFO - Step 5 result: {'type': 'Program', 'name': 'APIKeyValidationError', 'range': [143, 156], 'children': [{'type': 'ClassDecl', 'name': 'APIKeyValidationError', 'range': [143, 156], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [145, 147], 'children': []}, {'type': 'Docstring', 'name': '"Raised when API key validation fails"', 'range': [150, 152], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [155, 155], 'children': []}]}]}
2025-01-08 09:24:22,389 - INFO - Completed main AST analysis flow
2025-01-08 09:24:22,389 - INFO - Successfully processed chunk
2025-01-08 09:24:22,787 - INFO - Step 5 result: {'type': 'Program', 'name': 'APIKeyError', 'range': [101, 114], 'children': [{'type': 'ClassDecl', 'name': 'APIKeyError', 'range': [101, 114], 'children': [{'type': 'Inheritance', 'name': 'Exception', 'range': [103, 105], 'children': []}, {'type': 'Docstring', 'name': '"Base exception for API key operations"', 'range': [108, 110], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [113, 113], 'children': []}]}]}
2025-01-08 09:24:22,787 - INFO - Completed main AST analysis flow
2025-01-08 09:24:22,787 - INFO - Successfully processed chunk
2025-01-08 09:24:23,242 - INFO - Step 5 result: {'type': 'Program', 'name': 'APIKeyNotFoundError', 'range': [115, 128], 'children': [{'type': 'ClassDecl', 'name': 'APIKeyNotFoundError', 'range': [115, 128], 'children': [{'type': 'Inheritance', 'name': 'APIKeyError', 'range': [117, 119], 'children': []}, {'type': 'Docstring', 'name': '"Raised when an API key is not found"', 'range': [122, 124], 'children': []}, {'type': 'PassStatement', 'name': 'pass', 'range': [127, 127], 'children': []}]}]}
2025-01-08 09:24:23,242 - INFO - Completed main AST analysis flow
2025-01-08 09:24:23,242 - INFO - Successfully processed chunk
2025-01-08 09:24:25,244 - INFO - Step 3 result: {'type': 'Program', 'name': 'list_user_api_keys', 'range': [1140, 1252], 'children': [{'type': 'FunctionDeclaration', 'name': 'list_user_api_keys', 'range': [1140, 1252], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1140, 1140], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1141, 1141], 'children': []}, {'type': 'FunctionName', 'name': 'list_user_api_keys', 'range': [1142, 1142], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1143, 1147], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [1144, 1144], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [1146, 1146], 'children': []}]}]}, {'type': 'ReturnType', 'name': '-> List[APIKeyWithoutHash]', 'range': [1148, 1154], 'children': []}, {'type': 'FunctionBody', 'name': 'body', 'range': [1155, 1252], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1156, 1252], 'children': [{'type': 'TryBlock', 'name': 'tryBlock', 'range': [1158, 1210], 'children': [{'type': 'VariableDeclaration', 'name': 'where_clause', 'range': [1159, 1167], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyWhereInput', 'range': [1161, 1161], 'children': []}, {'type': 'ObjectLiteral', 'name': '{"userId": user_id}', 'range': [1163, 1167], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'api_keys', 'range': [1170, 1194], 'children': [{'type': 'AwaitExpression', 'name': 'await PrismaAPIKey.prisma().find_many', 'range': [1172, 1194], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return [APIKeyWithoutHash.from_db(key) for key in api_keys]', 'range': [1197, 1209], 'children': []}]}, {'type': 'CatchClause', 'name': 'except PrismaError as e', 'range': [1211, 1231], 'children': [{'type': 'BlockStatement', 'name': 'catchBlock', 'range': [1216, 1231], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Database error while listing API keys: {str(e)}")', 'range': [1217, 1223], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise APIKeyError(f"Failed to list API keys: {str(e)}")', 'range': [1225, 1230], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except Exception as e', 'range': [1232, 1252], 'children': [{'type': 'BlockStatement', 'name': 'catchBlock', 'range': [1237, 1252], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Unexpected error while listing API keys: {str(e)}")', 'range': [1238, 1244], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise APIKeyError(f"Failed to list API keys: {str(e)}")', 'range': [1246, 1251], 'children': []}]}]}]}]}]}]}
2025-01-08 09:24:25,245 - INFO - Starting Step 4: AST normalization
2025-01-08 09:24:31,696 - INFO - Step 3 result: {'type': 'Program', 'name': 'generate_api_key', 'range': [565, 769], 'children': [{'type': 'FunctionDeclaration', 'name': 'generate_api_key', 'range': [565, 769], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [565, 569], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [566, 569], 'children': []}, {'type': 'FunctionName', 'name': 'generate_api_key', 'range': [567, 598], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [568, 598], 'children': [{'type': 'Parameter', 'name': 'name', 'range': [570, 573], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [575, 578], 'children': []}, {'type': 'Parameter', 'name': 'permissions', 'range': [580, 586], 'children': []}, {'type': 'Parameter', 'name': 'description', 'range': [588, 596], 'children': []}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [599, 607], 'children': [{'type': 'TupleType', 'name': 'tuple', 'range': [601, 606], 'children': [{'type': 'Type', 'name': 'APIKeyWithoutHash', 'range': [603, 603], 'children': []}, {'type': 'Type', 'name': 'str', 'range': [605, 605], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [608, 769], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [609, 611], 'children': []}, {'type': 'TryBlock', 'name': 'try_block', 'range': [613, 748], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [613, 616], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [617, 748], 'children': [{'type': 'Assignment', 'name': 'api_manager', 'range': [616, 621], 'children': []}, {'type': 'Assignment', 'name': 'key', 'range': [622, 629], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [633, 710], 'children': [{'type': 'CallExpression', 'name': 'create', 'range': [640, 709], 'children': [{'type': 'Argument', 'name': 'data', 'range': [643, 707], 'children': []}]}]}, {'type': 'Assignment', 'name': 'api_key_without_hash', 'range': [712, 720], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [721, 727], 'children': []}]}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [728, 748], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [728, 732], 'children': []}, {'type': 'Exception', 'name': 'PrismaError', 'range': [729, 732], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [733, 748], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [736, 740], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [742, 748], 'children': []}]}]}]}, {'type': 'ExceptBlock', 'name': 'except_block', 'range': [749, 769], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [749, 753], 'children': []}, {'type': 'Exception', 'name': 'Exception', 'range': [750, 753], 'children': []}, {'type': 'Block', 'name': 'block', 'range': [754, 769], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [757, 761], 'children': []}, {'type': 'RaiseStatement', 'name': 'raise', 'range': [763, 769], 'children': []}]}]}]}]}]}
2025-01-08 09:24:31,696 - INFO - Starting Step 4: AST normalization
2025-01-08 09:24:34,289 - INFO - Step 2 result: {'type': 'Program', 'name': 'APIKeyWithoutHash', 'range': [370, 564], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyWithoutHash', 'range': [370, 432], 'children': [{'type': 'Property', 'name': 'id', 'range': [377, 379], 'children': []}, {'type': 'Property', 'name': 'name', 'range': [381, 383], 'children': []}, {'type': 'Property', 'name': 'prefix', 'range': [385, 387], 'children': []}, {'type': 'Property', 'name': 'postfix', 'range': [389, 391], 'children': []}, {'type': 'Property', 'name': 'status', 'range': [393, 395], 'children': []}, {'type': 'Property', 'name': 'permissions', 'range': [397, 402], 'children': []}, {'type': 'Property', 'name': 'created_at', 'range': [404, 406], 'children': []}, {'type': 'Property', 'name': 'last_used_at', 'range': [408, 413], 'children': []}, {'type': 'Property', 'name': 'revoked_at', 'range': [415, 420], 'children': []}, {'type': 'Property', 'name': 'description', 'range': [422, 427], 'children': []}, {'type': 'Property', 'name': 'user_id', 'range': [429, 431], 'children': []}]}, {'type': 'MethodDeclaration', 'name': 'from_db', 'range': [434, 564], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [440, 442], 'children': []}, {'type': 'BlockStatement', 'range': [446, 564], 'children': [{'type': 'TryStatement', 'range': [446, 564], 'children': [{'type': 'BlockStatement', 'range': [448, 543], 'children': [{'type': 'ReturnStatement', 'range': [449, 542], 'children': [{'type': 'NewExpression', 'range': [450, 542], 'children': [{'type': 'Property', 'name': 'id', 'range': [453, 457], 'children': []}, {'type': 'Property', 'name': 'name', 'range': [460, 464], 'children': []}, {'type': 'Property', 'name': 'prefix', 'range': [467, 471], 'children': []}, {'type': 'Property', 'name': 'postfix', 'range': [474, 478], 'children': []}, {'type': 'Property', 'name': 'status', 'range': [481, 487], 'children': []}, {'type': 'Property', 'name': 'permissions', 'range': [491, 503], 'children': []}, {'type': 'Property', 'name': 'created_at', 'range': [507, 511], 'children': []}, {'type': 'Property', 'name': 'last_used_at', 'range': [514, 518], 'children': []}, {'type': 'Property', 'name': 'revoked_at', 'range': [521, 525], 'children': []}, {'type': 'Property', 'name': 'description', 'range': [528, 532], 'children': []}, {'type': 'Property', 'name': 'user_id', 'range': [535, 539], 'children': []}]}]}]}, {'type': 'CatchClause', 'range': [544, 564], 'children': [{'type': 'BlockStatement', 'range': [548, 564], 'children': [{'type': 'ExpressionStatement', 'range': [550, 556], 'children': [{'type': 'CallExpression', 'range': [550, 556], 'children': [{'type': 'MemberExpression', 'range': [550, 552], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [550, 550]}, {'type': 'Identifier', 'name': 'error', 'range': [552, 552]}]}, {'type': 'Literal', 'value': 'Error creating APIKeyWithoutHash from db: {str(e)}', 'range': [554, 555]}]}]}, {'type': 'ThrowStatement', 'range': [558, 564], 'children': [{'type': 'NewExpression', 'range': [559, 563], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [559, 559]}, {'type': 'Literal', 'value': 'Failed to create API key object: {str(e)}', 'range': [561, 562]}]}]}]}]}]}]}]}]}
2025-01-08 09:24:34,289 - INFO - Starting Step 3: AST simplification
2025-01-08 09:24:50,109 - INFO - Step 3 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'uuid', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 12], 'children': [{'type': 'ImportSpecifier', 'name': 'datetime', 'range': [7, 7], 'children': []}, {'type': 'ImportSpecifier', 'name': 'timezone', 'range': [11, 11], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 19], 'children': [{'type': 'ImportSpecifier', 'name': 'List', 'range': [16, 16], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Optional', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 29], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyManager', 'range': [28, 28], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [30, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyPermission', 'range': [35, 35], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyStatus', 'range': [37, 37], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [39, 45], 'children': [{'type': 'ImportSpecifier', 'name': 'PrismaError', 'range': [44, 44], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [46, 54], 'children': [{'type': 'ImportSpecifier', 'name': 'PrismaAPIKey', 'range': [53, 53], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [55, 75], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyCreateInput', 'range': [62, 62], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyUpdateInput', 'range': [65, 65], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWhereInput', 'range': [68, 68], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWhereUniqueInput', 'range': [71, 71], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [76, 80], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseModel', 'range': [79, 79], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [82, 90], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseDbModel', 'range': [89, 89], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [92, 100], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [93, 99], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [94, 99], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [98, 98], 'children': []}]}]}]}]}
2025-01-08 09:24:50,109 - INFO - Starting Step 4: AST normalization
2025-01-08 09:24:53,772 - INFO - Step 4 result: {'type': 'Program', 'name': 'has_permission', 'range': [1440, 1482], 'children': [{'type': 'FunctionDecl', 'name': 'has_permission', 'range': [1440, 1482], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [1442, 1450], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [1443, 1445], 'children': []}, {'type': 'Parameter', 'name': 'required_permission', 'range': [1447, 1449], 'children': []}]}, {'type': 'ReturnType', 'name': 'bool', 'range': [1451, 1453], 'children': []}, {'type': 'Block', 'name': 'function_body', 'range': [1455, 1482], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1456, 1479], 'children': [{'type': 'Block', 'name': 'try_block', 'range': [1458, 1465], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1459, 1465], 'children': [{'type': 'BinaryExpression', 'name': 'in', 'range': [1460, 1464], 'children': [{'type': 'Identifier', 'name': 'required_permission', 'range': [1460, 1460], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [1462, 1464], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1462, 1462], 'children': []}, {'type': 'Identifier', 'name': 'permissions', 'range': [1464, 1464], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1466, 1479], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1467, 1467], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1469, 1469], 'children': []}, {'type': 'Block', 'name': 'catch_block', 'range': [1471, 1479], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1472, 1478], 'children': [{'type': 'CallExpression', 'name': '(', 'range': [1475, 1478], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1476, 1477], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1480, 1482], 'children': [{'type': 'BooleanLiteral', 'name': 'False', 'range': [1481, 1481], 'children': []}]}]}]}]}
2025-01-08 09:24:53,772 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:25:05,673 - INFO - Step 4 result: {'type': 'Program', 'name': 'list_user_api_keys', 'range': [1140, 1252], 'children': [{'type': 'FunctionDecl', 'name': 'list_user_api_keys', 'range': [1140, 1252], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1140, 1140], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1141, 1141], 'children': []}, {'type': 'Identifier', 'name': 'list_user_api_keys', 'range': [1142, 1142], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1143, 1147], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [1144, 1144], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [1146, 1146], 'children': []}]}]}, {'type': 'ReturnType', 'name': '-> List[APIKeyWithoutHash]', 'range': [1148, 1154], 'children': []}, {'type': 'BlockStatement', 'name': 'body', 'range': [1155, 1252], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1156, 1252], 'children': [{'type': 'BlockStatement', 'name': 'tryBlock', 'range': [1158, 1210], 'children': [{'type': 'VariableDecl', 'name': 'where_clause', 'range': [1159, 1167], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyWhereInput', 'range': [1161, 1161], 'children': []}, {'type': 'ObjectLiteral', 'name': '{"userId": user_id}', 'range': [1163, 1167], 'children': []}]}, {'type': 'VariableDecl', 'name': 'api_keys', 'range': [1170, 1194], 'children': [{'type': 'AwaitExpression', 'name': 'await PrismaAPIKey.prisma().find_many', 'range': [1172, 1194], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return [APIKeyWithoutHash.from_db(key) for key in api_keys]', 'range': [1197, 1209], 'children': []}]}, {'type': 'CatchClause', 'name': 'except PrismaError as e', 'range': [1211, 1231], 'children': [{'type': 'BlockStatement', 'name': 'catchBlock', 'range': [1216, 1231], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Database error while listing API keys: {str(e)}")', 'range': [1217, 1223], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise APIKeyError(f"Failed to list API keys: {str(e)}")', 'range': [1225, 1230], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except Exception as e', 'range': [1232, 1252], 'children': [{'type': 'BlockStatement', 'name': 'catchBlock', 'range': [1237, 1252], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Unexpected error while listing API keys: {str(e)}")', 'range': [1238, 1244], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise APIKeyError(f"Failed to list API keys: {str(e)}")', 'range': [1246, 1251], 'children': []}]}]}]}]}]}]}
2025-01-08 09:25:05,674 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:25:17,267 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_api_key_by_id', 'range': [1483, 1592], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_api_key_by_id', 'range': [1483, 1592], 'children': [{'type': 'FunctionSignature', 'name': 'get_api_key_by_id', 'range': [1483, 1501], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1483, 1488], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1484, 1487], 'children': []}, {'type': 'Identifier', 'name': 'get_api_key_by_id', 'range': [1485, 1501], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1486, 1494], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [1487, 1489], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1491, 1493], 'children': []}]}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [1495, 1501], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [1502, 1592], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1503, 1571], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [1505, 1550], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key', 'range': [1506, 1531], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1506, 1513], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1507, 1508], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1508, 1531], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().find_first', 'range': [1509, 1531], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1509, 1520], 'children': []}, {'type': 'CallExpression', 'name': 'prisma', 'range': [1510, 1513], 'children': []}, {'type': 'CallExpression', 'name': 'find_first', 'range': [1514, 1531], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [1518, 1529], 'children': [{'type': 'Property', 'name': 'id', 'range': [1522, 1524], 'children': []}, {'type': 'Property', 'name': 'userId', 'range': [1526, 1528], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1534, 1541], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [1535, 1536], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1536, 1541], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1538, 1541], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1539, 1540], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1540, 1541], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1543, 1550], 'children': [{'type': 'CallExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1544, 1550], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1544, 1559], 'children': []}, {'type': 'CallExpression', 'name': 'from_db', 'range': [1545, 1550], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1548, 1550], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1551, 1571], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1552, 1563], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [1555, 1571], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1557, 1564], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1557, 1564], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1561, 1563], 'children': []}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1565, 1571], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1566, 1571], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1568, 1570], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1572, 1592], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1573, 1582], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [1576, 1592], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1578, 1585], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1578, 1585], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1582, 1584], 'children': []}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1586, 1592], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1587, 1592], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1589, 1591], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:25:17,267 - INFO - Starting Step 4: AST normalization
2025-01-08 09:25:18,501 - INFO - Step 2 result: {'type': 'Program', 'name': 'APIKey', 'range': [157, 369], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKey', 'range': [157, 216], 'children': [{'type': 'PropertyDeclaration', 'name': 'name', 'range': [164, 166], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [166], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'prefix', 'range': [168, 170], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [170], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'key', 'range': [172, 174], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [174], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'status', 'range': [176, 183], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyStatus', 'range': [178], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [179, 183], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [180], 'children': []}, {'type': 'PropertyAccess', 'name': '.', 'range': [181, 182], 'children': [{'type': 'Identifier', 'name': 'ACTIVE', 'range': [182], 'children': []}]}]}]}, {'type': 'PropertyDeclaration', 'name': 'permissions', 'range': [184, 190], 'children': [{'type': 'TypeAnnotation', 'name': 'List', 'range': [186], 'children': [{'type': 'TypeArgument', 'name': 'APIKeyPermission', 'range': [188], 'children': []}]}]}, {'type': 'PropertyDeclaration', 'name': 'postfix', 'range': [191, 193], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [193], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'created_at', 'range': [195, 197], 'children': [{'type': 'TypeAnnotation', 'name': 'datetime', 'range': [197], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'last_used_at', 'range': [199, 206], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [201], 'children': [{'type': 'TypeArgument', 'name': 'datetime', 'range': [203], 'children': []}]}, {'type': 'Assignment', 'name': '=', 'range': [205, 206], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [206], 'children': []}]}]}, {'type': 'PropertyDeclaration', 'name': 'revoked_at', 'range': [208, 215], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [210], 'children': [{'type': 'TypeArgument', 'name': 'datetime', 'range': [212], 'children': []}]}, {'type': 'Assignment', 'name': '=', 'range': [214, 215], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [215], 'children': []}]}]}, {'type': 'PropertyDeclaration', 'name': 'description', 'range': [217, 224], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [219], 'children': [{'type': 'TypeArgument', 'name': 'str', 'range': [221], 'children': []}]}, {'type': 'Assignment', 'name': '=', 'range': [223, 224], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [224], 'children': []}]}]}, {'type': 'PropertyDeclaration', 'name': 'user_id', 'range': [226, 228], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [228], 'children': []}]}]}, {'type': 'MethodDeclaration', 'name': 'from_db', 'range': [231, 368], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [237, 239], 'children': [{'type': 'TypeAnnotation', 'name': 'PrismaAPIKey', 'range': [239], 'children': []}]}, {'type': 'Block', 'name': '', 'range': [242, 368], 'children': [{'type': 'TryStatement', 'name': '', 'range': [243, 368], 'children': [{'type': 'Block', 'name': '', 'range': [245, 347], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [246, 347], 'children': [{'type': 'NewExpression', 'name': 'APIKey', 'range': [247, 346], 'children': [{'type': 'Argument', 'name': 'id', 'range': [250, 255], 'children': [{'type': 'Assignment', 'name': '=', 'range': [251, 255], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [253, 254], 'children': [{'type': 'Identifier', 'name': 'id', 'range': [254], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'name', 'range': [257, 262], 'children': [{'type': 'Assignment', 'name': '=', 'range': [258, 262], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [260, 261], 'children': [{'type': 'Identifier', 'name': 'name', 'range': [261], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'prefix', 'range': [264, 269], 'children': [{'type': 'Assignment', 'name': '=', 'range': [265, 269], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [267, 268], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [268], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'postfix', 'range': [271, 276], 'children': [{'type': 'Assignment', 'name': '=', 'range': [272, 276], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [274, 275], 'children': [{'type': 'Identifier', 'name': 'postfix', 'range': [275], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'key', 'range': [278, 283], 'children': [{'type': 'Assignment', 'name': '=', 'range': [279, 283], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [281, 282], 'children': [{'type': 'Identifier', 'name': 'key', 'range': [282], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'status', 'range': [285, 293], 'children': [{'type': 'Assignment', 'name': '=', 'range': [286, 293], 'children': [{'type': 'NewExpression', 'name': 'APIKeyStatus', 'range': [287, 292], 'children': [{'type': 'Argument', 'name': '', 'range': [289, 292], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [290, 291], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [291], 'children': []}]}]}]}]}]}, {'type': 'Argument', 'name': 'permissions', 'range': [295, 309], 'children': [{'type': 'Assignment', 'name': '=', 'range': [296, 309], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [297, 308], 'children': [{'type': 'NewExpression', 'name': 'APIKeyPermission', 'range': [298, 301], 'children': [{'type': 'Argument', 'name': 'p', 'range': [300], 'children': []}]}, {'type': 'ForStatement', 'name': '', 'range': [302, 308], 'children': [{'type': 'VariableDeclaration', 'name': 'p', 'range': [303], 'children': []}, {'type': 'InExpression', 'name': 'in', 'range': [304, 307], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [306, 307], 'children': [{'type': 'Identifier', 'name': 'permissions', 'range': [307], 'children': []}]}]}]}]}]}]}, {'type': 'Argument', 'name': 'created_at', 'range': [311, 316], 'children': [{'type': 'Assignment', 'name': '=', 'range': [312, 316], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [314, 315], 'children': [{'type': 'Identifier', 'name': 'createdAt', 'range': [315], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'last_used_at', 'range': [318, 323], 'children': [{'type': 'Assignment', 'name': '=', 'range': [319, 323], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [321, 322], 'children': [{'type': 'Identifier', 'name': 'lastUsedAt', 'range': [322], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'revoked_at', 'range': [325, 330], 'children': [{'type': 'Assignment', 'name': '=', 'range': [326, 330], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [328, 329], 'children': [{'type': 'Identifier', 'name': 'revokedAt', 'range': [329], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'description', 'range': [332, 337], 'children': [{'type': 'Assignment', 'name': '=', 'range': [333, 337], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [335, 336], 'children': [{'type': 'Identifier', 'name': 'description', 'range': [336], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'user_id', 'range': [339, 344], 'children': [{'type': 'Assignment', 'name': '=', 'range': [340, 344], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [342, 343], 'children': [{'type': 'Identifier', 'name': 'userId', 'range': [343], 'children': []}]}]}]}]}]}]}, {'type': 'CatchClause', 'name': '', 'range': [348, 368], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [351], 'children': []}, {'type': 'Block', 'name': '', 'range': [353, 368], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [354, 361], 'children': [{'type': 'CallExpression', 'name': '', 'range': [355, 360], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [355, 356], 'children': [{'type': 'Identifier', 'name': 'error', 'range': [356], 'children': []}]}, {'type': 'Argument', 'name': '', 'range': [358, 360], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [359], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': '', 'range': [362, 368], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [363, 367], 'children': [{'type': 'Argument', 'name': '', 'range': [365, 367], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [366], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 09:25:18,501 - INFO - Starting Step 3: AST simplification
2025-01-08 09:25:20,184 - INFO - Step 4 result: {'type': 'Program', 'name': 'generate_api_key', 'range': [565, 769], 'children': [{'type': 'FunctionDecl', 'name': 'generate_api_key', 'range': [565, 769], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [565, 569], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [566, 569], 'children': []}, {'type': 'Identifier', 'name': 'generate_api_key', 'range': [567, 598], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [568, 598], 'children': [{'type': 'Parameter', 'name': 'name', 'range': [570, 573], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [575, 578], 'children': []}, {'type': 'Parameter', 'name': 'permissions', 'range': [580, 586], 'children': []}, {'type': 'Parameter', 'name': 'description', 'range': [588, 596], 'children': []}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [599, 607], 'children': [{'type': 'TupleType', 'name': 'tuple', 'range': [601, 606], 'children': [{'type': 'Type', 'name': 'APIKeyWithoutHash', 'range': [603, 603], 'children': []}, {'type': 'Type', 'name': 'str', 'range': [605, 605], 'children': []}]}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [608, 769], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [609, 611], 'children': []}, {'type': 'TryStatement', 'name': 'try_block', 'range': [613, 748], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [613, 616], 'children': []}, {'type': 'BlockStatement', 'name': 'block', 'range': [617, 748], 'children': [{'type': 'AssignmentExpression', 'name': 'api_manager', 'range': [616, 621], 'children': []}, {'type': 'AssignmentExpression', 'name': 'key', 'range': [622, 629], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [633, 710], 'children': [{'type': 'CallExpression', 'name': 'create', 'range': [640, 709], 'children': [{'type': 'Argument', 'name': 'data', 'range': [643, 707], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': 'api_key_without_hash', 'range': [712, 720], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [721, 727], 'children': []}]}, {'type': 'CatchClause', 'name': 'except_block', 'range': [728, 748], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [728, 732], 'children': []}, {'type': 'Identifier', 'name': 'PrismaError', 'range': [729, 732], 'children': []}, {'type': 'BlockStatement', 'name': 'block', 'range': [733, 748], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [736, 740], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [742, 748], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except_block', 'range': [749, 769], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [749, 753], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [750, 753], 'children': []}, {'type': 'BlockStatement', 'name': 'block', 'range': [754, 769], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [757, 761], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [763, 769], 'children': []}]}]}]}]}]}
2025-01-08 09:25:20,184 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:25:25,749 - INFO - Step 3 result: {'type': 'Program', 'name': 'APIKeyWithoutHash', 'range': [370, 564], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKeyWithoutHash', 'range': [370, 432], 'children': [{'type': 'Property', 'name': 'id', 'range': [377, 379], 'children': []}, {'type': 'Property', 'name': 'name', 'range': [381, 383], 'children': []}, {'type': 'Property', 'name': 'prefix', 'range': [385, 387], 'children': []}, {'type': 'Property', 'name': 'postfix', 'range': [389, 391], 'children': []}, {'type': 'Property', 'name': 'status', 'range': [393, 395], 'children': []}, {'type': 'Property', 'name': 'permissions', 'range': [397, 402], 'children': []}, {'type': 'Property', 'name': 'created_at', 'range': [404, 406], 'children': []}, {'type': 'Property', 'name': 'last_used_at', 'range': [408, 413], 'children': []}, {'type': 'Property', 'name': 'revoked_at', 'range': [415, 420], 'children': []}, {'type': 'Property', 'name': 'description', 'range': [422, 427], 'children': []}, {'type': 'Property', 'name': 'user_id', 'range': [429, 431], 'children': []}]}, {'type': 'MethodDeclaration', 'name': 'from_db', 'range': [434, 564], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [440, 442], 'children': []}, {'type': 'BlockStatement', 'range': [446, 564], 'children': [{'type': 'TryStatement', 'range': [446, 564], 'children': [{'type': 'BlockStatement', 'range': [448, 543], 'children': [{'type': 'ReturnStatement', 'range': [449, 542], 'children': [{'type': 'NewExpression', 'range': [450, 542], 'children': [{'type': 'Property', 'name': 'id', 'range': [453, 457], 'children': []}, {'type': 'Property', 'name': 'name', 'range': [460, 464], 'children': []}, {'type': 'Property', 'name': 'prefix', 'range': [467, 471], 'children': []}, {'type': 'Property', 'name': 'postfix', 'range': [474, 478], 'children': []}, {'type': 'Property', 'name': 'status', 'range': [481, 487], 'children': []}, {'type': 'Property', 'name': 'permissions', 'range': [491, 503], 'children': []}, {'type': 'Property', 'name': 'created_at', 'range': [507, 511], 'children': []}, {'type': 'Property', 'name': 'last_used_at', 'range': [514, 518], 'children': []}, {'type': 'Property', 'name': 'revoked_at', 'range': [521, 525], 'children': []}, {'type': 'Property', 'name': 'description', 'range': [528, 532], 'children': []}, {'type': 'Property', 'name': 'user_id', 'range': [535, 539], 'children': []}]}]}]}, {'type': 'CatchClause', 'range': [544, 564], 'children': [{'type': 'BlockStatement', 'range': [548, 564], 'children': [{'type': 'ExpressionStatement', 'range': [550, 556], 'children': [{'type': 'CallExpression', 'range': [550, 556], 'children': [{'type': 'MemberExpression', 'range': [550, 552], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [550, 550]}, {'type': 'Identifier', 'name': 'error', 'range': [552, 552]}]}, {'type': 'Literal', 'value': 'Error creating APIKeyWithoutHash from db: {str(e)}', 'range': [554, 555]}]}]}, {'type': 'ThrowStatement', 'range': [558, 564], 'children': [{'type': 'NewExpression', 'range': [559, 563], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [559, 559]}, {'type': 'Literal', 'value': 'Failed to create API key object: {str(e)}', 'range': [561, 562]}]}]}]}]}]}]}]}]}
2025-01-08 09:25:25,749 - INFO - Starting Step 4: AST normalization
2025-01-08 09:25:32,828 - INFO - Step 5 result: {'type': 'Program', 'name': 'has_permission', 'range': [1440, 1482], 'children': [{'type': 'FunctionDecl', 'name': 'has_permission', 'range': [1440, 1482], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [1442, 1450], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [1443, 1445], 'children': []}, {'type': 'Parameter', 'name': 'required_permission', 'range': [1447, 1449], 'children': []}]}, {'type': 'ReturnType', 'name': 'bool', 'range': [1451, 1453], 'children': []}, {'type': 'Block', 'name': 'function_body', 'range': [1455, 1482], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1456, 1479], 'children': [{'type': 'Block', 'name': 'try_block', 'range': [1458, 1465], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1459, 1465], 'children': [{'type': 'BinaryExpression', 'name': 'in', 'range': [1460, 1464], 'children': [{'type': 'Identifier', 'name': 'required_permission', 'range': [1460, 1460], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [1462, 1464], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1462, 1462], 'children': []}, {'type': 'Identifier', 'name': 'permissions', 'range': [1464, 1464], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1466, 1479], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1467, 1467], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1469, 1469], 'children': []}, {'type': 'Block', 'name': 'catch_block', 'range': [1471, 1479], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1472, 1478], 'children': [{'type': 'CallExpression', 'name': '(', 'range': [1475, 1478], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1476, 1477], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1480, 1482], 'children': [{'type': 'BooleanLiteral', 'name': 'False', 'range': [1481, 1481], 'children': []}]}]}]}]}
2025-01-08 09:25:32,829 - INFO - Completed main AST analysis flow
2025-01-08 09:25:32,829 - INFO - Successfully processed chunk
2025-01-08 09:25:42,116 - INFO - Step 4 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'uuid', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 12], 'children': [{'type': 'ImportSpecifier', 'name': 'datetime', 'range': [7, 7], 'children': []}, {'type': 'ImportSpecifier', 'name': 'timezone', 'range': [11, 11], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 19], 'children': [{'type': 'ImportSpecifier', 'name': 'List', 'range': [16, 16], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Optional', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 29], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyManager', 'range': [28, 28], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [30, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyPermission', 'range': [35, 35], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyStatus', 'range': [37, 37], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [39, 45], 'children': [{'type': 'ImportSpecifier', 'name': 'PrismaError', 'range': [44, 44], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [46, 54], 'children': [{'type': 'ImportSpecifier', 'name': 'PrismaAPIKey', 'range': [53, 53], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [55, 75], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyCreateInput', 'range': [62, 62], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyUpdateInput', 'range': [65, 65], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWhereInput', 'range': [68, 68], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWhereUniqueInput', 'range': [71, 71], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [76, 80], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseModel', 'range': [79, 79], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [82, 90], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseDbModel', 'range': [89, 89], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [92, 100], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [93, 99], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [94, 99], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [98, 98], 'children': []}]}]}]}]}
2025-01-08 09:25:42,117 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:25:47,068 - INFO - Step 5 result: {'type': 'Program', 'name': 'list_user_api_keys', 'range': [1140, 1252], 'children': [{'type': 'FunctionDecl', 'name': 'list_user_api_keys', 'range': [1140, 1252], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [1140, 1140], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [1141, 1141], 'children': []}, {'type': 'Identifier', 'name': 'list_user_api_keys', 'range': [1142, 1142], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1143, 1147], 'children': [{'type': 'Parameter', 'name': 'user_id', 'range': [1144, 1144], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [1146, 1146], 'children': []}]}]}, {'type': 'ReturnType', 'name': '-> List[APIKeyWithoutHash]', 'range': [1148, 1154], 'children': []}, {'type': 'BlockStatement', 'name': 'body', 'range': [1155, 1252], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1156, 1252], 'children': [{'type': 'BlockStatement', 'name': 'tryBlock', 'range': [1158, 1210], 'children': [{'type': 'VariableDecl', 'name': 'where_clause', 'range': [1159, 1167], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyWhereInput', 'range': [1161, 1161], 'children': []}, {'type': 'ObjectLiteral', 'name': '{"userId": user_id}', 'range': [1163, 1167], 'children': []}]}, {'type': 'VariableDecl', 'name': 'api_keys', 'range': [1170, 1194], 'children': [{'type': 'AwaitExpression', 'name': 'await PrismaAPIKey.prisma().find_many', 'range': [1172, 1194], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return [APIKeyWithoutHash.from_db(key) for key in api_keys]', 'range': [1197, 1209], 'children': []}]}, {'type': 'CatchClause', 'name': 'except PrismaError as e', 'range': [1211, 1231], 'children': [{'type': 'BlockStatement', 'name': 'catchBlock', 'range': [1216, 1231], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Database error while listing API keys: {str(e)}")', 'range': [1217, 1223], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise APIKeyError(f"Failed to list API keys: {str(e)}")', 'range': [1225, 1230], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except Exception as e', 'range': [1232, 1252], 'children': [{'type': 'BlockStatement', 'name': 'catchBlock', 'range': [1237, 1252], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Unexpected error while listing API keys: {str(e)}")', 'range': [1238, 1244], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise APIKeyError(f"Failed to list API keys: {str(e)}")', 'range': [1246, 1251], 'children': []}]}]}]}]}]}]}
2025-01-08 09:25:47,068 - INFO - Completed main AST analysis flow
2025-01-08 09:25:47,068 - INFO - Successfully processed chunk
2025-01-08 09:25:52,977 - INFO - Step 2 result: {'type': 'Program', 'name': 'revoke_api_key', 'range': [940, 1139], 'children': [{'type': 'FunctionDeclaration', 'name': 'revoke_api_key', 'range': [940, 1139], 'children': [{'type': 'FunctionSignature', 'name': 'revoke_api_key', 'range': [940, 958], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [940, 944], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [941, 944], 'children': []}, {'type': 'Identifier', 'name': 'revoke_api_key', 'range': [942, 955], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [943, 951], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [944, 947], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [944, 947], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [945, 947], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [948, 951], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [948, 951], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [949, 951], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [952, 958], 'children': [{'type': 'Keyword', 'name': '->', 'range': [952, 954], 'children': []}, {'type': 'Type', 'name': 'Optional', 'range': [954, 958], 'children': []}, {'type': 'Type', 'name': 'APIKeyWithoutHash', 'range': [955, 958], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [959, 1139], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [960, 1139], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [962, 1084], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key', 'range': [963, 981], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [963, 970], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [964, 965], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [965, 981], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().find_unique', 'range': [966, 981], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [966, 973], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [966, 973], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [967, 973], 'children': []}]}, {'type': 'CallExpression', 'name': 'find_unique', 'range': [972, 981], 'children': [{'type': 'Identifier', 'name': 'find_unique', 'range': [972, 981], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [973, 981], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [974, 980], 'children': [{'type': 'Property', 'name': 'id', 'range': [977, 980], 'children': [{'type': 'Literal', 'name': '"id"', 'range': [977, 980], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [978, 980], 'children': []}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [984, 995], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [985, 987], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [985, 987], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [986, 987], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [988, 995], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [989, 995], 'children': [{'type': 'NewExpression', 'name': 'APIKeyNotFoundError', 'range': [990, 995], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [990, 995], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [991, 995], 'children': [{'type': 'TemplateLiteral', 'name': 'f"API key with id {key_id} not found"', 'range': [992, 995], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [997, 1012], 'children': [{'type': 'Condition', 'name': 'api_key.userId != user_id', 'range': [998, 1004], 'children': [{'type': 'MemberExpression', 'name': 'api_key.userId', 'range': [998, 1001], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [998, 1001], 'children': []}, {'type': 'Identifier', 'name': 'userId', 'range': [999, 1001], 'children': []}]}, {'type': 'BinaryExpression', 'name': '!=', 'range': [1001, 1004], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1003, 1004], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1005, 1012], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1006, 1012], 'children': [{'type': 'NewExpression', 'name': 'APIKeyPermissionError', 'range': [1007, 1012], 'children': [{'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1007, 1012], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1008, 1012], 'children': [{'type': 'Literal', 'name': '"You do not have permission to revoke this API key."', 'range': [1010, 1012], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'where_clause', 'range': [1015, 1024], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1015, 1024], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1016, 1017], 'children': []}, {'type': 'ObjectExpression', 'name': 'APIKeyWhereUniqueInput', 'range': [1018, 1024], 'children': [{'type': 'Property', 'name': 'id', 'range': [1020, 1023], 'children': [{'type': 'Literal', 'name': '"id"', 'range': [1020, 1023], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1021, 1023], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'updated_api_key', 'range': [1025, 1068], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1025, 1038], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1026, 1027], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1027, 1068], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().update', 'range': [1028, 1068], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [1028, 1035], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1028, 1035], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [1029, 1035], 'children': []}]}, {'type': 'CallExpression', 'name': 'update', 'range': [1034, 1068], 'children': [{'type': 'Identifier', 'name': 'update', 'range': [1034, 1068], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1035, 1068], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [1037, 1040], 'children': [{'type': 'Property', 'name': 'where', 'range': [1037, 1040], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1038, 1040], 'children': []}]}]}, {'type': 'ObjectExpression', 'name': 'data', 'range': [1042, 1065], 'children': [{'type': 'Property', 'name': 'data', 'range': [1042, 1065], 'children': [{'type': 'NewExpression', 'name': 'APIKeyUpdateInput', 'range': [1044, 1065], 'children': [{'type': 'Identifier', 'name': 'APIKeyUpdateInput', 'range': [1044, 1065], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1045, 1065], 'children': [{'type': 'Property', 'name': 'status', 'range': [1047, 1052], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [1047, 1052], 'children': []}, {'type': 'MemberExpression', 'name': 'APIKeyStatus.REVOKED', 'range': [1049, 1052], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [1049, 1052], 'children': []}, {'type': 'Identifier', 'name': 'REVOKED', 'range': [1050, 1052], 'children': []}]}]}, {'type': 'Property', 'name': 'revokedAt', 'range': [1053, 1063], 'children': [{'type': 'Identifier', 'name': 'revokedAt', 'range': [1053, 1063], 'children': []}, {'type': 'CallExpression', 'name': 'datetime.now', 'range': [1055, 1063], 'children': [{'type': 'MemberExpression', 'name': 'datetime.now', 'range': [1055, 1063], 'children': [{'type': 'Identifier', 'name': 'datetime', 'range': [1055, 1063], 'children': []}, {'type': 'Identifier', 'name': 'now', 'range': [1056, 1063], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1058, 1063], 'children': [{'type': 'MemberExpression', 'name': 'timezone.utc', 'range': [1059, 1063], 'children': [{'type': 'Identifier', 'name': 'timezone', 'range': [1059, 1063], 'children': []}, {'type': 'Identifier', 'name': 'utc', 'range': [1060, 1063], 'children': []}]}]}]}]}]}]}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1070, 1081], 'children': [{'type': 'Condition', 'name': 'updated_api_key', 'range': [1071, 1072], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1071, 1072], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1073, 1081], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1074, 1081], 'children': [{'type': 'CallExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1075, 1081], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1075, 1081], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1075, 1081], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [1076, 1081], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1078, 1081], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1079, 1081], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1082, 1084], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1083, 1084], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1085, 1097], 'children': [{'type': 'Block', 'name': 'body', 'range': [1094, 1097], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1095, 1097], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [1096, 1097], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1098, 1118], 'children': [{'type': 'Block', 'name': 'body', 'range': [1103, 1118], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1104, 1111], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1105, 1111], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1107, 1111], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Database error while revoking API key: {str(e)}"', 'range': [1108, 1111], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1112, 1118], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1113, 1118], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1113, 1118], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1114, 1118], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to revoke API key: {str(e)}"', 'range': [1115, 1118], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1119, 1139], 'children': [{'type': 'Block', 'name': 'body', 'range': [1124, 1139], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1125, 1132], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1126, 1132], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1128, 1132], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Unexpected error while revoking API key: {str(e)}"', 'range': [1129, 1132], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1133, 1139], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1134, 1139], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1134, 1139], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1135, 1139], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to revoke API key: {str(e)}"', 'range': [1136, 1139], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 09:25:52,977 - INFO - Starting Step 3: AST simplification
2025-01-08 09:25:55,185 - INFO - Step 2 result: {'type': 'Program', 'name': 'validate_api_key', 'range': [770, 939], 'children': [{'type': 'FunctionDeclaration', 'name': 'validate_api_key', 'range': [770, 939], 'children': [{'type': 'FunctionSignature', 'name': 'validate_api_key', 'range': [770, 784], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [770, 774], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [771, 774], 'children': []}, {'type': 'Identifier', 'name': 'validate_api_key', 'range': [772, 787], 'children': []}, {'type': 'Parameter', 'name': 'plain_text_key', 'range': [774, 777], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [774, 787], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [776, 779], 'children': []}]}, {'type': 'ReturnType', 'name': 'Optional[APIKey]', 'range': [780, 784], 'children': [{'type': 'Keyword', 'name': 'Optional', 'range': [780, 787], 'children': []}, {'type': 'Type', 'name': 'APIKey', 'range': [782, 787], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'validate_api_key', 'range': [785, 939], 'children': [{'type': 'Docstring', 'name': 'Validate an API key and return the API key object if valid.', 'range': [786, 788], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [790, 939], 'children': [{'type': 'TryBlock', 'name': 'try', 'range': [790, 919], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [793, 814], 'children': [{'type': 'Condition', 'name': 'not plain_text_key.startswith(APIKeyManager.PREFIX)', 'range': [794, 803], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [794, 797], 'children': []}, {'type': 'MemberExpression', 'name': 'plain_text_key.startswith', 'range': [795, 802], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [795, 808], 'children': []}, {'type': 'Identifier', 'name': 'startswith', 'range': [797, 807], 'children': []}]}, {'type': 'CallExpression', 'name': 'startswith(APIKeyManager.PREFIX)', 'range': [798, 802], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyManager.PREFIX', 'range': [799, 801], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [799, 812], 'children': []}, {'type': 'Identifier', 'name': 'PREFIX', 'range': [801, 807], 'children': []}]}]}]}, {'type': 'Block', 'name': 'if', 'range': [804, 814], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning("Invalid API key format")', 'range': [805, 811], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [805, 810], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [805, 811], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [807, 814], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning("Invalid API key format")', 'range': [808, 810], 'children': [{'type': 'StringLiteral', 'name': '"Invalid API key format"', 'range': [809, 810], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [812, 814], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [812, 818], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [813, 817], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'prefix = plain_text_key[:APIKeyManager.PREFIX_LENGTH]', 'range': [816, 825], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [816, 822], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [817, 818], 'children': []}, {'type': 'MemberExpression', 'name': 'plain_text_key[:APIKeyManager.PREFIX_LENGTH]', 'range': [818, 824], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [818, 831], 'children': []}, {'type': 'SliceExpression', 'name': '[:APIKeyManager.PREFIX_LENGTH]', 'range': [819, 824], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyManager.PREFIX_LENGTH', 'range': [821, 823], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [821, 834], 'children': []}, {'type': 'Identifier', 'name': 'PREFIX_LENGTH', 'range': [823, 836], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'api_manager = APIKeyManager()', 'range': [826, 831], 'children': [{'type': 'Identifier', 'name': 'api_manager', 'range': [826, 837], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [827, 828], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyManager()', 'range': [828, 830], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [828, 841], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'api_key = await PrismaAPIKey.prisma().find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [833, 862], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [833, 840], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [834, 835], 'children': []}, {'type': 'AwaitExpression', 'name': 'await PrismaAPIKey.prisma().find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [835, 862], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma()', 'range': [836, 839], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [836, 838], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [836, 849], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [838, 844], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [842, 862], 'children': [{'type': 'Identifier', 'name': 'find_first', 'range': [842, 851], 'children': []}, {'type': 'Argument', 'name': 'where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE))', 'range': [845, 861], 'children': [{'type': 'Identifier', 'name': 'where', 'range': [845, 850], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [846, 847], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE))', 'range': [847, 861], 'children': [{'type': 'Identifier', 'name': 'APIKeyWhereInput', 'range': [847, 862], 'children': []}, {'type': 'Argument', 'name': 'prefix=prefix', 'range': [849, 851], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [849, 854], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [850, 851], 'children': []}, {'type': 'Identifier', 'name': 'prefix', 'range': [851, 856], 'children': []}]}, {'type': 'Argument', 'name': 'status=(APIKeyStatus.ACTIVE)', 'range': [853, 860], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [853, 859], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [854, 855], 'children': []}, {'type': 'ParenthesizedExpression', 'name': '(APIKeyStatus.ACTIVE)', 'range': [855, 860], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyStatus.ACTIVE', 'range': [856, 859], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [856, 869], 'children': []}, {'type': 'Identifier', 'name': 'ACTIVE', 'range': [858, 863], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [865, 880], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [866, 868], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [866, 869], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [867, 874], 'children': []}]}, {'type': 'Block', 'name': 'if', 'range': [869, 880], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning(f"No active API key found with prefix {prefix}")', 'range': [870, 877], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [870, 876], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [870, 876], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [872, 879], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning(f"No active API key found with prefix {prefix}")', 'range': [873, 876], 'children': [{'type': 'TemplateLiteral', 'name': 'f"No active API key found with prefix {prefix}"', 'range': [874, 876], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [875, 880], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [878, 880], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [878, 884], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [879, 883], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'is_valid = api_manager.verify_api_key(plain_text_key, api_key.key)', 'range': [882, 894], 'children': [{'type': 'Identifier', 'name': 'is_valid', 'range': [882, 890], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [883, 884], 'children': []}, {'type': 'CallExpression', 'name': 'api_manager.verify_api_key(plain_text_key, api_key.key)', 'range': [884, 894], 'children': [{'type': 'MemberExpression', 'name': 'api_manager.verify_api_key', 'range': [884, 893], 'children': [{'type': 'Identifier', 'name': 'api_manager', 'range': [884, 895], 'children': []}, {'type': 'Identifier', 'name': 'verify_api_key', 'range': [886, 899], 'children': []}]}, {'type': 'Argument', 'name': 'plain_text_key', 'range': [888, 889], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [888, 901], 'children': []}]}, {'type': 'Argument', 'name': 'api_key.key', 'range': [890, 893], 'children': [{'type': 'MemberExpression', 'name': 'api_key.key', 'range': [890, 893], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [890, 897], 'children': []}, {'type': 'Identifier', 'name': 'key', 'range': [892, 895], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [895, 909], 'children': [{'type': 'Condition', 'name': 'not is_valid', 'range': [896, 898], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [896, 899], 'children': []}, {'type': 'Identifier', 'name': 'is_valid', 'range': [897, 905], 'children': []}]}, {'type': 'Block', 'name': 'if', 'range': [899, 909], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning("API key verification failed")', 'range': [900, 906], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [900, 905], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [900, 906], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [902, 908], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning("API key verification failed")', 'range': [903, 905], 'children': [{'type': 'StringLiteral', 'name': '"API key verification failed"', 'range': [904, 905], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [907, 909], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [907, 913], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [908, 912], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return APIKey.from_db(api_key)', 'range': [911, 918], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [911, 917], 'children': []}, {'type': 'CallExpression', 'name': 'APIKey.from_db(api_key)', 'range': [912, 918], 'children': [{'type': 'MemberExpression', 'name': 'APIKey.from_db', 'range': [912, 917], 'children': [{'type': 'Identifier', 'name': 'APIKey', 'range': [912, 917], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [914, 921], 'children': []}]}, {'type': 'Argument', 'name': 'api_key', 'range': [916, 917], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [916, 923], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [919, 939], 'children': [{'type': 'Parameter', 'name': 'Exception as e', 'range': [920, 923], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [920, 929], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [922, 923], 'children': []}]}, {'type': 'Block', 'name': 'except', 'range': [924, 939], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Error validating API key: {str(e)}")', 'range': [925, 932], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [925, 931], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [925, 931], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [927, 933], 'children': []}]}, {'type': 'CallExpression', 'name': 'error(f"Error validating API key: {str(e)}")', 'range': [928, 931], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Error validating API key: {str(e)}"', 'range': [929, 931], 'children': [{'type': 'CallExpression', 'name': 'str(e)', 'range': [930, 931], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [930, 933], 'children': []}, {'type': 'Argument', 'name': 'e', 'range': [931, 932], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [931, 932], 'children': []}]}]}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise APIKeyValidationError(f"Failed to validate API key: {str(e)}")', 'range': [933, 939], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [933, 938], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyValidationError(f"Failed to validate API key: {str(e)}")', 'range': [934, 939], 'children': [{'type': 'Identifier', 'name': 'APIKeyValidationError', 'range': [934, 955], 'children': []}, {'type': 'Argument', 'name': 'f"Failed to validate API key: {str(e)}"', 'range': [936, 938], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to validate API key: {str(e)}"', 'range': [937, 938], 'children': [{'type': 'CallExpression', 'name': 'str(e)', 'range': [938, 939], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [938, 941], 'children': []}, {'type': 'Argument', 'name': 'e', 'range': [939, 940], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [939, 940], 'children': []}]}]}]}]}]}]}]}]}]}]}]}]}
2025-01-08 09:25:55,186 - INFO - Starting Step 3: AST simplification
2025-01-08 09:26:22,856 - INFO - Step 2 result: {'type': 'Program', 'name': 'suspend_api_key', 'range': [1253, 1439], 'children': [{'type': 'FunctionDeclaration', 'name': 'suspend_api_key', 'range': [1253, 1439], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1253, 1253], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1254, 1254], 'children': []}, {'type': 'Identifier', 'name': 'suspend_api_key', 'range': [1255, 1255], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1256, 1256], 'children': []}, {'type': 'Parameter', 'name': 'key_id', 'range': [1257, 1257], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [1257, 1257], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1258, 1258], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1259, 1259], 'children': []}]}, {'type': 'Punctuation', 'name': ',', 'range': [1260, 1260], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1261, 1261], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [1261, 1261], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1262, 1262], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1263, 1263], 'children': []}]}, {'type': 'Punctuation', 'name': ')', 'range': [1264, 1264], 'children': []}, {'type': 'Punctuation', 'name': '-', 'range': [1265, 1265], 'children': []}, {'type': 'Punctuation', 'name': '>', 'range': [1266, 1266], 'children': []}, {'type': 'TypeAnnotation', 'name': 'Optional', 'range': [1267, 1267], 'children': []}, {'type': 'Punctuation', 'name': '[', 'range': [1268, 1268], 'children': []}, {'type': 'TypeAnnotation', 'name': 'APIKeyWithoutHash', 'range': [1269, 1269], 'children': []}, {'type': 'Punctuation', 'name': ']', 'range': [1270, 1270], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1271, 1271], 'children': []}, {'type': 'Block', 'name': 'try', 'range': [1273, 1439], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [1273, 1273], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1274, 1274], 'children': []}, {'type': 'Statement', 'name': 'api_key', 'range': [1276, 1294], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1276, 1276], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1277, 1277], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1278, 1278], 'children': []}, {'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1279, 1279], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1280, 1280], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [1281, 1281], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1282, 1282], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1283, 1283], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1284, 1284], 'children': []}, {'type': 'Identifier', 'name': 'find_unique', 'range': [1285, 1285], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1286, 1286], 'children': []}, {'type': 'Argument', 'name': 'where', 'range': [1287, 1293], 'children': [{'type': 'Identifier', 'name': 'where', 'range': [1287, 1287], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1288, 1288], 'children': []}, {'type': 'Punctuation', 'name': '{', 'range': [1289, 1289], 'children': []}, {'type': 'StringLiteral', 'name': '"id"', 'range': [1290, 1290], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1291, 1291], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1292, 1292], 'children': []}, {'type': 'Punctuation', 'name': '}', 'range': [1293, 1293], 'children': []}]}, {'type': 'Punctuation', 'name': ')', 'range': [1294, 1294], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1297, 1308], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1297, 1297], 'children': []}, {'type': 'Keyword', 'name': 'not', 'range': [1298, 1298], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [1299, 1299], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1300, 1300], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1302, 1307], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1302, 1302], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1303, 1303], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1304, 1304], 'children': []}, {'type': 'StringLiteral', 'name': 'f"API key with id {key_id} not found"', 'range': [1305, 1306], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1307, 1307], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1310, 1326], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1310, 1310], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [1311, 1311], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1312, 1312], 'children': []}, {'type': 'Identifier', 'name': 'userId', 'range': [1313, 1313], 'children': []}, {'type': 'Operator', 'name': '!', 'range': [1314, 1314], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1315, 1315], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1316, 1316], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1317, 1317], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1319, 1325], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1319, 1319], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1320, 1320], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1321, 1321], 'children': []}, {'type': 'StringLiteral', 'name': '"You do not have permission to suspend this API key."', 'range': [1322, 1323], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1324, 1324], 'children': []}]}]}, {'type': 'Statement', 'name': 'where_clause', 'range': [1328, 1337], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1328, 1328], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1329, 1329], 'children': []}, {'type': 'TypeAnnotation', 'name': 'APIKeyWhereUniqueInput', 'range': [1330, 1330], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1331, 1331], 'children': []}, {'type': 'Punctuation', 'name': '{', 'range': [1332, 1332], 'children': []}, {'type': 'StringLiteral', 'name': '"id"', 'range': [1333, 1333], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1334, 1334], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1335, 1335], 'children': []}, {'type': 'Punctuation', 'name': '}', 'range': [1336, 1336], 'children': []}]}, {'type': 'Statement', 'name': 'updated_api_key', 'range': [1338, 1368], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1338, 1338], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1339, 1339], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1340, 1340], 'children': []}, {'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1341, 1341], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1342, 1342], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [1343, 1343], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1344, 1344], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1345, 1345], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1346, 1346], 'children': []}, {'type': 'Identifier', 'name': 'update', 'range': [1347, 1347], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1348, 1348], 'children': []}, {'type': 'Argument', 'name': 'where', 'range': [1350, 1352], 'children': [{'type': 'Identifier', 'name': 'where', 'range': [1350, 1350], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1351, 1351], 'children': []}, {'type': 'Identifier', 'name': 'where_clause', 'range': [1352, 1352], 'children': []}]}, {'type': 'Punctuation', 'name': ',', 'range': [1353, 1353], 'children': []}, {'type': 'Argument', 'name': 'data', 'range': [1355, 1364], 'children': [{'type': 'Identifier', 'name': 'data', 'range': [1355, 1355], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1356, 1356], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyUpdateInput', 'range': [1357, 1357], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1358, 1358], 'children': []}, {'type': 'Identifier', 'name': 'status', 'range': [1359, 1359], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [1360, 1360], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [1361, 1361], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1362, 1362], 'children': []}, {'type': 'Identifier', 'name': 'SUSPENDED', 'range': [1363, 1363], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1364, 1364], 'children': []}]}, {'type': 'Punctuation', 'name': ',', 'range': [1365, 1365], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1367, 1367], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1370, 1381], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1370, 1370], 'children': []}, {'type': 'Identifier', 'name': 'updated_api_key', 'range': [1371, 1371], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1372, 1372], 'children': []}, {'type': 'Statement', 'name': 'return', 'range': [1374, 1380], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [1374, 1374], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1375, 1375], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1376, 1376], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [1377, 1377], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1378, 1378], 'children': []}, {'type': 'Identifier', 'name': 'updated_api_key', 'range': [1379, 1379], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1380, 1380], 'children': []}]}]}, {'type': 'Statement', 'name': 'return', 'range': [1382, 1383], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [1382, 1382], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [1383, 1383], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1385, 1397], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [1385, 1385], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1386, 1386], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1387, 1387], 'children': []}, {'type': 'Punctuation', 'name': ',', 'range': [1388, 1388], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1389, 1389], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1390, 1390], 'children': []}, {'type': 'Keyword', 'name': 'as', 'range': [1391, 1391], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1392, 1392], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1393, 1393], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1395, 1396], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1395, 1395], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1396, 1396], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1398, 1418], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [1398, 1398], 'children': []}, {'type': 'Identifier', 'name': 'PrismaError', 'range': [1399, 1399], 'children': []}, {'type': 'Keyword', 'name': 'as', 'range': [1400, 1400], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1401, 1401], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1402, 1402], 'children': []}, {'type': 'Statement', 'name': 'logger', 'range': [1404, 1410], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1404, 1404], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1405, 1405], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1406, 1406], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1407, 1407], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Database error while suspending API key: {str(e)}"', 'range': [1408, 1409], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1410, 1410], 'children': []}]}, {'type': 'Statement', 'name': 'raise', 'range': [1412, 1417], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1412, 1412], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyError', 'range': [1413, 1413], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1414, 1414], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Failed to suspend API key: {str(e)}"', 'range': [1415, 1416], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1417, 1417], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1419, 1439], 'children': [{'type': 'Keyword', 'name': 'except', 'range': [1419, 1419], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [1420, 1420], 'children': []}, {'type': 'Keyword', 'name': 'as', 'range': [1421, 1421], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [1422, 1422], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [1423, 1423], 'children': []}, {'type': 'Statement', 'name': 'logger', 'range': [1425, 1431], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1425, 1425], 'children': []}, {'type': 'Punctuation', 'name': '.', 'range': [1426, 1426], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1427, 1427], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1428, 1428], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Unexpected error while suspending API key: {str(e)}"', 'range': [1429, 1430], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1431, 1431], 'children': []}]}, {'type': 'Statement', 'name': 'raise', 'range': [1433, 1438], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [1433, 1433], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyError', 'range': [1434, 1434], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [1435, 1435], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Failed to suspend API key: {str(e)}"', 'range': [1436, 1437], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [1438, 1438], 'children': []}]}]}]}]}]}
2025-01-08 09:26:22,857 - INFO - Starting Step 3: AST simplification
2025-01-08 09:26:35,152 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_api_key_by_id', 'range': [1483, 1592], 'children': [{'type': 'FunctionDecl', 'name': 'get_api_key_by_id', 'range': [1483, 1592], 'children': [{'type': 'FunctionSignature', 'name': 'get_api_key_by_id', 'range': [1483, 1501], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1483, 1488], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1484, 1487], 'children': []}, {'type': 'Identifier', 'name': 'get_api_key_by_id', 'range': [1485, 1501], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1486, 1494], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [1487, 1489], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1491, 1493], 'children': []}]}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [1495, 1501], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [1502, 1592], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1503, 1571], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [1505, 1550], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key', 'range': [1506, 1531], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1506, 1513], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1507, 1508], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1508, 1531], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().find_first', 'range': [1509, 1531], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1509, 1520], 'children': []}, {'type': 'CallExpression', 'name': 'prisma', 'range': [1510, 1513], 'children': []}, {'type': 'CallExpression', 'name': 'find_first', 'range': [1514, 1531], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [1518, 1529], 'children': [{'type': 'Property', 'name': 'id', 'range': [1522, 1524], 'children': []}, {'type': 'Property', 'name': 'userId', 'range': [1526, 1528], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1534, 1541], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [1535, 1536], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1536, 1541], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1538, 1541], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1539, 1540], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1540, 1541], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1543, 1550], 'children': [{'type': 'CallExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1544, 1550], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1544, 1559], 'children': []}, {'type': 'CallExpression', 'name': 'from_db', 'range': [1545, 1550], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1548, 1550], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1551, 1571], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1552, 1563], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [1555, 1571], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1557, 1564], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1557, 1564], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1561, 1563], 'children': []}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1565, 1571], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1566, 1571], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1568, 1570], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1572, 1592], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1573, 1582], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [1576, 1592], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1578, 1585], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1578, 1585], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1582, 1584], 'children': []}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1586, 1592], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1587, 1592], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1589, 1591], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:26:35,152 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:26:39,674 - INFO - Step 5 result: {'nodes': [{'type': 'Program', 'name': 'MainOrSomething', 'range': [0, 100], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'uuid', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 12], 'children': [{'type': 'ImportSpecifier', 'name': 'datetime', 'range': [7, 7], 'children': []}, {'type': 'ImportSpecifier', 'name': 'timezone', 'range': [11, 11], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [13, 19], 'children': [{'type': 'ImportSpecifier', 'name': 'List', 'range': [16, 16], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Optional', 'range': [18, 18], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [21, 29], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyManager', 'range': [28, 28], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [30, 38], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyPermission', 'range': [35, 35], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyStatus', 'range': [37, 37], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [39, 45], 'children': [{'type': 'ImportSpecifier', 'name': 'PrismaError', 'range': [44, 44], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [46, 54], 'children': [{'type': 'ImportSpecifier', 'name': 'PrismaAPIKey', 'range': [53, 53], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [55, 75], 'children': [{'type': 'ImportSpecifier', 'name': 'APIKeyCreateInput', 'range': [62, 62], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyUpdateInput', 'range': [65, 65], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWhereInput', 'range': [68, 68], 'children': []}, {'type': 'ImportSpecifier', 'name': 'APIKeyWhereUniqueInput', 'range': [71, 71], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [76, 80], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseModel', 'range': [79, 79], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [82, 90], 'children': [{'type': 'ImportSpecifier', 'name': 'BaseDbModel', 'range': [89, 89], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [92, 100], 'children': [{'type': 'AssignmentExpression', 'name': '', 'range': [93, 99], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [94, 99], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [98, 98], 'children': []}]}]}]}]}]}
2025-01-08 09:26:39,674 - INFO - Completed main AST analysis flow
2025-01-08 09:26:39,675 - INFO - Successfully processed chunk
2025-01-08 09:26:41,333 - INFO - Step 5 result: {'type': 'Program', 'name': 'generate_api_key', 'range': [565, 769], 'children': [{'type': 'FunctionDecl', 'name': 'generate_api_key', 'range': [565, 769], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [565, 569], 'children': []}, {'type': 'DefKeyword', 'name': 'def', 'range': [566, 569], 'children': []}, {'type': 'Identifier', 'name': 'generate_api_key', 'range': [567, 598], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [568, 598], 'children': [{'type': 'Parameter', 'name': 'name', 'range': [570, 573], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [575, 578], 'children': []}, {'type': 'Parameter', 'name': 'permissions', 'range': [580, 586], 'children': []}, {'type': 'Parameter', 'name': 'description', 'range': [588, 596], 'children': []}]}, {'type': 'ReturnType', 'name': 'return_type', 'range': [599, 607], 'children': [{'type': 'TupleType', 'name': 'tuple', 'range': [601, 606], 'children': [{'type': 'Type', 'name': 'APIKeyWithoutHash', 'range': [603, 603], 'children': []}, {'type': 'Type', 'name': 'str', 'range': [605, 605], 'children': []}]}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [608, 769], 'children': [{'type': 'Docstring', 'name': 'docstring', 'range': [609, 611], 'children': []}, {'type': 'TryStatement', 'name': 'try_block', 'range': [613, 748], 'children': [{'type': 'TryKeyword', 'name': 'try', 'range': [613, 616], 'children': []}, {'type': 'BlockStatement', 'name': 'block', 'range': [617, 748], 'children': [{'type': 'AssignmentExpression', 'name': 'api_manager', 'range': [616, 621], 'children': []}, {'type': 'AssignmentExpression', 'name': 'key', 'range': [622, 629], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [633, 710], 'children': [{'type': 'CallExpression', 'name': 'create', 'range': [640, 709], 'children': [{'type': 'Argument', 'name': 'data', 'range': [643, 707], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': 'api_key_without_hash', 'range': [712, 720], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [721, 727], 'children': []}]}, {'type': 'CatchClause', 'name': 'except_block', 'range': [728, 748], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [728, 732], 'children': []}, {'type': 'Identifier', 'name': 'PrismaError', 'range': [729, 732], 'children': []}, {'type': 'BlockStatement', 'name': 'block', 'range': [733, 748], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [736, 740], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [742, 748], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except_block', 'range': [749, 769], 'children': [{'type': 'ExceptKeyword', 'name': 'except', 'range': [749, 753], 'children': []}, {'type': 'Identifier', 'name': 'Exception', 'range': [750, 753], 'children': []}, {'type': 'BlockStatement', 'name': 'block', 'range': [754, 769], 'children': [{'type': 'CallExpression', 'name': 'error', 'range': [757, 761], 'children': []}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [763, 769], 'children': []}]}]}]}]}]}
2025-01-08 09:26:41,333 - INFO - Completed main AST analysis flow
2025-01-08 09:26:41,333 - INFO - Successfully processed chunk
2025-01-08 09:26:43,927 - INFO - Step 4 result: {'type': 'Program', 'name': 'APIKeyWithoutHash', 'range': [370, 564], 'children': [{'type': 'ClassDecl', 'name': 'APIKeyWithoutHash', 'range': [370, 432], 'children': [{'type': 'Property', 'name': 'id', 'range': [377, 379], 'children': []}, {'type': 'Property', 'name': 'name', 'range': [381, 383], 'children': []}, {'type': 'Property', 'name': 'prefix', 'range': [385, 387], 'children': []}, {'type': 'Property', 'name': 'postfix', 'range': [389, 391], 'children': []}, {'type': 'Property', 'name': 'status', 'range': [393, 395], 'children': []}, {'type': 'Property', 'name': 'permissions', 'range': [397, 402], 'children': []}, {'type': 'Property', 'name': 'created_at', 'range': [404, 406], 'children': []}, {'type': 'Property', 'name': 'last_used_at', 'range': [408, 413], 'children': []}, {'type': 'Property', 'name': 'revoked_at', 'range': [415, 420], 'children': []}, {'type': 'Property', 'name': 'description', 'range': [422, 427], 'children': []}, {'type': 'Property', 'name': 'user_id', 'range': [429, 431], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'from_db', 'range': [434, 564], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [440, 442], 'children': []}, {'type': 'BlockStatement', 'range': [446, 564], 'children': [{'type': 'TryStatement', 'range': [446, 564], 'children': [{'type': 'BlockStatement', 'range': [448, 543], 'children': [{'type': 'ReturnStatement', 'range': [449, 542], 'children': [{'type': 'NewExpression', 'range': [450, 542], 'children': [{'type': 'Property', 'name': 'id', 'range': [453, 457], 'children': []}, {'type': 'Property', 'name': 'name', 'range': [460, 464], 'children': []}, {'type': 'Property', 'name': 'prefix', 'range': [467, 471], 'children': []}, {'type': 'Property', 'name': 'postfix', 'range': [474, 478], 'children': []}, {'type': 'Property', 'name': 'status', 'range': [481, 487], 'children': []}, {'type': 'Property', 'name': 'permissions', 'range': [491, 503], 'children': []}, {'type': 'Property', 'name': 'created_at', 'range': [507, 511], 'children': []}, {'type': 'Property', 'name': 'last_used_at', 'range': [514, 518], 'children': []}, {'type': 'Property', 'name': 'revoked_at', 'range': [521, 525], 'children': []}, {'type': 'Property', 'name': 'description', 'range': [528, 532], 'children': []}, {'type': 'Property', 'name': 'user_id', 'range': [535, 539], 'children': []}]}]}]}, {'type': 'CatchClause', 'range': [544, 564], 'children': [{'type': 'BlockStatement', 'range': [548, 564], 'children': [{'type': 'ExpressionStatement', 'range': [550, 556], 'children': [{'type': 'CallExpression', 'range': [550, 556], 'children': [{'type': 'MemberExpression', 'range': [550, 552], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [550, 550]}, {'type': 'Identifier', 'name': 'error', 'range': [552, 552]}]}, {'type': 'Literal', 'value': 'Error creating APIKeyWithoutHash from db: {str(e)}', 'range': [554, 555]}]}]}, {'type': 'ThrowStatement', 'range': [558, 564], 'children': [{'type': 'NewExpression', 'range': [559, 563], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [559, 559]}, {'type': 'Literal', 'value': 'Failed to create API key object: {str(e)}', 'range': [561, 562]}]}]}]}]}]}]}]}]}
2025-01-08 09:26:43,927 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:26:53,682 - ERROR - Failed to parse Step 2 result
2025-01-08 09:26:53,682 - INFO - Starting Step 3: AST simplification
2025-01-08 09:27:33,080 - INFO - Step 3 result: {'type': 'Program', 'name': 'APIKey', 'range': [157, 369], 'children': [{'type': 'ClassDeclaration', 'name': 'APIKey', 'range': [157, 216], 'children': [{'type': 'PropertyDeclaration', 'name': 'name', 'range': [164, 166], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [166], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'prefix', 'range': [168, 170], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [170], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'key', 'range': [172, 174], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [174], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'status', 'range': [176, 183], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyStatus', 'range': [178], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [179, 183], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [180], 'children': []}, {'type': 'PropertyAccess', 'name': '.', 'range': [181, 182], 'children': [{'type': 'Identifier', 'name': 'ACTIVE', 'range': [182], 'children': []}]}]}]}, {'type': 'PropertyDeclaration', 'name': 'permissions', 'range': [184, 190], 'children': [{'type': 'TypeAnnotation', 'name': 'List', 'range': [186], 'children': [{'type': 'TypeArgument', 'name': 'APIKeyPermission', 'range': [188], 'children': []}]}]}, {'type': 'PropertyDeclaration', 'name': 'postfix', 'range': [191, 193], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [193], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'created_at', 'range': [195, 197], 'children': [{'type': 'TypeAnnotation', 'name': 'datetime', 'range': [197], 'children': []}]}, {'type': 'PropertyDeclaration', 'name': 'last_used_at', 'range': [199, 206], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [201], 'children': [{'type': 'TypeArgument', 'name': 'datetime', 'range': [203], 'children': []}]}, {'type': 'Assignment', 'name': '=', 'range': [205, 206], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [206], 'children': []}]}]}, {'type': 'PropertyDeclaration', 'name': 'revoked_at', 'range': [208, 215], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [210], 'children': [{'type': 'TypeArgument', 'name': 'datetime', 'range': [212], 'children': []}]}, {'type': 'Assignment', 'name': '=', 'range': [214, 215], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [215], 'children': []}]}]}, {'type': 'PropertyDeclaration', 'name': 'description', 'range': [217, 224], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [219], 'children': [{'type': 'TypeArgument', 'name': 'str', 'range': [221], 'children': []}]}, {'type': 'Assignment', 'name': '=', 'range': [223, 224], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [224], 'children': []}]}]}, {'type': 'PropertyDeclaration', 'name': 'user_id', 'range': [226, 228], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [228], 'children': []}]}]}, {'type': 'MethodDeclaration', 'name': 'from_db', 'range': [231, 368], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [237, 239], 'children': [{'type': 'TypeAnnotation', 'name': 'PrismaAPIKey', 'range': [239], 'children': []}]}, {'type': 'Block', 'name': '', 'range': [242, 368], 'children': [{'type': 'TryStatement', 'name': '', 'range': [243, 368], 'children': [{'type': 'Block', 'name': '', 'range': [245, 347], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [246, 347], 'children': [{'type': 'NewExpression', 'name': 'APIKey', 'range': [247, 346], 'children': [{'type': 'Argument', 'name': 'id', 'range': [250, 255], 'children': [{'type': 'Assignment', 'name': '=', 'range': [251, 255], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [253, 254], 'children': [{'type': 'Identifier', 'name': 'id', 'range': [254], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'name', 'range': [257, 262], 'children': [{'type': 'Assignment', 'name': '=', 'range': [258, 262], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [260, 261], 'children': [{'type': 'Identifier', 'name': 'name', 'range': [261], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'prefix', 'range': [264, 269], 'children': [{'type': 'Assignment', 'name': '=', 'range': [265, 269], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [267, 268], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [268], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'postfix', 'range': [271, 276], 'children': [{'type': 'Assignment', 'name': '=', 'range': [272, 276], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [274, 275], 'children': [{'type': 'Identifier', 'name': 'postfix', 'range': [275], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'key', 'range': [278, 283], 'children': [{'type': 'Assignment', 'name': '=', 'range': [279, 283], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [281, 282], 'children': [{'type': 'Identifier', 'name': 'key', 'range': [282], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'status', 'range': [285, 293], 'children': [{'type': 'Assignment', 'name': '=', 'range': [286, 293], 'children': [{'type': 'NewExpression', 'name': 'APIKeyStatus', 'range': [287, 292], 'children': [{'type': 'Argument', 'name': '', 'range': [289, 292], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [290, 291], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [291], 'children': []}]}]}]}]}]}, {'type': 'Argument', 'name': 'permissions', 'range': [295, 309], 'children': [{'type': 'Assignment', 'name': '=', 'range': [296, 309], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [297, 308], 'children': [{'type': 'NewExpression', 'name': 'APIKeyPermission', 'range': [298, 301], 'children': [{'type': 'Argument', 'name': 'p', 'range': [300], 'children': []}]}, {'type': 'ForStatement', 'name': '', 'range': [302, 308], 'children': [{'type': 'VariableDeclaration', 'name': 'p', 'range': [303], 'children': []}, {'type': 'InExpression', 'name': 'in', 'range': [304, 307], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [306, 307], 'children': [{'type': 'Identifier', 'name': 'permissions', 'range': [307], 'children': []}]}]}]}]}]}]}, {'type': 'Argument', 'name': 'created_at', 'range': [311, 316], 'children': [{'type': 'Assignment', 'name': '=', 'range': [312, 316], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [314, 315], 'children': [{'type': 'Identifier', 'name': 'createdAt', 'range': [315], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'last_used_at', 'range': [318, 323], 'children': [{'type': 'Assignment', 'name': '=', 'range': [319, 323], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [321, 322], 'children': [{'type': 'Identifier', 'name': 'lastUsedAt', 'range': [322], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'revoked_at', 'range': [325, 330], 'children': [{'type': 'Assignment', 'name': '=', 'range': [326, 330], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [328, 329], 'children': [{'type': 'Identifier', 'name': 'revokedAt', 'range': [329], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'description', 'range': [332, 337], 'children': [{'type': 'Assignment', 'name': '=', 'range': [333, 337], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [335, 336], 'children': [{'type': 'Identifier', 'name': 'description', 'range': [336], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'user_id', 'range': [339, 344], 'children': [{'type': 'Assignment', 'name': '=', 'range': [340, 344], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [342, 343], 'children': [{'type': 'Identifier', 'name': 'userId', 'range': [343], 'children': []}]}]}]}]}]}]}, {'type': 'CatchClause', 'name': '', 'range': [348, 368], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [351], 'children': []}, {'type': 'Block', 'name': '', 'range': [353, 368], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [354, 361], 'children': [{'type': 'CallExpression', 'name': '', 'range': [355, 360], 'children': [{'type': 'PropertyAccess', 'name': '.', 'range': [355, 356], 'children': [{'type': 'Identifier', 'name': 'error', 'range': [356], 'children': []}]}, {'type': 'Argument', 'name': '', 'range': [358, 360], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [359], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': '', 'range': [362, 368], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [363, 367], 'children': [{'type': 'Argument', 'name': '', 'range': [365, 367], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [366], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 09:27:33,080 - INFO - Starting Step 4: AST normalization
2025-01-08 09:27:38,362 - INFO - Step 5 result: {'type': 'Program', 'name': 'APIKeyWithoutHash', 'range': [370, 564], 'children': [{'type': 'ClassDecl', 'name': 'APIKeyWithoutHash', 'range': [370, 432], 'children': [{'type': 'Property', 'name': 'id', 'range': [377, 379], 'children': []}, {'type': 'Property', 'name': 'name', 'range': [381, 383], 'children': []}, {'type': 'Property', 'name': 'prefix', 'range': [385, 387], 'children': []}, {'type': 'Property', 'name': 'postfix', 'range': [389, 391], 'children': []}, {'type': 'Property', 'name': 'status', 'range': [393, 395], 'children': []}, {'type': 'Property', 'name': 'permissions', 'range': [397, 402], 'children': []}, {'type': 'Property', 'name': 'created_at', 'range': [404, 406], 'children': []}, {'type': 'Property', 'name': 'last_used_at', 'range': [408, 413], 'children': []}, {'type': 'Property', 'name': 'revoked_at', 'range': [415, 420], 'children': []}, {'type': 'Property', 'name': 'description', 'range': [422, 427], 'children': []}, {'type': 'Property', 'name': 'user_id', 'range': [429, 431], 'children': []}]}, {'type': 'FunctionDecl', 'name': 'from_db', 'range': [434, 564], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [440, 442], 'children': []}, {'type': 'BlockStatement', 'range': [446, 564], 'children': [{'type': 'TryStatement', 'range': [446, 564], 'children': [{'type': 'BlockStatement', 'range': [448, 543], 'children': [{'type': 'ReturnStatement', 'range': [449, 542], 'children': [{'type': 'NewExpression', 'range': [450, 542], 'children': [{'type': 'Property', 'name': 'id', 'range': [453, 457], 'children': []}, {'type': 'Property', 'name': 'name', 'range': [460, 464], 'children': []}, {'type': 'Property', 'name': 'prefix', 'range': [467, 471], 'children': []}, {'type': 'Property', 'name': 'postfix', 'range': [474, 478], 'children': []}, {'type': 'Property', 'name': 'status', 'range': [481, 487], 'children': []}, {'type': 'Property', 'name': 'permissions', 'range': [491, 503], 'children': []}, {'type': 'Property', 'name': 'created_at', 'range': [507, 511], 'children': []}, {'type': 'Property', 'name': 'last_used_at', 'range': [514, 518], 'children': []}, {'type': 'Property', 'name': 'revoked_at', 'range': [521, 525], 'children': []}, {'type': 'Property', 'name': 'description', 'range': [528, 532], 'children': []}, {'type': 'Property', 'name': 'user_id', 'range': [535, 539], 'children': []}]}]}]}, {'type': 'CatchClause', 'range': [544, 564], 'children': [{'type': 'BlockStatement', 'range': [548, 564], 'children': [{'type': 'ExpressionStatement', 'range': [550, 556], 'children': [{'type': 'CallExpression', 'range': [550, 556], 'children': [{'type': 'MemberExpression', 'range': [550, 552], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [550, 550]}, {'type': 'Identifier', 'name': 'error', 'range': [552, 552]}]}, {'type': 'Literal', 'value': 'Error creating APIKeyWithoutHash from db: {str(e)}', 'range': [554, 555]}]}]}, {'type': 'ThrowStatement', 'range': [558, 564], 'children': [{'type': 'NewExpression', 'range': [559, 563], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [559, 559]}, {'type': 'Literal', 'value': 'Failed to create API key object: {str(e)}', 'range': [561, 562]}]}]}]}]}]}]}]}]}
2025-01-08 09:27:38,362 - INFO - Completed main AST analysis flow
2025-01-08 09:27:38,363 - INFO - Successfully processed chunk
2025-01-08 09:27:45,211 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_api_key_by_id', 'range': [1483, 1592], 'children': [{'type': 'FunctionDecl', 'name': 'get_api_key_by_id', 'range': [1483, 1592], 'children': [{'type': 'FunctionSignature', 'name': 'get_api_key_by_id', 'range': [1483, 1501], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1483, 1488], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1484, 1487], 'children': []}, {'type': 'Identifier', 'name': 'get_api_key_by_id', 'range': [1485, 1501], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [1486, 1494], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [1487, 1489], 'children': []}, {'type': 'Parameter', 'name': 'user_id', 'range': [1491, 1493], 'children': []}]}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [1495, 1501], 'children': []}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [1502, 1592], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [1503, 1571], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [1505, 1550], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key', 'range': [1506, 1531], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1506, 1513], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1507, 1508], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1508, 1531], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().find_first', 'range': [1509, 1531], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1509, 1520], 'children': []}, {'type': 'CallExpression', 'name': 'prisma', 'range': [1510, 1513], 'children': []}, {'type': 'CallExpression', 'name': 'find_first', 'range': [1514, 1531], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [1518, 1529], 'children': [{'type': 'Property', 'name': 'id', 'range': [1522, 1524], 'children': []}, {'type': 'Property', 'name': 'userId', 'range': [1526, 1528], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1534, 1541], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [1535, 1536], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1536, 1541], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1538, 1541], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1539, 1540], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1540, 1541], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1543, 1550], 'children': [{'type': 'CallExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1544, 1550], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1544, 1559], 'children': []}, {'type': 'CallExpression', 'name': 'from_db', 'range': [1545, 1550], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1548, 1550], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1551, 1571], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1552, 1563], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [1555, 1571], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1557, 1564], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1557, 1564], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1561, 1563], 'children': []}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1565, 1571], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1566, 1571], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1568, 1570], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1572, 1592], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1573, 1582], 'children': []}, {'type': 'Block', 'name': 'body', 'range': [1576, 1592], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1578, 1585], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1578, 1585], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1582, 1584], 'children': []}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1586, 1592], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1587, 1592], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [1589, 1591], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:27:45,211 - INFO - Completed main AST analysis flow
2025-01-08 09:27:45,212 - INFO - Successfully processed chunk
2025-01-08 09:28:13,217 - INFO - Step 3 result: {'type': 'Program', 'name': 'suspend_api_key', 'range': [1253, 1439], 'children': [{'type': 'FunctionDeclaration', 'name': 'suspend_api_key', 'range': [1253, 1439], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1253, 1253], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1254, 1254], 'children': []}, {'type': 'Identifier', 'name': 'suspend_api_key', 'range': [1255, 1255], 'children': []}, {'type': 'Parameter', 'name': 'key_id', 'range': [1257, 1259], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [1257, 1257], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1259, 1259], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1261, 1263], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [1261, 1261], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1263, 1263], 'children': []}]}, {'type': 'TypeAnnotation', 'name': 'Optional', 'range': [1267, 1270], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyWithoutHash', 'range': [1269, 1269], 'children': []}]}, {'type': 'Block', 'name': 'try', 'range': [1273, 1439], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [1273, 1273], 'children': []}, {'type': 'Statement', 'name': 'api_key', 'range': [1276, 1294], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1276, 1276], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1278, 1278], 'children': []}, {'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1279, 1279], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [1281, 1281], 'children': []}, {'type': 'Identifier', 'name': 'find_unique', 'range': [1285, 1285], 'children': []}, {'type': 'Argument', 'name': 'where', 'range': [1287, 1293], 'children': [{'type': 'StringLiteral', 'name': '"id"', 'range': [1290, 1290], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1292, 1292], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1297, 1308], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1297, 1297], 'children': []}, {'type': 'Keyword', 'name': 'not', 'range': [1298, 1298], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [1299, 1299], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1302, 1307], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1303, 1303], 'children': []}, {'type': 'StringLiteral', 'name': 'f"API key with id {key_id} not found"', 'range': [1305, 1306], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1310, 1326], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1310, 1310], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [1311, 1311], 'children': []}, {'type': 'Identifier', 'name': 'userId', 'range': [1313, 1313], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1316, 1316], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1319, 1325], 'children': [{'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1320, 1320], 'children': []}, {'type': 'StringLiteral', 'name': '"You do not have permission to suspend this API key."', 'range': [1322, 1323], 'children': []}]}]}, {'type': 'Statement', 'name': 'where_clause', 'range': [1328, 1337], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1328, 1328], 'children': []}, {'type': 'TypeAnnotation', 'name': 'APIKeyWhereUniqueInput', 'range': [1330, 1330], 'children': []}, {'type': 'StringLiteral', 'name': '"id"', 'range': [1333, 1333], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1335, 1335], 'children': []}]}, {'type': 'Statement', 'name': 'updated_api_key', 'range': [1338, 1368], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1338, 1338], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1340, 1340], 'children': []}, {'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1341, 1341], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [1343, 1343], 'children': []}, {'type': 'Identifier', 'name': 'update', 'range': [1347, 1347], 'children': []}, {'type': 'Argument', 'name': 'where', 'range': [1350, 1352], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1352, 1352], 'children': []}]}, {'type': 'Argument', 'name': 'data', 'range': [1355, 1364], 'children': [{'type': 'Identifier', 'name': 'APIKeyUpdateInput', 'range': [1357, 1357], 'children': []}, {'type': 'Identifier', 'name': 'status', 'range': [1359, 1359], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [1361, 1361], 'children': []}, {'type': 'Identifier', 'name': 'SUSPENDED', 'range': [1363, 1363], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1370, 1381], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1370, 1370], 'children': []}, {'type': 'Identifier', 'name': 'updated_api_key', 'range': [1371, 1371], 'children': []}, {'type': 'Statement', 'name': 'return', 'range': [1374, 1380], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1375, 1375], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [1377, 1377], 'children': []}, {'type': 'Identifier', 'name': 'updated_api_key', 'range': [1379, 1379], 'children': []}]}]}, {'type': 'Statement', 'name': 'return', 'range': [1382, 1383], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1383, 1383], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1385, 1397], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1387, 1387], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1389, 1389], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1395, 1396], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [1396, 1396], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1398, 1418], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1399, 1399], 'children': []}, {'type': 'Statement', 'name': 'logger', 'range': [1404, 1410], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1404, 1404], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1406, 1406], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Database error while suspending API key: {str(e)}"', 'range': [1408, 1409], 'children': []}]}, {'type': 'Statement', 'name': 'raise', 'range': [1412, 1417], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1413, 1413], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Failed to suspend API key: {str(e)}"', 'range': [1415, 1416], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1419, 1439], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1420, 1420], 'children': []}, {'type': 'Statement', 'name': 'logger', 'range': [1425, 1431], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1425, 1425], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1427, 1427], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Unexpected error while suspending API key: {str(e)}"', 'range': [1429, 1430], 'children': []}]}, {'type': 'Statement', 'name': 'raise', 'range': [1433, 1438], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1434, 1434], 'children': []}, {'type': 'StringLiteral', 'name': 'f"Failed to suspend API key: {str(e)}"', 'range': [1436, 1437], 'children': []}]}]}]}]}]}
2025-01-08 09:28:13,217 - INFO - Starting Step 4: AST normalization
2025-01-08 09:28:29,046 - INFO - Step 3 result: {'type': 'FunctionDef', 'name': 'update_api_key_permissions', 'range': [1593, 1790], 'children': [{'type': 'Async', 'range': [1593, 1593]}, {'type': 'Parameters', 'range': [1596, 1613], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [1598, 1600], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [1600, 1600]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1602, 1604], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [1604, 1604]}]}, {'type': 'Parameter', 'name': 'permissions', 'range': [1606, 1608], 'children': [{'type': 'TypeAnnotation', 'name': 'List', 'range': [1608, 1611], 'children': [{'type': 'TypeArgument', 'name': 'APIKeyPermission', 'range': [1610, 1610]}]}]}]}, {'type': 'ReturnType', 'range': [1614, 1619], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [1616, 1619], 'children': [{'type': 'TypeArgument', 'name': 'APIKeyWithoutHash', 'range': [1618, 1618]}]}]}, {'type': 'Docstring', 'range': [1622, 1624], 'children': [{'type': 'Literal', 'value': 'Update the permissions of an API key.', 'range': [1623, 1623]}]}, {'type': 'Try', 'range': [1626, 1790], 'children': [{'type': 'Block', 'range': [1628, 1735], 'children': [{'type': 'Assignment', 'range': [1629, 1647], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1629, 1629]}, {'type': 'Await', 'range': [1631, 1631]}, {'type': 'Call', 'name': 'find_unique', 'range': [1638, 1647], 'children': [{'type': 'Argument', 'name': 'where', 'range': [1640, 1646], 'children': [{'type': 'Dict', 'range': [1642, 1646], 'children': [{'type': 'KeyValuePair', 'range': [1643, 1645], 'children': [{'type': 'Literal', 'value': 'id', 'range': [1643, 1643]}, {'type': 'Identifier', 'name': 'key_id', 'range': [1645, 1645]}]}]}]}]}]}, {'type': 'If', 'range': [1650, 1661], 'children': [{'type': 'Condition', 'range': [1651, 1653], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1651, 1651]}, {'type': 'Is', 'range': [1652, 1652]}, {'type': 'None', 'range': [1653, 1653]}]}, {'type': 'Raise', 'range': [1656, 1660], 'children': [{'type': 'Call', 'name': 'APIKeyNotFoundError', 'range': [1657, 1660], 'children': [{'type': 'Argument', 'range': [1659, 1659], 'children': [{'type': 'Literal', 'value': 'No such API key found.', 'range': [1659, 1659]}]}]}]}]}, {'type': 'If', 'range': [1663, 1678], 'children': [{'type': 'Condition', 'range': [1664, 1669], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1664, 1664]}, {'type': 'Attribute', 'name': 'userId', 'range': [1666, 1666]}, {'type': 'NotEqual', 'range': [1667, 1668]}, {'type': 'Identifier', 'name': 'user_id', 'range': [1669, 1669]}]}, {'type': 'Raise', 'range': [1672, 1678], 'children': [{'type': 'Call', 'name': 'APIKeyPermissionError', 'range': [1673, 1678], 'children': [{'type': 'Argument', 'range': [1676, 1676], 'children': [{'type': 'Literal', 'value': 'You do not have permission to update this API key.', 'range': [1676, 1676]}]}]}]}]}, {'type': 'Assignment', 'range': [1681, 1689], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1681, 1681]}, {'type': 'TypeAnnotation', 'name': 'APIKeyWhereUniqueInput', 'range': [1683, 1683]}, {'type': 'Dict', 'range': [1685, 1689], 'children': [{'type': 'KeyValuePair', 'range': [1686, 1688], 'children': [{'type': 'Literal', 'value': 'id', 'range': [1686, 1686]}, {'type': 'Identifier', 'name': 'key_id', 'range': [1688, 1688]}]}]}]}, {'type': 'Assignment', 'range': [1691, 1718], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1691, 1691]}, {'type': 'Await', 'range': [1693, 1693]}, {'type': 'Call', 'name': 'update', 'range': [1700, 1718], 'children': [{'type': 'Argument', 'name': 'where', 'range': [1703, 1705], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1705, 1705]}]}, {'type': 'Argument', 'name': 'data', 'range': [1708, 1715], 'children': [{'type': 'Call', 'name': 'APIKeyUpdateInput', 'range': [1710, 1715], 'children': [{'type': 'Argument', 'name': 'permissions', 'range': [1712, 1714], 'children': [{'type': 'Identifier', 'name': 'permissions', 'range': [1714, 1714]}]}]}]}]}]}, {'type': 'If', 'range': [1721, 1732], 'children': [{'type': 'Condition', 'range': [1722, 1723], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1722, 1722]}]}, {'type': 'Return', 'range': [1725, 1731], 'children': [{'type': 'Call', 'name': 'from_db', 'range': [1728, 1731], 'children': [{'type': 'Argument', 'range': [1730, 1730], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1730, 1730]}]}]}]}]}, {'type': 'Return', 'range': [1733, 1734], 'children': [{'type': 'None', 'range': [1734, 1734]}]}]}, {'type': 'Except', 'range': [1736, 1748], 'children': [{'type': 'Exception', 'range': [1738, 1741], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1738, 1738]}, {'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1740, 1740]}]}, {'type': 'Raise', 'range': [1746, 1747], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [1747, 1747]}]}]}, {'type': 'Except', 'range': [1749, 1769], 'children': [{'type': 'Exception', 'range': [1750, 1750], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1750, 1750]}]}, {'type': 'Call', 'name': 'error', 'range': [1757, 1761], 'children': [{'type': 'Argument', 'range': [1759, 1760], 'children': [{'type': 'Literal', 'value': 'Database error while updating API key permissions: {str(e)}', 'range': [1760, 1760]}]}]}, {'type': 'Raise', 'range': [1763, 1768], 'children': [{'type': 'Call', 'name': 'APIKeyError', 'range': [1764, 1768], 'children': [{'type': 'Argument', 'range': [1766, 1767], 'children': [{'type': 'Literal', 'value': 'Failed to update API key permissions: {str(e)}', 'range': [1767, 1767]}]}]}]}]}, {'type': 'Except', 'range': [1770, 1790], 'children': [{'type': 'Exception', 'range': [1771, 1771], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1771, 1771]}]}, {'type': 'Call', 'name': 'error', 'range': [1778, 1782], 'children': [{'type': 'Argument', 'range': [1780, 1781], 'children': [{'type': 'Literal', 'value': 'Unexpected error while updating API key permissions: {str(e)}', 'range': [1781, 1781]}]}]}, {'type': 'Raise', 'range': [1784, 1789], 'children': [{'type': 'Call', 'name': 'APIKeyError', 'range': [1785, 1789], 'children': [{'type': 'Argument', 'range': [1787, 1788], 'children': [{'type': 'Literal', 'value': 'Failed to update API key permissions: {str(e)}', 'range': [1788, 1788]}]}]}]}]}]}]}
2025-01-08 09:28:29,046 - INFO - Starting Step 4: AST normalization
2025-01-08 09:28:55,382 - INFO - Step 3 result: {'type': 'Program', 'name': 'revoke_api_key', 'range': [940, 1139], 'children': [{'type': 'FunctionDeclaration', 'name': 'revoke_api_key', 'range': [940, 1139], 'children': [{'type': 'FunctionSignature', 'name': 'revoke_api_key', 'range': [940, 958], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [940, 944], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [941, 944], 'children': []}, {'type': 'Identifier', 'name': 'revoke_api_key', 'range': [942, 955], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [943, 951], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [944, 947], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [944, 947], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [945, 947], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [948, 951], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [948, 951], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [949, 951], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [952, 958], 'children': [{'type': 'Keyword', 'name': '->', 'range': [952, 954], 'children': []}, {'type': 'Type', 'name': 'Optional', 'range': [954, 958], 'children': []}, {'type': 'Type', 'name': 'APIKeyWithoutHash', 'range': [955, 958], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [959, 1139], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [960, 1139], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [962, 1084], 'children': [{'type': 'VariableDeclaration', 'name': 'api_key', 'range': [963, 981], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [963, 970], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [964, 965], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [965, 981], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().find_unique', 'range': [966, 981], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [966, 973], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [966, 973], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [967, 973], 'children': []}]}, {'type': 'CallExpression', 'name': 'find_unique', 'range': [972, 981], 'children': [{'type': 'Identifier', 'name': 'find_unique', 'range': [972, 981], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [973, 981], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [974, 980], 'children': [{'type': 'Property', 'name': 'id', 'range': [977, 980], 'children': [{'type': 'Literal', 'name': '"id"', 'range': [977, 980], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [978, 980], 'children': []}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [984, 995], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [985, 987], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [985, 987], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [986, 987], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [988, 995], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [989, 995], 'children': [{'type': 'NewExpression', 'name': 'APIKeyNotFoundError', 'range': [990, 995], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [990, 995], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [991, 995], 'children': [{'type': 'TemplateLiteral', 'name': 'f"API key with id {key_id} not found"', 'range': [992, 995], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [997, 1012], 'children': [{'type': 'Condition', 'name': 'api_key.userId != user_id', 'range': [998, 1004], 'children': [{'type': 'MemberExpression', 'name': 'api_key.userId', 'range': [998, 1001], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [998, 1001], 'children': []}, {'type': 'Identifier', 'name': 'userId', 'range': [999, 1001], 'children': []}]}, {'type': 'BinaryExpression', 'name': '!=', 'range': [1001, 1004], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1003, 1004], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1005, 1012], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1006, 1012], 'children': [{'type': 'NewExpression', 'name': 'APIKeyPermissionError', 'range': [1007, 1012], 'children': [{'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1007, 1012], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1008, 1012], 'children': [{'type': 'Literal', 'name': '"You do not have permission to revoke this API key."', 'range': [1010, 1012], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'where_clause', 'range': [1015, 1024], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1015, 1024], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1016, 1017], 'children': []}, {'type': 'ObjectExpression', 'name': 'APIKeyWhereUniqueInput', 'range': [1018, 1024], 'children': [{'type': 'Property', 'name': 'id', 'range': [1020, 1023], 'children': [{'type': 'Literal', 'name': '"id"', 'range': [1020, 1023], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1021, 1023], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'updated_api_key', 'range': [1025, 1068], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1025, 1038], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1026, 1027], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1027, 1068], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().update', 'range': [1028, 1068], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [1028, 1035], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1028, 1035], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [1029, 1035], 'children': []}]}, {'type': 'CallExpression', 'name': 'update', 'range': [1034, 1068], 'children': [{'type': 'Identifier', 'name': 'update', 'range': [1034, 1068], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1035, 1068], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [1037, 1040], 'children': [{'type': 'Property', 'name': 'where', 'range': [1037, 1040], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1038, 1040], 'children': []}]}]}, {'type': 'ObjectExpression', 'name': 'data', 'range': [1042, 1065], 'children': [{'type': 'Property', 'name': 'data', 'range': [1042, 1065], 'children': [{'type': 'NewExpression', 'name': 'APIKeyUpdateInput', 'range': [1044, 1065], 'children': [{'type': 'Identifier', 'name': 'APIKeyUpdateInput', 'range': [1044, 1065], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1045, 1065], 'children': [{'type': 'Property', 'name': 'status', 'range': [1047, 1052], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [1047, 1052], 'children': []}, {'type': 'MemberExpression', 'name': 'APIKeyStatus.REVOKED', 'range': [1049, 1052], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [1049, 1052], 'children': []}, {'type': 'Identifier', 'name': 'REVOKED', 'range': [1050, 1052], 'children': []}]}]}, {'type': 'Property', 'name': 'revokedAt', 'range': [1053, 1063], 'children': [{'type': 'Identifier', 'name': 'revokedAt', 'range': [1053, 1063], 'children': []}, {'type': 'CallExpression', 'name': 'datetime.now', 'range': [1055, 1063], 'children': [{'type': 'MemberExpression', 'name': 'datetime.now', 'range': [1055, 1063], 'children': [{'type': 'Identifier', 'name': 'datetime', 'range': [1055, 1063], 'children': []}, {'type': 'Identifier', 'name': 'now', 'range': [1056, 1063], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1058, 1063], 'children': [{'type': 'MemberExpression', 'name': 'timezone.utc', 'range': [1059, 1063], 'children': [{'type': 'Identifier', 'name': 'timezone', 'range': [1059, 1063], 'children': []}, {'type': 'Identifier', 'name': 'utc', 'range': [1060, 1063], 'children': []}]}]}]}]}]}]}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1070, 1081], 'children': [{'type': 'Condition', 'name': 'updated_api_key', 'range': [1071, 1072], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1071, 1072], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1073, 1081], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1074, 1081], 'children': [{'type': 'CallExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1075, 1081], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1075, 1081], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1075, 1081], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [1076, 1081], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1078, 1081], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1079, 1081], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1082, 1084], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1083, 1084], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1085, 1097], 'children': [{'type': 'Block', 'name': 'body', 'range': [1094, 1097], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1095, 1097], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [1096, 1097], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1098, 1118], 'children': [{'type': 'Block', 'name': 'body', 'range': [1103, 1118], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1104, 1111], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1105, 1111], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1107, 1111], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Database error while revoking API key: {str(e)}"', 'range': [1108, 1111], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1112, 1118], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1113, 1118], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1113, 1118], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1114, 1118], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to revoke API key: {str(e)}"', 'range': [1115, 1118], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1119, 1139], 'children': [{'type': 'Block', 'name': 'body', 'range': [1124, 1139], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1125, 1132], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1126, 1132], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1128, 1132], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Unexpected error while revoking API key: {str(e)}"', 'range': [1129, 1132], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1133, 1139], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1134, 1139], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1134, 1139], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1135, 1139], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to revoke API key: {str(e)}"', 'range': [1136, 1139], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 09:28:55,382 - INFO - Starting Step 4: AST normalization
2025-01-08 09:29:01,708 - INFO - Step 3 result: {'type': 'Program', 'name': 'validate_api_key', 'range': [770, 939], 'children': [{'type': 'FunctionDeclaration', 'name': 'validate_api_key', 'range': [770, 939], 'children': [{'type': 'FunctionSignature', 'name': 'validate_api_key', 'range': [770, 784], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [770, 774], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [771, 774], 'children': []}, {'type': 'Identifier', 'name': 'validate_api_key', 'range': [772, 787], 'children': []}, {'type': 'Parameter', 'name': 'plain_text_key', 'range': [774, 777], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [774, 787], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [776, 779], 'children': []}]}, {'type': 'ReturnType', 'name': 'Optional[APIKey]', 'range': [780, 784], 'children': [{'type': 'Keyword', 'name': 'Optional', 'range': [780, 787], 'children': []}, {'type': 'Type', 'name': 'APIKey', 'range': [782, 787], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'validate_api_key', 'range': [785, 939], 'children': [{'type': 'Docstring', 'name': 'Validate an API key and return the API key object if valid.', 'range': [786, 788], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [790, 939], 'children': [{'type': 'TryBlock', 'name': 'try', 'range': [790, 919], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [793, 814], 'children': [{'type': 'Condition', 'name': 'not plain_text_key.startswith(APIKeyManager.PREFIX)', 'range': [794, 803], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [794, 797], 'children': []}, {'type': 'MemberExpression', 'name': 'plain_text_key.startswith', 'range': [795, 802], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [795, 808], 'children': []}, {'type': 'Identifier', 'name': 'startswith', 'range': [797, 807], 'children': []}]}, {'type': 'CallExpression', 'name': 'startswith(APIKeyManager.PREFIX)', 'range': [798, 802], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyManager.PREFIX', 'range': [799, 801], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [799, 812], 'children': []}, {'type': 'Identifier', 'name': 'PREFIX', 'range': [801, 807], 'children': []}]}]}]}, {'type': 'Block', 'name': 'if', 'range': [804, 814], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning("Invalid API key format")', 'range': [805, 811], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [805, 810], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [805, 811], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [807, 814], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning("Invalid API key format")', 'range': [808, 810], 'children': [{'type': 'StringLiteral', 'name': '"Invalid API key format"', 'range': [809, 810], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [812, 814], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [812, 818], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [813, 817], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'prefix = plain_text_key[:APIKeyManager.PREFIX_LENGTH]', 'range': [816, 825], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [816, 822], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [817, 818], 'children': []}, {'type': 'MemberExpression', 'name': 'plain_text_key[:APIKeyManager.PREFIX_LENGTH]', 'range': [818, 824], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [818, 831], 'children': []}, {'type': 'SliceExpression', 'name': '[:APIKeyManager.PREFIX_LENGTH]', 'range': [819, 824], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyManager.PREFIX_LENGTH', 'range': [821, 823], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [821, 834], 'children': []}, {'type': 'Identifier', 'name': 'PREFIX_LENGTH', 'range': [823, 836], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'api_manager = APIKeyManager()', 'range': [826, 831], 'children': [{'type': 'Identifier', 'name': 'api_manager', 'range': [826, 837], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [827, 828], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyManager()', 'range': [828, 830], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [828, 841], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'api_key = await PrismaAPIKey.prisma().find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [833, 862], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [833, 840], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [834, 835], 'children': []}, {'type': 'AwaitExpression', 'name': 'await PrismaAPIKey.prisma().find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [835, 862], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma()', 'range': [836, 839], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [836, 838], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [836, 849], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [838, 844], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [842, 862], 'children': [{'type': 'Identifier', 'name': 'find_first', 'range': [842, 851], 'children': []}, {'type': 'Argument', 'name': 'where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE))', 'range': [845, 861], 'children': [{'type': 'Identifier', 'name': 'where', 'range': [845, 850], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [846, 847], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE))', 'range': [847, 861], 'children': [{'type': 'Identifier', 'name': 'APIKeyWhereInput', 'range': [847, 862], 'children': []}, {'type': 'Argument', 'name': 'prefix=prefix', 'range': [849, 851], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [849, 854], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [850, 851], 'children': []}, {'type': 'Identifier', 'name': 'prefix', 'range': [851, 856], 'children': []}]}, {'type': 'Argument', 'name': 'status=(APIKeyStatus.ACTIVE)', 'range': [853, 860], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [853, 859], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [854, 855], 'children': []}, {'type': 'ParenthesizedExpression', 'name': '(APIKeyStatus.ACTIVE)', 'range': [855, 860], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyStatus.ACTIVE', 'range': [856, 859], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [856, 869], 'children': []}, {'type': 'Identifier', 'name': 'ACTIVE', 'range': [858, 863], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [865, 880], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [866, 868], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [866, 869], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [867, 874], 'children': []}]}, {'type': 'Block', 'name': 'if', 'range': [869, 880], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning(f"No active API key found with prefix {prefix}")', 'range': [870, 877], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [870, 876], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [870, 876], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [872, 879], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning(f"No active API key found with prefix {prefix}")', 'range': [873, 876], 'children': [{'type': 'TemplateLiteral', 'name': 'f"No active API key found with prefix {prefix}"', 'range': [874, 876], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [875, 880], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [878, 880], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [878, 884], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [879, 883], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'is_valid = api_manager.verify_api_key(plain_text_key, api_key.key)', 'range': [882, 894], 'children': [{'type': 'Identifier', 'name': 'is_valid', 'range': [882, 890], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [883, 884], 'children': []}, {'type': 'CallExpression', 'name': 'api_manager.verify_api_key(plain_text_key, api_key.key)', 'range': [884, 894], 'children': [{'type': 'MemberExpression', 'name': 'api_manager.verify_api_key', 'range': [884, 893], 'children': [{'type': 'Identifier', 'name': 'api_manager', 'range': [884, 895], 'children': []}, {'type': 'Identifier', 'name': 'verify_api_key', 'range': [886, 899], 'children': []}]}, {'type': 'Argument', 'name': 'plain_text_key', 'range': [888, 889], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [888, 901], 'children': []}]}, {'type': 'Argument', 'name': 'api_key.key', 'range': [890, 893], 'children': [{'type': 'MemberExpression', 'name': 'api_key.key', 'range': [890, 893], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [890, 897], 'children': []}, {'type': 'Identifier', 'name': 'key', 'range': [892, 895], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [895, 909], 'children': [{'type': 'Condition', 'name': 'not is_valid', 'range': [896, 898], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [896, 899], 'children': []}, {'type': 'Identifier', 'name': 'is_valid', 'range': [897, 905], 'children': []}]}, {'type': 'Block', 'name': 'if', 'range': [899, 909], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning("API key verification failed")', 'range': [900, 906], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [900, 905], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [900, 906], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [902, 908], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning("API key verification failed")', 'range': [903, 905], 'children': [{'type': 'StringLiteral', 'name': '"API key verification failed"', 'range': [904, 905], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [907, 909], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [907, 913], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [908, 912], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return APIKey.from_db(api_key)', 'range': [911, 918], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [911, 917], 'children': []}, {'type': 'CallExpression', 'name': 'APIKey.from_db(api_key)', 'range': [912, 918], 'children': [{'type': 'MemberExpression', 'name': 'APIKey.from_db', 'range': [912, 917], 'children': [{'type': 'Identifier', 'name': 'APIKey', 'range': [912, 917], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [914, 921], 'children': []}]}, {'type': 'Argument', 'name': 'api_key', 'range': [916, 917], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [916, 923], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [919, 939], 'children': [{'type': 'Parameter', 'name': 'Exception as e', 'range': [920, 923], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [920, 929], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [922, 923], 'children': []}]}, {'type': 'Block', 'name': 'except', 'range': [924, 939], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Error validating API key: {str(e)}")', 'range': [925, 932], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [925, 931], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [925, 931], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [927, 933], 'children': []}]}, {'type': 'CallExpression', 'name': 'error(f"Error validating API key: {str(e)}")', 'range': [928, 931], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Error validating API key: {str(e)}"', 'range': [929, 931], 'children': [{'type': 'CallExpression', 'name': 'str(e)', 'range': [930, 931], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [930, 933], 'children': []}, {'type': 'Argument', 'name': 'e', 'range': [931, 932], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [931, 932], 'children': []}]}]}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise APIKeyValidationError(f"Failed to validate API key: {str(e)}")', 'range': [933, 939], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [933, 938], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyValidationError(f"Failed to validate API key: {str(e)}")', 'range': [934, 939], 'children': [{'type': 'Identifier', 'name': 'APIKeyValidationError', 'range': [934, 955], 'children': []}, {'type': 'Argument', 'name': 'f"Failed to validate API key: {str(e)}"', 'range': [936, 938], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to validate API key: {str(e)}"', 'range': [937, 938], 'children': [{'type': 'CallExpression', 'name': 'str(e)', 'range': [938, 939], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [938, 941], 'children': []}, {'type': 'Argument', 'name': 'e', 'range': [939, 940], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [939, 940], 'children': []}]}]}]}]}]}]}]}]}]}]}]}]}
2025-01-08 09:29:01,708 - INFO - Starting Step 4: AST normalization
2025-01-08 09:29:38,890 - INFO - Step 4 result: {'type': 'Program', 'name': 'APIKey', 'range': [157, 369], 'children': [{'type': 'ClassDecl', 'name': 'APIKey', 'range': [157, 216], 'children': [{'type': 'PropertyDecl', 'name': 'name', 'range': [164, 166], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [166], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'prefix', 'range': [168, 170], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [170], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'key', 'range': [172, 174], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [174], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'status', 'range': [176, 183], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyStatus', 'range': [178], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [179, 183], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [180], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [181, 182], 'children': [{'type': 'Identifier', 'name': 'ACTIVE', 'range': [182], 'children': []}]}]}]}, {'type': 'PropertyDecl', 'name': 'permissions', 'range': [184, 190], 'children': [{'type': 'TypeAnnotation', 'name': 'List', 'range': [186], 'children': [{'type': 'TypeArgument', 'name': 'APIKeyPermission', 'range': [188], 'children': []}]}]}, {'type': 'PropertyDecl', 'name': 'postfix', 'range': [191, 193], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [193], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'created_at', 'range': [195, 197], 'children': [{'type': 'TypeAnnotation', 'name': 'datetime', 'range': [197], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'last_used_at', 'range': [199, 206], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [201], 'children': [{'type': 'TypeArgument', 'name': 'datetime', 'range': [203], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [205, 206], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [206], 'children': []}]}]}, {'type': 'PropertyDecl', 'name': 'revoked_at', 'range': [208, 215], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [210], 'children': [{'type': 'TypeArgument', 'name': 'datetime', 'range': [212], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [214, 215], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [215], 'children': []}]}]}, {'type': 'PropertyDecl', 'name': 'description', 'range': [217, 224], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [219], 'children': [{'type': 'TypeArgument', 'name': 'str', 'range': [221], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [223, 224], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [224], 'children': []}]}]}, {'type': 'PropertyDecl', 'name': 'user_id', 'range': [226, 228], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [228], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': 'from_db', 'range': [231, 368], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [237, 239], 'children': [{'type': 'TypeAnnotation', 'name': 'PrismaAPIKey', 'range': [239], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [242, 368], 'children': [{'type': 'TryStatement', 'name': '', 'range': [243, 368], 'children': [{'type': 'BlockStatement', 'name': '', 'range': [245, 347], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [246, 347], 'children': [{'type': 'NewExpression', 'name': 'APIKey', 'range': [247, 346], 'children': [{'type': 'Argument', 'name': 'id', 'range': [250, 255], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [251, 255], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [253, 254], 'children': [{'type': 'Identifier', 'name': 'id', 'range': [254], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'name', 'range': [257, 262], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [258, 262], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [260, 261], 'children': [{'type': 'Identifier', 'name': 'name', 'range': [261], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'prefix', 'range': [264, 269], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [265, 269], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [267, 268], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [268], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'postfix', 'range': [271, 276], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [272, 276], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [274, 275], 'children': [{'type': 'Identifier', 'name': 'postfix', 'range': [275], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'key', 'range': [278, 283], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [279, 283], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [281, 282], 'children': [{'type': 'Identifier', 'name': 'key', 'range': [282], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'status', 'range': [285, 293], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [286, 293], 'children': [{'type': 'NewExpression', 'name': 'APIKeyStatus', 'range': [287, 292], 'children': [{'type': 'Argument', 'name': '', 'range': [289, 292], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [290, 291], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [291], 'children': []}]}]}]}]}]}, {'type': 'Argument', 'name': 'permissions', 'range': [295, 309], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [296, 309], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [297, 308], 'children': [{'type': 'NewExpression', 'name': 'APIKeyPermission', 'range': [298, 301], 'children': [{'type': 'Argument', 'name': 'p', 'range': [300], 'children': []}]}, {'type': 'ForStatement', 'name': '', 'range': [302, 308], 'children': [{'type': 'VariableDeclaration', 'name': 'p', 'range': [303], 'children': []}, {'type': 'InExpression', 'name': 'in', 'range': [304, 307], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [306, 307], 'children': [{'type': 'Identifier', 'name': 'permissions', 'range': [307], 'children': []}]}]}]}]}]}]}, {'type': 'Argument', 'name': 'created_at', 'range': [311, 316], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [312, 316], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [314, 315], 'children': [{'type': 'Identifier', 'name': 'createdAt', 'range': [315], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'last_used_at', 'range': [318, 323], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [319, 323], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [321, 322], 'children': [{'type': 'Identifier', 'name': 'lastUsedAt', 'range': [322], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'revoked_at', 'range': [325, 330], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [326, 330], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [328, 329], 'children': [{'type': 'Identifier', 'name': 'revokedAt', 'range': [329], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'description', 'range': [332, 337], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [333, 337], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [335, 336], 'children': [{'type': 'Identifier', 'name': 'description', 'range': [336], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'user_id', 'range': [339, 344], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [340, 344], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [342, 343], 'children': [{'type': 'Identifier', 'name': 'userId', 'range': [343], 'children': []}]}]}]}]}]}]}, {'type': 'CatchClause', 'name': '', 'range': [348, 368], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [351], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [353, 368], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [354, 361], 'children': [{'type': 'CallExpression', 'name': '', 'range': [355, 360], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [355, 356], 'children': [{'type': 'Identifier', 'name': 'error', 'range': [356], 'children': []}]}, {'type': 'Argument', 'name': '', 'range': [358, 360], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [359], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': '', 'range': [362, 368], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [363, 367], 'children': [{'type': 'Argument', 'name': '', 'range': [365, 367], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [366], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 09:29:38,890 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:30:20,000 - INFO - Step 4 result: {'type': 'Program', 'name': 'suspend_api_key', 'range': [1253, 1439], 'children': [{'type': 'FunctionDecl', 'name': 'suspend_api_key', 'range': [1253, 1439], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1253, 1253], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1254, 1254], 'children': []}, {'type': 'Identifier', 'name': 'suspend_api_key', 'range': [1255, 1255], 'children': []}, {'type': 'Parameter', 'name': 'key_id', 'range': [1257, 1259], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [1257, 1257], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1259, 1259], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1261, 1263], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [1261, 1261], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1263, 1263], 'children': []}]}, {'type': 'TypeAnnotation', 'name': 'Optional', 'range': [1267, 1270], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyWithoutHash', 'range': [1269, 1269], 'children': []}]}, {'type': 'Block', 'name': 'try', 'range': [1273, 1439], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [1273, 1273], 'children': []}, {'type': 'Statement', 'name': 'api_key', 'range': [1276, 1294], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1276, 1276], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1278, 1278], 'children': []}, {'type': 'CallExpression', 'name': 'PrismaAPIKey', 'range': [1279, 1279], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [1281, 1281], 'children': []}, {'type': 'Identifier', 'name': 'find_unique', 'range': [1285, 1285], 'children': []}, {'type': 'Argument', 'name': 'where', 'range': [1287, 1293], 'children': [{'type': 'Literal', 'name': '"id"', 'range': [1290, 1290], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1292, 1292], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1297, 1308], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1297, 1297], 'children': []}, {'type': 'Keyword', 'name': 'not', 'range': [1298, 1298], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [1299, 1299], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1302, 1307], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1303, 1303], 'children': []}, {'type': 'Literal', 'name': 'f"API key with id {key_id} not found"', 'range': [1305, 1306], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1310, 1326], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1310, 1310], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [1311, 1311], 'children': []}, {'type': 'Identifier', 'name': 'userId', 'range': [1313, 1313], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1316, 1316], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1319, 1325], 'children': [{'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1320, 1320], 'children': []}, {'type': 'Literal', 'name': '"You do not have permission to suspend this API key."', 'range': [1322, 1323], 'children': []}]}]}, {'type': 'Statement', 'name': 'where_clause', 'range': [1328, 1337], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1328, 1328], 'children': []}, {'type': 'TypeAnnotation', 'name': 'APIKeyWhereUniqueInput', 'range': [1330, 1330], 'children': []}, {'type': 'Literal', 'name': '"id"', 'range': [1333, 1333], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1335, 1335], 'children': []}]}, {'type': 'Statement', 'name': 'updated_api_key', 'range': [1338, 1368], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1338, 1338], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1340, 1340], 'children': []}, {'type': 'CallExpression', 'name': 'PrismaAPIKey', 'range': [1341, 1341], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [1343, 1343], 'children': []}, {'type': 'Identifier', 'name': 'update', 'range': [1347, 1347], 'children': []}, {'type': 'Argument', 'name': 'where', 'range': [1350, 1352], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1352, 1352], 'children': []}]}, {'type': 'Argument', 'name': 'data', 'range': [1355, 1364], 'children': [{'type': 'Identifier', 'name': 'APIKeyUpdateInput', 'range': [1357, 1357], 'children': []}, {'type': 'Identifier', 'name': 'status', 'range': [1359, 1359], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [1361, 1361], 'children': []}, {'type': 'Identifier', 'name': 'SUSPENDED', 'range': [1363, 1363], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1370, 1381], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1370, 1370], 'children': []}, {'type': 'Identifier', 'name': 'updated_api_key', 'range': [1371, 1371], 'children': []}, {'type': 'Statement', 'name': 'return', 'range': [1374, 1380], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1375, 1375], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [1377, 1377], 'children': []}, {'type': 'Identifier', 'name': 'updated_api_key', 'range': [1379, 1379], 'children': []}]}]}, {'type': 'Statement', 'name': 'return', 'range': [1382, 1383], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1383, 1383], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1385, 1397], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1387, 1387], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1389, 1389], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1395, 1396], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [1396, 1396], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1398, 1418], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1399, 1399], 'children': []}, {'type': 'Statement', 'name': 'logger', 'range': [1404, 1410], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1404, 1404], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1406, 1406], 'children': []}, {'type': 'Literal', 'name': 'f"Database error while suspending API key: {str(e)}"', 'range': [1408, 1409], 'children': []}]}, {'type': 'Statement', 'name': 'raise', 'range': [1412, 1417], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1413, 1413], 'children': []}, {'type': 'Literal', 'name': 'f"Failed to suspend API key: {str(e)}"', 'range': [1415, 1416], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1419, 1439], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1420, 1420], 'children': []}, {'type': 'Statement', 'name': 'logger', 'range': [1425, 1431], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1425, 1425], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1427, 1427], 'children': []}, {'type': 'Literal', 'name': 'f"Unexpected error while suspending API key: {str(e)}"', 'range': [1429, 1430], 'children': []}]}, {'type': 'Statement', 'name': 'raise', 'range': [1433, 1438], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1434, 1434], 'children': []}, {'type': 'Literal', 'name': 'f"Failed to suspend API key: {str(e)}"', 'range': [1436, 1437], 'children': []}]}]}]}]}]}
2025-01-08 09:30:20,001 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:30:20,164 - INFO - Step 4 result: {'type': 'FunctionDecl', 'name': 'update_api_key_permissions', 'range': [1593, 1790], 'children': [{'type': 'Async', 'range': [1593, 1593]}, {'type': 'Parameters', 'range': [1596, 1613], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [1598, 1600], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [1600, 1600]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1602, 1604], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [1604, 1604]}]}, {'type': 'Parameter', 'name': 'permissions', 'range': [1606, 1608], 'children': [{'type': 'TypeAnnotation', 'name': 'List', 'range': [1608, 1611], 'children': [{'type': 'TypeArgument', 'name': 'APIKeyPermission', 'range': [1610, 1610]}]}]}]}, {'type': 'ReturnType', 'range': [1614, 1619], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [1616, 1619], 'children': [{'type': 'TypeArgument', 'name': 'APIKeyWithoutHash', 'range': [1618, 1618]}]}]}, {'type': 'Docstring', 'range': [1622, 1624], 'children': [{'type': 'Literal', 'value': 'Update the permissions of an API key.', 'range': [1623, 1623]}]}, {'type': 'TryStatement', 'range': [1626, 1790], 'children': [{'type': 'Block', 'range': [1628, 1735], 'children': [{'type': 'AssignmentExpression', 'range': [1629, 1647], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1629, 1629]}, {'type': 'AwaitExpression', 'range': [1631, 1631]}, {'type': 'CallExpression', 'name': 'find_unique', 'range': [1638, 1647], 'children': [{'type': 'Argument', 'name': 'where', 'range': [1640, 1646], 'children': [{'type': 'Dict', 'range': [1642, 1646], 'children': [{'type': 'KeyValuePair', 'range': [1643, 1645], 'children': [{'type': 'Literal', 'value': 'id', 'range': [1643, 1643]}, {'type': 'Identifier', 'name': 'key_id', 'range': [1645, 1645]}]}]}]}]}]}, {'type': 'IfStatement', 'range': [1650, 1661], 'children': [{'type': 'Condition', 'range': [1651, 1653], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1651, 1651]}, {'type': 'BinaryExpression', 'operator': 'Is', 'range': [1652, 1652]}, {'type': 'Literal', 'value': 'None', 'range': [1653, 1653]}]}, {'type': 'RaiseStatement', 'range': [1656, 1660], 'children': [{'type': 'CallExpression', 'name': 'APIKeyNotFoundError', 'range': [1657, 1660], 'children': [{'type': 'Argument', 'range': [1659, 1659], 'children': [{'type': 'Literal', 'value': 'No such API key found.', 'range': [1659, 1659]}]}]}]}]}, {'type': 'IfStatement', 'range': [1663, 1678], 'children': [{'type': 'Condition', 'range': [1664, 1669], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1664, 1664]}, {'type': 'MemberExpression', 'name': 'userId', 'range': [1666, 1666]}, {'type': 'BinaryExpression', 'operator': 'NotEqual', 'range': [1667, 1668]}, {'type': 'Identifier', 'name': 'user_id', 'range': [1669, 1669]}]}, {'type': 'RaiseStatement', 'range': [1672, 1678], 'children': [{'type': 'CallExpression', 'name': 'APIKeyPermissionError', 'range': [1673, 1678], 'children': [{'type': 'Argument', 'range': [1676, 1676], 'children': [{'type': 'Literal', 'value': 'You do not have permission to update this API key.', 'range': [1676, 1676]}]}]}]}]}, {'type': 'AssignmentExpression', 'range': [1681, 1689], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1681, 1681]}, {'type': 'TypeAnnotation', 'name': 'APIKeyWhereUniqueInput', 'range': [1683, 1683]}, {'type': 'Dict', 'range': [1685, 1689], 'children': [{'type': 'KeyValuePair', 'range': [1686, 1688], 'children': [{'type': 'Literal', 'value': 'id', 'range': [1686, 1686]}, {'type': 'Identifier', 'name': 'key_id', 'range': [1688, 1688]}]}]}]}, {'type': 'AssignmentExpression', 'range': [1691, 1718], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1691, 1691]}, {'type': 'AwaitExpression', 'range': [1693, 1693]}, {'type': 'CallExpression', 'name': 'update', 'range': [1700, 1718], 'children': [{'type': 'Argument', 'name': 'where', 'range': [1703, 1705], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1705, 1705]}]}, {'type': 'Argument', 'name': 'data', 'range': [1708, 1715], 'children': [{'type': 'CallExpression', 'name': 'APIKeyUpdateInput', 'range': [1710, 1715], 'children': [{'type': 'Argument', 'name': 'permissions', 'range': [1712, 1714], 'children': [{'type': 'Identifier', 'name': 'permissions', 'range': [1714, 1714]}]}]}]}]}]}, {'type': 'IfStatement', 'range': [1721, 1732], 'children': [{'type': 'Condition', 'range': [1722, 1723], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1722, 1722]}]}, {'type': 'ReturnStatement', 'range': [1725, 1731], 'children': [{'type': 'CallExpression', 'name': 'from_db', 'range': [1728, 1731], 'children': [{'type': 'Argument', 'range': [1730, 1730], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1730, 1730]}]}]}]}]}, {'type': 'ReturnStatement', 'range': [1733, 1734], 'children': [{'type': 'Literal', 'value': 'None', 'range': [1734, 1734]}]}]}, {'type': 'CatchClause', 'range': [1736, 1748], 'children': [{'type': 'Exception', 'range': [1738, 1741], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1738, 1738]}, {'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1740, 1740]}]}, {'type': 'RaiseStatement', 'range': [1746, 1747], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [1747, 1747]}]}]}, {'type': 'CatchClause', 'range': [1749, 1769], 'children': [{'type': 'Exception', 'range': [1750, 1750], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1750, 1750]}]}, {'type': 'CallExpression', 'name': 'error', 'range': [1757, 1761], 'children': [{'type': 'Argument', 'range': [1759, 1760], 'children': [{'type': 'Literal', 'value': 'Database error while updating API key permissions: {str(e)}', 'range': [1760, 1760]}]}]}, {'type': 'RaiseStatement', 'range': [1763, 1768], 'children': [{'type': 'CallExpression', 'name': 'APIKeyError', 'range': [1764, 1768], 'children': [{'type': 'Argument', 'range': [1766, 1767], 'children': [{'type': 'Literal', 'value': 'Failed to update API key permissions: {str(e)}', 'range': [1767, 1767]}]}]}]}]}, {'type': 'CatchClause', 'range': [1770, 1790], 'children': [{'type': 'Exception', 'range': [1771, 1771], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1771, 1771]}]}, {'type': 'CallExpression', 'name': 'error', 'range': [1778, 1782], 'children': [{'type': 'Argument', 'range': [1780, 1781], 'children': [{'type': 'Literal', 'value': 'Unexpected error while updating API key permissions: {str(e)}', 'range': [1781, 1781]}]}]}, {'type': 'RaiseStatement', 'range': [1784, 1789], 'children': [{'type': 'CallExpression', 'name': 'APIKeyError', 'range': [1785, 1789], 'children': [{'type': 'Argument', 'range': [1787, 1788], 'children': [{'type': 'Literal', 'value': 'Failed to update API key permissions: {str(e)}', 'range': [1788, 1788]}]}]}]}]}]}]}
2025-01-08 09:30:20,164 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:31:48,067 - INFO - Step 5 result: {'type': 'Program', 'name': 'APIKey', 'range': [157, 369], 'children': [{'type': 'ClassDecl', 'name': 'APIKey', 'range': [157, 216], 'children': [{'type': 'PropertyDecl', 'name': 'name', 'range': [164, 166], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [166], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'prefix', 'range': [168, 170], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [170], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'key', 'range': [172, 174], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [174], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'status', 'range': [176, 183], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyStatus', 'range': [178], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [179, 183], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [180], 'children': []}, {'type': 'MemberExpression', 'name': '.', 'range': [181, 182], 'children': [{'type': 'Identifier', 'name': 'ACTIVE', 'range': [182], 'children': []}]}]}]}, {'type': 'PropertyDecl', 'name': 'permissions', 'range': [184, 190], 'children': [{'type': 'TypeAnnotation', 'name': 'List', 'range': [186], 'children': [{'type': 'TypeArgument', 'name': 'APIKeyPermission', 'range': [188], 'children': []}]}]}, {'type': 'PropertyDecl', 'name': 'postfix', 'range': [191, 193], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [193], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'created_at', 'range': [195, 197], 'children': [{'type': 'TypeAnnotation', 'name': 'datetime', 'range': [197], 'children': []}]}, {'type': 'PropertyDecl', 'name': 'last_used_at', 'range': [199, 206], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [201], 'children': [{'type': 'TypeArgument', 'name': 'datetime', 'range': [203], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [205, 206], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [206], 'children': []}]}]}, {'type': 'PropertyDecl', 'name': 'revoked_at', 'range': [208, 215], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [210], 'children': [{'type': 'TypeArgument', 'name': 'datetime', 'range': [212], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [214, 215], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [215], 'children': []}]}]}, {'type': 'PropertyDecl', 'name': 'description', 'range': [217, 224], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [219], 'children': [{'type': 'TypeArgument', 'name': 'str', 'range': [221], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [223, 224], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [224], 'children': []}]}]}, {'type': 'PropertyDecl', 'name': 'user_id', 'range': [226, 228], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [228], 'children': []}]}]}, {'type': 'FunctionDecl', 'name': 'from_db', 'range': [231, 368], 'children': [{'type': 'Parameter', 'name': 'api_key', 'range': [237, 239], 'children': [{'type': 'TypeAnnotation', 'name': 'PrismaAPIKey', 'range': [239], 'children': []}]}, {'type': 'BlockStatement', 'name': '', 'range': [242, 368], 'children': [{'type': 'TryStatement', 'name': '', 'range': [243, 368], 'children': [{'type': 'BlockStatement', 'name': '', 'range': [245, 347], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [246, 347], 'children': [{'type': 'NewExpression', 'name': 'APIKey', 'range': [247, 346], 'children': [{'type': 'Argument', 'name': 'id', 'range': [250, 255], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [251, 255], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [253, 254], 'children': [{'type': 'Identifier', 'name': 'id', 'range': [254], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'name', 'range': [257, 262], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [258, 262], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [260, 261], 'children': [{'type': 'Identifier', 'name': 'name', 'range': [261], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'prefix', 'range': [264, 269], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [265, 269], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [267, 268], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [268], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'postfix', 'range': [271, 276], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [272, 276], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [274, 275], 'children': [{'type': 'Identifier', 'name': 'postfix', 'range': [275], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'key', 'range': [278, 283], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [279, 283], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [281, 282], 'children': [{'type': 'Identifier', 'name': 'key', 'range': [282], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'status', 'range': [285, 293], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [286, 293], 'children': [{'type': 'NewExpression', 'name': 'APIKeyStatus', 'range': [287, 292], 'children': [{'type': 'Argument', 'name': '', 'range': [289, 292], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [290, 291], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [291], 'children': []}]}]}]}]}]}, {'type': 'Argument', 'name': 'permissions', 'range': [295, 309], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [296, 309], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [297, 308], 'children': [{'type': 'NewExpression', 'name': 'APIKeyPermission', 'range': [298, 301], 'children': [{'type': 'Argument', 'name': 'p', 'range': [300], 'children': []}]}, {'type': 'ForStatement', 'name': '', 'range': [302, 308], 'children': [{'type': 'VariableDeclaration', 'name': 'p', 'range': [303], 'children': []}, {'type': 'InExpression', 'name': 'in', 'range': [304, 307], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [306, 307], 'children': [{'type': 'Identifier', 'name': 'permissions', 'range': [307], 'children': []}]}]}]}]}]}]}, {'type': 'Argument', 'name': 'created_at', 'range': [311, 316], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [312, 316], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [314, 315], 'children': [{'type': 'Identifier', 'name': 'createdAt', 'range': [315], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'last_used_at', 'range': [318, 323], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [319, 323], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [321, 322], 'children': [{'type': 'Identifier', 'name': 'lastUsedAt', 'range': [322], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'revoked_at', 'range': [325, 330], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [326, 330], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [328, 329], 'children': [{'type': 'Identifier', 'name': 'revokedAt', 'range': [329], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'description', 'range': [332, 337], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [333, 337], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [335, 336], 'children': [{'type': 'Identifier', 'name': 'description', 'range': [336], 'children': []}]}]}]}, {'type': 'Argument', 'name': 'user_id', 'range': [339, 344], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [340, 344], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [342, 343], 'children': [{'type': 'Identifier', 'name': 'userId', 'range': [343], 'children': []}]}]}]}]}]}]}, {'type': 'CatchClause', 'name': '', 'range': [348, 368], 'children': [{'type': 'Parameter', 'name': 'e', 'range': [351], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [353, 368], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [354, 361], 'children': [{'type': 'CallExpression', 'name': '', 'range': [355, 360], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [355, 356], 'children': [{'type': 'Identifier', 'name': 'error', 'range': [356], 'children': []}]}, {'type': 'Argument', 'name': '', 'range': [358, 360], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [359], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': '', 'range': [362, 368], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [363, 367], 'children': [{'type': 'Argument', 'name': '', 'range': [365, 367], 'children': [{'type': 'TemplateLiteral', 'name': '', 'range': [366], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 09:31:48,068 - INFO - Completed main AST analysis flow
2025-01-08 09:31:48,068 - INFO - Successfully processed chunk
2025-01-08 09:31:57,272 - INFO - Step 4 result: {'type': 'Program', 'name': 'revoke_api_key', 'range': [940, 1139], 'children': [{'type': 'FunctionDecl', 'name': 'revoke_api_key', 'range': [940, 1139], 'children': [{'type': 'FunctionSignature', 'name': 'revoke_api_key', 'range': [940, 958], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [940, 944], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [941, 944], 'children': []}, {'type': 'Identifier', 'name': 'revoke_api_key', 'range': [942, 955], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [943, 951], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [944, 947], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [944, 947], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [945, 947], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [948, 951], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [948, 951], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [949, 951], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [952, 958], 'children': [{'type': 'Keyword', 'name': '->', 'range': [952, 954], 'children': []}, {'type': 'Type', 'name': 'Optional', 'range': [954, 958], 'children': []}, {'type': 'Type', 'name': 'APIKeyWithoutHash', 'range': [955, 958], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [959, 1139], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [960, 1139], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [962, 1084], 'children': [{'type': 'VariableDecl', 'name': 'api_key', 'range': [963, 981], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [963, 970], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [964, 965], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [965, 981], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().find_unique', 'range': [966, 981], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [966, 973], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [966, 973], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [967, 973], 'children': []}]}, {'type': 'CallExpression', 'name': 'find_unique', 'range': [972, 981], 'children': [{'type': 'Identifier', 'name': 'find_unique', 'range': [972, 981], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [973, 981], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [974, 980], 'children': [{'type': 'Property', 'name': 'id', 'range': [977, 980], 'children': [{'type': 'Literal', 'name': '"id"', 'range': [977, 980], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [978, 980], 'children': []}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [984, 995], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [985, 987], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [985, 987], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [986, 987], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [988, 995], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [989, 995], 'children': [{'type': 'NewExpression', 'name': 'APIKeyNotFoundError', 'range': [990, 995], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [990, 995], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [991, 995], 'children': [{'type': 'TemplateLiteral', 'name': 'f"API key with id {key_id} not found"', 'range': [992, 995], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [997, 1012], 'children': [{'type': 'Condition', 'name': 'api_key.userId != user_id', 'range': [998, 1004], 'children': [{'type': 'MemberExpression', 'name': 'api_key.userId', 'range': [998, 1001], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [998, 1001], 'children': []}, {'type': 'Identifier', 'name': 'userId', 'range': [999, 1001], 'children': []}]}, {'type': 'BinaryExpression', 'name': '!=', 'range': [1001, 1004], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1003, 1004], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1005, 1012], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1006, 1012], 'children': [{'type': 'NewExpression', 'name': 'APIKeyPermissionError', 'range': [1007, 1012], 'children': [{'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1007, 1012], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1008, 1012], 'children': [{'type': 'Literal', 'name': '"You do not have permission to revoke this API key."', 'range': [1010, 1012], 'children': []}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'where_clause', 'range': [1015, 1024], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1015, 1024], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1016, 1017], 'children': []}, {'type': 'ObjectExpression', 'name': 'APIKeyWhereUniqueInput', 'range': [1018, 1024], 'children': [{'type': 'Property', 'name': 'id', 'range': [1020, 1023], 'children': [{'type': 'Literal', 'name': '"id"', 'range': [1020, 1023], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1021, 1023], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'updated_api_key', 'range': [1025, 1068], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1025, 1038], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1026, 1027], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1027, 1068], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().update', 'range': [1028, 1068], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [1028, 1035], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1028, 1035], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [1029, 1035], 'children': []}]}, {'type': 'CallExpression', 'name': 'update', 'range': [1034, 1068], 'children': [{'type': 'Identifier', 'name': 'update', 'range': [1034, 1068], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1035, 1068], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [1037, 1040], 'children': [{'type': 'Property', 'name': 'where', 'range': [1037, 1040], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1038, 1040], 'children': []}]}]}, {'type': 'ObjectExpression', 'name': 'data', 'range': [1042, 1065], 'children': [{'type': 'Property', 'name': 'data', 'range': [1042, 1065], 'children': [{'type': 'NewExpression', 'name': 'APIKeyUpdateInput', 'range': [1044, 1065], 'children': [{'type': 'Identifier', 'name': 'APIKeyUpdateInput', 'range': [1044, 1065], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1045, 1065], 'children': [{'type': 'Property', 'name': 'status', 'range': [1047, 1052], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [1047, 1052], 'children': []}, {'type': 'MemberExpression', 'name': 'APIKeyStatus.REVOKED', 'range': [1049, 1052], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [1049, 1052], 'children': []}, {'type': 'Identifier', 'name': 'REVOKED', 'range': [1050, 1052], 'children': []}]}]}, {'type': 'Property', 'name': 'revokedAt', 'range': [1053, 1063], 'children': [{'type': 'Identifier', 'name': 'revokedAt', 'range': [1053, 1063], 'children': []}, {'type': 'CallExpression', 'name': 'datetime.now', 'range': [1055, 1063], 'children': [{'type': 'MemberExpression', 'name': 'datetime.now', 'range': [1055, 1063], 'children': [{'type': 'Identifier', 'name': 'datetime', 'range': [1055, 1063], 'children': []}, {'type': 'Identifier', 'name': 'now', 'range': [1056, 1063], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1058, 1063], 'children': [{'type': 'MemberExpression', 'name': 'timezone.utc', 'range': [1059, 1063], 'children': [{'type': 'Identifier', 'name': 'timezone', 'range': [1059, 1063], 'children': []}, {'type': 'Identifier', 'name': 'utc', 'range': [1060, 1063], 'children': []}]}]}]}]}]}]}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1070, 1081], 'children': [{'type': 'Condition', 'name': 'updated_api_key', 'range': [1071, 1072], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1071, 1072], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1073, 1081], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1074, 1081], 'children': [{'type': 'CallExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1075, 1081], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1075, 1081], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1075, 1081], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [1076, 1081], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1078, 1081], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1079, 1081], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1082, 1084], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1083, 1084], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1085, 1097], 'children': [{'type': 'Block', 'name': 'body', 'range': [1094, 1097], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1095, 1097], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [1096, 1097], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1098, 1118], 'children': [{'type': 'Block', 'name': 'body', 'range': [1103, 1118], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1104, 1111], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1105, 1111], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1107, 1111], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Database error while revoking API key: {str(e)}"', 'range': [1108, 1111], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1112, 1118], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1113, 1118], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1113, 1118], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1114, 1118], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to revoke API key: {str(e)}"', 'range': [1115, 1118], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1119, 1139], 'children': [{'type': 'Block', 'name': 'body', 'range': [1124, 1139], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1125, 1132], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1126, 1132], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1128, 1132], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Unexpected error while revoking API key: {str(e)}"', 'range': [1129, 1132], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1133, 1139], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1134, 1139], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1134, 1139], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1135, 1139], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to revoke API key: {str(e)}"', 'range': [1136, 1139], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 09:31:57,272 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:32:02,914 - INFO - Step 4 result: {'type': 'Program', 'name': 'validate_api_key', 'range': [770, 939], 'children': [{'type': 'FunctionDecl', 'name': 'validate_api_key', 'range': [770, 939], 'children': [{'type': 'FunctionSignature', 'name': 'validate_api_key', 'range': [770, 784], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [770, 774], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [771, 774], 'children': []}, {'type': 'Identifier', 'name': 'validate_api_key', 'range': [772, 787], 'children': []}, {'type': 'Parameter', 'name': 'plain_text_key', 'range': [774, 777], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [774, 787], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [776, 779], 'children': []}]}, {'type': 'ReturnType', 'name': 'Optional[APIKey]', 'range': [780, 784], 'children': [{'type': 'Keyword', 'name': 'Optional', 'range': [780, 787], 'children': []}, {'type': 'Type', 'name': 'APIKey', 'range': [782, 787], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'validate_api_key', 'range': [785, 939], 'children': [{'type': 'Docstring', 'name': 'Validate an API key and return the API key object if valid.', 'range': [786, 788], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [790, 939], 'children': [{'type': 'TryBlock', 'name': 'try', 'range': [790, 919], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [793, 814], 'children': [{'type': 'Condition', 'name': 'not plain_text_key.startswith(APIKeyManager.PREFIX)', 'range': [794, 803], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [794, 797], 'children': []}, {'type': 'MemberExpression', 'name': 'plain_text_key.startswith', 'range': [795, 802], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [795, 808], 'children': []}, {'type': 'Identifier', 'name': 'startswith', 'range': [797, 807], 'children': []}]}, {'type': 'CallExpression', 'name': 'startswith(APIKeyManager.PREFIX)', 'range': [798, 802], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyManager.PREFIX', 'range': [799, 801], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [799, 812], 'children': []}, {'type': 'Identifier', 'name': 'PREFIX', 'range': [801, 807], 'children': []}]}]}]}, {'type': 'Block', 'name': 'if', 'range': [804, 814], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning("Invalid API key format")', 'range': [805, 811], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [805, 810], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [805, 811], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [807, 814], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning("Invalid API key format")', 'range': [808, 810], 'children': [{'type': 'StringLiteral', 'name': '"Invalid API key format"', 'range': [809, 810], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [812, 814], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [812, 818], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [813, 817], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'prefix = plain_text_key[:APIKeyManager.PREFIX_LENGTH]', 'range': [816, 825], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [816, 822], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [817, 818], 'children': []}, {'type': 'MemberExpression', 'name': 'plain_text_key[:APIKeyManager.PREFIX_LENGTH]', 'range': [818, 824], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [818, 831], 'children': []}, {'type': 'SliceExpression', 'name': '[:APIKeyManager.PREFIX_LENGTH]', 'range': [819, 824], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyManager.PREFIX_LENGTH', 'range': [821, 823], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [821, 834], 'children': []}, {'type': 'Identifier', 'name': 'PREFIX_LENGTH', 'range': [823, 836], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'api_manager = APIKeyManager()', 'range': [826, 831], 'children': [{'type': 'Identifier', 'name': 'api_manager', 'range': [826, 837], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [827, 828], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyManager()', 'range': [828, 830], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [828, 841], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'api_key = await PrismaAPIKey.prisma().find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [833, 862], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [833, 840], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [834, 835], 'children': []}, {'type': 'AwaitExpression', 'name': 'await PrismaAPIKey.prisma().find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [835, 862], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma()', 'range': [836, 839], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [836, 838], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [836, 849], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [838, 844], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [842, 862], 'children': [{'type': 'Identifier', 'name': 'find_first', 'range': [842, 851], 'children': []}, {'type': 'Argument', 'name': 'where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE))', 'range': [845, 861], 'children': [{'type': 'Identifier', 'name': 'where', 'range': [845, 850], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [846, 847], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE))', 'range': [847, 861], 'children': [{'type': 'Identifier', 'name': 'APIKeyWhereInput', 'range': [847, 862], 'children': []}, {'type': 'Argument', 'name': 'prefix=prefix', 'range': [849, 851], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [849, 854], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [850, 851], 'children': []}, {'type': 'Identifier', 'name': 'prefix', 'range': [851, 856], 'children': []}]}, {'type': 'Argument', 'name': 'status=(APIKeyStatus.ACTIVE)', 'range': [853, 860], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [853, 859], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [854, 855], 'children': []}, {'type': 'ParenthesizedExpression', 'name': '(APIKeyStatus.ACTIVE)', 'range': [855, 860], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyStatus.ACTIVE', 'range': [856, 859], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [856, 869], 'children': []}, {'type': 'Identifier', 'name': 'ACTIVE', 'range': [858, 863], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [865, 880], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [866, 868], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [866, 869], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [867, 874], 'children': []}]}, {'type': 'Block', 'name': 'if', 'range': [869, 880], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning(f"No active API key found with prefix {prefix}")', 'range': [870, 877], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [870, 876], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [870, 876], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [872, 879], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning(f"No active API key found with prefix {prefix}")', 'range': [873, 876], 'children': [{'type': 'TemplateLiteral', 'name': 'f"No active API key found with prefix {prefix}"', 'range': [874, 876], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [875, 880], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [878, 880], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [878, 884], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [879, 883], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'is_valid = api_manager.verify_api_key(plain_text_key, api_key.key)', 'range': [882, 894], 'children': [{'type': 'Identifier', 'name': 'is_valid', 'range': [882, 890], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [883, 884], 'children': []}, {'type': 'CallExpression', 'name': 'api_manager.verify_api_key(plain_text_key, api_key.key)', 'range': [884, 894], 'children': [{'type': 'MemberExpression', 'name': 'api_manager.verify_api_key', 'range': [884, 893], 'children': [{'type': 'Identifier', 'name': 'api_manager', 'range': [884, 895], 'children': []}, {'type': 'Identifier', 'name': 'verify_api_key', 'range': [886, 899], 'children': []}]}, {'type': 'Argument', 'name': 'plain_text_key', 'range': [888, 889], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [888, 901], 'children': []}]}, {'type': 'Argument', 'name': 'api_key.key', 'range': [890, 893], 'children': [{'type': 'MemberExpression', 'name': 'api_key.key', 'range': [890, 893], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [890, 897], 'children': []}, {'type': 'Identifier', 'name': 'key', 'range': [892, 895], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [895, 909], 'children': [{'type': 'Condition', 'name': 'not is_valid', 'range': [896, 898], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [896, 899], 'children': []}, {'type': 'Identifier', 'name': 'is_valid', 'range': [897, 905], 'children': []}]}, {'type': 'Block', 'name': 'if', 'range': [899, 909], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning("API key verification failed")', 'range': [900, 906], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [900, 905], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [900, 906], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [902, 908], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning("API key verification failed")', 'range': [903, 905], 'children': [{'type': 'StringLiteral', 'name': '"API key verification failed"', 'range': [904, 905], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [907, 909], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [907, 913], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [908, 912], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return APIKey.from_db(api_key)', 'range': [911, 918], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [911, 917], 'children': []}, {'type': 'CallExpression', 'name': 'APIKey.from_db(api_key)', 'range': [912, 918], 'children': [{'type': 'MemberExpression', 'name': 'APIKey.from_db', 'range': [912, 917], 'children': [{'type': 'Identifier', 'name': 'APIKey', 'range': [912, 917], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [914, 921], 'children': []}]}, {'type': 'Argument', 'name': 'api_key', 'range': [916, 917], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [916, 923], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [919, 939], 'children': [{'type': 'Parameter', 'name': 'Exception as e', 'range': [920, 923], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [920, 929], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [922, 923], 'children': []}]}, {'type': 'Block', 'name': 'except', 'range': [924, 939], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Error validating API key: {str(e)}")', 'range': [925, 932], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [925, 931], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [925, 931], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [927, 933], 'children': []}]}, {'type': 'CallExpression', 'name': 'error(f"Error validating API key: {str(e)}")', 'range': [928, 931], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Error validating API key: {str(e)}"', 'range': [929, 931], 'children': [{'type': 'CallExpression', 'name': 'str(e)', 'range': [930, 931], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [930, 933], 'children': []}, {'type': 'Argument', 'name': 'e', 'range': [931, 932], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [931, 932], 'children': []}]}]}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise APIKeyValidationError(f"Failed to validate API key: {str(e)}")', 'range': [933, 939], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [933, 938], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyValidationError(f"Failed to validate API key: {str(e)}")', 'range': [934, 939], 'children': [{'type': 'Identifier', 'name': 'APIKeyValidationError', 'range': [934, 955], 'children': []}, {'type': 'Argument', 'name': 'f"Failed to validate API key: {str(e)}"', 'range': [936, 938], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to validate API key: {str(e)}"', 'range': [937, 938], 'children': [{'type': 'CallExpression', 'name': 'str(e)', 'range': [938, 939], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [938, 941], 'children': []}, {'type': 'Argument', 'name': 'e', 'range': [939, 940], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [939, 940], 'children': []}]}]}]}]}]}]}]}]}]}]}]}]}
2025-01-08 09:32:02,914 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:32:13,531 - INFO - Step 5 result: {'type': 'Program', 'name': 'update_api_key_permissions', 'range': [1593, 1790], 'children': [{'type': 'FunctionDecl', 'name': 'update_api_key_permissions', 'range': [1593, 1790], 'children': [{'type': 'Async', 'range': [1593, 1593]}, {'type': 'Parameters', 'range': [1596, 1613], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [1598, 1600], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [1600, 1600]}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1602, 1604], 'children': [{'type': 'TypeAnnotation', 'name': 'str', 'range': [1604, 1604]}]}, {'type': 'Parameter', 'name': 'permissions', 'range': [1606, 1608], 'children': [{'type': 'TypeAnnotation', 'name': 'List', 'range': [1608, 1611], 'children': [{'type': 'TypeArgument', 'name': 'APIKeyPermission', 'range': [1610, 1610]}]}]}]}, {'type': 'ReturnType', 'range': [1614, 1619], 'children': [{'type': 'TypeAnnotation', 'name': 'Optional', 'range': [1616, 1619], 'children': [{'type': 'TypeArgument', 'name': 'APIKeyWithoutHash', 'range': [1618, 1618]}]}]}, {'type': 'Docstring', 'range': [1622, 1624], 'children': [{'type': 'Literal', 'value': 'Update the permissions of an API key.', 'range': [1623, 1623]}]}, {'type': 'TryStatement', 'range': [1626, 1790], 'children': [{'type': 'Block', 'range': [1628, 1735], 'children': [{'type': 'AssignmentExpression', 'range': [1629, 1647], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1629, 1629]}, {'type': 'AwaitExpression', 'range': [1631, 1631]}, {'type': 'CallExpression', 'name': 'find_unique', 'range': [1638, 1647], 'children': [{'type': 'Argument', 'name': 'where', 'range': [1640, 1646], 'children': [{'type': 'Dict', 'range': [1642, 1646], 'children': [{'type': 'KeyValuePair', 'range': [1643, 1645], 'children': [{'type': 'Literal', 'value': 'id', 'range': [1643, 1643]}, {'type': 'Identifier', 'name': 'key_id', 'range': [1645, 1645]}]}]}]}]}]}, {'type': 'IfStatement', 'range': [1650, 1661], 'children': [{'type': 'Condition', 'range': [1651, 1653], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1651, 1651]}, {'type': 'BinaryExpression', 'operator': 'Is', 'range': [1652, 1652]}, {'type': 'Literal', 'value': 'None', 'range': [1653, 1653]}]}, {'type': 'RaiseStatement', 'range': [1656, 1660], 'children': [{'type': 'CallExpression', 'name': 'APIKeyNotFoundError', 'range': [1657, 1660], 'children': [{'type': 'Argument', 'range': [1659, 1659], 'children': [{'type': 'Literal', 'value': 'No such API key found.', 'range': [1659, 1659]}]}]}]}]}, {'type': 'IfStatement', 'range': [1663, 1678], 'children': [{'type': 'Condition', 'range': [1664, 1669], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1664, 1664]}, {'type': 'MemberExpression', 'name': 'userId', 'range': [1666, 1666]}, {'type': 'BinaryExpression', 'operator': 'NotEqual', 'range': [1667, 1668]}, {'type': 'Identifier', 'name': 'user_id', 'range': [1669, 1669]}]}, {'type': 'RaiseStatement', 'range': [1672, 1678], 'children': [{'type': 'CallExpression', 'name': 'APIKeyPermissionError', 'range': [1673, 1678], 'children': [{'type': 'Argument', 'range': [1676, 1676], 'children': [{'type': 'Literal', 'value': 'You do not have permission to update this API key.', 'range': [1676, 1676]}]}]}]}]}, {'type': 'AssignmentExpression', 'range': [1681, 1689], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1681, 1681]}, {'type': 'TypeAnnotation', 'name': 'APIKeyWhereUniqueInput', 'range': [1683, 1683]}, {'type': 'Dict', 'range': [1685, 1689], 'children': [{'type': 'KeyValuePair', 'range': [1686, 1688], 'children': [{'type': 'Literal', 'value': 'id', 'range': [1686, 1686]}, {'type': 'Identifier', 'name': 'key_id', 'range': [1688, 1688]}]}]}]}, {'type': 'AssignmentExpression', 'range': [1691, 1718], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1691, 1691]}, {'type': 'AwaitExpression', 'range': [1693, 1693]}, {'type': 'CallExpression', 'name': 'update', 'range': [1700, 1718], 'children': [{'type': 'Argument', 'name': 'where', 'range': [1703, 1705], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1705, 1705]}]}, {'type': 'Argument', 'name': 'data', 'range': [1708, 1715], 'children': [{'type': 'CallExpression', 'name': 'APIKeyUpdateInput', 'range': [1710, 1715], 'children': [{'type': 'Argument', 'name': 'permissions', 'range': [1712, 1714], 'children': [{'type': 'Identifier', 'name': 'permissions', 'range': [1714, 1714]}]}]}]}]}]}, {'type': 'IfStatement', 'range': [1721, 1732], 'children': [{'type': 'Condition', 'range': [1722, 1723], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1722, 1722]}]}, {'type': 'ReturnStatement', 'range': [1725, 1731], 'children': [{'type': 'CallExpression', 'name': 'from_db', 'range': [1728, 1731], 'children': [{'type': 'Argument', 'range': [1730, 1730], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1730, 1730]}]}]}]}]}, {'type': 'ReturnStatement', 'range': [1733, 1734], 'children': [{'type': 'Literal', 'value': 'None', 'range': [1734, 1734]}]}]}, {'type': 'CatchClause', 'range': [1736, 1748], 'children': [{'type': 'Exception', 'range': [1738, 1741], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1738, 1738]}, {'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1740, 1740]}]}, {'type': 'RaiseStatement', 'range': [1746, 1747], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [1747, 1747]}]}]}, {'type': 'CatchClause', 'range': [1749, 1769], 'children': [{'type': 'Exception', 'range': [1750, 1750], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1750, 1750]}]}, {'type': 'CallExpression', 'name': 'error', 'range': [1757, 1761], 'children': [{'type': 'Argument', 'range': [1759, 1760], 'children': [{'type': 'Literal', 'value': 'Database error while updating API key permissions: {str(e)}', 'range': [1760, 1760]}]}]}, {'type': 'RaiseStatement', 'range': [1763, 1768], 'children': [{'type': 'CallExpression', 'name': 'APIKeyError', 'range': [1764, 1768], 'children': [{'type': 'Argument', 'range': [1766, 1767], 'children': [{'type': 'Literal', 'value': 'Failed to update API key permissions: {str(e)}', 'range': [1767, 1767]}]}]}]}]}, {'type': 'CatchClause', 'range': [1770, 1790], 'children': [{'type': 'Exception', 'range': [1771, 1771], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1771, 1771]}]}, {'type': 'CallExpression', 'name': 'error', 'range': [1778, 1782], 'children': [{'type': 'Argument', 'range': [1780, 1781], 'children': [{'type': 'Literal', 'value': 'Unexpected error while updating API key permissions: {str(e)}', 'range': [1781, 1781]}]}]}, {'type': 'RaiseStatement', 'range': [1784, 1789], 'children': [{'type': 'CallExpression', 'name': 'APIKeyError', 'range': [1785, 1789], 'children': [{'type': 'Argument', 'range': [1787, 1788], 'children': [{'type': 'Literal', 'value': 'Failed to update API key permissions: {str(e)}', 'range': [1788, 1788]}]}]}]}]}]}]}]}
2025-01-08 09:32:13,532 - INFO - Completed main AST analysis flow
2025-01-08 09:32:13,534 - INFO - Successfully processed chunk
2025-01-08 09:32:14,138 - INFO - Step 5 result: {'type': 'Program', 'name': 'suspend_api_key', 'range': [1253, 1439], 'children': [{'type': 'FunctionDecl', 'name': 'suspend_api_key', 'range': [1253, 1439], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [1253, 1253], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [1254, 1254], 'children': []}, {'type': 'Identifier', 'name': 'suspend_api_key', 'range': [1255, 1255], 'children': []}, {'type': 'Parameter', 'name': 'key_id', 'range': [1257, 1259], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [1257, 1257], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1259, 1259], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [1261, 1263], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [1261, 1261], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [1263, 1263], 'children': []}]}, {'type': 'TypeAnnotation', 'name': 'Optional', 'range': [1267, 1270], 'children': [{'type': 'TypeAnnotation', 'name': 'APIKeyWithoutHash', 'range': [1269, 1269], 'children': []}]}, {'type': 'Block', 'name': 'try', 'range': [1273, 1439], 'children': [{'type': 'Keyword', 'name': 'try', 'range': [1273, 1273], 'children': []}, {'type': 'Statement', 'name': 'api_key', 'range': [1276, 1294], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [1276, 1276], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1278, 1278], 'children': []}, {'type': 'CallExpression', 'name': 'PrismaAPIKey', 'range': [1279, 1279], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [1281, 1281], 'children': []}, {'type': 'Identifier', 'name': 'find_unique', 'range': [1285, 1285], 'children': []}, {'type': 'Argument', 'name': 'where', 'range': [1287, 1293], 'children': [{'type': 'Literal', 'name': '"id"', 'range': [1290, 1290], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1292, 1292], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1297, 1308], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1297, 1297], 'children': []}, {'type': 'Keyword', 'name': 'not', 'range': [1298, 1298], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [1299, 1299], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1302, 1307], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1303, 1303], 'children': []}, {'type': 'Literal', 'name': 'f"API key with id {key_id} not found"', 'range': [1305, 1306], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1310, 1326], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1310, 1310], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [1311, 1311], 'children': []}, {'type': 'Identifier', 'name': 'userId', 'range': [1313, 1313], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1316, 1316], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1319, 1325], 'children': [{'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1320, 1320], 'children': []}, {'type': 'Literal', 'name': '"You do not have permission to suspend this API key."', 'range': [1322, 1323], 'children': []}]}]}, {'type': 'Statement', 'name': 'where_clause', 'range': [1328, 1337], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1328, 1328], 'children': []}, {'type': 'TypeAnnotation', 'name': 'APIKeyWhereUniqueInput', 'range': [1330, 1330], 'children': []}, {'type': 'Literal', 'name': '"id"', 'range': [1333, 1333], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1335, 1335], 'children': []}]}, {'type': 'Statement', 'name': 'updated_api_key', 'range': [1338, 1368], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1338, 1338], 'children': []}, {'type': 'Keyword', 'name': 'await', 'range': [1340, 1340], 'children': []}, {'type': 'CallExpression', 'name': 'PrismaAPIKey', 'range': [1341, 1341], 'children': [{'type': 'Identifier', 'name': 'prisma', 'range': [1343, 1343], 'children': []}, {'type': 'Identifier', 'name': 'update', 'range': [1347, 1347], 'children': []}, {'type': 'Argument', 'name': 'where', 'range': [1350, 1352], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1352, 1352], 'children': []}]}, {'type': 'Argument', 'name': 'data', 'range': [1355, 1364], 'children': [{'type': 'Identifier', 'name': 'APIKeyUpdateInput', 'range': [1357, 1357], 'children': []}, {'type': 'Identifier', 'name': 'status', 'range': [1359, 1359], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [1361, 1361], 'children': []}, {'type': 'Identifier', 'name': 'SUSPENDED', 'range': [1363, 1363], 'children': []}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1370, 1381], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [1370, 1370], 'children': []}, {'type': 'Identifier', 'name': 'updated_api_key', 'range': [1371, 1371], 'children': []}, {'type': 'Statement', 'name': 'return', 'range': [1374, 1380], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1375, 1375], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [1377, 1377], 'children': []}, {'type': 'Identifier', 'name': 'updated_api_key', 'range': [1379, 1379], 'children': []}]}]}, {'type': 'Statement', 'name': 'return', 'range': [1382, 1383], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1383, 1383], 'children': []}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1385, 1397], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [1387, 1387], 'children': []}, {'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1389, 1389], 'children': []}, {'type': 'Statement', 'name': 'raise', 'range': [1395, 1396], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [1396, 1396], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1398, 1418], 'children': [{'type': 'Identifier', 'name': 'PrismaError', 'range': [1399, 1399], 'children': []}, {'type': 'Statement', 'name': 'logger', 'range': [1404, 1410], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1404, 1404], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1406, 1406], 'children': []}, {'type': 'Literal', 'name': 'f"Database error while suspending API key: {str(e)}"', 'range': [1408, 1409], 'children': []}]}, {'type': 'Statement', 'name': 'raise', 'range': [1412, 1417], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1413, 1413], 'children': []}, {'type': 'Literal', 'name': 'f"Failed to suspend API key: {str(e)}"', 'range': [1415, 1416], 'children': []}]}]}, {'type': 'ExceptClause', 'name': 'except', 'range': [1419, 1439], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [1420, 1420], 'children': []}, {'type': 'Statement', 'name': 'logger', 'range': [1425, 1431], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1425, 1425], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1427, 1427], 'children': []}, {'type': 'Literal', 'name': 'f"Unexpected error while suspending API key: {str(e)}"', 'range': [1429, 1430], 'children': []}]}, {'type': 'Statement', 'name': 'raise', 'range': [1433, 1438], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1434, 1434], 'children': []}, {'type': 'Literal', 'name': 'f"Failed to suspend API key: {str(e)}"', 'range': [1436, 1437], 'children': []}]}]}]}]}]}
2025-01-08 09:32:14,138 - INFO - Completed main AST analysis flow
2025-01-08 09:32:14,140 - INFO - Successfully processed chunk
2025-01-08 09:35:30,944 - INFO - Step 5 result: {'type': 'Program', 'name': 'revoke_api_key', 'range': [940, 1139], 'children': [{'type': 'FunctionDecl', 'name': 'revoke_api_key', 'range': [940, 1139], 'children': [{'type': 'FunctionSignature', 'name': 'revoke_api_key', 'range': [940, 958], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [940, 944], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [941, 944], 'children': []}, {'type': 'Identifier', 'name': 'revoke_api_key', 'range': [942, 955], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [943, 951], 'children': [{'type': 'Parameter', 'name': 'key_id', 'range': [944, 947], 'children': [{'type': 'Identifier', 'name': 'key_id', 'range': [944, 947], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [945, 947], 'children': []}]}, {'type': 'Parameter', 'name': 'user_id', 'range': [948, 951], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [948, 951], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [949, 951], 'children': []}]}]}, {'type': 'ReturnType', 'name': 'Optional[APIKeyWithoutHash]', 'range': [952, 958], 'children': [{'type': 'Keyword', 'name': '->', 'range': [952, 954], 'children': []}, {'type': 'Type', 'name': 'Optional', 'range': [954, 958], 'children': []}, {'type': 'Type', 'name': 'APIKeyWithoutHash', 'range': [955, 958], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [959, 1139], 'children': [{'type': 'TryStatement', 'name': 'try', 'range': [960, 1139], 'children': [{'type': 'Block', 'name': 'tryBlock', 'range': [962, 1084], 'children': [{'type': 'VariableDecl', 'name': 'api_key', 'range': [963, 981], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [963, 970], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [964, 965], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [965, 981], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().find_unique', 'range': [966, 981], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [966, 973], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [966, 973], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [967, 973], 'children': []}]}, {'type': 'CallExpression', 'name': 'find_unique', 'range': [972, 981], 'children': [{'type': 'Identifier', 'name': 'find_unique', 'range': [972, 981], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [973, 981], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [974, 980], 'children': [{'type': 'Property', 'name': 'id', 'range': [977, 980], 'children': [{'type': 'Literal', 'name': '"id"', 'range': [977, 980], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [978, 980], 'children': []}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [984, 995], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [985, 987], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [985, 987], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [986, 987], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [988, 995], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [989, 995], 'children': [{'type': 'NewExpression', 'name': 'APIKeyNotFoundError', 'range': [990, 995], 'children': [{'type': 'Identifier', 'name': 'APIKeyNotFoundError', 'range': [990, 995], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [991, 995], 'children': [{'type': 'TemplateLiteral', 'name': 'f"API key with id {key_id} not found"', 'range': [992, 995], 'children': []}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [997, 1012], 'children': [{'type': 'Condition', 'name': 'api_key.userId != user_id', 'range': [998, 1004], 'children': [{'type': 'MemberExpression', 'name': 'api_key.userId', 'range': [998, 1001], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [998, 1001], 'children': []}, {'type': 'Identifier', 'name': 'userId', 'range': [999, 1001], 'children': []}]}, {'type': 'BinaryExpression', 'name': '!=', 'range': [1001, 1004], 'children': []}, {'type': 'Identifier', 'name': 'user_id', 'range': [1003, 1004], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1005, 1012], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1006, 1012], 'children': [{'type': 'NewExpression', 'name': 'APIKeyPermissionError', 'range': [1007, 1012], 'children': [{'type': 'Identifier', 'name': 'APIKeyPermissionError', 'range': [1007, 1012], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1008, 1012], 'children': [{'type': 'Literal', 'name': '"You do not have permission to revoke this API key."', 'range': [1010, 1012], 'children': []}]}]}]}]}]}, {'type': 'VariableDecl', 'name': 'where_clause', 'range': [1015, 1024], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1015, 1024], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1016, 1017], 'children': []}, {'type': 'ObjectExpression', 'name': 'APIKeyWhereUniqueInput', 'range': [1018, 1024], 'children': [{'type': 'Property', 'name': 'id', 'range': [1020, 1023], 'children': [{'type': 'Literal', 'name': '"id"', 'range': [1020, 1023], 'children': []}, {'type': 'Identifier', 'name': 'key_id', 'range': [1021, 1023], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'updated_api_key', 'range': [1025, 1068], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1025, 1038], 'children': []}, {'type': 'Assignment', 'name': '=', 'range': [1026, 1027], 'children': []}, {'type': 'AwaitExpression', 'name': 'await', 'range': [1027, 1068], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma().update', 'range': [1028, 1068], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [1028, 1035], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [1028, 1035], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [1029, 1035], 'children': []}]}, {'type': 'CallExpression', 'name': 'update', 'range': [1034, 1068], 'children': [{'type': 'Identifier', 'name': 'update', 'range': [1034, 1068], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1035, 1068], 'children': [{'type': 'ObjectExpression', 'name': 'where', 'range': [1037, 1040], 'children': [{'type': 'Property', 'name': 'where', 'range': [1037, 1040], 'children': [{'type': 'Identifier', 'name': 'where_clause', 'range': [1038, 1040], 'children': []}]}]}, {'type': 'ObjectExpression', 'name': 'data', 'range': [1042, 1065], 'children': [{'type': 'Property', 'name': 'data', 'range': [1042, 1065], 'children': [{'type': 'NewExpression', 'name': 'APIKeyUpdateInput', 'range': [1044, 1065], 'children': [{'type': 'Identifier', 'name': 'APIKeyUpdateInput', 'range': [1044, 1065], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1045, 1065], 'children': [{'type': 'Property', 'name': 'status', 'range': [1047, 1052], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [1047, 1052], 'children': []}, {'type': 'MemberExpression', 'name': 'APIKeyStatus.REVOKED', 'range': [1049, 1052], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [1049, 1052], 'children': []}, {'type': 'Identifier', 'name': 'REVOKED', 'range': [1050, 1052], 'children': []}]}]}, {'type': 'Property', 'name': 'revokedAt', 'range': [1053, 1063], 'children': [{'type': 'Identifier', 'name': 'revokedAt', 'range': [1053, 1063], 'children': []}, {'type': 'CallExpression', 'name': 'datetime.now', 'range': [1055, 1063], 'children': [{'type': 'MemberExpression', 'name': 'datetime.now', 'range': [1055, 1063], 'children': [{'type': 'Identifier', 'name': 'datetime', 'range': [1055, 1063], 'children': []}, {'type': 'Identifier', 'name': 'now', 'range': [1056, 1063], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1058, 1063], 'children': [{'type': 'MemberExpression', 'name': 'timezone.utc', 'range': [1059, 1063], 'children': [{'type': 'Identifier', 'name': 'timezone', 'range': [1059, 1063], 'children': []}, {'type': 'Identifier', 'name': 'utc', 'range': [1060, 1063], 'children': []}]}]}]}]}]}]}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [1070, 1081], 'children': [{'type': 'Condition', 'name': 'updated_api_key', 'range': [1071, 1072], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1071, 1072], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [1073, 1081], 'children': [{'type': 'ReturnStatement', 'name': 'return', 'range': [1074, 1081], 'children': [{'type': 'CallExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1075, 1081], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyWithoutHash.from_db', 'range': [1075, 1081], 'children': [{'type': 'Identifier', 'name': 'APIKeyWithoutHash', 'range': [1075, 1081], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [1076, 1081], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1078, 1081], 'children': [{'type': 'Identifier', 'name': 'updated_api_key', 'range': [1079, 1081], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [1082, 1084], 'children': [{'type': 'Identifier', 'name': 'None', 'range': [1083, 1084], 'children': []}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1085, 1097], 'children': [{'type': 'Block', 'name': 'body', 'range': [1094, 1097], 'children': [{'type': 'ThrowStatement', 'name': 'raise', 'range': [1095, 1097], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [1096, 1097], 'children': []}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1098, 1118], 'children': [{'type': 'Block', 'name': 'body', 'range': [1103, 1118], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [1104, 1111], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1104, 1111], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1105, 1111], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1107, 1111], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Database error while revoking API key: {str(e)}"', 'range': [1108, 1111], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1112, 1118], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1113, 1118], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1113, 1118], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1114, 1118], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to revoke API key: {str(e)}"', 'range': [1115, 1118], 'children': []}]}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [1119, 1139], 'children': [{'type': 'Block', 'name': 'body', 'range': [1124, 1139], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'CallExpression', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [1125, 1132], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [1125, 1132], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [1126, 1132], 'children': []}]}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1128, 1132], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Unexpected error while revoking API key: {str(e)}"', 'range': [1129, 1132], 'children': []}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise', 'range': [1133, 1139], 'children': [{'type': 'NewExpression', 'name': 'APIKeyError', 'range': [1134, 1139], 'children': [{'type': 'Identifier', 'name': 'APIKeyError', 'range': [1134, 1139], 'children': []}, {'type': 'ArgumentList', 'name': 'arguments', 'range': [1135, 1139], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to revoke API key: {str(e)}"', 'range': [1136, 1139], 'children': []}]}]}]}]}]}]}]}]}]}
2025-01-08 09:35:30,944 - INFO - Completed main AST analysis flow
2025-01-08 09:35:30,946 - INFO - Successfully processed chunk
2025-01-08 09:35:37,625 - INFO - Step 5 result: {'type': 'Program', 'name': 'validate_api_key', 'range': [770, 939], 'children': [{'type': 'FunctionDecl', 'name': 'validate_api_key', 'range': [770, 939], 'children': [{'type': 'FunctionSignature', 'name': 'validate_api_key', 'range': [770, 784], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [770, 774], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [771, 774], 'children': []}, {'type': 'Identifier', 'name': 'validate_api_key', 'range': [772, 787], 'children': []}, {'type': 'Parameter', 'name': 'plain_text_key', 'range': [774, 777], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [774, 787], 'children': []}, {'type': 'TypeAnnotation', 'name': 'str', 'range': [776, 779], 'children': []}]}, {'type': 'ReturnType', 'name': 'Optional[APIKey]', 'range': [780, 784], 'children': [{'type': 'Keyword', 'name': 'Optional', 'range': [780, 787], 'children': []}, {'type': 'Type', 'name': 'APIKey', 'range': [782, 787], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'validate_api_key', 'range': [785, 939], 'children': [{'type': 'Docstring', 'name': 'Validate an API key and return the API key object if valid.', 'range': [786, 788], 'children': []}, {'type': 'TryStatement', 'name': 'try', 'range': [790, 939], 'children': [{'type': 'TryBlock', 'name': 'try', 'range': [790, 919], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [793, 814], 'children': [{'type': 'Condition', 'name': 'not plain_text_key.startswith(APIKeyManager.PREFIX)', 'range': [794, 803], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [794, 797], 'children': []}, {'type': 'MemberExpression', 'name': 'plain_text_key.startswith', 'range': [795, 802], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [795, 808], 'children': []}, {'type': 'Identifier', 'name': 'startswith', 'range': [797, 807], 'children': []}]}, {'type': 'CallExpression', 'name': 'startswith(APIKeyManager.PREFIX)', 'range': [798, 802], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyManager.PREFIX', 'range': [799, 801], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [799, 812], 'children': []}, {'type': 'Identifier', 'name': 'PREFIX', 'range': [801, 807], 'children': []}]}]}]}, {'type': 'Block', 'name': 'if', 'range': [804, 814], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning("Invalid API key format")', 'range': [805, 811], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [805, 810], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [805, 811], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [807, 814], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning("Invalid API key format")', 'range': [808, 810], 'children': [{'type': 'StringLiteral', 'name': '"Invalid API key format"', 'range': [809, 810], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [812, 814], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [812, 818], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [813, 817], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'prefix = plain_text_key[:APIKeyManager.PREFIX_LENGTH]', 'range': [816, 825], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [816, 822], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [817, 818], 'children': []}, {'type': 'MemberExpression', 'name': 'plain_text_key[:APIKeyManager.PREFIX_LENGTH]', 'range': [818, 824], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [818, 831], 'children': []}, {'type': 'SliceExpression', 'name': '[:APIKeyManager.PREFIX_LENGTH]', 'range': [819, 824], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyManager.PREFIX_LENGTH', 'range': [821, 823], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [821, 834], 'children': []}, {'type': 'Identifier', 'name': 'PREFIX_LENGTH', 'range': [823, 836], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'api_manager = APIKeyManager()', 'range': [826, 831], 'children': [{'type': 'Identifier', 'name': 'api_manager', 'range': [826, 837], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [827, 828], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyManager()', 'range': [828, 830], 'children': [{'type': 'Identifier', 'name': 'APIKeyManager', 'range': [828, 841], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'api_key = await PrismaAPIKey.prisma().find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [833, 862], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [833, 840], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [834, 835], 'children': []}, {'type': 'AwaitExpression', 'name': 'await PrismaAPIKey.prisma().find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [835, 862], 'children': [{'type': 'CallExpression', 'name': 'PrismaAPIKey.prisma()', 'range': [836, 839], 'children': [{'type': 'MemberExpression', 'name': 'PrismaAPIKey.prisma', 'range': [836, 838], 'children': [{'type': 'Identifier', 'name': 'PrismaAPIKey', 'range': [836, 849], 'children': []}, {'type': 'Identifier', 'name': 'prisma', 'range': [838, 844], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))', 'range': [842, 862], 'children': [{'type': 'Identifier', 'name': 'find_first', 'range': [842, 851], 'children': []}, {'type': 'Argument', 'name': 'where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE))', 'range': [845, 861], 'children': [{'type': 'Identifier', 'name': 'where', 'range': [845, 850], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [846, 847], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE))', 'range': [847, 861], 'children': [{'type': 'Identifier', 'name': 'APIKeyWhereInput', 'range': [847, 862], 'children': []}, {'type': 'Argument', 'name': 'prefix=prefix', 'range': [849, 851], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [849, 854], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [850, 851], 'children': []}, {'type': 'Identifier', 'name': 'prefix', 'range': [851, 856], 'children': []}]}, {'type': 'Argument', 'name': 'status=(APIKeyStatus.ACTIVE)', 'range': [853, 860], 'children': [{'type': 'Identifier', 'name': 'status', 'range': [853, 859], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [854, 855], 'children': []}, {'type': 'ParenthesizedExpression', 'name': '(APIKeyStatus.ACTIVE)', 'range': [855, 860], 'children': [{'type': 'MemberExpression', 'name': 'APIKeyStatus.ACTIVE', 'range': [856, 859], 'children': [{'type': 'Identifier', 'name': 'APIKeyStatus', 'range': [856, 869], 'children': []}, {'type': 'Identifier', 'name': 'ACTIVE', 'range': [858, 863], 'children': []}]}]}]}]}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [865, 880], 'children': [{'type': 'Condition', 'name': 'not api_key', 'range': [866, 868], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [866, 869], 'children': []}, {'type': 'Identifier', 'name': 'api_key', 'range': [867, 874], 'children': []}]}, {'type': 'Block', 'name': 'if', 'range': [869, 880], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning(f"No active API key found with prefix {prefix}")', 'range': [870, 877], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [870, 876], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [870, 876], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [872, 879], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning(f"No active API key found with prefix {prefix}")', 'range': [873, 876], 'children': [{'type': 'TemplateLiteral', 'name': 'f"No active API key found with prefix {prefix}"', 'range': [874, 876], 'children': [{'type': 'Identifier', 'name': 'prefix', 'range': [875, 880], 'children': []}]}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [878, 880], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [878, 884], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [879, 883], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'is_valid = api_manager.verify_api_key(plain_text_key, api_key.key)', 'range': [882, 894], 'children': [{'type': 'Identifier', 'name': 'is_valid', 'range': [882, 890], 'children': []}, {'type': 'AssignmentExpression', 'name': '=', 'range': [883, 884], 'children': []}, {'type': 'CallExpression', 'name': 'api_manager.verify_api_key(plain_text_key, api_key.key)', 'range': [884, 894], 'children': [{'type': 'MemberExpression', 'name': 'api_manager.verify_api_key', 'range': [884, 893], 'children': [{'type': 'Identifier', 'name': 'api_manager', 'range': [884, 895], 'children': []}, {'type': 'Identifier', 'name': 'verify_api_key', 'range': [886, 899], 'children': []}]}, {'type': 'Argument', 'name': 'plain_text_key', 'range': [888, 889], 'children': [{'type': 'Identifier', 'name': 'plain_text_key', 'range': [888, 901], 'children': []}]}, {'type': 'Argument', 'name': 'api_key.key', 'range': [890, 893], 'children': [{'type': 'MemberExpression', 'name': 'api_key.key', 'range': [890, 893], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [890, 897], 'children': []}, {'type': 'Identifier', 'name': 'key', 'range': [892, 895], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [895, 909], 'children': [{'type': 'Condition', 'name': 'not is_valid', 'range': [896, 898], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [896, 899], 'children': []}, {'type': 'Identifier', 'name': 'is_valid', 'range': [897, 905], 'children': []}]}, {'type': 'Block', 'name': 'if', 'range': [899, 909], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.warning("API key verification failed")', 'range': [900, 906], 'children': [{'type': 'MemberExpression', 'name': 'logger.warning', 'range': [900, 905], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [900, 906], 'children': []}, {'type': 'Identifier', 'name': 'warning', 'range': [902, 908], 'children': []}]}, {'type': 'CallExpression', 'name': 'warning("API key verification failed")', 'range': [903, 905], 'children': [{'type': 'StringLiteral', 'name': '"API key verification failed"', 'range': [904, 905], 'children': []}]}, {'type': 'ReturnStatement', 'name': 'return None', 'range': [907, 909], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [907, 913], 'children': []}, {'type': 'Identifier', 'name': 'None', 'range': [908, 912], 'children': []}]}]}]}]}, {'type': 'ReturnStatement', 'name': 'return APIKey.from_db(api_key)', 'range': [911, 918], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [911, 917], 'children': []}, {'type': 'CallExpression', 'name': 'APIKey.from_db(api_key)', 'range': [912, 918], 'children': [{'type': 'MemberExpression', 'name': 'APIKey.from_db', 'range': [912, 917], 'children': [{'type': 'Identifier', 'name': 'APIKey', 'range': [912, 917], 'children': []}, {'type': 'Identifier', 'name': 'from_db', 'range': [914, 921], 'children': []}]}, {'type': 'Argument', 'name': 'api_key', 'range': [916, 917], 'children': [{'type': 'Identifier', 'name': 'api_key', 'range': [916, 923], 'children': []}]}]}]}]}, {'type': 'CatchClause', 'name': 'except', 'range': [919, 939], 'children': [{'type': 'Parameter', 'name': 'Exception as e', 'range': [920, 923], 'children': [{'type': 'Identifier', 'name': 'Exception', 'range': [920, 929], 'children': []}, {'type': 'Identifier', 'name': 'e', 'range': [922, 923], 'children': []}]}, {'type': 'Block', 'name': 'except', 'range': [924, 939], 'children': [{'type': 'ExpressionStatement', 'name': 'logger.error(f"Error validating API key: {str(e)}")', 'range': [925, 932], 'children': [{'type': 'MemberExpression', 'name': 'logger.error', 'range': [925, 931], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [925, 931], 'children': []}, {'type': 'Identifier', 'name': 'error', 'range': [927, 933], 'children': []}]}, {'type': 'CallExpression', 'name': 'error(f"Error validating API key: {str(e)}")', 'range': [928, 931], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Error validating API key: {str(e)}"', 'range': [929, 931], 'children': [{'type': 'CallExpression', 'name': 'str(e)', 'range': [930, 931], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [930, 933], 'children': []}, {'type': 'Argument', 'name': 'e', 'range': [931, 932], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [931, 932], 'children': []}]}]}]}]}]}, {'type': 'ThrowStatement', 'name': 'raise APIKeyValidationError(f"Failed to validate API key: {str(e)}")', 'range': [933, 939], 'children': [{'type': 'Keyword', 'name': 'raise', 'range': [933, 938], 'children': []}, {'type': 'NewExpression', 'name': 'APIKeyValidationError(f"Failed to validate API key: {str(e)}")', 'range': [934, 939], 'children': [{'type': 'Identifier', 'name': 'APIKeyValidationError', 'range': [934, 955], 'children': []}, {'type': 'Argument', 'name': 'f"Failed to validate API key: {str(e)}"', 'range': [936, 938], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Failed to validate API key: {str(e)}"', 'range': [937, 938], 'children': [{'type': 'CallExpression', 'name': 'str(e)', 'range': [938, 939], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [938, 941], 'children': []}, {'type': 'Argument', 'name': 'e', 'range': [939, 940], 'children': [{'type': 'Identifier', 'name': 'e', 'range': [939, 940], 'children': []}]}]}]}]}]}]}]}]}]}]}]}]}
2025-01-08 09:35:37,625 - INFO - Completed main AST analysis flow
2025-01-08 09:35:37,627 - INFO - Successfully processed chunk
2025-01-08 09:35:37,779 - INFO - Starting code generation from AST
2025-01-08 10:05:39,663 - ERROR - Error in get_code_from_ast: Expecting value: line 30 column 1 (char 29)
2025-01-08 10:05:39,682 - INFO - Starting static code similarity comparison
2025-01-08 10:05:39,690 - INFO - Static similarity result: {'final_score': 20.31, 'length_similarity': 0.0, 'token_similarity': 0.0, 'structure_similarity': 0.0, 'function_similarity': 100, 'complexity_similarity': 3.12, 'variable_similarity': 100}
