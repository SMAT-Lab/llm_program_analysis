2025-01-08 10:27:27,647 - INFO - Processing sample 176
2025-01-08 10:27:27,648 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 10:27:36,872 - INFO - Successfully split code into 11 top-level declarations
2025-01-08 10:27:36,916 - INFO - Processing chunk #0 (size=704 chars, start_index=0)
2025-01-08 10:27:36,916 - INFO - Processing chunk with 704 chars starting at index 0
2025-01-08 10:27:36,917 - INFO - Starting main AST analysis flow
2025-01-08 10:27:36,922 - INFO - Tokenized code into 130 tokens
2025-01-08 10:27:36,979 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:36,994 - INFO - Processing chunk #1 (size=241 chars, start_index=130)
2025-01-08 10:27:37,137 - INFO - Processing chunk with 241 chars starting at index 130
2025-01-08 10:27:37,152 - INFO - Starting main AST analysis flow
2025-01-08 10:27:37,152 - INFO - Tokenized code into 49 tokens
2025-01-08 10:27:37,152 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:37,208 - INFO - Processing chunk #2 (size=162 chars, start_index=179)
2025-01-08 10:27:37,208 - INFO - Processing chunk with 162 chars starting at index 179
2025-01-08 10:27:37,208 - INFO - Starting main AST analysis flow
2025-01-08 10:27:37,245 - INFO - Tokenized code into 37 tokens
2025-01-08 10:27:37,388 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:38,221 - INFO - Processing chunk #3 (size=179 chars, start_index=216)
2025-01-08 10:27:38,221 - INFO - Processing chunk with 179 chars starting at index 216
2025-01-08 10:27:38,221 - INFO - Starting main AST analysis flow
2025-01-08 10:27:38,222 - INFO - Tokenized code into 25 tokens
2025-01-08 10:27:38,222 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:39,747 - INFO - Processing chunk #4 (size=386 chars, start_index=241)
2025-01-08 10:27:39,772 - INFO - Processing chunk with 386 chars starting at index 241
2025-01-08 10:27:39,772 - INFO - Starting main AST analysis flow
2025-01-08 10:27:39,772 - INFO - Tokenized code into 70 tokens
2025-01-08 10:27:39,772 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:39,901 - INFO - Processing chunk #5 (size=632 chars, start_index=311)
2025-01-08 10:27:39,936 - INFO - Processing chunk with 632 chars starting at index 311
2025-01-08 10:27:39,980 - INFO - Starting main AST analysis flow
2025-01-08 10:27:39,985 - INFO - Tokenized code into 126 tokens
2025-01-08 10:27:39,985 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:40,012 - INFO - Processing chunk #6 (size=781 chars, start_index=437)
2025-01-08 10:27:40,048 - INFO - Processing chunk with 781 chars starting at index 437
2025-01-08 10:27:40,048 - INFO - Starting main AST analysis flow
2025-01-08 10:27:40,048 - INFO - Tokenized code into 132 tokens
2025-01-08 10:27:40,048 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:40,167 - INFO - Processing chunk #7 (size=791 chars, start_index=569)
2025-01-08 10:27:40,572 - INFO - Processing chunk #8 (size=67 chars, start_index=701)
2025-01-08 10:27:40,702 - INFO - Processing chunk with 791 chars starting at index 569
2025-01-08 10:27:40,798 - INFO - Processing chunk with 67 chars starting at index 701
2025-01-08 10:27:41,035 - INFO - Starting main AST analysis flow
2025-01-08 10:27:41,140 - INFO - Starting main AST analysis flow
2025-01-08 10:27:41,206 - INFO - Tokenized code into 132 tokens
2025-01-08 10:27:41,216 - INFO - Tokenized code into 22 tokens
2025-01-08 10:27:41,270 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:41,336 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:41,473 - INFO - Processing chunk #9 (size=1621 chars, start_index=723)
2025-01-08 10:27:41,473 - INFO - Processing chunk with 1621 chars starting at index 723
2025-01-08 10:27:41,473 - INFO - Starting main AST analysis flow
2025-01-08 10:27:41,473 - INFO - Tokenized code into 252 tokens
2025-01-08 10:27:41,473 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:41,475 - INFO - Processing chunk #10 (size=537 chars, start_index=975)
2025-01-08 10:27:41,478 - INFO - Processing chunk with 537 chars starting at index 975
2025-01-08 10:27:41,478 - INFO - Starting main AST analysis flow
2025-01-08 10:27:41,479 - INFO - Tokenized code into 91 tokens
2025-01-08 10:27:41,479 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 10:27:44,300 - INFO - Step 1 result: {'type': 'Program', 'name': 'get_connection_manager', 'range': [216, 239], 'children': []}
2025-01-08 10:27:44,301 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:27:45,954 - INFO - Step 1 result: {'type': 'Program', 'name': 'handle_subscribe', 'range': [437, 568], 'children': []}
2025-01-08 10:27:45,954 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:27:47,343 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [179, 215], 'children': [{'type': 'VariableDeclaration', 'name': 'docs_url', 'range': [180, 182], 'children': []}, {'type': 'IfStatement', 'name': '', 'range': [183, 195], 'children': []}, {'type': 'VariableDeclaration', 'name': 'app', 'range': [197, 208], 'children': []}, {'type': 'VariableDeclaration', 'name': '_connection_manager', 'range': [210, 212], 'children': []}]}
2025-01-08 10:27:47,344 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:27:49,748 - INFO - Step 1 result: {'type': 'Program', 'name': 'authenticate_websocket', 'range': [311, 436], 'children': []}
2025-01-08 10:27:49,803 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:27:51,547 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 129], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 10], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [12, 14], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [15, 21], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [22, 32], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [33, 41], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [43, 49], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [50, 58], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [59, 67], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [68, 76], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [77, 89], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [90, 98], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [99, 111], 'children': []}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [113, 121], 'children': []}, {'type': 'VariableDeclaration', 'name': 'settings', 'range': [122, 127], 'children': []}]}
2025-01-08 10:27:51,547 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:27:51,697 - INFO - Step 1 result: {'type': 'Program', 'name': 'websocket_router', 'range': [731, 974], 'children': []}
2025-01-08 10:27:51,697 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:27:51,735 - INFO - Step 1 result: {'type': 'Program', 'name': 'handle_unsubscribe', 'range': [569, 700], 'children': []}
2025-01-08 10:27:51,735 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:27:54,475 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [975, 1065], 'children': [{'type': 'ClassDeclaration', 'name': 'WebsocketServer', 'range': [975, 979], 'children': []}, {'type': 'FunctionDeclaration', 'name': 'run', 'range': [982, 1064], 'children': [{'type': 'VariableDeclaration', 'name': 'server_app', 'range': [997, 1035], 'children': []}, {'type': 'ExpressionStatement', 'name': '', 'range': [1037, 1063], 'children': []}]}]}
2025-01-08 10:27:54,475 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:02,106 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [701, 722], 'children': [{'type': 'FunctionDeclaration', 'name': 'health', 'range': [709, 721], 'children': [{'type': 'BlockStatement', 'range': [717, 721], 'children': [{'type': 'ReturnStatement', 'range': [716, 720], 'children': [{'type': 'ObjectExpression', 'range': [717, 721], 'children': [{'type': 'Property', 'range': [718, 720], 'children': [{'type': 'Literal', 'value': 'status', 'range': [718, 718]}, {'type': 'Literal', 'value': 'healthy', 'range': [720, 720]}]}]}]}]}]}]}
2025-01-08 10:28:02,146 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:09,083 - INFO - Step 1 result: {'type': 'Program', 'name': 'event_broadcaster', 'range': [241, 310], 'children': [{'type': 'FunctionDeclaration', 'name': 'event_broadcaster', 'range': [241, 310], 'children': [{'type': 'BlockStatement', 'range': [249, 310], 'children': [{'type': 'TryStatement', 'range': [251, 310], 'children': [{'type': 'BlockStatement', 'range': [252, 284], 'children': [{'type': 'ExpressionStatement', 'range': [254, 258], 'children': [{'type': 'CallExpression', 'range': [254, 258], 'children': [{'type': 'MemberExpression', 'range': [254, 256], 'children': [{'type': 'Identifier', 'name': 'redis', 'range': [254, 254]}, {'type': 'Identifier', 'name': 'connect', 'range': [256, 256]}]}]}]}, {'type': 'ExpressionStatement', 'range': [260, 264], 'children': [{'type': 'AssignmentExpression', 'range': [260, 264], 'children': [{'type': 'Identifier', 'name': 'event_queue', 'range': [260, 260]}, {'type': 'NewExpression', 'range': [262, 264], 'children': [{'type': 'Identifier', 'name': 'AsyncRedisExecutionEventBus', 'range': [262, 262]}]}]}]}, {'type': 'ForStatement', 'range': [266, 284], 'children': [{'type': 'VariableDeclaration', 'range': [268, 268], 'children': [{'type': 'VariableDeclarator', 'range': [268, 268], 'children': [{'type': 'Identifier', 'name': 'event', 'range': [268, 268]}]}]}, {'type': 'CallExpression', 'range': [270, 274], 'children': [{'type': 'MemberExpression', 'range': [270, 272], 'children': [{'type': 'Identifier', 'name': 'event_queue', 'range': [270, 270]}, {'type': 'Identifier', 'name': 'listen', 'range': [272, 272]}]}]}, {'type': 'BlockStatement', 'range': [275, 284], 'children': [{'type': 'ExpressionStatement', 'range': [277, 283], 'children': [{'type': 'AwaitExpression', 'range': [277, 283], 'children': [{'type': 'CallExpression', 'range': [278, 283], 'children': [{'type': 'MemberExpression', 'range': [278, 280], 'children': [{'type': 'Identifier', 'name': 'manager', 'range': [278, 278]}, {'type': 'Identifier', 'name': 'send_execution_result', 'range': [280, 280]}]}, {'type': 'Identifier', 'name': 'event', 'range': [282, 282]}]}]}]}]}]}]}, {'type': 'CatchClause', 'range': [285, 300], 'children': [{'type': 'BlockStatement', 'range': [289, 300], 'children': [{'type': 'ExpressionStatement', 'range': [291, 297], 'children': [{'type': 'CallExpression', 'range': [291, 297], 'children': [{'type': 'MemberExpression', 'range': [291, 293], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [291, 291]}, {'type': 'Identifier', 'name': 'exception', 'range': [293, 293]}]}, {'type': 'TemplateLiteral', 'range': [295, 296], 'children': [{'type': 'TemplateElement', 'value': 'Event broadcaster error: ', 'range': [295, 295]}, {'type': 'Identifier', 'name': 'e', 'range': [296, 296]}]}]}]}, {'type': 'ThrowStatement', 'range': [299, 300], 'children': []}]}]}, {'type': 'FinallyClause', 'range': [301, 310], 'children': [{'type': 'BlockStatement', 'range': [302, 310], 'children': [{'type': 'ExpressionStatement', 'range': [304, 308], 'children': [{'type': 'CallExpression', 'range': [304, 308], 'children': [{'type': 'MemberExpression', 'range': [304, 306], 'children': [{'type': 'Identifier', 'name': 'redis', 'range': [304, 304]}, {'type': 'Identifier', 'name': 'disconnect', 'range': [306, 306]}]}]}]}]}]}]}]}]}]}
2025-01-08 10:28:09,084 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:11,198 - INFO - Step 1 result: {'type': 'Program', 'name': 'lifespan', 'range': [130, 178], 'children': [{'type': 'FunctionDeclaration', 'name': 'lifespan', 'range': [130, 178], 'children': [{'type': 'Decorator', 'name': '@asynccontextmanager', 'range': [130, 131]}, {'type': 'Keyword', 'name': 'async', 'range': [133, 133]}, {'type': 'Keyword', 'name': 'def', 'range': [134, 134]}, {'type': 'Identifier', 'name': 'lifespan', 'range': [135, 135]}, {'type': 'Punctuator', 'name': '(', 'range': [136, 136]}, {'type': 'Identifier', 'name': 'app', 'range': [137, 137]}, {'type': 'Punctuator', 'name': ':', 'range': [138, 138]}, {'type': 'Identifier', 'name': 'FastAPI', 'range': [139, 139]}, {'type': 'Punctuator', 'name': ')', 'range': [140, 140]}, {'type': 'Punctuator', 'name': ':', 'range': [141, 141]}, {'type': 'BlockStatement', 'range': [142, 178], 'children': [{'type': 'VariableDeclaration', 'range': [143, 147], 'children': [{'type': 'Identifier', 'name': 'manager', 'range': [143, 143]}, {'type': 'Punctuator', 'name': '=', 'range': [144, 144]}, {'type': 'CallExpression', 'range': [145, 147], 'children': [{'type': 'Identifier', 'name': 'get_connection_manager', 'range': [145, 145]}, {'type': 'Punctuator', 'name': '(', 'range': [146, 146]}, {'type': 'Punctuator', 'name': ')', 'range': [147, 147]}]}]}, {'type': 'VariableDeclaration', 'range': [149, 159], 'children': [{'type': 'Identifier', 'name': 'fut', 'range': [149, 149]}, {'type': 'Punctuator', 'name': '=', 'range': [150, 150]}, {'type': 'CallExpression', 'range': [151, 159], 'children': [{'type': 'MemberExpression', 'range': [151, 153], 'children': [{'type': 'Identifier', 'name': 'asyncio', 'range': [151, 151]}, {'type': 'Punctuator', 'name': '.', 'range': [152, 152]}, {'type': 'Identifier', 'name': 'create_task', 'range': [153, 153]}]}, {'type': 'Punctuator', 'name': '(', 'range': [154, 154]}, {'type': 'CallExpression', 'range': [155, 158], 'children': [{'type': 'Identifier', 'name': 'event_broadcaster', 'range': [155, 155]}, {'type': 'Punctuator', 'name': '(', 'range': [156, 156]}, {'type': 'Identifier', 'name': 'manager', 'range': [157, 157]}, {'type': 'Punctuator', 'name': ')', 'range': [158, 158]}]}, {'type': 'Punctuator', 'name': ')', 'range': [159, 159]}]}]}, {'type': 'ExpressionStatement', 'range': [161, 174], 'children': [{'type': 'CallExpression', 'range': [161, 174], 'children': [{'type': 'MemberExpression', 'range': [161, 163], 'children': [{'type': 'Identifier', 'name': 'fut', 'range': [161, 161]}, {'type': 'Punctuator', 'name': '.', 'range': [162, 162]}, {'type': 'Identifier', 'name': 'add_done_callback', 'range': [163, 163]}]}, {'type': 'Punctuator', 'name': '(', 'range': [164, 164]}, {'type': 'LambdaExpression', 'range': [165, 173], 'children': [{'type': 'Keyword', 'name': 'lambda', 'range': [165, 165]}, {'type': 'Identifier', 'name': '_', 'range': [166, 166]}, {'type': 'Punctuator', 'name': ':', 'range': [167, 167]}, {'type': 'CallExpression', 'range': [168, 173], 'children': [{'type': 'MemberExpression', 'range': [168, 170], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [168, 168]}, {'type': 'Punctuator', 'name': '.', 'range': [169, 169]}, {'type': 'Identifier', 'name': 'info', 'range': [170, 170]}]}, {'type': 'Punctuator', 'name': '(', 'range': [171, 171]}, {'type': 'StringLiteral', 'value': '"Event broadcaster stopped"', 'range': [172, 172]}, {'type': 'Punctuator', 'name': ')', 'range': [173, 173]}]}]}, {'type': 'Punctuator', 'name': ')', 'range': [174, 174]}]}]}, {'type': 'Keyword', 'name': 'yield', 'range': [176, 176]}]}]}]}
2025-01-08 10:28:11,199 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 10:28:15,237 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [701, 722], 'children': [{'type': 'FunctionDeclaration', 'name': 'health', 'range': [709, 721], 'children': [{'type': 'BlockStatement', 'range': [717, 721], 'children': [{'type': 'ReturnStatement', 'range': [716, 720], 'children': [{'type': 'ObjectExpression', 'range': [717, 721], 'children': [{'type': 'Property', 'range': [718, 720], 'children': [{'type': 'Literal', 'value': 'status', 'range': [718, 718]}, {'type': 'Literal', 'value': 'healthy', 'range': [720, 720]}]}]}]}]}]}]}
2025-01-08 10:28:15,434 - INFO - Step 2 result: {'nodes': [{'type': 'VariableDeclaration', 'name': 'docs_url', 'range': [180, 182], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [181, 182], 'children': [{'type': 'Literal', 'name': '"/docs"', 'range': [182, 182], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [183, 195], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [189, 190], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [185, 188], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [185, 186], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [184, 184], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [186, 186], 'children': []}]}, {'type': 'Identifier', 'name': 'app_env', 'range': [188, 188], 'children': []}]}, {'type': 'MemberExpression', 'name': '.', 'range': [192, 193], 'children': [{'type': 'Identifier', 'name': 'AppEnvironment', 'range': [191, 191], 'children': []}, {'type': 'Identifier', 'name': 'LOCAL', 'range': [193, 193], 'children': []}]}]}, {'type': 'Literal', 'name': 'None', 'range': [195, 195], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'app', 'range': [197, 208], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [198, 208], 'children': [{'type': 'NewExpression', 'name': 'FastAPI', 'range': [199, 208], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [200, 208], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [202, 203], 'children': [{'type': 'Identifier', 'name': 'lifespan', 'range': [203, 203], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [206, 207], 'children': [{'type': 'Identifier', 'name': 'docs_url', 'range': [207, 207], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': '_connection_manager', 'range': [210, 212], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [211, 212], 'children': [{'type': 'Literal', 'name': 'None', 'range': [212, 212], 'children': []}]}]}]}
2025-01-08 10:28:15,596 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:15,886 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:16,597 - INFO - Step 2 result: {'type': 'Program', 'name': 'get_connection_manager', 'range': [216, 239], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_connection_manager', 'range': [216, 239], 'children': [{'type': 'FunctionSignature', 'name': 'get_connection_manager', 'range': [216, 220], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [216, 216], 'children': []}, {'type': 'Identifier', 'name': 'get_connection_manager', 'range': [217, 217], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [218, 218], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [219, 219], 'children': []}, {'type': 'Punctuation', 'name': ':', 'range': [220, 220], 'children': []}]}, {'type': 'FunctionBody', 'name': 'get_connection_manager', 'range': [221, 239], 'children': [{'type': 'GlobalStatement', 'name': 'global', 'range': [222, 224], 'children': [{'type': 'Keyword', 'name': 'global', 'range': [222, 222], 'children': []}, {'type': 'Identifier', 'name': '_connection_manager', 'range': [223, 223], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [225, 236], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [225, 225], 'children': []}, {'type': 'Expression', 'name': '_connection_manager is None', 'range': [226, 229], 'children': [{'type': 'Identifier', 'name': '_connection_manager', 'range': [226, 226], 'children': []}, {'type': 'Keyword', 'name': 'is', 'range': [227, 227], 'children': []}, {'type': 'Keyword', 'name': 'None', 'range': [228, 228], 'children': []}]}, {'type': 'Punctuation', 'name': ':', 'range': [229, 229], 'children': []}, {'type': 'Assignment', 'name': '_connection_manager = ConnectionManager()', 'range': [231, 235], 'children': [{'type': 'Identifier', 'name': '_connection_manager', 'range': [231, 231], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [232, 232], 'children': []}, {'type': 'NewExpression', 'name': 'ConnectionManager()', 'range': [233, 235], 'children': [{'type': 'Identifier', 'name': 'ConnectionManager', 'range': [233, 233], 'children': []}, {'type': 'Punctuation', 'name': '(', 'range': [234, 234], 'children': []}, {'type': 'Punctuation', 'name': ')', 'range': [235, 235], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [237, 239], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [237, 237], 'children': []}, {'type': 'Identifier', 'name': '_connection_manager', 'range': [238, 238], 'children': []}]}]}]}]}
2025-01-08 10:28:17,160 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:19,291 - INFO - Step 2 result: {'type': 'Program', 'name': 'handle_subscribe', 'range': [437, 568], 'children': [{'type': 'FunctionDeclaration', 'name': 'handle_subscribe', 'range': [437, 568], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [440, 454], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [442, 444], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [446, 448], 'children': []}, {'type': 'Parameter', 'name': 'message', 'range': [450, 452], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [456, 568], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [457, 497], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [458, 462], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [459, 461], 'children': []}]}, {'type': 'BlockStatement', 'name': 'consequent', 'range': [463, 497], 'children': [{'type': 'ExpressionStatement', 'name': 'await', 'range': [464, 496], 'children': [{'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [465, 496], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [470, 490], 'children': [{'type': 'AssignmentExpression', 'name': 'method', 'range': [473, 477], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success', 'range': [480, 482], 'children': []}, {'type': 'AssignmentExpression', 'name': 'error', 'range': [485, 487], 'children': []}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [492, 494], 'children': []}]}]}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [498, 568], 'children': [{'type': 'BlockStatement', 'name': 'alternate', 'range': [500, 568], 'children': [{'type': 'VariableDeclaration', 'name': 'ex_sub', 'range': [501, 511], 'children': [{'type': 'CallExpression', 'name': 'ExecutionSubscription.model_validate', 'range': [503, 510], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [507, 509], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'await', 'range': [512, 523], 'children': [{'type': 'CallExpression', 'name': 'manager.subscribe', 'range': [513, 522], 'children': [{'type': 'MemberExpression', 'name': 'ex_sub.graph_id', 'range': [517, 519], 'children': []}, {'type': 'Identifier', 'name': 'websocket', 'range': [521, 521], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [524, 531], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [528, 529], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'await', 'range': [532, 567], 'children': [{'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [533, 567], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [538, 560], 'children': [{'type': 'AssignmentExpression', 'name': 'method', 'range': [541, 545], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success', 'range': [548, 550], 'children': []}, {'type': 'AssignmentExpression', 'name': 'channel', 'range': [553, 558], 'children': []}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [562, 564], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:28:19,291 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:21,558 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [975, 1065], 'children': [{'type': 'ClassDeclaration', 'name': 'WebsocketServer', 'range': [975, 979], 'children': [{'type': 'FunctionDeclaration', 'name': 'run', 'range': [982, 1064], 'children': [{'type': 'BlockStatement', 'name': '', 'range': [988, 1064], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [989, 996], 'children': [{'type': 'CallExpression', 'name': 'logger.info', 'range': [989, 995], 'children': [{'type': 'Literal', 'name': '"CORS allow origins: {settings.config.backend_cors_allow_origins}"', 'range': [993, 994], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'server_app', 'range': [997, 1035], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [997, 1035], 'children': [{'type': 'Identifier', 'name': 'server_app', 'range': [997, 1006], 'children': []}, {'type': 'NewExpression', 'name': 'CORSMiddleware', 'range': [999, 1035], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1000, 1035], 'children': [{'type': 'Property', 'name': 'app', 'range': [1002, 1005], 'children': [{'type': 'Identifier', 'name': 'app', 'range': [1004, 1004], 'children': []}]}, {'type': 'Property', 'name': 'allow_origins', 'range': [1007, 1014], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.backend_cors_allow_origins', 'range': [1009, 1013], 'children': []}]}, {'type': 'Property', 'name': 'allow_credentials', 'range': [1016, 1019], 'children': [{'type': 'Literal', 'name': 'True', 'range': [1018, 1018], 'children': []}]}, {'type': 'Property', 'name': 'allow_methods', 'range': [1021, 1026], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1023, 1025], 'children': [{'type': 'Literal', 'name': '"*"', 'range': [1024, 1024], 'children': []}]}]}, {'type': 'Property', 'name': 'allow_headers', 'range': [1028, 1033], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1030, 1032], 'children': [{'type': 'Literal', 'name': '"*"', 'range': [1031, 1031], 'children': []}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1037, 1063], 'children': [{'type': 'CallExpression', 'name': 'uvicorn.run', 'range': [1037, 1063], 'children': [{'type': 'Identifier', 'name': 'server_app', 'range': [1042, 1043], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [1045, 1061], 'children': [{'type': 'Property', 'name': 'host', 'range': [1045, 1052], 'children': [{'type': 'MemberExpression', 'name': 'Config().websocket_server_host', 'range': [1047, 1051], 'children': []}]}, {'type': 'Property', 'name': 'port', 'range': [1054, 1061], 'children': [{'type': 'MemberExpression', 'name': 'Config().websocket_server_port', 'range': [1056, 1060], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:28:21,558 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:24,895 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [701, 722], 'children': [{'type': 'FunctionDeclaration', 'name': 'health', 'range': [709, 721], 'children': [{'type': 'BlockStatement', 'range': [717, 721], 'children': [{'type': 'ReturnStatement', 'range': [716, 720], 'children': [{'type': 'ObjectExpression', 'range': [717, 721], 'children': [{'type': 'Property', 'range': [718, 720], 'children': [{'type': 'Literal', 'value': 'status', 'range': [718, 718]}, {'type': 'Literal', 'value': 'healthy', 'range': [720, 720]}]}]}]}]}]}]}
2025-01-08 10:28:24,895 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:27,197 - INFO - Step 2 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'asynccontextmanager', 'range': [9, 9], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [12, 14], 'children': [{'type': 'ImportSpecifier', 'name': 'uvicorn', 'range': [13, 13], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [15, 21], 'children': [{'type': 'ImportSpecifier', 'name': 'parse_jwt_token', 'range': [20, 20], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [22, 32], 'children': [{'type': 'ImportSpecifier', 'name': 'Depends', 'range': [25, 25], 'children': []}, {'type': 'ImportSpecifier', 'name': 'FastAPI', 'range': [27, 27], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WebSocket', 'range': [29, 29], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WebSocketDisconnect', 'range': [31, 31], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [33, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'CORSMiddleware', 'range': [40, 40], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [43, 49], 'children': [{'type': 'ImportSpecifier', 'name': 'redis', 'range': [48, 48], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [50, 58], 'children': [{'type': 'ImportSpecifier', 'name': 'AsyncRedisExecutionEventBus', 'range': [57, 57], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [59, 67], 'children': [{'type': 'ImportSpecifier', 'name': 'DEFAULT_USER_ID', 'range': [66, 66], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [68, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'ConnectionManager', 'range': [75, 75], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [77, 89], 'children': [{'type': 'ImportSpecifier', 'name': 'ExecutionSubscription', 'range': [84, 84], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Methods', 'range': [86, 86], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WsMessage', 'range': [88, 88], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [90, 98], 'children': [{'type': 'ImportSpecifier', 'name': 'AppProcess', 'range': [97, 97], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [99, 111], 'children': [{'type': 'ImportSpecifier', 'name': 'AppEnvironment', 'range': [106, 106], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Config', 'range': [108, 108], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Settings', 'range': [110, 110], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [113, 121], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [114, 120], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [117, 120], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [119, 119], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'settings', 'range': [122, 127], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [123, 126], 'children': [{'type': 'NewExpression', 'name': 'Settings', 'range': [124, 126], 'children': []}]}]}]}
2025-01-08 10:28:27,197 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:29,935 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [701, 722], 'children': [{'type': 'FunctionDecl', 'name': 'health', 'range': [709, 721], 'children': [{'type': 'BlockStatement', 'range': [717, 721], 'children': [{'type': 'ReturnStatement', 'range': [716, 720], 'children': [{'type': 'ObjectExpression', 'range': [717, 721], 'children': [{'type': 'Property', 'range': [718, 720], 'children': [{'type': 'Literal', 'value': 'status', 'range': [718, 718]}, {'type': 'Literal', 'value': 'healthy', 'range': [720, 720]}]}]}]}]}]}]}
2025-01-08 10:28:29,935 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:35,181 - INFO - Step 2 result: {'type': 'Program', 'name': 'websocket_router', 'range': [731, 974], 'children': [{'type': 'FunctionDeclaration', 'name': 'websocket_router', 'range': [731, 974], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [736, 738], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [740, 742], 'children': []}, {'type': 'Assignment', 'name': 'user_id', 'range': [752, 758], 'children': [{'type': 'FunctionCall', 'name': 'authenticate_websocket', 'range': [755, 758], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [757, 757], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [760, 766], 'children': [{'type': 'Condition', 'name': 'not user_id', 'range': [761, 762], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [765, 765], 'children': []}]}, {'type': 'FunctionCall', 'name': 'manager.connect', 'range': [768, 773], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [772, 772], 'children': []}]}, {'type': 'TryStatement', 'name': 'try', 'range': [775, 973], 'children': [{'type': 'WhileLoop', 'name': 'while', 'range': [778, 955], 'children': [{'type': 'Assignment', 'name': 'data', 'range': [782, 789], 'children': [{'type': 'FunctionCall', 'name': 'websocket.receive_text', 'range': [785, 789], 'children': []}]}, {'type': 'Assignment', 'name': 'message', 'range': [791, 798], 'children': [{'type': 'FunctionCall', 'name': 'WsMessage.model_validate_json', 'range': [793, 798], 'children': [{'type': 'Argument', 'name': 'data', 'range': [797, 797], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [801, 839], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.HEARTBEAT', 'range': [802, 809], 'children': []}, {'type': 'FunctionCall', 'name': 'websocket.send_json', 'range': [813, 836], 'children': [{'type': 'Argument', 'name': '{"method": Methods.HEARTBEAT.value, "data": "pong", "success": True}', 'range': [817, 834], 'children': []}]}, {'type': 'ContinueStatement', 'name': 'continue', 'range': [838, 838], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [841, 861], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.SUBSCRIBE', 'range': [842, 849], 'children': []}, {'type': 'FunctionCall', 'name': 'handle_subscribe', 'range': [853, 860], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [855, 855], 'children': []}, {'type': 'Argument', 'name': 'manager', 'range': [857, 857], 'children': []}, {'type': 'Argument', 'name': 'message', 'range': [859, 859], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'elif', 'range': [863, 883], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.UNSUBSCRIBE', 'range': [864, 871], 'children': []}, {'type': 'FunctionCall', 'name': 'handle_unsubscribe', 'range': [875, 882], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [877, 877], 'children': []}, {'type': 'Argument', 'name': 'manager', 'range': [879, 879], 'children': []}, {'type': 'Argument', 'name': 'message', 'range': [881, 881], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'elif', 'range': [885, 904], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.ERROR', 'range': [886, 893], 'children': []}, {'type': 'FunctionCall', 'name': 'logger.error', 'range': [896, 902], 'children': [{'type': 'Argument', 'name': 'f"WebSocket Error message received: {message.data}"', 'range': [900, 901], 'children': []}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [905, 954], 'children': [{'type': 'FunctionCall', 'name': 'logger.warning', 'range': [908, 919], 'children': [{'type': 'Argument', 'name': 'f"Unknown WebSocket message type {message.method} received: "', 'range': [913, 914], 'children': []}, {'type': 'Argument', 'name': 'f"{message.data}"', 'range': [916, 917], 'children': []}]}, {'type': 'FunctionCall', 'name': 'websocket.send_text', 'range': [921, 953], 'children': [{'type': 'Argument', 'name': 'WsMessage(method=Methods.ERROR, success=False, error="Message type is not processed by the server").model_dump_json()', 'range': [927, 951], 'children': []}]}]}]}, {'type': 'ExceptStatement', 'name': 'except', 'range': [956, 973], 'children': [{'type': 'Exception', 'name': 'WebSocketDisconnect', 'range': [957, 957], 'children': []}, {'type': 'FunctionCall', 'name': 'manager.disconnect', 'range': [960, 965], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [964, 964], 'children': []}]}, {'type': 'FunctionCall', 'name': 'logger.debug', 'range': [967, 972], 'children': [{'type': 'Argument', 'name': '"WebSocket client disconnected"', 'range': [971, 971], 'children': []}]}]}]}]}]}
2025-01-08 10:28:35,181 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:35,717 - INFO - Step 3 result: {'type': 'Program', 'name': 'get_connection_manager', 'range': [216, 239], 'children': [{'type': 'FunctionDeclaration', 'name': 'get_connection_manager', 'range': [216, 239], 'children': [{'type': 'FunctionSignature', 'name': 'get_connection_manager', 'range': [216, 220], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [216, 216], 'children': []}, {'type': 'Identifier', 'name': 'get_connection_manager', 'range': [217, 217], 'children': []}]}, {'type': 'FunctionBody', 'name': 'get_connection_manager', 'range': [221, 239], 'children': [{'type': 'GlobalStatement', 'name': 'global', 'range': [222, 224], 'children': [{'type': 'Keyword', 'name': 'global', 'range': [222, 222], 'children': []}, {'type': 'Identifier', 'name': '_connection_manager', 'range': [223, 223], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [225, 236], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [225, 225], 'children': []}, {'type': 'Expression', 'name': '_connection_manager is None', 'range': [226, 229], 'children': [{'type': 'Identifier', 'name': '_connection_manager', 'range': [226, 226], 'children': []}, {'type': 'Keyword', 'name': 'is', 'range': [227, 227], 'children': []}, {'type': 'Keyword', 'name': 'None', 'range': [228, 228], 'children': []}]}, {'type': 'Assignment', 'name': '_connection_manager = ConnectionManager()', 'range': [231, 235], 'children': [{'type': 'Identifier', 'name': '_connection_manager', 'range': [231, 231], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [232, 232], 'children': []}, {'type': 'NewExpression', 'name': 'ConnectionManager()', 'range': [233, 235], 'children': [{'type': 'Identifier', 'name': 'ConnectionManager', 'range': [233, 233], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [237, 239], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [237, 237], 'children': []}, {'type': 'Identifier', 'name': '_connection_manager', 'range': [238, 238], 'children': []}]}]}]}]}
2025-01-08 10:28:35,717 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:35,909 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [701, 722], 'children': [{'type': 'FunctionDecl', 'name': 'health', 'range': [709, 721], 'children': [{'type': 'BlockStatement', 'range': [717, 721], 'children': [{'type': 'ReturnStatement', 'range': [716, 720], 'children': [{'type': 'ObjectExpression', 'range': [717, 721], 'children': [{'type': 'Property', 'range': [718, 720], 'children': [{'type': 'Literal', 'value': 'status', 'range': [718, 718]}, {'type': 'Literal', 'value': 'healthy', 'range': [720, 720]}]}]}]}]}]}]}
2025-01-08 10:28:35,910 - INFO - Completed main AST analysis flow
2025-01-08 10:28:35,910 - INFO - Successfully processed chunk
2025-01-08 10:28:36,625 - INFO - Step 2 result: {'type': 'Program', 'name': 'handle_unsubscribe', 'range': [569, 700], 'children': [{'type': 'FunctionDeclaration', 'name': 'handle_unsubscribe', 'range': [569, 700], 'children': [{'type': 'FunctionSignature', 'name': 'handle_unsubscribe', 'range': [569, 587], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [569, 573], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [570, 573], 'children': []}, {'type': 'Identifier', 'name': 'handle_unsubscribe', 'range': [571, 587], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [572, 586], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [574, 576], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [578, 580], 'children': []}, {'type': 'Parameter', 'name': 'message', 'range': [582, 584], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [588, 700], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [589, 629], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [589, 594], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [590, 591], 'children': []}, {'type': 'MemberExpression', 'name': 'message.data', 'range': [591, 593], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [595, 629], 'children': [{'type': 'ExpressionStatement', 'name': 'await websocket.send_text', 'range': [596, 628], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [596, 597], 'children': []}, {'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [597, 628], 'children': [{'type': 'MemberExpression', 'name': 'websocket.send_text', 'range': [597, 599], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [600, 627], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [602, 622], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [603, 621], 'children': [{'type': 'AssignmentExpression', 'name': 'method=Methods.ERROR', 'range': [605, 609], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success=False', 'range': [612, 614], 'children': []}, {'type': 'AssignmentExpression', 'name': 'error="Subscription data missing"', 'range': [617, 619], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [623, 626], 'children': []}]}]}]}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [630, 700], 'children': [{'type': 'Block', 'name': 'alternate', 'range': [632, 700], 'children': [{'type': 'VariableDeclaration', 'name': 'ex_sub', 'range': [633, 643], 'children': [{'type': 'AssignmentExpression', 'name': 'ex_sub=ExecutionSubscription.model_validate', 'range': [634, 642], 'children': [{'type': 'CallExpression', 'name': 'ExecutionSubscription.model_validate', 'range': [635, 642], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [639, 641], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'await manager.unsubscribe', 'range': [644, 655], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [644, 645], 'children': []}, {'type': 'CallExpression', 'name': 'manager.unsubscribe', 'range': [645, 655], 'children': [{'type': 'MemberExpression', 'name': 'manager.unsubscribe', 'range': [645, 647], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [648, 654], 'children': [{'type': 'MemberExpression', 'name': 'ex_sub.graph_id', 'range': [649, 651], 'children': []}, {'type': 'Identifier', 'name': 'websocket', 'range': [653, 654], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [656, 663], 'children': [{'type': 'CallExpression', 'name': 'logger.debug', 'range': [656, 663], 'children': [{'type': 'MemberExpression', 'name': 'logger.debug', 'range': [656, 658], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [659, 662], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Removed execution subscription for graph {ex_sub.graph_id}"', 'range': [660, 661], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'await websocket.send_text', 'range': [664, 699], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [664, 665], 'children': []}, {'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [665, 699], 'children': [{'type': 'MemberExpression', 'name': 'websocket.send_text', 'range': [665, 667], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [668, 698], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [670, 692], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [671, 691], 'children': [{'type': 'AssignmentExpression', 'name': 'method=Methods.UNSUBSCRIBE', 'range': [673, 677], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success=True', 'range': [680, 682], 'children': []}, {'type': 'AssignmentExpression', 'name': 'channel=ex_sub.graph_id', 'range': [685, 689], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [693, 696], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:28:36,625 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:37,937 - INFO - Step 3 result: {'nodes': [{'type': 'VariableDeclaration', 'name': 'docs_url', 'range': [180, 182], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [181, 182], 'children': [{'type': 'Literal', 'name': '"/docs"', 'range': [182, 182], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [183, 195], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [189, 190], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [185, 188], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [185, 186], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [184, 184], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [186, 186], 'children': []}]}, {'type': 'Identifier', 'name': 'app_env', 'range': [188, 188], 'children': []}]}, {'type': 'MemberExpression', 'name': '.', 'range': [192, 193], 'children': [{'type': 'Identifier', 'name': 'AppEnvironment', 'range': [191, 191], 'children': []}, {'type': 'Identifier', 'name': 'LOCAL', 'range': [193, 193], 'children': []}]}]}, {'type': 'Literal', 'name': 'None', 'range': [195, 195], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'app', 'range': [197, 208], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [198, 208], 'children': [{'type': 'NewExpression', 'name': 'FastAPI', 'range': [199, 208], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [200, 208], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [202, 203], 'children': [{'type': 'Identifier', 'name': 'lifespan', 'range': [203, 203], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [206, 207], 'children': [{'type': 'Identifier', 'name': 'docs_url', 'range': [207, 207], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': '_connection_manager', 'range': [210, 212], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [211, 212], 'children': [{'type': 'Literal', 'name': 'None', 'range': [212, 212], 'children': []}]}]}]}
2025-01-08 10:28:37,937 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:41,470 - INFO - Step 2 result: {'type': 'Program', 'name': 'event_broadcaster', 'range': [241, 310], 'children': [{'type': 'FunctionDeclaration', 'name': 'event_broadcaster', 'range': [241, 310], 'children': [{'type': 'BlockStatement', 'range': [249, 310], 'children': [{'type': 'TryStatement', 'range': [251, 310], 'children': [{'type': 'BlockStatement', 'range': [252, 284], 'children': [{'type': 'ExpressionStatement', 'range': [254, 258], 'children': [{'type': 'CallExpression', 'range': [254, 258], 'children': [{'type': 'MemberExpression', 'range': [254, 256], 'children': [{'type': 'Identifier', 'name': 'redis', 'range': [254, 254]}, {'type': 'Identifier', 'name': 'connect', 'range': [256, 256]}]}]}]}, {'type': 'ExpressionStatement', 'range': [260, 264], 'children': [{'type': 'AssignmentExpression', 'range': [260, 264], 'children': [{'type': 'Identifier', 'name': 'event_queue', 'range': [260, 260]}, {'type': 'NewExpression', 'range': [262, 264], 'children': [{'type': 'Identifier', 'name': 'AsyncRedisExecutionEventBus', 'range': [262, 262]}]}]}]}, {'type': 'ForStatement', 'range': [266, 284], 'children': [{'type': 'VariableDeclaration', 'range': [268, 268], 'children': [{'type': 'VariableDeclarator', 'range': [268, 268], 'children': [{'type': 'Identifier', 'name': 'event', 'range': [268, 268]}]}]}, {'type': 'CallExpression', 'range': [270, 274], 'children': [{'type': 'MemberExpression', 'range': [270, 272], 'children': [{'type': 'Identifier', 'name': 'event_queue', 'range': [270, 270]}, {'type': 'Identifier', 'name': 'listen', 'range': [272, 272]}]}]}, {'type': 'BlockStatement', 'range': [275, 284], 'children': [{'type': 'ExpressionStatement', 'range': [277, 283], 'children': [{'type': 'AwaitExpression', 'range': [277, 283], 'children': [{'type': 'CallExpression', 'range': [278, 283], 'children': [{'type': 'MemberExpression', 'range': [278, 280], 'children': [{'type': 'Identifier', 'name': 'manager', 'range': [278, 278]}, {'type': 'Identifier', 'name': 'send_execution_result', 'range': [280, 280]}]}, {'type': 'Identifier', 'name': 'event', 'range': [282, 282]}]}]}]}]}]}]}, {'type': 'CatchClause', 'range': [285, 300], 'children': [{'type': 'BlockStatement', 'range': [289, 300], 'children': [{'type': 'ExpressionStatement', 'range': [291, 297], 'children': [{'type': 'CallExpression', 'range': [291, 297], 'children': [{'type': 'MemberExpression', 'range': [291, 293], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [291, 291]}, {'type': 'Identifier', 'name': 'exception', 'range': [293, 293]}]}, {'type': 'TemplateLiteral', 'range': [295, 296], 'children': [{'type': 'TemplateElement', 'value': 'Event broadcaster error: ', 'range': [295, 295]}, {'type': 'Identifier', 'name': 'e', 'range': [296, 296]}]}]}]}, {'type': 'ThrowStatement', 'range': [299, 300], 'children': []}]}]}, {'type': 'FinallyClause', 'range': [301, 310], 'children': [{'type': 'BlockStatement', 'range': [302, 310], 'children': [{'type': 'ExpressionStatement', 'range': [304, 308], 'children': [{'type': 'CallExpression', 'range': [304, 308], 'children': [{'type': 'MemberExpression', 'range': [304, 306], 'children': [{'type': 'Identifier', 'name': 'redis', 'range': [304, 304]}, {'type': 'Identifier', 'name': 'disconnect', 'range': [306, 306]}]}]}]}]}]}]}]}]}]}
2025-01-08 10:28:41,470 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:44,513 - INFO - Step 3 result: {'type': 'Program', 'name': 'handle_subscribe', 'range': [437, 568], 'children': [{'type': 'FunctionDeclaration', 'name': 'handle_subscribe', 'range': [437, 568], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [440, 454], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [442, 444], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [446, 448], 'children': []}, {'type': 'Parameter', 'name': 'message', 'range': [450, 452], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [456, 568], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [457, 497], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [458, 462], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [459, 461], 'children': []}]}, {'type': 'BlockStatement', 'name': 'consequent', 'range': [463, 497], 'children': [{'type': 'ExpressionStatement', 'name': 'await', 'range': [464, 496], 'children': [{'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [465, 496], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [470, 490], 'children': [{'type': 'AssignmentExpression', 'name': 'method', 'range': [473, 477], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success', 'range': [480, 482], 'children': []}, {'type': 'AssignmentExpression', 'name': 'error', 'range': [485, 487], 'children': []}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [492, 494], 'children': []}]}]}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [498, 568], 'children': [{'type': 'BlockStatement', 'name': 'alternate', 'range': [500, 568], 'children': [{'type': 'VariableDeclaration', 'name': 'ex_sub', 'range': [501, 511], 'children': [{'type': 'CallExpression', 'name': 'ExecutionSubscription.model_validate', 'range': [503, 510], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [507, 509], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'await', 'range': [512, 523], 'children': [{'type': 'CallExpression', 'name': 'manager.subscribe', 'range': [513, 522], 'children': [{'type': 'MemberExpression', 'name': 'ex_sub.graph_id', 'range': [517, 519], 'children': []}, {'type': 'Identifier', 'name': 'websocket', 'range': [521, 521], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [524, 531], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [528, 529], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'await', 'range': [532, 567], 'children': [{'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [533, 567], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [538, 560], 'children': [{'type': 'AssignmentExpression', 'name': 'method', 'range': [541, 545], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success', 'range': [548, 550], 'children': []}, {'type': 'AssignmentExpression', 'name': 'channel', 'range': [553, 558], 'children': []}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [562, 564], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:28:44,514 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:46,588 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [975, 1065], 'children': [{'type': 'ClassDeclaration', 'name': 'WebsocketServer', 'range': [975, 979], 'children': [{'type': 'FunctionDeclaration', 'name': 'run', 'range': [982, 1064], 'children': [{'type': 'BlockStatement', 'name': '', 'range': [988, 1064], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [989, 996], 'children': [{'type': 'CallExpression', 'name': 'logger.info', 'range': [989, 995], 'children': [{'type': 'Literal', 'name': '"CORS allow origins: {settings.config.backend_cors_allow_origins}"', 'range': [993, 994], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'server_app', 'range': [997, 1035], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [997, 1035], 'children': [{'type': 'Identifier', 'name': 'server_app', 'range': [997, 1006], 'children': []}, {'type': 'NewExpression', 'name': 'CORSMiddleware', 'range': [999, 1035], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1000, 1035], 'children': [{'type': 'Property', 'name': 'app', 'range': [1002, 1005], 'children': [{'type': 'Identifier', 'name': 'app', 'range': [1004, 1004], 'children': []}]}, {'type': 'Property', 'name': 'allow_origins', 'range': [1007, 1014], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.backend_cors_allow_origins', 'range': [1009, 1013], 'children': []}]}, {'type': 'Property', 'name': 'allow_credentials', 'range': [1016, 1019], 'children': [{'type': 'Literal', 'name': 'True', 'range': [1018, 1018], 'children': []}]}, {'type': 'Property', 'name': 'allow_methods', 'range': [1021, 1026], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1023, 1025], 'children': [{'type': 'Literal', 'name': '"*"', 'range': [1024, 1024], 'children': []}]}]}, {'type': 'Property', 'name': 'allow_headers', 'range': [1028, 1033], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1030, 1032], 'children': [{'type': 'Literal', 'name': '"*"', 'range': [1031, 1031], 'children': []}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1037, 1063], 'children': [{'type': 'CallExpression', 'name': 'uvicorn.run', 'range': [1037, 1063], 'children': [{'type': 'Identifier', 'name': 'server_app', 'range': [1042, 1043], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [1045, 1061], 'children': [{'type': 'Property', 'name': 'host', 'range': [1045, 1052], 'children': [{'type': 'MemberExpression', 'name': 'Config().websocket_server_host', 'range': [1047, 1051], 'children': []}]}, {'type': 'Property', 'name': 'port', 'range': [1054, 1061], 'children': [{'type': 'MemberExpression', 'name': 'Config().websocket_server_port', 'range': [1056, 1060], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:28:46,588 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:49,588 - INFO - Step 2 result: {'type': 'Program', 'name': 'lifespan', 'range': [130, 178], 'children': [{'type': 'FunctionDeclaration', 'name': 'lifespan', 'range': [130, 178], 'children': [{'type': 'Decorator', 'name': '@asynccontextmanager', 'range': [130, 131]}, {'type': 'Keyword', 'name': 'async', 'range': [133, 133]}, {'type': 'Keyword', 'name': 'def', 'range': [134, 134]}, {'type': 'Identifier', 'name': 'lifespan', 'range': [135, 135]}, {'type': 'Punctuator', 'name': '(', 'range': [136, 136]}, {'type': 'Identifier', 'name': 'app', 'range': [137, 137]}, {'type': 'Punctuator', 'name': ':', 'range': [138, 138]}, {'type': 'Identifier', 'name': 'FastAPI', 'range': [139, 139]}, {'type': 'Punctuator', 'name': ')', 'range': [140, 140]}, {'type': 'Punctuator', 'name': ':', 'range': [141, 141]}, {'type': 'BlockStatement', 'range': [142, 178], 'children': [{'type': 'VariableDeclaration', 'range': [143, 147], 'children': [{'type': 'Identifier', 'name': 'manager', 'range': [143, 143]}, {'type': 'Punctuator', 'name': '=', 'range': [144, 144]}, {'type': 'CallExpression', 'range': [145, 147], 'children': [{'type': 'Identifier', 'name': 'get_connection_manager', 'range': [145, 145]}, {'type': 'Punctuator', 'name': '(', 'range': [146, 146]}, {'type': 'Punctuator', 'name': ')', 'range': [147, 147]}]}]}, {'type': 'VariableDeclaration', 'range': [149, 159], 'children': [{'type': 'Identifier', 'name': 'fut', 'range': [149, 149]}, {'type': 'Punctuator', 'name': '=', 'range': [150, 150]}, {'type': 'CallExpression', 'range': [151, 159], 'children': [{'type': 'MemberExpression', 'range': [151, 153], 'children': [{'type': 'Identifier', 'name': 'asyncio', 'range': [151, 151]}, {'type': 'Punctuator', 'name': '.', 'range': [152, 152]}, {'type': 'Identifier', 'name': 'create_task', 'range': [153, 153]}]}, {'type': 'Punctuator', 'name': '(', 'range': [154, 154]}, {'type': 'CallExpression', 'range': [155, 158], 'children': [{'type': 'Identifier', 'name': 'event_broadcaster', 'range': [155, 155]}, {'type': 'Punctuator', 'name': '(', 'range': [156, 156]}, {'type': 'Identifier', 'name': 'manager', 'range': [157, 157]}, {'type': 'Punctuator', 'name': ')', 'range': [158, 158]}]}, {'type': 'Punctuator', 'name': ')', 'range': [159, 159]}]}]}, {'type': 'ExpressionStatement', 'range': [161, 174], 'children': [{'type': 'CallExpression', 'range': [161, 174], 'children': [{'type': 'MemberExpression', 'range': [161, 163], 'children': [{'type': 'Identifier', 'name': 'fut', 'range': [161, 161]}, {'type': 'Punctuator', 'name': '.', 'range': [162, 162]}, {'type': 'Identifier', 'name': 'add_done_callback', 'range': [163, 163]}]}, {'type': 'Punctuator', 'name': '(', 'range': [164, 164]}, {'type': 'LambdaExpression', 'range': [165, 173], 'children': [{'type': 'Keyword', 'name': 'lambda', 'range': [165, 165]}, {'type': 'Identifier', 'name': '_', 'range': [166, 166]}, {'type': 'Punctuator', 'name': ':', 'range': [167, 167]}, {'type': 'CallExpression', 'range': [168, 173], 'children': [{'type': 'MemberExpression', 'range': [168, 170], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [168, 168]}, {'type': 'Punctuator', 'name': '.', 'range': [169, 169]}, {'type': 'Identifier', 'name': 'info', 'range': [170, 170]}]}, {'type': 'Punctuator', 'name': '(', 'range': [171, 171]}, {'type': 'StringLiteral', 'value': '"Event broadcaster stopped"', 'range': [172, 172]}, {'type': 'Punctuator', 'name': ')', 'range': [173, 173]}]}]}, {'type': 'Punctuator', 'name': ')', 'range': [174, 174]}]}]}, {'type': 'Keyword', 'name': 'yield', 'range': [176, 176]}]}]}]}
2025-01-08 10:28:49,588 - INFO - Starting Step 3: AST simplification
2025-01-08 10:28:52,097 - INFO - Step 4 result: {'type': 'Program', 'name': 'get_connection_manager', 'range': [216, 239], 'children': [{'type': 'FunctionDecl', 'name': 'get_connection_manager', 'range': [216, 239], 'children': [{'type': 'FunctionSignature', 'name': 'get_connection_manager', 'range': [216, 220], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [216, 216], 'children': []}, {'type': 'Identifier', 'name': 'get_connection_manager', 'range': [217, 217], 'children': []}]}, {'type': 'FunctionBody', 'name': 'get_connection_manager', 'range': [221, 239], 'children': [{'type': 'GlobalStatement', 'name': 'global', 'range': [222, 224], 'children': [{'type': 'Keyword', 'name': 'global', 'range': [222, 222], 'children': []}, {'type': 'Identifier', 'name': '_connection_manager', 'range': [223, 223], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [225, 236], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [225, 225], 'children': []}, {'type': 'BinaryExpression', 'name': '_connection_manager is None', 'range': [226, 229], 'children': [{'type': 'Identifier', 'name': '_connection_manager', 'range': [226, 226], 'children': []}, {'type': 'Keyword', 'name': 'is', 'range': [227, 227], 'children': []}, {'type': 'Literal', 'name': 'None', 'range': [228, 228], 'children': []}]}, {'type': 'Assignment', 'name': '_connection_manager = ConnectionManager()', 'range': [231, 235], 'children': [{'type': 'Identifier', 'name': '_connection_manager', 'range': [231, 231], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [232, 232], 'children': []}, {'type': 'NewExpression', 'name': 'ConnectionManager()', 'range': [233, 235], 'children': [{'type': 'Identifier', 'name': 'ConnectionManager', 'range': [233, 233], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [237, 239], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [237, 237], 'children': []}, {'type': 'Identifier', 'name': '_connection_manager', 'range': [238, 238], 'children': []}]}]}]}]}
2025-01-08 10:28:52,097 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:54,723 - INFO - Step 4 result: {'nodes': [{'type': 'VariableDeclaration', 'name': 'docs_url', 'range': [180, 182], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [181, 182], 'children': [{'type': 'Literal', 'name': '"/docs"', 'range': [182, 182], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [183, 195], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [189, 190], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [185, 188], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [185, 186], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [184, 184], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [186, 186], 'children': []}]}, {'type': 'Identifier', 'name': 'app_env', 'range': [188, 188], 'children': []}]}, {'type': 'MemberExpression', 'name': '.', 'range': [192, 193], 'children': [{'type': 'Identifier', 'name': 'AppEnvironment', 'range': [191, 191], 'children': []}, {'type': 'Identifier', 'name': 'LOCAL', 'range': [193, 193], 'children': []}]}]}, {'type': 'Literal', 'name': 'None', 'range': [195, 195], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'app', 'range': [197, 208], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [198, 208], 'children': [{'type': 'NewExpression', 'name': 'FastAPI', 'range': [199, 208], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [200, 208], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [202, 203], 'children': [{'type': 'Identifier', 'name': 'lifespan', 'range': [203, 203], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [206, 207], 'children': [{'type': 'Identifier', 'name': 'docs_url', 'range': [207, 207], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': '_connection_manager', 'range': [210, 212], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [211, 212], 'children': [{'type': 'Literal', 'name': 'None', 'range': [212, 212], 'children': []}]}]}]}
2025-01-08 10:28:54,723 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:28:55,414 - INFO - Step 3 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'asynccontextmanager', 'range': [9, 9], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [12, 14], 'children': [{'type': 'ImportSpecifier', 'name': 'uvicorn', 'range': [13, 13], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [15, 21], 'children': [{'type': 'ImportSpecifier', 'name': 'parse_jwt_token', 'range': [20, 20], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [22, 32], 'children': [{'type': 'ImportSpecifier', 'name': 'Depends', 'range': [25, 25], 'children': []}, {'type': 'ImportSpecifier', 'name': 'FastAPI', 'range': [27, 27], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WebSocket', 'range': [29, 29], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WebSocketDisconnect', 'range': [31, 31], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [33, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'CORSMiddleware', 'range': [40, 40], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [43, 49], 'children': [{'type': 'ImportSpecifier', 'name': 'redis', 'range': [48, 48], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [50, 58], 'children': [{'type': 'ImportSpecifier', 'name': 'AsyncRedisExecutionEventBus', 'range': [57, 57], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [59, 67], 'children': [{'type': 'ImportSpecifier', 'name': 'DEFAULT_USER_ID', 'range': [66, 66], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [68, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'ConnectionManager', 'range': [75, 75], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [77, 89], 'children': [{'type': 'ImportSpecifier', 'name': 'ExecutionSubscription', 'range': [84, 84], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Methods', 'range': [86, 86], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WsMessage', 'range': [88, 88], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [90, 98], 'children': [{'type': 'ImportSpecifier', 'name': 'AppProcess', 'range': [97, 97], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [99, 111], 'children': [{'type': 'ImportSpecifier', 'name': 'AppEnvironment', 'range': [106, 106], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Config', 'range': [108, 108], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Settings', 'range': [110, 110], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [113, 121], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [114, 120], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [117, 120], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [119, 119], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'settings', 'range': [122, 127], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [123, 126], 'children': [{'type': 'NewExpression', 'name': 'Settings', 'range': [124, 126], 'children': []}]}]}]}
2025-01-08 10:28:55,415 - INFO - Starting Step 4: AST normalization
2025-01-08 10:28:57,716 - INFO - Step 2 result: {'type': 'Program', 'name': 'authenticate_websocket', 'range': [311, 436], 'children': [{'type': 'FunctionDeclaration', 'name': 'authenticate_websocket', 'range': [311, 436], 'children': [{'type': 'FunctionSignature', 'name': 'authenticate_websocket', 'range': [311, 322], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [311, 315], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [312, 315], 'children': []}, {'type': 'Identifier', 'name': 'authenticate_websocket', 'range': [313, 333], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [314, 318], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [315, 318], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [315, 323], 'children': []}, {'type': 'TypeAnnotation', 'name': '', 'range': [316, 318], 'children': [{'type': 'Identifier', 'name': 'WebSocket', 'range': [317, 325], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [319, 322], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [321, 324], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [323, 436], 'children': [{'type': 'IfStatement', 'name': '', 'range': [324, 335], 'children': [{'type': 'Condition', 'name': '', 'range': [324, 331], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [325, 331], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [326, 330], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [326, 333], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [328, 334], 'children': []}, {'type': 'Identifier', 'name': 'enable_auth', 'range': [330, 341], 'children': []}]}]}]}, {'type': 'Block', 'name': '', 'range': [332, 335], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [333, 335], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [334, 348], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'token', 'range': [337, 347], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [338, 347], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [339, 343], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [339, 347], 'children': []}, {'type': 'Identifier', 'name': 'query_params', 'range': [341, 353], 'children': []}, {'type': 'CallExpression', 'name': 'get', 'range': [343, 347], 'children': [{'type': 'StringLiteral', 'name': '"token"', 'range': [345, 351], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [348, 369], 'children': [{'type': 'Condition', 'name': '', 'range': [348, 351], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [349, 351], 'children': [{'type': 'Identifier', 'name': 'token', 'range': [350, 354], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [352, 369], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [353, 366], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [353, 366], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [356, 366], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [354, 356], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [354, 362], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [357, 365], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [358, 360], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [358, 362], 'children': []}, {'type': 'NumericLiteral', 'name': '4001', 'range': [360, 364], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [362, 364], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [362, 368], 'children': []}, {'type': 'StringLiteral', 'name': '"Missing authentication token"', 'range': [364, 394], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [367, 369], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [368, 370], 'children': []}]}]}]}, {'type': 'TryStatement', 'name': '', 'range': [371, 435], 'children': [{'type': 'Block', 'name': '', 'range': [373, 414], 'children': [{'type': 'VariableDeclaration', 'name': 'payload', 'range': [374, 380], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [375, 380], 'children': [{'type': 'CallExpression', 'name': 'parse_jwt_token', 'range': [376, 380], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [377, 379], 'children': [{'type': 'Identifier', 'name': 'token', 'range': [378, 382], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'user_id', 'range': [381, 389], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [382, 389], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [385, 389], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [383, 385], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [383, 389], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [386, 388], 'children': [{'type': 'StringLiteral', 'name': '"sub"', 'range': [387, 391], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [390, 411], 'children': [{'type': 'Condition', 'name': '', 'range': [390, 393], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [391, 393], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [392, 398], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [394, 411], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [395, 408], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [395, 408], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [398, 408], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [396, 398], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [396, 404], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [399, 407], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [400, 402], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [400, 404], 'children': []}, {'type': 'NumericLiteral', 'name': '4002', 'range': [402, 406], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [404, 406], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [404, 410], 'children': []}, {'type': 'StringLiteral', 'name': '"Invalid token"', 'range': [406, 420], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [409, 411], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [410, 412], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [412, 414], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [413, 419], 'children': []}]}]}, {'type': 'CatchClause', 'name': '', 'range': [415, 435], 'children': [{'type': 'Block', 'name': '', 'range': [418, 435], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [419, 432], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [419, 432], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [422, 432], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [420, 422], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [420, 428], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [423, 431], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [424, 426], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [424, 428], 'children': []}, {'type': 'NumericLiteral', 'name': '4003', 'range': [426, 430], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [428, 430], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [428, 434], 'children': []}, {'type': 'StringLiteral', 'name': '"Invalid token"', 'range': [430, 444], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [433, 435], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [434, 436], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:28:57,717 - INFO - Starting Step 3: AST simplification
2025-01-08 10:29:07,494 - INFO - Step 5 result: {'type': 'Program', 'name': 'get_connection_manager', 'range': [216, 239], 'children': [{'type': 'FunctionDecl', 'name': 'get_connection_manager', 'range': [216, 239], 'children': [{'type': 'FunctionSignature', 'name': 'get_connection_manager', 'range': [216, 220], 'children': [{'type': 'Keyword', 'name': 'def', 'range': [216, 216], 'children': []}, {'type': 'Identifier', 'name': 'get_connection_manager', 'range': [217, 217], 'children': []}]}, {'type': 'FunctionBody', 'name': 'get_connection_manager', 'range': [221, 239], 'children': [{'type': 'GlobalStatement', 'name': 'global', 'range': [222, 224], 'children': [{'type': 'Keyword', 'name': 'global', 'range': [222, 222], 'children': []}, {'type': 'Identifier', 'name': '_connection_manager', 'range': [223, 223], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [225, 236], 'children': [{'type': 'Keyword', 'name': 'if', 'range': [225, 225], 'children': []}, {'type': 'BinaryExpression', 'name': '_connection_manager is None', 'range': [226, 229], 'children': [{'type': 'Identifier', 'name': '_connection_manager', 'range': [226, 226], 'children': []}, {'type': 'Keyword', 'name': 'is', 'range': [227, 227], 'children': []}, {'type': 'Literal', 'name': 'None', 'range': [228, 228], 'children': []}]}, {'type': 'Assignment', 'name': '_connection_manager = ConnectionManager()', 'range': [231, 235], 'children': [{'type': 'Identifier', 'name': '_connection_manager', 'range': [231, 231], 'children': []}, {'type': 'Operator', 'name': '=', 'range': [232, 232], 'children': []}, {'type': 'NewExpression', 'name': 'ConnectionManager()', 'range': [233, 235], 'children': [{'type': 'Identifier', 'name': 'ConnectionManager', 'range': [233, 233], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': 'return', 'range': [237, 239], 'children': [{'type': 'Keyword', 'name': 'return', 'range': [237, 237], 'children': []}, {'type': 'Identifier', 'name': '_connection_manager', 'range': [238, 238], 'children': []}]}]}]}]}
2025-01-08 10:29:07,494 - INFO - Completed main AST analysis flow
2025-01-08 10:29:07,494 - INFO - Successfully processed chunk
2025-01-08 10:29:08,510 - INFO - Step 4 result: {'type': 'Program', 'name': 'handle_subscribe', 'range': [437, 568], 'children': [{'type': 'FunctionDecl', 'name': 'handle_subscribe', 'range': [437, 568], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [440, 454], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [442, 444], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [446, 448], 'children': []}, {'type': 'Parameter', 'name': 'message', 'range': [450, 452], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [456, 568], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [457, 497], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [458, 462], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [459, 461], 'children': []}]}, {'type': 'BlockStatement', 'name': 'consequent', 'range': [463, 497], 'children': [{'type': 'ExpressionStatement', 'name': 'await', 'range': [464, 496], 'children': [{'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [465, 496], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [470, 490], 'children': [{'type': 'AssignmentExpression', 'name': 'method', 'range': [473, 477], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success', 'range': [480, 482], 'children': []}, {'type': 'AssignmentExpression', 'name': 'error', 'range': [485, 487], 'children': []}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [492, 494], 'children': []}]}]}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [498, 568], 'children': [{'type': 'BlockStatement', 'name': 'alternate', 'range': [500, 568], 'children': [{'type': 'VariableDeclaration', 'name': 'ex_sub', 'range': [501, 511], 'children': [{'type': 'CallExpression', 'name': 'ExecutionSubscription.model_validate', 'range': [503, 510], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [507, 509], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'await', 'range': [512, 523], 'children': [{'type': 'CallExpression', 'name': 'manager.subscribe', 'range': [513, 522], 'children': [{'type': 'MemberExpression', 'name': 'ex_sub.graph_id', 'range': [517, 519], 'children': []}, {'type': 'Identifier', 'name': 'websocket', 'range': [521, 521], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [524, 531], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [528, 529], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'await', 'range': [532, 567], 'children': [{'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [533, 567], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [538, 560], 'children': [{'type': 'AssignmentExpression', 'name': 'method', 'range': [541, 545], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success', 'range': [548, 550], 'children': []}, {'type': 'AssignmentExpression', 'name': 'channel', 'range': [553, 558], 'children': []}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [562, 564], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:08,510 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:09,106 - INFO - Step 3 result: {'type': 'Program', 'name': 'event_broadcaster', 'range': [241, 310], 'children': [{'type': 'FunctionDeclaration', 'name': 'event_broadcaster', 'range': [241, 310], 'children': [{'type': 'BlockStatement', 'range': [249, 310], 'children': [{'type': 'TryStatement', 'range': [251, 310], 'children': [{'type': 'BlockStatement', 'range': [252, 284], 'children': [{'type': 'ExpressionStatement', 'range': [254, 258], 'children': [{'type': 'CallExpression', 'range': [254, 258], 'children': [{'type': 'MemberExpression', 'range': [254, 256], 'children': [{'type': 'Identifier', 'name': 'redis', 'range': [254, 254]}, {'type': 'Identifier', 'name': 'connect', 'range': [256, 256]}]}]}]}, {'type': 'ExpressionStatement', 'range': [260, 264], 'children': [{'type': 'AssignmentExpression', 'range': [260, 264], 'children': [{'type': 'Identifier', 'name': 'event_queue', 'range': [260, 260]}, {'type': 'NewExpression', 'range': [262, 264], 'children': [{'type': 'Identifier', 'name': 'AsyncRedisExecutionEventBus', 'range': [262, 262]}]}]}]}, {'type': 'ForStatement', 'range': [266, 284], 'children': [{'type': 'VariableDeclaration', 'range': [268, 268], 'children': [{'type': 'VariableDeclarator', 'range': [268, 268], 'children': [{'type': 'Identifier', 'name': 'event', 'range': [268, 268]}]}]}, {'type': 'CallExpression', 'range': [270, 274], 'children': [{'type': 'MemberExpression', 'range': [270, 272], 'children': [{'type': 'Identifier', 'name': 'event_queue', 'range': [270, 270]}, {'type': 'Identifier', 'name': 'listen', 'range': [272, 272]}]}]}, {'type': 'BlockStatement', 'range': [275, 284], 'children': [{'type': 'ExpressionStatement', 'range': [277, 283], 'children': [{'type': 'AwaitExpression', 'range': [277, 283], 'children': [{'type': 'CallExpression', 'range': [278, 283], 'children': [{'type': 'MemberExpression', 'range': [278, 280], 'children': [{'type': 'Identifier', 'name': 'manager', 'range': [278, 278]}, {'type': 'Identifier', 'name': 'send_execution_result', 'range': [280, 280]}]}, {'type': 'Identifier', 'name': 'event', 'range': [282, 282]}]}]}]}]}]}]}, {'type': 'CatchClause', 'range': [285, 300], 'children': [{'type': 'BlockStatement', 'range': [289, 300], 'children': [{'type': 'ExpressionStatement', 'range': [291, 297], 'children': [{'type': 'CallExpression', 'range': [291, 297], 'children': [{'type': 'MemberExpression', 'range': [291, 293], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [291, 291]}, {'type': 'Identifier', 'name': 'exception', 'range': [293, 293]}]}, {'type': 'TemplateLiteral', 'range': [295, 296], 'children': [{'type': 'TemplateElement', 'value': 'Event broadcaster error: ', 'range': [295, 295]}, {'type': 'Identifier', 'name': 'e', 'range': [296, 296]}]}]}]}, {'type': 'ThrowStatement', 'range': [299, 300], 'children': []}]}]}, {'type': 'FinallyClause', 'range': [301, 310], 'children': [{'type': 'BlockStatement', 'range': [302, 310], 'children': [{'type': 'ExpressionStatement', 'range': [304, 308], 'children': [{'type': 'CallExpression', 'range': [304, 308], 'children': [{'type': 'MemberExpression', 'range': [304, 306], 'children': [{'type': 'Identifier', 'name': 'redis', 'range': [304, 304]}, {'type': 'Identifier', 'name': 'disconnect', 'range': [306, 306]}]}]}]}]}]}]}]}]}]}
2025-01-08 10:29:09,107 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:09,227 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [975, 1065], 'children': [{'type': 'ClassDecl', 'name': 'WebsocketServer', 'range': [975, 979], 'children': [{'type': 'FunctionDecl', 'name': 'run', 'range': [982, 1064], 'children': [{'type': 'BlockStatement', 'name': '', 'range': [988, 1064], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [989, 996], 'children': [{'type': 'CallExpression', 'name': 'logger.info', 'range': [989, 995], 'children': [{'type': 'Literal', 'name': '"CORS allow origins: {settings.config.backend_cors_allow_origins}"', 'range': [993, 994], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'server_app', 'range': [997, 1035], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [997, 1035], 'children': [{'type': 'Identifier', 'name': 'server_app', 'range': [997, 1006], 'children': []}, {'type': 'NewExpression', 'name': 'CORSMiddleware', 'range': [999, 1035], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1000, 1035], 'children': [{'type': 'Property', 'name': 'app', 'range': [1002, 1005], 'children': [{'type': 'Identifier', 'name': 'app', 'range': [1004, 1004], 'children': []}]}, {'type': 'Property', 'name': 'allow_origins', 'range': [1007, 1014], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.backend_cors_allow_origins', 'range': [1009, 1013], 'children': []}]}, {'type': 'Property', 'name': 'allow_credentials', 'range': [1016, 1019], 'children': [{'type': 'Literal', 'name': 'True', 'range': [1018, 1018], 'children': []}]}, {'type': 'Property', 'name': 'allow_methods', 'range': [1021, 1026], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1023, 1025], 'children': [{'type': 'Literal', 'name': '"*"', 'range': [1024, 1024], 'children': []}]}]}, {'type': 'Property', 'name': 'allow_headers', 'range': [1028, 1033], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1030, 1032], 'children': [{'type': 'Literal', 'name': '"*"', 'range': [1031, 1031], 'children': []}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1037, 1063], 'children': [{'type': 'CallExpression', 'name': 'uvicorn.run', 'range': [1037, 1063], 'children': [{'type': 'Identifier', 'name': 'server_app', 'range': [1042, 1043], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [1045, 1061], 'children': [{'type': 'Property', 'name': 'host', 'range': [1045, 1052], 'children': [{'type': 'MemberExpression', 'name': 'Config().websocket_server_host', 'range': [1047, 1051], 'children': []}]}, {'type': 'Property', 'name': 'port', 'range': [1054, 1061], 'children': [{'type': 'MemberExpression', 'name': 'Config().websocket_server_port', 'range': [1056, 1060], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:29:09,227 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:10,545 - INFO - Step 3 result: {'type': 'Program', 'name': 'lifespan', 'range': [130, 178], 'children': [{'type': 'FunctionDeclaration', 'name': 'lifespan', 'range': [130, 178], 'children': [{'type': 'Decorator', 'name': '@asynccontextmanager', 'range': [130, 131]}, {'type': 'Keyword', 'name': 'async', 'range': [133, 133]}, {'type': 'Keyword', 'name': 'def', 'range': [134, 134]}, {'type': 'Identifier', 'name': 'lifespan', 'range': [135, 135]}, {'type': 'Identifier', 'name': 'app', 'range': [137, 137]}, {'type': 'Identifier', 'name': 'FastAPI', 'range': [139, 139]}, {'type': 'BlockStatement', 'range': [142, 178], 'children': [{'type': 'VariableDeclaration', 'range': [143, 147], 'children': [{'type': 'Identifier', 'name': 'manager', 'range': [143, 143]}, {'type': 'CallExpression', 'range': [145, 147], 'children': [{'type': 'Identifier', 'name': 'get_connection_manager', 'range': [145, 145]}]}]}, {'type': 'VariableDeclaration', 'range': [149, 159], 'children': [{'type': 'Identifier', 'name': 'fut', 'range': [149, 149]}, {'type': 'CallExpression', 'range': [151, 159], 'children': [{'type': 'MemberExpression', 'range': [151, 153], 'children': [{'type': 'Identifier', 'name': 'asyncio', 'range': [151, 151]}, {'type': 'Identifier', 'name': 'create_task', 'range': [153, 153]}]}, {'type': 'CallExpression', 'range': [155, 158], 'children': [{'type': 'Identifier', 'name': 'event_broadcaster', 'range': [155, 155]}, {'type': 'Identifier', 'name': 'manager', 'range': [157, 157]}]}]}]}, {'type': 'ExpressionStatement', 'range': [161, 174], 'children': [{'type': 'CallExpression', 'range': [161, 174], 'children': [{'type': 'MemberExpression', 'range': [161, 163], 'children': [{'type': 'Identifier', 'name': 'fut', 'range': [161, 161]}, {'type': 'Identifier', 'name': 'add_done_callback', 'range': [163, 163]}]}, {'type': 'LambdaExpression', 'range': [165, 173], 'children': [{'type': 'Keyword', 'name': 'lambda', 'range': [165, 165]}, {'type': 'Identifier', 'name': '_', 'range': [166, 166]}, {'type': 'CallExpression', 'range': [168, 173], 'children': [{'type': 'MemberExpression', 'range': [168, 170], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [168, 168]}, {'type': 'Identifier', 'name': 'info', 'range': [170, 170]}]}, {'type': 'StringLiteral', 'value': '"Event broadcaster stopped"', 'range': [172, 172]}]}]}]}]}, {'type': 'Keyword', 'name': 'yield', 'range': [176, 176]}]}]}]}
2025-01-08 10:29:10,545 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:12,657 - INFO - Step 3 result: {'type': 'Program', 'name': 'websocket_router', 'range': [731, 974], 'children': [{'type': 'FunctionDeclaration', 'name': 'websocket_router', 'range': [731, 974], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [736, 738], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [740, 742], 'children': []}, {'type': 'Assignment', 'name': 'user_id', 'range': [752, 758], 'children': [{'type': 'FunctionCall', 'name': 'authenticate_websocket', 'range': [755, 758], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [757, 757], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [760, 766], 'children': [{'type': 'Condition', 'name': 'not user_id', 'range': [761, 762], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [765, 765], 'children': []}]}, {'type': 'FunctionCall', 'name': 'manager.connect', 'range': [768, 773], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [772, 772], 'children': []}]}, {'type': 'TryStatement', 'name': 'try', 'range': [775, 973], 'children': [{'type': 'WhileLoop', 'name': 'while', 'range': [778, 955], 'children': [{'type': 'Assignment', 'name': 'data', 'range': [782, 789], 'children': [{'type': 'FunctionCall', 'name': 'websocket.receive_text', 'range': [785, 789], 'children': []}]}, {'type': 'Assignment', 'name': 'message', 'range': [791, 798], 'children': [{'type': 'FunctionCall', 'name': 'WsMessage.model_validate_json', 'range': [793, 798], 'children': [{'type': 'Argument', 'name': 'data', 'range': [797, 797], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [801, 839], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.HEARTBEAT', 'range': [802, 809], 'children': []}, {'type': 'FunctionCall', 'name': 'websocket.send_json', 'range': [813, 836], 'children': [{'type': 'Argument', 'name': '{"method": Methods.HEARTBEAT.value, "data": "pong", "success": True}', 'range': [817, 834], 'children': []}]}, {'type': 'ContinueStatement', 'name': 'continue', 'range': [838, 838], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [841, 861], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.SUBSCRIBE', 'range': [842, 849], 'children': []}, {'type': 'FunctionCall', 'name': 'handle_subscribe', 'range': [853, 860], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [855, 855], 'children': []}, {'type': 'Argument', 'name': 'manager', 'range': [857, 857], 'children': []}, {'type': 'Argument', 'name': 'message', 'range': [859, 859], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'elif', 'range': [863, 883], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.UNSUBSCRIBE', 'range': [864, 871], 'children': []}, {'type': 'FunctionCall', 'name': 'handle_unsubscribe', 'range': [875, 882], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [877, 877], 'children': []}, {'type': 'Argument', 'name': 'manager', 'range': [879, 879], 'children': []}, {'type': 'Argument', 'name': 'message', 'range': [881, 881], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'elif', 'range': [885, 904], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.ERROR', 'range': [886, 893], 'children': []}, {'type': 'FunctionCall', 'name': 'logger.error', 'range': [896, 902], 'children': [{'type': 'Argument', 'name': 'f"WebSocket Error message received: {message.data}"', 'range': [900, 901], 'children': []}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [905, 954], 'children': [{'type': 'FunctionCall', 'name': 'logger.warning', 'range': [908, 919], 'children': [{'type': 'Argument', 'name': 'f"Unknown WebSocket message type {message.method} received: "', 'range': [913, 914], 'children': []}, {'type': 'Argument', 'name': 'f"{message.data}"', 'range': [916, 917], 'children': []}]}, {'type': 'FunctionCall', 'name': 'websocket.send_text', 'range': [921, 953], 'children': [{'type': 'Argument', 'name': 'WsMessage(method=Methods.ERROR, success=False, error="Message type is not processed by the server").model_dump_json()', 'range': [927, 951], 'children': []}]}]}]}, {'type': 'ExceptStatement', 'name': 'except', 'range': [956, 973], 'children': [{'type': 'Exception', 'name': 'WebSocketDisconnect', 'range': [957, 957], 'children': []}, {'type': 'FunctionCall', 'name': 'manager.disconnect', 'range': [960, 965], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [964, 964], 'children': []}]}, {'type': 'FunctionCall', 'name': 'logger.debug', 'range': [967, 972], 'children': [{'type': 'Argument', 'name': '"WebSocket client disconnected"', 'range': [971, 971], 'children': []}]}]}]}]}]}
2025-01-08 10:29:12,658 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:12,681 - INFO - Step 5 result: {'nodes': [{'type': 'Program', 'name': 'MainProgram', 'range': [180, 212], 'children': [{'type': 'VariableDeclaration', 'name': 'docs_url', 'range': [180, 182], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [181, 182], 'children': [{'type': 'Literal', 'name': '"/docs"', 'range': [182, 182], 'children': []}]}]}, {'type': 'IfStatement', 'name': '', 'range': [183, 195], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [189, 190], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [185, 188], 'children': [{'type': 'MemberExpression', 'name': '.', 'range': [185, 186], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [184, 184], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [186, 186], 'children': []}]}, {'type': 'Identifier', 'name': 'app_env', 'range': [188, 188], 'children': []}]}, {'type': 'MemberExpression', 'name': '.', 'range': [192, 193], 'children': [{'type': 'Identifier', 'name': 'AppEnvironment', 'range': [191, 191], 'children': []}, {'type': 'Identifier', 'name': 'LOCAL', 'range': [193, 193], 'children': []}]}]}, {'type': 'Literal', 'name': 'None', 'range': [195, 195], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'app', 'range': [197, 208], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [198, 208], 'children': [{'type': 'NewExpression', 'name': 'FastAPI', 'range': [199, 208], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [200, 208], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [202, 203], 'children': [{'type': 'Identifier', 'name': 'lifespan', 'range': [203, 203], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [206, 207], 'children': [{'type': 'Identifier', 'name': 'docs_url', 'range': [207, 207], 'children': []}]}]}]}]}]}, {'type': 'VariableDeclaration', 'name': '_connection_manager', 'range': [210, 212], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [211, 212], 'children': [{'type': 'Literal', 'name': 'None', 'range': [212, 212], 'children': []}]}]}]}]}
2025-01-08 10:29:12,681 - INFO - Completed main AST analysis flow
2025-01-08 10:29:12,682 - INFO - Successfully processed chunk
2025-01-08 10:29:15,562 - INFO - Step 3 result: {'type': 'Program', 'name': 'handle_unsubscribe', 'range': [569, 700], 'children': [{'type': 'FunctionDeclaration', 'name': 'handle_unsubscribe', 'range': [569, 700], 'children': [{'type': 'FunctionSignature', 'name': 'handle_unsubscribe', 'range': [569, 587], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [569, 573], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [570, 573], 'children': []}, {'type': 'Identifier', 'name': 'handle_unsubscribe', 'range': [571, 587], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [572, 586], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [574, 576], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [578, 580], 'children': []}, {'type': 'Parameter', 'name': 'message', 'range': [582, 584], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [588, 700], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [589, 629], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [589, 594], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [590, 591], 'children': []}, {'type': 'MemberExpression', 'name': 'message.data', 'range': [591, 593], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [595, 629], 'children': [{'type': 'ExpressionStatement', 'name': 'await websocket.send_text', 'range': [596, 628], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [596, 597], 'children': []}, {'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [597, 628], 'children': [{'type': 'MemberExpression', 'name': 'websocket.send_text', 'range': [597, 599], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [600, 627], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [602, 622], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [603, 621], 'children': [{'type': 'AssignmentExpression', 'name': 'method=Methods.ERROR', 'range': [605, 609], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success=False', 'range': [612, 614], 'children': []}, {'type': 'AssignmentExpression', 'name': 'error="Subscription data missing"', 'range': [617, 619], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [623, 626], 'children': []}]}]}]}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [630, 700], 'children': [{'type': 'Block', 'name': 'alternate', 'range': [632, 700], 'children': [{'type': 'VariableDeclaration', 'name': 'ex_sub', 'range': [633, 643], 'children': [{'type': 'AssignmentExpression', 'name': 'ex_sub=ExecutionSubscription.model_validate', 'range': [634, 642], 'children': [{'type': 'CallExpression', 'name': 'ExecutionSubscription.model_validate', 'range': [635, 642], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [639, 641], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'await manager.unsubscribe', 'range': [644, 655], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [644, 645], 'children': []}, {'type': 'CallExpression', 'name': 'manager.unsubscribe', 'range': [645, 655], 'children': [{'type': 'MemberExpression', 'name': 'manager.unsubscribe', 'range': [645, 647], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [648, 654], 'children': [{'type': 'MemberExpression', 'name': 'ex_sub.graph_id', 'range': [649, 651], 'children': []}, {'type': 'Identifier', 'name': 'websocket', 'range': [653, 654], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [656, 663], 'children': [{'type': 'CallExpression', 'name': 'logger.debug', 'range': [656, 663], 'children': [{'type': 'MemberExpression', 'name': 'logger.debug', 'range': [656, 658], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [659, 662], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Removed execution subscription for graph {ex_sub.graph_id}"', 'range': [660, 661], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'await websocket.send_text', 'range': [664, 699], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [664, 665], 'children': []}, {'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [665, 699], 'children': [{'type': 'MemberExpression', 'name': 'websocket.send_text', 'range': [665, 667], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [668, 698], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [670, 692], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [671, 691], 'children': [{'type': 'AssignmentExpression', 'name': 'method=Methods.UNSUBSCRIBE', 'range': [673, 677], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success=True', 'range': [680, 682], 'children': []}, {'type': 'AssignmentExpression', 'name': 'channel=ex_sub.graph_id', 'range': [685, 689], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [693, 696], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:29:15,562 - INFO - Starting Step 4: AST normalization
2025-01-08 10:29:24,081 - INFO - Step 4 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'asynccontextmanager', 'range': [9, 9], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [12, 14], 'children': [{'type': 'ImportSpecifier', 'name': 'uvicorn', 'range': [13, 13], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [15, 21], 'children': [{'type': 'ImportSpecifier', 'name': 'parse_jwt_token', 'range': [20, 20], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [22, 32], 'children': [{'type': 'ImportSpecifier', 'name': 'Depends', 'range': [25, 25], 'children': []}, {'type': 'ImportSpecifier', 'name': 'FastAPI', 'range': [27, 27], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WebSocket', 'range': [29, 29], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WebSocketDisconnect', 'range': [31, 31], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [33, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'CORSMiddleware', 'range': [40, 40], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [43, 49], 'children': [{'type': 'ImportSpecifier', 'name': 'redis', 'range': [48, 48], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [50, 58], 'children': [{'type': 'ImportSpecifier', 'name': 'AsyncRedisExecutionEventBus', 'range': [57, 57], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [59, 67], 'children': [{'type': 'ImportSpecifier', 'name': 'DEFAULT_USER_ID', 'range': [66, 66], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [68, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'ConnectionManager', 'range': [75, 75], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [77, 89], 'children': [{'type': 'ImportSpecifier', 'name': 'ExecutionSubscription', 'range': [84, 84], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Methods', 'range': [86, 86], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WsMessage', 'range': [88, 88], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [90, 98], 'children': [{'type': 'ImportSpecifier', 'name': 'AppProcess', 'range': [97, 97], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [99, 111], 'children': [{'type': 'ImportSpecifier', 'name': 'AppEnvironment', 'range': [106, 106], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Config', 'range': [108, 108], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Settings', 'range': [110, 110], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [113, 121], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [114, 120], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [117, 120], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [119, 119], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'settings', 'range': [122, 127], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [123, 126], 'children': [{'type': 'NewExpression', 'name': 'Settings', 'range': [124, 126], 'children': []}]}]}]}
2025-01-08 10:29:24,081 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:31,894 - INFO - Step 4 result: {'type': 'Program', 'name': 'lifespan', 'range': [130, 178], 'children': [{'type': 'FunctionDecl', 'name': 'lifespan', 'range': [130, 178], 'children': [{'type': 'Decorator', 'name': '@asynccontextmanager', 'range': [130, 131]}, {'type': 'Keyword', 'name': 'async', 'range': [133, 133]}, {'type': 'Keyword', 'name': 'def', 'range': [134, 134]}, {'type': 'Identifier', 'name': 'lifespan', 'range': [135, 135]}, {'type': 'Identifier', 'name': 'app', 'range': [137, 137]}, {'type': 'Identifier', 'name': 'FastAPI', 'range': [139, 139]}, {'type': 'BlockStatement', 'range': [142, 178], 'children': [{'type': 'VariableDecl', 'range': [143, 147], 'children': [{'type': 'Identifier', 'name': 'manager', 'range': [143, 143]}, {'type': 'CallExpression', 'range': [145, 147], 'children': [{'type': 'Identifier', 'name': 'get_connection_manager', 'range': [145, 145]}]}]}, {'type': 'VariableDecl', 'range': [149, 159], 'children': [{'type': 'Identifier', 'name': 'fut', 'range': [149, 149]}, {'type': 'CallExpression', 'range': [151, 159], 'children': [{'type': 'MemberExpression', 'range': [151, 153], 'children': [{'type': 'Identifier', 'name': 'asyncio', 'range': [151, 151]}, {'type': 'Identifier', 'name': 'create_task', 'range': [153, 153]}]}, {'type': 'CallExpression', 'range': [155, 158], 'children': [{'type': 'Identifier', 'name': 'event_broadcaster', 'range': [155, 155]}, {'type': 'Identifier', 'name': 'manager', 'range': [157, 157]}]}]}]}, {'type': 'ExpressionStatement', 'range': [161, 174], 'children': [{'type': 'CallExpression', 'range': [161, 174], 'children': [{'type': 'MemberExpression', 'range': [161, 163], 'children': [{'type': 'Identifier', 'name': 'fut', 'range': [161, 161]}, {'type': 'Identifier', 'name': 'add_done_callback', 'range': [163, 163]}]}, {'type': 'LambdaExpression', 'range': [165, 173], 'children': [{'type': 'Keyword', 'name': 'lambda', 'range': [165, 165]}, {'type': 'Identifier', 'name': '_', 'range': [166, 166]}, {'type': 'CallExpression', 'range': [168, 173], 'children': [{'type': 'MemberExpression', 'range': [168, 170], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [168, 168]}, {'type': 'Identifier', 'name': 'info', 'range': [170, 170]}]}, {'type': 'Literal', 'value': '"Event broadcaster stopped"', 'range': [172, 172]}]}]}]}]}, {'type': 'Keyword', 'name': 'yield', 'range': [176, 176]}]}]}]}
2025-01-08 10:29:31,894 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:32,487 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [975, 1065], 'children': [{'type': 'ClassDecl', 'name': 'WebsocketServer', 'range': [975, 979], 'children': [{'type': 'FunctionDecl', 'name': 'run', 'range': [982, 1064], 'children': [{'type': 'BlockStatement', 'name': '', 'range': [988, 1064], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [989, 996], 'children': [{'type': 'CallExpression', 'name': 'logger.info', 'range': [989, 995], 'children': [{'type': 'Literal', 'name': '"CORS allow origins: {settings.config.backend_cors_allow_origins}"', 'range': [993, 994], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'server_app', 'range': [997, 1035], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [997, 1035], 'children': [{'type': 'Identifier', 'name': 'server_app', 'range': [997, 1006], 'children': []}, {'type': 'NewExpression', 'name': 'CORSMiddleware', 'range': [999, 1035], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [1000, 1035], 'children': [{'type': 'Property', 'name': 'app', 'range': [1002, 1005], 'children': [{'type': 'Identifier', 'name': 'app', 'range': [1004, 1004], 'children': []}]}, {'type': 'Property', 'name': 'allow_origins', 'range': [1007, 1014], 'children': [{'type': 'MemberExpression', 'name': 'settings.config.backend_cors_allow_origins', 'range': [1009, 1013], 'children': []}]}, {'type': 'Property', 'name': 'allow_credentials', 'range': [1016, 1019], 'children': [{'type': 'Literal', 'name': 'True', 'range': [1018, 1018], 'children': []}]}, {'type': 'Property', 'name': 'allow_methods', 'range': [1021, 1026], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1023, 1025], 'children': [{'type': 'Literal', 'name': '"*"', 'range': [1024, 1024], 'children': []}]}]}, {'type': 'Property', 'name': 'allow_headers', 'range': [1028, 1033], 'children': [{'type': 'ArrayExpression', 'name': '', 'range': [1030, 1032], 'children': [{'type': 'Literal', 'name': '"*"', 'range': [1031, 1031], 'children': []}]}]}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [1037, 1063], 'children': [{'type': 'CallExpression', 'name': 'uvicorn.run', 'range': [1037, 1063], 'children': [{'type': 'Identifier', 'name': 'server_app', 'range': [1042, 1043], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [1045, 1061], 'children': [{'type': 'Property', 'name': 'host', 'range': [1045, 1052], 'children': [{'type': 'MemberExpression', 'name': 'Config().websocket_server_host', 'range': [1047, 1051], 'children': []}]}, {'type': 'Property', 'name': 'port', 'range': [1054, 1061], 'children': [{'type': 'MemberExpression', 'name': 'Config().websocket_server_port', 'range': [1056, 1060], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:29:32,488 - INFO - Completed main AST analysis flow
2025-01-08 10:29:32,489 - INFO - Successfully processed chunk
2025-01-08 10:29:33,485 - INFO - Step 5 result: {'type': 'Program', 'name': 'handle_subscribe', 'range': [437, 568], 'children': [{'type': 'FunctionDecl', 'name': 'handle_subscribe', 'range': [437, 568], 'children': [{'type': 'ParameterList', 'name': 'parameters', 'range': [440, 454], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [442, 444], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [446, 448], 'children': []}, {'type': 'Parameter', 'name': 'message', 'range': [450, 452], 'children': []}]}, {'type': 'BlockStatement', 'name': 'body', 'range': [456, 568], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [457, 497], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [458, 462], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [459, 461], 'children': []}]}, {'type': 'BlockStatement', 'name': 'consequent', 'range': [463, 497], 'children': [{'type': 'ExpressionStatement', 'name': 'await', 'range': [464, 496], 'children': [{'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [465, 496], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [470, 490], 'children': [{'type': 'AssignmentExpression', 'name': 'method', 'range': [473, 477], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success', 'range': [480, 482], 'children': []}, {'type': 'AssignmentExpression', 'name': 'error', 'range': [485, 487], 'children': []}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [492, 494], 'children': []}]}]}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [498, 568], 'children': [{'type': 'BlockStatement', 'name': 'alternate', 'range': [500, 568], 'children': [{'type': 'VariableDeclaration', 'name': 'ex_sub', 'range': [501, 511], 'children': [{'type': 'CallExpression', 'name': 'ExecutionSubscription.model_validate', 'range': [503, 510], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [507, 509], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'await', 'range': [512, 523], 'children': [{'type': 'CallExpression', 'name': 'manager.subscribe', 'range': [513, 522], 'children': [{'type': 'MemberExpression', 'name': 'ex_sub.graph_id', 'range': [517, 519], 'children': []}, {'type': 'Identifier', 'name': 'websocket', 'range': [521, 521], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [524, 531], 'children': [{'type': 'TemplateLiteral', 'name': 'f', 'range': [528, 529], 'children': []}]}, {'type': 'ExpressionStatement', 'name': 'await', 'range': [532, 567], 'children': [{'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [533, 567], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [538, 560], 'children': [{'type': 'AssignmentExpression', 'name': 'method', 'range': [541, 545], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success', 'range': [548, 550], 'children': []}, {'type': 'AssignmentExpression', 'name': 'channel', 'range': [553, 558], 'children': []}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [562, 564], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:29:33,486 - INFO - Completed main AST analysis flow
2025-01-08 10:29:33,486 - INFO - Successfully processed chunk
2025-01-08 10:29:36,639 - INFO - Step 4 result: {'type': 'Program', 'name': 'event_broadcaster', 'range': [241, 310], 'children': [{'type': 'FunctionDecl', 'name': 'event_broadcaster', 'range': [241, 310], 'children': [{'type': 'BlockStatement', 'range': [249, 310], 'children': [{'type': 'TryStatement', 'range': [251, 310], 'children': [{'type': 'BlockStatement', 'range': [252, 284], 'children': [{'type': 'ExpressionStatement', 'range': [254, 258], 'children': [{'type': 'CallExpression', 'range': [254, 258], 'children': [{'type': 'MemberExpression', 'range': [254, 256], 'children': [{'type': 'Identifier', 'name': 'redis', 'range': [254, 254]}, {'type': 'Identifier', 'name': 'connect', 'range': [256, 256]}]}]}]}, {'type': 'ExpressionStatement', 'range': [260, 264], 'children': [{'type': 'AssignmentExpression', 'range': [260, 264], 'children': [{'type': 'Identifier', 'name': 'event_queue', 'range': [260, 260]}, {'type': 'NewExpression', 'range': [262, 264], 'children': [{'type': 'Identifier', 'name': 'AsyncRedisExecutionEventBus', 'range': [262, 262]}]}]}]}, {'type': 'ForStatement', 'range': [266, 284], 'children': [{'type': 'VariableDeclaration', 'range': [268, 268], 'children': [{'type': 'VariableDeclarator', 'range': [268, 268], 'children': [{'type': 'Identifier', 'name': 'event', 'range': [268, 268]}]}]}, {'type': 'CallExpression', 'range': [270, 274], 'children': [{'type': 'MemberExpression', 'range': [270, 272], 'children': [{'type': 'Identifier', 'name': 'event_queue', 'range': [270, 270]}, {'type': 'Identifier', 'name': 'listen', 'range': [272, 272]}]}]}, {'type': 'BlockStatement', 'range': [275, 284], 'children': [{'type': 'ExpressionStatement', 'range': [277, 283], 'children': [{'type': 'AwaitExpression', 'range': [277, 283], 'children': [{'type': 'CallExpression', 'range': [278, 283], 'children': [{'type': 'MemberExpression', 'range': [278, 280], 'children': [{'type': 'Identifier', 'name': 'manager', 'range': [278, 278]}, {'type': 'Identifier', 'name': 'send_execution_result', 'range': [280, 280]}]}, {'type': 'Identifier', 'name': 'event', 'range': [282, 282]}]}]}]}]}]}]}, {'type': 'CatchClause', 'range': [285, 300], 'children': [{'type': 'BlockStatement', 'range': [289, 300], 'children': [{'type': 'ExpressionStatement', 'range': [291, 297], 'children': [{'type': 'CallExpression', 'range': [291, 297], 'children': [{'type': 'MemberExpression', 'range': [291, 293], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [291, 291]}, {'type': 'Identifier', 'name': 'exception', 'range': [293, 293]}]}, {'type': 'TemplateLiteral', 'range': [295, 296], 'children': [{'type': 'TemplateElement', 'value': 'Event broadcaster error: ', 'range': [295, 295]}, {'type': 'Identifier', 'name': 'e', 'range': [296, 296]}]}]}]}, {'type': 'ThrowStatement', 'range': [299, 300], 'children': []}]}]}, {'type': 'FinallyClause', 'range': [301, 310], 'children': [{'type': 'BlockStatement', 'range': [302, 310], 'children': [{'type': 'ExpressionStatement', 'range': [304, 308], 'children': [{'type': 'CallExpression', 'range': [304, 308], 'children': [{'type': 'MemberExpression', 'range': [304, 306], 'children': [{'type': 'Identifier', 'name': 'redis', 'range': [304, 304]}, {'type': 'Identifier', 'name': 'disconnect', 'range': [306, 306]}]}]}]}]}]}]}]}]}]}
2025-01-08 10:29:36,639 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:49,554 - INFO - Step 4 result: {'type': 'Program', 'name': 'websocket_router', 'range': [731, 974], 'children': [{'type': 'FunctionDecl', 'name': 'websocket_router', 'range': [731, 974], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [736, 738], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [740, 742], 'children': []}, {'type': 'AssignmentExpression', 'name': 'user_id', 'range': [752, 758], 'children': [{'type': 'CallExpression', 'name': 'authenticate_websocket', 'range': [755, 758], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [757, 757], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [760, 766], 'children': [{'type': 'Condition', 'name': 'not user_id', 'range': [761, 762], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [765, 765], 'children': []}]}, {'type': 'CallExpression', 'name': 'manager.connect', 'range': [768, 773], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [772, 772], 'children': []}]}, {'type': 'TryStatement', 'name': 'try', 'range': [775, 973], 'children': [{'type': 'WhileStatement', 'name': 'while', 'range': [778, 955], 'children': [{'type': 'AssignmentExpression', 'name': 'data', 'range': [782, 789], 'children': [{'type': 'CallExpression', 'name': 'websocket.receive_text', 'range': [785, 789], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'message', 'range': [791, 798], 'children': [{'type': 'CallExpression', 'name': 'WsMessage.model_validate_json', 'range': [793, 798], 'children': [{'type': 'Argument', 'name': 'data', 'range': [797, 797], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [801, 839], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.HEARTBEAT', 'range': [802, 809], 'children': []}, {'type': 'CallExpression', 'name': 'websocket.send_json', 'range': [813, 836], 'children': [{'type': 'Argument', 'name': '{"method": Methods.HEARTBEAT.value, "data": "pong", "success": True}', 'range': [817, 834], 'children': []}]}, {'type': 'ContinueStatement', 'name': 'continue', 'range': [838, 838], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [841, 861], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.SUBSCRIBE', 'range': [842, 849], 'children': []}, {'type': 'CallExpression', 'name': 'handle_subscribe', 'range': [853, 860], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [855, 855], 'children': []}, {'type': 'Argument', 'name': 'manager', 'range': [857, 857], 'children': []}, {'type': 'Argument', 'name': 'message', 'range': [859, 859], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'elif', 'range': [863, 883], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.UNSUBSCRIBE', 'range': [864, 871], 'children': []}, {'type': 'CallExpression', 'name': 'handle_unsubscribe', 'range': [875, 882], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [877, 877], 'children': []}, {'type': 'Argument', 'name': 'manager', 'range': [879, 879], 'children': []}, {'type': 'Argument', 'name': 'message', 'range': [881, 881], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'elif', 'range': [885, 904], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.ERROR', 'range': [886, 893], 'children': []}, {'type': 'CallExpression', 'name': 'logger.error', 'range': [896, 902], 'children': [{'type': 'Argument', 'name': 'f"WebSocket Error message received: {message.data}"', 'range': [900, 901], 'children': []}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [905, 954], 'children': [{'type': 'CallExpression', 'name': 'logger.warning', 'range': [908, 919], 'children': [{'type': 'Argument', 'name': 'f"Unknown WebSocket message type {message.method} received: "', 'range': [913, 914], 'children': []}, {'type': 'Argument', 'name': 'f"{message.data}"', 'range': [916, 917], 'children': []}]}, {'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [921, 953], 'children': [{'type': 'Argument', 'name': 'WsMessage(method=Methods.ERROR, success=False, error="Message type is not processed by the server").model_dump_json()', 'range': [927, 951], 'children': []}]}]}]}, {'type': 'ExceptStatement', 'name': 'except', 'range': [956, 973], 'children': [{'type': 'Exception', 'name': 'WebSocketDisconnect', 'range': [957, 957], 'children': []}, {'type': 'CallExpression', 'name': 'manager.disconnect', 'range': [960, 965], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [964, 964], 'children': []}]}, {'type': 'CallExpression', 'name': 'logger.debug', 'range': [967, 972], 'children': [{'type': 'Argument', 'name': '"WebSocket client disconnected"', 'range': [971, 971], 'children': []}]}]}]}]}]}
2025-01-08 10:29:49,554 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:29:51,128 - INFO - Step 5 result: {'type': 'Program', 'name': 'MainProgram', 'range': [0, 127], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 2], 'children': [{'type': 'ImportSpecifier', 'name': 'asyncio', 'range': [1, 1], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [3, 5], 'children': [{'type': 'ImportSpecifier', 'name': 'logging', 'range': [4, 4], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 10], 'children': [{'type': 'ImportSpecifier', 'name': 'asynccontextmanager', 'range': [9, 9], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [12, 14], 'children': [{'type': 'ImportSpecifier', 'name': 'uvicorn', 'range': [13, 13], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [15, 21], 'children': [{'type': 'ImportSpecifier', 'name': 'parse_jwt_token', 'range': [20, 20], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [22, 32], 'children': [{'type': 'ImportSpecifier', 'name': 'Depends', 'range': [25, 25], 'children': []}, {'type': 'ImportSpecifier', 'name': 'FastAPI', 'range': [27, 27], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WebSocket', 'range': [29, 29], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WebSocketDisconnect', 'range': [31, 31], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [33, 41], 'children': [{'type': 'ImportSpecifier', 'name': 'CORSMiddleware', 'range': [40, 40], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [43, 49], 'children': [{'type': 'ImportSpecifier', 'name': 'redis', 'range': [48, 48], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [50, 58], 'children': [{'type': 'ImportSpecifier', 'name': 'AsyncRedisExecutionEventBus', 'range': [57, 57], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [59, 67], 'children': [{'type': 'ImportSpecifier', 'name': 'DEFAULT_USER_ID', 'range': [66, 66], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [68, 76], 'children': [{'type': 'ImportSpecifier', 'name': 'ConnectionManager', 'range': [75, 75], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [77, 89], 'children': [{'type': 'ImportSpecifier', 'name': 'ExecutionSubscription', 'range': [84, 84], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Methods', 'range': [86, 86], 'children': []}, {'type': 'ImportSpecifier', 'name': 'WsMessage', 'range': [88, 88], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [90, 98], 'children': [{'type': 'ImportSpecifier', 'name': 'AppProcess', 'range': [97, 97], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [99, 111], 'children': [{'type': 'ImportSpecifier', 'name': 'AppEnvironment', 'range': [106, 106], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Config', 'range': [108, 108], 'children': []}, {'type': 'ImportSpecifier', 'name': 'Settings', 'range': [110, 110], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'logger', 'range': [113, 121], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [114, 120], 'children': [{'type': 'CallExpression', 'name': 'getLogger', 'range': [117, 120], 'children': [{'type': 'Identifier', 'name': '__name__', 'range': [119, 119], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'settings', 'range': [122, 127], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [123, 126], 'children': [{'type': 'NewExpression', 'name': 'Settings', 'range': [124, 126], 'children': []}]}]}]}
2025-01-08 10:29:51,128 - INFO - Completed main AST analysis flow
2025-01-08 10:29:51,131 - INFO - Successfully processed chunk
2025-01-08 10:29:52,123 - INFO - Step 5 result: {'type': 'Program', 'name': 'lifespan', 'range': [130, 178], 'children': [{'type': 'FunctionDecl', 'name': 'lifespan', 'range': [130, 178], 'children': [{'type': 'Decorator', 'name': '@asynccontextmanager', 'range': [130, 131]}, {'type': 'Keyword', 'name': 'async', 'range': [133, 133]}, {'type': 'Keyword', 'name': 'def', 'range': [134, 134]}, {'type': 'Identifier', 'name': 'lifespan', 'range': [135, 135]}, {'type': 'Identifier', 'name': 'app', 'range': [137, 137]}, {'type': 'Identifier', 'name': 'FastAPI', 'range': [139, 139]}, {'type': 'BlockStatement', 'range': [142, 178], 'children': [{'type': 'VariableDecl', 'range': [143, 147], 'children': [{'type': 'Identifier', 'name': 'manager', 'range': [143, 143]}, {'type': 'CallExpression', 'range': [145, 147], 'children': [{'type': 'Identifier', 'name': 'get_connection_manager', 'range': [145, 145]}]}]}, {'type': 'VariableDecl', 'range': [149, 159], 'children': [{'type': 'Identifier', 'name': 'fut', 'range': [149, 149]}, {'type': 'CallExpression', 'range': [151, 159], 'children': [{'type': 'MemberExpression', 'range': [151, 153], 'children': [{'type': 'Identifier', 'name': 'asyncio', 'range': [151, 151]}, {'type': 'Identifier', 'name': 'create_task', 'range': [153, 153]}]}, {'type': 'CallExpression', 'range': [155, 158], 'children': [{'type': 'Identifier', 'name': 'event_broadcaster', 'range': [155, 155]}, {'type': 'Identifier', 'name': 'manager', 'range': [157, 157]}]}]}]}, {'type': 'ExpressionStatement', 'range': [161, 174], 'children': [{'type': 'CallExpression', 'range': [161, 174], 'children': [{'type': 'MemberExpression', 'range': [161, 163], 'children': [{'type': 'Identifier', 'name': 'fut', 'range': [161, 161]}, {'type': 'Identifier', 'name': 'add_done_callback', 'range': [163, 163]}]}, {'type': 'LambdaExpression', 'range': [165, 173], 'children': [{'type': 'Keyword', 'name': 'lambda', 'range': [165, 165]}, {'type': 'Identifier', 'name': '_', 'range': [166, 166]}, {'type': 'CallExpression', 'range': [168, 173], 'children': [{'type': 'MemberExpression', 'range': [168, 170], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [168, 168]}, {'type': 'Identifier', 'name': 'info', 'range': [170, 170]}]}, {'type': 'Literal', 'value': '"Event broadcaster stopped"', 'range': [172, 172]}]}]}]}]}, {'type': 'Keyword', 'name': 'yield', 'range': [176, 176]}]}]}]}
2025-01-08 10:29:52,123 - INFO - Completed main AST analysis flow
2025-01-08 10:29:52,125 - INFO - Successfully processed chunk
2025-01-08 10:29:52,531 - INFO - Step 4 result: {'type': 'Program', 'name': 'handle_unsubscribe', 'range': [569, 700], 'children': [{'type': 'FunctionDecl', 'name': 'handle_unsubscribe', 'range': [569, 700], 'children': [{'type': 'FunctionSignature', 'name': 'handle_unsubscribe', 'range': [569, 587], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [569, 573], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [570, 573], 'children': []}, {'type': 'Identifier', 'name': 'handle_unsubscribe', 'range': [571, 587], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [572, 586], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [574, 576], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [578, 580], 'children': []}, {'type': 'Parameter', 'name': 'message', 'range': [582, 584], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [588, 700], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [589, 629], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [589, 594], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [590, 591], 'children': []}, {'type': 'MemberExpression', 'name': 'message.data', 'range': [591, 593], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [595, 629], 'children': [{'type': 'ExpressionStatement', 'name': 'await websocket.send_text', 'range': [596, 628], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [596, 597], 'children': []}, {'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [597, 628], 'children': [{'type': 'MemberExpression', 'name': 'websocket.send_text', 'range': [597, 599], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [600, 627], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [602, 622], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [603, 621], 'children': [{'type': 'AssignmentExpression', 'name': 'method=Methods.ERROR', 'range': [605, 609], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success=False', 'range': [612, 614], 'children': []}, {'type': 'AssignmentExpression', 'name': 'error="Subscription data missing"', 'range': [617, 619], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [623, 626], 'children': []}]}]}]}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [630, 700], 'children': [{'type': 'Block', 'name': 'alternate', 'range': [632, 700], 'children': [{'type': 'VariableDeclaration', 'name': 'ex_sub', 'range': [633, 643], 'children': [{'type': 'AssignmentExpression', 'name': 'ex_sub=ExecutionSubscription.model_validate', 'range': [634, 642], 'children': [{'type': 'CallExpression', 'name': 'ExecutionSubscription.model_validate', 'range': [635, 642], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [639, 641], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'await manager.unsubscribe', 'range': [644, 655], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [644, 645], 'children': []}, {'type': 'CallExpression', 'name': 'manager.unsubscribe', 'range': [645, 655], 'children': [{'type': 'MemberExpression', 'name': 'manager.unsubscribe', 'range': [645, 647], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [648, 654], 'children': [{'type': 'MemberExpression', 'name': 'ex_sub.graph_id', 'range': [649, 651], 'children': []}, {'type': 'Identifier', 'name': 'websocket', 'range': [653, 654], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [656, 663], 'children': [{'type': 'CallExpression', 'name': 'logger.debug', 'range': [656, 663], 'children': [{'type': 'MemberExpression', 'name': 'logger.debug', 'range': [656, 658], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [659, 662], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Removed execution subscription for graph {ex_sub.graph_id}"', 'range': [660, 661], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'await websocket.send_text', 'range': [664, 699], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [664, 665], 'children': []}, {'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [665, 699], 'children': [{'type': 'MemberExpression', 'name': 'websocket.send_text', 'range': [665, 667], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [668, 698], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [670, 692], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [671, 691], 'children': [{'type': 'AssignmentExpression', 'name': 'method=Methods.UNSUBSCRIBE', 'range': [673, 677], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success=True', 'range': [680, 682], 'children': []}, {'type': 'AssignmentExpression', 'name': 'channel=ex_sub.graph_id', 'range': [685, 689], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [693, 696], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:29:52,532 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:30:02,133 - INFO - Step 3 result: {'type': 'Program', 'name': 'authenticate_websocket', 'range': [311, 436], 'children': [{'type': 'FunctionDeclaration', 'name': 'authenticate_websocket', 'range': [311, 436], 'children': [{'type': 'FunctionSignature', 'name': 'authenticate_websocket', 'range': [311, 322], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [311, 315], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [312, 315], 'children': []}, {'type': 'Identifier', 'name': 'authenticate_websocket', 'range': [313, 333], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [314, 318], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [315, 318], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [315, 323], 'children': []}, {'type': 'TypeAnnotation', 'name': '', 'range': [316, 318], 'children': [{'type': 'Identifier', 'name': 'WebSocket', 'range': [317, 325], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [319, 322], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [321, 324], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [323, 436], 'children': [{'type': 'IfStatement', 'name': '', 'range': [324, 335], 'children': [{'type': 'Condition', 'name': '', 'range': [324, 331], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [325, 331], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [326, 330], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [326, 333], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [328, 334], 'children': []}, {'type': 'Identifier', 'name': 'enable_auth', 'range': [330, 341], 'children': []}]}]}]}, {'type': 'Block', 'name': '', 'range': [332, 335], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [333, 335], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [334, 348], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'token', 'range': [337, 347], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [338, 347], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [339, 343], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [339, 347], 'children': []}, {'type': 'Identifier', 'name': 'query_params', 'range': [341, 353], 'children': []}, {'type': 'CallExpression', 'name': 'get', 'range': [343, 347], 'children': [{'type': 'StringLiteral', 'name': '"token"', 'range': [345, 351], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [348, 369], 'children': [{'type': 'Condition', 'name': '', 'range': [348, 351], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [349, 351], 'children': [{'type': 'Identifier', 'name': 'token', 'range': [350, 354], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [352, 369], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [353, 366], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [353, 366], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [356, 366], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [354, 356], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [354, 362], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [357, 365], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [358, 360], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [358, 362], 'children': []}, {'type': 'NumericLiteral', 'name': '4001', 'range': [360, 364], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [362, 364], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [362, 368], 'children': []}, {'type': 'StringLiteral', 'name': '"Missing authentication token"', 'range': [364, 394], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [367, 369], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [368, 370], 'children': []}]}]}]}, {'type': 'TryStatement', 'name': '', 'range': [371, 435], 'children': [{'type': 'Block', 'name': '', 'range': [373, 414], 'children': [{'type': 'VariableDeclaration', 'name': 'payload', 'range': [374, 380], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [375, 380], 'children': [{'type': 'CallExpression', 'name': 'parse_jwt_token', 'range': [376, 380], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [377, 379], 'children': [{'type': 'Identifier', 'name': 'token', 'range': [378, 382], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'user_id', 'range': [381, 389], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [382, 389], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [385, 389], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [383, 385], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [383, 389], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [386, 388], 'children': [{'type': 'StringLiteral', 'name': '"sub"', 'range': [387, 391], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [390, 411], 'children': [{'type': 'Condition', 'name': '', 'range': [390, 393], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [391, 393], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [392, 398], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [394, 411], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [395, 408], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [395, 408], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [398, 408], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [396, 398], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [396, 404], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [399, 407], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [400, 402], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [400, 404], 'children': []}, {'type': 'NumericLiteral', 'name': '4002', 'range': [402, 406], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [404, 406], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [404, 410], 'children': []}, {'type': 'StringLiteral', 'name': '"Invalid token"', 'range': [406, 420], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [409, 411], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [410, 412], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [412, 414], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [413, 419], 'children': []}]}]}, {'type': 'CatchClause', 'name': '', 'range': [415, 435], 'children': [{'type': 'Block', 'name': '', 'range': [418, 435], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [419, 432], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [419, 432], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [422, 432], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [420, 422], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [420, 428], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [423, 431], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [424, 426], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [424, 428], 'children': []}, {'type': 'NumericLiteral', 'name': '4003', 'range': [426, 430], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [428, 430], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [428, 434], 'children': []}, {'type': 'StringLiteral', 'name': '"Invalid token"', 'range': [430, 444], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [433, 435], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [434, 436], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:30:02,133 - INFO - Starting Step 4: AST normalization
2025-01-08 10:30:03,506 - INFO - Step 5 result: {'type': 'Program', 'name': 'event_broadcaster', 'range': [241, 310], 'children': [{'type': 'FunctionDecl', 'name': 'event_broadcaster', 'range': [241, 310], 'children': [{'type': 'BlockStatement', 'range': [249, 310], 'children': [{'type': 'TryStatement', 'range': [251, 310], 'children': [{'type': 'BlockStatement', 'range': [252, 284], 'children': [{'type': 'ExpressionStatement', 'range': [254, 258], 'children': [{'type': 'CallExpression', 'range': [254, 258], 'children': [{'type': 'MemberExpression', 'range': [254, 256], 'children': [{'type': 'Identifier', 'name': 'redis', 'range': [254, 254]}, {'type': 'Identifier', 'name': 'connect', 'range': [256, 256]}]}]}]}, {'type': 'ExpressionStatement', 'range': [260, 264], 'children': [{'type': 'AssignmentExpression', 'range': [260, 264], 'children': [{'type': 'Identifier', 'name': 'event_queue', 'range': [260, 260]}, {'type': 'NewExpression', 'range': [262, 264], 'children': [{'type': 'Identifier', 'name': 'AsyncRedisExecutionEventBus', 'range': [262, 262]}]}]}]}, {'type': 'ForStatement', 'range': [266, 284], 'children': [{'type': 'VariableDeclaration', 'range': [268, 268], 'children': [{'type': 'VariableDeclarator', 'range': [268, 268], 'children': [{'type': 'Identifier', 'name': 'event', 'range': [268, 268]}]}]}, {'type': 'CallExpression', 'range': [270, 274], 'children': [{'type': 'MemberExpression', 'range': [270, 272], 'children': [{'type': 'Identifier', 'name': 'event_queue', 'range': [270, 270]}, {'type': 'Identifier', 'name': 'listen', 'range': [272, 272]}]}]}, {'type': 'BlockStatement', 'range': [275, 284], 'children': [{'type': 'ExpressionStatement', 'range': [277, 283], 'children': [{'type': 'AwaitExpression', 'range': [277, 283], 'children': [{'type': 'CallExpression', 'range': [278, 283], 'children': [{'type': 'MemberExpression', 'range': [278, 280], 'children': [{'type': 'Identifier', 'name': 'manager', 'range': [278, 278]}, {'type': 'Identifier', 'name': 'send_execution_result', 'range': [280, 280]}]}, {'type': 'Identifier', 'name': 'event', 'range': [282, 282]}]}]}]}]}]}]}, {'type': 'CatchClause', 'range': [285, 300], 'children': [{'type': 'BlockStatement', 'range': [289, 300], 'children': [{'type': 'ExpressionStatement', 'range': [291, 297], 'children': [{'type': 'CallExpression', 'range': [291, 297], 'children': [{'type': 'MemberExpression', 'range': [291, 293], 'children': [{'type': 'Identifier', 'name': 'logger', 'range': [291, 291]}, {'type': 'Identifier', 'name': 'exception', 'range': [293, 293]}]}, {'type': 'TemplateLiteral', 'range': [295, 296], 'children': [{'type': 'TemplateElement', 'value': 'Event broadcaster error: ', 'range': [295, 295]}, {'type': 'Identifier', 'name': 'e', 'range': [296, 296]}]}]}]}, {'type': 'ThrowStatement', 'range': [299, 300], 'children': []}]}]}, {'type': 'FinallyClause', 'range': [301, 310], 'children': [{'type': 'BlockStatement', 'range': [302, 310], 'children': [{'type': 'ExpressionStatement', 'range': [304, 308], 'children': [{'type': 'CallExpression', 'range': [304, 308], 'children': [{'type': 'MemberExpression', 'range': [304, 306], 'children': [{'type': 'Identifier', 'name': 'redis', 'range': [304, 304]}, {'type': 'Identifier', 'name': 'disconnect', 'range': [306, 306]}]}]}]}]}]}]}]}]}]}
2025-01-08 10:30:03,507 - INFO - Completed main AST analysis flow
2025-01-08 10:30:03,507 - INFO - Successfully processed chunk
2025-01-08 10:30:25,579 - INFO - Step 5 result: {'type': 'Program', 'name': 'websocket_router', 'range': [731, 974], 'children': [{'type': 'FunctionDecl', 'name': 'websocket_router', 'range': [731, 974], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [736, 738], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [740, 742], 'children': []}, {'type': 'AssignmentExpression', 'name': 'user_id', 'range': [752, 758], 'children': [{'type': 'CallExpression', 'name': 'authenticate_websocket', 'range': [755, 758], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [757, 757], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [760, 766], 'children': [{'type': 'Condition', 'name': 'not user_id', 'range': [761, 762], 'children': []}, {'type': 'ReturnStatement', 'name': 'return', 'range': [765, 765], 'children': []}]}, {'type': 'CallExpression', 'name': 'manager.connect', 'range': [768, 773], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [772, 772], 'children': []}]}, {'type': 'TryStatement', 'name': 'try', 'range': [775, 973], 'children': [{'type': 'WhileStatement', 'name': 'while', 'range': [778, 955], 'children': [{'type': 'AssignmentExpression', 'name': 'data', 'range': [782, 789], 'children': [{'type': 'CallExpression', 'name': 'websocket.receive_text', 'range': [785, 789], 'children': []}]}, {'type': 'AssignmentExpression', 'name': 'message', 'range': [791, 798], 'children': [{'type': 'CallExpression', 'name': 'WsMessage.model_validate_json', 'range': [793, 798], 'children': [{'type': 'Argument', 'name': 'data', 'range': [797, 797], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'if', 'range': [801, 839], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.HEARTBEAT', 'range': [802, 809], 'children': []}, {'type': 'CallExpression', 'name': 'websocket.send_json', 'range': [813, 836], 'children': [{'type': 'Argument', 'name': '{"method": Methods.HEARTBEAT.value, "data": "pong", "success": True}', 'range': [817, 834], 'children': []}]}, {'type': 'ContinueStatement', 'name': 'continue', 'range': [838, 838], 'children': []}]}, {'type': 'IfStatement', 'name': 'if', 'range': [841, 861], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.SUBSCRIBE', 'range': [842, 849], 'children': []}, {'type': 'CallExpression', 'name': 'handle_subscribe', 'range': [853, 860], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [855, 855], 'children': []}, {'type': 'Argument', 'name': 'manager', 'range': [857, 857], 'children': []}, {'type': 'Argument', 'name': 'message', 'range': [859, 859], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'elif', 'range': [863, 883], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.UNSUBSCRIBE', 'range': [864, 871], 'children': []}, {'type': 'CallExpression', 'name': 'handle_unsubscribe', 'range': [875, 882], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [877, 877], 'children': []}, {'type': 'Argument', 'name': 'manager', 'range': [879, 879], 'children': []}, {'type': 'Argument', 'name': 'message', 'range': [881, 881], 'children': []}]}]}, {'type': 'IfStatement', 'name': 'elif', 'range': [885, 904], 'children': [{'type': 'Condition', 'name': 'message.method == Methods.ERROR', 'range': [886, 893], 'children': []}, {'type': 'CallExpression', 'name': 'logger.error', 'range': [896, 902], 'children': [{'type': 'Argument', 'name': 'f"WebSocket Error message received: {message.data}"', 'range': [900, 901], 'children': []}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [905, 954], 'children': [{'type': 'CallExpression', 'name': 'logger.warning', 'range': [908, 919], 'children': [{'type': 'Argument', 'name': 'f"Unknown WebSocket message type {message.method} received: "', 'range': [913, 914], 'children': []}, {'type': 'Argument', 'name': 'f"{message.data}"', 'range': [916, 917], 'children': []}]}, {'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [921, 953], 'children': [{'type': 'Argument', 'name': 'WsMessage(method=Methods.ERROR, success=False, error="Message type is not processed by the server").model_dump_json()', 'range': [927, 951], 'children': []}]}]}]}, {'type': 'ExceptStatement', 'name': 'except', 'range': [956, 973], 'children': [{'type': 'Exception', 'name': 'WebSocketDisconnect', 'range': [957, 957], 'children': []}, {'type': 'CallExpression', 'name': 'manager.disconnect', 'range': [960, 965], 'children': [{'type': 'Argument', 'name': 'websocket', 'range': [964, 964], 'children': []}]}, {'type': 'CallExpression', 'name': 'logger.debug', 'range': [967, 972], 'children': [{'type': 'Argument', 'name': '"WebSocket client disconnected"', 'range': [971, 971], 'children': []}]}]}]}]}]}
2025-01-08 10:30:25,579 - INFO - Completed main AST analysis flow
2025-01-08 10:30:25,583 - INFO - Successfully processed chunk
2025-01-08 10:30:30,894 - INFO - Step 5 result: {'type': 'Program', 'name': 'handle_unsubscribe', 'range': [569, 700], 'children': [{'type': 'FunctionDecl', 'name': 'handle_unsubscribe', 'range': [569, 700], 'children': [{'type': 'FunctionSignature', 'name': 'handle_unsubscribe', 'range': [569, 587], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [569, 573], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [570, 573], 'children': []}, {'type': 'Identifier', 'name': 'handle_unsubscribe', 'range': [571, 587], 'children': []}, {'type': 'ParameterList', 'name': 'parameters', 'range': [572, 586], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [574, 576], 'children': []}, {'type': 'Parameter', 'name': 'manager', 'range': [578, 580], 'children': []}, {'type': 'Parameter', 'name': 'message', 'range': [582, 584], 'children': []}]}]}, {'type': 'FunctionBody', 'name': 'body', 'range': [588, 700], 'children': [{'type': 'IfStatement', 'name': 'if', 'range': [589, 629], 'children': [{'type': 'Condition', 'name': 'condition', 'range': [589, 594], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [590, 591], 'children': []}, {'type': 'MemberExpression', 'name': 'message.data', 'range': [591, 593], 'children': []}]}, {'type': 'Block', 'name': 'consequent', 'range': [595, 629], 'children': [{'type': 'ExpressionStatement', 'name': 'await websocket.send_text', 'range': [596, 628], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [596, 597], 'children': []}, {'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [597, 628], 'children': [{'type': 'MemberExpression', 'name': 'websocket.send_text', 'range': [597, 599], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [600, 627], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [602, 622], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [603, 621], 'children': [{'type': 'AssignmentExpression', 'name': 'method=Methods.ERROR', 'range': [605, 609], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success=False', 'range': [612, 614], 'children': []}, {'type': 'AssignmentExpression', 'name': 'error="Subscription data missing"', 'range': [617, 619], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [623, 626], 'children': []}]}]}]}]}]}, {'type': 'ElseStatement', 'name': 'else', 'range': [630, 700], 'children': [{'type': 'Block', 'name': 'alternate', 'range': [632, 700], 'children': [{'type': 'VariableDeclaration', 'name': 'ex_sub', 'range': [633, 643], 'children': [{'type': 'AssignmentExpression', 'name': 'ex_sub=ExecutionSubscription.model_validate', 'range': [634, 642], 'children': [{'type': 'CallExpression', 'name': 'ExecutionSubscription.model_validate', 'range': [635, 642], 'children': [{'type': 'MemberExpression', 'name': 'message.data', 'range': [639, 641], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'await manager.unsubscribe', 'range': [644, 655], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [644, 645], 'children': []}, {'type': 'CallExpression', 'name': 'manager.unsubscribe', 'range': [645, 655], 'children': [{'type': 'MemberExpression', 'name': 'manager.unsubscribe', 'range': [645, 647], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [648, 654], 'children': [{'type': 'MemberExpression', 'name': 'ex_sub.graph_id', 'range': [649, 651], 'children': []}, {'type': 'Identifier', 'name': 'websocket', 'range': [653, 654], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'logger.debug', 'range': [656, 663], 'children': [{'type': 'CallExpression', 'name': 'logger.debug', 'range': [656, 663], 'children': [{'type': 'MemberExpression', 'name': 'logger.debug', 'range': [656, 658], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [659, 662], 'children': [{'type': 'TemplateLiteral', 'name': 'f"Removed execution subscription for graph {ex_sub.graph_id}"', 'range': [660, 661], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': 'await websocket.send_text', 'range': [664, 699], 'children': [{'type': 'AwaitExpression', 'name': 'await', 'range': [664, 665], 'children': []}, {'type': 'CallExpression', 'name': 'websocket.send_text', 'range': [665, 699], 'children': [{'type': 'MemberExpression', 'name': 'websocket.send_text', 'range': [665, 667], 'children': []}, {'type': 'Arguments', 'name': 'arguments', 'range': [668, 698], 'children': [{'type': 'NewExpression', 'name': 'WsMessage', 'range': [670, 692], 'children': [{'type': 'Arguments', 'name': 'arguments', 'range': [671, 691], 'children': [{'type': 'AssignmentExpression', 'name': 'method=Methods.UNSUBSCRIBE', 'range': [673, 677], 'children': []}, {'type': 'AssignmentExpression', 'name': 'success=True', 'range': [680, 682], 'children': []}, {'type': 'AssignmentExpression', 'name': 'channel=ex_sub.graph_id', 'range': [685, 689], 'children': []}]}]}, {'type': 'CallExpression', 'name': 'model_dump_json', 'range': [693, 696], 'children': []}]}]}]}]}]}]}]}]}
2025-01-08 10:30:30,895 - INFO - Completed main AST analysis flow
2025-01-08 10:30:30,896 - INFO - Successfully processed chunk
2025-01-08 10:31:06,572 - INFO - Step 4 result: {'type': 'Program', 'name': 'authenticate_websocket', 'range': [311, 436], 'children': [{'type': 'FunctionDecl', 'name': 'authenticate_websocket', 'range': [311, 436], 'children': [{'type': 'FunctionSignature', 'name': 'authenticate_websocket', 'range': [311, 322], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [311, 315], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [312, 315], 'children': []}, {'type': 'Identifier', 'name': 'authenticate_websocket', 'range': [313, 333], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [314, 318], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [315, 318], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [315, 323], 'children': []}, {'type': 'TypeAnnotation', 'name': '', 'range': [316, 318], 'children': [{'type': 'Identifier', 'name': 'WebSocket', 'range': [317, 325], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [319, 322], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [321, 324], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [323, 436], 'children': [{'type': 'IfStatement', 'name': '', 'range': [324, 335], 'children': [{'type': 'Condition', 'name': '', 'range': [324, 331], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [325, 331], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [326, 330], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [326, 333], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [328, 334], 'children': []}, {'type': 'Identifier', 'name': 'enable_auth', 'range': [330, 341], 'children': []}]}]}]}, {'type': 'Block', 'name': '', 'range': [332, 335], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [333, 335], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [334, 348], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'token', 'range': [337, 347], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [338, 347], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [339, 343], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [339, 347], 'children': []}, {'type': 'Identifier', 'name': 'query_params', 'range': [341, 353], 'children': []}, {'type': 'CallExpression', 'name': 'get', 'range': [343, 347], 'children': [{'type': 'StringLiteral', 'name': '"token"', 'range': [345, 351], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [348, 369], 'children': [{'type': 'Condition', 'name': '', 'range': [348, 351], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [349, 351], 'children': [{'type': 'Identifier', 'name': 'token', 'range': [350, 354], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [352, 369], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [353, 366], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [353, 366], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [356, 366], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [354, 356], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [354, 362], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [357, 365], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [358, 360], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [358, 362], 'children': []}, {'type': 'NumericLiteral', 'name': '4001', 'range': [360, 364], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [362, 364], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [362, 368], 'children': []}, {'type': 'StringLiteral', 'name': '"Missing authentication token"', 'range': [364, 394], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [367, 369], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [368, 370], 'children': []}]}]}]}, {'type': 'TryStatement', 'name': '', 'range': [371, 435], 'children': [{'type': 'Block', 'name': '', 'range': [373, 414], 'children': [{'type': 'VariableDeclaration', 'name': 'payload', 'range': [374, 380], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [375, 380], 'children': [{'type': 'CallExpression', 'name': 'parse_jwt_token', 'range': [376, 380], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [377, 379], 'children': [{'type': 'Identifier', 'name': 'token', 'range': [378, 382], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'user_id', 'range': [381, 389], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [382, 389], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [385, 389], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [383, 385], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [383, 389], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [386, 388], 'children': [{'type': 'StringLiteral', 'name': '"sub"', 'range': [387, 391], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [390, 411], 'children': [{'type': 'Condition', 'name': '', 'range': [390, 393], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [391, 393], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [392, 398], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [394, 411], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [395, 408], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [395, 408], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [398, 408], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [396, 398], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [396, 404], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [399, 407], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [400, 402], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [400, 404], 'children': []}, {'type': 'NumericLiteral', 'name': '4002', 'range': [402, 406], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [404, 406], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [404, 410], 'children': []}, {'type': 'StringLiteral', 'name': '"Invalid token"', 'range': [406, 420], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [409, 411], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [410, 412], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [412, 414], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [413, 419], 'children': []}]}]}, {'type': 'CatchClause', 'name': '', 'range': [415, 435], 'children': [{'type': 'Block', 'name': '', 'range': [418, 435], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [419, 432], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [419, 432], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [422, 432], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [420, 422], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [420, 428], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [423, 431], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [424, 426], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [424, 428], 'children': []}, {'type': 'NumericLiteral', 'name': '4003', 'range': [426, 430], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [428, 430], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [428, 434], 'children': []}, {'type': 'StringLiteral', 'name': '"Invalid token"', 'range': [430, 444], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [433, 435], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [434, 436], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:31:06,572 - INFO - Starting Step 5: Final AST combination
2025-01-08 10:32:09,490 - INFO - Step 5 result: {'type': 'Program', 'name': 'authenticate_websocket', 'range': [311, 436], 'children': [{'type': 'FunctionDecl', 'name': 'authenticate_websocket', 'range': [311, 436], 'children': [{'type': 'FunctionSignature', 'name': 'authenticate_websocket', 'range': [311, 322], 'children': [{'type': 'Keyword', 'name': 'async', 'range': [311, 315], 'children': []}, {'type': 'Keyword', 'name': 'def', 'range': [312, 315], 'children': []}, {'type': 'Identifier', 'name': 'authenticate_websocket', 'range': [313, 333], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [314, 318], 'children': [{'type': 'Parameter', 'name': 'websocket', 'range': [315, 318], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [315, 323], 'children': []}, {'type': 'TypeAnnotation', 'name': '', 'range': [316, 318], 'children': [{'type': 'Identifier', 'name': 'WebSocket', 'range': [317, 325], 'children': []}]}]}]}, {'type': 'ReturnType', 'name': '', 'range': [319, 322], 'children': [{'type': 'Identifier', 'name': 'str', 'range': [321, 324], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [323, 436], 'children': [{'type': 'IfStatement', 'name': '', 'range': [324, 335], 'children': [{'type': 'Condition', 'name': '', 'range': [324, 331], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [325, 331], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [326, 330], 'children': [{'type': 'Identifier', 'name': 'settings', 'range': [326, 333], 'children': []}, {'type': 'Identifier', 'name': 'config', 'range': [328, 334], 'children': []}, {'type': 'Identifier', 'name': 'enable_auth', 'range': [330, 341], 'children': []}]}]}]}, {'type': 'Block', 'name': '', 'range': [332, 335], 'children': [{'type': 'ReturnStatement', 'name': '', 'range': [333, 335], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [334, 348], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'token', 'range': [337, 347], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [338, 347], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [339, 343], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [339, 347], 'children': []}, {'type': 'Identifier', 'name': 'query_params', 'range': [341, 353], 'children': []}, {'type': 'CallExpression', 'name': 'get', 'range': [343, 347], 'children': [{'type': 'StringLiteral', 'name': '"token"', 'range': [345, 351], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [348, 369], 'children': [{'type': 'Condition', 'name': '', 'range': [348, 351], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [349, 351], 'children': [{'type': 'Identifier', 'name': 'token', 'range': [350, 354], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [352, 369], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [353, 366], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [353, 366], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [356, 366], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [354, 356], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [354, 362], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [357, 365], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [358, 360], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [358, 362], 'children': []}, {'type': 'NumericLiteral', 'name': '4001', 'range': [360, 364], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [362, 364], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [362, 368], 'children': []}, {'type': 'StringLiteral', 'name': '"Missing authentication token"', 'range': [364, 394], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [367, 369], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [368, 370], 'children': []}]}]}]}, {'type': 'TryStatement', 'name': '', 'range': [371, 435], 'children': [{'type': 'Block', 'name': '', 'range': [373, 414], 'children': [{'type': 'VariableDeclaration', 'name': 'payload', 'range': [374, 380], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [375, 380], 'children': [{'type': 'CallExpression', 'name': 'parse_jwt_token', 'range': [376, 380], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [377, 379], 'children': [{'type': 'Identifier', 'name': 'token', 'range': [378, 382], 'children': []}]}]}]}]}, {'type': 'VariableDeclaration', 'name': 'user_id', 'range': [381, 389], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [382, 389], 'children': [{'type': 'CallExpression', 'name': 'get', 'range': [385, 389], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [383, 385], 'children': [{'type': 'Identifier', 'name': 'payload', 'range': [383, 389], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [386, 388], 'children': [{'type': 'StringLiteral', 'name': '"sub"', 'range': [387, 391], 'children': []}]}]}]}]}, {'type': 'IfStatement', 'name': '', 'range': [390, 411], 'children': [{'type': 'Condition', 'name': '', 'range': [390, 393], 'children': [{'type': 'UnaryExpression', 'name': 'not', 'range': [391, 393], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [392, 398], 'children': []}]}]}, {'type': 'Block', 'name': '', 'range': [394, 411], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [395, 408], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [395, 408], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [398, 408], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [396, 398], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [396, 404], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [399, 407], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [400, 402], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [400, 404], 'children': []}, {'type': 'NumericLiteral', 'name': '4002', 'range': [402, 406], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [404, 406], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [404, 410], 'children': []}, {'type': 'StringLiteral', 'name': '"Invalid token"', 'range': [406, 420], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [409, 411], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [410, 412], 'children': []}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [412, 414], 'children': [{'type': 'Identifier', 'name': 'user_id', 'range': [413, 419], 'children': []}]}]}, {'type': 'CatchClause', 'name': '', 'range': [415, 435], 'children': [{'type': 'Block', 'name': '', 'range': [418, 435], 'children': [{'type': 'ExpressionStatement', 'name': '', 'range': [419, 432], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [419, 432], 'children': [{'type': 'CallExpression', 'name': 'close', 'range': [422, 432], 'children': [{'type': 'MemberExpression', 'name': '', 'range': [420, 422], 'children': [{'type': 'Identifier', 'name': 'websocket', 'range': [420, 428], 'children': []}]}, {'type': 'ArgumentList', 'name': '', 'range': [423, 431], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [424, 426], 'children': [{'type': 'Identifier', 'name': 'code', 'range': [424, 428], 'children': []}, {'type': 'NumericLiteral', 'name': '4003', 'range': [426, 430], 'children': []}]}, {'type': 'AssignmentExpression', 'name': '=', 'range': [428, 430], 'children': [{'type': 'Identifier', 'name': 'reason', 'range': [428, 434], 'children': []}, {'type': 'StringLiteral', 'name': '"Invalid token"', 'range': [430, 444], 'children': []}]}]}]}]}]}, {'type': 'ReturnStatement', 'name': '', 'range': [433, 435], 'children': [{'type': 'StringLiteral', 'name': '""', 'range': [434, 436], 'children': []}]}]}]}]}]}]}]}
2025-01-08 10:32:09,490 - INFO - Completed main AST analysis flow
2025-01-08 10:32:09,492 - INFO - Successfully processed chunk
2025-01-08 10:32:09,560 - INFO - Starting code generation from AST
2025-01-08 10:32:37,969 - INFO - Successfully generated code from AST
2025-01-08 10:32:37,972 - INFO - Starting static code similarity comparison
2025-01-08 10:32:37,998 - INFO - Static similarity result: {'final_score': 99.63, 'length_similarity': 99.64, 'token_similarity': 100.0, 'structure_similarity': 98.75, 'function_similarity': 100, 'complexity_similarity': 100.0, 'variable_similarity': 100}
