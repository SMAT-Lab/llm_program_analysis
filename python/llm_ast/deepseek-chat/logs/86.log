2025-01-08 09:51:50,155 - INFO - Processing sample 86
2025-01-08 09:51:50,155 - INFO - Starting Step 0: Splitting code into top-level declarations
2025-01-08 09:51:54,235 - INFO - Successfully split code into 5 top-level declarations
2025-01-08 09:51:54,240 - INFO - Processing chunk #0 (size=407 chars, start_index=0)
2025-01-08 09:51:54,240 - INFO - Processing chunk with 407 chars starting at index 0
2025-01-08 09:51:54,241 - INFO - Starting main AST analysis flow
2025-01-08 09:51:54,241 - INFO - Tokenized code into 75 tokens
2025-01-08 09:51:54,241 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:51:54,250 - INFO - Processing chunk #1 (size=1122 chars, start_index=75)
2025-01-08 09:51:54,250 - INFO - Processing chunk with 1122 chars starting at index 75
2025-01-08 09:51:54,250 - INFO - Starting main AST analysis flow
2025-01-08 09:51:54,251 - INFO - Tokenized code into 192 tokens
2025-01-08 09:51:54,251 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:51:54,253 - INFO - Processing chunk #2 (size=356 chars, start_index=267)
2025-01-08 09:51:54,256 - INFO - Processing chunk with 356 chars starting at index 267
2025-01-08 09:51:54,256 - INFO - Starting main AST analysis flow
2025-01-08 09:51:54,256 - INFO - Tokenized code into 63 tokens
2025-01-08 09:51:54,256 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:51:54,261 - INFO - Processing chunk #3 (size=762 chars, start_index=330)
2025-01-08 09:51:54,262 - INFO - Processing chunk with 762 chars starting at index 330
2025-01-08 09:51:54,262 - INFO - Starting main AST analysis flow
2025-01-08 09:51:54,262 - INFO - Tokenized code into 145 tokens
2025-01-08 09:51:54,262 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:51:54,268 - INFO - Processing chunk #4 (size=589 chars, start_index=475)
2025-01-08 09:51:54,268 - INFO - Processing chunk with 589 chars starting at index 475
2025-01-08 09:51:54,268 - INFO - Starting main AST analysis flow
2025-01-08 09:51:54,269 - INFO - Tokenized code into 127 tokens
2025-01-08 09:51:54,269 - INFO - Starting Step 1: Initial AST node identification
2025-01-08 09:51:57,429 - INFO - Step 1 result: {'type': 'Program', 'name': 'test_block_credit_usage', 'range': [87, 265], 'children': []}
2025-01-08 09:51:57,429 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:51:58,115 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [330, 474], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_block_credit_reset', 'range': [342, 473], 'children': []}]}
2025-01-08 09:51:58,115 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:51:58,284 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [267, 329], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_block_credit_top_up', 'range': [279, 328], 'children': []}]}
2025-01-08 09:51:58,284 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:52:00,046 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [475, 601], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_credit_refill', 'range': [487, 568], 'children': []}, {'type': 'AssignmentExpression', 'name': 'user_credit.time_now', 'range': [569, 583], 'children': []}, {'type': 'AssignmentExpression', 'name': 'balance', 'range': [585, 594], 'children': []}, {'type': 'AssertStatement', 'name': '', 'range': [595, 600], 'children': []}]}
2025-01-08 09:52:00,046 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:52:02,255 - INFO - Step 1 result: {'type': 'Program', 'name': '', 'range': [0, 74], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 3], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 7], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 14], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [17, 24], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [26, 33], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [35, 42], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [44, 51], 'children': []}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 60], 'children': []}, {'type': 'VariableDeclaration', 'name': 'REFILL_VALUE', 'range': [63, 65], 'children': []}, {'type': 'VariableDeclaration', 'name': 'user_credit', 'range': [67, 72], 'children': []}]}
2025-01-08 09:52:02,255 - INFO - Starting Step 2: Detailed AST construction
2025-01-08 09:52:17,044 - INFO - Step 2 result: {'nodes': [{'type': 'FunctionDeclaration', 'name': 'test_credit_refill', 'range': [487, 568], 'children': [{'type': 'Decorator', 'name': '@pytest.mark.asyncio', 'range': [475, 485], 'children': []}, {'type': 'FunctionSignature', 'name': 'test_credit_refill', 'range': [487, 495], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [491, 494], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [496, 568], 'children': [{'type': 'Comment', 'name': '# Clear all transactions within the month', 'range': [497, 504], 'children': []}, {'type': 'AwaitExpression', 'name': 'await CreditTransaction.prisma().update_many', 'range': [505, 567], 'children': [{'type': 'CallExpression', 'name': 'update_many', 'range': [512, 567], 'children': [{'type': 'ObjectLiteral', 'name': 'where', 'range': [515, 555], 'children': [{'type': 'Property', 'name': 'userId', 'range': [519, 522], 'children': []}, {'type': 'Property', 'name': 'createdAt', 'range': [524, 552], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [526, 552], 'children': [{'type': 'Property', 'name': 'gte', 'range': [528, 538], 'children': []}, {'type': 'Property', 'name': 'lt', 'range': [540, 550], 'children': []}]}]}]}, {'type': 'ObjectLiteral', 'name': 'data', 'range': [558, 564], 'children': [{'type': 'Property', 'name': 'isActive', 'range': [561, 564], 'children': []}]}]}]}]}]}, {'type': 'AssignmentExpression', 'name': 'user_credit.time_now', 'range': [569, 583], 'children': [{'type': 'LambdaExpression', 'name': '', 'range': [573, 582], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [575, 582], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': 'balance', 'range': [585, 594], 'children': [{'type': 'AwaitExpression', 'name': 'await user_credit.get_or_refill_credit', 'range': [587, 593], 'children': []}]}, {'type': 'AssertStatement', 'name': '', 'range': [595, 600], 'children': [{'type': 'BinaryExpression', 'name': 'balance == REFILL_VALUE', 'range': [596, 600], 'children': []}]}]}
2025-01-08 09:52:17,045 - INFO - Starting Step 3: AST simplification
2025-01-08 09:52:18,624 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [267, 329], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_block_credit_top_up', 'range': [279, 328], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [279, 284], 'children': []}, {'type': 'FunctionName', 'name': 'test_block_credit_top_up', 'range': [280, 301], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [282, 286], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [283, 285], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [288, 328], 'children': [{'type': 'VariableDeclaration', 'name': 'current_credit', 'range': [289, 297], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [291, 297], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [292, 297], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [295, 297], 'children': [{'type': 'Argument', 'name': 'DEFAULT_USER_ID', 'range': [296, 297], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [300, 308], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [300, 308], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.top_up_credits', 'range': [301, 308], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [304, 308], 'children': [{'type': 'Argument', 'name': 'DEFAULT_USER_ID', 'range': [305, 306], 'children': []}, {'type': 'Argument', 'name': '100', 'range': [307, 308], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'new_credit', 'range': [311, 319], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [313, 319], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [314, 319], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [317, 319], 'children': [{'type': 'Argument', 'name': 'DEFAULT_USER_ID', 'range': [318, 319], 'children': []}]}]}]}, {'type': 'AssertStatement', 'name': '', 'range': [321, 327], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [323, 327], 'children': [{'type': 'Identifier', 'name': 'new_credit', 'range': [322, 323], 'children': []}, {'type': 'BinaryExpression', 'name': '+', 'range': [325, 327], 'children': [{'type': 'Identifier', 'name': 'current_credit', 'range': [325, 326], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [327, 327], 'children': []}]}]}]}]}]}]}
2025-01-08 09:52:18,624 - INFO - Starting Step 3: AST simplification
2025-01-08 09:52:19,700 - INFO - Step 2 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 3], 'children': [{'type': 'FromImport', 'name': 'datetime', 'range': [0, 3], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 7], 'children': [{'type': 'DirectImport', 'name': 'pytest', 'range': [6, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 14], 'children': [{'type': 'FromImport', 'name': 'prisma.models.CreditTransaction', 'range': [9, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [17, 24], 'children': [{'type': 'FromImport', 'name': 'backend.blocks.llm.AITextGeneratorBlock', 'range': [17, 24], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [26, 33], 'children': [{'type': 'FromImport', 'name': 'backend.data.credit.UserCredit', 'range': [26, 33], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [35, 42], 'children': [{'type': 'FromImport', 'name': 'backend.data.user.DEFAULT_USER_ID', 'range': [35, 42], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [44, 51], 'children': [{'type': 'FromImport', 'name': 'backend.integrations.credentials_store.openai_credentials', 'range': [44, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 60], 'children': [{'type': 'FromImport', 'name': 'backend.util.test.SpinTestServer', 'range': [53, 60], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'REFILL_VALUE', 'range': [63, 65], 'children': [{'type': 'Assignment', 'name': '=', 'range': [64, 65], 'children': [{'type': 'Literal', 'name': '1000', 'range': [65, 65], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'user_credit', 'range': [67, 72], 'children': [{'type': 'Assignment', 'name': '=', 'range': [68, 72], 'children': [{'type': 'CallExpression', 'name': 'UserCredit', 'range': [69, 72], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [70, 72], 'children': [{'type': 'Identifier', 'name': 'REFILL_VALUE', 'range': [71, 71], 'children': []}]}]}]}]}]}
2025-01-08 09:52:19,700 - INFO - Starting Step 3: AST simplification
2025-01-08 09:52:33,758 - INFO - Step 3 result: {'nodes': [{'type': 'FunctionDeclaration', 'name': 'test_credit_refill', 'range': [487, 568], 'children': [{'type': 'Decorator', 'name': '@pytest.mark.asyncio', 'range': [475, 485], 'children': []}, {'type': 'FunctionSignature', 'name': 'test_credit_refill', 'range': [487, 495], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [491, 494], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [496, 568], 'children': [{'type': 'Comment', 'name': '# Clear all transactions within the month', 'range': [497, 504], 'children': []}, {'type': 'AwaitExpression', 'name': 'await CreditTransaction.prisma().update_many', 'range': [505, 567], 'children': [{'type': 'CallExpression', 'name': 'update_many', 'range': [512, 567], 'children': [{'type': 'ObjectLiteral', 'name': 'where', 'range': [515, 555], 'children': [{'type': 'Property', 'name': 'userId', 'range': [519, 522], 'children': []}, {'type': 'Property', 'name': 'createdAt', 'range': [524, 552], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [526, 552], 'children': [{'type': 'Property', 'name': 'gte', 'range': [528, 538], 'children': []}, {'type': 'Property', 'name': 'lt', 'range': [540, 550], 'children': []}]}]}]}, {'type': 'ObjectLiteral', 'name': 'data', 'range': [558, 564], 'children': [{'type': 'Property', 'name': 'isActive', 'range': [561, 564], 'children': []}]}]}]}]}]}, {'type': 'AssignmentExpression', 'name': 'user_credit.time_now', 'range': [569, 583], 'children': [{'type': 'LambdaExpression', 'name': '', 'range': [573, 582], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [575, 582], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': 'balance', 'range': [585, 594], 'children': [{'type': 'AwaitExpression', 'name': 'await user_credit.get_or_refill_credit', 'range': [587, 593], 'children': []}]}, {'type': 'AssertStatement', 'name': '', 'range': [595, 600], 'children': [{'type': 'BinaryExpression', 'name': 'balance == REFILL_VALUE', 'range': [596, 600], 'children': []}]}]}
2025-01-08 09:52:33,759 - INFO - Starting Step 4: AST normalization
2025-01-08 09:52:35,496 - INFO - Step 2 result: {'type': 'Program', 'name': 'test_block_credit_usage', 'range': [87, 265], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_block_credit_usage', 'range': [87, 265], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [91, 93], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [96, 265], 'children': [{'type': 'VariableDeclaration', 'name': 'current_credit', 'range': [97, 105], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [99, 105], 'children': [{'type': 'CallExpression', 'name': 'get_or_refill_credit', 'range': [100, 105], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [104, 105], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'spending_amount_1', 'range': [108, 182], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [110, 182], 'children': [{'type': 'CallExpression', 'name': 'spend_credits', 'range': [111, 182], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [116, 117], 'children': []}, {'type': 'Identifier', 'name': 'current_credit', 'range': [119, 120], 'children': []}, {'type': 'CallExpression', 'name': 'AITextGeneratorBlock', 'range': [122, 127], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [129, 164], 'children': [{'type': 'Property', 'name': 'model', 'range': [131, 133], 'children': []}, {'type': 'Property', 'name': 'credentials', 'range': [136, 161], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [138, 161], 'children': [{'type': 'Property', 'name': 'id', 'range': [140, 145], 'children': []}, {'type': 'Property', 'name': 'provider', 'range': [147, 152], 'children': []}, {'type': 'Property', 'name': 'type', 'range': [154, 159], 'children': []}]}]}]}, {'type': 'Literal', 'name': '0.0', 'range': [167, 170], 'children': []}, {'type': 'Literal', 'name': '0.0', 'range': [172, 175], 'children': []}, {'type': 'AssignmentExpression', 'name': 'validate_balance', 'range': [177, 180], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [184, 188], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [185, 187], 'children': [{'type': 'Identifier', 'name': 'spending_amount_1', 'range': [185, 186], 'children': []}, {'type': 'Literal', 'name': '0', 'range': [187, 188], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'spending_amount_2', 'range': [190, 237], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [192, 237], 'children': [{'type': 'CallExpression', 'name': 'spend_credits', 'range': [193, 237], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [198, 199], 'children': []}, {'type': 'Identifier', 'name': 'current_credit', 'range': [201, 202], 'children': []}, {'type': 'CallExpression', 'name': 'AITextGeneratorBlock', 'range': [204, 209], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [211, 219], 'children': [{'type': 'Property', 'name': 'model', 'range': [212, 214], 'children': []}, {'type': 'Property', 'name': 'api_key', 'range': [216, 218], 'children': []}]}, {'type': 'Literal', 'name': '0.0', 'range': [222, 225], 'children': []}, {'type': 'Literal', 'name': '0.0', 'range': [227, 230], 'children': []}, {'type': 'AssignmentExpression', 'name': 'validate_balance', 'range': [232, 235], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [239, 244], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [240, 243], 'children': [{'type': 'Identifier', 'name': 'spending_amount_2', 'range': [240, 241], 'children': []}, {'type': 'Literal', 'name': '0', 'range': [242, 243], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'new_credit', 'range': [246, 254], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [248, 254], 'children': [{'type': 'CallExpression', 'name': 'get_or_refill_credit', 'range': [249, 254], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [253, 254], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [256, 265], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [257, 264], 'children': [{'type': 'Identifier', 'name': 'new_credit', 'range': [257, 258], 'children': []}, {'type': 'BinaryExpression', 'name': '', 'range': [259, 264], 'children': [{'type': 'Identifier', 'name': 'current_credit', 'range': [259, 260], 'children': []}, {'type': 'BinaryExpression', 'name': '', 'range': [261, 264], 'children': [{'type': 'Identifier', 'name': 'spending_amount_1', 'range': [261, 262], 'children': []}, {'type': 'Identifier', 'name': 'spending_amount_2', 'range': [263, 264], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:52:35,497 - INFO - Starting Step 3: AST simplification
2025-01-08 09:52:36,077 - INFO - Step 2 result: {'type': 'Program', 'name': '', 'range': [330, 474], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_block_credit_reset', 'range': [342, 473], 'children': [{'type': 'VariableDeclaration', 'name': 'month1', 'range': [352, 361], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [354, 361], 'children': [{'type': 'Literal', 'name': '2022', 'range': [356, 356], 'children': []}, {'type': 'Literal', 'name': '1', 'range': [358, 358], 'children': []}, {'type': 'Literal', 'name': '15', 'range': [360, 360], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'month2', 'range': [363, 372], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [365, 372], 'children': [{'type': 'Literal', 'name': '2022', 'range': [367, 367], 'children': []}, {'type': 'Literal', 'name': '2', 'range': [369, 369], 'children': []}, {'type': 'Literal', 'name': '15', 'range': [371, 371], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [375, 382], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [378, 382], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [375, 377], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [379, 382], 'children': [{'type': 'Identifier', 'name': 'month2', 'range': [381, 381], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'month2credit', 'range': [383, 392], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [385, 392], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [386, 392], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [390, 390], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [404, 411], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [407, 411], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [404, 406], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [408, 411], 'children': [{'type': 'Identifier', 'name': 'month1', 'range': [410, 410], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'month1credit', 'range': [412, 421], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [414, 421], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [415, 421], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [419, 419], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [422, 431], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [422, 431], 'children': [{'type': 'CallExpression', 'name': 'user_credit.top_up_credits', 'range': [423, 431], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [427, 427], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [429, 429], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [432, 445], 'children': [{'type': 'AssertStatement', 'name': '', 'range': [432, 445], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [440, 445], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [433, 439], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [434, 439], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [438, 438], 'children': []}]}]}, {'type': 'BinaryExpression', 'name': '+', 'range': [443, 445], 'children': [{'type': 'Identifier', 'name': 'month1credit', 'range': [442, 442], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [444, 444], 'children': []}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [454, 461], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [457, 461], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [454, 456], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [458, 461], 'children': [{'type': 'Identifier', 'name': 'month2', 'range': [460, 460], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [462, 473], 'children': [{'type': 'AssertStatement', 'name': '', 'range': [462, 473], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [470, 473], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [463, 469], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [464, 469], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [468, 468], 'children': []}]}]}, {'type': 'Identifier', 'name': 'month2credit', 'range': [472, 472], 'children': []}]}]}]}]}]}
2025-01-08 09:52:36,078 - INFO - Starting Step 3: AST simplification
2025-01-08 09:52:37,010 - INFO - Step 3 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 3], 'children': [{'type': 'FromImport', 'name': 'datetime', 'range': [0, 3], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 7], 'children': [{'type': 'DirectImport', 'name': 'pytest', 'range': [6, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 14], 'children': [{'type': 'FromImport', 'name': 'prisma.models.CreditTransaction', 'range': [9, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [17, 24], 'children': [{'type': 'FromImport', 'name': 'backend.blocks.llm.AITextGeneratorBlock', 'range': [17, 24], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [26, 33], 'children': [{'type': 'FromImport', 'name': 'backend.data.credit.UserCredit', 'range': [26, 33], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [35, 42], 'children': [{'type': 'FromImport', 'name': 'backend.data.user.DEFAULT_USER_ID', 'range': [35, 42], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [44, 51], 'children': [{'type': 'FromImport', 'name': 'backend.integrations.credentials_store.openai_credentials', 'range': [44, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 60], 'children': [{'type': 'FromImport', 'name': 'backend.util.test.SpinTestServer', 'range': [53, 60], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'REFILL_VALUE', 'range': [63, 65], 'children': [{'type': 'Assignment', 'name': '=', 'range': [64, 65], 'children': [{'type': 'Literal', 'name': '1000', 'range': [65, 65], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'user_credit', 'range': [67, 72], 'children': [{'type': 'Assignment', 'name': '=', 'range': [68, 72], 'children': [{'type': 'CallExpression', 'name': 'UserCredit', 'range': [69, 72], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [70, 72], 'children': [{'type': 'Identifier', 'name': 'REFILL_VALUE', 'range': [71, 71], 'children': []}]}]}]}]}]}
2025-01-08 09:52:37,010 - INFO - Starting Step 4: AST normalization
2025-01-08 09:52:38,926 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [267, 329], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_block_credit_top_up', 'range': [279, 328], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [279, 284], 'children': []}, {'type': 'FunctionName', 'name': 'test_block_credit_top_up', 'range': [280, 301], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [282, 286], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [283, 285], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [288, 328], 'children': [{'type': 'VariableDeclaration', 'name': 'current_credit', 'range': [289, 297], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [291, 297], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [292, 297], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [295, 297], 'children': [{'type': 'Argument', 'name': 'DEFAULT_USER_ID', 'range': [296, 297], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [300, 308], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [300, 308], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.top_up_credits', 'range': [301, 308], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [304, 308], 'children': [{'type': 'Argument', 'name': 'DEFAULT_USER_ID', 'range': [305, 306], 'children': []}, {'type': 'Argument', 'name': '100', 'range': [307, 308], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'new_credit', 'range': [311, 319], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [313, 319], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [314, 319], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [317, 319], 'children': [{'type': 'Argument', 'name': 'DEFAULT_USER_ID', 'range': [318, 319], 'children': []}]}]}]}, {'type': 'AssertStatement', 'name': '', 'range': [321, 327], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [323, 327], 'children': [{'type': 'Identifier', 'name': 'new_credit', 'range': [322, 323], 'children': []}, {'type': 'BinaryExpression', 'name': '+', 'range': [325, 327], 'children': [{'type': 'Identifier', 'name': 'current_credit', 'range': [325, 326], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [327, 327], 'children': []}]}]}]}]}]}]}
2025-01-08 09:52:38,926 - INFO - Starting Step 4: AST normalization
2025-01-08 09:52:50,466 - INFO - Step 4 result: {'nodes': [{'type': 'FunctionDecl', 'name': 'test_credit_refill', 'range': [487, 568], 'children': [{'type': 'Decorator', 'name': '@pytest.mark.asyncio', 'range': [475, 485], 'children': []}, {'type': 'FunctionSignature', 'name': 'test_credit_refill', 'range': [487, 495], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [491, 494], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [496, 568], 'children': [{'type': 'Comment', 'name': '# Clear all transactions within the month', 'range': [497, 504], 'children': []}, {'type': 'AwaitExpression', 'name': 'await CreditTransaction.prisma().update_many', 'range': [505, 567], 'children': [{'type': 'CallExpression', 'name': 'update_many', 'range': [512, 567], 'children': [{'type': 'ObjectLiteral', 'name': 'where', 'range': [515, 555], 'children': [{'type': 'Property', 'name': 'userId', 'range': [519, 522], 'children': []}, {'type': 'Property', 'name': 'createdAt', 'range': [524, 552], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [526, 552], 'children': [{'type': 'Property', 'name': 'gte', 'range': [528, 538], 'children': []}, {'type': 'Property', 'name': 'lt', 'range': [540, 550], 'children': []}]}]}]}, {'type': 'ObjectLiteral', 'name': 'data', 'range': [558, 564], 'children': [{'type': 'Property', 'name': 'isActive', 'range': [561, 564], 'children': []}]}]}]}]}]}, {'type': 'AssignmentExpression', 'name': 'user_credit.time_now', 'range': [569, 583], 'children': [{'type': 'LambdaExpression', 'name': '', 'range': [573, 582], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [575, 582], 'children': []}]}]}, {'type': 'AssignmentExpression', 'name': 'balance', 'range': [585, 594], 'children': [{'type': 'AwaitExpression', 'name': 'await user_credit.get_or_refill_credit', 'range': [587, 593], 'children': []}]}, {'type': 'AssertStatement', 'name': '', 'range': [595, 600], 'children': [{'type': 'BinaryExpression', 'name': 'balance == REFILL_VALUE', 'range': [596, 600], 'children': []}]}]}
2025-01-08 09:52:50,467 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:52:55,068 - INFO - Step 4 result: {'nodes': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 3], 'children': [{'type': 'FromImport', 'name': 'datetime', 'range': [0, 3], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 7], 'children': [{'type': 'DirectImport', 'name': 'pytest', 'range': [6, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 14], 'children': [{'type': 'FromImport', 'name': 'prisma.models.CreditTransaction', 'range': [9, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [17, 24], 'children': [{'type': 'FromImport', 'name': 'backend.blocks.llm.AITextGeneratorBlock', 'range': [17, 24], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [26, 33], 'children': [{'type': 'FromImport', 'name': 'backend.data.credit.UserCredit', 'range': [26, 33], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [35, 42], 'children': [{'type': 'FromImport', 'name': 'backend.data.user.DEFAULT_USER_ID', 'range': [35, 42], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [44, 51], 'children': [{'type': 'FromImport', 'name': 'backend.integrations.credentials_store.openai_credentials', 'range': [44, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 60], 'children': [{'type': 'FromImport', 'name': 'backend.util.test.SpinTestServer', 'range': [53, 60], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'REFILL_VALUE', 'range': [63, 65], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [64, 65], 'children': [{'type': 'Literal', 'name': '1000', 'range': [65, 65], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'user_credit', 'range': [67, 72], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [68, 72], 'children': [{'type': 'CallExpression', 'name': 'UserCredit', 'range': [69, 72], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [70, 72], 'children': [{'type': 'Identifier', 'name': 'REFILL_VALUE', 'range': [71, 71], 'children': []}]}]}]}]}]}
2025-01-08 09:52:55,068 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:52:59,662 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [267, 329], 'children': [{'type': 'FunctionDecl', 'name': 'test_block_credit_top_up', 'range': [279, 328], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [279, 284], 'children': []}, {'type': 'FunctionName', 'name': 'test_block_credit_top_up', 'range': [280, 301], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [282, 286], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [283, 285], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [288, 328], 'children': [{'type': 'VariableDecl', 'name': 'current_credit', 'range': [289, 297], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [291, 297], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [292, 297], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [295, 297], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [296, 297], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [300, 308], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [300, 308], 'children': [{'type': 'CallExpression', 'name': 'user_credit.top_up_credits', 'range': [301, 308], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [304, 308], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [305, 306], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [307, 308], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'new_credit', 'range': [311, 319], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [313, 319], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [314, 319], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [317, 319], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [318, 319], 'children': []}]}]}]}, {'type': 'AssertStatement', 'name': '', 'range': [321, 327], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [323, 327], 'children': [{'type': 'Identifier', 'name': 'new_credit', 'range': [322, 323], 'children': []}, {'type': 'BinaryExpression', 'name': '+', 'range': [325, 327], 'children': [{'type': 'Identifier', 'name': 'current_credit', 'range': [325, 326], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [327, 327], 'children': []}]}]}]}]}]}]}
2025-01-08 09:52:59,663 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:53:11,512 - INFO - Step 5 result: {'nodes': [{'type': 'Program', 'name': 'test_credit_refill', 'range': [475, 568], 'children': [{'type': 'FunctionDecl', 'name': 'test_credit_refill', 'range': [487, 568], 'children': [{'type': 'Decorator', 'name': '@pytest.mark.asyncio', 'range': [475, 485], 'children': []}, {'type': 'FunctionSignature', 'name': 'test_credit_refill', 'range': [487, 495], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [491, 494], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [496, 568], 'children': [{'type': 'Comment', 'name': '# Clear all transactions within the month', 'range': [497, 504], 'children': []}, {'type': 'AwaitExpression', 'name': 'await CreditTransaction.prisma().update_many', 'range': [505, 567], 'children': [{'type': 'CallExpression', 'name': 'update_many', 'range': [512, 567], 'children': [{'type': 'ObjectLiteral', 'name': 'where', 'range': [515, 555], 'children': [{'type': 'Property', 'name': 'userId', 'range': [519, 522], 'children': []}, {'type': 'Property', 'name': 'createdAt', 'range': [524, 552], 'children': [{'type': 'ObjectLiteral', 'name': '', 'range': [526, 552], 'children': [{'type': 'Property', 'name': 'gte', 'range': [528, 538], 'children': []}, {'type': 'Property', 'name': 'lt', 'range': [540, 550], 'children': []}]}]}]}, {'type': 'ObjectLiteral', 'name': 'data', 'range': [558, 564], 'children': [{'type': 'Property', 'name': 'isActive', 'range': [561, 564], 'children': []}]}]}]}]}]}]}, {'type': 'Program', 'name': 'user_credit_time_now', 'range': [569, 583], 'children': [{'type': 'AssignmentExpression', 'name': 'user_credit.time_now', 'range': [569, 583], 'children': [{'type': 'LambdaExpression', 'name': '', 'range': [573, 582], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [575, 582], 'children': []}]}]}]}, {'type': 'Program', 'name': 'balance_assignment', 'range': [585, 594], 'children': [{'type': 'AssignmentExpression', 'name': 'balance', 'range': [585, 594], 'children': [{'type': 'AwaitExpression', 'name': 'await user_credit.get_or_refill_credit', 'range': [587, 593], 'children': []}]}]}, {'type': 'Program', 'name': 'assert_statement', 'range': [595, 600], 'children': [{'type': 'AssertStatement', 'name': '', 'range': [595, 600], 'children': [{'type': 'BinaryExpression', 'name': 'balance == REFILL_VALUE', 'range': [596, 600], 'children': []}]}]}]}
2025-01-08 09:53:11,512 - INFO - Completed main AST analysis flow
2025-01-08 09:53:11,512 - INFO - Successfully processed chunk
2025-01-08 09:53:13,545 - INFO - Step 5 result: {'type': 'Program', 'name': 'MainOrSomething', 'range': [0, 72], 'children': [{'type': 'ImportDeclaration', 'name': '', 'range': [0, 3], 'children': [{'type': 'FromImport', 'name': 'datetime', 'range': [0, 3], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [6, 7], 'children': [{'type': 'DirectImport', 'name': 'pytest', 'range': [6, 7], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [9, 14], 'children': [{'type': 'FromImport', 'name': 'prisma.models.CreditTransaction', 'range': [9, 14], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [17, 24], 'children': [{'type': 'FromImport', 'name': 'backend.blocks.llm.AITextGeneratorBlock', 'range': [17, 24], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [26, 33], 'children': [{'type': 'FromImport', 'name': 'backend.data.credit.UserCredit', 'range': [26, 33], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [35, 42], 'children': [{'type': 'FromImport', 'name': 'backend.data.user.DEFAULT_USER_ID', 'range': [35, 42], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [44, 51], 'children': [{'type': 'FromImport', 'name': 'backend.integrations.credentials_store.openai_credentials', 'range': [44, 51], 'children': []}]}, {'type': 'ImportDeclaration', 'name': '', 'range': [53, 60], 'children': [{'type': 'FromImport', 'name': 'backend.util.test.SpinTestServer', 'range': [53, 60], 'children': []}]}, {'type': 'VariableDeclaration', 'name': 'REFILL_VALUE', 'range': [63, 65], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [64, 65], 'children': [{'type': 'Literal', 'name': '1000', 'range': [65, 65], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'user_credit', 'range': [67, 72], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [68, 72], 'children': [{'type': 'CallExpression', 'name': 'UserCredit', 'range': [69, 72], 'children': [{'type': 'ArgumentList', 'name': '', 'range': [70, 72], 'children': [{'type': 'Identifier', 'name': 'REFILL_VALUE', 'range': [71, 71], 'children': []}]}]}]}]}]}
2025-01-08 09:53:13,545 - INFO - Completed main AST analysis flow
2025-01-08 09:53:13,546 - INFO - Successfully processed chunk
2025-01-08 09:53:14,944 - INFO - Step 3 result: {'type': 'Program', 'name': 'test_block_credit_usage', 'range': [87, 265], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_block_credit_usage', 'range': [87, 265], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [91, 93], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [96, 265], 'children': [{'type': 'VariableDeclaration', 'name': 'current_credit', 'range': [97, 105], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [99, 105], 'children': [{'type': 'CallExpression', 'name': 'get_or_refill_credit', 'range': [100, 105], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [104, 105], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'spending_amount_1', 'range': [108, 182], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [110, 182], 'children': [{'type': 'CallExpression', 'name': 'spend_credits', 'range': [111, 182], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [116, 117], 'children': []}, {'type': 'Identifier', 'name': 'current_credit', 'range': [119, 120], 'children': []}, {'type': 'CallExpression', 'name': 'AITextGeneratorBlock', 'range': [122, 127], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [129, 164], 'children': [{'type': 'Property', 'name': 'model', 'range': [131, 133], 'children': []}, {'type': 'Property', 'name': 'credentials', 'range': [136, 161], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [138, 161], 'children': [{'type': 'Property', 'name': 'id', 'range': [140, 145], 'children': []}, {'type': 'Property', 'name': 'provider', 'range': [147, 152], 'children': []}, {'type': 'Property', 'name': 'type', 'range': [154, 159], 'children': []}]}]}]}, {'type': 'Literal', 'name': '0.0', 'range': [167, 170], 'children': []}, {'type': 'Literal', 'name': '0.0', 'range': [172, 175], 'children': []}, {'type': 'AssignmentExpression', 'name': 'validate_balance', 'range': [177, 180], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [184, 188], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [185, 187], 'children': [{'type': 'Identifier', 'name': 'spending_amount_1', 'range': [185, 186], 'children': []}, {'type': 'Literal', 'name': '0', 'range': [187, 188], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'spending_amount_2', 'range': [190, 237], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [192, 237], 'children': [{'type': 'CallExpression', 'name': 'spend_credits', 'range': [193, 237], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [198, 199], 'children': []}, {'type': 'Identifier', 'name': 'current_credit', 'range': [201, 202], 'children': []}, {'type': 'CallExpression', 'name': 'AITextGeneratorBlock', 'range': [204, 209], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [211, 219], 'children': [{'type': 'Property', 'name': 'model', 'range': [212, 214], 'children': []}, {'type': 'Property', 'name': 'api_key', 'range': [216, 218], 'children': []}]}, {'type': 'Literal', 'name': '0.0', 'range': [222, 225], 'children': []}, {'type': 'Literal', 'name': '0.0', 'range': [227, 230], 'children': []}, {'type': 'AssignmentExpression', 'name': 'validate_balance', 'range': [232, 235], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [239, 244], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [240, 243], 'children': [{'type': 'Identifier', 'name': 'spending_amount_2', 'range': [240, 241], 'children': []}, {'type': 'Literal', 'name': '0', 'range': [242, 243], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'new_credit', 'range': [246, 254], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [248, 254], 'children': [{'type': 'CallExpression', 'name': 'get_or_refill_credit', 'range': [249, 254], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [253, 254], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [256, 265], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [257, 264], 'children': [{'type': 'Identifier', 'name': 'new_credit', 'range': [257, 258], 'children': []}, {'type': 'BinaryExpression', 'name': '', 'range': [259, 264], 'children': [{'type': 'Identifier', 'name': 'current_credit', 'range': [259, 260], 'children': []}, {'type': 'BinaryExpression', 'name': '', 'range': [261, 264], 'children': [{'type': 'Identifier', 'name': 'spending_amount_1', 'range': [261, 262], 'children': []}, {'type': 'Identifier', 'name': 'spending_amount_2', 'range': [263, 264], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:53:14,944 - INFO - Starting Step 4: AST normalization
2025-01-08 09:53:15,261 - INFO - Step 3 result: {'type': 'Program', 'name': '', 'range': [330, 474], 'children': [{'type': 'FunctionDeclaration', 'name': 'test_block_credit_reset', 'range': [342, 473], 'children': [{'type': 'VariableDeclaration', 'name': 'month1', 'range': [352, 361], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [354, 361], 'children': [{'type': 'Literal', 'name': '2022', 'range': [356, 356], 'children': []}, {'type': 'Literal', 'name': '1', 'range': [358, 358], 'children': []}, {'type': 'Literal', 'name': '15', 'range': [360, 360], 'children': []}]}]}, {'type': 'VariableDeclaration', 'name': 'month2', 'range': [363, 372], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [365, 372], 'children': [{'type': 'Literal', 'name': '2022', 'range': [367, 367], 'children': []}, {'type': 'Literal', 'name': '2', 'range': [369, 369], 'children': []}, {'type': 'Literal', 'name': '15', 'range': [371, 371], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [375, 382], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [378, 382], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [375, 377], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [379, 382], 'children': [{'type': 'Identifier', 'name': 'month2', 'range': [381, 381], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'month2credit', 'range': [383, 392], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [385, 392], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [386, 392], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [390, 390], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [404, 411], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [407, 411], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [404, 406], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [408, 411], 'children': [{'type': 'Identifier', 'name': 'month1', 'range': [410, 410], 'children': []}]}]}]}, {'type': 'VariableDeclaration', 'name': 'month1credit', 'range': [412, 421], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [414, 421], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [415, 421], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [419, 419], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [422, 431], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [422, 431], 'children': [{'type': 'CallExpression', 'name': 'user_credit.top_up_credits', 'range': [423, 431], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [427, 427], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [429, 429], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [432, 445], 'children': [{'type': 'AssertStatement', 'name': '', 'range': [432, 445], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [440, 445], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [433, 439], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [434, 439], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [438, 438], 'children': []}]}]}, {'type': 'BinaryExpression', 'name': '+', 'range': [443, 445], 'children': [{'type': 'Identifier', 'name': 'month1credit', 'range': [442, 442], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [444, 444], 'children': []}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [454, 461], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [457, 461], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [454, 456], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [458, 461], 'children': [{'type': 'Identifier', 'name': 'month2', 'range': [460, 460], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [462, 473], 'children': [{'type': 'AssertStatement', 'name': '', 'range': [462, 473], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [470, 473], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [463, 469], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [464, 469], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [468, 468], 'children': []}]}]}, {'type': 'Identifier', 'name': 'month2credit', 'range': [472, 472], 'children': []}]}]}]}]}]}
2025-01-08 09:53:15,261 - INFO - Starting Step 4: AST normalization
2025-01-08 09:53:22,048 - INFO - Step 5 result: {'type': 'Program', 'name': '', 'range': [267, 329], 'children': [{'type': 'FunctionDecl', 'name': 'test_block_credit_top_up', 'range': [279, 328], 'children': [{'type': 'AsyncKeyword', 'name': 'async', 'range': [279, 284], 'children': []}, {'type': 'FunctionName', 'name': 'test_block_credit_top_up', 'range': [280, 301], 'children': []}, {'type': 'ParameterList', 'name': '', 'range': [282, 286], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [283, 285], 'children': []}]}, {'type': 'FunctionBody', 'name': '', 'range': [288, 328], 'children': [{'type': 'VariableDecl', 'name': 'current_credit', 'range': [289, 297], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [291, 297], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [292, 297], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [295, 297], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [296, 297], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [300, 308], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [300, 308], 'children': [{'type': 'CallExpression', 'name': 'user_credit.top_up_credits', 'range': [301, 308], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [304, 308], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [305, 306], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [307, 308], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'new_credit', 'range': [311, 319], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [313, 319], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [314, 319], 'children': []}, {'type': 'ArgumentList', 'name': '', 'range': [317, 319], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [318, 319], 'children': []}]}]}]}, {'type': 'AssertStatement', 'name': '', 'range': [321, 327], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [323, 327], 'children': [{'type': 'Identifier', 'name': 'new_credit', 'range': [322, 323], 'children': []}, {'type': 'BinaryExpression', 'name': '+', 'range': [325, 327], 'children': [{'type': 'Identifier', 'name': 'current_credit', 'range': [325, 326], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [327, 327], 'children': []}]}]}]}]}]}]}
2025-01-08 09:53:22,049 - INFO - Completed main AST analysis flow
2025-01-08 09:53:22,050 - INFO - Successfully processed chunk
2025-01-08 09:53:55,847 - INFO - Step 4 result: {'type': 'Program', 'name': 'test_block_credit_usage', 'range': [87, 265], 'children': [{'type': 'FunctionDecl', 'name': 'test_block_credit_usage', 'range': [87, 265], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [91, 93], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [96, 265], 'children': [{'type': 'VariableDecl', 'name': 'current_credit', 'range': [97, 105], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [99, 105], 'children': [{'type': 'CallExpression', 'name': 'get_or_refill_credit', 'range': [100, 105], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [104, 105], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'spending_amount_1', 'range': [108, 182], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [110, 182], 'children': [{'type': 'CallExpression', 'name': 'spend_credits', 'range': [111, 182], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [116, 117], 'children': []}, {'type': 'Identifier', 'name': 'current_credit', 'range': [119, 120], 'children': []}, {'type': 'CallExpression', 'name': 'AITextGeneratorBlock', 'range': [122, 127], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [129, 164], 'children': [{'type': 'Property', 'name': 'model', 'range': [131, 133], 'children': []}, {'type': 'Property', 'name': 'credentials', 'range': [136, 161], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [138, 161], 'children': [{'type': 'Property', 'name': 'id', 'range': [140, 145], 'children': []}, {'type': 'Property', 'name': 'provider', 'range': [147, 152], 'children': []}, {'type': 'Property', 'name': 'type', 'range': [154, 159], 'children': []}]}]}]}, {'type': 'Literal', 'name': '0.0', 'range': [167, 170], 'children': []}, {'type': 'Literal', 'name': '0.0', 'range': [172, 175], 'children': []}, {'type': 'AssignmentExpression', 'name': 'validate_balance', 'range': [177, 180], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [184, 188], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [185, 187], 'children': [{'type': 'Identifier', 'name': 'spending_amount_1', 'range': [185, 186], 'children': []}, {'type': 'Literal', 'name': '0', 'range': [187, 188], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'spending_amount_2', 'range': [190, 237], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [192, 237], 'children': [{'type': 'CallExpression', 'name': 'spend_credits', 'range': [193, 237], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [198, 199], 'children': []}, {'type': 'Identifier', 'name': 'current_credit', 'range': [201, 202], 'children': []}, {'type': 'CallExpression', 'name': 'AITextGeneratorBlock', 'range': [204, 209], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [211, 219], 'children': [{'type': 'Property', 'name': 'model', 'range': [212, 214], 'children': []}, {'type': 'Property', 'name': 'api_key', 'range': [216, 218], 'children': []}]}, {'type': 'Literal', 'name': '0.0', 'range': [222, 225], 'children': []}, {'type': 'Literal', 'name': '0.0', 'range': [227, 230], 'children': []}, {'type': 'AssignmentExpression', 'name': 'validate_balance', 'range': [232, 235], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [239, 244], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [240, 243], 'children': [{'type': 'Identifier', 'name': 'spending_amount_2', 'range': [240, 241], 'children': []}, {'type': 'Literal', 'name': '0', 'range': [242, 243], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'new_credit', 'range': [246, 254], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [248, 254], 'children': [{'type': 'CallExpression', 'name': 'get_or_refill_credit', 'range': [249, 254], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [253, 254], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [256, 265], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [257, 264], 'children': [{'type': 'Identifier', 'name': 'new_credit', 'range': [257, 258], 'children': []}, {'type': 'BinaryExpression', 'name': '', 'range': [259, 264], 'children': [{'type': 'Identifier', 'name': 'current_credit', 'range': [259, 260], 'children': []}, {'type': 'BinaryExpression', 'name': '', 'range': [261, 264], 'children': [{'type': 'Identifier', 'name': 'spending_amount_1', 'range': [261, 262], 'children': []}, {'type': 'Identifier', 'name': 'spending_amount_2', 'range': [263, 264], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:53:55,848 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:53:56,190 - INFO - Step 4 result: {'type': 'Program', 'name': '', 'range': [330, 474], 'children': [{'type': 'FunctionDecl', 'name': 'test_block_credit_reset', 'range': [342, 473], 'children': [{'type': 'VariableDecl', 'name': 'month1', 'range': [352, 361], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [354, 361], 'children': [{'type': 'Literal', 'name': '2022', 'range': [356, 356], 'children': []}, {'type': 'Literal', 'name': '1', 'range': [358, 358], 'children': []}, {'type': 'Literal', 'name': '15', 'range': [360, 360], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'month2', 'range': [363, 372], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [365, 372], 'children': [{'type': 'Literal', 'name': '2022', 'range': [367, 367], 'children': []}, {'type': 'Literal', 'name': '2', 'range': [369, 369], 'children': []}, {'type': 'Literal', 'name': '15', 'range': [371, 371], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [375, 382], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [378, 382], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [375, 377], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [379, 382], 'children': [{'type': 'Identifier', 'name': 'month2', 'range': [381, 381], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'month2credit', 'range': [383, 392], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [385, 392], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [386, 392], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [390, 390], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [404, 411], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [407, 411], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [404, 406], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [408, 411], 'children': [{'type': 'Identifier', 'name': 'month1', 'range': [410, 410], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'month1credit', 'range': [412, 421], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [414, 421], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [415, 421], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [419, 419], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [422, 431], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [422, 431], 'children': [{'type': 'CallExpression', 'name': 'user_credit.top_up_credits', 'range': [423, 431], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [427, 427], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [429, 429], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [432, 445], 'children': [{'type': 'AssertStatement', 'name': '', 'range': [432, 445], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [440, 445], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [433, 439], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [434, 439], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [438, 438], 'children': []}]}]}, {'type': 'BinaryExpression', 'name': '+', 'range': [443, 445], 'children': [{'type': 'Identifier', 'name': 'month1credit', 'range': [442, 442], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [444, 444], 'children': []}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [454, 461], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [457, 461], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [454, 456], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [458, 461], 'children': [{'type': 'Identifier', 'name': 'month2', 'range': [460, 460], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [462, 473], 'children': [{'type': 'AssertStatement', 'name': '', 'range': [462, 473], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [470, 473], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [463, 469], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [464, 469], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [468, 468], 'children': []}]}]}, {'type': 'Identifier', 'name': 'month2credit', 'range': [472, 472], 'children': []}]}]}]}]}]}
2025-01-08 09:53:56,190 - INFO - Starting Step 5: Final AST combination
2025-01-08 09:54:34,902 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_block_credit_reset', 'range': [330, 474], 'children': [{'type': 'VariableDecl', 'name': 'month1', 'range': [352, 361], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [354, 361], 'children': [{'type': 'Literal', 'name': '2022', 'range': [356, 356], 'children': []}, {'type': 'Literal', 'name': '1', 'range': [358, 358], 'children': []}, {'type': 'Literal', 'name': '15', 'range': [360, 360], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'month2', 'range': [363, 372], 'children': [{'type': 'CallExpression', 'name': 'datetime', 'range': [365, 372], 'children': [{'type': 'Literal', 'name': '2022', 'range': [367, 367], 'children': []}, {'type': 'Literal', 'name': '2', 'range': [369, 369], 'children': []}, {'type': 'Literal', 'name': '15', 'range': [371, 371], 'children': []}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [375, 382], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [378, 382], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [375, 377], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [379, 382], 'children': [{'type': 'Identifier', 'name': 'month2', 'range': [381, 381], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'month2credit', 'range': [383, 392], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [385, 392], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [386, 392], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [390, 390], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [404, 411], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [407, 411], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [404, 406], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [408, 411], 'children': [{'type': 'Identifier', 'name': 'month1', 'range': [410, 410], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'month1credit', 'range': [412, 421], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [414, 421], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [415, 421], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [419, 419], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [422, 431], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [422, 431], 'children': [{'type': 'CallExpression', 'name': 'user_credit.top_up_credits', 'range': [423, 431], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [427, 427], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [429, 429], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [432, 445], 'children': [{'type': 'AssertStatement', 'name': '', 'range': [432, 445], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [440, 445], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [433, 439], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [434, 439], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [438, 438], 'children': []}]}]}, {'type': 'BinaryExpression', 'name': '+', 'range': [443, 445], 'children': [{'type': 'Identifier', 'name': 'month1credit', 'range': [442, 442], 'children': []}, {'type': 'Literal', 'name': '100', 'range': [444, 444], 'children': []}]}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [454, 461], 'children': [{'type': 'AssignmentExpression', 'name': '=', 'range': [457, 461], 'children': [{'type': 'MemberExpression', 'name': 'user_credit.time_now', 'range': [454, 456], 'children': []}, {'type': 'LambdaExpression', 'name': '', 'range': [458, 461], 'children': [{'type': 'Identifier', 'name': 'month2', 'range': [460, 460], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [462, 473], 'children': [{'type': 'AssertStatement', 'name': '', 'range': [462, 473], 'children': [{'type': 'BinaryExpression', 'name': '==', 'range': [470, 473], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [463, 469], 'children': [{'type': 'CallExpression', 'name': 'user_credit.get_or_refill_credit', 'range': [464, 469], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [468, 468], 'children': []}]}]}, {'type': 'Identifier', 'name': 'month2credit', 'range': [472, 472], 'children': []}]}]}]}]}
2025-01-08 09:54:34,902 - INFO - Completed main AST analysis flow
2025-01-08 09:54:34,903 - INFO - Successfully processed chunk
2025-01-08 09:54:35,227 - INFO - Step 5 result: {'type': 'Program', 'name': 'test_block_credit_usage', 'range': [87, 265], 'children': [{'type': 'FunctionDecl', 'name': 'test_block_credit_usage', 'range': [87, 265], 'children': [{'type': 'Parameter', 'name': 'server', 'range': [91, 93], 'children': []}, {'type': 'BlockStatement', 'name': '', 'range': [96, 265], 'children': [{'type': 'VariableDecl', 'name': 'current_credit', 'range': [97, 105], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [99, 105], 'children': [{'type': 'CallExpression', 'name': 'get_or_refill_credit', 'range': [100, 105], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [104, 105], 'children': []}]}]}]}, {'type': 'VariableDecl', 'name': 'spending_amount_1', 'range': [108, 182], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [110, 182], 'children': [{'type': 'CallExpression', 'name': 'spend_credits', 'range': [111, 182], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [116, 117], 'children': []}, {'type': 'Identifier', 'name': 'current_credit', 'range': [119, 120], 'children': []}, {'type': 'CallExpression', 'name': 'AITextGeneratorBlock', 'range': [122, 127], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [129, 164], 'children': [{'type': 'Property', 'name': 'model', 'range': [131, 133], 'children': []}, {'type': 'Property', 'name': 'credentials', 'range': [136, 161], 'children': [{'type': 'ObjectExpression', 'name': '', 'range': [138, 161], 'children': [{'type': 'Property', 'name': 'id', 'range': [140, 145], 'children': []}, {'type': 'Property', 'name': 'provider', 'range': [147, 152], 'children': []}, {'type': 'Property', 'name': 'type', 'range': [154, 159], 'children': []}]}]}]}, {'type': 'Literal', 'name': '0.0', 'range': [167, 170], 'children': []}, {'type': 'Literal', 'name': '0.0', 'range': [172, 175], 'children': []}, {'type': 'AssignmentExpression', 'name': 'validate_balance', 'range': [177, 180], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [184, 188], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [185, 187], 'children': [{'type': 'Identifier', 'name': 'spending_amount_1', 'range': [185, 186], 'children': []}, {'type': 'Literal', 'name': '0', 'range': [187, 188], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'spending_amount_2', 'range': [190, 237], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [192, 237], 'children': [{'type': 'CallExpression', 'name': 'spend_credits', 'range': [193, 237], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [198, 199], 'children': []}, {'type': 'Identifier', 'name': 'current_credit', 'range': [201, 202], 'children': []}, {'type': 'CallExpression', 'name': 'AITextGeneratorBlock', 'range': [204, 209], 'children': []}, {'type': 'ObjectExpression', 'name': '', 'range': [211, 219], 'children': [{'type': 'Property', 'name': 'model', 'range': [212, 214], 'children': []}, {'type': 'Property', 'name': 'api_key', 'range': [216, 218], 'children': []}]}, {'type': 'Literal', 'name': '0.0', 'range': [222, 225], 'children': []}, {'type': 'Literal', 'name': '0.0', 'range': [227, 230], 'children': []}, {'type': 'AssignmentExpression', 'name': 'validate_balance', 'range': [232, 235], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [239, 244], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [240, 243], 'children': [{'type': 'Identifier', 'name': 'spending_amount_2', 'range': [240, 241], 'children': []}, {'type': 'Literal', 'name': '0', 'range': [242, 243], 'children': []}]}]}, {'type': 'VariableDecl', 'name': 'new_credit', 'range': [246, 254], 'children': [{'type': 'AwaitExpression', 'name': '', 'range': [248, 254], 'children': [{'type': 'CallExpression', 'name': 'get_or_refill_credit', 'range': [249, 254], 'children': [{'type': 'Identifier', 'name': 'DEFAULT_USER_ID', 'range': [253, 254], 'children': []}]}]}]}, {'type': 'ExpressionStatement', 'name': '', 'range': [256, 265], 'children': [{'type': 'BinaryExpression', 'name': '', 'range': [257, 264], 'children': [{'type': 'Identifier', 'name': 'new_credit', 'range': [257, 258], 'children': []}, {'type': 'BinaryExpression', 'name': '', 'range': [259, 264], 'children': [{'type': 'Identifier', 'name': 'current_credit', 'range': [259, 260], 'children': []}, {'type': 'BinaryExpression', 'name': '', 'range': [261, 264], 'children': [{'type': 'Identifier', 'name': 'spending_amount_1', 'range': [261, 262], 'children': []}, {'type': 'Identifier', 'name': 'spending_amount_2', 'range': [263, 264], 'children': []}]}]}]}]}]}]}]}
2025-01-08 09:54:35,227 - INFO - Completed main AST analysis flow
2025-01-08 09:54:35,228 - INFO - Successfully processed chunk
2025-01-08 09:54:35,257 - INFO - Starting code generation from AST
2025-01-08 10:24:36,792 - ERROR - Error in get_code_from_ast: Expecting value: line 30 column 1 (char 29)
2025-01-08 10:24:36,792 - INFO - Starting static code similarity comparison
2025-01-08 10:24:36,794 - INFO - Static similarity result: {'final_score': 30.0, 'length_similarity': 0.0, 'token_similarity': 0.0, 'structure_similarity': 0.0, 'function_similarity': 100, 'complexity_similarity': 100.0, 'variable_similarity': 100}
