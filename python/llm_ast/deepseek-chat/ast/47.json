{
    "type": "Program",
    "name": "Global",
    "range": [
        0,
        404
    ],
    "children": [
        {
            "type": "ImportDeclaration",
            "name": "",
            "range": [
                0,
                2
            ],
            "children": [
                {
                    "type": "ImportSpecifier",
                    "name": "asyncio",
                    "range": [
                        1,
                        1
                    ],
                    "children": [],
                    "content": "asyncio"
                }
            ],
            "content": "import asyncio\n"
        },
        {
            "type": "ImportDeclaration",
            "name": "",
            "range": [
                3,
                5
            ],
            "children": [
                {
                    "type": "ImportSpecifier",
                    "name": "logging",
                    "range": [
                        4,
                        4
                    ],
                    "children": [],
                    "content": "logging"
                }
            ],
            "content": "import logging\n"
        },
        {
            "type": "ImportDeclaration",
            "name": "",
            "range": [
                6,
                8
            ],
            "children": [
                {
                    "type": "ImportSpecifier",
                    "name": "os",
                    "range": [
                        7,
                        7
                    ],
                    "children": [],
                    "content": "os"
                }
            ],
            "content": "import os\n"
        },
        {
            "type": "ImportDeclaration",
            "name": "",
            "range": [
                9,
                11
            ],
            "children": [
                {
                    "type": "ImportSpecifier",
                    "name": "threading",
                    "range": [
                        10,
                        10
                    ],
                    "children": [],
                    "content": "threading"
                }
            ],
            "content": "import threading\n"
        },
        {
            "type": "ImportDeclaration",
            "name": "",
            "range": [
                12,
                16
            ],
            "children": [
                {
                    "type": "ImportSpecifier",
                    "name": "wraps",
                    "range": [
                        15,
                        15
                    ],
                    "children": [],
                    "content": "wraps"
                }
            ],
            "content": "from functools import wraps\n"
        },
        {
            "type": "ImportDeclaration",
            "name": "",
            "range": [
                17,
                21
            ],
            "children": [
                {
                    "type": "ImportSpecifier",
                    "name": "uuid4",
                    "range": [
                        20,
                        20
                    ],
                    "children": [],
                    "content": "uuid4"
                }
            ],
            "content": "from uuid import uuid4\n"
        },
        {
            "type": "ImportDeclaration",
            "name": "",
            "range": [
                23,
                31
            ],
            "children": [
                {
                    "type": "ImportSpecifier",
                    "name": "retry",
                    "range": [
                        26,
                        26
                    ],
                    "children": [],
                    "content": "retry"
                },
                {
                    "type": "ImportSpecifier",
                    "name": "stop_after_attempt",
                    "range": [
                        28,
                        28
                    ],
                    "children": [],
                    "content": "stop_after_attempt"
                },
                {
                    "type": "ImportSpecifier",
                    "name": "wait_exponential",
                    "range": [
                        30,
                        30
                    ],
                    "children": [],
                    "content": "wait_exponential"
                }
            ],
            "content": "from tenacity import retry,stop_after_attempt,wait_exponential\n"
        },
        {
            "type": "ImportDeclaration",
            "name": "",
            "range": [
                33,
                41
            ],
            "children": [
                {
                    "type": "ImportSpecifier",
                    "name": "get_service_name",
                    "range": [
                        40,
                        40
                    ],
                    "children": [],
                    "content": "get_service_name"
                }
            ],
            "content": "from backend.util.process import get_service_name\n"
        },
        {
            "type": "VariableDeclaration",
            "name": "logger",
            "range": [
                43,
                51
            ],
            "children": [
                {
                    "type": "AssignmentExpression",
                    "name": "",
                    "range": [
                        44,
                        51
                    ],
                    "children": [
                        {
                            "type": "CallExpression",
                            "name": "logging.getLogger",
                            "range": [
                                45,
                                50
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "__name__",
                                    "range": [
                                        49,
                                        49
                                    ],
                                    "children": [],
                                    "content": "__name__"
                                }
                            ],
                            "content": "logging.getLogger(__name__)"
                        }
                    ],
                    "content": "=logging.getLogger(__name__)\n"
                }
            ],
            "content": "logger=logging.getLogger(__name__)\n"
        },
        {
            "type": "FunctionDecl",
            "name": "_log_prefix",
            "range": [
                54,
                75
            ],
            "children": [
                {
                    "type": "ParameterList",
                    "name": "parameters",
                    "range": [
                        56,
                        64
                    ],
                    "children": [
                        {
                            "type": "Parameter",
                            "name": "resource_name",
                            "range": [
                                57,
                                59
                            ],
                            "children": [],
                            "content": "resource_name:str"
                        },
                        {
                            "type": "Parameter",
                            "name": "conn_id",
                            "range": [
                                61,
                                63
                            ],
                            "children": [],
                            "content": "conn_id:str"
                        }
                    ],
                    "content": "(resource_name:str,conn_id:str)"
                },
                {
                    "type": "ReturnType",
                    "name": "return_type",
                    "range": [
                        65,
                        65
                    ],
                    "children": [],
                    "content": ":"
                },
                {
                    "type": "Docstring",
                    "name": "docstring",
                    "range": [
                        67,
                        69
                    ],
                    "children": [],
                    "content": "\"\"\" \\n     Returns a prefix string for logging purposes. \\n     This needs to be called on the fly to get the current process ID & service name, \\n     not the parent process ID & service name. \\n     \"\"\""
                },
                {
                    "type": "ReturnStatement",
                    "name": "return",
                    "range": [
                        71,
                        73
                    ],
                    "children": [
                        {
                            "type": "Literal",
                            "name": "f-string",
                            "range": [
                                72,
                                73
                            ],
                            "children": [],
                            "content": "f \"[PID-{os.getpid()}|THREAD-{threading.get_native_id()}|{get_service_name()}|{resource_name}-{conn_id}]\""
                        }
                    ],
                    "content": "return f \"[PID-{os.getpid()}|THREAD-{threading.get_native_id()}|{get_service_name()}|{resource_name}-{conn_id}]\""
                }
            ],
            "content": "def _log_prefix(resource_name:str,conn_id:str):\n\"\"\" \\n     Returns a prefix string for logging purposes. \\n     This needs to be called on the fly to get the current process ID & service name, \\n     not the parent process ID & service name. \\n     \"\"\"\nreturn f \"[PID-{os.getpid()}|THREAD-{threading.get_native_id()}|{get_service_name()}|{resource_name}-{conn_id}]\"\n\n"
        },
        {
            "type": "FunctionDecl",
            "name": "conn_retry",
            "range": [
                76,
                129
            ],
            "children": [
                {
                    "type": "ParameterList",
                    "name": "",
                    "range": [
                        78,
                        118
                    ],
                    "children": [
                        {
                            "type": "Parameter",
                            "name": "resource_name",
                            "range": [
                                80,
                                82
                            ],
                            "children": [],
                            "content": "\nresource_name:"
                        },
                        {
                            "type": "Parameter",
                            "name": "action_name",
                            "range": [
                                85,
                                87
                            ],
                            "children": [],
                            "content": "\naction_name:"
                        },
                        {
                            "type": "Parameter",
                            "name": "max_retry",
                            "range": [
                                90,
                                94
                            ],
                            "children": [],
                            "content": "\nmax_retry:int="
                        },
                        {
                            "type": "Parameter",
                            "name": "multiplier",
                            "range": [
                                97,
                                101
                            ],
                            "children": [],
                            "content": "\nmultiplier:int="
                        },
                        {
                            "type": "Parameter",
                            "name": "min_wait",
                            "range": [
                                104,
                                108
                            ],
                            "children": [],
                            "content": "\nmin_wait:float="
                        },
                        {
                            "type": "Parameter",
                            "name": "max_wait",
                            "range": [
                                111,
                                115
                            ],
                            "children": [],
                            "content": "\nmax_wait:float="
                        }
                    ],
                    "content": "conn_retry(\nresource_name:str,\naction_name:str,\nmax_retry:int=5,\nmultiplier:int=1,\nmin_wait:float=1,\nmax_wait:float=30,\n"
                },
                {
                    "type": "ReturnType",
                    "name": "",
                    "range": [
                        119,
                        123
                    ],
                    "children": [],
                    "content": "):\nconn_id="
                },
                {
                    "type": "FunctionBody",
                    "name": "",
                    "range": [
                        124,
                        129
                    ],
                    "children": [
                        {
                            "type": "ExpressionStatement",
                            "name": "",
                            "range": [
                                124,
                                128
                            ],
                            "children": [
                                {
                                    "type": "CallExpression",
                                    "name": "str",
                                    "range": [
                                        124,
                                        128
                                    ],
                                    "children": [
                                        {
                                            "type": "CallExpression",
                                            "name": "uuid4",
                                            "range": [
                                                125,
                                                127
                                            ],
                                            "children": [],
                                            "content": "(uuid4("
                                        }
                                    ],
                                    "content": "str(uuid4()"
                                }
                            ],
                            "content": "str(uuid4()"
                        }
                    ],
                    "content": "str(uuid4())"
                }
            ],
            "content": "\ndef conn_retry(\nresource_name:str,\naction_name:str,\nmax_retry:int=5,\nmultiplier:int=1,\nmin_wait:float=1,\nmax_wait:float=30,\n):\nconn_id=str(uuid4())"
        },
        {
            "type": "FunctionDecl",
            "name": "on_retry",
            "range": [
                131,
                164
            ],
            "children": [
                {
                    "type": "ParameterList",
                    "name": "",
                    "range": [
                        133,
                        135
                    ],
                    "children": [
                        {
                            "type": "Parameter",
                            "name": "retry_state",
                            "range": [
                                134,
                                135
                            ],
                            "children": [],
                            "content": "(retry_state"
                        }
                    ],
                    "content": "on_retry(retry_state"
                },
                {
                    "type": "FunctionBody",
                    "name": "",
                    "range": [
                        136,
                        164
                    ],
                    "children": [
                        {
                            "type": "ExpressionStatement",
                            "name": "",
                            "range": [
                                138,
                                146
                            ],
                            "children": [
                                {
                                    "type": "AssignmentExpression",
                                    "name": "",
                                    "range": [
                                        138,
                                        146
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "prefix",
                                            "range": [
                                                138,
                                                139
                                            ],
                                            "children": [],
                                            "content": "\nprefix"
                                        },
                                        {
                                            "type": "CallExpression",
                                            "name": "_log_prefix",
                                            "range": [
                                                140,
                                                145
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "resource_name",
                                                    "range": [
                                                        142,
                                                        143
                                                    ],
                                                    "children": [],
                                                    "content": "(resource_name"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "conn_id",
                                                    "range": [
                                                        144,
                                                        145
                                                    ],
                                                    "children": [],
                                                    "content": ",conn_id"
                                                }
                                            ],
                                            "content": "=_log_prefix(resource_name,conn_id"
                                        }
                                    ],
                                    "content": "\nprefix=_log_prefix(resource_name,conn_id)"
                                }
                            ],
                            "content": "\nprefix=_log_prefix(resource_name,conn_id)"
                        },
                        {
                            "type": "ExpressionStatement",
                            "name": "",
                            "range": [
                                147,
                                156
                            ],
                            "children": [
                                {
                                    "type": "AssignmentExpression",
                                    "name": "",
                                    "range": [
                                        147,
                                        156
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "exception",
                                            "range": [
                                                147,
                                                148
                                            ],
                                            "children": [],
                                            "content": "\nexception"
                                        },
                                        {
                                            "type": "CallExpression",
                                            "name": "exception",
                                            "range": [
                                                153,
                                                155
                                            ],
                                            "children": [
                                                {
                                                    "type": "MemberExpression",
                                                    "name": "outcome",
                                                    "range": [
                                                        151,
                                                        152
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "retry_state",
                                                            "range": [
                                                                149,
                                                                150
                                                            ],
                                                            "children": [],
                                                            "content": "=retry_state"
                                                        }
                                                    ],
                                                    "content": ".outcome"
                                                }
                                            ],
                                            "content": ".exception("
                                        }
                                    ],
                                    "content": "\nexception=retry_state.outcome.exception()"
                                }
                            ],
                            "content": "\nexception=retry_state.outcome.exception()"
                        },
                        {
                            "type": "ExpressionStatement",
                            "name": "",
                            "range": [
                                157,
                                164
                            ],
                            "children": [
                                {
                                    "type": "CallExpression",
                                    "name": "error",
                                    "range": [
                                        159,
                                        163
                                    ],
                                    "children": [
                                        {
                                            "type": "MemberExpression",
                                            "name": "logger",
                                            "range": [
                                                157,
                                                158
                                            ],
                                            "children": [],
                                            "content": "\nlogger"
                                        },
                                        {
                                            "type": "TemplateLiteral",
                                            "name": "",
                                            "range": [
                                                161,
                                                162
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "prefix",
                                                    "range": [
                                                        161,
                                                        162
                                                    ],
                                                    "children": [],
                                                    "content": "(f"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "action_name",
                                                    "range": [
                                                        161,
                                                        162
                                                    ],
                                                    "children": [],
                                                    "content": "(f"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "exception",
                                                    "range": [
                                                        161,
                                                        162
                                                    ],
                                                    "children": [],
                                                    "content": "(f"
                                                }
                                            ],
                                            "content": "(f"
                                        }
                                    ],
                                    "content": ".error(f \"{prefix} {action_name} failed: {exception}. Retrying now...\""
                                }
                            ],
                            "content": "\nlogger.error(f \"{prefix} {action_name} failed: {exception}. Retrying now...\")"
                        }
                    ],
                    "content": "):\nprefix=_log_prefix(resource_name,conn_id)\nexception=retry_state.outcome.exception()\nlogger.error(f \"{prefix} {action_name} failed: {exception}. Retrying now...\")"
                }
            ],
            "content": "\ndef on_retry(retry_state):\nprefix=_log_prefix(resource_name,conn_id)\nexception=retry_state.outcome.exception()\nlogger.error(f \"{prefix} {action_name} failed: {exception}. Retrying now...\")"
        },
        {
            "type": "FunctionDecl",
            "name": "decorator",
            "range": [
                166,
                403
            ],
            "children": [
                {
                    "type": "ParameterList",
                    "name": "",
                    "range": [
                        168,
                        170
                    ],
                    "children": [
                        {
                            "type": "Parameter",
                            "name": "func",
                            "range": [
                                169,
                                170
                            ],
                            "children": [],
                            "content": "(func"
                        }
                    ],
                    "content": "decorator(func"
                },
                {
                    "type": "FunctionBody",
                    "name": "",
                    "range": [
                        171,
                        403
                    ],
                    "children": [
                        {
                            "type": "ExpressionStatement",
                            "name": "",
                            "range": [
                                173,
                                181
                            ],
                            "children": [
                                {
                                    "type": "AssignmentExpression",
                                    "name": "",
                                    "range": [
                                        173,
                                        181
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "is_coroutine",
                                            "range": [
                                                173,
                                                174
                                            ],
                                            "children": [],
                                            "content": "\nis_coroutine"
                                        },
                                        {
                                            "type": "CallExpression",
                                            "name": "iscoroutinefunction",
                                            "range": [
                                                177,
                                                180
                                            ],
                                            "children": [
                                                {
                                                    "type": "MemberExpression",
                                                    "name": "asyncio",
                                                    "range": [
                                                        175,
                                                        176
                                                    ],
                                                    "children": [],
                                                    "content": "=asyncio"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "func",
                                                    "range": [
                                                        179,
                                                        180
                                                    ],
                                                    "children": [],
                                                    "content": "(func"
                                                }
                                            ],
                                            "content": ".iscoroutinefunction(func"
                                        }
                                    ],
                                    "content": "\nis_coroutine=asyncio.iscoroutinefunction(func)"
                                }
                            ],
                            "content": "\nis_coroutine=asyncio.iscoroutinefunction(func)"
                        },
                        {
                            "type": "ExpressionStatement",
                            "name": "",
                            "range": [
                                182,
                                226
                            ],
                            "children": [
                                {
                                    "type": "AssignmentExpression",
                                    "name": "",
                                    "range": [
                                        182,
                                        226
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "retry_decorator",
                                            "range": [
                                                182,
                                                183
                                            ],
                                            "children": [],
                                            "content": "\nretry_decorator"
                                        },
                                        {
                                            "type": "CallExpression",
                                            "name": "retry",
                                            "range": [
                                                184,
                                                225
                                            ],
                                            "children": [
                                                {
                                                    "type": "ObjectExpression",
                                                    "name": "",
                                                    "range": [
                                                        186,
                                                        225
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Property",
                                                            "name": "stop",
                                                            "range": [
                                                                187,
                                                                194
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "stop_after_attempt",
                                                                    "range": [
                                                                        189,
                                                                        194
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "BinaryExpression",
                                                                            "name": "",
                                                                            "range": [
                                                                                191,
                                                                                193
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "max_retry",
                                                                                    "range": [
                                                                                        191,
                                                                                        192
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "(max_retry"
                                                                                },
                                                                                {
                                                                                    "type": "Literal",
                                                                                    "name": "1",
                                                                                    "range": [
                                                                                        193,
                                                                                        193
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "+"
                                                                                }
                                                                            ],
                                                                            "content": "(max_retry+"
                                                                        }
                                                                    ],
                                                                    "content": "=stop_after_attempt(max_retry+1"
                                                                }
                                                            ],
                                                            "content": "\nstop=stop_after_attempt(max_retry+1"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "wait",
                                                            "range": [
                                                                197,
                                                                212
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "wait_exponential",
                                                                    "range": [
                                                                        199,
                                                                        212
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "ObjectExpression",
                                                                            "name": "",
                                                                            "range": [
                                                                                201,
                                                                                212
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Property",
                                                                                    "name": "multiplier",
                                                                                    "range": [
                                                                                        202,
                                                                                        203
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "multiplier",
                                                                                            "range": [
                                                                                                203,
                                                                                                203
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "="
                                                                                        }
                                                                                    ],
                                                                                    "content": "multiplier="
                                                                                },
                                                                                {
                                                                                    "type": "Property",
                                                                                    "name": "min",
                                                                                    "range": [
                                                                                        205,
                                                                                        207
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "min_wait",
                                                                                            "range": [
                                                                                                207,
                                                                                                207
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "="
                                                                                        }
                                                                                    ],
                                                                                    "content": ",min="
                                                                                },
                                                                                {
                                                                                    "type": "Property",
                                                                                    "name": "max",
                                                                                    "range": [
                                                                                        209,
                                                                                        211
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "max_wait",
                                                                                            "range": [
                                                                                                211,
                                                                                                211
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "="
                                                                                        }
                                                                                    ],
                                                                                    "content": ",max="
                                                                                }
                                                                            ],
                                                                            "content": "(multiplier=multiplier,min=min_wait,max=max_wait"
                                                                        }
                                                                    ],
                                                                    "content": "=wait_exponential(multiplier=multiplier,min=min_wait,max=max_wait"
                                                                }
                                                            ],
                                                            "content": "\nwait=wait_exponential(multiplier=multiplier,min=min_wait,max=max_wait"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "before_sleep",
                                                            "range": [
                                                                215,
                                                                218
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "on_retry",
                                                                    "range": [
                                                                        217,
                                                                        218
                                                                    ],
                                                                    "children": [],
                                                                    "content": "=on_retry"
                                                                }
                                                            ],
                                                            "content": "\nbefore_sleep=on_retry"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "reraise",
                                                            "range": [
                                                                220,
                                                                222
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Literal",
                                                                    "name": "True",
                                                                    "range": [
                                                                        222,
                                                                        222
                                                                    ],
                                                                    "children": [],
                                                                    "content": "="
                                                                }
                                                            ],
                                                            "content": "\nreraise="
                                                        }
                                                    ],
                                                    "content": "(\nstop=stop_after_attempt(max_retry+1),\nwait=wait_exponential(multiplier=multiplier,min=min_wait,max=max_wait),\nbefore_sleep=on_retry,\nreraise=True,\n"
                                                }
                                            ],
                                            "content": "=retry(\nstop=stop_after_attempt(max_retry+1),\nwait=wait_exponential(multiplier=multiplier,min=min_wait,max=max_wait),\nbefore_sleep=on_retry,\nreraise=True,\n"
                                        }
                                    ],
                                    "content": "\nretry_decorator=retry(\nstop=stop_after_attempt(max_retry+1),\nwait=wait_exponential(multiplier=multiplier,min=min_wait,max=max_wait),\nbefore_sleep=on_retry,\nreraise=True,\n)"
                                }
                            ],
                            "content": "\nretry_decorator=retry(\nstop=stop_after_attempt(max_retry+1),\nwait=wait_exponential(multiplier=multiplier,min=min_wait,max=max_wait),\nbefore_sleep=on_retry,\nreraise=True,\n)"
                        },
                        {
                            "type": "ExpressionStatement",
                            "name": "",
                            "range": [
                                227,
                                233
                            ],
                            "children": [
                                {
                                    "type": "AssignmentExpression",
                                    "name": "",
                                    "range": [
                                        227,
                                        233
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "wrapped_func",
                                            "range": [
                                                227,
                                                228
                                            ],
                                            "children": [],
                                            "content": "\nwrapped_func"
                                        },
                                        {
                                            "type": "CallExpression",
                                            "name": "retry_decorator",
                                            "range": [
                                                229,
                                                232
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "func",
                                                    "range": [
                                                        231,
                                                        232
                                                    ],
                                                    "children": [],
                                                    "content": "(func"
                                                }
                                            ],
                                            "content": "=retry_decorator(func"
                                        }
                                    ],
                                    "content": "\nwrapped_func=retry_decorator(func)"
                                }
                            ],
                            "content": "\nwrapped_func=retry_decorator(func)"
                        },
                        {
                            "type": "FunctionDecl",
                            "name": "sync_wrapper",
                            "range": [
                                241,
                                311
                            ],
                            "children": [
                                {
                                    "type": "ParameterList",
                                    "name": "",
                                    "range": [
                                        243,
                                        250
                                    ],
                                    "children": [
                                        {
                                            "type": "Parameter",
                                            "name": "args",
                                            "range": [
                                                245,
                                                246
                                            ],
                                            "children": [],
                                            "content": "*args"
                                        },
                                        {
                                            "type": "Parameter",
                                            "name": "kwargs",
                                            "range": [
                                                249,
                                                250
                                            ],
                                            "children": [],
                                            "content": "*kwargs"
                                        }
                                    ],
                                    "content": "sync_wrapper(*args,**kwargs"
                                },
                                {
                                    "type": "FunctionBody",
                                    "name": "",
                                    "range": [
                                        251,
                                        311
                                    ],
                                    "children": [
                                        {
                                            "type": "ExpressionStatement",
                                            "name": "",
                                            "range": [
                                                253,
                                                261
                                            ],
                                            "children": [
                                                {
                                                    "type": "AssignmentExpression",
                                                    "name": "",
                                                    "range": [
                                                        253,
                                                        261
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "prefix",
                                                            "range": [
                                                                253,
                                                                254
                                                            ],
                                                            "children": [],
                                                            "content": "\nprefix"
                                                        },
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "_log_prefix",
                                                            "range": [
                                                                255,
                                                                260
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "resource_name",
                                                                    "range": [
                                                                        257,
                                                                        258
                                                                    ],
                                                                    "children": [],
                                                                    "content": "(resource_name"
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "conn_id",
                                                                    "range": [
                                                                        259,
                                                                        260
                                                                    ],
                                                                    "children": [],
                                                                    "content": ",conn_id"
                                                                }
                                                            ],
                                                            "content": "=_log_prefix(resource_name,conn_id"
                                                        }
                                                    ],
                                                    "content": "\nprefix=_log_prefix(resource_name,conn_id)"
                                                }
                                            ],
                                            "content": "\nprefix=_log_prefix(resource_name,conn_id)"
                                        },
                                        {
                                            "type": "ExpressionStatement",
                                            "name": "",
                                            "range": [
                                                262,
                                                269
                                            ],
                                            "children": [
                                                {
                                                    "type": "CallExpression",
                                                    "name": "info",
                                                    "range": [
                                                        264,
                                                        268
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "MemberExpression",
                                                            "name": "logger",
                                                            "range": [
                                                                262,
                                                                263
                                                            ],
                                                            "children": [],
                                                            "content": "\nlogger"
                                                        },
                                                        {
                                                            "type": "TemplateLiteral",
                                                            "name": "",
                                                            "range": [
                                                                266,
                                                                267
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "prefix",
                                                                    "range": [
                                                                        266,
                                                                        267
                                                                    ],
                                                                    "children": [],
                                                                    "content": "(f"
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "action_name",
                                                                    "range": [
                                                                        266,
                                                                        267
                                                                    ],
                                                                    "children": [],
                                                                    "content": "(f"
                                                                }
                                                            ],
                                                            "content": "(f"
                                                        }
                                                    ],
                                                    "content": ".info(f \"{prefix} {action_name} started...\""
                                                }
                                            ],
                                            "content": "\nlogger.info(f \"{prefix} {action_name} started...\")"
                                        },
                                        {
                                            "type": "TryStatement",
                                            "name": "",
                                            "range": [
                                                270,
                                                311
                                            ],
                                            "children": [
                                                {
                                                    "type": "BlockStatement",
                                                    "name": "",
                                                    "range": [
                                                        272,
                                                        292
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "ExpressionStatement",
                                                            "name": "",
                                                            "range": [
                                                                273,
                                                                284
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "",
                                                                    "range": [
                                                                        273,
                                                                        284
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "result",
                                                                            "range": [
                                                                                273,
                                                                                274
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\nresult"
                                                                        },
                                                                        {
                                                                            "type": "CallExpression",
                                                                            "name": "wrapped_func",
                                                                            "range": [
                                                                                275,
                                                                                283
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "SpreadElement",
                                                                                    "name": "",
                                                                                    "range": [
                                                                                        277,
                                                                                        278
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "args",
                                                                                            "range": [
                                                                                                278,
                                                                                                278
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "*"
                                                                                        }
                                                                                    ],
                                                                                    "content": "(*"
                                                                                },
                                                                                {
                                                                                    "type": "SpreadElement",
                                                                                    "name": "",
                                                                                    "range": [
                                                                                        280,
                                                                                        281
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "kwargs",
                                                                                            "range": [
                                                                                                281,
                                                                                                281
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "*"
                                                                                        }
                                                                                    ],
                                                                                    "content": ",*"
                                                                                }
                                                                            ],
                                                                            "content": "=wrapped_func(*args,**kwargs"
                                                                        }
                                                                    ],
                                                                    "content": "\nresult=wrapped_func(*args,**kwargs)"
                                                                }
                                                            ],
                                                            "content": "\nresult=wrapped_func(*args,**kwargs)"
                                                        },
                                                        {
                                                            "type": "ExpressionStatement",
                                                            "name": "",
                                                            "range": [
                                                                285,
                                                                292
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "info",
                                                                    "range": [
                                                                        287,
                                                                        291
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": "logger",
                                                                            "range": [
                                                                                285,
                                                                                286
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\nlogger"
                                                                        },
                                                                        {
                                                                            "type": "TemplateLiteral",
                                                                            "name": "",
                                                                            "range": [
                                                                                289,
                                                                                290
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "prefix",
                                                                                    "range": [
                                                                                        289,
                                                                                        290
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "(f"
                                                                                },
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "action_name",
                                                                                    "range": [
                                                                                        289,
                                                                                        290
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "(f"
                                                                                }
                                                                            ],
                                                                            "content": "(f"
                                                                        }
                                                                    ],
                                                                    "content": ".info(f \"{prefix} {action_name} completed successfully.\""
                                                                }
                                                            ],
                                                            "content": "\nlogger.info(f \"{prefix} {action_name} completed successfully.\")"
                                                        },
                                                        {
                                                            "type": "ReturnStatement",
                                                            "name": "",
                                                            "range": [
                                                                293,
                                                                295
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "result",
                                                                    "range": [
                                                                        294,
                                                                        295
                                                                    ],
                                                                    "children": [],
                                                                    "content": "return result"
                                                                }
                                                            ],
                                                            "content": "\nreturn result"
                                                        }
                                                    ],
                                                    "content": ":\nresult=wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")"
                                                },
                                                {
                                                    "type": "CatchClause",
                                                    "name": "",
                                                    "range": [
                                                        296,
                                                        311
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "BlockStatement",
                                                            "name": "",
                                                            "range": [
                                                                301,
                                                                311
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "ExpressionStatement",
                                                                    "name": "",
                                                                    "range": [
                                                                        302,
                                                                        309
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "CallExpression",
                                                                            "name": "error",
                                                                            "range": [
                                                                                304,
                                                                                308
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "MemberExpression",
                                                                                    "name": "logger",
                                                                                    "range": [
                                                                                        302,
                                                                                        303
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "\nlogger"
                                                                                },
                                                                                {
                                                                                    "type": "TemplateLiteral",
                                                                                    "name": "",
                                                                                    "range": [
                                                                                        306,
                                                                                        307
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "prefix",
                                                                                            "range": [
                                                                                                306,
                                                                                                307
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "(f"
                                                                                        },
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "action_name",
                                                                                            "range": [
                                                                                                306,
                                                                                                307
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "(f"
                                                                                        },
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "e",
                                                                                            "range": [
                                                                                                306,
                                                                                                307
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "(f"
                                                                                        }
                                                                                    ],
                                                                                    "content": "(f"
                                                                                }
                                                                            ],
                                                                            "content": ".error(f \"{prefix} {action_name} failed after retries: {e}\""
                                                                        }
                                                                    ],
                                                                    "content": "\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")"
                                                                },
                                                                {
                                                                    "type": "ThrowStatement",
                                                                    "name": "",
                                                                    "range": [
                                                                        310,
                                                                        311
                                                                    ],
                                                                    "children": [],
                                                                    "content": "\nraise"
                                                                }
                                                            ],
                                                            "content": ":\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise"
                                                        }
                                                    ],
                                                    "content": "\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise"
                                                }
                                            ],
                                            "content": "\ntry:\nresult=wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise"
                                        }
                                    ],
                                    "content": "):\nprefix=_log_prefix(resource_name,conn_id)\nlogger.info(f \"{prefix} {action_name} started...\")\ntry:\nresult=wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise"
                                }
                            ],
                            "content": "\ndef sync_wrapper(*args,**kwargs):\nprefix=_log_prefix(resource_name,conn_id)\nlogger.info(f \"{prefix} {action_name} started...\")\ntry:\nresult=wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise"
                        },
                        {
                            "type": "FunctionDecl",
                            "name": "async_wrapper",
                            "range": [
                                319,
                                390
                            ],
                            "children": [
                                {
                                    "type": "ParameterList",
                                    "name": "",
                                    "range": [
                                        322,
                                        329
                                    ],
                                    "children": [
                                        {
                                            "type": "Parameter",
                                            "name": "args",
                                            "range": [
                                                324,
                                                325
                                            ],
                                            "children": [],
                                            "content": "*args"
                                        },
                                        {
                                            "type": "Parameter",
                                            "name": "kwargs",
                                            "range": [
                                                328,
                                                329
                                            ],
                                            "children": [],
                                            "content": "*kwargs"
                                        }
                                    ],
                                    "content": "async_wrapper(*args,**kwargs"
                                },
                                {
                                    "type": "FunctionBody",
                                    "name": "",
                                    "range": [
                                        330,
                                        390
                                    ],
                                    "children": [
                                        {
                                            "type": "ExpressionStatement",
                                            "name": "",
                                            "range": [
                                                332,
                                                340
                                            ],
                                            "children": [
                                                {
                                                    "type": "AssignmentExpression",
                                                    "name": "",
                                                    "range": [
                                                        332,
                                                        340
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "prefix",
                                                            "range": [
                                                                332,
                                                                333
                                                            ],
                                                            "children": [],
                                                            "content": "\nprefix"
                                                        },
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "_log_prefix",
                                                            "range": [
                                                                334,
                                                                339
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "resource_name",
                                                                    "range": [
                                                                        336,
                                                                        337
                                                                    ],
                                                                    "children": [],
                                                                    "content": "(resource_name"
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "conn_id",
                                                                    "range": [
                                                                        338,
                                                                        339
                                                                    ],
                                                                    "children": [],
                                                                    "content": ",conn_id"
                                                                }
                                                            ],
                                                            "content": "=_log_prefix(resource_name,conn_id"
                                                        }
                                                    ],
                                                    "content": "\nprefix=_log_prefix(resource_name,conn_id)"
                                                }
                                            ],
                                            "content": "\nprefix=_log_prefix(resource_name,conn_id)"
                                        },
                                        {
                                            "type": "ExpressionStatement",
                                            "name": "",
                                            "range": [
                                                341,
                                                348
                                            ],
                                            "children": [
                                                {
                                                    "type": "CallExpression",
                                                    "name": "info",
                                                    "range": [
                                                        343,
                                                        347
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "MemberExpression",
                                                            "name": "logger",
                                                            "range": [
                                                                341,
                                                                342
                                                            ],
                                                            "children": [],
                                                            "content": "\nlogger"
                                                        },
                                                        {
                                                            "type": "TemplateLiteral",
                                                            "name": "",
                                                            "range": [
                                                                345,
                                                                346
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "prefix",
                                                                    "range": [
                                                                        345,
                                                                        346
                                                                    ],
                                                                    "children": [],
                                                                    "content": "(f"
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "action_name",
                                                                    "range": [
                                                                        345,
                                                                        346
                                                                    ],
                                                                    "children": [],
                                                                    "content": "(f"
                                                                }
                                                            ],
                                                            "content": "(f"
                                                        }
                                                    ],
                                                    "content": ".info(f \"{prefix} {action_name} started...\""
                                                }
                                            ],
                                            "content": "\nlogger.info(f \"{prefix} {action_name} started...\")"
                                        },
                                        {
                                            "type": "TryStatement",
                                            "name": "",
                                            "range": [
                                                349,
                                                390
                                            ],
                                            "children": [
                                                {
                                                    "type": "BlockStatement",
                                                    "name": "",
                                                    "range": [
                                                        351,
                                                        372
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "ExpressionStatement",
                                                            "name": "",
                                                            "range": [
                                                                352,
                                                                364
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "",
                                                                    "range": [
                                                                        352,
                                                                        364
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "result",
                                                                            "range": [
                                                                                352,
                                                                                353
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\nresult"
                                                                        },
                                                                        {
                                                                            "type": "AwaitExpression",
                                                                            "name": "",
                                                                            "range": [
                                                                                354,
                                                                                363
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "CallExpression",
                                                                                    "name": "wrapped_func",
                                                                                    "range": [
                                                                                        355,
                                                                                        363
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "SpreadElement",
                                                                                            "name": "",
                                                                                            "range": [
                                                                                                357,
                                                                                                358
                                                                                            ],
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "Identifier",
                                                                                                    "name": "args",
                                                                                                    "range": [
                                                                                                        358,
                                                                                                        358
                                                                                                    ],
                                                                                                    "children": [],
                                                                                                    "content": "*"
                                                                                                }
                                                                                            ],
                                                                                            "content": "(*"
                                                                                        },
                                                                                        {
                                                                                            "type": "SpreadElement",
                                                                                            "name": "",
                                                                                            "range": [
                                                                                                360,
                                                                                                361
                                                                                            ],
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "Identifier",
                                                                                                    "name": "kwargs",
                                                                                                    "range": [
                                                                                                        361,
                                                                                                        361
                                                                                                    ],
                                                                                                    "children": [],
                                                                                                    "content": "*"
                                                                                                }
                                                                                            ],
                                                                                            "content": ",*"
                                                                                        }
                                                                                    ],
                                                                                    "content": "await wrapped_func(*args,**kwargs"
                                                                                }
                                                                            ],
                                                                            "content": "=await wrapped_func(*args,**kwargs"
                                                                        }
                                                                    ],
                                                                    "content": "\nresult=await wrapped_func(*args,**kwargs)"
                                                                }
                                                            ],
                                                            "content": "\nresult=await wrapped_func(*args,**kwargs)"
                                                        },
                                                        {
                                                            "type": "ExpressionStatement",
                                                            "name": "",
                                                            "range": [
                                                                365,
                                                                372
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "info",
                                                                    "range": [
                                                                        367,
                                                                        371
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": "logger",
                                                                            "range": [
                                                                                365,
                                                                                366
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\nlogger"
                                                                        },
                                                                        {
                                                                            "type": "TemplateLiteral",
                                                                            "name": "",
                                                                            "range": [
                                                                                369,
                                                                                370
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "prefix",
                                                                                    "range": [
                                                                                        369,
                                                                                        370
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "(f"
                                                                                },
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "action_name",
                                                                                    "range": [
                                                                                        369,
                                                                                        370
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "(f"
                                                                                }
                                                                            ],
                                                                            "content": "(f"
                                                                        }
                                                                    ],
                                                                    "content": ".info(f \"{prefix} {action_name} completed successfully.\""
                                                                }
                                                            ],
                                                            "content": "\nlogger.info(f \"{prefix} {action_name} completed successfully.\")"
                                                        },
                                                        {
                                                            "type": "ReturnStatement",
                                                            "name": "",
                                                            "range": [
                                                                373,
                                                                375
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "result",
                                                                    "range": [
                                                                        374,
                                                                        375
                                                                    ],
                                                                    "children": [],
                                                                    "content": "return result"
                                                                }
                                                            ],
                                                            "content": "\nreturn result"
                                                        }
                                                    ],
                                                    "content": ":\nresult=await wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")"
                                                },
                                                {
                                                    "type": "CatchClause",
                                                    "name": "",
                                                    "range": [
                                                        376,
                                                        390
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "BlockStatement",
                                                            "name": "",
                                                            "range": [
                                                                381,
                                                                390
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "ExpressionStatement",
                                                                    "name": "",
                                                                    "range": [
                                                                        382,
                                                                        389
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "CallExpression",
                                                                            "name": "error",
                                                                            "range": [
                                                                                384,
                                                                                388
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "MemberExpression",
                                                                                    "name": "logger",
                                                                                    "range": [
                                                                                        382,
                                                                                        383
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "\nlogger"
                                                                                },
                                                                                {
                                                                                    "type": "TemplateLiteral",
                                                                                    "name": "",
                                                                                    "range": [
                                                                                        386,
                                                                                        387
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "prefix",
                                                                                            "range": [
                                                                                                386,
                                                                                                387
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "(f"
                                                                                        },
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "action_name",
                                                                                            "range": [
                                                                                                386,
                                                                                                387
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "(f"
                                                                                        },
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "e",
                                                                                            "range": [
                                                                                                386,
                                                                                                387
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "(f"
                                                                                        }
                                                                                    ],
                                                                                    "content": "(f"
                                                                                }
                                                                            ],
                                                                            "content": ".error(f \"{prefix} {action_name} failed after retries: {e}\""
                                                                        }
                                                                    ],
                                                                    "content": "\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")"
                                                                },
                                                                {
                                                                    "type": "ThrowStatement",
                                                                    "name": "",
                                                                    "range": [
                                                                        390,
                                                                        390
                                                                    ],
                                                                    "children": [],
                                                                    "content": "\n"
                                                                }
                                                            ],
                                                            "content": ":\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\n"
                                                        }
                                                    ],
                                                    "content": "\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\n"
                                                }
                                            ],
                                            "content": "\ntry:\nresult=await wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\n"
                                        }
                                    ],
                                    "content": "):\nprefix=_log_prefix(resource_name,conn_id)\nlogger.info(f \"{prefix} {action_name} started...\")\ntry:\nresult=await wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\n"
                                }
                            ],
                            "content": "\nasync def async_wrapper(*args,**kwargs):\nprefix=_log_prefix(resource_name,conn_id)\nlogger.info(f \"{prefix} {action_name} started...\")\ntry:\nresult=await wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\n"
                        },
                        {
                            "type": "ReturnStatement",
                            "name": "",
                            "range": [
                                393,
                                399
                            ],
                            "children": [
                                {
                                    "type": "ConditionalExpression",
                                    "name": "",
                                    "range": [
                                        395,
                                        398
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "is_coroutine",
                                            "range": [
                                                396,
                                                396
                                            ],
                                            "children": [],
                                            "content": "if"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "async_wrapper",
                                            "range": [
                                                394,
                                                394
                                            ],
                                            "children": [],
                                            "content": "return"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "sync_wrapper",
                                            "range": [
                                                398,
                                                398
                                            ],
                                            "children": [],
                                            "content": "else"
                                        }
                                    ],
                                    "content": "async_wrapper if is_coroutine else"
                                }
                            ],
                            "content": "\nreturn async_wrapper if is_coroutine else sync_wrapper"
                        },
                        {
                            "type": "ReturnStatement",
                            "name": "",
                            "range": [
                                401,
                                403
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "decorator",
                                    "range": [
                                        402,
                                        403
                                    ],
                                    "children": [],
                                    "content": "return decorator"
                                }
                            ],
                            "content": "\nreturn decorator"
                        }
                    ],
                    "content": "):\nis_coroutine=asyncio.iscoroutinefunction(func)\nretry_decorator=retry(\nstop=stop_after_attempt(max_retry+1),\nwait=wait_exponential(multiplier=multiplier,min=min_wait,max=max_wait),\nbefore_sleep=on_retry,\nreraise=True,\n)\nwrapped_func=retry_decorator(func)\n\n@wraps(func)\ndef sync_wrapper(*args,**kwargs):\nprefix=_log_prefix(resource_name,conn_id)\nlogger.info(f \"{prefix} {action_name} started...\")\ntry:\nresult=wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise\n\n@wraps(func)\nasync def async_wrapper(*args,**kwargs):\nprefix=_log_prefix(resource_name,conn_id)\nlogger.info(f \"{prefix} {action_name} started...\")\ntry:\nresult=await wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise\n\nreturn async_wrapper if is_coroutine else sync_wrapper\n\nreturn decorator"
                }
            ],
            "content": "\ndef decorator(func):\nis_coroutine=asyncio.iscoroutinefunction(func)\nretry_decorator=retry(\nstop=stop_after_attempt(max_retry+1),\nwait=wait_exponential(multiplier=multiplier,min=min_wait,max=max_wait),\nbefore_sleep=on_retry,\nreraise=True,\n)\nwrapped_func=retry_decorator(func)\n\n@wraps(func)\ndef sync_wrapper(*args,**kwargs):\nprefix=_log_prefix(resource_name,conn_id)\nlogger.info(f \"{prefix} {action_name} started...\")\ntry:\nresult=wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise\n\n@wraps(func)\nasync def async_wrapper(*args,**kwargs):\nprefix=_log_prefix(resource_name,conn_id)\nlogger.info(f \"{prefix} {action_name} started...\")\ntry:\nresult=await wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise\n\nreturn async_wrapper if is_coroutine else sync_wrapper\n\nreturn decorator"
        }
    ],
    "content": "import asyncio\nimport logging\nimport os\nimport threading\nfrom functools import wraps\nfrom uuid import uuid4\n\nfrom tenacity import retry,stop_after_attempt,wait_exponential\n\nfrom backend.util.process import get_service_name\n\nlogger=logging.getLogger(__name__)\n\n\ndef _log_prefix(resource_name:str,conn_id:str):\n\"\"\" \\n     Returns a prefix string for logging purposes. \\n     This needs to be called on the fly to get the current process ID & service name, \\n     not the parent process ID & service name. \\n     \"\"\"\nreturn f \"[PID-{os.getpid()}|THREAD-{threading.get_native_id()}|{get_service_name()}|{resource_name}-{conn_id}]\"\n\n\ndef conn_retry(\nresource_name:str,\naction_name:str,\nmax_retry:int=5,\nmultiplier:int=1,\nmin_wait:float=1,\nmax_wait:float=30,\n):\nconn_id=str(uuid4())\n\ndef on_retry(retry_state):\nprefix=_log_prefix(resource_name,conn_id)\nexception=retry_state.outcome.exception()\nlogger.error(f \"{prefix} {action_name} failed: {exception}. Retrying now...\")\n\ndef decorator(func):\nis_coroutine=asyncio.iscoroutinefunction(func)\nretry_decorator=retry(\nstop=stop_after_attempt(max_retry+1),\nwait=wait_exponential(multiplier=multiplier,min=min_wait,max=max_wait),\nbefore_sleep=on_retry,\nreraise=True,\n)\nwrapped_func=retry_decorator(func)\n\n@wraps(func)\ndef sync_wrapper(*args,**kwargs):\nprefix=_log_prefix(resource_name,conn_id)\nlogger.info(f \"{prefix} {action_name} started...\")\ntry:\nresult=wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise\n\n@wraps(func)\nasync def async_wrapper(*args,**kwargs):\nprefix=_log_prefix(resource_name,conn_id)\nlogger.info(f \"{prefix} {action_name} started...\")\ntry:\nresult=await wrapped_func(*args,**kwargs)\nlogger.info(f \"{prefix} {action_name} completed successfully.\")\nreturn result\nexcept Exception as e:\nlogger.error(f \"{prefix} {action_name} failed after retries: {e}\")\nraise\n\nreturn async_wrapper if is_coroutine else sync_wrapper\n\nreturn decorator\n"
}