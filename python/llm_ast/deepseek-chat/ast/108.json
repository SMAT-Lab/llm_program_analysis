{
    "type": "Program",
    "name": "Global",
    "range": [
        49,
        417
    ],
    "children": [
        {
            "type": "ClassDecl",
            "name": "NotionOAuthHandler",
            "range": [
                49,
                417
            ],
            "children": [
                {
                    "type": "FunctionDecl",
                    "name": "__init__",
                    "range": [
                        68,
                        116
                    ],
                    "children": [
                        {
                            "type": "ParameterList",
                            "name": "parameters",
                            "range": [
                                70,
                                84
                            ],
                            "children": [
                                {
                                    "type": "Parameter",
                                    "name": "self",
                                    "range": [
                                        71,
                                        71
                                    ],
                                    "children": [],
                                    "content": "self"
                                },
                                {
                                    "type": "Parameter",
                                    "name": "client_id",
                                    "range": [
                                        73,
                                        75
                                    ],
                                    "children": [],
                                    "content": "client_id:str"
                                },
                                {
                                    "type": "Parameter",
                                    "name": "client_secret",
                                    "range": [
                                        77,
                                        79
                                    ],
                                    "children": [],
                                    "content": "client_secret:str"
                                },
                                {
                                    "type": "Parameter",
                                    "name": "redirect_uri",
                                    "range": [
                                        81,
                                        83
                                    ],
                                    "children": [],
                                    "content": "redirect_uri:str"
                                }
                            ],
                            "content": "(self,client_id:str,client_secret:str,redirect_uri:str)"
                        },
                        {
                            "type": "Block",
                            "name": "body",
                            "range": [
                                86,
                                116
                            ],
                            "children": [
                                {
                                    "type": "Assignment",
                                    "name": "assignment",
                                    "range": [
                                        87,
                                        91
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "self.client_id",
                                            "range": [
                                                87,
                                                89
                                            ],
                                            "children": [],
                                            "content": "self.client_id"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "client_id",
                                            "range": [
                                                91,
                                                91
                                            ],
                                            "children": [],
                                            "content": "client_id"
                                        }
                                    ],
                                    "content": "self.client_id=client_id"
                                },
                                {
                                    "type": "Assignment",
                                    "name": "assignment",
                                    "range": [
                                        93,
                                        97
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "self.client_secret",
                                            "range": [
                                                93,
                                                95
                                            ],
                                            "children": [],
                                            "content": "self.client_secret"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "client_secret",
                                            "range": [
                                                97,
                                                97
                                            ],
                                            "children": [],
                                            "content": "client_secret"
                                        }
                                    ],
                                    "content": "self.client_secret=client_secret"
                                },
                                {
                                    "type": "Assignment",
                                    "name": "assignment",
                                    "range": [
                                        99,
                                        103
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "self.redirect_uri",
                                            "range": [
                                                99,
                                                101
                                            ],
                                            "children": [],
                                            "content": "self.redirect_uri"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "redirect_uri",
                                            "range": [
                                                103,
                                                103
                                            ],
                                            "children": [],
                                            "content": "redirect_uri"
                                        }
                                    ],
                                    "content": "self.redirect_uri=redirect_uri"
                                },
                                {
                                    "type": "Assignment",
                                    "name": "assignment",
                                    "range": [
                                        105,
                                        109
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "self.auth_base_url",
                                            "range": [
                                                105,
                                                107
                                            ],
                                            "children": [],
                                            "content": "self.auth_base_url"
                                        },
                                        {
                                            "type": "Literal",
                                            "name": "\"https://api.notion.com/v1/oauth/authorize\"",
                                            "range": [
                                                109,
                                                109
                                            ],
                                            "children": [],
                                            "content": "\"https://api.notion.com/v1/oauth/authorize\""
                                        }
                                    ],
                                    "content": "self.auth_base_url=\"https://api.notion.com/v1/oauth/authorize\""
                                },
                                {
                                    "type": "Assignment",
                                    "name": "assignment",
                                    "range": [
                                        111,
                                        115
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "self.token_url",
                                            "range": [
                                                111,
                                                113
                                            ],
                                            "children": [],
                                            "content": "self.token_url"
                                        },
                                        {
                                            "type": "Literal",
                                            "name": "\"https://api.notion.com/v1/oauth/token\"",
                                            "range": [
                                                115,
                                                115
                                            ],
                                            "children": [],
                                            "content": "\"https://api.notion.com/v1/oauth/token\""
                                        }
                                    ],
                                    "content": "self.token_url=\"https://api.notion.com/v1/oauth/token\""
                                }
                            ],
                            "content": "\nself.client_id=client_id\nself.client_secret=client_secret\nself.redirect_uri=redirect_uri\nself.auth_base_url=\"https://api.notion.com/v1/oauth/authorize\"\nself.token_url=\"https://api.notion.com/v1/oauth/token\"\n"
                        }
                    ],
                    "content": "def __init__(self,client_id:str,client_secret:str,redirect_uri:str):\nself.client_id=client_id\nself.client_secret=client_secret\nself.redirect_uri=redirect_uri\nself.auth_base_url=\"https://api.notion.com/v1/oauth/authorize\"\nself.token_url=\"https://api.notion.com/v1/oauth/token\"\n"
                },
                {
                    "type": "FunctionDecl",
                    "name": "get_login_url",
                    "range": [
                        118,
                        177
                    ],
                    "children": [
                        {
                            "type": "ParameterList",
                            "name": "parameters",
                            "range": [
                                120,
                                133
                            ],
                            "children": [
                                {
                                    "type": "Parameter",
                                    "name": "self",
                                    "range": [
                                        121,
                                        121
                                    ],
                                    "children": [],
                                    "content": "self"
                                },
                                {
                                    "type": "Parameter",
                                    "name": "scopes",
                                    "range": [
                                        123,
                                        125
                                    ],
                                    "children": [],
                                    "content": "scopes:list"
                                },
                                {
                                    "type": "Parameter",
                                    "name": "state",
                                    "range": [
                                        130,
                                        132
                                    ],
                                    "children": [],
                                    "content": "state:str"
                                }
                            ],
                            "content": "(self,scopes:list[str],state:str)"
                        },
                        {
                            "type": "Block",
                            "name": "body",
                            "range": [
                                138,
                                177
                            ],
                            "children": [
                                {
                                    "type": "VariableDecl",
                                    "name": "params",
                                    "range": [
                                        139,
                                        172
                                    ],
                                    "children": [
                                        {
                                            "type": "ObjectLiteral",
                                            "name": "params",
                                            "range": [
                                                141,
                                                172
                                            ],
                                            "children": [
                                                {
                                                    "type": "Property",
                                                    "name": "client_id",
                                                    "range": [
                                                        143,
                                                        147
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "self.client_id",
                                                            "range": [
                                                                145,
                                                                147
                                                            ],
                                                            "children": [],
                                                            "content": "self.client_id"
                                                        }
                                                    ],
                                                    "content": "\"client_id\":self.client_id"
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "redirect_uri",
                                                    "range": [
                                                        150,
                                                        154
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "self.redirect_uri",
                                                            "range": [
                                                                152,
                                                                154
                                                            ],
                                                            "children": [],
                                                            "content": "self.redirect_uri"
                                                        }
                                                    ],
                                                    "content": "\"redirect_uri\":self.redirect_uri"
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "response_type",
                                                    "range": [
                                                        157,
                                                        159
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Literal",
                                                            "name": "\"code\"",
                                                            "range": [
                                                                159,
                                                                159
                                                            ],
                                                            "children": [],
                                                            "content": "\"code\""
                                                        }
                                                    ],
                                                    "content": "\"response_type\":\"code\""
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "owner",
                                                    "range": [
                                                        162,
                                                        164
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Literal",
                                                            "name": "\"user\"",
                                                            "range": [
                                                                164,
                                                                164
                                                            ],
                                                            "children": [],
                                                            "content": "\"user\""
                                                        }
                                                    ],
                                                    "content": "\"owner\":\"user\""
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "state",
                                                    "range": [
                                                        167,
                                                        169
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "state",
                                                            "range": [
                                                                169,
                                                                169
                                                            ],
                                                            "children": [],
                                                            "content": "state"
                                                        }
                                                    ],
                                                    "content": "\"state\":state"
                                                }
                                            ],
                                            "content": "{\n\"client_id\":self.client_id,\n\"redirect_uri\":self.redirect_uri,\n\"response_type\":\"code\",\n\"owner\":\"user\",\n\"state\":state,\n}"
                                        }
                                    ],
                                    "content": "params={\n\"client_id\":self.client_id,\n\"redirect_uri\":self.redirect_uri,\n\"response_type\":\"code\",\n\"owner\":\"user\",\n\"state\":state,\n}"
                                },
                                {
                                    "type": "ReturnStatement",
                                    "name": "return",
                                    "range": [
                                        174,
                                        176
                                    ],
                                    "children": [
                                        {
                                            "type": "TemplateLiteral",
                                            "name": "f\"{self.auth_base_url}?{urlencode(params)}\"",
                                            "range": [
                                                176,
                                                176
                                            ],
                                            "children": [],
                                            "content": "\"{self.auth_base_url}?{urlencode(params)}\""
                                        }
                                    ],
                                    "content": "return f \"{self.auth_base_url}?{urlencode(params)}\""
                                }
                            ],
                            "content": "\nparams={\n\"client_id\":self.client_id,\n\"redirect_uri\":self.redirect_uri,\n\"response_type\":\"code\",\n\"owner\":\"user\",\n\"state\":state,\n}\nreturn f \"{self.auth_base_url}?{urlencode(params)}\"\n"
                        }
                    ],
                    "content": "def get_login_url(self,scopes:list[str],state:str)->str:\nparams={\n\"client_id\":self.client_id,\n\"redirect_uri\":self.redirect_uri,\n\"response_type\":\"code\",\n\"owner\":\"user\",\n\"state\":state,\n}\nreturn f \"{self.auth_base_url}?{urlencode(params)}\"\n"
                },
                {
                    "type": "FunctionDecl",
                    "name": "exchange_code_for_tokens",
                    "range": [
                        179,
                        334
                    ],
                    "children": [
                        {
                            "type": "ParameterList",
                            "name": "parameters",
                            "range": [
                                181,
                                195
                            ],
                            "children": [
                                {
                                    "type": "Parameter",
                                    "name": "self",
                                    "range": [
                                        183,
                                        183
                                    ],
                                    "children": [],
                                    "content": "self"
                                },
                                {
                                    "type": "Parameter",
                                    "name": "code",
                                    "range": [
                                        185,
                                        187
                                    ],
                                    "children": [],
                                    "content": "code:str"
                                },
                                {
                                    "type": "Parameter",
                                    "name": "scopes",
                                    "range": [
                                        189,
                                        191
                                    ],
                                    "children": [],
                                    "content": "scopes:list"
                                }
                            ],
                            "content": "(\nself,code:str,scopes:list[str]\n"
                        },
                        {
                            "type": "Block",
                            "name": "body",
                            "range": [
                                201,
                                334
                            ],
                            "children": [
                                {
                                    "type": "VariableDecl",
                                    "name": "request_body",
                                    "range": [
                                        202,
                                        223
                                    ],
                                    "children": [
                                        {
                                            "type": "ObjectLiteral",
                                            "name": "request_body",
                                            "range": [
                                                204,
                                                223
                                            ],
                                            "children": [
                                                {
                                                    "type": "Property",
                                                    "name": "grant_type",
                                                    "range": [
                                                        206,
                                                        208
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Literal",
                                                            "name": "\"authorization_code\"",
                                                            "range": [
                                                                208,
                                                                208
                                                            ],
                                                            "children": [],
                                                            "content": "\"authorization_code\""
                                                        }
                                                    ],
                                                    "content": "\"grant_type\":\"authorization_code\""
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "code",
                                                    "range": [
                                                        211,
                                                        213
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "code",
                                                            "range": [
                                                                213,
                                                                213
                                                            ],
                                                            "children": [],
                                                            "content": "code"
                                                        }
                                                    ],
                                                    "content": "\"code\":code"
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "redirect_uri",
                                                    "range": [
                                                        216,
                                                        218
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "self.redirect_uri",
                                                            "range": [
                                                                218,
                                                                218
                                                            ],
                                                            "children": [],
                                                            "content": "self"
                                                        }
                                                    ],
                                                    "content": "\"redirect_uri\":self"
                                                }
                                            ],
                                            "content": "{\n\"grant_type\":\"authorization_code\",\n\"code\":code,\n\"redirect_uri\":self.redirect_uri,\n}"
                                        }
                                    ],
                                    "content": "request_body={\n\"grant_type\":\"authorization_code\",\n\"code\":code,\n\"redirect_uri\":self.redirect_uri,\n}"
                                },
                                {
                                    "type": "VariableDecl",
                                    "name": "auth_str",
                                    "range": [
                                        225,
                                        240
                                    ],
                                    "children": [
                                        {
                                            "type": "CallExpression",
                                            "name": "b64encode",
                                            "range": [
                                                227,
                                                235
                                            ],
                                            "children": [
                                                {
                                                    "type": "TemplateLiteral",
                                                    "name": "f\"{self.client_id}:{self.client_secret}\"",
                                                    "range": [
                                                        230,
                                                        230
                                                    ],
                                                    "children": [],
                                                    "content": "\"{self.client_id}:{self.client_secret}\""
                                                }
                                            ],
                                            "content": "b64encode(f \"{self.client_id}:{self.client_secret}\".encode())"
                                        }
                                    ],
                                    "content": "auth_str=b64encode(f \"{self.client_id}:{self.client_secret}\".encode()).decode()\n"
                                },
                                {
                                    "type": "VariableDecl",
                                    "name": "headers",
                                    "range": [
                                        241,
                                        256
                                    ],
                                    "children": [
                                        {
                                            "type": "ObjectLiteral",
                                            "name": "headers",
                                            "range": [
                                                243,
                                                256
                                            ],
                                            "children": [
                                                {
                                                    "type": "Property",
                                                    "name": "Authorization",
                                                    "range": [
                                                        245,
                                                        247
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "TemplateLiteral",
                                                            "name": "f\"Basic {auth_str}\"",
                                                            "range": [
                                                                248,
                                                                248
                                                            ],
                                                            "children": [],
                                                            "content": "\"Basic {auth_str}\""
                                                        }
                                                    ],
                                                    "content": "\"Authorization\":f"
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "Accept",
                                                    "range": [
                                                        251,
                                                        253
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Literal",
                                                            "name": "\"application/json\"",
                                                            "range": [
                                                                253,
                                                                253
                                                            ],
                                                            "children": [],
                                                            "content": "\"application/json\""
                                                        }
                                                    ],
                                                    "content": "\"Accept\":\"application/json\""
                                                }
                                            ],
                                            "content": "{\n\"Authorization\":f \"Basic {auth_str}\",\n\"Accept\":\"application/json\",\n}"
                                        }
                                    ],
                                    "content": "headers={\n\"Authorization\":f \"Basic {auth_str}\",\n\"Accept\":\"application/json\",\n}"
                                },
                                {
                                    "type": "VariableDecl",
                                    "name": "response",
                                    "range": [
                                        258,
                                        275
                                    ],
                                    "children": [
                                        {
                                            "type": "CallExpression",
                                            "name": "requests.post",
                                            "range": [
                                                260,
                                                275
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "self.token_url",
                                                    "range": [
                                                        264,
                                                        266
                                                    ],
                                                    "children": [],
                                                    "content": "self.token_url"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "request_body",
                                                    "range": [
                                                        270,
                                                        270
                                                    ],
                                                    "children": [],
                                                    "content": "request_body"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "headers",
                                                    "range": [
                                                        274,
                                                        274
                                                    ],
                                                    "children": [],
                                                    "content": "headers"
                                                }
                                            ],
                                            "content": "requests.post(self.token_url,json=request_body,headers=headers)"
                                        }
                                    ],
                                    "content": "response=requests.post(self.token_url,json=request_body,headers=headers)"
                                },
                                {
                                    "type": "VariableDecl",
                                    "name": "token_data",
                                    "range": [
                                        277,
                                        284
                                    ],
                                    "children": [
                                        {
                                            "type": "CallExpression",
                                            "name": "response.json",
                                            "range": [
                                                279,
                                                284
                                            ],
                                            "children": [],
                                            "content": "response.json()\n"
                                        }
                                    ],
                                    "content": "token_data=response.json()\n"
                                },
                                {
                                    "type": "VariableDecl",
                                    "name": "email",
                                    "range": [
                                        296,
                                        332
                                    ],
                                    "children": [
                                        {
                                            "type": "ConditionalExpression",
                                            "name": "conditional",
                                            "range": [
                                                298,
                                                332
                                            ],
                                            "children": [
                                                {
                                                    "type": "LogicalExpression",
                                                    "name": "logical",
                                                    "range": [
                                                        311,
                                                        329
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "BinaryExpression",
                                                            "name": "binary",
                                                            "range": [
                                                                311,
                                                                318
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Literal",
                                                                    "name": "\"person\"",
                                                                    "range": [
                                                                        312,
                                                                        312
                                                                    ],
                                                                    "children": [],
                                                                    "content": "\"person\""
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "token_data[\"owner\"]",
                                                                    "range": [
                                                                        314,
                                                                        316
                                                                    ],
                                                                    "children": [],
                                                                    "content": "token_data[\"owner\""
                                                                }
                                                            ],
                                                            "content": "if \"person\" in token_data[\"owner\"]\n"
                                                        },
                                                        {
                                                            "type": "BinaryExpression",
                                                            "name": "binary",
                                                            "range": [
                                                                319,
                                                                329
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Literal",
                                                                    "name": "\"email\"",
                                                                    "range": [
                                                                        320,
                                                                        320
                                                                    ],
                                                                    "children": [],
                                                                    "content": "\"email\""
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "token_data[\"owner\"][\"person\"]",
                                                                    "range": [
                                                                        322,
                                                                        328
                                                                    ],
                                                                    "children": [],
                                                                    "content": "token_data[\"owner\"][\"person\"]"
                                                                }
                                                            ],
                                                            "content": "and \"email\" in token_data[\"owner\"][\"person\"]\n"
                                                        }
                                                    ],
                                                    "content": "if \"person\" in token_data[\"owner\"]\nand \"email\" in token_data[\"owner\"][\"person\"]\n"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "token_data[\"owner\"][\"person\"][\"email\"]",
                                                    "range": [
                                                        300,
                                                        309
                                                    ],
                                                    "children": [],
                                                    "content": "token_data[\"owner\"][\"person\"][\"email\"]"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "None",
                                                    "range": [
                                                        331,
                                                        331
                                                    ],
                                                    "children": [],
                                                    "content": "None"
                                                }
                                            ],
                                            "content": "(\ntoken_data[\"owner\"][\"person\"][\"email\"]\nif \"person\" in token_data[\"owner\"]\nand \"email\" in token_data[\"owner\"][\"person\"]\nelse None\n"
                                        }
                                    ],
                                    "content": "email=(\ntoken_data[\"owner\"][\"person\"][\"email\"]\nif \"person\" in token_data[\"owner\"]\nand \"email\" in token_data[\"owner\"][\"person\"]\nelse None\n"
                                },
                                {
                                    "type": "ReturnStatement",
                                    "name": "return",
                                    "range": [
                                        336,
                                        378
                                    ],
                                    "children": [
                                        {
                                            "type": "NewExpression",
                                            "name": "OAuth2Credentials",
                                            "range": [
                                                337,
                                                378
                                            ],
                                            "children": [
                                                {
                                                    "type": "Property",
                                                    "name": "provider",
                                                    "range": [
                                                        340,
                                                        342
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "self.PROVIDER_NAME",
                                                            "range": [
                                                                342,
                                                                344
                                                            ],
                                                            "children": [],
                                                            "content": "self.PROVIDER_NAME"
                                                        }
                                                    ],
                                                    "content": "provider=self"
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "title",
                                                    "range": [
                                                        347,
                                                        349
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "token_data.get",
                                                            "range": [
                                                                349,
                                                                354
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Literal",
                                                                    "name": "\"workspace_name\"",
                                                                    "range": [
                                                                        353,
                                                                        353
                                                                    ],
                                                                    "children": [],
                                                                    "content": "\"workspace_name\""
                                                                }
                                                            ],
                                                            "content": "token_data.get(\"workspace_name\")"
                                                        }
                                                    ],
                                                    "content": "title=token_data"
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "username",
                                                    "range": [
                                                        357,
                                                        359
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "email",
                                                            "range": [
                                                                359,
                                                                359
                                                            ],
                                                            "children": [],
                                                            "content": "email"
                                                        }
                                                    ],
                                                    "content": "username=email"
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "access_token",
                                                    "range": [
                                                        362,
                                                        364
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "token_data[\"access_token\"]",
                                                            "range": [
                                                                364,
                                                                366
                                                            ],
                                                            "children": [],
                                                            "content": "token_data[\"access_token\""
                                                        }
                                                    ],
                                                    "content": "access_token=token_data"
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "refresh_token",
                                                    "range": [
                                                        370,
                                                        372
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "None",
                                                            "range": [
                                                                372,
                                                                372
                                                            ],
                                                            "children": [],
                                                            "content": "None"
                                                        }
                                                    ],
                                                    "content": "refresh_token=None"
                                                },
                                                {
                                                    "type": "Property",
                                                    "name": "access_token_expires_at",
                                                    "range": [
                                                        375,
                                                        377
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "None",
                                                            "range": [
                                                                377,
                                                                377
                                                            ],
                                                            "children": [],
                                                            "content": "None"
                                                        }
                                                    ],
                                                    "content": "access_token_expires_at=None"
                                                }
                                            ],
                                            "content": "OAuth2Credentials(\nprovider=self.PROVIDER_NAME,\ntitle=token_data.get(\"workspace_name\"),\nusername=email,\naccess_token=token_data[\"access_token\"],\nrefresh_token=None,\naccess_token_expires_at=None,"
                                        }
                                    ],
                                    "content": "return OAuth2Credentials(\nprovider=self.PROVIDER_NAME,\ntitle=token_data.get(\"workspace_name\"),\nusername=email,\naccess_token=token_data[\"access_token\"],\nrefresh_token=None,\naccess_token_expires_at=None,"
                                }
                            ],
                            "content": "\nrequest_body={\n\"grant_type\":\"authorization_code\",\n\"code\":code,\n\"redirect_uri\":self.redirect_uri,\n}\nauth_str=b64encode(f \"{self.client_id}:{self.client_secret}\".encode()).decode()\nheaders={\n\"Authorization\":f \"Basic {auth_str}\",\n\"Accept\":\"application/json\",\n}\nresponse=requests.post(self.token_url,json=request_body,headers=headers)\ntoken_data=response.json()\n#Email is only available for non-bot users\nemail=(\ntoken_data[\"owner\"][\"person\"][\"email\"]\nif \"person\" in token_data[\"owner\"]\nand \"email\" in token_data[\"owner\"][\"person\"]\nelse None\n)\n"
                        }
                    ],
                    "content": "def exchange_code_for_tokens(\nself,code:str,scopes:list[str]\n)->OAuth2Credentials:\nrequest_body={\n\"grant_type\":\"authorization_code\",\n\"code\":code,\n\"redirect_uri\":self.redirect_uri,\n}\nauth_str=b64encode(f \"{self.client_id}:{self.client_secret}\".encode()).decode()\nheaders={\n\"Authorization\":f \"Basic {auth_str}\",\n\"Accept\":\"application/json\",\n}\nresponse=requests.post(self.token_url,json=request_body,headers=headers)\ntoken_data=response.json()\n#Email is only available for non-bot users\nemail=(\ntoken_data[\"owner\"][\"person\"][\"email\"]\nif \"person\" in token_data[\"owner\"]\nand \"email\" in token_data[\"owner\"][\"person\"]\nelse None\n)\n"
                },
                {
                    "type": "FunctionDecl",
                    "name": "revoke_tokens",
                    "range": [
                        383,
                        390
                    ],
                    "children": [
                        {
                            "type": "ParameterList",
                            "name": "parameters",
                            "range": [
                                385,
                                387
                            ],
                            "children": [
                                {
                                    "type": "Parameter",
                                    "name": "credentials",
                                    "range": [
                                        386,
                                        386
                                    ],
                                    "children": [],
                                    "content": "token"
                                }
                            ],
                            "content": "support token revocation"
                        },
                        {
                            "type": "Block",
                            "name": "body",
                            "range": [
                                388,
                                390
                            ],
                            "children": [
                                {
                                    "type": "ReturnStatement",
                                    "name": "return",
                                    "range": [
                                        389,
                                        390
                                    ],
                                    "children": [
                                        {
                                            "type": "Literal",
                                            "name": "False",
                                            "range": [
                                                390,
                                                390
                                            ],
                                            "children": [],
                                            "content": "False"
                                        }
                                    ],
                                    "content": "return False"
                                }
                            ],
                            "content": "\nreturn False"
                        }
                    ],
                    "content": "'t expire \\n             refresh_token_expires_at=None, \\n             scopes=[], \\n             metadata={ \\n                 \"owner\": token_data[\"owner\"], \\n                 \"bot_id\": token_data[\"bot_id\"], \\n                 \"workspace_id\": token_data[\"workspace_id\"], \\n                 \"workspace_name\": token_data.get(\"workspace_name\"), \\n                 \"workspace_icon\": token_data.get(\"workspace_icon\"), \\n             }, \\n         ) \\n  \\n     def revoke_tokens(self, credentials: OAuth2Credentials) -> bool: \\n         # Notion doesn' t support token revocation\nreturn False"
                },
                {
                    "type": "FunctionDecl",
                    "name": "_refresh_tokens",
                    "range": [
                        393,
                        415
                    ],
                    "children": [
                        {
                            "type": "ParameterList",
                            "name": "parameters",
                            "range": [
                                395,
                                401
                            ],
                            "children": [
                                {
                                    "type": "Parameter",
                                    "name": "self",
                                    "range": [
                                        396,
                                        396
                                    ],
                                    "children": [],
                                    "content": "self"
                                },
                                {
                                    "type": "Parameter",
                                    "name": "credentials",
                                    "range": [
                                        398,
                                        400
                                    ],
                                    "children": [],
                                    "content": "credentials:OAuth2Credentials"
                                }
                            ],
                            "content": "(self,credentials:OAuth2Credentials)"
                        },
                        {
                            "type": "Block",
                            "name": "body",
                            "range": [
                                406,
                                415
                            ],
                            "children": [
                                {
                                    "type": "ReturnStatement",
                                    "name": "return",
                                    "range": [
                                        414,
                                        415
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "credentials",
                                            "range": [
                                                415,
                                                415
                                            ],
                                            "children": [],
                                            "content": "False"
                                        }
                                    ],
                                    "content": "return False"
                                }
                            ],
                            "content": "\n#Notion doesn 't support token refresh \\n         return credentials \\n  \\n     def needs_refresh(self, credentials: OAuth2Credentials) -> bool: \\n         # Notion access tokens don' t expire\nreturn False"
                        }
                    ],
                    "content": "def _refresh_tokens(self,credentials:OAuth2Credentials)->OAuth2Credentials:\n#Notion doesn 't support token refresh \\n         return credentials \\n  \\n     def needs_refresh(self, credentials: OAuth2Credentials) -> bool: \\n         # Notion access tokens don' t expire\nreturn False"
                }
            ],
            "content": "class NotionOAuthHandler(BaseOAuthHandler):\n\"\"\" \\n     Based on the documentation at https://developers.notion.com/docs/authorization \\n  \\n     Notes: \\n     - Notion uses non-expiring access tokens and therefore doesn't have a refresh flow \\n     - Notion doesn't use scopes \\n     \"\"\"\n\nPROVIDER_NAME=ProviderName.NOTION\n\ndef __init__(self,client_id:str,client_secret:str,redirect_uri:str):\nself.client_id=client_id\nself.client_secret=client_secret\nself.redirect_uri=redirect_uri\nself.auth_base_url=\"https://api.notion.com/v1/oauth/authorize\"\nself.token_url=\"https://api.notion.com/v1/oauth/token\"\n\ndef get_login_url(self,scopes:list[str],state:str)->str:\nparams={\n\"client_id\":self.client_id,\n\"redirect_uri\":self.redirect_uri,\n\"response_type\":\"code\",\n\"owner\":\"user\",\n\"state\":state,\n}\nreturn f \"{self.auth_base_url}?{urlencode(params)}\"\n\ndef exchange_code_for_tokens(\nself,code:str,scopes:list[str]\n)->OAuth2Credentials:\nrequest_body={\n\"grant_type\":\"authorization_code\",\n\"code\":code,\n\"redirect_uri\":self.redirect_uri,\n}\nauth_str=b64encode(f \"{self.client_id}:{self.client_secret}\".encode()).decode()\nheaders={\n\"Authorization\":f \"Basic {auth_str}\",\n\"Accept\":\"application/json\",\n}\nresponse=requests.post(self.token_url,json=request_body,headers=headers)\ntoken_data=response.json()\n#Email is only available for non-bot users\nemail=(\ntoken_data[\"owner\"][\"person\"][\"email\"]\nif \"person\" in token_data[\"owner\"]\nand \"email\" in token_data[\"owner\"][\"person\"]\nelse None\n)\n\nreturn OAuth2Credentials(\nprovider=self.PROVIDER_NAME,\ntitle=token_data.get(\"workspace_name\"),\nusername=email,\naccess_token=token_data[\"access_token\"],\nrefresh_token=None,\naccess_token_expires_at=None,#Notion tokens don 't expire \\n             refresh_token_expires_at=None, \\n             scopes=[], \\n             metadata={ \\n                 \"owner\": token_data[\"owner\"], \\n                 \"bot_id\": token_data[\"bot_id\"], \\n                 \"workspace_id\": token_data[\"workspace_id\"], \\n                 \"workspace_name\": token_data.get(\"workspace_name\"), \\n                 \"workspace_icon\": token_data.get(\"workspace_icon\"), \\n             }, \\n         ) \\n  \\n     def revoke_tokens(self, credentials: OAuth2Credentials) -> bool: \\n         # Notion doesn' t support token revocation\nreturn False\n\ndef _refresh_tokens(self,credentials:OAuth2Credentials)->OAuth2Credentials:\n#Notion doesn 't support token refresh \\n         return credentials \\n  \\n     def needs_refresh(self, credentials: OAuth2Credentials) -> bool: \\n         # Notion access tokens don' t expire\nreturn False\n"
        }
    ],
    "content": "class NotionOAuthHandler(BaseOAuthHandler):\n\"\"\" \\n     Based on the documentation at https://developers.notion.com/docs/authorization \\n  \\n     Notes: \\n     - Notion uses non-expiring access tokens and therefore doesn't have a refresh flow \\n     - Notion doesn't use scopes \\n     \"\"\"\n\nPROVIDER_NAME=ProviderName.NOTION\n\ndef __init__(self,client_id:str,client_secret:str,redirect_uri:str):\nself.client_id=client_id\nself.client_secret=client_secret\nself.redirect_uri=redirect_uri\nself.auth_base_url=\"https://api.notion.com/v1/oauth/authorize\"\nself.token_url=\"https://api.notion.com/v1/oauth/token\"\n\ndef get_login_url(self,scopes:list[str],state:str)->str:\nparams={\n\"client_id\":self.client_id,\n\"redirect_uri\":self.redirect_uri,\n\"response_type\":\"code\",\n\"owner\":\"user\",\n\"state\":state,\n}\nreturn f \"{self.auth_base_url}?{urlencode(params)}\"\n\ndef exchange_code_for_tokens(\nself,code:str,scopes:list[str]\n)->OAuth2Credentials:\nrequest_body={\n\"grant_type\":\"authorization_code\",\n\"code\":code,\n\"redirect_uri\":self.redirect_uri,\n}\nauth_str=b64encode(f \"{self.client_id}:{self.client_secret}\".encode()).decode()\nheaders={\n\"Authorization\":f \"Basic {auth_str}\",\n\"Accept\":\"application/json\",\n}\nresponse=requests.post(self.token_url,json=request_body,headers=headers)\ntoken_data=response.json()\n#Email is only available for non-bot users\nemail=(\ntoken_data[\"owner\"][\"person\"][\"email\"]\nif \"person\" in token_data[\"owner\"]\nand \"email\" in token_data[\"owner\"][\"person\"]\nelse None\n)\n\nreturn OAuth2Credentials(\nprovider=self.PROVIDER_NAME,\ntitle=token_data.get(\"workspace_name\"),\nusername=email,\naccess_token=token_data[\"access_token\"],\nrefresh_token=None,\naccess_token_expires_at=None,#Notion tokens don 't expire \\n             refresh_token_expires_at=None, \\n             scopes=[], \\n             metadata={ \\n                 \"owner\": token_data[\"owner\"], \\n                 \"bot_id\": token_data[\"bot_id\"], \\n                 \"workspace_id\": token_data[\"workspace_id\"], \\n                 \"workspace_name\": token_data.get(\"workspace_name\"), \\n                 \"workspace_icon\": token_data.get(\"workspace_icon\"), \\n             }, \\n         ) \\n  \\n     def revoke_tokens(self, credentials: OAuth2Credentials) -> bool: \\n         # Notion doesn' t support token revocation\nreturn False\n\ndef _refresh_tokens(self,credentials:OAuth2Credentials)->OAuth2Credentials:\n#Notion doesn 't support token refresh \\n         return credentials \\n  \\n     def needs_refresh(self, credentials: OAuth2Credentials) -> bool: \\n         # Notion access tokens don' t expire\nreturn False\n"
}