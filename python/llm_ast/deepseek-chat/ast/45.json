{
    "type": "Program",
    "name": "Global",
    "range": [
        101,
        1790
    ],
    "children": [
        {
            "type": "ClassDecl",
            "name": "APIKeyError",
            "range": [
                101,
                114
            ],
            "children": [
                {
                    "type": "Inheritance",
                    "name": "Exception",
                    "range": [
                        103,
                        105
                    ],
                    "children": [],
                    "content": "#Some basic"
                },
                {
                    "type": "Docstring",
                    "name": "\"Base exception for API key operations\"",
                    "range": [
                        108,
                        110
                    ],
                    "children": [],
                    "content": "class APIKeyError("
                },
                {
                    "type": "PassStatement",
                    "name": "pass",
                    "range": [
                        113,
                        113
                    ],
                    "children": [],
                    "content": ":"
                }
            ],
            "content": "\n\n#Some basic exceptions\nclass APIKeyError(Exception):\n"
        },
        {
            "type": "ClassDecl",
            "name": "APIKeyNotFoundError",
            "range": [
                115,
                128
            ],
            "children": [
                {
                    "type": "Inheritance",
                    "name": "APIKeyError",
                    "range": [
                        117,
                        119
                    ],
                    "children": [],
                    "content": "\"\"\n\n"
                },
                {
                    "type": "Docstring",
                    "name": "\"Raised when an API key is not found\"",
                    "range": [
                        122,
                        124
                    ],
                    "children": [],
                    "content": "\n\nclass"
                },
                {
                    "type": "PassStatement",
                    "name": "pass",
                    "range": [
                        127,
                        127
                    ],
                    "children": [],
                    "content": "APIKeyError"
                }
            ],
            "content": "\"\"\"Base exception for API key operations\"\"\"\n\npass\n\n\nclass APIKeyNotFoundError(APIKeyError)"
        },
        {
            "type": "ClassDecl",
            "name": "APIKeyPermissionError",
            "range": [
                129,
                142
            ],
            "children": [
                {
                    "type": "Inheritance",
                    "name": "APIKeyError",
                    "range": [
                        131,
                        133
                    ],
                    "children": [],
                    "content": "\"\"\"Raised when an API key is not found\"\"\""
                },
                {
                    "type": "Docstring",
                    "name": "\"Raised when there are permission issues with API key operations\"",
                    "range": [
                        136,
                        138
                    ],
                    "children": [],
                    "content": "pass\n\n"
                },
                {
                    "type": "PassStatement",
                    "name": "pass",
                    "range": [
                        141,
                        141
                    ],
                    "children": [],
                    "content": "APIKeyPermissionError"
                }
            ],
            "content": ":\n\"\"\"Raised when an API key is not found\"\"\"\n\npass\n\n\nclass APIKeyPermissionError("
        },
        {
            "type": "ClassDecl",
            "name": "APIKeyValidationError",
            "range": [
                143,
                156
            ],
            "children": [
                {
                    "type": "Inheritance",
                    "name": "APIKeyError",
                    "range": [
                        145,
                        147
                    ],
                    "children": [],
                    "content": ":\n\"\""
                },
                {
                    "type": "Docstring",
                    "name": "\"Raised when API key validation fails\"",
                    "range": [
                        150,
                        152
                    ],
                    "children": [],
                    "content": "\n\npass"
                },
                {
                    "type": "PassStatement",
                    "name": "pass",
                    "range": [
                        155,
                        155
                    ],
                    "children": [],
                    "content": "\n"
                }
            ],
            "content": "APIKeyError):\n\"\"\"Raised when there are permission issues with API key operations\"\"\"\n\npass\n\n\nclass"
        },
        {
            "type": "ClassDecl",
            "name": "APIKey",
            "range": [
                157,
                216
            ],
            "children": [
                {
                    "type": "PropertyDecl",
                    "name": "name",
                    "range": [
                        164,
                        166
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "str",
                            "range": [
                                166
                            ],
                            "children": []
                        }
                    ],
                    "content": "\"Raised when API key validation fails\"\"\"\n"
                },
                {
                    "type": "PropertyDecl",
                    "name": "prefix",
                    "range": [
                        168,
                        170
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "str",
                            "range": [
                                170
                            ],
                            "children": []
                        }
                    ],
                    "content": "pass\n\n"
                },
                {
                    "type": "PropertyDecl",
                    "name": "key",
                    "range": [
                        172,
                        174
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "str",
                            "range": [
                                174
                            ],
                            "children": []
                        }
                    ],
                    "content": "class APIKey("
                },
                {
                    "type": "PropertyDecl",
                    "name": "status",
                    "range": [
                        176,
                        183
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "APIKeyStatus",
                            "range": [
                                178
                            ],
                            "children": []
                        },
                        {
                            "type": "AssignmentExpression",
                            "name": "=",
                            "range": [
                                179,
                                183
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "APIKeyStatus",
                                    "range": [
                                        180
                                    ],
                                    "children": []
                                },
                                {
                                    "type": "MemberExpression",
                                    "name": ".",
                                    "range": [
                                        181,
                                        182
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "ACTIVE",
                                            "range": [
                                                182
                                            ],
                                            "children": []
                                        }
                                    ],
                                    "content": "str\n"
                                }
                            ],
                            "content": "name:str\nprefix"
                        }
                    ],
                    "content": "):\nname:str\nprefix"
                },
                {
                    "type": "PropertyDecl",
                    "name": "permissions",
                    "range": [
                        184,
                        190
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "List",
                            "range": [
                                186
                            ],
                            "children": [
                                {
                                    "type": "TypeArgument",
                                    "name": "APIKeyPermission",
                                    "range": [
                                        188
                                    ],
                                    "children": []
                                }
                            ]
                        }
                    ],
                    "content": ":str\nkey:str\n"
                },
                {
                    "type": "PropertyDecl",
                    "name": "postfix",
                    "range": [
                        191,
                        193
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "str",
                            "range": [
                                193
                            ],
                            "children": []
                        }
                    ],
                    "content": "status:APIKeyStatus"
                },
                {
                    "type": "PropertyDecl",
                    "name": "created_at",
                    "range": [
                        195,
                        197
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "datetime",
                            "range": [
                                197
                            ],
                            "children": []
                        }
                    ],
                    "content": "APIKeyStatus.ACTIVE"
                },
                {
                    "type": "PropertyDecl",
                    "name": "last_used_at",
                    "range": [
                        199,
                        206
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "Optional",
                            "range": [
                                201
                            ],
                            "children": [
                                {
                                    "type": "TypeArgument",
                                    "name": "datetime",
                                    "range": [
                                        203
                                    ],
                                    "children": []
                                }
                            ]
                        },
                        {
                            "type": "AssignmentExpression",
                            "name": "=",
                            "range": [
                                205,
                                206
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "None",
                                    "range": [
                                        206
                                    ],
                                    "children": []
                                }
                            ],
                            "content": "\npostfix"
                        }
                    ],
                    "content": "permissions:List[APIKeyPermission]\npostfix"
                },
                {
                    "type": "PropertyDecl",
                    "name": "revoked_at",
                    "range": [
                        208,
                        215
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "Optional",
                            "range": [
                                210
                            ],
                            "children": [
                                {
                                    "type": "TypeArgument",
                                    "name": "datetime",
                                    "range": [
                                        212
                                    ],
                                    "children": []
                                }
                            ]
                        },
                        {
                            "type": "AssignmentExpression",
                            "name": "=",
                            "range": [
                                214,
                                215
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "None",
                                    "range": [
                                        215
                                    ],
                                    "children": []
                                }
                            ],
                            "content": "last_used_at:"
                        }
                    ],
                    "content": "str\ncreated_at:datetime\nlast_used_at:"
                },
                {
                    "type": "PropertyDecl",
                    "name": "description",
                    "range": [
                        217,
                        224
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "Optional",
                            "range": [
                                219
                            ],
                            "children": [
                                {
                                    "type": "TypeArgument",
                                    "name": "str",
                                    "range": [
                                        221
                                    ],
                                    "children": []
                                }
                            ]
                        },
                        {
                            "type": "AssignmentExpression",
                            "name": "=",
                            "range": [
                                223,
                                224
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "None",
                                    "range": [
                                        224
                                    ],
                                    "children": []
                                }
                            ],
                            "content": "revoked_at:"
                        }
                    ],
                    "content": "[datetime]=None\nrevoked_at:"
                },
                {
                    "type": "PropertyDecl",
                    "name": "user_id",
                    "range": [
                        226,
                        228
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "str",
                            "range": [
                                228
                            ],
                            "children": []
                        }
                    ],
                    "content": "[datetime]"
                }
            ],
            "content": "APIKeyValidationError(APIKeyError):\n\"\"\"Raised when API key validation fails\"\"\"\n\npass\n\n\nclass APIKey(BaseDbModel):\nname:str\nprefix:str\nkey:str\nstatus:APIKeyStatus=APIKeyStatus.ACTIVE\npermissions:List[APIKeyPermission]\npostfix:str\ncreated_at:datetime\nlast_used_at:Optional"
        },
        {
            "type": "FunctionDecl",
            "name": "from_db",
            "range": [
                231,
                368
            ],
            "children": [
                {
                    "type": "Parameter",
                    "name": "api_key",
                    "range": [
                        237,
                        239
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "PrismaAPIKey",
                            "range": [
                                239
                            ],
                            "children": []
                        }
                    ],
                    "content": "]=None"
                },
                {
                    "type": "BlockStatement",
                    "name": "",
                    "range": [
                        242,
                        368
                    ],
                    "children": [
                        {
                            "type": "TryStatement",
                            "name": "",
                            "range": [
                                243,
                                368
                            ],
                            "children": [
                                {
                                    "type": "BlockStatement",
                                    "name": "",
                                    "range": [
                                        245,
                                        347
                                    ],
                                    "children": [
                                        {
                                            "type": "ReturnStatement",
                                            "name": "",
                                            "range": [
                                                246,
                                                347
                                            ],
                                            "children": [
                                                {
                                                    "type": "NewExpression",
                                                    "name": "APIKey",
                                                    "range": [
                                                        247,
                                                        346
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Argument",
                                                            "name": "id",
                                                            "range": [
                                                                250,
                                                                255
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        251,
                                                                        255
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": ".",
                                                                            "range": [
                                                                                253,
                                                                                254
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "id",
                                                                                    "range": [
                                                                                        254
                                                                                    ],
                                                                                    "children": []
                                                                                }
                                                                            ],
                                                                            "content": ":PrismaAPIKey"
                                                                        }
                                                                    ],
                                                                    "content": "(api_key:PrismaAPIKey)"
                                                                }
                                                            ],
                                                            "content": "from_db(api_key:PrismaAPIKey)"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "name",
                                                            "range": [
                                                                257,
                                                                262
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        258,
                                                                        262
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": ".",
                                                                            "range": [
                                                                                260,
                                                                                261
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "name",
                                                                                    "range": [
                                                                                        261
                                                                                    ],
                                                                                    "children": []
                                                                                }
                                                                            ],
                                                                            "content": "\nreturn"
                                                                        }
                                                                    ],
                                                                    "content": "try:\nreturn APIKey"
                                                                }
                                                            ],
                                                            "content": "\ntry:\nreturn APIKey"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "prefix",
                                                            "range": [
                                                                264,
                                                                269
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        265,
                                                                        269
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": ".",
                                                                            "range": [
                                                                                267,
                                                                                268
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "prefix",
                                                                                    "range": [
                                                                                        268
                                                                                    ],
                                                                                    "children": []
                                                                                }
                                                                            ],
                                                                            "content": "api_key."
                                                                        }
                                                                    ],
                                                                    "content": "id=api_key.id"
                                                                }
                                                            ],
                                                            "content": "\nid=api_key.id"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "postfix",
                                                            "range": [
                                                                271,
                                                                276
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        272,
                                                                        276
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": ".",
                                                                            "range": [
                                                                                274,
                                                                                275
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "postfix",
                                                                                    "range": [
                                                                                        275
                                                                                    ],
                                                                                    "children": []
                                                                                }
                                                                            ],
                                                                            "content": "api_key."
                                                                        }
                                                                    ],
                                                                    "content": "name=api_key.name"
                                                                }
                                                            ],
                                                            "content": "\nname=api_key.name"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "key",
                                                            "range": [
                                                                278,
                                                                283
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        279,
                                                                        283
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": ".",
                                                                            "range": [
                                                                                281,
                                                                                282
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "key",
                                                                                    "range": [
                                                                                        282
                                                                                    ],
                                                                                    "children": []
                                                                                }
                                                                            ],
                                                                            "content": "api_key."
                                                                        }
                                                                    ],
                                                                    "content": "prefix=api_key.prefix"
                                                                }
                                                            ],
                                                            "content": "\nprefix=api_key.prefix"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "status",
                                                            "range": [
                                                                285,
                                                                293
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        286,
                                                                        293
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "NewExpression",
                                                                            "name": "APIKeyStatus",
                                                                            "range": [
                                                                                287,
                                                                                292
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Argument",
                                                                                    "name": "",
                                                                                    "range": [
                                                                                        289,
                                                                                        292
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "MemberExpression",
                                                                                            "name": ".",
                                                                                            "range": [
                                                                                                290,
                                                                                                291
                                                                                            ],
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "Identifier",
                                                                                                    "name": "status",
                                                                                                    "range": [
                                                                                                        291
                                                                                                    ],
                                                                                                    "children": []
                                                                                                }
                                                                                            ],
                                                                                            "content": "postfix,"
                                                                                        }
                                                                                    ],
                                                                                    "content": ".postfix,\n"
                                                                                }
                                                                            ],
                                                                            "content": "=api_key.postfix,\n"
                                                                        }
                                                                    ],
                                                                    "content": "postfix=api_key.postfix,\nkey"
                                                                }
                                                            ],
                                                            "content": "\npostfix=api_key.postfix,\nkey"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "permissions",
                                                            "range": [
                                                                295,
                                                                309
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        296,
                                                                        309
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "ArrayExpression",
                                                                            "name": "",
                                                                            "range": [
                                                                                297,
                                                                                308
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "NewExpression",
                                                                                    "name": "APIKeyPermission",
                                                                                    "range": [
                                                                                        298,
                                                                                        301
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Argument",
                                                                                            "name": "p",
                                                                                            "range": [
                                                                                                300
                                                                                            ],
                                                                                            "children": []
                                                                                        }
                                                                                    ],
                                                                                    "content": ",\nstatus="
                                                                                },
                                                                                {
                                                                                    "type": "ForStatement",
                                                                                    "name": "",
                                                                                    "range": [
                                                                                        302,
                                                                                        308
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "VariableDeclaration",
                                                                                            "name": "p",
                                                                                            "range": [
                                                                                                303
                                                                                            ],
                                                                                            "children": []
                                                                                        },
                                                                                        {
                                                                                            "type": "InExpression",
                                                                                            "name": "in",
                                                                                            "range": [
                                                                                                304,
                                                                                                307
                                                                                            ],
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "MemberExpression",
                                                                                                    "name": ".",
                                                                                                    "range": [
                                                                                                        306,
                                                                                                        307
                                                                                                    ],
                                                                                                    "children": [
                                                                                                        {
                                                                                                            "type": "Identifier",
                                                                                                            "name": "permissions",
                                                                                                            "range": [
                                                                                                                307
                                                                                                            ],
                                                                                                            "children": []
                                                                                                        }
                                                                                                    ],
                                                                                                    "content": "status)"
                                                                                                }
                                                                                            ],
                                                                                            "content": "api_key.status)"
                                                                                        }
                                                                                    ],
                                                                                    "content": "APIKeyStatus(api_key.status),"
                                                                                }
                                                                            ],
                                                                            "content": "key,\nstatus=APIKeyStatus(api_key.status),"
                                                                        }
                                                                    ],
                                                                    "content": ".key,\nstatus=APIKeyStatus(api_key.status),\n"
                                                                }
                                                            ],
                                                            "content": "api_key.key,\nstatus=APIKeyStatus(api_key.status),\n"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "created_at",
                                                            "range": [
                                                                311,
                                                                316
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        312,
                                                                        316
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": ".",
                                                                            "range": [
                                                                                314,
                                                                                315
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "createdAt",
                                                                                    "range": [
                                                                                        315
                                                                                    ],
                                                                                    "children": []
                                                                                }
                                                                            ],
                                                                            "content": "(p"
                                                                        }
                                                                    ],
                                                                    "content": "[APIKeyPermission(p)"
                                                                }
                                                            ],
                                                            "content": "=[APIKeyPermission(p)"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "last_used_at",
                                                            "range": [
                                                                318,
                                                                323
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        319,
                                                                        323
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": ".",
                                                                            "range": [
                                                                                321,
                                                                                322
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "lastUsedAt",
                                                                                    "range": [
                                                                                        322
                                                                                    ],
                                                                                    "children": []
                                                                                }
                                                                            ],
                                                                            "content": ".permissions"
                                                                        }
                                                                    ],
                                                                    "content": "in api_key.permissions]"
                                                                }
                                                            ],
                                                            "content": "p in api_key.permissions]"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "revoked_at",
                                                            "range": [
                                                                325,
                                                                330
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        326,
                                                                        330
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": ".",
                                                                            "range": [
                                                                                328,
                                                                                329
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "revokedAt",
                                                                                    "range": [
                                                                                        329
                                                                                    ],
                                                                                    "children": []
                                                                                }
                                                                            ],
                                                                            "content": "api_key."
                                                                        }
                                                                    ],
                                                                    "content": "created_at=api_key.createdAt"
                                                                }
                                                            ],
                                                            "content": "\ncreated_at=api_key.createdAt"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "description",
                                                            "range": [
                                                                332,
                                                                337
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        333,
                                                                        337
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": ".",
                                                                            "range": [
                                                                                335,
                                                                                336
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "description",
                                                                                    "range": [
                                                                                        336
                                                                                    ],
                                                                                    "children": []
                                                                                }
                                                                            ],
                                                                            "content": "api_key."
                                                                        }
                                                                    ],
                                                                    "content": "last_used_at=api_key.lastUsedAt"
                                                                }
                                                            ],
                                                            "content": "\nlast_used_at=api_key.lastUsedAt"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "user_id",
                                                            "range": [
                                                                339,
                                                                344
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "AssignmentExpression",
                                                                    "name": "=",
                                                                    "range": [
                                                                        340,
                                                                        344
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": ".",
                                                                            "range": [
                                                                                342,
                                                                                343
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "userId",
                                                                                    "range": [
                                                                                        343
                                                                                    ],
                                                                                    "children": []
                                                                                }
                                                                            ],
                                                                            "content": "api_key."
                                                                        }
                                                                    ],
                                                                    "content": "revoked_at=api_key.revokedAt"
                                                                }
                                                            ],
                                                            "content": "\nrevoked_at=api_key.revokedAt"
                                                        }
                                                    ],
                                                    "content": "staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKey(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nkey=api_key.key,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\n"
                                                }
                                            ],
                                            "content": "@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKey(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nkey=api_key.key,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\ndescription"
                                        }
                                    ],
                                    "content": "\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKey(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nkey=api_key.key,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\ndescription"
                                },
                                {
                                    "type": "CatchClause",
                                    "name": "",
                                    "range": [
                                        348,
                                        368
                                    ],
                                    "children": [
                                        {
                                            "type": "Parameter",
                                            "name": "e",
                                            "range": [
                                                351
                                            ],
                                            "children": []
                                        },
                                        {
                                            "type": "BlockStatement",
                                            "name": "",
                                            "range": [
                                                353,
                                                368
                                            ],
                                            "children": [
                                                {
                                                    "type": "ExpressionStatement",
                                                    "name": "",
                                                    "range": [
                                                        354,
                                                        361
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "",
                                                            "range": [
                                                                355,
                                                                360
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": ".",
                                                                    "range": [
                                                                        355,
                                                                        356
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "error",
                                                                            "range": [
                                                                                356
                                                                            ],
                                                                            "children": []
                                                                        }
                                                                    ],
                                                                    "content": "=api_key"
                                                                },
                                                                {
                                                                    "type": "Argument",
                                                                    "name": "",
                                                                    "range": [
                                                                        358,
                                                                        360
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "TemplateLiteral",
                                                                            "name": "",
                                                                            "range": [
                                                                                359
                                                                            ],
                                                                            "children": []
                                                                        }
                                                                    ],
                                                                    "content": "userId,\n"
                                                                }
                                                            ],
                                                            "content": "=api_key.userId,\n"
                                                        }
                                                    ],
                                                    "content": "user_id=api_key.userId,\n)"
                                                },
                                                {
                                                    "type": "ThrowStatement",
                                                    "name": "",
                                                    "range": [
                                                        362,
                                                        368
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "NewExpression",
                                                            "name": "APIKeyError",
                                                            "range": [
                                                                363,
                                                                367
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Argument",
                                                                    "name": "",
                                                                    "range": [
                                                                        365,
                                                                        367
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "TemplateLiteral",
                                                                            "name": "",
                                                                            "range": [
                                                                                366
                                                                            ],
                                                                            "children": []
                                                                        }
                                                                    ],
                                                                    "content": "as e:"
                                                                }
                                                            ],
                                                            "content": "except Exception as e:"
                                                        }
                                                    ],
                                                    "content": "\nexcept Exception as e:\n"
                                                }
                                            ],
                                            "content": "\nuser_id=api_key.userId,\n)\nexcept Exception as e:\n"
                                        }
                                    ],
                                    "content": "=api_key.description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:\n"
                                }
                            ],
                            "content": "str\n\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKey(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nkey=api_key.key,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\ndescription=api_key.description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:\n"
                        }
                    ],
                    "content": ":str\n\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKey(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nkey=api_key.key,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\ndescription=api_key.description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:\n"
                }
            ],
            "content": "\ndescription:Optional[str]=None\nuser_id:str\n\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKey(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nkey=api_key.key,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\ndescription=api_key.description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:\n"
        },
        {
            "type": "ClassDecl",
            "name": "APIKeyWithoutHash",
            "range": [
                370,
                432
            ],
            "children": [
                {
                    "type": "Property",
                    "name": "id",
                    "range": [
                        377,
                        379
                    ],
                    "children": [],
                    "content": "raise APIKeyError("
                },
                {
                    "type": "Property",
                    "name": "name",
                    "range": [
                        381,
                        383
                    ],
                    "children": [],
                    "content": "\"Failed to create API key object: {str(e)}\")\n"
                },
                {
                    "type": "Property",
                    "name": "prefix",
                    "range": [
                        385,
                        387
                    ],
                    "children": [],
                    "content": "\nclass APIKeyWithoutHash"
                },
                {
                    "type": "Property",
                    "name": "postfix",
                    "range": [
                        389,
                        391
                    ],
                    "children": [],
                    "content": "BaseModel):"
                },
                {
                    "type": "Property",
                    "name": "status",
                    "range": [
                        393,
                        395
                    ],
                    "children": [],
                    "content": "id:str"
                },
                {
                    "type": "Property",
                    "name": "permissions",
                    "range": [
                        397,
                        402
                    ],
                    "children": [],
                    "content": "name:str\nprefix:"
                },
                {
                    "type": "Property",
                    "name": "created_at",
                    "range": [
                        404,
                        406
                    ],
                    "children": [],
                    "content": "\npostfix:"
                },
                {
                    "type": "Property",
                    "name": "last_used_at",
                    "range": [
                        408,
                        413
                    ],
                    "children": [],
                    "content": "\nstatus:APIKeyStatus\npermissions"
                },
                {
                    "type": "Property",
                    "name": "revoked_at",
                    "range": [
                        415,
                        420
                    ],
                    "children": [],
                    "content": "List[APIKeyPermission]\ncreated_at"
                },
                {
                    "type": "Property",
                    "name": "description",
                    "range": [
                        422,
                        427
                    ],
                    "children": [],
                    "content": "datetime\nlast_used_at:Optional["
                },
                {
                    "type": "Property",
                    "name": "user_id",
                    "range": [
                        429,
                        431
                    ],
                    "children": [],
                    "content": "]\nrevoked_at"
                }
            ],
            "content": ".error(f \"Error creating APIKey from db: {str(e)}\")\nraise APIKeyError(f \"Failed to create API key object: {str(e)}\")\n\n\nclass APIKeyWithoutHash(BaseModel):\nid:str\nname:str\nprefix:str\npostfix:str\nstatus:APIKeyStatus\npermissions:List[APIKeyPermission]\ncreated_at:datetime\nlast_used_at:Optional[datetime]\nrevoked_at:"
        },
        {
            "type": "FunctionDecl",
            "name": "from_db",
            "range": [
                434,
                564
            ],
            "children": [
                {
                    "type": "Parameter",
                    "name": "api_key",
                    "range": [
                        440,
                        442
                    ],
                    "children": [],
                    "content": "Optional[str"
                },
                {
                    "type": "BlockStatement",
                    "range": [
                        446,
                        564
                    ],
                    "children": [
                        {
                            "type": "TryStatement",
                            "range": [
                                446,
                                564
                            ],
                            "children": [
                                {
                                    "type": "BlockStatement",
                                    "range": [
                                        448,
                                        543
                                    ],
                                    "children": [
                                        {
                                            "type": "ReturnStatement",
                                            "range": [
                                                449,
                                                542
                                            ],
                                            "children": [
                                                {
                                                    "type": "NewExpression",
                                                    "range": [
                                                        450,
                                                        542
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Property",
                                                            "name": "id",
                                                            "range": [
                                                                453,
                                                                457
                                                            ],
                                                            "children": [],
                                                            "content": "def from_db(api_key:"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "name",
                                                            "range": [
                                                                460,
                                                                464
                                                            ],
                                                            "children": [],
                                                            "content": ":\ntry:\n"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "prefix",
                                                            "range": [
                                                                467,
                                                                471
                                                            ],
                                                            "children": [],
                                                            "content": "(\nid=api_key"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "postfix",
                                                            "range": [
                                                                474,
                                                                478
                                                            ],
                                                            "children": [],
                                                            "content": ",\nname=api_key"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "status",
                                                            "range": [
                                                                481,
                                                                487
                                                            ],
                                                            "children": [],
                                                            "content": ",\nprefix=api_key.prefix"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "permissions",
                                                            "range": [
                                                                491,
                                                                503
                                                            ],
                                                            "children": [],
                                                            "content": "=api_key.postfix,\nstatus=APIKeyStatus(api_key.status"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "created_at",
                                                            "range": [
                                                                507,
                                                                511
                                                            ],
                                                            "children": [],
                                                            "content": "permissions=[APIKeyPermission("
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "last_used_at",
                                                            "range": [
                                                                514,
                                                                518
                                                            ],
                                                            "children": [],
                                                            "content": "for p in api_key."
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "revoked_at",
                                                            "range": [
                                                                521,
                                                                525
                                                            ],
                                                            "children": [],
                                                            "content": ",\ncreated_at=api_key"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "description",
                                                            "range": [
                                                                528,
                                                                532
                                                            ],
                                                            "children": [],
                                                            "content": ",\nlast_used_at=api_key"
                                                        },
                                                        {
                                                            "type": "Property",
                                                            "name": "user_id",
                                                            "range": [
                                                                535,
                                                                539
                                                            ],
                                                            "children": [],
                                                            "content": ",\nrevoked_at=api_key"
                                                        }
                                                    ],
                                                    "content": "@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKeyWithoutHash(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,"
                                                }
                                            ],
                                            "content": "\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKeyWithoutHash(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,"
                                        }
                                    ],
                                    "content": "\n\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKeyWithoutHash(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\n"
                                },
                                {
                                    "type": "CatchClause",
                                    "range": [
                                        544,
                                        564
                                    ],
                                    "children": [
                                        {
                                            "type": "BlockStatement",
                                            "range": [
                                                548,
                                                564
                                            ],
                                            "children": [
                                                {
                                                    "type": "ExpressionStatement",
                                                    "range": [
                                                        550,
                                                        556
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "range": [
                                                                550,
                                                                556
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "range": [
                                                                        550,
                                                                        552
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "logger",
                                                                            "range": [
                                                                                550,
                                                                                550
                                                                            ],
                                                                            "content": "\n"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "error",
                                                                            "range": [
                                                                                552,
                                                                                552
                                                                            ],
                                                                            "content": "="
                                                                        }
                                                                    ],
                                                                    "content": "\nuser_id="
                                                                },
                                                                {
                                                                    "type": "Literal",
                                                                    "value": "Error creating APIKeyWithoutHash from db: {str(e)}",
                                                                    "range": [
                                                                        554,
                                                                        555
                                                                    ],
                                                                    "content": ".userId"
                                                                }
                                                            ],
                                                            "content": "\nuser_id=api_key.userId,"
                                                        }
                                                    ],
                                                    "content": "\nuser_id=api_key.userId,"
                                                },
                                                {
                                                    "type": "ThrowStatement",
                                                    "range": [
                                                        558,
                                                        564
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "NewExpression",
                                                            "range": [
                                                                559,
                                                                563
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "APIKeyError",
                                                                    "range": [
                                                                        559,
                                                                        559
                                                                    ],
                                                                    "content": "\n"
                                                                },
                                                                {
                                                                    "type": "Literal",
                                                                    "value": "Failed to create API key object: {str(e)}",
                                                                    "range": [
                                                                        561,
                                                                        562
                                                                    ],
                                                                    "content": "Exception as"
                                                                }
                                                            ],
                                                            "content": "\nexcept Exception as e"
                                                        }
                                                    ],
                                                    "content": ")\nexcept Exception as e:"
                                                }
                                            ],
                                            "content": "description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:"
                                        }
                                    ],
                                    "content": "description=api_key.description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:"
                                }
                            ],
                            "content": ":str\n\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKeyWithoutHash(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\ndescription=api_key.description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:"
                        }
                    ],
                    "content": ":str\n\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKeyWithoutHash(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\ndescription=api_key.description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:"
                }
            ],
            "content": "[datetime]\ndescription:Optional[str]\nuser_id:str\n\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKeyWithoutHash(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\ndescription=api_key.description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:"
        },
        {
            "type": "FunctionDecl",
            "name": "generate_api_key",
            "range": [
                565,
                769
            ],
            "children": [
                {
                    "type": "AsyncKeyword",
                    "name": "async",
                    "range": [
                        565,
                        569
                    ],
                    "children": [],
                    "content": "\nlogger.error("
                },
                {
                    "type": "DefKeyword",
                    "name": "def",
                    "range": [
                        566,
                        569
                    ],
                    "children": [],
                    "content": "logger.error("
                },
                {
                    "type": "Identifier",
                    "name": "generate_api_key",
                    "range": [
                        567,
                        598
                    ],
                    "children": [],
                    "content": ".error(f \"Error creating APIKeyWithoutHash from db: {str(e)}\")\nraise APIKeyError(f \"Failed to create API key object: {str(e)}\")\n\n\nasync def generate_api_key(\nname:str,\nuser_id:str,\npermissions"
                },
                {
                    "type": "ParameterList",
                    "name": "parameters",
                    "range": [
                        568,
                        598
                    ],
                    "children": [
                        {
                            "type": "Parameter",
                            "name": "name",
                            "range": [
                                570,
                                573
                            ],
                            "children": [],
                            "content": "f \"Error creating APIKeyWithoutHash from db: {str(e)}\")\n"
                        },
                        {
                            "type": "Parameter",
                            "name": "user_id",
                            "range": [
                                575,
                                578
                            ],
                            "children": [],
                            "content": "APIKeyError(f \"Failed to create API key object: {str(e)}\""
                        },
                        {
                            "type": "Parameter",
                            "name": "permissions",
                            "range": [
                                580,
                                586
                            ],
                            "children": [],
                            "content": "\n\n\nasync def generate_api_key("
                        },
                        {
                            "type": "Parameter",
                            "name": "description",
                            "range": [
                                588,
                                596
                            ],
                            "children": [],
                            "content": "name:str,\nuser_id:str,"
                        }
                    ],
                    "content": "error(f \"Error creating APIKeyWithoutHash from db: {str(e)}\")\nraise APIKeyError(f \"Failed to create API key object: {str(e)}\")\n\n\nasync def generate_api_key(\nname:str,\nuser_id:str,\npermissions"
                },
                {
                    "type": "ReturnType",
                    "name": "return_type",
                    "range": [
                        599,
                        607
                    ],
                    "children": [
                        {
                            "type": "TupleType",
                            "name": "tuple",
                            "range": [
                                601,
                                606
                            ],
                            "children": [
                                {
                                    "type": "Type",
                                    "name": "APIKeyWithoutHash",
                                    "range": [
                                        603,
                                        603
                                    ],
                                    "children": [],
                                    "content": "]"
                                },
                                {
                                    "type": "Type",
                                    "name": "str",
                                    "range": [
                                        605,
                                        605
                                    ],
                                    "children": [],
                                    "content": "\n"
                                }
                            ],
                            "content": "[APIKeyPermission],\ndescription"
                        }
                    ],
                    "content": ":List[APIKeyPermission],\ndescription:"
                },
                {
                    "type": "BlockStatement",
                    "name": "body",
                    "range": [
                        608,
                        769
                    ],
                    "children": [
                        {
                            "type": "Docstring",
                            "name": "docstring",
                            "range": [
                                609,
                                611
                            ],
                            "children": [],
                            "content": "[str]"
                        },
                        {
                            "type": "TryStatement",
                            "name": "try_block",
                            "range": [
                                613,
                                748
                            ],
                            "children": [
                                {
                                    "type": "TryKeyword",
                                    "name": "try",
                                    "range": [
                                        613,
                                        616
                                    ],
                                    "children": [],
                                    "content": "None,\n)"
                                },
                                {
                                    "type": "BlockStatement",
                                    "name": "block",
                                    "range": [
                                        617,
                                        748
                                    ],
                                    "children": [
                                        {
                                            "type": "AssignmentExpression",
                                            "name": "api_manager",
                                            "range": [
                                                616,
                                                621
                                            ],
                                            "children": [],
                                            "content": ")->tuple[APIKeyWithoutHash"
                                        },
                                        {
                                            "type": "AssignmentExpression",
                                            "name": "key",
                                            "range": [
                                                622,
                                                629
                                            ],
                                            "children": [],
                                            "content": ",str]:\n\"\"\" \\n     Generate a new API key and store it in the database. \\n     Returns the API key object (without hash) and the plain text key. \\n     \"\"\""
                                        },
                                        {
                                            "type": "AwaitExpression",
                                            "name": "await",
                                            "range": [
                                                633,
                                                710
                                            ],
                                            "children": [
                                                {
                                                    "type": "CallExpression",
                                                    "name": "create",
                                                    "range": [
                                                        640,
                                                        709
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Argument",
                                                            "name": "data",
                                                            "range": [
                                                                643,
                                                                707
                                                            ],
                                                            "children": [],
                                                            "content": ".generate_api_key()\n\napi_key=await PrismaAPIKey.prisma().create(\ndata=APIKeyCreateInput(\nid=str(uuid.uuid4()),\nname=name,\nprefix=key.prefix,\npostfix=key.postfix,\nkey=key.hash,\npermissions=[p"
                                                        }
                                                    ],
                                                    "content": "key=api_manager.generate_api_key()\n\napi_key=await PrismaAPIKey.prisma().create(\ndata=APIKeyCreateInput(\nid=str(uuid.uuid4()),\nname=name,\nprefix=key.prefix,\npostfix=key.postfix,\nkey=key.hash,\npermissions=[p for p"
                                                }
                                            ],
                                            "content": "\napi_manager=APIKeyManager()\nkey=api_manager.generate_api_key()\n\napi_key=await PrismaAPIKey.prisma().create(\ndata=APIKeyCreateInput(\nid=str(uuid.uuid4()),\nname=name,\nprefix=key.prefix,\npostfix=key.postfix,\nkey=key.hash,\npermissions=[p for p in"
                                        },
                                        {
                                            "type": "AssignmentExpression",
                                            "name": "api_key_without_hash",
                                            "range": [
                                                712,
                                                720
                                            ],
                                            "children": [],
                                            "content": "],\ndescription=description,\nuserId"
                                        },
                                        {
                                            "type": "ReturnStatement",
                                            "name": "return",
                                            "range": [
                                                721,
                                                727
                                            ],
                                            "children": [],
                                            "content": "=user_id,\n)\n)"
                                        }
                                    ],
                                    "content": "->tuple[APIKeyWithoutHash,str]:\n\"\"\" \\n     Generate a new API key and store it in the database. \\n     Returns the API key object (without hash) and the plain text key. \\n     \"\"\"\ntry:\napi_manager=APIKeyManager()\nkey=api_manager.generate_api_key()\n\napi_key=await PrismaAPIKey.prisma().create(\ndata=APIKeyCreateInput(\nid=str(uuid.uuid4()),\nname=name,\nprefix=key.prefix,\npostfix=key.postfix,\nkey=key.hash,\npermissions=[p for p in permissions],\ndescription=description,\nuserId=user_id,\n)\n)\n\napi_key_without_hash=APIKeyWithoutHash.from_db(api_key)\nreturn api_key_without_hash,key.raw\nexcept PrismaError as"
                                },
                                {
                                    "type": "CatchClause",
                                    "name": "except_block",
                                    "range": [
                                        728,
                                        748
                                    ],
                                    "children": [
                                        {
                                            "type": "ExceptKeyword",
                                            "name": "except",
                                            "range": [
                                                728,
                                                732
                                            ],
                                            "children": [],
                                            "content": "\n\napi_key_without_hash=APIKeyWithoutHash"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "PrismaError",
                                            "range": [
                                                729,
                                                732
                                            ],
                                            "children": [],
                                            "content": "\napi_key_without_hash=APIKeyWithoutHash"
                                        },
                                        {
                                            "type": "BlockStatement",
                                            "name": "block",
                                            "range": [
                                                733,
                                                748
                                            ],
                                            "children": [
                                                {
                                                    "type": "CallExpression",
                                                    "name": "error",
                                                    "range": [
                                                        736,
                                                        740
                                                    ],
                                                    "children": [],
                                                    "content": "api_key)\nreturn api_key_without_hash"
                                                },
                                                {
                                                    "type": "ThrowStatement",
                                                    "name": "raise",
                                                    "range": [
                                                        742,
                                                        748
                                                    ],
                                                    "children": [],
                                                    "content": "key.raw\nexcept PrismaError as"
                                                }
                                            ],
                                            "content": ".from_db(api_key)\nreturn api_key_without_hash,key.raw\nexcept PrismaError as"
                                        }
                                    ],
                                    "content": "\n\napi_key_without_hash=APIKeyWithoutHash.from_db(api_key)\nreturn api_key_without_hash,key.raw\nexcept PrismaError as"
                                }
                            ],
                            "content": "None,\n)->tuple[APIKeyWithoutHash,str]:\n\"\"\" \\n     Generate a new API key and store it in the database. \\n     Returns the API key object (without hash) and the plain text key. \\n     \"\"\"\ntry:\napi_manager=APIKeyManager()\nkey=api_manager.generate_api_key()\n\napi_key=await PrismaAPIKey.prisma().create(\ndata=APIKeyCreateInput(\nid=str(uuid.uuid4()),\nname=name,\nprefix=key.prefix,\npostfix=key.postfix,\nkey=key.hash,\npermissions=[p for p in permissions],\ndescription=description,\nuserId=user_id,\n)\n)\n\napi_key_without_hash=APIKeyWithoutHash.from_db(api_key)\nreturn api_key_without_hash,key.raw\nexcept PrismaError as"
                        },
                        {
                            "type": "CatchClause",
                            "name": "except_block",
                            "range": [
                                749,
                                769
                            ],
                            "children": [
                                {
                                    "type": "ExceptKeyword",
                                    "name": "except",
                                    "range": [
                                        749,
                                        753
                                    ],
                                    "children": [],
                                    "content": "e:\nlogger."
                                },
                                {
                                    "type": "Identifier",
                                    "name": "Exception",
                                    "range": [
                                        750,
                                        753
                                    ],
                                    "children": [],
                                    "content": ":\nlogger."
                                },
                                {
                                    "type": "BlockStatement",
                                    "name": "block",
                                    "range": [
                                        754,
                                        769
                                    ],
                                    "children": [
                                        {
                                            "type": "CallExpression",
                                            "name": "error",
                                            "range": [
                                                757,
                                                761
                                            ],
                                            "children": [],
                                            "content": "\"Database error while generating API key: {str(e)}\")\nraise APIKeyError"
                                        },
                                        {
                                            "type": "ThrowStatement",
                                            "name": "raise",
                                            "range": [
                                                763,
                                                769
                                            ],
                                            "children": [],
                                            "content": "f \"Failed to generate API key: {str(e)}\")\nexcept Exception as"
                                        }
                                    ],
                                    "content": "error(f \"Database error while generating API key: {str(e)}\")\nraise APIKeyError(f \"Failed to generate API key: {str(e)}\")\nexcept Exception as"
                                }
                            ],
                            "content": "e:\nlogger.error(f \"Database error while generating API key: {str(e)}\")\nraise APIKeyError(f \"Failed to generate API key: {str(e)}\")\nexcept Exception as"
                        }
                    ],
                    "content": "Optional[str]=None,\n)->tuple[APIKeyWithoutHash,str]:\n\"\"\" \\n     Generate a new API key and store it in the database. \\n     Returns the API key object (without hash) and the plain text key. \\n     \"\"\"\ntry:\napi_manager=APIKeyManager()\nkey=api_manager.generate_api_key()\n\napi_key=await PrismaAPIKey.prisma().create(\ndata=APIKeyCreateInput(\nid=str(uuid.uuid4()),\nname=name,\nprefix=key.prefix,\npostfix=key.postfix,\nkey=key.hash,\npermissions=[p for p in permissions],\ndescription=description,\nuserId=user_id,\n)\n)\n\napi_key_without_hash=APIKeyWithoutHash.from_db(api_key)\nreturn api_key_without_hash,key.raw\nexcept PrismaError as e:\nlogger.error(f \"Database error while generating API key: {str(e)}\")\nraise APIKeyError(f \"Failed to generate API key: {str(e)}\")\nexcept Exception as"
                }
            ],
            "content": "\nlogger.error(f \"Error creating APIKeyWithoutHash from db: {str(e)}\")\nraise APIKeyError(f \"Failed to create API key object: {str(e)}\")\n\n\nasync def generate_api_key(\nname:str,\nuser_id:str,\npermissions:List[APIKeyPermission],\ndescription:Optional[str]=None,\n)->tuple[APIKeyWithoutHash,str]:\n\"\"\" \\n     Generate a new API key and store it in the database. \\n     Returns the API key object (without hash) and the plain text key. \\n     \"\"\"\ntry:\napi_manager=APIKeyManager()\nkey=api_manager.generate_api_key()\n\napi_key=await PrismaAPIKey.prisma().create(\ndata=APIKeyCreateInput(\nid=str(uuid.uuid4()),\nname=name,\nprefix=key.prefix,\npostfix=key.postfix,\nkey=key.hash,\npermissions=[p for p in permissions],\ndescription=description,\nuserId=user_id,\n)\n)\n\napi_key_without_hash=APIKeyWithoutHash.from_db(api_key)\nreturn api_key_without_hash,key.raw\nexcept PrismaError as e:\nlogger.error(f \"Database error while generating API key: {str(e)}\")\nraise APIKeyError(f \"Failed to generate API key: {str(e)}\")\nexcept Exception as"
        },
        {
            "type": "FunctionDecl",
            "name": "validate_api_key",
            "range": [
                770,
                939
            ],
            "children": [
                {
                    "type": "FunctionSignature",
                    "name": "validate_api_key",
                    "range": [
                        770,
                        784
                    ],
                    "children": [
                        {
                            "type": "Keyword",
                            "name": "async",
                            "range": [
                                770,
                                774
                            ],
                            "children": [],
                            "content": "e:\nlogger."
                        },
                        {
                            "type": "Keyword",
                            "name": "def",
                            "range": [
                                771,
                                774
                            ],
                            "children": [],
                            "content": ":\nlogger."
                        },
                        {
                            "type": "Identifier",
                            "name": "validate_api_key",
                            "range": [
                                772,
                                787
                            ],
                            "children": [],
                            "content": "\nlogger.error(f \"Unexpected error while generating API key: {str(e)}\")\nraise APIKeyError(f \"Failed to generate API key: {str(e)}\")\n"
                        },
                        {
                            "type": "Parameter",
                            "name": "plain_text_key",
                            "range": [
                                774,
                                777
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "plain_text_key",
                                    "range": [
                                        774,
                                        787
                                    ],
                                    "children": [],
                                    "content": ".error(f \"Unexpected error while generating API key: {str(e)}\")\nraise APIKeyError(f \"Failed to generate API key: {str(e)}\")\n"
                                },
                                {
                                    "type": "TypeAnnotation",
                                    "name": "str",
                                    "range": [
                                        776,
                                        779
                                    ],
                                    "children": [],
                                    "content": "(f \"Unexpected error while generating API key: {str(e)}\")"
                                }
                            ],
                            "content": ".error(f"
                        },
                        {
                            "type": "ReturnType",
                            "name": "Optional[APIKey]",
                            "range": [
                                780,
                                784
                            ],
                            "children": [
                                {
                                    "type": "Keyword",
                                    "name": "Optional",
                                    "range": [
                                        780,
                                        787
                                    ],
                                    "children": [],
                                    "content": "\nraise APIKeyError(f \"Failed to generate API key: {str(e)}\")\n"
                                },
                                {
                                    "type": "Type",
                                    "name": "APIKey",
                                    "range": [
                                        782,
                                        787
                                    ],
                                    "children": [],
                                    "content": "APIKeyError(f \"Failed to generate API key: {str(e)}\")\n"
                                }
                            ],
                            "content": "\nraise APIKeyError(f"
                        }
                    ],
                    "content": "e:\nlogger.error(f \"Unexpected error while generating API key: {str(e)}\")\nraise APIKeyError(f"
                },
                {
                    "type": "FunctionBody",
                    "name": "validate_api_key",
                    "range": [
                        785,
                        939
                    ],
                    "children": [
                        {
                            "type": "Docstring",
                            "name": "Validate an API key and return the API key object if valid.",
                            "range": [
                                786,
                                788
                            ],
                            "children": [],
                            "content": ")\n\n"
                        },
                        {
                            "type": "TryStatement",
                            "name": "try",
                            "range": [
                                790,
                                939
                            ],
                            "children": [
                                {
                                    "type": "TryBlock",
                                    "name": "try",
                                    "range": [
                                        790,
                                        919
                                    ],
                                    "children": [
                                        {
                                            "type": "IfStatement",
                                            "name": "if",
                                            "range": [
                                                793,
                                                814
                                            ],
                                            "children": [
                                                {
                                                    "type": "Condition",
                                                    "name": "not plain_text_key.startswith(APIKeyManager.PREFIX)",
                                                    "range": [
                                                        794,
                                                        803
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "UnaryExpression",
                                                            "name": "not",
                                                            "range": [
                                                                794,
                                                                797
                                                            ],
                                                            "children": [],
                                                            "content": "plain_text_key:str)"
                                                        },
                                                        {
                                                            "type": "MemberExpression",
                                                            "name": "plain_text_key.startswith",
                                                            "range": [
                                                                795,
                                                                802
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "plain_text_key",
                                                                    "range": [
                                                                        795,
                                                                        808
                                                                    ],
                                                                    "children": [],
                                                                    "content": ":str)->Optional[APIKey]:\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\""
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "startswith",
                                                                    "range": [
                                                                        797,
                                                                        807
                                                                    ],
                                                                    "children": [],
                                                                    "content": ")->Optional[APIKey]:\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \""
                                                                }
                                                            ],
                                                            "content": ":str)->Optional[APIKey"
                                                        },
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "startswith(APIKeyManager.PREFIX)",
                                                            "range": [
                                                                798,
                                                                802
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "APIKeyManager.PREFIX",
                                                                    "range": [
                                                                        799,
                                                                        801
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "APIKeyManager",
                                                                            "range": [
                                                                                799,
                                                                                812
                                                                            ],
                                                                            "children": [],
                                                                            "content": ">Optional[APIKey]:\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:\n"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "PREFIX",
                                                                            "range": [
                                                                                801,
                                                                                807
                                                                            ],
                                                                            "children": [],
                                                                            "content": "[APIKey]:\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \""
                                                                        }
                                                                    ],
                                                                    "content": ">Optional["
                                                                }
                                                            ],
                                                            "content": "->Optional[APIKey"
                                                        }
                                                    ],
                                                    "content": "plain_text_key:str)->Optional[APIKey]"
                                                },
                                                {
                                                    "type": "Block",
                                                    "name": "if",
                                                    "range": [
                                                        804,
                                                        814
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "ExpressionStatement",
                                                            "name": "logger.warning(\"Invalid API key format\")",
                                                            "range": [
                                                                805,
                                                                811
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "logger.warning",
                                                                    "range": [
                                                                        805,
                                                                        810
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "logger",
                                                                            "range": [
                                                                                805,
                                                                                811
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "warning",
                                                                            "range": [
                                                                                807,
                                                                                814
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:\nif not"
                                                                        }
                                                                    ],
                                                                    "content": "\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry"
                                                                },
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "warning(\"Invalid API key format\")",
                                                                    "range": [
                                                                        808,
                                                                        810
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "StringLiteral",
                                                                            "name": "\"Invalid API key format\"",
                                                                            "range": [
                                                                                809,
                                                                                810
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\ntry"
                                                                        }
                                                                    ],
                                                                    "content": "\"\"\ntry"
                                                                },
                                                                {
                                                                    "type": "ReturnStatement",
                                                                    "name": "return None",
                                                                    "range": [
                                                                        812,
                                                                        814
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Keyword",
                                                                            "name": "return",
                                                                            "range": [
                                                                                812,
                                                                                818
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\nif not plain_text_key.startswith("
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "None",
                                                                            "range": [
                                                                                813,
                                                                                817
                                                                            ],
                                                                            "children": [],
                                                                            "content": "if not plain_text_key.startswith"
                                                                        }
                                                                    ],
                                                                    "content": "\nif not"
                                                                }
                                                            ],
                                                            "content": "\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:"
                                                        }
                                                    ],
                                                    "content": ":\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:\nif not"
                                                }
                                            ],
                                            "content": "(plain_text_key:str)->Optional[APIKey]:\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:\nif not"
                                        },
                                        {
                                            "type": "VariableDeclaration",
                                            "name": "prefix = plain_text_key[:APIKeyManager.PREFIX_LENGTH]",
                                            "range": [
                                                816,
                                                825
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "prefix",
                                                    "range": [
                                                        816,
                                                        822
                                                    ],
                                                    "children": [],
                                                    "content": ".startswith(APIKeyManager.PREFIX)"
                                                },
                                                {
                                                    "type": "AssignmentExpression",
                                                    "name": "=",
                                                    "range": [
                                                        817,
                                                        818
                                                    ],
                                                    "children": [],
                                                    "content": "startswith("
                                                },
                                                {
                                                    "type": "MemberExpression",
                                                    "name": "plain_text_key[:APIKeyManager.PREFIX_LENGTH]",
                                                    "range": [
                                                        818,
                                                        824
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "plain_text_key",
                                                            "range": [
                                                                818,
                                                                831
                                                            ],
                                                            "children": [],
                                                            "content": "(APIKeyManager.PREFIX):\nlogger.warning(\"Invalid API key format\")\n"
                                                        },
                                                        {
                                                            "type": "SliceExpression",
                                                            "name": "[:APIKeyManager.PREFIX_LENGTH]",
                                                            "range": [
                                                                819,
                                                                824
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "APIKeyManager.PREFIX_LENGTH",
                                                                    "range": [
                                                                        821,
                                                                        823
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "APIKeyManager",
                                                                            "range": [
                                                                                821,
                                                                                834
                                                                            ],
                                                                            "children": [],
                                                                            "content": "PREFIX):\nlogger.warning(\"Invalid API key format\")\nreturn None\n"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "PREFIX_LENGTH",
                                                                            "range": [
                                                                                823,
                                                                                836
                                                                            ],
                                                                            "children": [],
                                                                            "content": ":\nlogger.warning(\"Invalid API key format\")\nreturn None\n\nprefix"
                                                                        }
                                                                    ],
                                                                    "content": "PREFIX):"
                                                                }
                                                            ],
                                                            "content": "APIKeyManager.PREFIX):\n"
                                                        }
                                                    ],
                                                    "content": "(APIKeyManager.PREFIX):\n"
                                                }
                                            ],
                                            "content": ".startswith(APIKeyManager.PREFIX):\nlogger"
                                        },
                                        {
                                            "type": "VariableDeclaration",
                                            "name": "api_manager = APIKeyManager()",
                                            "range": [
                                                826,
                                                831
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "api_manager",
                                                    "range": [
                                                        826,
                                                        837
                                                    ],
                                                    "children": [],
                                                    "content": ".warning(\"Invalid API key format\")\nreturn None\n\nprefix="
                                                },
                                                {
                                                    "type": "AssignmentExpression",
                                                    "name": "=",
                                                    "range": [
                                                        827,
                                                        828
                                                    ],
                                                    "children": [],
                                                    "content": "warning("
                                                },
                                                {
                                                    "type": "NewExpression",
                                                    "name": "APIKeyManager()",
                                                    "range": [
                                                        828,
                                                        830
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "APIKeyManager",
                                                            "range": [
                                                                828,
                                                                841
                                                            ],
                                                            "children": [],
                                                            "content": "(\"Invalid API key format\")\nreturn None\n\nprefix=plain_text_key[:APIKeyManager"
                                                        }
                                                    ],
                                                    "content": "(\"Invalid API key format\")"
                                                }
                                            ],
                                            "content": ".warning(\"Invalid API key format\")\n"
                                        },
                                        {
                                            "type": "VariableDeclaration",
                                            "name": "api_key = await PrismaAPIKey.prisma().find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))",
                                            "range": [
                                                833,
                                                862
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "api_key",
                                                    "range": [
                                                        833,
                                                        840
                                                    ],
                                                    "children": [],
                                                    "content": "None\n\nprefix=plain_text_key[:"
                                                },
                                                {
                                                    "type": "AssignmentExpression",
                                                    "name": "=",
                                                    "range": [
                                                        834,
                                                        835
                                                    ],
                                                    "children": [],
                                                    "content": "\n\n"
                                                },
                                                {
                                                    "type": "AwaitExpression",
                                                    "name": "await PrismaAPIKey.prisma().find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))",
                                                    "range": [
                                                        835,
                                                        862
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "PrismaAPIKey.prisma()",
                                                            "range": [
                                                                836,
                                                                839
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "PrismaAPIKey.prisma",
                                                                    "range": [
                                                                        836,
                                                                        838
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "PrismaAPIKey",
                                                                            "range": [
                                                                                836,
                                                                                849
                                                                            ],
                                                                            "children": [],
                                                                            "content": "prefix=plain_text_key[:APIKeyManager.PREFIX_LENGTH]\napi_manager=APIKeyManager("
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "prisma",
                                                                            "range": [
                                                                                838,
                                                                                844
                                                                            ],
                                                                            "children": [],
                                                                            "content": "plain_text_key[:APIKeyManager.PREFIX_LENGTH]"
                                                                        }
                                                                    ],
                                                                    "content": "prefix=plain_text_key"
                                                                }
                                                            ],
                                                            "content": "prefix=plain_text_key["
                                                        },
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "find_first(where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE)))",
                                                            "range": [
                                                                842,
                                                                862
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "find_first",
                                                                    "range": [
                                                                        842,
                                                                        851
                                                                    ],
                                                                    "children": [],
                                                                    "content": ".PREFIX_LENGTH]\napi_manager=APIKeyManager()\n"
                                                                },
                                                                {
                                                                    "type": "Argument",
                                                                    "name": "where=APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE))",
                                                                    "range": [
                                                                        845,
                                                                        861
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "where",
                                                                            "range": [
                                                                                845,
                                                                                850
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\napi_manager=APIKeyManager()"
                                                                        },
                                                                        {
                                                                            "type": "AssignmentExpression",
                                                                            "name": "=",
                                                                            "range": [
                                                                                846,
                                                                                847
                                                                            ],
                                                                            "children": [],
                                                                            "content": "api_manager="
                                                                        },
                                                                        {
                                                                            "type": "NewExpression",
                                                                            "name": "APIKeyWhereInput(prefix=prefix, status=(APIKeyStatus.ACTIVE))",
                                                                            "range": [
                                                                                847,
                                                                                861
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "APIKeyWhereInput",
                                                                                    "range": [
                                                                                        847,
                                                                                        862
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma().find_first"
                                                                                },
                                                                                {
                                                                                    "type": "Argument",
                                                                                    "name": "prefix=prefix",
                                                                                    "range": [
                                                                                        849,
                                                                                        851
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "prefix",
                                                                                            "range": [
                                                                                                849,
                                                                                                854
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "()\n\napi_key="
                                                                                        },
                                                                                        {
                                                                                            "type": "AssignmentExpression",
                                                                                            "name": "=",
                                                                                            "range": [
                                                                                                850,
                                                                                                851
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": ")\n"
                                                                                        },
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "prefix",
                                                                                            "range": [
                                                                                                851,
                                                                                                856
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "\n\napi_key=await PrismaAPIKey"
                                                                                        }
                                                                                    ],
                                                                                    "content": "()\n"
                                                                                },
                                                                                {
                                                                                    "type": "Argument",
                                                                                    "name": "status=(APIKeyStatus.ACTIVE)",
                                                                                    "range": [
                                                                                        853,
                                                                                        860
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "status",
                                                                                            "range": [
                                                                                                853,
                                                                                                859
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "api_key=await PrismaAPIKey.prisma("
                                                                                        },
                                                                                        {
                                                                                            "type": "AssignmentExpression",
                                                                                            "name": "=",
                                                                                            "range": [
                                                                                                854,
                                                                                                855
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "=await"
                                                                                        },
                                                                                        {
                                                                                            "type": "ParenthesizedExpression",
                                                                                            "name": "(APIKeyStatus.ACTIVE)",
                                                                                            "range": [
                                                                                                855,
                                                                                                860
                                                                                            ],
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "MemberExpression",
                                                                                                    "name": "APIKeyStatus.ACTIVE",
                                                                                                    "range": [
                                                                                                        856,
                                                                                                        859
                                                                                                    ],
                                                                                                    "children": [
                                                                                                        {
                                                                                                            "type": "Identifier",
                                                                                                            "name": "APIKeyStatus",
                                                                                                            "range": [
                                                                                                                856,
                                                                                                                869
                                                                                                            ],
                                                                                                            "children": [],
                                                                                                            "content": "PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput(prefix"
                                                                                                        },
                                                                                                        {
                                                                                                            "type": "Identifier",
                                                                                                            "name": "ACTIVE",
                                                                                                            "range": [
                                                                                                                858,
                                                                                                                863
                                                                                                            ],
                                                                                                            "children": [],
                                                                                                            "content": "prisma().find_first("
                                                                                                        }
                                                                                                    ],
                                                                                                    "content": "PrismaAPIKey.prisma("
                                                                                                }
                                                                                            ],
                                                                                            "content": "await PrismaAPIKey.prisma()"
                                                                                        }
                                                                                    ],
                                                                                    "content": "api_key=await PrismaAPIKey.prisma()"
                                                                                }
                                                                            ],
                                                                            "content": "=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma()."
                                                                        }
                                                                    ],
                                                                    "content": "\napi_manager=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma()."
                                                                }
                                                            ],
                                                            "content": ".PREFIX_LENGTH]\napi_manager=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma().find_first"
                                                        }
                                                    ],
                                                    "content": "\nprefix=plain_text_key[:APIKeyManager.PREFIX_LENGTH]\napi_manager=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma().find_first"
                                                }
                                            ],
                                            "content": "None\n\nprefix=plain_text_key[:APIKeyManager.PREFIX_LENGTH]\napi_manager=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma().find_first"
                                        },
                                        {
                                            "type": "IfStatement",
                                            "name": "if",
                                            "range": [
                                                865,
                                                880
                                            ],
                                            "children": [
                                                {
                                                    "type": "Condition",
                                                    "name": "not api_key",
                                                    "range": [
                                                        866,
                                                        868
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "UnaryExpression",
                                                            "name": "not",
                                                            "range": [
                                                                866,
                                                                869
                                                            ],
                                                            "children": [],
                                                            "content": "=APIKeyWhereInput(prefix"
                                                        },
                                                        {
                                                            "type": "Identifier",
                                                            "name": "api_key",
                                                            "range": [
                                                                867,
                                                                874
                                                            ],
                                                            "children": [],
                                                            "content": "APIKeyWhereInput(prefix=prefix,status="
                                                        }
                                                    ],
                                                    "content": "=APIKeyWhereInput("
                                                },
                                                {
                                                    "type": "Block",
                                                    "name": "if",
                                                    "range": [
                                                        869,
                                                        880
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "ExpressionStatement",
                                                            "name": "logger.warning(f\"No active API key found with prefix {prefix}\")",
                                                            "range": [
                                                                870,
                                                                877
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "logger.warning",
                                                                    "range": [
                                                                        870,
                                                                        876
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "logger",
                                                                            "range": [
                                                                                870,
                                                                                876
                                                                            ],
                                                                            "children": [],
                                                                            "content": "=prefix,status=(APIKeyStatus"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "warning",
                                                                            "range": [
                                                                                872,
                                                                                879
                                                                            ],
                                                                            "children": [],
                                                                            "content": ",status=(APIKeyStatus.ACTIVE)"
                                                                        }
                                                                    ],
                                                                    "content": "=prefix,status=(APIKeyStatus"
                                                                },
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "warning(f\"No active API key found with prefix {prefix}\")",
                                                                    "range": [
                                                                        873,
                                                                        876
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "TemplateLiteral",
                                                                            "name": "f\"No active API key found with prefix {prefix}\"",
                                                                            "range": [
                                                                                874,
                                                                                876
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "prefix",
                                                                                    "range": [
                                                                                        875,
                                                                                        880
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "(APIKeyStatus.ACTIVE))"
                                                                                }
                                                                            ],
                                                                            "content": "=(APIKeyStatus"
                                                                        }
                                                                    ],
                                                                    "content": "status=(APIKeyStatus"
                                                                },
                                                                {
                                                                    "type": "ReturnStatement",
                                                                    "name": "return None",
                                                                    "range": [
                                                                        878,
                                                                        880
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Keyword",
                                                                            "name": "return",
                                                                            "range": [
                                                                                878,
                                                                                884
                                                                            ],
                                                                            "children": [],
                                                                            "content": "ACTIVE))\n)\n\n"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "None",
                                                                            "range": [
                                                                                879,
                                                                                883
                                                                            ],
                                                                            "children": [],
                                                                            "content": "))\n)\n"
                                                                        }
                                                                    ],
                                                                    "content": "ACTIVE))"
                                                                }
                                                            ],
                                                            "content": "=prefix,status=(APIKeyStatus."
                                                        }
                                                    ],
                                                    "content": "prefix=prefix,status=(APIKeyStatus.ACTIVE))"
                                                }
                                            ],
                                            "content": "where=APIKeyWhereInput(prefix=prefix,status=(APIKeyStatus.ACTIVE))"
                                        },
                                        {
                                            "type": "VariableDeclaration",
                                            "name": "is_valid = api_manager.verify_api_key(plain_text_key, api_key.key)",
                                            "range": [
                                                882,
                                                894
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "is_valid",
                                                    "range": [
                                                        882,
                                                        890
                                                    ],
                                                    "children": [],
                                                    "content": ")\n\nif not api_key:\nlogger"
                                                },
                                                {
                                                    "type": "AssignmentExpression",
                                                    "name": "=",
                                                    "range": [
                                                        883,
                                                        884
                                                    ],
                                                    "children": [],
                                                    "content": "\n\n"
                                                },
                                                {
                                                    "type": "CallExpression",
                                                    "name": "api_manager.verify_api_key(plain_text_key, api_key.key)",
                                                    "range": [
                                                        884,
                                                        894
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "MemberExpression",
                                                            "name": "api_manager.verify_api_key",
                                                            "range": [
                                                                884,
                                                                893
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "api_manager",
                                                                    "range": [
                                                                        884,
                                                                        895
                                                                    ],
                                                                    "children": [],
                                                                    "content": "\nif not api_key:\nlogger.warning(f \"No active API key found with prefix {prefix}\""
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "verify_api_key",
                                                                    "range": [
                                                                        886,
                                                                        899
                                                                    ],
                                                                    "children": [],
                                                                    "content": "not api_key:\nlogger.warning(f \"No active API key found with prefix {prefix}\")\nreturn None"
                                                                }
                                                            ],
                                                            "content": "\nif not api_key:\nlogger.warning("
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "plain_text_key",
                                                            "range": [
                                                                888,
                                                                889
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "plain_text_key",
                                                                    "range": [
                                                                        888,
                                                                        901
                                                                    ],
                                                                    "children": [],
                                                                    "content": ":\nlogger.warning(f \"No active API key found with prefix {prefix}\")\nreturn None\n\n"
                                                                }
                                                            ],
                                                            "content": ":\n"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "api_key.key",
                                                            "range": [
                                                                890,
                                                                893
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "api_key.key",
                                                                    "range": [
                                                                        890,
                                                                        893
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "api_key",
                                                                            "range": [
                                                                                890,
                                                                                897
                                                                            ],
                                                                            "children": [],
                                                                            "content": "logger.warning(f \"No active API key found with prefix {prefix}\")\n"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "key",
                                                                            "range": [
                                                                                892,
                                                                                895
                                                                            ],
                                                                            "children": [],
                                                                            "content": "warning(f \"No active API key found with prefix {prefix}\""
                                                                        }
                                                                    ],
                                                                    "content": "logger.warning("
                                                                }
                                                            ],
                                                            "content": "logger.warning("
                                                        }
                                                    ],
                                                    "content": "\nif not api_key:\nlogger.warning(f"
                                                }
                                            ],
                                            "content": ")\n\nif not api_key:\nlogger.warning(f"
                                        },
                                        {
                                            "type": "IfStatement",
                                            "name": "if",
                                            "range": [
                                                895,
                                                909
                                            ],
                                            "children": [
                                                {
                                                    "type": "Condition",
                                                    "name": "not is_valid",
                                                    "range": [
                                                        896,
                                                        898
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "UnaryExpression",
                                                            "name": "not",
                                                            "range": [
                                                                896,
                                                                899
                                                            ],
                                                            "children": [],
                                                            "content": ")\nreturn None"
                                                        },
                                                        {
                                                            "type": "Identifier",
                                                            "name": "is_valid",
                                                            "range": [
                                                                897,
                                                                905
                                                            ],
                                                            "children": [],
                                                            "content": "\nreturn None\n\nis_valid=api_manager."
                                                        }
                                                    ],
                                                    "content": ")\nreturn"
                                                },
                                                {
                                                    "type": "Block",
                                                    "name": "if",
                                                    "range": [
                                                        899,
                                                        909
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "ExpressionStatement",
                                                            "name": "logger.warning(\"API key verification failed\")",
                                                            "range": [
                                                                900,
                                                                906
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "logger.warning",
                                                                    "range": [
                                                                        900,
                                                                        905
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "logger",
                                                                            "range": [
                                                                                900,
                                                                                906
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\n\nis_valid=api_manager.verify_api_key"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "warning",
                                                                            "range": [
                                                                                902,
                                                                                908
                                                                            ],
                                                                            "children": [],
                                                                            "content": "is_valid=api_manager.verify_api_key(plain_text_key"
                                                                        }
                                                                    ],
                                                                    "content": "\n\nis_valid=api_manager."
                                                                },
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "warning(\"API key verification failed\")",
                                                                    "range": [
                                                                        903,
                                                                        905
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "StringLiteral",
                                                                            "name": "\"API key verification failed\"",
                                                                            "range": [
                                                                                904,
                                                                                905
                                                                            ],
                                                                            "children": [],
                                                                            "content": "api_manager."
                                                                        }
                                                                    ],
                                                                    "content": "=api_manager."
                                                                },
                                                                {
                                                                    "type": "ReturnStatement",
                                                                    "name": "return None",
                                                                    "range": [
                                                                        907,
                                                                        909
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Keyword",
                                                                            "name": "return",
                                                                            "range": [
                                                                                907,
                                                                                913
                                                                            ],
                                                                            "children": [],
                                                                            "content": "(plain_text_key,api_key.key)"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "None",
                                                                            "range": [
                                                                                908,
                                                                                912
                                                                            ],
                                                                            "children": [],
                                                                            "content": "plain_text_key,api_key.key"
                                                                        }
                                                                    ],
                                                                    "content": "(plain_text_key,"
                                                                }
                                                            ],
                                                            "content": "\n\nis_valid=api_manager.verify_api_key"
                                                        }
                                                    ],
                                                    "content": "None\n\nis_valid=api_manager.verify_api_key(plain_text_key,"
                                                }
                                            ],
                                            "content": "\"No active API key found with prefix {prefix}\")\nreturn None\n\nis_valid=api_manager.verify_api_key(plain_text_key,"
                                        },
                                        {
                                            "type": "ReturnStatement",
                                            "name": "return APIKey.from_db(api_key)",
                                            "range": [
                                                911,
                                                918
                                            ],
                                            "children": [
                                                {
                                                    "type": "Keyword",
                                                    "name": "return",
                                                    "range": [
                                                        911,
                                                        917
                                                    ],
                                                    "children": [],
                                                    "content": ".key)\nif not is_valid"
                                                },
                                                {
                                                    "type": "CallExpression",
                                                    "name": "APIKey.from_db(api_key)",
                                                    "range": [
                                                        912,
                                                        918
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "MemberExpression",
                                                            "name": "APIKey.from_db",
                                                            "range": [
                                                                912,
                                                                917
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "APIKey",
                                                                    "range": [
                                                                        912,
                                                                        917
                                                                    ],
                                                                    "children": [],
                                                                    "content": "key)\nif not is_valid"
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "from_db",
                                                                    "range": [
                                                                        914,
                                                                        921
                                                                    ],
                                                                    "children": [],
                                                                    "content": "\nif not is_valid:\nlogger."
                                                                }
                                                            ],
                                                            "content": "key)\nif not is_valid"
                                                        },
                                                        {
                                                            "type": "Argument",
                                                            "name": "api_key",
                                                            "range": [
                                                                916,
                                                                917
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "api_key",
                                                                    "range": [
                                                                        916,
                                                                        923
                                                                    ],
                                                                    "children": [],
                                                                    "content": "not is_valid:\nlogger.warning("
                                                                }
                                                            ],
                                                            "content": "not is_valid"
                                                        }
                                                    ],
                                                    "content": "key)\nif not is_valid:"
                                                }
                                            ],
                                            "content": ".key)\nif not is_valid:"
                                        }
                                    ],
                                    "content": "async def validate_api_key(plain_text_key:str)->Optional[APIKey]:\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:\nif not plain_text_key.startswith(APIKeyManager.PREFIX):\nlogger.warning(\"Invalid API key format\")\nreturn None\n\nprefix=plain_text_key[:APIKeyManager.PREFIX_LENGTH]\napi_manager=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput(prefix=prefix,status=(APIKeyStatus.ACTIVE))\n)\n\nif not api_key:\nlogger.warning(f \"No active API key found with prefix {prefix}\")\nreturn None\n\nis_valid=api_manager.verify_api_key(plain_text_key,api_key.key)\nif not is_valid:\n"
                                },
                                {
                                    "type": "CatchClause",
                                    "name": "except",
                                    "range": [
                                        919,
                                        939
                                    ],
                                    "children": [
                                        {
                                            "type": "Parameter",
                                            "name": "Exception as e",
                                            "range": [
                                                920,
                                                923
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "Exception",
                                                    "range": [
                                                        920,
                                                        929
                                                    ],
                                                    "children": [],
                                                    "content": "logger.warning(\"API key verification failed\")\nreturn None\n"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "e",
                                                    "range": [
                                                        922,
                                                        923
                                                    ],
                                                    "children": [],
                                                    "content": "warning("
                                                }
                                            ],
                                            "content": "logger.warning("
                                        },
                                        {
                                            "type": "Block",
                                            "name": "except",
                                            "range": [
                                                924,
                                                939
                                            ],
                                            "children": [
                                                {
                                                    "type": "ExpressionStatement",
                                                    "name": "logger.error(f\"Error validating API key: {str(e)}\")",
                                                    "range": [
                                                        925,
                                                        932
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "MemberExpression",
                                                            "name": "logger.error",
                                                            "range": [
                                                                925,
                                                                931
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "logger",
                                                                    "range": [
                                                                        925,
                                                                        931
                                                                    ],
                                                                    "children": [],
                                                                    "content": ")\nreturn None\n\nreturn"
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "error",
                                                                    "range": [
                                                                        927,
                                                                        933
                                                                    ],
                                                                    "children": [],
                                                                    "content": "return None\n\nreturn APIKey."
                                                                }
                                                            ],
                                                            "content": ")\nreturn None\n\nreturn"
                                                        },
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "error(f\"Error validating API key: {str(e)}\")",
                                                            "range": [
                                                                928,
                                                                931
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "TemplateLiteral",
                                                                    "name": "f\"Error validating API key: {str(e)}\"",
                                                                    "range": [
                                                                        929,
                                                                        931
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "CallExpression",
                                                                            "name": "str(e)",
                                                                            "range": [
                                                                                930,
                                                                                931
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "str",
                                                                                    "range": [
                                                                                        930,
                                                                                        933
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "\nreturn APIKey."
                                                                                },
                                                                                {
                                                                                    "type": "Argument",
                                                                                    "name": "e",
                                                                                    "range": [
                                                                                        931,
                                                                                        932
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "e",
                                                                                            "range": [
                                                                                                931,
                                                                                                932
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "return APIKey"
                                                                                        }
                                                                                    ],
                                                                                    "content": "return APIKey"
                                                                                }
                                                                            ],
                                                                            "content": "\nreturn"
                                                                        }
                                                                    ],
                                                                    "content": "\n\nreturn"
                                                                }
                                                            ],
                                                            "content": "None\n\nreturn"
                                                        }
                                                    ],
                                                    "content": ")\nreturn None\n\nreturn APIKey"
                                                },
                                                {
                                                    "type": "ThrowStatement",
                                                    "name": "raise APIKeyValidationError(f\"Failed to validate API key: {str(e)}\")",
                                                    "range": [
                                                        933,
                                                        939
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Keyword",
                                                            "name": "raise",
                                                            "range": [
                                                                933,
                                                                938
                                                            ],
                                                            "children": [],
                                                            "content": ".from_db(api_key)\n"
                                                        },
                                                        {
                                                            "type": "NewExpression",
                                                            "name": "APIKeyValidationError(f\"Failed to validate API key: {str(e)}\")",
                                                            "range": [
                                                                934,
                                                                939
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "APIKeyValidationError",
                                                                    "range": [
                                                                        934,
                                                                        955
                                                                    ],
                                                                    "children": [],
                                                                    "content": "from_db(api_key)\nexcept Exception as e:\nlogger.error(f \"Error validating API key: {str(e)}\")\nraise APIKeyValidationError("
                                                                },
                                                                {
                                                                    "type": "Argument",
                                                                    "name": "f\"Failed to validate API key: {str(e)}\"",
                                                                    "range": [
                                                                        936,
                                                                        938
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "TemplateLiteral",
                                                                            "name": "f\"Failed to validate API key: {str(e)}\"",
                                                                            "range": [
                                                                                937,
                                                                                938
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "CallExpression",
                                                                                    "name": "str(e)",
                                                                                    "range": [
                                                                                        938,
                                                                                        939
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Identifier",
                                                                                            "name": "str",
                                                                                            "range": [
                                                                                                938,
                                                                                                941
                                                                                            ],
                                                                                            "children": [],
                                                                                            "content": "\nexcept Exception as"
                                                                                        },
                                                                                        {
                                                                                            "type": "Argument",
                                                                                            "name": "e",
                                                                                            "range": [
                                                                                                939,
                                                                                                940
                                                                                            ],
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "Identifier",
                                                                                                    "name": "e",
                                                                                                    "range": [
                                                                                                        939,
                                                                                                        940
                                                                                                    ],
                                                                                                    "children": [],
                                                                                                    "content": "except Exception"
                                                                                                }
                                                                                            ],
                                                                                            "content": "except Exception"
                                                                                        }
                                                                                    ],
                                                                                    "content": "\nexcept"
                                                                                }
                                                                            ],
                                                                            "content": ")\n"
                                                                        }
                                                                    ],
                                                                    "content": "api_key)\n"
                                                                }
                                                            ],
                                                            "content": "from_db(api_key)\nexcept"
                                                        }
                                                    ],
                                                    "content": ".from_db(api_key)\nexcept"
                                                }
                                            ],
                                            "content": "\"API key verification failed\")\nreturn None\n\nreturn APIKey.from_db(api_key)\nexcept"
                                        }
                                    ],
                                    "content": "\nlogger.warning(\"API key verification failed\")\nreturn None\n\nreturn APIKey.from_db(api_key)\nexcept"
                                }
                            ],
                            "content": "async def validate_api_key(plain_text_key:str)->Optional[APIKey]:\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:\nif not plain_text_key.startswith(APIKeyManager.PREFIX):\nlogger.warning(\"Invalid API key format\")\nreturn None\n\nprefix=plain_text_key[:APIKeyManager.PREFIX_LENGTH]\napi_manager=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput(prefix=prefix,status=(APIKeyStatus.ACTIVE))\n)\n\nif not api_key:\nlogger.warning(f \"No active API key found with prefix {prefix}\")\nreturn None\n\nis_valid=api_manager.verify_api_key(plain_text_key,api_key.key)\nif not is_valid:\nlogger.warning(\"API key verification failed\")\nreturn None\n\nreturn APIKey.from_db(api_key)\nexcept"
                        }
                    ],
                    "content": "\"Failed to generate API key: {str(e)}\")\n\n\nasync def validate_api_key(plain_text_key:str)->Optional[APIKey]:\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:\nif not plain_text_key.startswith(APIKeyManager.PREFIX):\nlogger.warning(\"Invalid API key format\")\nreturn None\n\nprefix=plain_text_key[:APIKeyManager.PREFIX_LENGTH]\napi_manager=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput(prefix=prefix,status=(APIKeyStatus.ACTIVE))\n)\n\nif not api_key:\nlogger.warning(f \"No active API key found with prefix {prefix}\")\nreturn None\n\nis_valid=api_manager.verify_api_key(plain_text_key,api_key.key)\nif not is_valid:\nlogger.warning(\"API key verification failed\")\nreturn None\n\nreturn APIKey.from_db(api_key)\nexcept"
                }
            ],
            "content": "e:\nlogger.error(f \"Unexpected error while generating API key: {str(e)}\")\nraise APIKeyError(f \"Failed to generate API key: {str(e)}\")\n\n\nasync def validate_api_key(plain_text_key:str)->Optional[APIKey]:\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:\nif not plain_text_key.startswith(APIKeyManager.PREFIX):\nlogger.warning(\"Invalid API key format\")\nreturn None\n\nprefix=plain_text_key[:APIKeyManager.PREFIX_LENGTH]\napi_manager=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput(prefix=prefix,status=(APIKeyStatus.ACTIVE))\n)\n\nif not api_key:\nlogger.warning(f \"No active API key found with prefix {prefix}\")\nreturn None\n\nis_valid=api_manager.verify_api_key(plain_text_key,api_key.key)\nif not is_valid:\nlogger.warning(\"API key verification failed\")\nreturn None\n\nreturn APIKey.from_db(api_key)\nexcept"
        },
        {
            "type": "FunctionDecl",
            "name": "revoke_api_key",
            "range": [
                940,
                1139
            ],
            "children": [
                {
                    "type": "FunctionSignature",
                    "name": "revoke_api_key",
                    "range": [
                        940,
                        958
                    ],
                    "children": [
                        {
                            "type": "Keyword",
                            "name": "async",
                            "range": [
                                940,
                                944
                            ],
                            "children": [],
                            "content": "Exception as e:\n"
                        },
                        {
                            "type": "Keyword",
                            "name": "def",
                            "range": [
                                941,
                                944
                            ],
                            "children": [],
                            "content": "as e:\n"
                        },
                        {
                            "type": "Identifier",
                            "name": "revoke_api_key",
                            "range": [
                                942,
                                955
                            ],
                            "children": [],
                            "content": "e:\nlogger.error(f \"Error validating API key: {str(e)}\")\nraise APIKeyValidationError("
                        },
                        {
                            "type": "ParameterList",
                            "name": "parameters",
                            "range": [
                                943,
                                951
                            ],
                            "children": [
                                {
                                    "type": "Parameter",
                                    "name": "key_id",
                                    "range": [
                                        944,
                                        947
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "key_id",
                                            "range": [
                                                944,
                                                947
                                            ],
                                            "children": [],
                                            "content": "\nlogger.error"
                                        },
                                        {
                                            "type": "TypeAnnotation",
                                            "name": "str",
                                            "range": [
                                                945,
                                                947
                                            ],
                                            "children": [],
                                            "content": "logger.error"
                                        }
                                    ],
                                    "content": "\nlogger.error"
                                },
                                {
                                    "type": "Parameter",
                                    "name": "user_id",
                                    "range": [
                                        948,
                                        951
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "user_id",
                                            "range": [
                                                948,
                                                951
                                            ],
                                            "children": [],
                                            "content": "(f \"Error validating API key: {str(e)}\")"
                                        },
                                        {
                                            "type": "TypeAnnotation",
                                            "name": "str",
                                            "range": [
                                                949,
                                                951
                                            ],
                                            "children": [],
                                            "content": "f \"Error validating API key: {str(e)}\")"
                                        }
                                    ],
                                    "content": "(f \"Error validating API key: {str(e)}\")"
                                }
                            ],
                            "content": ":\nlogger.error(f \"Error validating API key: {str(e)}\")"
                        },
                        {
                            "type": "ReturnType",
                            "name": "Optional[APIKeyWithoutHash]",
                            "range": [
                                952,
                                958
                            ],
                            "children": [
                                {
                                    "type": "Keyword",
                                    "name": "->",
                                    "range": [
                                        952,
                                        954
                                    ],
                                    "children": [],
                                    "content": "\nraise APIKeyValidationError"
                                },
                                {
                                    "type": "Type",
                                    "name": "Optional",
                                    "range": [
                                        954,
                                        958
                                    ],
                                    "children": [],
                                    "content": "APIKeyValidationError(f \"Failed to validate API key: {str(e)}\")"
                                },
                                {
                                    "type": "Type",
                                    "name": "APIKeyWithoutHash",
                                    "range": [
                                        955,
                                        958
                                    ],
                                    "children": [],
                                    "content": "(f \"Failed to validate API key: {str(e)}\")"
                                }
                            ],
                            "content": "\nraise APIKeyValidationError(f \"Failed to validate API key: {str(e)}\")"
                        }
                    ],
                    "content": "Exception as e:\nlogger.error(f \"Error validating API key: {str(e)}\")\nraise APIKeyValidationError(f \"Failed to validate API key: {str(e)}\")"
                },
                {
                    "type": "FunctionBody",
                    "name": "body",
                    "range": [
                        959,
                        1139
                    ],
                    "children": [
                        {
                            "type": "TryStatement",
                            "name": "try",
                            "range": [
                                960,
                                1139
                            ],
                            "children": [
                                {
                                    "type": "Block",
                                    "name": "tryBlock",
                                    "range": [
                                        962,
                                        1084
                                    ],
                                    "children": [
                                        {
                                            "type": "VariableDecl",
                                            "name": "api_key",
                                            "range": [
                                                963,
                                                981
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "api_key",
                                                    "range": [
                                                        963,
                                                        970
                                                    ],
                                                    "children": [],
                                                    "content": "def revoke_api_key(key_id:str,user_id"
                                                },
                                                {
                                                    "type": "Assignment",
                                                    "name": "=",
                                                    "range": [
                                                        964,
                                                        965
                                                    ],
                                                    "children": [],
                                                    "content": "revoke_api_key("
                                                },
                                                {
                                                    "type": "AwaitExpression",
                                                    "name": "await",
                                                    "range": [
                                                        965,
                                                        981
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "PrismaAPIKey.prisma().find_unique",
                                                            "range": [
                                                                966,
                                                                981
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "PrismaAPIKey.prisma",
                                                                    "range": [
                                                                        966,
                                                                        973
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "PrismaAPIKey",
                                                                            "range": [
                                                                                966,
                                                                                973
                                                                            ],
                                                                            "children": [],
                                                                            "content": "key_id:str,user_id:str)"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "prisma",
                                                                            "range": [
                                                                                967,
                                                                                973
                                                                            ],
                                                                            "children": [],
                                                                            "content": ":str,user_id:str)"
                                                                        }
                                                                    ],
                                                                    "content": "key_id:str,user_id:str)"
                                                                },
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "find_unique",
                                                                    "range": [
                                                                        972,
                                                                        981
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "find_unique",
                                                                            "range": [
                                                                                972,
                                                                                981
                                                                            ],
                                                                            "children": [],
                                                                            "content": "str)->Optional[APIKeyWithoutHash]:\n"
                                                                        },
                                                                        {
                                                                            "type": "ArgumentList",
                                                                            "name": "arguments",
                                                                            "range": [
                                                                                973,
                                                                                981
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "ObjectExpression",
                                                                                    "name": "where",
                                                                                    "range": [
                                                                                        974,
                                                                                        980
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Property",
                                                                                            "name": "id",
                                                                                            "range": [
                                                                                                977,
                                                                                                980
                                                                                            ],
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "Literal",
                                                                                                    "name": "\"id\"",
                                                                                                    "range": [
                                                                                                        977,
                                                                                                        980
                                                                                                    ],
                                                                                                    "children": [],
                                                                                                    "content": "[APIKeyWithoutHash]:"
                                                                                                },
                                                                                                {
                                                                                                    "type": "Identifier",
                                                                                                    "name": "key_id",
                                                                                                    "range": [
                                                                                                        978,
                                                                                                        980
                                                                                                    ],
                                                                                                    "children": [],
                                                                                                    "content": "APIKeyWithoutHash]:"
                                                                                                }
                                                                                            ],
                                                                                            "content": "[APIKeyWithoutHash]:"
                                                                                        }
                                                                                    ],
                                                                                    "content": "->Optional[APIKeyWithoutHash]:"
                                                                                }
                                                                            ],
                                                                            "content": ")->Optional[APIKeyWithoutHash]:\n"
                                                                        }
                                                                    ],
                                                                    "content": "str)->Optional[APIKeyWithoutHash]:\n"
                                                                }
                                                            ],
                                                            "content": "key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\n"
                                                        }
                                                    ],
                                                    "content": "(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\n"
                                                }
                                            ],
                                            "content": "def revoke_api_key(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\n"
                                        },
                                        {
                                            "type": "IfStatement",
                                            "name": "if",
                                            "range": [
                                                984,
                                                995
                                            ],
                                            "children": [
                                                {
                                                    "type": "Condition",
                                                    "name": "not api_key",
                                                    "range": [
                                                        985,
                                                        987
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "UnaryExpression",
                                                            "name": "not",
                                                            "range": [
                                                                985,
                                                                987
                                                            ],
                                                            "children": [],
                                                            "content": "api_key=await"
                                                        },
                                                        {
                                                            "type": "Identifier",
                                                            "name": "api_key",
                                                            "range": [
                                                                986,
                                                                987
                                                            ],
                                                            "children": [],
                                                            "content": "=await"
                                                        }
                                                    ],
                                                    "content": "api_key=await"
                                                },
                                                {
                                                    "type": "Block",
                                                    "name": "consequent",
                                                    "range": [
                                                        988,
                                                        995
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "ThrowStatement",
                                                            "name": "raise",
                                                            "range": [
                                                                989,
                                                                995
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "NewExpression",
                                                                    "name": "APIKeyNotFoundError",
                                                                    "range": [
                                                                        990,
                                                                        995
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "APIKeyNotFoundError",
                                                                            "range": [
                                                                                990,
                                                                                995
                                                                            ],
                                                                            "children": [],
                                                                            "content": "prisma().find_unique("
                                                                        },
                                                                        {
                                                                            "type": "ArgumentList",
                                                                            "name": "arguments",
                                                                            "range": [
                                                                                991,
                                                                                995
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "TemplateLiteral",
                                                                                    "name": "f\"API key with id {key_id} not found\"",
                                                                                    "range": [
                                                                                        992,
                                                                                        995
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": ").find_unique("
                                                                                }
                                                                            ],
                                                                            "content": "().find_unique("
                                                                        }
                                                                    ],
                                                                    "content": "prisma().find_unique("
                                                                }
                                                            ],
                                                            "content": ".prisma().find_unique("
                                                        }
                                                    ],
                                                    "content": "PrismaAPIKey.prisma().find_unique("
                                                }
                                            ],
                                            "content": "\napi_key=await PrismaAPIKey.prisma().find_unique("
                                        },
                                        {
                                            "type": "IfStatement",
                                            "name": "if",
                                            "range": [
                                                997,
                                                1012
                                            ],
                                            "children": [
                                                {
                                                    "type": "Condition",
                                                    "name": "api_key.userId != user_id",
                                                    "range": [
                                                        998,
                                                        1004
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "MemberExpression",
                                                            "name": "api_key.userId",
                                                            "range": [
                                                                998,
                                                                1001
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "api_key",
                                                                    "range": [
                                                                        998,
                                                                        1001
                                                                    ],
                                                                    "children": [],
                                                                    "content": "{\"id\":key_id"
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "userId",
                                                                    "range": [
                                                                        999,
                                                                        1001
                                                                    ],
                                                                    "children": [],
                                                                    "content": "\"id\":key_id"
                                                                }
                                                            ],
                                                            "content": "{\"id\":key_id"
                                                        },
                                                        {
                                                            "type": "BinaryExpression",
                                                            "name": "!=",
                                                            "range": [
                                                                1001,
                                                                1004
                                                            ],
                                                            "children": [],
                                                            "content": "key_id})\n"
                                                        },
                                                        {
                                                            "type": "Identifier",
                                                            "name": "user_id",
                                                            "range": [
                                                                1003,
                                                                1004
                                                            ],
                                                            "children": [],
                                                            "content": ")\n"
                                                        }
                                                    ],
                                                    "content": "{\"id\":key_id})\n"
                                                },
                                                {
                                                    "type": "Block",
                                                    "name": "consequent",
                                                    "range": [
                                                        1005,
                                                        1012
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "ThrowStatement",
                                                            "name": "raise",
                                                            "range": [
                                                                1006,
                                                                1012
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "NewExpression",
                                                                    "name": "APIKeyPermissionError",
                                                                    "range": [
                                                                        1007,
                                                                        1012
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "APIKeyPermissionError",
                                                                            "range": [
                                                                                1007,
                                                                                1012
                                                                            ],
                                                                            "children": [],
                                                                            "content": "not api_key:\nraise APIKeyNotFoundError"
                                                                        },
                                                                        {
                                                                            "type": "ArgumentList",
                                                                            "name": "arguments",
                                                                            "range": [
                                                                                1008,
                                                                                1012
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Literal",
                                                                                    "name": "\"You do not have permission to revoke this API key.\"",
                                                                                    "range": [
                                                                                        1010,
                                                                                        1012
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "\nraise APIKeyNotFoundError"
                                                                                }
                                                                            ],
                                                                            "content": "api_key:\nraise APIKeyNotFoundError"
                                                                        }
                                                                    ],
                                                                    "content": "not api_key:\nraise APIKeyNotFoundError"
                                                                }
                                                            ],
                                                            "content": "if not api_key:\nraise APIKeyNotFoundError"
                                                        }
                                                    ],
                                                    "content": "\nif not api_key:\nraise APIKeyNotFoundError"
                                                }
                                            ],
                                            "content": "={\"id\":key_id})\n\nif not api_key:\nraise APIKeyNotFoundError"
                                        },
                                        {
                                            "type": "VariableDecl",
                                            "name": "where_clause",
                                            "range": [
                                                1015,
                                                1024
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "where_clause",
                                                    "range": [
                                                        1015,
                                                        1024
                                                    ],
                                                    "children": [],
                                                    "content": "\"API key with id {key_id} not found\")\n\nif api_key.userId!="
                                                },
                                                {
                                                    "type": "Assignment",
                                                    "name": "=",
                                                    "range": [
                                                        1016,
                                                        1017
                                                    ],
                                                    "children": [],
                                                    "content": ")\n"
                                                },
                                                {
                                                    "type": "ObjectExpression",
                                                    "name": "APIKeyWhereUniqueInput",
                                                    "range": [
                                                        1018,
                                                        1024
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Property",
                                                            "name": "id",
                                                            "range": [
                                                                1020,
                                                                1023
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Literal",
                                                                    "name": "\"id\"",
                                                                    "range": [
                                                                        1020,
                                                                        1023
                                                                    ],
                                                                    "children": [],
                                                                    "content": "api_key.userId!"
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "key_id",
                                                                    "range": [
                                                                        1021,
                                                                        1023
                                                                    ],
                                                                    "children": [],
                                                                    "content": ".userId!"
                                                                }
                                                            ],
                                                            "content": "api_key.userId!"
                                                        }
                                                    ],
                                                    "content": "\nif api_key.userId!="
                                                }
                                            ],
                                            "content": "\"API key with id {key_id} not found\")\n\nif api_key.userId!="
                                        },
                                        {
                                            "type": "VariableDecl",
                                            "name": "updated_api_key",
                                            "range": [
                                                1025,
                                                1068
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "updated_api_key",
                                                    "range": [
                                                        1025,
                                                        1038
                                                    ],
                                                    "children": [],
                                                    "content": "user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n\nwhere_clause:"
                                                },
                                                {
                                                    "type": "Assignment",
                                                    "name": "=",
                                                    "range": [
                                                        1026,
                                                        1027
                                                    ],
                                                    "children": [],
                                                    "content": ":\n"
                                                },
                                                {
                                                    "type": "AwaitExpression",
                                                    "name": "await",
                                                    "range": [
                                                        1027,
                                                        1068
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "PrismaAPIKey.prisma().update",
                                                            "range": [
                                                                1028,
                                                                1068
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "PrismaAPIKey.prisma",
                                                                    "range": [
                                                                        1028,
                                                                        1035
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "PrismaAPIKey",
                                                                            "range": [
                                                                                1028,
                                                                                1035
                                                                            ],
                                                                            "children": [],
                                                                            "content": "raise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "prisma",
                                                                            "range": [
                                                                                1029,
                                                                                1035
                                                                            ],
                                                                            "children": [],
                                                                            "content": "APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n"
                                                                        }
                                                                    ],
                                                                    "content": "raise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n"
                                                                },
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "update",
                                                                    "range": [
                                                                        1034,
                                                                        1068
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "update",
                                                                            "range": [
                                                                                1034,
                                                                                1068
                                                                            ],
                                                                            "children": [],
                                                                            "content": ")\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\n"
                                                                        },
                                                                        {
                                                                            "type": "ArgumentList",
                                                                            "name": "arguments",
                                                                            "range": [
                                                                                1035,
                                                                                1068
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "ObjectExpression",
                                                                                    "name": "where",
                                                                                    "range": [
                                                                                        1037,
                                                                                        1040
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Property",
                                                                                            "name": "where",
                                                                                            "range": [
                                                                                                1037,
                                                                                                1040
                                                                                            ],
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "Identifier",
                                                                                                    "name": "where_clause",
                                                                                                    "range": [
                                                                                                        1038,
                                                                                                        1040
                                                                                                    ],
                                                                                                    "children": [],
                                                                                                    "content": ":APIKeyWhereUniqueInput="
                                                                                                }
                                                                                            ],
                                                                                            "content": "where_clause:APIKeyWhereUniqueInput="
                                                                                        }
                                                                                    ],
                                                                                    "content": "where_clause:APIKeyWhereUniqueInput="
                                                                                },
                                                                                {
                                                                                    "type": "ObjectExpression",
                                                                                    "name": "data",
                                                                                    "range": [
                                                                                        1042,
                                                                                        1065
                                                                                    ],
                                                                                    "children": [
                                                                                        {
                                                                                            "type": "Property",
                                                                                            "name": "data",
                                                                                            "range": [
                                                                                                1042,
                                                                                                1065
                                                                                            ],
                                                                                            "children": [
                                                                                                {
                                                                                                    "type": "NewExpression",
                                                                                                    "name": "APIKeyUpdateInput",
                                                                                                    "range": [
                                                                                                        1044,
                                                                                                        1065
                                                                                                    ],
                                                                                                    "children": [
                                                                                                        {
                                                                                                            "type": "Identifier",
                                                                                                            "name": "APIKeyUpdateInput",
                                                                                                            "range": [
                                                                                                                1044,
                                                                                                                1065
                                                                                                            ],
                                                                                                            "children": [],
                                                                                                            "content": "key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata="
                                                                                                        },
                                                                                                        {
                                                                                                            "type": "ArgumentList",
                                                                                                            "name": "arguments",
                                                                                                            "range": [
                                                                                                                1045,
                                                                                                                1065
                                                                                                            ],
                                                                                                            "children": [
                                                                                                                {
                                                                                                                    "type": "Property",
                                                                                                                    "name": "status",
                                                                                                                    "range": [
                                                                                                                        1047,
                                                                                                                        1052
                                                                                                                    ],
                                                                                                                    "children": [
                                                                                                                        {
                                                                                                                            "type": "Identifier",
                                                                                                                            "name": "status",
                                                                                                                            "range": [
                                                                                                                                1047,
                                                                                                                                1052
                                                                                                                            ],
                                                                                                                            "children": [],
                                                                                                                            "content": "updated_api_key=await PrismaAPIKey.prisma"
                                                                                                                        },
                                                                                                                        {
                                                                                                                            "type": "MemberExpression",
                                                                                                                            "name": "APIKeyStatus.REVOKED",
                                                                                                                            "range": [
                                                                                                                                1049,
                                                                                                                                1052
                                                                                                                            ],
                                                                                                                            "children": [
                                                                                                                                {
                                                                                                                                    "type": "Identifier",
                                                                                                                                    "name": "APIKeyStatus",
                                                                                                                                    "range": [
                                                                                                                                        1049,
                                                                                                                                        1052
                                                                                                                                    ],
                                                                                                                                    "children": [],
                                                                                                                                    "content": "await PrismaAPIKey.prisma"
                                                                                                                                },
                                                                                                                                {
                                                                                                                                    "type": "Identifier",
                                                                                                                                    "name": "REVOKED",
                                                                                                                                    "range": [
                                                                                                                                        1050,
                                                                                                                                        1052
                                                                                                                                    ],
                                                                                                                                    "children": [],
                                                                                                                                    "content": "PrismaAPIKey.prisma"
                                                                                                                                }
                                                                                                                            ],
                                                                                                                            "content": "await PrismaAPIKey.prisma"
                                                                                                                        }
                                                                                                                    ],
                                                                                                                    "content": "updated_api_key=await PrismaAPIKey.prisma"
                                                                                                                },
                                                                                                                {
                                                                                                                    "type": "Property",
                                                                                                                    "name": "revokedAt",
                                                                                                                    "range": [
                                                                                                                        1053,
                                                                                                                        1063
                                                                                                                    ],
                                                                                                                    "children": [
                                                                                                                        {
                                                                                                                            "type": "Identifier",
                                                                                                                            "name": "revokedAt",
                                                                                                                            "range": [
                                                                                                                                1053,
                                                                                                                                1063
                                                                                                                            ],
                                                                                                                            "children": [],
                                                                                                                            "content": "().update(\nwhere=where_clause,\n"
                                                                                                                        },
                                                                                                                        {
                                                                                                                            "type": "CallExpression",
                                                                                                                            "name": "datetime.now",
                                                                                                                            "range": [
                                                                                                                                1055,
                                                                                                                                1063
                                                                                                                            ],
                                                                                                                            "children": [
                                                                                                                                {
                                                                                                                                    "type": "MemberExpression",
                                                                                                                                    "name": "datetime.now",
                                                                                                                                    "range": [
                                                                                                                                        1055,
                                                                                                                                        1063
                                                                                                                                    ],
                                                                                                                                    "children": [
                                                                                                                                        {
                                                                                                                                            "type": "Identifier",
                                                                                                                                            "name": "datetime",
                                                                                                                                            "range": [
                                                                                                                                                1055,
                                                                                                                                                1063
                                                                                                                                            ],
                                                                                                                                            "children": [],
                                                                                                                                            "content": ".update(\nwhere=where_clause,\n"
                                                                                                                                        },
                                                                                                                                        {
                                                                                                                                            "type": "Identifier",
                                                                                                                                            "name": "now",
                                                                                                                                            "range": [
                                                                                                                                                1056,
                                                                                                                                                1063
                                                                                                                                            ],
                                                                                                                                            "children": [],
                                                                                                                                            "content": "update(\nwhere=where_clause,\n"
                                                                                                                                        }
                                                                                                                                    ],
                                                                                                                                    "content": ".update(\nwhere=where_clause,\n"
                                                                                                                                },
                                                                                                                                {
                                                                                                                                    "type": "ArgumentList",
                                                                                                                                    "name": "arguments",
                                                                                                                                    "range": [
                                                                                                                                        1058,
                                                                                                                                        1063
                                                                                                                                    ],
                                                                                                                                    "children": [
                                                                                                                                        {
                                                                                                                                            "type": "MemberExpression",
                                                                                                                                            "name": "timezone.utc",
                                                                                                                                            "range": [
                                                                                                                                                1059,
                                                                                                                                                1063
                                                                                                                                            ],
                                                                                                                                            "children": [
                                                                                                                                                {
                                                                                                                                                    "type": "Identifier",
                                                                                                                                                    "name": "timezone",
                                                                                                                                                    "range": [
                                                                                                                                                        1059,
                                                                                                                                                        1063
                                                                                                                                                    ],
                                                                                                                                                    "children": [],
                                                                                                                                                    "content": "where=where_clause,\n"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    "type": "Identifier",
                                                                                                                                                    "name": "utc",
                                                                                                                                                    "range": [
                                                                                                                                                        1060,
                                                                                                                                                        1063
                                                                                                                                                    ],
                                                                                                                                                    "children": [],
                                                                                                                                                    "content": "=where_clause,\n"
                                                                                                                                                }
                                                                                                                                            ],
                                                                                                                                            "content": "where=where_clause,\n"
                                                                                                                                        }
                                                                                                                                    ],
                                                                                                                                    "content": "\nwhere=where_clause,\n"
                                                                                                                                }
                                                                                                                            ],
                                                                                                                            "content": ".update(\nwhere=where_clause,\n"
                                                                                                                        }
                                                                                                                    ],
                                                                                                                    "content": "().update(\nwhere=where_clause,\n"
                                                                                                                }
                                                                                                            ],
                                                                                                            "content": "}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata="
                                                                                                        }
                                                                                                    ],
                                                                                                    "content": "key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata="
                                                                                                }
                                                                                            ],
                                                                                            "content": "\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata="
                                                                                        }
                                                                                    ],
                                                                                    "content": "\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata="
                                                                                }
                                                                            ],
                                                                            "content": "\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\n"
                                                                        }
                                                                    ],
                                                                    "content": ")\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\n"
                                                                }
                                                            ],
                                                            "content": "raise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\n"
                                                        }
                                                    ],
                                                    "content": "\nraise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\n"
                                                }
                                            ],
                                            "content": "user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\n"
                                        },
                                        {
                                            "type": "IfStatement",
                                            "name": "if",
                                            "range": [
                                                1070,
                                                1081
                                            ],
                                            "children": [
                                                {
                                                    "type": "Condition",
                                                    "name": "updated_api_key",
                                                    "range": [
                                                        1071,
                                                        1072
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "updated_api_key",
                                                            "range": [
                                                                1071,
                                                                1072
                                                            ],
                                                            "children": [],
                                                            "content": "APIKeyStatus."
                                                        }
                                                    ],
                                                    "content": "APIKeyStatus."
                                                },
                                                {
                                                    "type": "Block",
                                                    "name": "consequent",
                                                    "range": [
                                                        1073,
                                                        1081
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "ReturnStatement",
                                                            "name": "return",
                                                            "range": [
                                                                1074,
                                                                1081
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "APIKeyWithoutHash.from_db",
                                                                    "range": [
                                                                        1075,
                                                                        1081
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "MemberExpression",
                                                                            "name": "APIKeyWithoutHash.from_db",
                                                                            "range": [
                                                                                1075,
                                                                                1081
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "APIKeyWithoutHash",
                                                                                    "range": [
                                                                                        1075,
                                                                                        1081
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "revokedAt=datetime.now(timezone"
                                                                                },
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "from_db",
                                                                                    "range": [
                                                                                        1076,
                                                                                        1081
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "=datetime.now(timezone"
                                                                                }
                                                                            ],
                                                                            "content": "revokedAt=datetime.now(timezone"
                                                                        },
                                                                        {
                                                                            "type": "ArgumentList",
                                                                            "name": "arguments",
                                                                            "range": [
                                                                                1078,
                                                                                1081
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Identifier",
                                                                                    "name": "updated_api_key",
                                                                                    "range": [
                                                                                        1079,
                                                                                        1081
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": "now(timezone"
                                                                                }
                                                                            ],
                                                                            "content": ".now(timezone"
                                                                        }
                                                                    ],
                                                                    "content": "revokedAt=datetime.now(timezone"
                                                                }
                                                            ],
                                                            "content": ",revokedAt=datetime.now(timezone"
                                                        }
                                                    ],
                                                    "content": "REVOKED,revokedAt=datetime.now(timezone"
                                                }
                                            ],
                                            "content": "=APIKeyStatus.REVOKED,revokedAt=datetime.now(timezone"
                                        },
                                        {
                                            "type": "ReturnStatement",
                                            "name": "return",
                                            "range": [
                                                1082,
                                                1084
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "None",
                                                    "range": [
                                                        1083,
                                                        1084
                                                    ],
                                                    "children": [],
                                                    "content": "utc)"
                                                }
                                            ],
                                            "content": ".utc)"
                                        }
                                    ],
                                    "content": "async def revoke_api_key(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif not api_key:\nraise APIKeyNotFoundError(f \"API key with id {key_id} not found\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\nstatus=APIKeyStatus.REVOKED,revokedAt=datetime.now(timezone.utc)"
                                },
                                {
                                    "type": "CatchClause",
                                    "name": "except",
                                    "range": [
                                        1085,
                                        1097
                                    ],
                                    "children": [
                                        {
                                            "type": "Block",
                                            "name": "body",
                                            "range": [
                                                1094,
                                                1097
                                            ],
                                            "children": [
                                                {
                                                    "type": "ThrowStatement",
                                                    "name": "raise",
                                                    "range": [
                                                        1095,
                                                        1097
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "e",
                                                            "range": [
                                                                1096,
                                                                1097
                                                            ],
                                                            "children": [],
                                                            "content": "return APIKeyWithoutHash"
                                                        }
                                                    ],
                                                    "content": "\nreturn APIKeyWithoutHash"
                                                }
                                            ],
                                            "content": ":\nreturn APIKeyWithoutHash"
                                        }
                                    ],
                                    "content": "\n),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash"
                                },
                                {
                                    "type": "CatchClause",
                                    "name": "except",
                                    "range": [
                                        1098,
                                        1118
                                    ],
                                    "children": [
                                        {
                                            "type": "Block",
                                            "name": "body",
                                            "range": [
                                                1103,
                                                1118
                                            ],
                                            "children": [
                                                {
                                                    "type": "ExpressionStatement",
                                                    "name": "logger.error",
                                                    "range": [
                                                        1104,
                                                        1111
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "logger.error",
                                                            "range": [
                                                                1104,
                                                                1111
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "logger.error",
                                                                    "range": [
                                                                        1104,
                                                                        1111
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "logger",
                                                                            "range": [
                                                                                1104,
                                                                                1111
                                                                            ],
                                                                            "children": [],
                                                                            "content": "return None\nexcept(APIKeyNotFoundError,APIKeyPermissionError"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "error",
                                                                            "range": [
                                                                                1105,
                                                                                1111
                                                                            ],
                                                                            "children": [],
                                                                            "content": "None\nexcept(APIKeyNotFoundError,APIKeyPermissionError"
                                                                        }
                                                                    ],
                                                                    "content": "return None\nexcept(APIKeyNotFoundError,APIKeyPermissionError"
                                                                },
                                                                {
                                                                    "type": "ArgumentList",
                                                                    "name": "arguments",
                                                                    "range": [
                                                                        1107,
                                                                        1111
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "TemplateLiteral",
                                                                            "name": "f\"Database error while revoking API key: {str(e)}\"",
                                                                            "range": [
                                                                                1108,
                                                                                1111
                                                                            ],
                                                                            "children": [],
                                                                            "content": "(APIKeyNotFoundError,APIKeyPermissionError"
                                                                        }
                                                                    ],
                                                                    "content": "except(APIKeyNotFoundError,APIKeyPermissionError"
                                                                }
                                                            ],
                                                            "content": "return None\nexcept(APIKeyNotFoundError,APIKeyPermissionError"
                                                        }
                                                    ],
                                                    "content": "return None\nexcept(APIKeyNotFoundError,APIKeyPermissionError"
                                                },
                                                {
                                                    "type": "ThrowStatement",
                                                    "name": "raise",
                                                    "range": [
                                                        1112,
                                                        1118
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "NewExpression",
                                                            "name": "APIKeyError",
                                                            "range": [
                                                                1113,
                                                                1118
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "APIKeyError",
                                                                    "range": [
                                                                        1113,
                                                                        1118
                                                                    ],
                                                                    "children": [],
                                                                    "content": "as e:\nraise e"
                                                                },
                                                                {
                                                                    "type": "ArgumentList",
                                                                    "name": "arguments",
                                                                    "range": [
                                                                        1114,
                                                                        1118
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "TemplateLiteral",
                                                                            "name": "f\"Failed to revoke API key: {str(e)}\"",
                                                                            "range": [
                                                                                1115,
                                                                                1118
                                                                            ],
                                                                            "children": [],
                                                                            "content": ":\nraise e"
                                                                        }
                                                                    ],
                                                                    "content": "e:\nraise e"
                                                                }
                                                            ],
                                                            "content": "as e:\nraise e"
                                                        }
                                                    ],
                                                    "content": ")as e:\nraise e"
                                                }
                                            ],
                                            "content": "\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e"
                                        }
                                    ],
                                    "content": ".from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e"
                                },
                                {
                                    "type": "CatchClause",
                                    "name": "except",
                                    "range": [
                                        1119,
                                        1139
                                    ],
                                    "children": [
                                        {
                                            "type": "Block",
                                            "name": "body",
                                            "range": [
                                                1124,
                                                1139
                                            ],
                                            "children": [
                                                {
                                                    "type": "ExpressionStatement",
                                                    "name": "logger.error",
                                                    "range": [
                                                        1125,
                                                        1132
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "logger.error",
                                                            "range": [
                                                                1125,
                                                                1132
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "MemberExpression",
                                                                    "name": "logger.error",
                                                                    "range": [
                                                                        1125,
                                                                        1132
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "logger",
                                                                            "range": [
                                                                                1125,
                                                                                1132
                                                                            ],
                                                                            "children": [],
                                                                            "content": "\nlogger.error(f \"Database error while revoking API key: {str(e)}\")"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "error",
                                                                            "range": [
                                                                                1126,
                                                                                1132
                                                                            ],
                                                                            "children": [],
                                                                            "content": "logger.error(f \"Database error while revoking API key: {str(e)}\")"
                                                                        }
                                                                    ],
                                                                    "content": "\nlogger.error(f \"Database error while revoking API key: {str(e)}\")"
                                                                },
                                                                {
                                                                    "type": "ArgumentList",
                                                                    "name": "arguments",
                                                                    "range": [
                                                                        1128,
                                                                        1132
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "TemplateLiteral",
                                                                            "name": "f\"Unexpected error while revoking API key: {str(e)}\"",
                                                                            "range": [
                                                                                1129,
                                                                                1132
                                                                            ],
                                                                            "children": [],
                                                                            "content": "(f \"Database error while revoking API key: {str(e)}\")"
                                                                        }
                                                                    ],
                                                                    "content": "error(f \"Database error while revoking API key: {str(e)}\")"
                                                                }
                                                            ],
                                                            "content": "\nlogger.error(f \"Database error while revoking API key: {str(e)}\")"
                                                        }
                                                    ],
                                                    "content": "\nlogger.error(f \"Database error while revoking API key: {str(e)}\")"
                                                },
                                                {
                                                    "type": "ThrowStatement",
                                                    "name": "raise",
                                                    "range": [
                                                        1133,
                                                        1139
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "NewExpression",
                                                            "name": "APIKeyError",
                                                            "range": [
                                                                1134,
                                                                1139
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "APIKeyError",
                                                                    "range": [
                                                                        1134,
                                                                        1139
                                                                    ],
                                                                    "children": [],
                                                                    "content": "raise APIKeyError(f \"Failed to revoke API key: {str(e)}\")"
                                                                },
                                                                {
                                                                    "type": "ArgumentList",
                                                                    "name": "arguments",
                                                                    "range": [
                                                                        1135,
                                                                        1139
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "TemplateLiteral",
                                                                            "name": "f\"Failed to revoke API key: {str(e)}\"",
                                                                            "range": [
                                                                                1136,
                                                                                1139
                                                                            ],
                                                                            "children": [],
                                                                            "content": "(f \"Failed to revoke API key: {str(e)}\")"
                                                                        }
                                                                    ],
                                                                    "content": "APIKeyError(f \"Failed to revoke API key: {str(e)}\")"
                                                                }
                                                            ],
                                                            "content": "raise APIKeyError(f \"Failed to revoke API key: {str(e)}\")"
                                                        }
                                                    ],
                                                    "content": "\nraise APIKeyError(f \"Failed to revoke API key: {str(e)}\")"
                                                }
                                            ],
                                            "content": ":\nlogger.error(f \"Database error while revoking API key: {str(e)}\")\nraise APIKeyError(f \"Failed to revoke API key: {str(e)}\")"
                                        }
                                    ],
                                    "content": "\nexcept PrismaError as e:\nlogger.error(f \"Database error while revoking API key: {str(e)}\")\nraise APIKeyError(f \"Failed to revoke API key: {str(e)}\")"
                                }
                            ],
                            "content": "\n\nasync def revoke_api_key(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif not api_key:\nraise APIKeyNotFoundError(f \"API key with id {key_id} not found\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\nstatus=APIKeyStatus.REVOKED,revokedAt=datetime.now(timezone.utc)\n),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error(f \"Database error while revoking API key: {str(e)}\")\nraise APIKeyError(f \"Failed to revoke API key: {str(e)}\")"
                        }
                    ],
                    "content": "\n\n\nasync def revoke_api_key(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif not api_key:\nraise APIKeyNotFoundError(f \"API key with id {key_id} not found\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\nstatus=APIKeyStatus.REVOKED,revokedAt=datetime.now(timezone.utc)\n),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error(f \"Database error while revoking API key: {str(e)}\")\nraise APIKeyError(f \"Failed to revoke API key: {str(e)}\")"
                }
            ],
            "content": "Exception as e:\nlogger.error(f \"Error validating API key: {str(e)}\")\nraise APIKeyValidationError(f \"Failed to validate API key: {str(e)}\")\n\n\nasync def revoke_api_key(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif not api_key:\nraise APIKeyNotFoundError(f \"API key with id {key_id} not found\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\nstatus=APIKeyStatus.REVOKED,revokedAt=datetime.now(timezone.utc)\n),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error(f \"Database error while revoking API key: {str(e)}\")\nraise APIKeyError(f \"Failed to revoke API key: {str(e)}\")"
        },
        {
            "type": "FunctionDecl",
            "name": "list_user_api_keys",
            "range": [
                1140,
                1252
            ],
            "children": [
                {
                    "type": "AsyncKeyword",
                    "name": "async",
                    "range": [
                        1140,
                        1140
                    ],
                    "children": [],
                    "content": "\n"
                },
                {
                    "type": "DefKeyword",
                    "name": "def",
                    "range": [
                        1141,
                        1141
                    ],
                    "children": [],
                    "content": "except"
                },
                {
                    "type": "Identifier",
                    "name": "list_user_api_keys",
                    "range": [
                        1142,
                        1142
                    ],
                    "children": [],
                    "content": "Exception"
                },
                {
                    "type": "ParameterList",
                    "name": "parameters",
                    "range": [
                        1143,
                        1147
                    ],
                    "children": [
                        {
                            "type": "Parameter",
                            "name": "user_id",
                            "range": [
                                1144,
                                1144
                            ],
                            "children": [
                                {
                                    "type": "TypeAnnotation",
                                    "name": "str",
                                    "range": [
                                        1146,
                                        1146
                                    ],
                                    "children": [],
                                    "content": "\n"
                                }
                            ],
                            "content": "e"
                        }
                    ],
                    "content": "as e:\nlogger"
                },
                {
                    "type": "ReturnType",
                    "name": "-> List[APIKeyWithoutHash]",
                    "range": [
                        1148,
                        1154
                    ],
                    "children": [],
                    "content": ".error(f \"Unexpected error while revoking API key: {str(e)}\")\n"
                },
                {
                    "type": "BlockStatement",
                    "name": "body",
                    "range": [
                        1155,
                        1252
                    ],
                    "children": [
                        {
                            "type": "TryStatement",
                            "name": "try",
                            "range": [
                                1156,
                                1252
                            ],
                            "children": [
                                {
                                    "type": "BlockStatement",
                                    "name": "tryBlock",
                                    "range": [
                                        1158,
                                        1210
                                    ],
                                    "children": [
                                        {
                                            "type": "VariableDecl",
                                            "name": "where_clause",
                                            "range": [
                                                1159,
                                                1167
                                            ],
                                            "children": [
                                                {
                                                    "type": "TypeAnnotation",
                                                    "name": "APIKeyWhereInput",
                                                    "range": [
                                                        1161,
                                                        1161
                                                    ],
                                                    "children": [],
                                                    "content": "\n"
                                                },
                                                {
                                                    "type": "ObjectLiteral",
                                                    "name": "{\"userId\": user_id}",
                                                    "range": [
                                                        1163,
                                                        1167
                                                    ],
                                                    "children": [],
                                                    "content": "\nasync def list_user_api_keys("
                                                }
                                            ],
                                            "content": "\"Failed to revoke API key: {str(e)}\")\n\n\nasync def list_user_api_keys("
                                        },
                                        {
                                            "type": "VariableDecl",
                                            "name": "api_keys",
                                            "range": [
                                                1170,
                                                1194
                                            ],
                                            "children": [
                                                {
                                                    "type": "AwaitExpression",
                                                    "name": "await PrismaAPIKey.prisma().find_many",
                                                    "range": [
                                                        1172,
                                                        1194
                                                    ],
                                                    "children": [],
                                                    "content": "->List[APIKeyWithoutHash]:\ntry:\nwhere_clause:APIKeyWhereInput={\"userId\":user_id}\n\napi_keys"
                                                }
                                            ],
                                            "content": "str)->List[APIKeyWithoutHash]:\ntry:\nwhere_clause:APIKeyWhereInput={\"userId\":user_id}\n\napi_keys"
                                        },
                                        {
                                            "type": "ReturnStatement",
                                            "name": "return [APIKeyWithoutHash.from_db(key) for key in api_keys]",
                                            "range": [
                                                1197,
                                                1209
                                            ],
                                            "children": [],
                                            "content": "PrismaAPIKey.prisma().find_many(\nwhere=where_clause,"
                                        }
                                    ],
                                    "content": "f \"Failed to revoke API key: {str(e)}\")\n\n\nasync def list_user_api_keys(user_id:str)->List[APIKeyWithoutHash]:\ntry:\nwhere_clause:APIKeyWhereInput={\"userId\":user_id}\n\napi_keys=await PrismaAPIKey.prisma().find_many(\nwhere=where_clause,order"
                                },
                                {
                                    "type": "CatchClause",
                                    "name": "except PrismaError as e",
                                    "range": [
                                        1211,
                                        1231
                                    ],
                                    "children": [
                                        {
                                            "type": "BlockStatement",
                                            "name": "catchBlock",
                                            "range": [
                                                1216,
                                                1231
                                            ],
                                            "children": [
                                                {
                                                    "type": "ExpressionStatement",
                                                    "name": "logger.error(f\"Database error while listing API keys: {str(e)}\")",
                                                    "range": [
                                                        1217,
                                                        1223
                                                    ],
                                                    "children": [],
                                                    "content": "\n)\n\nreturn[APIKeyWithoutHash"
                                                },
                                                {
                                                    "type": "ThrowStatement",
                                                    "name": "raise APIKeyError(f\"Failed to list API keys: {str(e)}\")",
                                                    "range": [
                                                        1225,
                                                        1230
                                                    ],
                                                    "children": [],
                                                    "content": "from_db(key)for key"
                                                }
                                            ],
                                            "content": "}\n)\n\nreturn[APIKeyWithoutHash.from_db(key)for key in"
                                        }
                                    ],
                                    "content": "={\"createdAt\":\"desc\"}\n)\n\nreturn[APIKeyWithoutHash.from_db(key)for key in"
                                },
                                {
                                    "type": "CatchClause",
                                    "name": "except Exception as e",
                                    "range": [
                                        1232,
                                        1252
                                    ],
                                    "children": [
                                        {
                                            "type": "BlockStatement",
                                            "name": "catchBlock",
                                            "range": [
                                                1237,
                                                1252
                                            ],
                                            "children": [
                                                {
                                                    "type": "ExpressionStatement",
                                                    "name": "logger.error(f\"Unexpected error while listing API keys: {str(e)}\")",
                                                    "range": [
                                                        1238,
                                                        1244
                                                    ],
                                                    "children": [],
                                                    "content": "e:\nlogger.error("
                                                },
                                                {
                                                    "type": "ThrowStatement",
                                                    "name": "raise APIKeyError(f\"Failed to list API keys: {str(e)}\")",
                                                    "range": [
                                                        1246,
                                                        1251
                                                    ],
                                                    "children": [],
                                                    "content": "\"Database error while listing API keys: {str(e)}\")\nraise APIKeyError("
                                                }
                                            ],
                                            "content": "as e:\nlogger.error(f \"Database error while listing API keys: {str(e)}\")\nraise APIKeyError(f"
                                        }
                                    ],
                                    "content": "api_keys]\nexcept PrismaError as e:\nlogger.error(f \"Database error while listing API keys: {str(e)}\")\nraise APIKeyError(f"
                                }
                            ],
                            "content": "APIKeyError(f \"Failed to revoke API key: {str(e)}\")\n\n\nasync def list_user_api_keys(user_id:str)->List[APIKeyWithoutHash]:\ntry:\nwhere_clause:APIKeyWhereInput={\"userId\":user_id}\n\napi_keys=await PrismaAPIKey.prisma().find_many(\nwhere=where_clause,order={\"createdAt\":\"desc\"}\n)\n\nreturn[APIKeyWithoutHash.from_db(key)for key in api_keys]\nexcept PrismaError as e:\nlogger.error(f \"Database error while listing API keys: {str(e)}\")\nraise APIKeyError(f"
                        }
                    ],
                    "content": "raise APIKeyError(f \"Failed to revoke API key: {str(e)}\")\n\n\nasync def list_user_api_keys(user_id:str)->List[APIKeyWithoutHash]:\ntry:\nwhere_clause:APIKeyWhereInput={\"userId\":user_id}\n\napi_keys=await PrismaAPIKey.prisma().find_many(\nwhere=where_clause,order={\"createdAt\":\"desc\"}\n)\n\nreturn[APIKeyWithoutHash.from_db(key)for key in api_keys]\nexcept PrismaError as e:\nlogger.error(f \"Database error while listing API keys: {str(e)}\")\nraise APIKeyError(f"
                }
            ],
            "content": "\nexcept Exception as e:\nlogger.error(f \"Unexpected error while revoking API key: {str(e)}\")\nraise APIKeyError(f \"Failed to revoke API key: {str(e)}\")\n\n\nasync def list_user_api_keys(user_id:str)->List[APIKeyWithoutHash]:\ntry:\nwhere_clause:APIKeyWhereInput={\"userId\":user_id}\n\napi_keys=await PrismaAPIKey.prisma().find_many(\nwhere=where_clause,order={\"createdAt\":\"desc\"}\n)\n\nreturn[APIKeyWithoutHash.from_db(key)for key in api_keys]\nexcept PrismaError as e:\nlogger.error(f \"Database error while listing API keys: {str(e)}\")\nraise APIKeyError(f"
        },
        {
            "type": "FunctionDecl",
            "name": "suspend_api_key",
            "range": [
                1253,
                1439
            ],
            "children": [
                {
                    "type": "Keyword",
                    "name": "async",
                    "range": [
                        1253,
                        1253
                    ],
                    "children": [],
                    "content": "\"Failed to list API keys: {str(e)}\""
                },
                {
                    "type": "Keyword",
                    "name": "def",
                    "range": [
                        1254,
                        1254
                    ],
                    "children": [],
                    "content": ")"
                },
                {
                    "type": "Identifier",
                    "name": "suspend_api_key",
                    "range": [
                        1255,
                        1255
                    ],
                    "children": [],
                    "content": "\n"
                },
                {
                    "type": "Parameter",
                    "name": "key_id",
                    "range": [
                        1257,
                        1259
                    ],
                    "children": [
                        {
                            "type": "Identifier",
                            "name": "key_id",
                            "range": [
                                1257,
                                1257
                            ],
                            "children": [],
                            "content": "Exception"
                        },
                        {
                            "type": "TypeAnnotation",
                            "name": "str",
                            "range": [
                                1259,
                                1259
                            ],
                            "children": [],
                            "content": "e"
                        }
                    ],
                    "content": "Exception as e"
                },
                {
                    "type": "Parameter",
                    "name": "user_id",
                    "range": [
                        1261,
                        1263
                    ],
                    "children": [
                        {
                            "type": "Identifier",
                            "name": "user_id",
                            "range": [
                                1261,
                                1261
                            ],
                            "children": [],
                            "content": "\n"
                        },
                        {
                            "type": "TypeAnnotation",
                            "name": "str",
                            "range": [
                                1263,
                                1263
                            ],
                            "children": [],
                            "content": "."
                        }
                    ],
                    "content": "\nlogger."
                },
                {
                    "type": "TypeAnnotation",
                    "name": "Optional",
                    "range": [
                        1267,
                        1270
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "APIKeyWithoutHash",
                            "range": [
                                1269,
                                1269
                            ],
                            "children": [],
                            "content": "\n"
                        }
                    ],
                    "content": "\"Unexpected error while listing API keys: {str(e)}\")\nraise"
                },
                {
                    "type": "Block",
                    "name": "try",
                    "range": [
                        1273,
                        1439
                    ],
                    "children": [
                        {
                            "type": "Keyword",
                            "name": "try",
                            "range": [
                                1273,
                                1273
                            ],
                            "children": [],
                            "content": "f"
                        },
                        {
                            "type": "Statement",
                            "name": "api_key",
                            "range": [
                                1276,
                                1294
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "api_key",
                                    "range": [
                                        1276,
                                        1276
                                    ],
                                    "children": [],
                                    "content": "\n"
                                },
                                {
                                    "type": "Keyword",
                                    "name": "await",
                                    "range": [
                                        1278,
                                        1278
                                    ],
                                    "children": [],
                                    "content": "\n"
                                },
                                {
                                    "type": "CallExpression",
                                    "name": "PrismaAPIKey",
                                    "range": [
                                        1279,
                                        1279
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "prisma",
                                            "range": [
                                                1281,
                                                1281
                                            ],
                                            "children": [],
                                            "content": "suspend_api_key"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "find_unique",
                                            "range": [
                                                1285,
                                                1285
                                            ],
                                            "children": [],
                                            "content": "str"
                                        },
                                        {
                                            "type": "Argument",
                                            "name": "where",
                                            "range": [
                                                1287,
                                                1293
                                            ],
                                            "children": [
                                                {
                                                    "type": "Literal",
                                                    "name": "\"id\"",
                                                    "range": [
                                                        1290,
                                                        1290
                                                    ],
                                                    "children": [],
                                                    "content": ")"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "key_id",
                                                    "range": [
                                                        1292,
                                                        1292
                                                    ],
                                                    "children": [],
                                                    "content": ">"
                                                }
                                            ],
                                            "content": "user_id:str)->Optional"
                                        }
                                    ],
                                    "content": "async"
                                }
                            ],
                            "content": "\n\n\nasync def suspend_api_key(key_id:str,user_id:str)->Optional["
                        },
                        {
                            "type": "IfStatement",
                            "name": "if",
                            "range": [
                                1297,
                                1308
                            ],
                            "children": [
                                {
                                    "type": "Keyword",
                                    "name": "if",
                                    "range": [
                                        1297,
                                        1297
                                    ],
                                    "children": [],
                                    "content": ":"
                                },
                                {
                                    "type": "Keyword",
                                    "name": "not",
                                    "range": [
                                        1298,
                                        1298
                                    ],
                                    "children": [],
                                    "content": "\n"
                                },
                                {
                                    "type": "Identifier",
                                    "name": "api_key",
                                    "range": [
                                        1299,
                                        1299
                                    ],
                                    "children": [],
                                    "content": "try"
                                },
                                {
                                    "type": "Statement",
                                    "name": "raise",
                                    "range": [
                                        1302,
                                        1307
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "APIKeyNotFoundError",
                                            "range": [
                                                1303,
                                                1303
                                            ],
                                            "children": [],
                                            "content": "="
                                        },
                                        {
                                            "type": "Literal",
                                            "name": "f\"API key with id {key_id} not found\"",
                                            "range": [
                                                1305,
                                                1306
                                            ],
                                            "children": [],
                                            "content": "PrismaAPIKey."
                                        }
                                    ],
                                    "content": "api_key=await PrismaAPIKey.prisma"
                                }
                            ],
                            "content": ":\ntry:\napi_key=await PrismaAPIKey.prisma("
                        },
                        {
                            "type": "IfStatement",
                            "name": "if",
                            "range": [
                                1310,
                                1326
                            ],
                            "children": [
                                {
                                    "type": "Keyword",
                                    "name": "if",
                                    "range": [
                                        1310,
                                        1310
                                    ],
                                    "children": [],
                                    "content": "."
                                },
                                {
                                    "type": "Identifier",
                                    "name": "api_key",
                                    "range": [
                                        1311,
                                        1311
                                    ],
                                    "children": [],
                                    "content": "find_unique"
                                },
                                {
                                    "type": "Identifier",
                                    "name": "userId",
                                    "range": [
                                        1313,
                                        1313
                                    ],
                                    "children": [],
                                    "content": "where"
                                },
                                {
                                    "type": "Identifier",
                                    "name": "user_id",
                                    "range": [
                                        1316,
                                        1316
                                    ],
                                    "children": [],
                                    "content": "\"id\""
                                },
                                {
                                    "type": "Statement",
                                    "name": "raise",
                                    "range": [
                                        1319,
                                        1325
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "APIKeyPermissionError",
                                            "range": [
                                                1320,
                                                1320
                                            ],
                                            "children": [],
                                            "content": ")"
                                        },
                                        {
                                            "type": "Literal",
                                            "name": "\"You do not have permission to suspend this API key.\"",
                                            "range": [
                                                1322,
                                                1323
                                            ],
                                            "children": [],
                                            "content": "\nif"
                                        }
                                    ],
                                    "content": "})\n\nif not api_key"
                                }
                            ],
                            "content": ".find_unique(where={\"id\":key_id})\n\nif not api_key:"
                        },
                        {
                            "type": "Statement",
                            "name": "where_clause",
                            "range": [
                                1328,
                                1337
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "where_clause",
                                    "range": [
                                        1328,
                                        1328
                                    ],
                                    "children": [],
                                    "content": "raise"
                                },
                                {
                                    "type": "TypeAnnotation",
                                    "name": "APIKeyWhereUniqueInput",
                                    "range": [
                                        1330,
                                        1330
                                    ],
                                    "children": [],
                                    "content": "("
                                },
                                {
                                    "type": "Literal",
                                    "name": "\"id\"",
                                    "range": [
                                        1333,
                                        1333
                                    ],
                                    "children": [],
                                    "content": ")"
                                },
                                {
                                    "type": "Identifier",
                                    "name": "key_id",
                                    "range": [
                                        1335,
                                        1335
                                    ],
                                    "children": [],
                                    "content": "\n"
                                }
                            ],
                            "content": "raise APIKeyNotFoundError(f \"API key with id {key_id} not found\")\n\nif api_key"
                        },
                        {
                            "type": "Statement",
                            "name": "updated_api_key",
                            "range": [
                                1338,
                                1368
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "updated_api_key",
                                    "range": [
                                        1338,
                                        1338
                                    ],
                                    "children": [],
                                    "content": "."
                                },
                                {
                                    "type": "Keyword",
                                    "name": "await",
                                    "range": [
                                        1340,
                                        1340
                                    ],
                                    "children": [],
                                    "content": "!"
                                },
                                {
                                    "type": "CallExpression",
                                    "name": "PrismaAPIKey",
                                    "range": [
                                        1341,
                                        1341
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "prisma",
                                            "range": [
                                                1343,
                                                1343
                                            ],
                                            "children": [],
                                            "content": ":"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "update",
                                            "range": [
                                                1347,
                                                1347
                                            ],
                                            "children": [],
                                            "content": "("
                                        },
                                        {
                                            "type": "Argument",
                                            "name": "where",
                                            "range": [
                                                1350,
                                                1352
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "where_clause",
                                                    "range": [
                                                        1352,
                                                        1352
                                                    ],
                                                    "children": [],
                                                    "content": "\n"
                                                }
                                            ],
                                            "content": "\n)\n"
                                        },
                                        {
                                            "type": "Argument",
                                            "name": "data",
                                            "range": [
                                                1355,
                                                1364
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "APIKeyUpdateInput",
                                                    "range": [
                                                        1357,
                                                        1357
                                                    ],
                                                    "children": [],
                                                    "content": "="
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "status",
                                                    "range": [
                                                        1359,
                                                        1359
                                                    ],
                                                    "children": [],
                                                    "content": "\"id\""
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "APIKeyStatus",
                                                    "range": [
                                                        1361,
                                                        1361
                                                    ],
                                                    "children": [],
                                                    "content": "key_id"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "SUSPENDED",
                                                    "range": [
                                                        1363,
                                                        1363
                                                    ],
                                                    "children": [],
                                                    "content": "\n"
                                                }
                                            ],
                                            "content": ":APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key"
                                        }
                                    ],
                                    "content": "="
                                }
                            ],
                            "content": ".userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to suspend this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey."
                        },
                        {
                            "type": "IfStatement",
                            "name": "if",
                            "range": [
                                1370,
                                1381
                            ],
                            "children": [
                                {
                                    "type": "Keyword",
                                    "name": "if",
                                    "range": [
                                        1370,
                                        1370
                                    ],
                                    "children": [],
                                    "content": "("
                                },
                                {
                                    "type": "Identifier",
                                    "name": "updated_api_key",
                                    "range": [
                                        1371,
                                        1371
                                    ],
                                    "children": [],
                                    "content": ")"
                                },
                                {
                                    "type": "Statement",
                                    "name": "return",
                                    "range": [
                                        1374,
                                        1380
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "APIKeyWithoutHash",
                                            "range": [
                                                1375,
                                                1375
                                            ],
                                            "children": [],
                                            "content": "\n"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "from_db",
                                            "range": [
                                                1377,
                                                1377
                                            ],
                                            "children": [],
                                            "content": "="
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "updated_api_key",
                                            "range": [
                                                1379,
                                                1379
                                            ],
                                            "children": [],
                                            "content": ","
                                        }
                                    ],
                                    "content": "(\nwhere=where_clause,\n"
                                }
                            ],
                            "content": "().update(\nwhere=where_clause,\ndata"
                        },
                        {
                            "type": "Statement",
                            "name": "return",
                            "range": [
                                1382,
                                1383
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "None",
                                    "range": [
                                        1383,
                                        1383
                                    ],
                                    "children": [],
                                    "content": "APIKeyUpdateInput"
                                }
                            ],
                            "content": "=APIKeyUpdateInput"
                        },
                        {
                            "type": "ExceptClause",
                            "name": "except",
                            "range": [
                                1385,
                                1397
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "APIKeyNotFoundError",
                                    "range": [
                                        1387,
                                        1387
                                    ],
                                    "children": [],
                                    "content": "APIKeyStatus"
                                },
                                {
                                    "type": "Identifier",
                                    "name": "APIKeyPermissionError",
                                    "range": [
                                        1389,
                                        1389
                                    ],
                                    "children": [],
                                    "content": "SUSPENDED"
                                },
                                {
                                    "type": "Statement",
                                    "name": "raise",
                                    "range": [
                                        1395,
                                        1396
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "e",
                                            "range": [
                                                1396,
                                                1396
                                            ],
                                            "children": [],
                                            "content": "if"
                                        }
                                    ],
                                    "content": "\nif"
                                }
                            ],
                            "content": "status=APIKeyStatus.SUSPENDED),\n)\n\nif updated_api_key"
                        },
                        {
                            "type": "ExceptClause",
                            "name": "except",
                            "range": [
                                1398,
                                1418
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "PrismaError",
                                    "range": [
                                        1399,
                                        1399
                                    ],
                                    "children": [],
                                    "content": "\n"
                                },
                                {
                                    "type": "Statement",
                                    "name": "logger",
                                    "range": [
                                        1404,
                                        1410
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "logger",
                                            "range": [
                                                1404,
                                                1404
                                            ],
                                            "children": [],
                                            "content": "("
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "error",
                                            "range": [
                                                1406,
                                                1406
                                            ],
                                            "children": [],
                                            "content": ")"
                                        },
                                        {
                                            "type": "Literal",
                                            "name": "f\"Database error while suspending API key: {str(e)}\"",
                                            "range": [
                                                1408,
                                                1409
                                            ],
                                            "children": [],
                                            "content": "return None"
                                        }
                                    ],
                                    "content": "(updated_api_key)\nreturn None\n"
                                },
                                {
                                    "type": "Statement",
                                    "name": "raise",
                                    "range": [
                                        1412,
                                        1417
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "APIKeyError",
                                            "range": [
                                                1413,
                                                1413
                                            ],
                                            "children": [],
                                            "content": "APIKeyNotFoundError"
                                        },
                                        {
                                            "type": "Literal",
                                            "name": "f\"Failed to suspend API key: {str(e)}\"",
                                            "range": [
                                                1415,
                                                1416
                                            ],
                                            "children": [],
                                            "content": "APIKeyPermissionError)"
                                        }
                                    ],
                                    "content": "(APIKeyNotFoundError,APIKeyPermissionError)as"
                                }
                            ],
                            "content": ":\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e"
                        },
                        {
                            "type": "ExceptClause",
                            "name": "except",
                            "range": [
                                1419,
                                1439
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "Exception",
                                    "range": [
                                        1420,
                                        1420
                                    ],
                                    "children": [],
                                    "content": "\n"
                                },
                                {
                                    "type": "Statement",
                                    "name": "logger",
                                    "range": [
                                        1425,
                                        1431
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "logger",
                                            "range": [
                                                1425,
                                                1425
                                            ],
                                            "children": [],
                                            "content": "PrismaError"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "error",
                                            "range": [
                                                1427,
                                                1427
                                            ],
                                            "children": [],
                                            "content": "e"
                                        },
                                        {
                                            "type": "Literal",
                                            "name": "f\"Unexpected error while suspending API key: {str(e)}\"",
                                            "range": [
                                                1429,
                                                1430
                                            ],
                                            "children": [],
                                            "content": "\nlogger"
                                        }
                                    ],
                                    "content": "PrismaError as e:\nlogger."
                                },
                                {
                                    "type": "Statement",
                                    "name": "raise",
                                    "range": [
                                        1433,
                                        1438
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "APIKeyError",
                                            "range": [
                                                1434,
                                                1434
                                            ],
                                            "children": [],
                                            "content": "f"
                                        },
                                        {
                                            "type": "Literal",
                                            "name": "f\"Failed to suspend API key: {str(e)}\"",
                                            "range": [
                                                1436,
                                                1437
                                            ],
                                            "children": [],
                                            "content": ")\n"
                                        }
                                    ],
                                    "content": "(f \"Database error while suspending API key: {str(e)}\")\nraise"
                                }
                            ],
                            "content": ":\nraise e\nexcept PrismaError as e:\nlogger.error(f \"Database error while suspending API key: {str(e)}\")\nraise APIKeyError"
                        }
                    ],
                    "content": "f \"Failed to list API keys: {str(e)}\")\n\n\nasync def suspend_api_key(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif not api_key:\nraise APIKeyNotFoundError(f \"API key with id {key_id} not found\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to suspend this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(status=APIKeyStatus.SUSPENDED),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error(f \"Database error while suspending API key: {str(e)}\")\nraise APIKeyError"
                }
            ],
            "content": "\"Failed to list API keys: {str(e)}\")\nexcept Exception as e:\nlogger.error(f \"Unexpected error while listing API keys: {str(e)}\")\nraise APIKeyError(f \"Failed to list API keys: {str(e)}\")\n\n\nasync def suspend_api_key(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif not api_key:\nraise APIKeyNotFoundError(f \"API key with id {key_id} not found\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to suspend this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(status=APIKeyStatus.SUSPENDED),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error(f \"Database error while suspending API key: {str(e)}\")\nraise APIKeyError"
        },
        {
            "type": "FunctionDecl",
            "name": "has_permission",
            "range": [
                1440,
                1482
            ],
            "children": [
                {
                    "type": "ParameterList",
                    "name": "parameters",
                    "range": [
                        1442,
                        1450
                    ],
                    "children": [
                        {
                            "type": "Parameter",
                            "name": "api_key",
                            "range": [
                                1443,
                                1445
                            ],
                            "children": [],
                            "content": ")\nexcept"
                        },
                        {
                            "type": "Parameter",
                            "name": "required_permission",
                            "range": [
                                1447,
                                1449
                            ],
                            "children": [],
                            "content": "as e:"
                        }
                    ],
                    "content": "\"Failed to suspend API key: {str(e)}\")\nexcept Exception as e:\n"
                },
                {
                    "type": "ReturnType",
                    "name": "bool",
                    "range": [
                        1451,
                        1453
                    ],
                    "children": [],
                    "content": "logger.error"
                },
                {
                    "type": "Block",
                    "name": "function_body",
                    "range": [
                        1455,
                        1482
                    ],
                    "children": [
                        {
                            "type": "TryStatement",
                            "name": "try",
                            "range": [
                                1456,
                                1479
                            ],
                            "children": [
                                {
                                    "type": "Block",
                                    "name": "try_block",
                                    "range": [
                                        1458,
                                        1465
                                    ],
                                    "children": [
                                        {
                                            "type": "ReturnStatement",
                                            "name": "return",
                                            "range": [
                                                1459,
                                                1465
                                            ],
                                            "children": [
                                                {
                                                    "type": "BinaryExpression",
                                                    "name": "in",
                                                    "range": [
                                                        1460,
                                                        1464
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "required_permission",
                                                            "range": [
                                                                1460,
                                                                1460
                                                            ],
                                                            "children": [],
                                                            "content": "APIKeyError"
                                                        },
                                                        {
                                                            "type": "MemberExpression",
                                                            "name": ".",
                                                            "range": [
                                                                1462,
                                                                1464
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "api_key",
                                                                    "range": [
                                                                        1462,
                                                                        1462
                                                                    ],
                                                                    "children": [],
                                                                    "content": "f"
                                                                },
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "permissions",
                                                                    "range": [
                                                                        1464,
                                                                        1464
                                                                    ],
                                                                    "children": [],
                                                                    "content": ")"
                                                                }
                                                            ],
                                                            "content": "f \"Failed to suspend API key: {str(e)}\")"
                                                        }
                                                    ],
                                                    "content": "APIKeyError(f \"Failed to suspend API key: {str(e)}\")"
                                                }
                                            ],
                                            "content": "raise APIKeyError(f \"Failed to suspend API key: {str(e)}\")\n"
                                        }
                                    ],
                                    "content": "\nraise APIKeyError(f \"Failed to suspend API key: {str(e)}\")\n"
                                },
                                {
                                    "type": "CatchClause",
                                    "name": "except",
                                    "range": [
                                        1466,
                                        1479
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "Exception",
                                            "range": [
                                                1467,
                                                1467
                                            ],
                                            "children": [],
                                            "content": "\n"
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "e",
                                            "range": [
                                                1469,
                                                1469
                                            ],
                                            "children": [],
                                            "content": "has_permission"
                                        },
                                        {
                                            "type": "Block",
                                            "name": "catch_block",
                                            "range": [
                                                1471,
                                                1479
                                            ],
                                            "children": [
                                                {
                                                    "type": "ExpressionStatement",
                                                    "name": "logger.error",
                                                    "range": [
                                                        1472,
                                                        1478
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "(",
                                                            "range": [
                                                                1475,
                                                                1478
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "TemplateLiteral",
                                                                    "name": "f",
                                                                    "range": [
                                                                        1476,
                                                                        1477
                                                                    ],
                                                                    "children": [],
                                                                    "content": ":APIKeyPermission"
                                                                }
                                                            ],
                                                            "content": "required_permission:APIKeyPermission)"
                                                        }
                                                    ],
                                                    "content": ":APIKey,required_permission:APIKeyPermission)"
                                                }
                                            ],
                                            "content": "api_key:APIKey,required_permission:APIKeyPermission)-"
                                        }
                                    ],
                                    "content": "\n\ndef has_permission(api_key:APIKey,required_permission:APIKeyPermission)-"
                                }
                            ],
                            "content": "\"Unexpected error while suspending API key: {str(e)}\")\nraise APIKeyError(f \"Failed to suspend API key: {str(e)}\")\n\n\ndef has_permission(api_key:APIKey,required_permission:APIKeyPermission)-"
                        },
                        {
                            "type": "ReturnStatement",
                            "name": "return",
                            "range": [
                                1480,
                                1482
                            ],
                            "children": [
                                {
                                    "type": "BooleanLiteral",
                                    "name": "False",
                                    "range": [
                                        1481,
                                        1481
                                    ],
                                    "children": [],
                                    "content": "bool"
                                }
                            ],
                            "content": ">bool:"
                        }
                    ],
                    "content": "f \"Unexpected error while suspending API key: {str(e)}\")\nraise APIKeyError(f \"Failed to suspend API key: {str(e)}\")\n\n\ndef has_permission(api_key:APIKey,required_permission:APIKeyPermission)->bool:"
                }
            ],
            "content": "(f \"Failed to suspend API key: {str(e)}\")\nexcept Exception as e:\nlogger.error(f \"Unexpected error while suspending API key: {str(e)}\")\nraise APIKeyError(f \"Failed to suspend API key: {str(e)}\")\n\n\ndef has_permission(api_key:APIKey,required_permission:APIKeyPermission)->bool:"
        },
        {
            "type": "FunctionDecl",
            "name": "get_api_key_by_id",
            "range": [
                1483,
                1592
            ],
            "children": [
                {
                    "type": "FunctionSignature",
                    "name": "get_api_key_by_id",
                    "range": [
                        1483,
                        1501
                    ],
                    "children": [
                        {
                            "type": "Keyword",
                            "name": "async",
                            "range": [
                                1483,
                                1488
                            ],
                            "children": [],
                            "content": "\ntry:\nreturn required_permission"
                        },
                        {
                            "type": "Keyword",
                            "name": "def",
                            "range": [
                                1484,
                                1487
                            ],
                            "children": [],
                            "content": "try:\nreturn"
                        },
                        {
                            "type": "Identifier",
                            "name": "get_api_key_by_id",
                            "range": [
                                1485,
                                1501
                            ],
                            "children": [],
                            "content": ":\nreturn required_permission in api_key.permissions\nexcept Exception as e:\nlogger."
                        },
                        {
                            "type": "ParameterList",
                            "name": "parameters",
                            "range": [
                                1486,
                                1494
                            ],
                            "children": [
                                {
                                    "type": "Parameter",
                                    "name": "key_id",
                                    "range": [
                                        1487,
                                        1489
                                    ],
                                    "children": [],
                                    "content": "return required_permission in"
                                },
                                {
                                    "type": "Parameter",
                                    "name": "user_id",
                                    "range": [
                                        1491,
                                        1493
                                    ],
                                    "children": [],
                                    "content": ".permissions\n"
                                }
                            ],
                            "content": "\nreturn required_permission in api_key.permissions\nexcept"
                        },
                        {
                            "type": "ReturnType",
                            "name": "Optional[APIKeyWithoutHash]",
                            "range": [
                                1495,
                                1501
                            ],
                            "children": [],
                            "content": "Exception as e:\nlogger."
                        }
                    ],
                    "content": "\ntry:\nreturn required_permission in api_key.permissions\nexcept Exception as e:\nlogger."
                },
                {
                    "type": "FunctionBody",
                    "name": "body",
                    "range": [
                        1502,
                        1592
                    ],
                    "children": [
                        {
                            "type": "TryStatement",
                            "name": "try",
                            "range": [
                                1503,
                                1571
                            ],
                            "children": [
                                {
                                    "type": "Block",
                                    "name": "tryBlock",
                                    "range": [
                                        1505,
                                        1550
                                    ],
                                    "children": [
                                        {
                                            "type": "VariableDeclaration",
                                            "name": "api_key",
                                            "range": [
                                                1506,
                                                1531
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "api_key",
                                                    "range": [
                                                        1506,
                                                        1513
                                                    ],
                                                    "children": [],
                                                    "content": ")\nreturn False\n\n\nasync"
                                                },
                                                {
                                                    "type": "Assignment",
                                                    "name": "=",
                                                    "range": [
                                                        1507,
                                                        1508
                                                    ],
                                                    "children": [],
                                                    "content": "\nreturn"
                                                },
                                                {
                                                    "type": "AwaitExpression",
                                                    "name": "await",
                                                    "range": [
                                                        1508,
                                                        1531
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "PrismaAPIKey.prisma().find_first",
                                                            "range": [
                                                                1509,
                                                                1531
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "PrismaAPIKey",
                                                                    "range": [
                                                                        1509,
                                                                        1520
                                                                    ],
                                                                    "children": [],
                                                                    "content": "False\n\n\nasync def get_api_key_by_id(key_id:str,"
                                                                },
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "prisma",
                                                                    "range": [
                                                                        1510,
                                                                        1513
                                                                    ],
                                                                    "children": [],
                                                                    "content": "\n\n\nasync"
                                                                },
                                                                {
                                                                    "type": "CallExpression",
                                                                    "name": "find_first",
                                                                    "range": [
                                                                        1514,
                                                                        1531
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "ObjectExpression",
                                                                            "name": "where",
                                                                            "range": [
                                                                                1518,
                                                                                1529
                                                                            ],
                                                                            "children": [
                                                                                {
                                                                                    "type": "Property",
                                                                                    "name": "id",
                                                                                    "range": [
                                                                                        1522,
                                                                                        1524
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": ":str)"
                                                                                },
                                                                                {
                                                                                    "type": "Property",
                                                                                    "name": "userId",
                                                                                    "range": [
                                                                                        1526,
                                                                                        1528
                                                                                    ],
                                                                                    "children": [],
                                                                                    "content": ">Optional["
                                                                                }
                                                                            ],
                                                                            "content": ":str,user_id:str)->Optional[APIKeyWithoutHash"
                                                                        }
                                                                    ],
                                                                    "content": "def get_api_key_by_id(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:"
                                                                }
                                                            ],
                                                            "content": "False\n\n\nasync def get_api_key_by_id(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:"
                                                        }
                                                    ],
                                                    "content": "return False\n\n\nasync def get_api_key_by_id(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:"
                                                }
                                            ],
                                            "content": ")\nreturn False\n\n\nasync def get_api_key_by_id(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:"
                                        },
                                        {
                                            "type": "IfStatement",
                                            "name": "if",
                                            "range": [
                                                1534,
                                                1541
                                            ],
                                            "children": [
                                                {
                                                    "type": "UnaryExpression",
                                                    "name": "not",
                                                    "range": [
                                                        1535,
                                                        1536
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "api_key",
                                                            "range": [
                                                                1536,
                                                                1541
                                                            ],
                                                            "children": [],
                                                            "content": "api_key=await PrismaAPIKey.prisma"
                                                        }
                                                    ],
                                                    "content": "\napi_key"
                                                },
                                                {
                                                    "type": "Block",
                                                    "name": "consequent",
                                                    "range": [
                                                        1538,
                                                        1541
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "ReturnStatement",
                                                            "name": "return",
                                                            "range": [
                                                                1539,
                                                                1540
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "None",
                                                                    "range": [
                                                                        1540,
                                                                        1541
                                                                    ],
                                                                    "children": [],
                                                                    "content": ".prisma"
                                                                }
                                                            ],
                                                            "content": "PrismaAPIKey."
                                                        }
                                                    ],
                                                    "content": "await PrismaAPIKey.prisma"
                                                }
                                            ],
                                            "content": ":\napi_key=await PrismaAPIKey.prisma"
                                        },
                                        {
                                            "type": "ReturnStatement",
                                            "name": "return",
                                            "range": [
                                                1543,
                                                1550
                                            ],
                                            "children": [
                                                {
                                                    "type": "CallExpression",
                                                    "name": "APIKeyWithoutHash.from_db",
                                                    "range": [
                                                        1544,
                                                        1550
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "APIKeyWithoutHash",
                                                            "range": [
                                                                1544,
                                                                1559
                                                            ],
                                                            "children": [],
                                                            "content": ".find_first(\nwhere=APIKeyWhereInput(id=key_id,userId=user_id)"
                                                        },
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "from_db",
                                                            "range": [
                                                                1545,
                                                                1550
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "api_key",
                                                                    "range": [
                                                                        1548,
                                                                        1550
                                                                    ],
                                                                    "children": [],
                                                                    "content": "where=APIKeyWhereInput"
                                                                }
                                                            ],
                                                            "content": "find_first(\nwhere=APIKeyWhereInput"
                                                        }
                                                    ],
                                                    "content": ".find_first(\nwhere=APIKeyWhereInput"
                                                }
                                            ],
                                            "content": ").find_first(\nwhere=APIKeyWhereInput"
                                        }
                                    ],
                                    "content": "\"Error checking API key permissions: {str(e)}\")\nreturn False\n\n\nasync def get_api_key_by_id(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput"
                                },
                                {
                                    "type": "CatchClause",
                                    "name": "except",
                                    "range": [
                                        1551,
                                        1571
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "PrismaError",
                                            "range": [
                                                1552,
                                                1563
                                            ],
                                            "children": [],
                                            "content": "id=key_id,userId=user_id)\n)\n\n"
                                        },
                                        {
                                            "type": "Block",
                                            "name": "body",
                                            "range": [
                                                1555,
                                                1571
                                            ],
                                            "children": [
                                                {
                                                    "type": "ExpressionStatement",
                                                    "name": "logger.error",
                                                    "range": [
                                                        1557,
                                                        1564
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "logger.error",
                                                            "range": [
                                                                1557,
                                                                1564
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "TemplateLiteral",
                                                                    "name": "f",
                                                                    "range": [
                                                                        1561,
                                                                        1563
                                                                    ],
                                                                    "children": [],
                                                                    "content": ")\n\n"
                                                                }
                                                            ],
                                                            "content": "=user_id)\n)\n\nif"
                                                        }
                                                    ],
                                                    "content": "=user_id)\n)\n\nif"
                                                },
                                                {
                                                    "type": "ThrowStatement",
                                                    "name": "raise",
                                                    "range": [
                                                        1565,
                                                        1571
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "NewExpression",
                                                            "name": "APIKeyError",
                                                            "range": [
                                                                1566,
                                                                1571
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "TemplateLiteral",
                                                                    "name": "f",
                                                                    "range": [
                                                                        1568,
                                                                        1570
                                                                    ],
                                                                    "children": [],
                                                                    "content": "\nreturn None"
                                                                }
                                                            ],
                                                            "content": "api_key:\nreturn None\n"
                                                        }
                                                    ],
                                                    "content": "not api_key:\nreturn None\n"
                                                }
                                            ],
                                            "content": ",userId=user_id)\n)\n\nif not api_key:\nreturn None\n"
                                        }
                                    ],
                                    "content": "(id=key_id,userId=user_id)\n)\n\nif not api_key:\nreturn None\n"
                                }
                            ],
                            "content": "(f \"Error checking API key permissions: {str(e)}\")\nreturn False\n\n\nasync def get_api_key_by_id(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput(id=key_id,userId=user_id)\n)\n\nif not api_key:\nreturn None\n"
                        },
                        {
                            "type": "CatchClause",
                            "name": "except",
                            "range": [
                                1572,
                                1592
                            ],
                            "children": [
                                {
                                    "type": "Identifier",
                                    "name": "Exception",
                                    "range": [
                                        1573,
                                        1582
                                    ],
                                    "children": [],
                                    "content": "return APIKeyWithoutHash.from_db(api_key)\nexcept PrismaError"
                                },
                                {
                                    "type": "Block",
                                    "name": "body",
                                    "range": [
                                        1576,
                                        1592
                                    ],
                                    "children": [
                                        {
                                            "type": "ExpressionStatement",
                                            "name": "logger.error",
                                            "range": [
                                                1578,
                                                1585
                                            ],
                                            "children": [
                                                {
                                                    "type": "CallExpression",
                                                    "name": "logger.error",
                                                    "range": [
                                                        1578,
                                                        1585
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "TemplateLiteral",
                                                            "name": "f",
                                                            "range": [
                                                                1582,
                                                                1584
                                                            ],
                                                            "children": [],
                                                            "content": "PrismaError as e"
                                                        }
                                                    ],
                                                    "content": "api_key)\nexcept PrismaError as e:"
                                                }
                                            ],
                                            "content": "api_key)\nexcept PrismaError as e:"
                                        },
                                        {
                                            "type": "ThrowStatement",
                                            "name": "raise",
                                            "range": [
                                                1586,
                                                1592
                                            ],
                                            "children": [
                                                {
                                                    "type": "NewExpression",
                                                    "name": "APIKeyError",
                                                    "range": [
                                                        1587,
                                                        1592
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "TemplateLiteral",
                                                            "name": "f",
                                                            "range": [
                                                                1589,
                                                                1591
                                                            ],
                                                            "children": [],
                                                            "content": "error(f"
                                                        }
                                                    ],
                                                    "content": "logger.error(f \"Database error while getting API key: {str(e)}\""
                                                }
                                            ],
                                            "content": "\nlogger.error(f \"Database error while getting API key: {str(e)}\""
                                        }
                                    ],
                                    "content": "from_db(api_key)\nexcept PrismaError as e:\nlogger.error(f \"Database error while getting API key: {str(e)}\""
                                }
                            ],
                            "content": "\nreturn APIKeyWithoutHash.from_db(api_key)\nexcept PrismaError as e:\nlogger.error(f \"Database error while getting API key: {str(e)}\""
                        }
                    ],
                    "content": "error(f \"Error checking API key permissions: {str(e)}\")\nreturn False\n\n\nasync def get_api_key_by_id(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput(id=key_id,userId=user_id)\n)\n\nif not api_key:\nreturn None\n\nreturn APIKeyWithoutHash.from_db(api_key)\nexcept PrismaError as e:\nlogger.error(f \"Database error while getting API key: {str(e)}\""
                }
            ],
            "content": "\ntry:\nreturn required_permission in api_key.permissions\nexcept Exception as e:\nlogger.error(f \"Error checking API key permissions: {str(e)}\")\nreturn False\n\n\nasync def get_api_key_by_id(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput(id=key_id,userId=user_id)\n)\n\nif not api_key:\nreturn None\n\nreturn APIKeyWithoutHash.from_db(api_key)\nexcept PrismaError as e:\nlogger.error(f \"Database error while getting API key: {str(e)}\""
        },
        {
            "type": "FunctionDecl",
            "name": "update_api_key_permissions",
            "range": [
                1593,
                1790
            ],
            "children": [
                {
                    "type": "Async",
                    "range": [
                        1593,
                        1593
                    ],
                    "content": ")"
                },
                {
                    "type": "Parameters",
                    "range": [
                        1596,
                        1613
                    ],
                    "children": [
                        {
                            "type": "Parameter",
                            "name": "key_id",
                            "range": [
                                1598,
                                1600
                            ],
                            "children": [
                                {
                                    "type": "TypeAnnotation",
                                    "name": "str",
                                    "range": [
                                        1600,
                                        1600
                                    ],
                                    "content": ")"
                                }
                            ],
                            "content": "f \"Failed to get API key: {str(e)}\")"
                        },
                        {
                            "type": "Parameter",
                            "name": "user_id",
                            "range": [
                                1602,
                                1604
                            ],
                            "children": [
                                {
                                    "type": "TypeAnnotation",
                                    "name": "str",
                                    "range": [
                                        1604,
                                        1604
                                    ],
                                    "content": "as"
                                }
                            ],
                            "content": "except Exception as"
                        },
                        {
                            "type": "Parameter",
                            "name": "permissions",
                            "range": [
                                1606,
                                1608
                            ],
                            "children": [
                                {
                                    "type": "TypeAnnotation",
                                    "name": "List",
                                    "range": [
                                        1608,
                                        1611
                                    ],
                                    "children": [
                                        {
                                            "type": "TypeArgument",
                                            "name": "APIKeyPermission",
                                            "range": [
                                                1610,
                                                1610
                                            ],
                                            "content": "error"
                                        }
                                    ],
                                    "content": "logger.error("
                                }
                            ],
                            "content": ":\nlogger"
                        }
                    ],
                    "content": "APIKeyError(f \"Failed to get API key: {str(e)}\")\nexcept Exception as e:\nlogger.error(f \"Unexpected error while getting API key: {str(e)}\""
                },
                {
                    "type": "ReturnType",
                    "range": [
                        1614,
                        1619
                    ],
                    "children": [
                        {
                            "type": "TypeAnnotation",
                            "name": "Optional",
                            "range": [
                                1616,
                                1619
                            ],
                            "children": [
                                {
                                    "type": "TypeArgument",
                                    "name": "APIKeyWithoutHash",
                                    "range": [
                                        1618,
                                        1618
                                    ],
                                    "content": "("
                                }
                            ],
                            "content": "raise APIKeyError(f"
                        }
                    ],
                    "content": ")\nraise APIKeyError(f"
                },
                {
                    "type": "Docstring",
                    "range": [
                        1622,
                        1624
                    ],
                    "children": [
                        {
                            "type": "Literal",
                            "value": "Update the permissions of an API key.",
                            "range": [
                                1623,
                                1623
                            ],
                            "content": "\n"
                        }
                    ],
                    "content": "\n\n\n"
                },
                {
                    "type": "TryStatement",
                    "range": [
                        1626,
                        1790
                    ],
                    "children": [
                        {
                            "type": "Block",
                            "range": [
                                1628,
                                1735
                            ],
                            "children": [
                                {
                                    "type": "AssignmentExpression",
                                    "range": [
                                        1629,
                                        1647
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "api_key",
                                            "range": [
                                                1629,
                                                1629
                                            ],
                                            "content": "\n"
                                        },
                                        {
                                            "type": "AwaitExpression",
                                            "range": [
                                                1631,
                                                1631
                                            ],
                                            "content": ":"
                                        },
                                        {
                                            "type": "CallExpression",
                                            "name": "find_unique",
                                            "range": [
                                                1638,
                                                1647
                                            ],
                                            "children": [
                                                {
                                                    "type": "Argument",
                                                    "name": "where",
                                                    "range": [
                                                        1640,
                                                        1646
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Dict",
                                                            "range": [
                                                                1642,
                                                                1646
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "KeyValuePair",
                                                                    "range": [
                                                                        1643,
                                                                        1645
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Literal",
                                                                            "value": "id",
                                                                            "range": [
                                                                                1643,
                                                                                1643
                                                                            ],
                                                                            "content": "]"
                                                                        },
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "key_id",
                                                                            "range": [
                                                                                1645,
                                                                                1645
                                                                            ],
                                                                            "content": ")"
                                                                        }
                                                                    ],
                                                                    "content": "]\n)"
                                                                }
                                                            ],
                                                            "content": "APIKeyPermission]\n)-"
                                                        }
                                                    ],
                                                    "content": "List[APIKeyPermission]\n)-"
                                                }
                                            ],
                                            "content": "permissions:List[APIKeyPermission]\n)->"
                                        }
                                    ],
                                    "content": "\nkey_id:str,user_id:str,permissions:List[APIKeyPermission]\n)->"
                                },
                                {
                                    "type": "IfStatement",
                                    "range": [
                                        1650,
                                        1661
                                    ],
                                    "children": [
                                        {
                                            "type": "Condition",
                                            "range": [
                                                1651,
                                                1653
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "api_key",
                                                    "range": [
                                                        1651,
                                                        1651
                                                    ],
                                                    "content": "]"
                                                },
                                                {
                                                    "type": "BinaryExpression",
                                                    "operator": "Is",
                                                    "range": [
                                                        1652,
                                                        1652
                                                    ],
                                                    "content": ":"
                                                },
                                                {
                                                    "type": "Literal",
                                                    "value": "None",
                                                    "range": [
                                                        1653,
                                                        1653
                                                    ],
                                                    "content": "\n"
                                                }
                                            ],
                                            "content": "]:\n"
                                        },
                                        {
                                            "type": "RaiseStatement",
                                            "range": [
                                                1656,
                                                1660
                                            ],
                                            "children": [
                                                {
                                                    "type": "CallExpression",
                                                    "name": "APIKeyNotFoundError",
                                                    "range": [
                                                        1657,
                                                        1660
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Argument",
                                                            "range": [
                                                                1659,
                                                                1659
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Literal",
                                                                    "value": "No such API key found.",
                                                                    "range": [
                                                                        1659,
                                                                        1659
                                                                    ],
                                                                    "content": ":"
                                                                }
                                                            ],
                                                            "content": ":"
                                                        }
                                                    ],
                                                    "content": "\ntry:\n"
                                                }
                                            ],
                                            "content": "\"\"\ntry:\n"
                                        }
                                    ],
                                    "content": "APIKeyWithoutHash]:\n\"\"\" \\n     Update the permissions of an API key. \\n     \"\"\"\ntry:\napi_key"
                                },
                                {
                                    "type": "IfStatement",
                                    "range": [
                                        1663,
                                        1678
                                    ],
                                    "children": [
                                        {
                                            "type": "Condition",
                                            "range": [
                                                1664,
                                                1669
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "api_key",
                                                    "range": [
                                                        1664,
                                                        1664
                                                    ],
                                                    "content": "PrismaAPIKey"
                                                },
                                                {
                                                    "type": "MemberExpression",
                                                    "name": "userId",
                                                    "range": [
                                                        1666,
                                                        1666
                                                    ],
                                                    "content": "prisma"
                                                },
                                                {
                                                    "type": "BinaryExpression",
                                                    "operator": "NotEqual",
                                                    "range": [
                                                        1667,
                                                        1668
                                                    ],
                                                    "content": "()"
                                                },
                                                {
                                                    "type": "Identifier",
                                                    "name": "user_id",
                                                    "range": [
                                                        1669,
                                                        1669
                                                    ],
                                                    "content": "."
                                                }
                                            ],
                                            "content": "PrismaAPIKey.prisma()."
                                        },
                                        {
                                            "type": "RaiseStatement",
                                            "range": [
                                                1672,
                                                1678
                                            ],
                                            "children": [
                                                {
                                                    "type": "CallExpression",
                                                    "name": "APIKeyPermissionError",
                                                    "range": [
                                                        1673,
                                                        1678
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Argument",
                                                            "range": [
                                                                1676,
                                                                1676
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Literal",
                                                                    "value": "You do not have permission to update this API key.",
                                                                    "range": [
                                                                        1676,
                                                                        1676
                                                                    ],
                                                                    "content": ":"
                                                                }
                                                            ],
                                                            "content": ":"
                                                        }
                                                    ],
                                                    "content": "={\"id\":key_id}"
                                                }
                                            ],
                                            "content": "where={\"id\":key_id}"
                                        }
                                    ],
                                    "content": "await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id}"
                                },
                                {
                                    "type": "AssignmentExpression",
                                    "range": [
                                        1681,
                                        1689
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "where_clause",
                                            "range": [
                                                1681,
                                                1681
                                            ],
                                            "content": "\n"
                                        },
                                        {
                                            "type": "TypeAnnotation",
                                            "name": "APIKeyWhereUniqueInput",
                                            "range": [
                                                1683,
                                                1683
                                            ],
                                            "content": "api_key"
                                        },
                                        {
                                            "type": "Dict",
                                            "range": [
                                                1685,
                                                1689
                                            ],
                                            "children": [
                                                {
                                                    "type": "KeyValuePair",
                                                    "range": [
                                                        1686,
                                                        1688
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Literal",
                                                            "value": "id",
                                                            "range": [
                                                                1686,
                                                                1686
                                                            ],
                                                            "content": ":"
                                                        },
                                                        {
                                                            "type": "Identifier",
                                                            "name": "key_id",
                                                            "range": [
                                                                1688,
                                                                1688
                                                            ],
                                                            "content": "raise"
                                                        }
                                                    ],
                                                    "content": ":\nraise"
                                                }
                                            ],
                                            "content": "None:\nraise APIKeyNotFoundError"
                                        }
                                    ],
                                    "content": "\nif api_key is None:\nraise APIKeyNotFoundError"
                                },
                                {
                                    "type": "AssignmentExpression",
                                    "range": [
                                        1691,
                                        1718
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "updated_api_key",
                                            "range": [
                                                1691,
                                                1691
                                            ],
                                            "content": "\"No such API key found.\""
                                        },
                                        {
                                            "type": "AwaitExpression",
                                            "range": [
                                                1693,
                                                1693
                                            ],
                                            "content": "\n"
                                        },
                                        {
                                            "type": "CallExpression",
                                            "name": "update",
                                            "range": [
                                                1700,
                                                1718
                                            ],
                                            "children": [
                                                {
                                                    "type": "Argument",
                                                    "name": "where",
                                                    "range": [
                                                        1703,
                                                        1705
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Identifier",
                                                            "name": "where_clause",
                                                            "range": [
                                                                1705,
                                                                1705
                                                            ],
                                                            "content": "APIKeyPermissionError"
                                                        }
                                                    ],
                                                    "content": "\nraise APIKeyPermissionError"
                                                },
                                                {
                                                    "type": "Argument",
                                                    "name": "data",
                                                    "range": [
                                                        1708,
                                                        1715
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "CallExpression",
                                                            "name": "APIKeyUpdateInput",
                                                            "range": [
                                                                1710,
                                                                1715
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Argument",
                                                                    "name": "permissions",
                                                                    "range": [
                                                                        1712,
                                                                        1714
                                                                    ],
                                                                    "children": [
                                                                        {
                                                                            "type": "Identifier",
                                                                            "name": "permissions",
                                                                            "range": [
                                                                                1714,
                                                                                1714
                                                                            ],
                                                                            "content": ":"
                                                                        }
                                                                    ],
                                                                    "content": "\nwhere_clause:"
                                                                }
                                                            ],
                                                            "content": ")\n\nwhere_clause:APIKeyWhereUniqueInput"
                                                        }
                                                    ],
                                                    "content": "\"You do not have permission to update this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput"
                                                }
                                            ],
                                            "content": "=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to update this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\""
                                        }
                                    ],
                                    "content": "\"No such API key found.\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to update this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\""
                                },
                                {
                                    "type": "IfStatement",
                                    "range": [
                                        1721,
                                        1732
                                    ],
                                    "children": [
                                        {
                                            "type": "Condition",
                                            "range": [
                                                1722,
                                                1723
                                            ],
                                            "children": [
                                                {
                                                    "type": "Identifier",
                                                    "name": "updated_api_key",
                                                    "range": [
                                                        1722,
                                                        1722
                                                    ],
                                                    "content": "\n"
                                                }
                                            ],
                                            "content": "\nupdated_api_key"
                                        },
                                        {
                                            "type": "ReturnStatement",
                                            "range": [
                                                1725,
                                                1731
                                            ],
                                            "children": [
                                                {
                                                    "type": "CallExpression",
                                                    "name": "from_db",
                                                    "range": [
                                                        1728,
                                                        1731
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Argument",
                                                            "range": [
                                                                1730,
                                                                1730
                                                            ],
                                                            "children": [
                                                                {
                                                                    "type": "Identifier",
                                                                    "name": "updated_api_key",
                                                                    "range": [
                                                                        1730,
                                                                        1730
                                                                    ],
                                                                    "content": ")"
                                                                }
                                                            ],
                                                            "content": ")"
                                                        }
                                                    ],
                                                    "content": "prisma()."
                                                }
                                            ],
                                            "content": "await PrismaAPIKey.prisma()."
                                        }
                                    ],
                                    "content": "}\nupdated_api_key=await PrismaAPIKey.prisma().update"
                                },
                                {
                                    "type": "ReturnStatement",
                                    "range": [
                                        1733,
                                        1734
                                    ],
                                    "children": [
                                        {
                                            "type": "Literal",
                                            "value": "None",
                                            "range": [
                                                1734,
                                                1734
                                            ],
                                            "content": "\n"
                                        }
                                    ],
                                    "content": "(\n"
                                }
                            ],
                            "content": "(\nkey_id:str,user_id:str,permissions:List[APIKeyPermission]\n)->Optional[APIKeyWithoutHash]:\n\"\"\" \\n     Update the permissions of an API key. \\n     \"\"\"\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif api_key is None:\nraise APIKeyNotFoundError(\"No such API key found.\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to update this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere"
                        },
                        {
                            "type": "CatchClause",
                            "range": [
                                1736,
                                1748
                            ],
                            "children": [
                                {
                                    "type": "Exception",
                                    "range": [
                                        1738,
                                        1741
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "APIKeyNotFoundError",
                                            "range": [
                                                1738,
                                                1738
                                            ],
                                            "content": ","
                                        },
                                        {
                                            "type": "Identifier",
                                            "name": "APIKeyPermissionError",
                                            "range": [
                                                1740,
                                                1740
                                            ],
                                            "content": "data"
                                        }
                                    ],
                                    "content": ",\ndata="
                                },
                                {
                                    "type": "RaiseStatement",
                                    "range": [
                                        1746,
                                        1747
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "e",
                                            "range": [
                                                1747,
                                                1747
                                            ],
                                            "content": ")"
                                        }
                                    ],
                                    "content": "permissions)"
                                }
                            ],
                            "content": "=where_clause,\ndata=APIKeyUpdateInput(permissions=permissions),"
                        },
                        {
                            "type": "CatchClause",
                            "range": [
                                1749,
                                1769
                            ],
                            "children": [
                                {
                                    "type": "Exception",
                                    "range": [
                                        1750,
                                        1750
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "PrismaError",
                                            "range": [
                                                1750,
                                                1750
                                            ],
                                            "content": ")"
                                        }
                                    ],
                                    "content": ")"
                                },
                                {
                                    "type": "CallExpression",
                                    "name": "error",
                                    "range": [
                                        1757,
                                        1761
                                    ],
                                    "children": [
                                        {
                                            "type": "Argument",
                                            "range": [
                                                1759,
                                                1760
                                            ],
                                            "children": [
                                                {
                                                    "type": "Literal",
                                                    "value": "Database error while updating API key permissions: {str(e)}",
                                                    "range": [
                                                        1760,
                                                        1760
                                                    ],
                                                    "content": "from_db"
                                                }
                                            ],
                                            "content": ".from_db"
                                        }
                                    ],
                                    "content": "return APIKeyWithoutHash.from_db("
                                },
                                {
                                    "type": "RaiseStatement",
                                    "range": [
                                        1763,
                                        1768
                                    ],
                                    "children": [
                                        {
                                            "type": "CallExpression",
                                            "name": "APIKeyError",
                                            "range": [
                                                1764,
                                                1768
                                            ],
                                            "children": [
                                                {
                                                    "type": "Argument",
                                                    "range": [
                                                        1766,
                                                        1767
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Literal",
                                                            "value": "Failed to update API key permissions: {str(e)}",
                                                            "range": [
                                                                1767,
                                                                1767
                                                            ],
                                                            "content": "\n"
                                                        }
                                                    ],
                                                    "content": "None\n"
                                                }
                                            ],
                                            "content": "\nreturn None\nexcept"
                                        }
                                    ],
                                    "content": ")\nreturn None\nexcept"
                                }
                            ],
                            "content": "\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept("
                        },
                        {
                            "type": "CatchClause",
                            "range": [
                                1770,
                                1790
                            ],
                            "children": [
                                {
                                    "type": "Exception",
                                    "range": [
                                        1771,
                                        1771
                                    ],
                                    "children": [
                                        {
                                            "type": "Identifier",
                                            "name": "Exception",
                                            "range": [
                                                1771,
                                                1771
                                            ],
                                            "content": ","
                                        }
                                    ],
                                    "content": ","
                                },
                                {
                                    "type": "CallExpression",
                                    "name": "error",
                                    "range": [
                                        1778,
                                        1782
                                    ],
                                    "children": [
                                        {
                                            "type": "Argument",
                                            "range": [
                                                1780,
                                                1781
                                            ],
                                            "children": [
                                                {
                                                    "type": "Literal",
                                                    "value": "Unexpected error while updating API key permissions: {str(e)}",
                                                    "range": [
                                                        1781,
                                                        1781
                                                    ],
                                                    "content": "except"
                                                }
                                            ],
                                            "content": "\nexcept"
                                        }
                                    ],
                                    "content": "raise e\nexcept PrismaError"
                                },
                                {
                                    "type": "RaiseStatement",
                                    "range": [
                                        1784,
                                        1789
                                    ],
                                    "children": [
                                        {
                                            "type": "CallExpression",
                                            "name": "APIKeyError",
                                            "range": [
                                                1785,
                                                1789
                                            ],
                                            "children": [
                                                {
                                                    "type": "Argument",
                                                    "range": [
                                                        1787,
                                                        1788
                                                    ],
                                                    "children": [
                                                        {
                                                            "type": "Literal",
                                                            "value": "Failed to update API key permissions: {str(e)}",
                                                            "range": [
                                                                1788,
                                                                1788
                                                            ],
                                                            "content": "."
                                                        }
                                                    ],
                                                    "content": "logger."
                                                }
                                            ],
                                            "content": ":\nlogger.error"
                                        }
                                    ],
                                    "content": "e:\nlogger.error"
                                }
                            ],
                            "content": "APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error("
                        }
                    ],
                    "content": "def update_api_key_permissions(\nkey_id:str,user_id:str,permissions:List[APIKeyPermission]\n)->Optional[APIKeyWithoutHash]:\n\"\"\" \\n     Update the permissions of an API key. \\n     \"\"\"\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif api_key is None:\nraise APIKeyNotFoundError(\"No such API key found.\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to update this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(permissions=permissions),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error("
                }
            ],
            "content": ")\nraise APIKeyError(f \"Failed to get API key: {str(e)}\")\nexcept Exception as e:\nlogger.error(f \"Unexpected error while getting API key: {str(e)}\")\nraise APIKeyError(f \"Failed to get API key: {str(e)}\")\n\n\nasync def update_api_key_permissions(\nkey_id:str,user_id:str,permissions:List[APIKeyPermission]\n)->Optional[APIKeyWithoutHash]:\n\"\"\" \\n     Update the permissions of an API key. \\n     \"\"\"\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif api_key is None:\nraise APIKeyNotFoundError(\"No such API key found.\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to update this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(permissions=permissions),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error("
        }
    ],
    "content": "\n\n#Some basic exceptions\nclass APIKeyError(Exception):\n\"\"\"Base exception for API key operations\"\"\"\n\npass\n\n\nclass APIKeyNotFoundError(APIKeyError):\n\"\"\"Raised when an API key is not found\"\"\"\n\npass\n\n\nclass APIKeyPermissionError(APIKeyError):\n\"\"\"Raised when there are permission issues with API key operations\"\"\"\n\npass\n\n\nclass APIKeyValidationError(APIKeyError):\n\"\"\"Raised when API key validation fails\"\"\"\n\npass\n\n\nclass APIKey(BaseDbModel):\nname:str\nprefix:str\nkey:str\nstatus:APIKeyStatus=APIKeyStatus.ACTIVE\npermissions:List[APIKeyPermission]\npostfix:str\ncreated_at:datetime\nlast_used_at:Optional[datetime]=None\nrevoked_at:Optional[datetime]=None\ndescription:Optional[str]=None\nuser_id:str\n\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKey(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nkey=api_key.key,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\ndescription=api_key.description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:\nlogger.error(f \"Error creating APIKey from db: {str(e)}\")\nraise APIKeyError(f \"Failed to create API key object: {str(e)}\")\n\n\nclass APIKeyWithoutHash(BaseModel):\nid:str\nname:str\nprefix:str\npostfix:str\nstatus:APIKeyStatus\npermissions:List[APIKeyPermission]\ncreated_at:datetime\nlast_used_at:Optional[datetime]\nrevoked_at:Optional[datetime]\ndescription:Optional[str]\nuser_id:str\n\n@staticmethod\ndef from_db(api_key:PrismaAPIKey):\ntry:\nreturn APIKeyWithoutHash(\nid=api_key.id,\nname=api_key.name,\nprefix=api_key.prefix,\npostfix=api_key.postfix,\nstatus=APIKeyStatus(api_key.status),\npermissions=[APIKeyPermission(p)for p in api_key.permissions],\ncreated_at=api_key.createdAt,\nlast_used_at=api_key.lastUsedAt,\nrevoked_at=api_key.revokedAt,\ndescription=api_key.description,\nuser_id=api_key.userId,\n)\nexcept Exception as e:\nlogger.error(f \"Error creating APIKeyWithoutHash from db: {str(e)}\")\nraise APIKeyError(f \"Failed to create API key object: {str(e)}\")\n\n\nasync def generate_api_key(\nname:str,\nuser_id:str,\npermissions:List[APIKeyPermission],\ndescription:Optional[str]=None,\n)->tuple[APIKeyWithoutHash,str]:\n\"\"\" \\n     Generate a new API key and store it in the database. \\n     Returns the API key object (without hash) and the plain text key. \\n     \"\"\"\ntry:\napi_manager=APIKeyManager()\nkey=api_manager.generate_api_key()\n\napi_key=await PrismaAPIKey.prisma().create(\ndata=APIKeyCreateInput(\nid=str(uuid.uuid4()),\nname=name,\nprefix=key.prefix,\npostfix=key.postfix,\nkey=key.hash,\npermissions=[p for p in permissions],\ndescription=description,\nuserId=user_id,\n)\n)\n\napi_key_without_hash=APIKeyWithoutHash.from_db(api_key)\nreturn api_key_without_hash,key.raw\nexcept PrismaError as e:\nlogger.error(f \"Database error while generating API key: {str(e)}\")\nraise APIKeyError(f \"Failed to generate API key: {str(e)}\")\nexcept Exception as e:\nlogger.error(f \"Unexpected error while generating API key: {str(e)}\")\nraise APIKeyError(f \"Failed to generate API key: {str(e)}\")\n\n\nasync def validate_api_key(plain_text_key:str)->Optional[APIKey]:\n\"\"\" \\n     Validate an API key and return the API key object if valid. \\n     \"\"\"\ntry:\nif not plain_text_key.startswith(APIKeyManager.PREFIX):\nlogger.warning(\"Invalid API key format\")\nreturn None\n\nprefix=plain_text_key[:APIKeyManager.PREFIX_LENGTH]\napi_manager=APIKeyManager()\n\napi_key=await PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput(prefix=prefix,status=(APIKeyStatus.ACTIVE))\n)\n\nif not api_key:\nlogger.warning(f \"No active API key found with prefix {prefix}\")\nreturn None\n\nis_valid=api_manager.verify_api_key(plain_text_key,api_key.key)\nif not is_valid:\nlogger.warning(\"API key verification failed\")\nreturn None\n\nreturn APIKey.from_db(api_key)\nexcept Exception as e:\nlogger.error(f \"Error validating API key: {str(e)}\")\nraise APIKeyValidationError(f \"Failed to validate API key: {str(e)}\")\n\n\nasync def revoke_api_key(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif not api_key:\nraise APIKeyNotFoundError(f \"API key with id {key_id} not found\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to revoke this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(\nstatus=APIKeyStatus.REVOKED,revokedAt=datetime.now(timezone.utc)\n),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error(f \"Database error while revoking API key: {str(e)}\")\nraise APIKeyError(f \"Failed to revoke API key: {str(e)}\")\nexcept Exception as e:\nlogger.error(f \"Unexpected error while revoking API key: {str(e)}\")\nraise APIKeyError(f \"Failed to revoke API key: {str(e)}\")\n\n\nasync def list_user_api_keys(user_id:str)->List[APIKeyWithoutHash]:\ntry:\nwhere_clause:APIKeyWhereInput={\"userId\":user_id}\n\napi_keys=await PrismaAPIKey.prisma().find_many(\nwhere=where_clause,order={\"createdAt\":\"desc\"}\n)\n\nreturn[APIKeyWithoutHash.from_db(key)for key in api_keys]\nexcept PrismaError as e:\nlogger.error(f \"Database error while listing API keys: {str(e)}\")\nraise APIKeyError(f \"Failed to list API keys: {str(e)}\")\nexcept Exception as e:\nlogger.error(f \"Unexpected error while listing API keys: {str(e)}\")\nraise APIKeyError(f \"Failed to list API keys: {str(e)}\")\n\n\nasync def suspend_api_key(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif not api_key:\nraise APIKeyNotFoundError(f \"API key with id {key_id} not found\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to suspend this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(status=APIKeyStatus.SUSPENDED),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error(f \"Database error while suspending API key: {str(e)}\")\nraise APIKeyError(f \"Failed to suspend API key: {str(e)}\")\nexcept Exception as e:\nlogger.error(f \"Unexpected error while suspending API key: {str(e)}\")\nraise APIKeyError(f \"Failed to suspend API key: {str(e)}\")\n\n\ndef has_permission(api_key:APIKey,required_permission:APIKeyPermission)->bool:\ntry:\nreturn required_permission in api_key.permissions\nexcept Exception as e:\nlogger.error(f \"Error checking API key permissions: {str(e)}\")\nreturn False\n\n\nasync def get_api_key_by_id(key_id:str,user_id:str)->Optional[APIKeyWithoutHash]:\ntry:\napi_key=await PrismaAPIKey.prisma().find_first(\nwhere=APIKeyWhereInput(id=key_id,userId=user_id)\n)\n\nif not api_key:\nreturn None\n\nreturn APIKeyWithoutHash.from_db(api_key)\nexcept PrismaError as e:\nlogger.error(f \"Database error while getting API key: {str(e)}\")\nraise APIKeyError(f \"Failed to get API key: {str(e)}\")\nexcept Exception as e:\nlogger.error(f \"Unexpected error while getting API key: {str(e)}\")\nraise APIKeyError(f \"Failed to get API key: {str(e)}\")\n\n\nasync def update_api_key_permissions(\nkey_id:str,user_id:str,permissions:List[APIKeyPermission]\n)->Optional[APIKeyWithoutHash]:\n\"\"\" \\n     Update the permissions of an API key. \\n     \"\"\"\ntry:\napi_key=await PrismaAPIKey.prisma().find_unique(where={\"id\":key_id})\n\nif api_key is None:\nraise APIKeyNotFoundError(\"No such API key found.\")\n\nif api_key.userId!=user_id:\nraise APIKeyPermissionError(\n\"You do not have permission to update this API key.\"\n)\n\nwhere_clause:APIKeyWhereUniqueInput={\"id\":key_id}\nupdated_api_key=await PrismaAPIKey.prisma().update(\nwhere=where_clause,\ndata=APIKeyUpdateInput(permissions=permissions),\n)\n\nif updated_api_key:\nreturn APIKeyWithoutHash.from_db(updated_api_key)\nreturn None\nexcept(APIKeyNotFoundError,APIKeyPermissionError)as e:\nraise e\nexcept PrismaError as e:\nlogger.error("
}