{
    "nodes": [
        {
            "id": "chunk_0_GlobalBlock_1",
            "code": "import pytest\n"
        },
        {
            "id": "chunk_0_GlobalBlock_2",
            "code": "from backend.data import db\n"
        },
        {
            "id": "chunk_0_GlobalBlock_3",
            "code": "from backend.executor import ExecutionScheduler\n"
        },
        {
            "id": "chunk_0_GlobalBlock_4",
            "code": "from backend.server.model import CreateGraph\n"
        },
        {
            "id": "chunk_0_GlobalBlock_5",
            "code": "from backend.usecases.sample import create_test_graph, create_test_user\n"
        },
        {
            "id": "chunk_0_GlobalBlock_6",
            "code": "from backend.util.service import get_service_client\n"
        },
        {
            "id": "chunk_0_GlobalBlock_7",
            "code": "from backend.util.test import SpinTestServer\n"
        },
        {
            "id": "chunk_0_GlobalBlock_8",
            "code": "@pytest.mark.asyncio(scope=\"session\")\n"
        },
        {
            "id": "chunk_1_test_agent_schedule_1",
            "code": "async def test_agent_schedule(server: SpinTestServer):\n"
        },
        {
            "id": "chunk_1_test_agent_schedule_2",
            "code": "    await db.connect()\n    test_user = await create_test_user()\n"
        },
        {
            "id": "chunk_1_test_agent_schedule_3",
            "code": "    test_graph = await server.agent_server.test_create_graph(\n        create_graph=CreateGraph(graph=create_test_graph()),\n        user_id=test_user.id,\n    )\n"
        },
        {
            "id": "chunk_1_test_agent_schedule_4",
            "code": "    scheduler = get_service_client(ExecutionScheduler)\n    schedules = scheduler.get_execution_schedules(test_graph.id, test_user.id)\n    assert len(schedules) == 0\n"
        },
        {
            "id": "chunk_1_test_agent_schedule_5",
            "code": "    schedule = scheduler.add_execution_schedule(\n        graph_id=test_graph.id,\n        user_id=test_user.id,\n        graph_version=1,\n        cron=\"0 0 * * *\",\n        input_data={\"input\": \"data\"},\n    )\n    assert schedule\n"
        },
        {
            "id": "chunk_1_test_agent_schedule_6",
            "code": "    schedules = scheduler.get_execution_schedules(test_graph.id, test_user.id)\n    assert len(schedules) == 1\n    assert schedules[0].cron == \"0 0 * * *\"\n"
        },
        {
            "id": "chunk_1_test_agent_schedule_7",
            "code": "    scheduler.delete_schedule(schedule.id, user_id=test_user.id)\n    schedules = scheduler.get_execution_schedules(test_graph.id, user_id=test_user.id)\n    assert len(schedules) == 0\n"
        }
    ],
    "edges": [
        {
            "from": "chunk_0_GlobalBlock_1",
            "to": "chunk_0_GlobalBlock_2"
        },
        {
            "from": "chunk_0_GlobalBlock_2",
            "to": "chunk_0_GlobalBlock_3"
        },
        {
            "from": "chunk_0_GlobalBlock_3",
            "to": "chunk_0_GlobalBlock_4"
        },
        {
            "from": "chunk_0_GlobalBlock_4",
            "to": "chunk_0_GlobalBlock_5"
        },
        {
            "from": "chunk_0_GlobalBlock_5",
            "to": "chunk_0_GlobalBlock_6"
        },
        {
            "from": "chunk_0_GlobalBlock_6",
            "to": "chunk_0_GlobalBlock_7"
        },
        {
            "from": "chunk_0_GlobalBlock_7",
            "to": "chunk_0_GlobalBlock_8"
        },
        {
            "from": "chunk_1_test_agent_schedule_1",
            "to": "chunk_1_test_agent_schedule_2"
        },
        {
            "from": "chunk_1_test_agent_schedule_2",
            "to": "chunk_1_test_agent_schedule_3"
        },
        {
            "from": "chunk_1_test_agent_schedule_3",
            "to": "chunk_1_test_agent_schedule_4"
        },
        {
            "from": "chunk_1_test_agent_schedule_4",
            "to": "chunk_1_test_agent_schedule_5"
        },
        {
            "from": "chunk_1_test_agent_schedule_5",
            "to": "chunk_1_test_agent_schedule_6"
        },
        {
            "from": "chunk_1_test_agent_schedule_6",
            "to": "chunk_1_test_agent_schedule_7"
        }
    ]
}