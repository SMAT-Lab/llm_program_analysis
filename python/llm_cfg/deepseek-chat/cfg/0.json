{
    "nodes": [
        {
            "id": "chunk_0_GlobalBlock_1",
            "code": "from prisma.models import User\n"
        },
        {
            "id": "chunk_0_GlobalBlock_2",
            "code": "from backend.blocks.basic import AgentInputBlock, PrintToConsoleBlock\n"
        },
        {
            "id": "chunk_0_GlobalBlock_3",
            "code": "from backend.blocks.text import FillTextTemplateBlock\n"
        },
        {
            "id": "chunk_0_GlobalBlock_4",
            "code": "from backend.data import graph\n"
        },
        {
            "id": "chunk_0_GlobalBlock_5",
            "code": "from backend.data.graph import create_graph\n"
        },
        {
            "id": "chunk_0_GlobalBlock_6",
            "code": "from backend.data.user import get_or_create_user\n"
        },
        {
            "id": "chunk_0_GlobalBlock_7",
            "code": "from backend.util.test import SpinTestServer, wait_execution\n"
        },
        {
            "id": "chunk_1_create_test_user_1",
            "code": "async def create_test_user() -> User:\n"
        },
        {
            "id": "chunk_1_create_test_user_2",
            "code": "    test_user_data = {\n        \"sub\": \"ef3b97d7-1161-4eb4-92b2-10c24fb154c1\",\n        \"email\": \"testuser#example.com\",\n        \"name\": \"Test User\",\n    }\n"
        },
        {
            "id": "chunk_1_create_test_user_3",
            "code": "    user = await get_or_create_user(test_user_data)\n"
        },
        {
            "id": "chunk_1_create_test_user_4",
            "code": "    return user\n"
        },
        {
            "id": "chunk_2_create_test_graph_1",
            "code": "def create_test_graph() -> graph.Graph:\n    \"\"\"\n    InputBlock\n               \\\n                 ---- FillTextTemplateBlock ---- PrintToConsoleBlock\n               /\n    InputBlock\n    \"\"\"\n"
        },
        {
            "id": "chunk_2_create_test_graph_2",
            "code": "    nodes = [\n        graph.Node(\n            block_id=AgentInputBlock().id,\n            input_default={\"name\": \"input_1\"},\n        ),\n        graph.Node(\n            block_id=AgentInputBlock().id,\n            input_default={\"name\": \"input_2\"},\n        ),\n        graph.Node(\n            block_id=FillTextTemplateBlock().id,\n            input_default={\n                \"format\": \"{a}, {b}{c}\",\n                \"values_#_c\": \"!!!\",\n            },\n        ),\n        graph.Node(block_id=PrintToConsoleBlock().id),\n    ]\n"
        },
        {
            "id": "chunk_2_create_test_graph_3",
            "code": "    links = [\n        graph.Link(\n            source_id=nodes[0].id,\n            sink_id=nodes[2].id,\n            source_name=\"result\",\n            sink_name=\"values_#_a\",\n        ),\n        graph.Link(\n            source_id=nodes[1].id,\n            sink_id=nodes[2].id,\n            source_name=\"result\",\n            sink_name=\"values_#_b\",\n        ),\n        graph.Link(\n            source_id=nodes[2].id,\n            sink_id=nodes[3].id,\n            source_name=\"output\",\n            sink_name=\"text\",\n        ),\n    ]\n"
        },
        {
            "id": "chunk_2_create_test_graph_4",
            "code": "    return graph.Graph(\n        name=\"TestGraph\",\n        description=\"Test graph\",\n        nodes=nodes,\n        links=links,\n    )\n"
        },
        {
            "id": "chunk_3_sample_agent_1",
            "code": "async def sample_agent():\n    async with SpinTestServer() as server:\n"
        },
        {
            "id": "chunk_3_sample_agent_2",
            "code": "        test_user = await create_test_user()\n        test_graph = await create_graph(create_test_graph(), test_user.id)\n        input_data = {\"input_1\": \"Hello\", \"input_2\": \"World\"}\n"
        },
        {
            "id": "chunk_3_sample_agent_3",
            "code": "        response = await server.agent_server.test_execute_graph(\n            test_graph.id, input_data, test_user.id\n        )\n"
        },
        {
            "id": "chunk_3_sample_agent_4",
            "code": "        print(response)\n"
        },
        {
            "id": "chunk_3_sample_agent_5",
            "code": "        result = await wait_execution(test_user.id, test_graph.id, response[\"id\"], 10)\n        print(result)\n"
        },
        {
            "id": "chunk_4_GlobalBlock_1",
            "code": "if __name__ == \"__main__\":\n"
        },
        {
            "id": "chunk_4_GlobalBlock_2",
            "code": "    import asyncio\n\n    asyncio.run(sample_agent())\n"
        }
    ],
    "edges": [
        {
            "from": "chunk_0_GlobalBlock_1",
            "to": "chunk_0_GlobalBlock_2"
        },
        {
            "from": "chunk_0_GlobalBlock_2",
            "to": "chunk_0_GlobalBlock_3"
        },
        {
            "from": "chunk_0_GlobalBlock_3",
            "to": "chunk_0_GlobalBlock_4"
        },
        {
            "from": "chunk_0_GlobalBlock_4",
            "to": "chunk_0_GlobalBlock_5"
        },
        {
            "from": "chunk_0_GlobalBlock_5",
            "to": "chunk_0_GlobalBlock_6"
        },
        {
            "from": "chunk_0_GlobalBlock_6",
            "to": "chunk_0_GlobalBlock_7"
        },
        {
            "from": "chunk_1_create_test_user_1",
            "to": "chunk_1_create_test_user_2"
        },
        {
            "from": "chunk_1_create_test_user_2",
            "to": "chunk_1_create_test_user_3"
        },
        {
            "from": "chunk_1_create_test_user_3",
            "to": "chunk_1_create_test_user_4"
        },
        {
            "from": "chunk_2_create_test_graph_1",
            "to": "chunk_2_create_test_graph_2"
        },
        {
            "from": "chunk_2_create_test_graph_2",
            "to": "chunk_2_create_test_graph_3"
        },
        {
            "from": "chunk_2_create_test_graph_3",
            "to": "chunk_2_create_test_graph_4"
        },
        {
            "from": "chunk_3_sample_agent_1",
            "to": "chunk_3_sample_agent_2"
        },
        {
            "from": "chunk_3_sample_agent_2",
            "to": "chunk_3_sample_agent_3"
        },
        {
            "from": "chunk_3_sample_agent_3",
            "to": "chunk_3_sample_agent_4"
        },
        {
            "from": "chunk_3_sample_agent_4",
            "to": "chunk_3_sample_agent_5"
        },
        {
            "from": "chunk_4_GlobalBlock_1",
            "to": "chunk_4_GlobalBlock_2"
        }
    ]
}