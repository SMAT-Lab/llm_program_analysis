{
  "nodes": [
    {
      "id": "1",
      "type": "block",
      "statements": [
        "from backend.blocks.jina._auth import JinaCredentials, JinaCredentialsField, JinaCredentialsInput",
        "from backend.data.block import Block, BlockCategory, BlockOutput, BlockSchema",
        "from backend.data.model import SchemaField",
        "from backend.util.request import requests",
        "class JinaChunkingBlock(Block):\n\n    class Input(BlockSchema):\n        texts: list = SchemaField(description='List of texts to chunk')\n        credentials: JinaCredentialsInput = JinaCredentialsField()\n        max_chunk_length: int = SchemaField(description='Maximum length of each chunk', default=1000)\n        return_tokens: bool = SchemaField(description='Whether to return token information', default=False)\n\n    class Output(BlockSchema):\n        chunks: list = SchemaField(description='List of chunked texts')\n        tokens: list = SchemaField(description='List of token information for each chunk', optional=True)\n\n    def __init__(self):\n        super().__init__(id='806fb15e-830f-4796-8692-557d300ff43c', description=\"Chunks texts using Jina AI's segmentation service\", categories={BlockCategory.AI, BlockCategory.TEXT}, input_schema=JinaChunkingBlock.Input, output_schema=JinaChunkingBlock.Output)\n\n    def run(self, input_data: Input, *, credentials: JinaCredentials, **kwargs) -> BlockOutput:\n        url = 'https://segment.jina.ai/'\n        headers = {'Content-Type': 'application/json', 'Authorization': f'Bearer {credentials.api_key.get_secret_value()}'}\n        all_chunks = []\n        all_tokens = []\n        for text in input_data.texts:\n            data = {'content': text, 'return_tokens': str(input_data.return_tokens).lower(), 'return_chunks': 'true', 'max_chunk_length': str(input_data.max_chunk_length)}\n            response = requests.post(url, headers=headers, json=data)\n            result = response.json()\n            all_chunks.extend(result.get('chunks', []))\n            if input_data.return_tokens:\n                all_tokens.extend(result.get('tokens', []))\n        yield ('chunks', all_chunks)\n        if input_data.return_tokens:\n            yield ('tokens', all_tokens)",
        "class Input(BlockSchema):\n    texts: list = SchemaField(description='List of texts to chunk')\n    credentials: JinaCredentialsInput = JinaCredentialsField()\n    max_chunk_length: int = SchemaField(description='Maximum length of each chunk', default=1000)\n    return_tokens: bool = SchemaField(description='Whether to return token information', default=False)",
        "texts: list = SchemaField(description='List of texts to chunk')",
        "credentials: JinaCredentialsInput = JinaCredentialsField()",
        "max_chunk_length: int = SchemaField(description='Maximum length of each chunk', default=1000)",
        "return_tokens: bool = SchemaField(description='Whether to return token information', default=False)",
        "class Output(BlockSchema):\n    chunks: list = SchemaField(description='List of chunked texts')\n    tokens: list = SchemaField(description='List of token information for each chunk', optional=True)",
        "chunks: list = SchemaField(description='List of chunked texts')",
        "tokens: list = SchemaField(description='List of token information for each chunk', optional=True)",
        "def __init__(self):\n    super().__init__(id='806fb15e-830f-4796-8692-557d300ff43c', description=\"Chunks texts using Jina AI's segmentation service\", categories={BlockCategory.AI, BlockCategory.TEXT}, input_schema=JinaChunkingBlock.Input, output_schema=JinaChunkingBlock.Output)",
        "super().__init__()",
        "def run(self, input_data: Input, *, credentials: JinaCredentials, **kwargs) -> BlockOutput:\n    url = 'https://segment.jina.ai/'\n    headers = {'Content-Type': 'application/json', 'Authorization': f'Bearer {credentials.api_key.get_secret_value()}'}\n    all_chunks = []\n    all_tokens = []\n    for text in input_data.texts:\n        data = {'content': text, 'return_tokens': str(input_data.return_tokens).lower(), 'return_chunks': 'true', 'max_chunk_length': str(input_data.max_chunk_length)}\n        response = requests.post(url, headers=headers, json=data)\n        result = response.json()\n        all_chunks.extend(result.get('chunks', []))\n        if input_data.return_tokens:\n            all_tokens.extend(result.get('tokens', []))\n    yield ('chunks', all_chunks)\n    if input_data.return_tokens:\n        yield ('tokens', all_tokens)",
        "url = 'https://segment.jina.ai/'",
        "headers = {'Content-Type': 'application/json', 'Authorization': f'Bearer {credentials.api_key.get_secret_value()}'}",
        "all_chunks = []",
        "all_tokens = []"
      ]
    },
    {
      "id": "2",
      "type": "block",
      "statements": [
        "text",
        "input_data.texts"
      ]
    },
    {
      "id": "3",
      "type": "block",
      "statements": [
        "data = {'content': text, 'return_tokens': str(input_data.return_tokens).lower(), 'return_chunks': 'true', 'max_chunk_length': str(input_data.max_chunk_length)}",
        "response = requests.post(url, headers=headers, json=data)",
        "result = response.json()",
        "all_chunks.extend(result.get('chunks', []))",
        "input_data.return_tokens"
      ]
    },
    {
      "id": "4",
      "type": "block",
      "statements": [
        "(yield ('chunks', all_chunks))",
        "input_data.return_tokens"
      ]
    },
    {
      "id": "5",
      "type": "block",
      "statements": [
        "all_tokens.extend(result.get('tokens', []))"
      ]
    },
    {
      "id": "6",
      "type": "block",
      "statements": []
    },
    {
      "id": "7",
      "type": "block",
      "statements": []
    },
    {
      "id": "8",
      "type": "block",
      "statements": [
        "(yield ('tokens', all_tokens))"
      ]
    },
    {
      "id": "9",
      "type": "block",
      "statements": []
    },
    {
      "id": "10",
      "type": "block",
      "statements": []
    }
  ],
  "edges": [
    {
      "source": "1",
      "target": "2",
      "type": "next"
    },
    {
      "source": "2",
      "target": "3",
      "type": "true"
    },
    {
      "source": "2",
      "target": "4",
      "type": "false"
    },
    {
      "source": "3",
      "target": "5",
      "type": "true"
    },
    {
      "source": "3",
      "target": "6",
      "type": "false"
    },
    {
      "source": "4",
      "target": "8",
      "type": "true"
    },
    {
      "source": "4",
      "target": "9",
      "type": "false"
    },
    {
      "source": "5",
      "target": "7",
      "type": "next"
    },
    {
      "source": "6",
      "target": "7",
      "type": "next"
    },
    {
      "source": "7",
      "target": "2",
      "type": "next"
    },
    {
      "source": "8",
      "target": "10",
      "type": "next"
    },
    {
      "source": "9",
      "target": "10",
      "type": "next"
    }
  ]
}