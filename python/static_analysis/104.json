{
  "nodes": [
    {
      "id": "n0",
      "type": "block",
      "statements": [
        "import datetime",
        "import typing",
        "import fuzzywuzzy.fuzz",
        "import prisma.enums",
        "import prisma.errors",
        "import prisma.models",
        "import prisma.types",
        "import pydantic",
        "import market.model",
        "import market.utils.extension_types",
        "class AgentQueryError(Exception):\n    \"\"\"Custom exception for agent query errors\"\"\"\n    pass",
        "'Custom exception for agent query errors'",
        "pass",
        "class TopAgentsDBResponse(pydantic.BaseModel):\n    \"\"\"\n    Represents a response containing a list of top agents.\n\n    Attributes:\n        analytics (list[AgentResponse]): The list of top agents.\n        total_count (int): The total count of agents.\n        page (int): The current page number.\n        page_size (int): The number of agents per page.\n        total_pages (int): The total number of pages.\n    \"\"\"\n    analytics: list[prisma.models.AnalyticsTracker]\n    total_count: int\n    page: int\n    page_size: int\n    total_pages: int",
        "'\\n    Represents a response containing a list of top agents.\\n\\n    Attributes:\\n        analytics (list[AgentResponse]): The list of top agents.\\n        total_count (int): The total count of agents.\\n        page (int): The current page number.\\n        page_size (int): The number of agents per page.\\n        total_pages (int): The total number of pages.\\n    '",
        "analytics: list[prisma.models.AnalyticsTracker]",
        "total_count: int",
        "page: int",
        "page_size: int",
        "total_pages: int",
        "class FeaturedAgentResponse(pydantic.BaseModel):\n    \"\"\"\n    Represents a response containing a list of featured agents.\n\n    Attributes:\n        featured_agents (list[FeaturedAgent]): The list of featured agents.\n        total_count (int): The total count of featured agents.\n        page (int): The current page number.\n        page_size (int): The number of agents per page.\n        total_pages (int): The total number of pages.\n    \"\"\"\n    featured_agents: list[prisma.models.FeaturedAgent]\n    total_count: int\n    page: int\n    page_size: int\n    total_pages: int",
        "'\\n    Represents a response containing a list of featured agents.\\n\\n    Attributes:\\n        featured_agents (list[FeaturedAgent]): The list of featured agents.\\n        total_count (int): The total count of featured agents.\\n        page (int): The current page number.\\n        page_size (int): The number of agents per page.\\n        total_pages (int): The total number of pages.\\n    '",
        "featured_agents: list[prisma.models.FeaturedAgent]",
        "total_count: int",
        "page: int",
        "page_size: int",
        "total_pages: int",
        "async def delete_agent(agent_id: str) -> prisma.models.Agents | None:\n    \"\"\"\n    Delete an agent from the database.\n\n    Args:\n        agent_id (str): The ID of the agent to delete.\n\n    Returns:\n        prisma.models.Agents | None: The deleted agent if found, None otherwise.\n\n    Raises:\n        AgentQueryError: If there is an error deleting the agent from the database.\n    \"\"\"\n    try:\n        deleted_agent = await prisma.models.Agents.prisma().delete(where={'id': agent_id})\n        return deleted_agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "'\\n    Delete an agent from the database.\\n\\n    Args:\\n        agent_id (str): The ID of the agent to delete.\\n\\n    Returns:\\n        prisma.models.Agents | None: The deleted agent if found, None otherwise.\\n\\n    Raises:\\n        AgentQueryError: If there is an error deleting the agent from the database.\\n    '",
        "try:\n    deleted_agent = await prisma.models.Agents.prisma().delete(where={'id': agent_id})\n    return deleted_agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "deleted_agent = await prisma.models.Agents.prisma().delete(where={'id': agent_id})",
        "return deleted_agent"
      ],
      "code": "import datetime\nimport typing\nimport fuzzywuzzy.fuzz\nimport prisma.enums\nimport prisma.errors\nimport prisma.models\nimport prisma.types\nimport pydantic\nimport market.model\nimport market.utils.extension_types\nclass AgentQueryError(Exception):\n    \"\"\"Custom exception for agent query errors\"\"\"\n    pass\n'Custom exception for agent query errors'\npass\nclass TopAgentsDBResponse(pydantic.BaseModel):\n    \"\"\"\n    Represents a response containing a list of top agents.\n\n    Attributes:\n        analytics (list[AgentResponse]): The list of top agents.\n        total_count (int): The total count of agents.\n        page (int): The current page number.\n        page_size (int): The number of agents per page.\n        total_pages (int): The total number of pages.\n    \"\"\"\n    analytics: list[prisma.models.AnalyticsTracker]\n    total_count: int\n    page: int\n    page_size: int\n    total_pages: int\n'\\n    Represents a response containing a list of top agents.\\n\\n    Attributes:\\n        analytics (list[AgentResponse]): The list of top agents.\\n        total_count (int): The total count of agents.\\n        page (int): The current page number.\\n        page_size (int): The number of agents per page.\\n        total_pages (int): The total number of pages.\\n    '\nanalytics: list[prisma.models.AnalyticsTracker]\ntotal_count: int\npage: int\npage_size: int\ntotal_pages: int\nclass FeaturedAgentResponse(pydantic.BaseModel):\n    \"\"\"\n    Represents a response containing a list of featured agents.\n\n    Attributes:\n        featured_agents (list[FeaturedAgent]): The list of featured agents.\n        total_count (int): The total count of featured agents.\n        page (int): The current page number.\n        page_size (int): The number of agents per page.\n        total_pages (int): The total number of pages.\n    \"\"\"\n    featured_agents: list[prisma.models.FeaturedAgent]\n    total_count: int\n    page: int\n    page_size: int\n    total_pages: int\n'\\n    Represents a response containing a list of featured agents.\\n\\n    Attributes:\\n        featured_agents (list[FeaturedAgent]): The list of featured agents.\\n        total_count (int): The total count of featured agents.\\n        page (int): The current page number.\\n        page_size (int): The number of agents per page.\\n        total_pages (int): The total number of pages.\\n    '\nfeatured_agents: list[prisma.models.FeaturedAgent]\ntotal_count: int\npage: int\npage_size: int\ntotal_pages: int\nasync def delete_agent(agent_id: str) -> prisma.models.Agents | None:\n    \"\"\"\n    Delete an agent from the database.\n\n    Args:\n        agent_id (str): The ID of the agent to delete.\n\n    Returns:\n        prisma.models.Agents | None: The deleted agent if found, None otherwise.\n\n    Raises:\n        AgentQueryError: If there is an error deleting the agent from the database.\n    \"\"\"\n    try:\n        deleted_agent = await prisma.models.Agents.prisma().delete(where={'id': agent_id})\n        return deleted_agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n'\\n    Delete an agent from the database.\\n\\n    Args:\\n        agent_id (str): The ID of the agent to delete.\\n\\n    Returns:\\n        prisma.models.Agents | None: The deleted agent if found, None otherwise.\\n\\n    Raises:\\n        AgentQueryError: If there is an error deleting the agent from the database.\\n    '\ntry:\n    deleted_agent = await prisma.models.Agents.prisma().delete(where={'id': agent_id})\n    return deleted_agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\ndeleted_agent = await prisma.models.Agents.prisma().delete(where={'id': agent_id})\nreturn deleted_agent"
    },
    {
      "id": "n1",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def create_agent_entry(name: str, description: str, author: str, keywords: typing.List[str], categories: typing.List[str], graph: prisma.Json, submission_state: prisma.enums.SubmissionStatus=prisma.enums.SubmissionStatus.PENDING):\n    \"\"\"\n    Create a new agent entry in the database.\n\n    Args:\n        name (str): The name of the agent.\n        description (str): The description of the agent.\n        author (str): The author of the agent.\n        keywords (List[str]): The keywords associated with the agent.\n        categories (List[str]): The categories associated with the agent.\n        graph (dict): The graph data of the agent.\n\n    Returns:\n        dict: The newly created agent entry.\n\n    Raises:\n        AgentQueryError: If there is an error creating the agent entry.\n    \"\"\"\n    try:\n        agent = await prisma.models.Agents.prisma().create(data={'name': name, 'description': description, 'author': author, 'keywords': keywords, 'categories': categories, 'graph': graph, 'AnalyticsTracker': {'create': {'downloads': 0, 'views': 0}}, 'submissionStatus': submission_state})\n        return agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "'\\n    Create a new agent entry in the database.\\n\\n    Args:\\n        name (str): The name of the agent.\\n        description (str): The description of the agent.\\n        author (str): The author of the agent.\\n        keywords (List[str]): The keywords associated with the agent.\\n        categories (List[str]): The categories associated with the agent.\\n        graph (dict): The graph data of the agent.\\n\\n    Returns:\\n        dict: The newly created agent entry.\\n\\n    Raises:\\n        AgentQueryError: If there is an error creating the agent entry.\\n    '",
        "try:\n    agent = await prisma.models.Agents.prisma().create(data={'name': name, 'description': description, 'author': author, 'keywords': keywords, 'categories': categories, 'graph': graph, 'AnalyticsTracker': {'create': {'downloads': 0, 'views': 0}}, 'submissionStatus': submission_state})\n    return agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "agent = await prisma.models.Agents.prisma().create(data={'name': name, 'description': description, 'author': author, 'keywords': keywords, 'categories': categories, 'graph': graph, 'AnalyticsTracker': {'create': {'downloads': 0, 'views': 0}}, 'submissionStatus': submission_state})",
        "return agent"
      ],
      "code": "raise AgentQueryError(f'Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def create_agent_entry(name: str, description: str, author: str, keywords: typing.List[str], categories: typing.List[str], graph: prisma.Json, submission_state: prisma.enums.SubmissionStatus=prisma.enums.SubmissionStatus.PENDING):\n    \"\"\"\n    Create a new agent entry in the database.\n\n    Args:\n        name (str): The name of the agent.\n        description (str): The description of the agent.\n        author (str): The author of the agent.\n        keywords (List[str]): The keywords associated with the agent.\n        categories (List[str]): The categories associated with the agent.\n        graph (dict): The graph data of the agent.\n\n    Returns:\n        dict: The newly created agent entry.\n\n    Raises:\n        AgentQueryError: If there is an error creating the agent entry.\n    \"\"\"\n    try:\n        agent = await prisma.models.Agents.prisma().create(data={'name': name, 'description': description, 'author': author, 'keywords': keywords, 'categories': categories, 'graph': graph, 'AnalyticsTracker': {'create': {'downloads': 0, 'views': 0}}, 'submissionStatus': submission_state})\n        return agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n'\\n    Create a new agent entry in the database.\\n\\n    Args:\\n        name (str): The name of the agent.\\n        description (str): The description of the agent.\\n        author (str): The author of the agent.\\n        keywords (List[str]): The keywords associated with the agent.\\n        categories (List[str]): The categories associated with the agent.\\n        graph (dict): The graph data of the agent.\\n\\n    Returns:\\n        dict: The newly created agent entry.\\n\\n    Raises:\\n        AgentQueryError: If there is an error creating the agent entry.\\n    '\ntry:\n    agent = await prisma.models.Agents.prisma().create(data={'name': name, 'description': description, 'author': author, 'keywords': keywords, 'categories': categories, 'graph': graph, 'AnalyticsTracker': {'create': {'downloads': 0, 'views': 0}}, 'submissionStatus': submission_state})\n    return agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nagent = await prisma.models.Agents.prisma().create(data={'name': name, 'description': description, 'author': author, 'keywords': keywords, 'categories': categories, 'graph': graph, 'AnalyticsTracker': {'create': {'downloads': 0, 'views': 0}}, 'submissionStatus': submission_state})\nreturn agent"
    },
    {
      "id": "n2",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def update_agent_entry(agent_id: str, version: int, submission_state: prisma.enums.SubmissionStatus, comments: str | None=None) -> prisma.models.Agents | None:\n    \"\"\"\n    Update an existing agent entry in the database.\n\n    Args:\n        agent_id (str): The ID of the agent.\n        version (int): The version of the agent.\n        submission_state (prisma.enums.SubmissionStatus): The submission state of the agent.\n    \"\"\"\n    try:\n        agent = await prisma.models.Agents.prisma().update(where={'id': agent_id}, data={'version': version, 'submissionStatus': submission_state, 'submissionReviewDate': datetime.datetime.now(datetime.timezone.utc), 'submissionReviewComments': comments})\n        return agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Agent Update Failed Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "'\\n    Update an existing agent entry in the database.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n        version (int): The version of the agent.\\n        submission_state (prisma.enums.SubmissionStatus): The submission state of the agent.\\n    '",
        "try:\n    agent = await prisma.models.Agents.prisma().update(where={'id': agent_id}, data={'version': version, 'submissionStatus': submission_state, 'submissionReviewDate': datetime.datetime.now(datetime.timezone.utc), 'submissionReviewComments': comments})\n    return agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Agent Update Failed Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "agent = await prisma.models.Agents.prisma().update(where={'id': agent_id}, data={'version': version, 'submissionStatus': submission_state, 'submissionReviewDate': datetime.datetime.now(datetime.timezone.utc), 'submissionReviewComments': comments})",
        "return agent"
      ],
      "code": "raise AgentQueryError(f'Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def update_agent_entry(agent_id: str, version: int, submission_state: prisma.enums.SubmissionStatus, comments: str | None=None) -> prisma.models.Agents | None:\n    \"\"\"\n    Update an existing agent entry in the database.\n\n    Args:\n        agent_id (str): The ID of the agent.\n        version (int): The version of the agent.\n        submission_state (prisma.enums.SubmissionStatus): The submission state of the agent.\n    \"\"\"\n    try:\n        agent = await prisma.models.Agents.prisma().update(where={'id': agent_id}, data={'version': version, 'submissionStatus': submission_state, 'submissionReviewDate': datetime.datetime.now(datetime.timezone.utc), 'submissionReviewComments': comments})\n        return agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Agent Update Failed Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n'\\n    Update an existing agent entry in the database.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n        version (int): The version of the agent.\\n        submission_state (prisma.enums.SubmissionStatus): The submission state of the agent.\\n    '\ntry:\n    agent = await prisma.models.Agents.prisma().update(where={'id': agent_id}, data={'version': version, 'submissionStatus': submission_state, 'submissionReviewDate': datetime.datetime.now(datetime.timezone.utc), 'submissionReviewComments': comments})\n    return agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Agent Update Failed Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nagent = await prisma.models.Agents.prisma().update(where={'id': agent_id}, data={'version': version, 'submissionStatus': submission_state, 'submissionReviewDate': datetime.datetime.now(datetime.timezone.utc), 'submissionReviewComments': comments})\nreturn agent"
    },
    {
      "id": "n3",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Agent Update Failed Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def get_agents(page: int=1, page_size: int=10, name: str | None=None, keyword: str | None=None, category: str | None=None, description: str | None=None, description_threshold: int=60, submission_status: prisma.enums.SubmissionStatus=prisma.enums.SubmissionStatus.APPROVED, sort_by: str='createdAt', sort_order: typing.Literal['desc'] | typing.Literal['asc']='desc'):\n    \"\"\"\n    Retrieve a list of agents from the database based on the provided filters and pagination parameters.\n\n    Args:\n        page (int, optional): The page number to retrieve. Defaults to 1.\n        page_size (int, optional): The number of agents per page. Defaults to 10.\n        name (str, optional): Filter agents by name. Defaults to None.\n        keyword (str, optional): Filter agents by keyword. Defaults to None.\n        category (str, optional): Filter agents by category. Defaults to None.\n        description (str, optional): Filter agents by description. Defaults to None.\n        description_threshold (int, optional): The minimum fuzzy search threshold for the description. Defaults to 60.\n        sort_by (str, optional): The field to sort the agents by. Defaults to \"createdAt\".\n        sort_order (str, optional): The sort order (\"asc\" or \"desc\"). Defaults to \"desc\".\n\n    Returns:\n        dict: A dictionary containing the list of agents, total count, current page number, page size, and total number of pages.\n    \"\"\"\n    try:\n        query = {}\n        if name:\n            query['name'] = {'contains': name, 'mode': 'insensitive'}\n        if keyword:\n            query['keywords'] = {'has': keyword}\n        if category:\n            query['categories'] = {'has': category}\n        query['submissionStatus'] = submission_status\n        order = {sort_by: sort_order}\n        skip = (page - 1) * page_size\n        try:\n            agents = await prisma.models.Agents.prisma().find_many(where=query, order=order, skip=skip, take=page_size)\n        except prisma.errors.PrismaError as e:\n            raise AgentQueryError(f'Database query failed: {str(e)}')\n        if description:\n            try:\n                filtered_agents = []\n                for agent in agents:\n                    if agent.description and fuzzywuzzy.fuzz.partial_ratio(description.lower(), agent.description.lower()) >= description_threshold:\n                        filtered_agents.append(agent)\n                agents = filtered_agents\n            except AttributeError as e:\n                raise AgentQueryError(f'Error during fuzzy search: {str(e)}')\n        total_count = len(agents)\n        return {'agents': agents, 'total_count': total_count, 'page': page, 'page_size': page_size, 'total_pages': (total_count + page_size - 1) // page_size}\n    except AgentQueryError as e:\n        raise e\n    except ValueError as e:\n        raise AgentQueryError(f'Invalid input parameter: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "'\\n    Retrieve a list of agents from the database based on the provided filters and pagination parameters.\\n\\n    Args:\\n        page (int, optional): The page number to retrieve. Defaults to 1.\\n        page_size (int, optional): The number of agents per page. Defaults to 10.\\n        name (str, optional): Filter agents by name. Defaults to None.\\n        keyword (str, optional): Filter agents by keyword. Defaults to None.\\n        category (str, optional): Filter agents by category. Defaults to None.\\n        description (str, optional): Filter agents by description. Defaults to None.\\n        description_threshold (int, optional): The minimum fuzzy search threshold for the description. Defaults to 60.\\n        sort_by (str, optional): The field to sort the agents by. Defaults to \"createdAt\".\\n        sort_order (str, optional): The sort order (\"asc\" or \"desc\"). Defaults to \"desc\".\\n\\n    Returns:\\n        dict: A dictionary containing the list of agents, total count, current page number, page size, and total number of pages.\\n    '",
        "try:\n    query = {}\n    if name:\n        query['name'] = {'contains': name, 'mode': 'insensitive'}\n    if keyword:\n        query['keywords'] = {'has': keyword}\n    if category:\n        query['categories'] = {'has': category}\n    query['submissionStatus'] = submission_status\n    order = {sort_by: sort_order}\n    skip = (page - 1) * page_size\n    try:\n        agents = await prisma.models.Agents.prisma().find_many(where=query, order=order, skip=skip, take=page_size)\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    if description:\n        try:\n            filtered_agents = []\n            for agent in agents:\n                if agent.description and fuzzywuzzy.fuzz.partial_ratio(description.lower(), agent.description.lower()) >= description_threshold:\n                    filtered_agents.append(agent)\n            agents = filtered_agents\n        except AttributeError as e:\n            raise AgentQueryError(f'Error during fuzzy search: {str(e)}')\n    total_count = len(agents)\n    return {'agents': agents, 'total_count': total_count, 'page': page, 'page_size': page_size, 'total_pages': (total_count + page_size - 1) // page_size}\nexcept AgentQueryError as e:\n    raise e\nexcept ValueError as e:\n    raise AgentQueryError(f'Invalid input parameter: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "query = {}",
        "name"
      ],
      "code": "raise AgentQueryError(f'Agent Update Failed Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def get_agents(page: int=1, page_size: int=10, name: str | None=None, keyword: str | None=None, category: str | None=None, description: str | None=None, description_threshold: int=60, submission_status: prisma.enums.SubmissionStatus=prisma.enums.SubmissionStatus.APPROVED, sort_by: str='createdAt', sort_order: typing.Literal['desc'] | typing.Literal['asc']='desc'):\n    \"\"\"\n    Retrieve a list of agents from the database based on the provided filters and pagination parameters.\n\n    Args:\n        page (int, optional): The page number to retrieve. Defaults to 1.\n        page_size (int, optional): The number of agents per page. Defaults to 10.\n        name (str, optional): Filter agents by name. Defaults to None.\n        keyword (str, optional): Filter agents by keyword. Defaults to None.\n        category (str, optional): Filter agents by category. Defaults to None.\n        description (str, optional): Filter agents by description. Defaults to None.\n        description_threshold (int, optional): The minimum fuzzy search threshold for the description. Defaults to 60.\n        sort_by (str, optional): The field to sort the agents by. Defaults to \"createdAt\".\n        sort_order (str, optional): The sort order (\"asc\" or \"desc\"). Defaults to \"desc\".\n\n    Returns:\n        dict: A dictionary containing the list of agents, total count, current page number, page size, and total number of pages.\n    \"\"\"\n    try:\n        query = {}\n        if name:\n            query['name'] = {'contains': name, 'mode': 'insensitive'}\n        if keyword:\n            query['keywords'] = {'has': keyword}\n        if category:\n            query['categories'] = {'has': category}\n        query['submissionStatus'] = submission_status\n        order = {sort_by: sort_order}\n        skip = (page - 1) * page_size\n        try:\n            agents = await prisma.models.Agents.prisma().find_many(where=query, order=order, skip=skip, take=page_size)\n        except prisma.errors.PrismaError as e:\n            raise AgentQueryError(f'Database query failed: {str(e)}')\n        if description:\n            try:\n                filtered_agents = []\n                for agent in agents:\n                    if agent.description and fuzzywuzzy.fuzz.partial_ratio(description.lower(), agent.description.lower()) >= description_threshold:\n                        filtered_agents.append(agent)\n                agents = filtered_agents\n            except AttributeError as e:\n                raise AgentQueryError(f'Error during fuzzy search: {str(e)}')\n        total_count = len(agents)\n        return {'agents': agents, 'total_count': total_count, 'page': page, 'page_size': page_size, 'total_pages': (total_count + page_size - 1) // page_size}\n    except AgentQueryError as e:\n        raise e\n    except ValueError as e:\n        raise AgentQueryError(f'Invalid input parameter: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n'\\n    Retrieve a list of agents from the database based on the provided filters and pagination parameters.\\n\\n    Args:\\n        page (int, optional): The page number to retrieve. Defaults to 1.\\n        page_size (int, optional): The number of agents per page. Defaults to 10.\\n        name (str, optional): Filter agents by name. Defaults to None.\\n        keyword (str, optional): Filter agents by keyword. Defaults to None.\\n        category (str, optional): Filter agents by category. Defaults to None.\\n        description (str, optional): Filter agents by description. Defaults to None.\\n        description_threshold (int, optional): The minimum fuzzy search threshold for the description. Defaults to 60.\\n        sort_by (str, optional): The field to sort the agents by. Defaults to \"createdAt\".\\n        sort_order (str, optional): The sort order (\"asc\" or \"desc\"). Defaults to \"desc\".\\n\\n    Returns:\\n        dict: A dictionary containing the list of agents, total count, current page number, page size, and total number of pages.\\n    '\ntry:\n    query = {}\n    if name:\n        query['name'] = {'contains': name, 'mode': 'insensitive'}\n    if keyword:\n        query['keywords'] = {'has': keyword}\n    if category:\n        query['categories'] = {'has': category}\n    query['submissionStatus'] = submission_status\n    order = {sort_by: sort_order}\n    skip = (page - 1) * page_size\n    try:\n        agents = await prisma.models.Agents.prisma().find_many(where=query, order=order, skip=skip, take=page_size)\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    if description:\n        try:\n            filtered_agents = []\n            for agent in agents:\n                if agent.description and fuzzywuzzy.fuzz.partial_ratio(description.lower(), agent.description.lower()) >= description_threshold:\n                    filtered_agents.append(agent)\n            agents = filtered_agents\n        except AttributeError as e:\n            raise AgentQueryError(f'Error during fuzzy search: {str(e)}')\n    total_count = len(agents)\n    return {'agents': agents, 'total_count': total_count, 'page': page, 'page_size': page_size, 'total_pages': (total_count + page_size - 1) // page_size}\nexcept AgentQueryError as e:\n    raise e\nexcept ValueError as e:\n    raise AgentQueryError(f'Invalid input parameter: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nquery = {}\nname"
    },
    {
      "id": "n4",
      "type": "block",
      "statements": [
        "query['name'] = {'contains': name, 'mode': 'insensitive'}"
      ],
      "code": "query['name'] = {'contains': name, 'mode': 'insensitive'}"
    },
    {
      "id": "n5",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n6",
      "type": "block",
      "statements": [
        "keyword"
      ],
      "code": "keyword"
    },
    {
      "id": "n7",
      "type": "block",
      "statements": [
        "query['keywords'] = {'has': keyword}"
      ],
      "code": "query['keywords'] = {'has': keyword}"
    },
    {
      "id": "n8",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n9",
      "type": "block",
      "statements": [
        "category"
      ],
      "code": "category"
    },
    {
      "id": "n10",
      "type": "block",
      "statements": [
        "query['categories'] = {'has': category}"
      ],
      "code": "query['categories'] = {'has': category}"
    },
    {
      "id": "n11",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n12",
      "type": "block",
      "statements": [
        "query['submissionStatus'] = submission_status",
        "order = {sort_by: sort_order}",
        "skip = (page - 1) * page_size",
        "try:\n    agents = await prisma.models.Agents.prisma().find_many(where=query, order=order, skip=skip, take=page_size)\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')",
        "agents = await prisma.models.Agents.prisma().find_many(where=query, order=order, skip=skip, take=page_size)",
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "description"
      ],
      "code": "query['submissionStatus'] = submission_status\norder = {sort_by: sort_order}\nskip = (page - 1) * page_size\ntry:\n    agents = await prisma.models.Agents.prisma().find_many(where=query, order=order, skip=skip, take=page_size)\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nagents = await prisma.models.Agents.prisma().find_many(where=query, order=order, skip=skip, take=page_size)\nraise AgentQueryError(f'Database query failed: {str(e)}')\ndescription"
    },
    {
      "id": "n13",
      "type": "block",
      "statements": [
        "try:\n    filtered_agents = []\n    for agent in agents:\n        if agent.description and fuzzywuzzy.fuzz.partial_ratio(description.lower(), agent.description.lower()) >= description_threshold:\n            filtered_agents.append(agent)\n    agents = filtered_agents\nexcept AttributeError as e:\n    raise AgentQueryError(f'Error during fuzzy search: {str(e)}')",
        "filtered_agents = []"
      ],
      "code": "try:\n    filtered_agents = []\n    for agent in agents:\n        if agent.description and fuzzywuzzy.fuzz.partial_ratio(description.lower(), agent.description.lower()) >= description_threshold:\n            filtered_agents.append(agent)\n    agents = filtered_agents\nexcept AttributeError as e:\n    raise AgentQueryError(f'Error during fuzzy search: {str(e)}')\nfiltered_agents = []"
    },
    {
      "id": "n14",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n15",
      "type": "block",
      "statements": [
        "total_count = len(agents)",
        "return {'agents': agents, 'total_count': total_count, 'page': page, 'page_size': page_size, 'total_pages': (total_count + page_size - 1) // page_size}"
      ],
      "code": "total_count = len(agents)\nreturn {'agents': agents, 'total_count': total_count, 'page': page, 'page_size': page_size, 'total_pages': (total_count + page_size - 1) // page_size}"
    },
    {
      "id": "n16",
      "type": "block",
      "statements": [
        "agent",
        "agents"
      ],
      "code": "agent\nagents"
    },
    {
      "id": "n17",
      "type": "block",
      "statements": [
        "agent.description and fuzzywuzzy.fuzz.partial_ratio(description.lower(), agent.description.lower()) >= description_threshold"
      ],
      "code": "agent.description and fuzzywuzzy.fuzz.partial_ratio(description.lower(), agent.description.lower()) >= description_threshold"
    },
    {
      "id": "n18",
      "type": "block",
      "statements": [
        "agents = filtered_agents",
        "raise AgentQueryError(f'Error during fuzzy search: {str(e)}')"
      ],
      "code": "agents = filtered_agents\nraise AgentQueryError(f'Error during fuzzy search: {str(e)}')"
    },
    {
      "id": "n19",
      "type": "block",
      "statements": [
        "filtered_agents.append(agent)"
      ],
      "code": "filtered_agents.append(agent)"
    },
    {
      "id": "n20",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n21",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n22",
      "type": "block",
      "statements": [
        "raise e",
        "raise AgentQueryError(f'Invalid input parameter: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def get_agent_details(agent_id: str, version: int | None=None):\n    \"\"\"\n    Retrieve agent details from the database.\n\n    Args:\n        agent_id (str): The ID of the agent.\n        version (int | None, optional): The version of the agent. Defaults to None.\n\n    Returns:\n        dict: The agent details.\n\n    Raises:\n        AgentQueryError: If the agent is not found or if there is an error querying the database.\n    \"\"\"\n    try:\n        query = {'id': agent_id}\n        if version is not None:\n            query['version'] = version\n        agent = await prisma.models.Agents.prisma().find_first(where=query)\n        if not agent:\n            raise AgentQueryError('Agent not found')\n        return agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "'\\n    Retrieve agent details from the database.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n        version (int | None, optional): The version of the agent. Defaults to None.\\n\\n    Returns:\\n        dict: The agent details.\\n\\n    Raises:\\n        AgentQueryError: If the agent is not found or if there is an error querying the database.\\n    '",
        "try:\n    query = {'id': agent_id}\n    if version is not None:\n        query['version'] = version\n    agent = await prisma.models.Agents.prisma().find_first(where=query)\n    if not agent:\n        raise AgentQueryError('Agent not found')\n    return agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "query = {'id': agent_id}",
        "version IsNot None"
      ],
      "code": "raise e\nraise AgentQueryError(f'Invalid input parameter: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def get_agent_details(agent_id: str, version: int | None=None):\n    \"\"\"\n    Retrieve agent details from the database.\n\n    Args:\n        agent_id (str): The ID of the agent.\n        version (int | None, optional): The version of the agent. Defaults to None.\n\n    Returns:\n        dict: The agent details.\n\n    Raises:\n        AgentQueryError: If the agent is not found or if there is an error querying the database.\n    \"\"\"\n    try:\n        query = {'id': agent_id}\n        if version is not None:\n            query['version'] = version\n        agent = await prisma.models.Agents.prisma().find_first(where=query)\n        if not agent:\n            raise AgentQueryError('Agent not found')\n        return agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n'\\n    Retrieve agent details from the database.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n        version (int | None, optional): The version of the agent. Defaults to None.\\n\\n    Returns:\\n        dict: The agent details.\\n\\n    Raises:\\n        AgentQueryError: If the agent is not found or if there is an error querying the database.\\n    '\ntry:\n    query = {'id': agent_id}\n    if version is not None:\n        query['version'] = version\n    agent = await prisma.models.Agents.prisma().find_first(where=query)\n    if not agent:\n        raise AgentQueryError('Agent not found')\n    return agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nquery = {'id': agent_id}\nversion IsNot None"
    },
    {
      "id": "n23",
      "type": "block",
      "statements": [
        "query['version'] = version"
      ],
      "code": "query['version'] = version"
    },
    {
      "id": "n24",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n25",
      "type": "block",
      "statements": [
        "agent = await prisma.models.Agents.prisma().find_first(where=query)",
        "not agent"
      ],
      "code": "agent = await prisma.models.Agents.prisma().find_first(where=query)\nnot agent"
    },
    {
      "id": "n26",
      "type": "block",
      "statements": [
        "raise AgentQueryError('Agent not found')"
      ],
      "code": "raise AgentQueryError('Agent not found')"
    },
    {
      "id": "n27",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n28",
      "type": "block",
      "statements": [
        "return agent"
      ],
      "code": "return agent"
    },
    {
      "id": "n29",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def search_db(query: str, page: int=1, page_size: int=10, categories: typing.List[str] | None=None, description_threshold: int=60, sort_by: str='rank', sort_order: typing.Literal['desc'] | typing.Literal['asc']='desc', submission_status: prisma.enums.SubmissionStatus=prisma.enums.SubmissionStatus.APPROVED) -> market.model.ListResponse[market.utils.extension_types.AgentsWithRank]:\n    \"\"\"Perform a search for agents based on the provided query string.\n\n    Args:\n        query (str): the search string\n        page (int, optional): page for searching. Defaults to 1.\n        page_size (int, optional): the number of results to return. Defaults to 10.\n        categories (List[str] | None, optional): list of category filters. Defaults to None.\n        description_threshold (int, optional): number of characters to return. Defaults to 60.\n        sort_by (str, optional): sort by option. Defaults to \"rank\".\n        sort_order (\"asc\" | \"desc\", optional): the sort order. Defaults to \"desc\".\n\n    Raises:\n        AgentQueryError: Raises an error if the query fails.\n        AgentQueryError: Raises if an unexpected error occurs.\n\n    Returns:\n        List[AgentsWithRank]: List of agents matching the search criteria.\n    \"\"\"\n    try:\n        offset = (page - 1) * page_size\n        category_filter = '1=1'\n        if categories:\n            category_conditions = [f\"'{cat}' = ANY(categories)\" for cat in categories]\n            category_filter = 'AND (' + ' OR '.join(category_conditions) + ')'\n        if sort_by in ['createdAt', 'updatedAt']:\n            order_by_clause = f'\"{sort_by}\" {sort_order.upper()}, rank DESC'\n        elif sort_by == 'name':\n            order_by_clause = f'name {sort_order.upper()}, rank DESC'\n        else:\n            order_by_clause = 'rank DESC, \"createdAt\" DESC'\n        submission_status_filter = f\"\"\"\"submissionStatus\" = '{submission_status}'\"\"\"\n        sql_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT \\n            id, \\n            \"createdAt\", \\n            \"updatedAt\", \\n            version, \\n            name, \\n            LEFT(description, {description_threshold}) AS description, \\n            author, \\n            keywords, \\n            categories, \\n            graph,\\n            \"submissionStatus\",\\n            \"submissionDate\",\\n            CASE \\n                WHEN query.q::text = '' THEN 1.0\\n                ELSE COALESCE(ts_rank(CAST(search AS tsvector), query.q), 0.0)\\n            END AS rank\\n        FROM market.\"Agents\", query\\n        WHERE \\n            (query.q::text = '' OR search @@ query.q)\\n            AND {category_filter} \\n            AND {submission_status_filter}\\n        ORDER BY {order_by_clause}\\n        LIMIT {page_size}\\n        OFFSET {offset};\\n        \"\"\"\n        results = await prisma.client.get_client().query_raw(query=sql_query, model=market.utils.extension_types.AgentsWithRank)\n\n        class CountResponse(pydantic.BaseModel):\n            count: int\n        count_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT COUNT(*)\\n        FROM market.\"Agents\", query\\n        WHERE (search @@ query.q OR query.q = '') AND {category_filter} AND {submission_status_filter};\\n        \"\"\"\n        total_count = await prisma.client.get_client().query_first(query=count_query, model=CountResponse)\n        total_count = total_count.count if total_count else 0\n        return market.model.ListResponse(items=results, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "'Perform a search for agents based on the provided query string.\\n\\n    Args:\\n        query (str): the search string\\n        page (int, optional): page for searching. Defaults to 1.\\n        page_size (int, optional): the number of results to return. Defaults to 10.\\n        categories (List[str] | None, optional): list of category filters. Defaults to None.\\n        description_threshold (int, optional): number of characters to return. Defaults to 60.\\n        sort_by (str, optional): sort by option. Defaults to \"rank\".\\n        sort_order (\"asc\" | \"desc\", optional): the sort order. Defaults to \"desc\".\\n\\n    Raises:\\n        AgentQueryError: Raises an error if the query fails.\\n        AgentQueryError: Raises if an unexpected error occurs.\\n\\n    Returns:\\n        List[AgentsWithRank]: List of agents matching the search criteria.\\n    '",
        "try:\n    offset = (page - 1) * page_size\n    category_filter = '1=1'\n    if categories:\n        category_conditions = [f\"'{cat}' = ANY(categories)\" for cat in categories]\n        category_filter = 'AND (' + ' OR '.join(category_conditions) + ')'\n    if sort_by in ['createdAt', 'updatedAt']:\n        order_by_clause = f'\"{sort_by}\" {sort_order.upper()}, rank DESC'\n    elif sort_by == 'name':\n        order_by_clause = f'name {sort_order.upper()}, rank DESC'\n    else:\n        order_by_clause = 'rank DESC, \"createdAt\" DESC'\n    submission_status_filter = f\"\"\"\"submissionStatus\" = '{submission_status}'\"\"\"\n    sql_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT \\n            id, \\n            \"createdAt\", \\n            \"updatedAt\", \\n            version, \\n            name, \\n            LEFT(description, {description_threshold}) AS description, \\n            author, \\n            keywords, \\n            categories, \\n            graph,\\n            \"submissionStatus\",\\n            \"submissionDate\",\\n            CASE \\n                WHEN query.q::text = '' THEN 1.0\\n                ELSE COALESCE(ts_rank(CAST(search AS tsvector), query.q), 0.0)\\n            END AS rank\\n        FROM market.\"Agents\", query\\n        WHERE \\n            (query.q::text = '' OR search @@ query.q)\\n            AND {category_filter} \\n            AND {submission_status_filter}\\n        ORDER BY {order_by_clause}\\n        LIMIT {page_size}\\n        OFFSET {offset};\\n        \"\"\"\n    results = await prisma.client.get_client().query_raw(query=sql_query, model=market.utils.extension_types.AgentsWithRank)\n\n    class CountResponse(pydantic.BaseModel):\n        count: int\n    count_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT COUNT(*)\\n        FROM market.\"Agents\", query\\n        WHERE (search @@ query.q OR query.q = '') AND {category_filter} AND {submission_status_filter};\\n        \"\"\"\n    total_count = await prisma.client.get_client().query_first(query=count_query, model=CountResponse)\n    total_count = total_count.count if total_count else 0\n    return market.model.ListResponse(items=results, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "offset = (page - 1) * page_size",
        "category_filter = '1=1'",
        "categories"
      ],
      "code": "raise AgentQueryError(f'Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def search_db(query: str, page: int=1, page_size: int=10, categories: typing.List[str] | None=None, description_threshold: int=60, sort_by: str='rank', sort_order: typing.Literal['desc'] | typing.Literal['asc']='desc', submission_status: prisma.enums.SubmissionStatus=prisma.enums.SubmissionStatus.APPROVED) -> market.model.ListResponse[market.utils.extension_types.AgentsWithRank]:\n    \"\"\"Perform a search for agents based on the provided query string.\n\n    Args:\n        query (str): the search string\n        page (int, optional): page for searching. Defaults to 1.\n        page_size (int, optional): the number of results to return. Defaults to 10.\n        categories (List[str] | None, optional): list of category filters. Defaults to None.\n        description_threshold (int, optional): number of characters to return. Defaults to 60.\n        sort_by (str, optional): sort by option. Defaults to \"rank\".\n        sort_order (\"asc\" | \"desc\", optional): the sort order. Defaults to \"desc\".\n\n    Raises:\n        AgentQueryError: Raises an error if the query fails.\n        AgentQueryError: Raises if an unexpected error occurs.\n\n    Returns:\n        List[AgentsWithRank]: List of agents matching the search criteria.\n    \"\"\"\n    try:\n        offset = (page - 1) * page_size\n        category_filter = '1=1'\n        if categories:\n            category_conditions = [f\"'{cat}' = ANY(categories)\" for cat in categories]\n            category_filter = 'AND (' + ' OR '.join(category_conditions) + ')'\n        if sort_by in ['createdAt', 'updatedAt']:\n            order_by_clause = f'\"{sort_by}\" {sort_order.upper()}, rank DESC'\n        elif sort_by == 'name':\n            order_by_clause = f'name {sort_order.upper()}, rank DESC'\n        else:\n            order_by_clause = 'rank DESC, \"createdAt\" DESC'\n        submission_status_filter = f\"\"\"\"submissionStatus\" = '{submission_status}'\"\"\"\n        sql_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT \\n            id, \\n            \"createdAt\", \\n            \"updatedAt\", \\n            version, \\n            name, \\n            LEFT(description, {description_threshold}) AS description, \\n            author, \\n            keywords, \\n            categories, \\n            graph,\\n            \"submissionStatus\",\\n            \"submissionDate\",\\n            CASE \\n                WHEN query.q::text = '' THEN 1.0\\n                ELSE COALESCE(ts_rank(CAST(search AS tsvector), query.q), 0.0)\\n            END AS rank\\n        FROM market.\"Agents\", query\\n        WHERE \\n            (query.q::text = '' OR search @@ query.q)\\n            AND {category_filter} \\n            AND {submission_status_filter}\\n        ORDER BY {order_by_clause}\\n        LIMIT {page_size}\\n        OFFSET {offset};\\n        \"\"\"\n        results = await prisma.client.get_client().query_raw(query=sql_query, model=market.utils.extension_types.AgentsWithRank)\n\n        class CountResponse(pydantic.BaseModel):\n            count: int\n        count_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT COUNT(*)\\n        FROM market.\"Agents\", query\\n        WHERE (search @@ query.q OR query.q = '') AND {category_filter} AND {submission_status_filter};\\n        \"\"\"\n        total_count = await prisma.client.get_client().query_first(query=count_query, model=CountResponse)\n        total_count = total_count.count if total_count else 0\n        return market.model.ListResponse(items=results, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n'Perform a search for agents based on the provided query string.\\n\\n    Args:\\n        query (str): the search string\\n        page (int, optional): page for searching. Defaults to 1.\\n        page_size (int, optional): the number of results to return. Defaults to 10.\\n        categories (List[str] | None, optional): list of category filters. Defaults to None.\\n        description_threshold (int, optional): number of characters to return. Defaults to 60.\\n        sort_by (str, optional): sort by option. Defaults to \"rank\".\\n        sort_order (\"asc\" | \"desc\", optional): the sort order. Defaults to \"desc\".\\n\\n    Raises:\\n        AgentQueryError: Raises an error if the query fails.\\n        AgentQueryError: Raises if an unexpected error occurs.\\n\\n    Returns:\\n        List[AgentsWithRank]: List of agents matching the search criteria.\\n    '\ntry:\n    offset = (page - 1) * page_size\n    category_filter = '1=1'\n    if categories:\n        category_conditions = [f\"'{cat}' = ANY(categories)\" for cat in categories]\n        category_filter = 'AND (' + ' OR '.join(category_conditions) + ')'\n    if sort_by in ['createdAt', 'updatedAt']:\n        order_by_clause = f'\"{sort_by}\" {sort_order.upper()}, rank DESC'\n    elif sort_by == 'name':\n        order_by_clause = f'name {sort_order.upper()}, rank DESC'\n    else:\n        order_by_clause = 'rank DESC, \"createdAt\" DESC'\n    submission_status_filter = f\"\"\"\"submissionStatus\" = '{submission_status}'\"\"\"\n    sql_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT \\n            id, \\n            \"createdAt\", \\n            \"updatedAt\", \\n            version, \\n            name, \\n            LEFT(description, {description_threshold}) AS description, \\n            author, \\n            keywords, \\n            categories, \\n            graph,\\n            \"submissionStatus\",\\n            \"submissionDate\",\\n            CASE \\n                WHEN query.q::text = '' THEN 1.0\\n                ELSE COALESCE(ts_rank(CAST(search AS tsvector), query.q), 0.0)\\n            END AS rank\\n        FROM market.\"Agents\", query\\n        WHERE \\n            (query.q::text = '' OR search @@ query.q)\\n            AND {category_filter} \\n            AND {submission_status_filter}\\n        ORDER BY {order_by_clause}\\n        LIMIT {page_size}\\n        OFFSET {offset};\\n        \"\"\"\n    results = await prisma.client.get_client().query_raw(query=sql_query, model=market.utils.extension_types.AgentsWithRank)\n\n    class CountResponse(pydantic.BaseModel):\n        count: int\n    count_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT COUNT(*)\\n        FROM market.\"Agents\", query\\n        WHERE (search @@ query.q OR query.q = '') AND {category_filter} AND {submission_status_filter};\\n        \"\"\"\n    total_count = await prisma.client.get_client().query_first(query=count_query, model=CountResponse)\n    total_count = total_count.count if total_count else 0\n    return market.model.ListResponse(items=results, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\noffset = (page - 1) * page_size\ncategory_filter = '1=1'\ncategories"
    },
    {
      "id": "n30",
      "type": "block",
      "statements": [
        "category_conditions = [f\"'{cat}' = ANY(categories)\" for cat in categories]",
        "category_filter = 'AND (' + ' OR '.join(category_conditions) + ')'"
      ],
      "code": "category_conditions = [f\"'{cat}' = ANY(categories)\" for cat in categories]\ncategory_filter = 'AND (' + ' OR '.join(category_conditions) + ')'"
    },
    {
      "id": "n31",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n32",
      "type": "block",
      "statements": [
        "sort_by In ['createdAt', 'updatedAt']"
      ],
      "code": "sort_by In ['createdAt', 'updatedAt']"
    },
    {
      "id": "n33",
      "type": "block",
      "statements": [
        "order_by_clause = f'\"{sort_by}\" {sort_order.upper()}, rank DESC'"
      ],
      "code": "order_by_clause = f'\"{sort_by}\" {sort_order.upper()}, rank DESC'"
    },
    {
      "id": "n34",
      "type": "block",
      "statements": [
        "sort_by Eq 'name'"
      ],
      "code": "sort_by Eq 'name'"
    },
    {
      "id": "n35",
      "type": "block",
      "statements": [
        "submission_status_filter = f\"\"\"\"submissionStatus\" = '{submission_status}'\"\"\"",
        "sql_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT \\n            id, \\n            \"createdAt\", \\n            \"updatedAt\", \\n            version, \\n            name, \\n            LEFT(description, {description_threshold}) AS description, \\n            author, \\n            keywords, \\n            categories, \\n            graph,\\n            \"submissionStatus\",\\n            \"submissionDate\",\\n            CASE \\n                WHEN query.q::text = '' THEN 1.0\\n                ELSE COALESCE(ts_rank(CAST(search AS tsvector), query.q), 0.0)\\n            END AS rank\\n        FROM market.\"Agents\", query\\n        WHERE \\n            (query.q::text = '' OR search @@ query.q)\\n            AND {category_filter} \\n            AND {submission_status_filter}\\n        ORDER BY {order_by_clause}\\n        LIMIT {page_size}\\n        OFFSET {offset};\\n        \"\"\"",
        "results = await prisma.client.get_client().query_raw(query=sql_query, model=market.utils.extension_types.AgentsWithRank)",
        "class CountResponse(pydantic.BaseModel):\n    count: int",
        "count: int",
        "count_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT COUNT(*)\\n        FROM market.\"Agents\", query\\n        WHERE (search @@ query.q OR query.q = '') AND {category_filter} AND {submission_status_filter};\\n        \"\"\"",
        "total_count = await prisma.client.get_client().query_first(query=count_query, model=CountResponse)",
        "total_count = total_count.count if total_count else 0",
        "return market.model.ListResponse(items=results, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)"
      ],
      "code": "submission_status_filter = f\"\"\"\"submissionStatus\" = '{submission_status}'\"\"\"\nsql_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT \\n            id, \\n            \"createdAt\", \\n            \"updatedAt\", \\n            version, \\n            name, \\n            LEFT(description, {description_threshold}) AS description, \\n            author, \\n            keywords, \\n            categories, \\n            graph,\\n            \"submissionStatus\",\\n            \"submissionDate\",\\n            CASE \\n                WHEN query.q::text = '' THEN 1.0\\n                ELSE COALESCE(ts_rank(CAST(search AS tsvector), query.q), 0.0)\\n            END AS rank\\n        FROM market.\"Agents\", query\\n        WHERE \\n            (query.q::text = '' OR search @@ query.q)\\n            AND {category_filter} \\n            AND {submission_status_filter}\\n        ORDER BY {order_by_clause}\\n        LIMIT {page_size}\\n        OFFSET {offset};\\n        \"\"\"\nresults = await prisma.client.get_client().query_raw(query=sql_query, model=market.utils.extension_types.AgentsWithRank)\nclass CountResponse(pydantic.BaseModel):\n    count: int\ncount: int\ncount_query = f\"\"\"\\n        WITH query AS (\\n            SELECT to_tsquery(string_agg(lexeme || ':*', ' & ' ORDER BY positions)) AS q \\n            FROM unnest(to_tsvector('{query}'))\\n        )\\n        SELECT COUNT(*)\\n        FROM market.\"Agents\", query\\n        WHERE (search @@ query.q OR query.q = '') AND {category_filter} AND {submission_status_filter};\\n        \"\"\"\ntotal_count = await prisma.client.get_client().query_first(query=count_query, model=CountResponse)\ntotal_count = total_count.count if total_count else 0\nreturn market.model.ListResponse(items=results, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)"
    },
    {
      "id": "n36",
      "type": "block",
      "statements": [
        "order_by_clause = f'name {sort_order.upper()}, rank DESC'"
      ],
      "code": "order_by_clause = f'name {sort_order.upper()}, rank DESC'"
    },
    {
      "id": "n37",
      "type": "block",
      "statements": [
        "order_by_clause = 'rank DESC, \"createdAt\" DESC'"
      ],
      "code": "order_by_clause = 'rank DESC, \"createdAt\" DESC'"
    },
    {
      "id": "n38",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n39",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def get_top_agents_by_downloads(page: int=1, page_size: int=10, submission_status: prisma.enums.SubmissionStatus=prisma.enums.SubmissionStatus.APPROVED) -> market.model.ListResponse[prisma.models.AnalyticsTracker]:\n    \"\"\"Retrieve the top agents by download count.\n\n    Args:\n        page (int, optional): The page number. Defaults to 1.\n        page_size (int, optional): The number of agents per page. Defaults to 10.\n\n    Returns:\n        dict: A dictionary containing the list of agents, total count, current page number, page size, and total number of pages.\n    \"\"\"\n    try:\n        skip = (page - 1) * page_size\n        try:\n            analytics = await prisma.models.AnalyticsTracker.prisma().find_many(include={'agent': True}, order={'downloads': 'desc'}, where={'agent': {'is': {'submissionStatus': submission_status}}}, skip=skip, take=page_size)\n        except prisma.errors.PrismaError as e:\n            raise AgentQueryError(f'Database query failed: {str(e)}')\n        try:\n            total_count = await prisma.models.AnalyticsTracker.prisma().count(where={'agent': {'is': {'submissionStatus': submission_status}}})\n        except prisma.errors.PrismaError as e:\n            raise AgentQueryError(f'Database query failed: {str(e)}')\n        return market.model.ListResponse(items=analytics, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\n    except AgentQueryError as e:\n        raise e from e\n    except ValueError as e:\n        raise AgentQueryError(f'Invalid input parameter: {str(e)}') from e\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e",
        "'Retrieve the top agents by download count.\\n\\n    Args:\\n        page (int, optional): The page number. Defaults to 1.\\n        page_size (int, optional): The number of agents per page. Defaults to 10.\\n\\n    Returns:\\n        dict: A dictionary containing the list of agents, total count, current page number, page size, and total number of pages.\\n    '",
        "try:\n    skip = (page - 1) * page_size\n    try:\n        analytics = await prisma.models.AnalyticsTracker.prisma().find_many(include={'agent': True}, order={'downloads': 'desc'}, where={'agent': {'is': {'submissionStatus': submission_status}}}, skip=skip, take=page_size)\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    try:\n        total_count = await prisma.models.AnalyticsTracker.prisma().count(where={'agent': {'is': {'submissionStatus': submission_status}}})\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    return market.model.ListResponse(items=analytics, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\nexcept AgentQueryError as e:\n    raise e from e\nexcept ValueError as e:\n    raise AgentQueryError(f'Invalid input parameter: {str(e)}') from e\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e",
        "skip = (page - 1) * page_size",
        "try:\n    analytics = await prisma.models.AnalyticsTracker.prisma().find_many(include={'agent': True}, order={'downloads': 'desc'}, where={'agent': {'is': {'submissionStatus': submission_status}}}, skip=skip, take=page_size)\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')",
        "analytics = await prisma.models.AnalyticsTracker.prisma().find_many(include={'agent': True}, order={'downloads': 'desc'}, where={'agent': {'is': {'submissionStatus': submission_status}}}, skip=skip, take=page_size)",
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "try:\n    total_count = await prisma.models.AnalyticsTracker.prisma().count(where={'agent': {'is': {'submissionStatus': submission_status}}})\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')",
        "total_count = await prisma.models.AnalyticsTracker.prisma().count(where={'agent': {'is': {'submissionStatus': submission_status}}})",
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "return market.model.ListResponse(items=analytics, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)"
      ],
      "code": "raise AgentQueryError(f'Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def get_top_agents_by_downloads(page: int=1, page_size: int=10, submission_status: prisma.enums.SubmissionStatus=prisma.enums.SubmissionStatus.APPROVED) -> market.model.ListResponse[prisma.models.AnalyticsTracker]:\n    \"\"\"Retrieve the top agents by download count.\n\n    Args:\n        page (int, optional): The page number. Defaults to 1.\n        page_size (int, optional): The number of agents per page. Defaults to 10.\n\n    Returns:\n        dict: A dictionary containing the list of agents, total count, current page number, page size, and total number of pages.\n    \"\"\"\n    try:\n        skip = (page - 1) * page_size\n        try:\n            analytics = await prisma.models.AnalyticsTracker.prisma().find_many(include={'agent': True}, order={'downloads': 'desc'}, where={'agent': {'is': {'submissionStatus': submission_status}}}, skip=skip, take=page_size)\n        except prisma.errors.PrismaError as e:\n            raise AgentQueryError(f'Database query failed: {str(e)}')\n        try:\n            total_count = await prisma.models.AnalyticsTracker.prisma().count(where={'agent': {'is': {'submissionStatus': submission_status}}})\n        except prisma.errors.PrismaError as e:\n            raise AgentQueryError(f'Database query failed: {str(e)}')\n        return market.model.ListResponse(items=analytics, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\n    except AgentQueryError as e:\n        raise e from e\n    except ValueError as e:\n        raise AgentQueryError(f'Invalid input parameter: {str(e)}') from e\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e\n'Retrieve the top agents by download count.\\n\\n    Args:\\n        page (int, optional): The page number. Defaults to 1.\\n        page_size (int, optional): The number of agents per page. Defaults to 10.\\n\\n    Returns:\\n        dict: A dictionary containing the list of agents, total count, current page number, page size, and total number of pages.\\n    '\ntry:\n    skip = (page - 1) * page_size\n    try:\n        analytics = await prisma.models.AnalyticsTracker.prisma().find_many(include={'agent': True}, order={'downloads': 'desc'}, where={'agent': {'is': {'submissionStatus': submission_status}}}, skip=skip, take=page_size)\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    try:\n        total_count = await prisma.models.AnalyticsTracker.prisma().count(where={'agent': {'is': {'submissionStatus': submission_status}}})\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    return market.model.ListResponse(items=analytics, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\nexcept AgentQueryError as e:\n    raise e from e\nexcept ValueError as e:\n    raise AgentQueryError(f'Invalid input parameter: {str(e)}') from e\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e\nskip = (page - 1) * page_size\ntry:\n    analytics = await prisma.models.AnalyticsTracker.prisma().find_many(include={'agent': True}, order={'downloads': 'desc'}, where={'agent': {'is': {'submissionStatus': submission_status}}}, skip=skip, take=page_size)\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nanalytics = await prisma.models.AnalyticsTracker.prisma().find_many(include={'agent': True}, order={'downloads': 'desc'}, where={'agent': {'is': {'submissionStatus': submission_status}}}, skip=skip, take=page_size)\nraise AgentQueryError(f'Database query failed: {str(e)}')\ntry:\n    total_count = await prisma.models.AnalyticsTracker.prisma().count(where={'agent': {'is': {'submissionStatus': submission_status}}})\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\ntotal_count = await prisma.models.AnalyticsTracker.prisma().count(where={'agent': {'is': {'submissionStatus': submission_status}}})\nraise AgentQueryError(f'Database query failed: {str(e)}')\nreturn market.model.ListResponse(items=analytics, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)"
    },
    {
      "id": "n40",
      "type": "block",
      "statements": [
        "raise e from e",
        "raise AgentQueryError(f'Invalid input parameter: {str(e)}') from e",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e",
        "async def set_agent_featured(agent_id: str, is_active: bool=True, featured_categories: list[str]=['featured']) -> prisma.models.FeaturedAgent:\n    \"\"\"Set an agent as featured in the database.\n\n    Args:\n        agent_id (str): The ID of the agent.\n        category (str, optional): The category to set the agent as featured. Defaults to \"featured\".\n\n    Raises:\n        AgentQueryError: If there is an error setting the agent as featured.\n    \"\"\"\n    try:\n        agent = await prisma.models.Agents.prisma().find_unique(where={'id': agent_id})\n        if not agent:\n            raise AgentQueryError(f'Agent with ID {agent_id} not found.')\n        featured = await prisma.models.FeaturedAgent.prisma().upsert(where={'agentId': agent_id}, data={'update': {'featuredCategories': featured_categories, 'isActive': is_active}, 'create': {'featuredCategories': featured_categories, 'isActive': is_active, 'agent': {'connect': {'id': agent_id}}}})\n        return featured\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "'Set an agent as featured in the database.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n        category (str, optional): The category to set the agent as featured. Defaults to \"featured\".\\n\\n    Raises:\\n        AgentQueryError: If there is an error setting the agent as featured.\\n    '",
        "try:\n    agent = await prisma.models.Agents.prisma().find_unique(where={'id': agent_id})\n    if not agent:\n        raise AgentQueryError(f'Agent with ID {agent_id} not found.')\n    featured = await prisma.models.FeaturedAgent.prisma().upsert(where={'agentId': agent_id}, data={'update': {'featuredCategories': featured_categories, 'isActive': is_active}, 'create': {'featuredCategories': featured_categories, 'isActive': is_active, 'agent': {'connect': {'id': agent_id}}}})\n    return featured\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "agent = await prisma.models.Agents.prisma().find_unique(where={'id': agent_id})",
        "not agent"
      ],
      "code": "raise e from e\nraise AgentQueryError(f'Invalid input parameter: {str(e)}') from e\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e\nasync def set_agent_featured(agent_id: str, is_active: bool=True, featured_categories: list[str]=['featured']) -> prisma.models.FeaturedAgent:\n    \"\"\"Set an agent as featured in the database.\n\n    Args:\n        agent_id (str): The ID of the agent.\n        category (str, optional): The category to set the agent as featured. Defaults to \"featured\".\n\n    Raises:\n        AgentQueryError: If there is an error setting the agent as featured.\n    \"\"\"\n    try:\n        agent = await prisma.models.Agents.prisma().find_unique(where={'id': agent_id})\n        if not agent:\n            raise AgentQueryError(f'Agent with ID {agent_id} not found.')\n        featured = await prisma.models.FeaturedAgent.prisma().upsert(where={'agentId': agent_id}, data={'update': {'featuredCategories': featured_categories, 'isActive': is_active}, 'create': {'featuredCategories': featured_categories, 'isActive': is_active, 'agent': {'connect': {'id': agent_id}}}})\n        return featured\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n'Set an agent as featured in the database.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n        category (str, optional): The category to set the agent as featured. Defaults to \"featured\".\\n\\n    Raises:\\n        AgentQueryError: If there is an error setting the agent as featured.\\n    '\ntry:\n    agent = await prisma.models.Agents.prisma().find_unique(where={'id': agent_id})\n    if not agent:\n        raise AgentQueryError(f'Agent with ID {agent_id} not found.')\n    featured = await prisma.models.FeaturedAgent.prisma().upsert(where={'agentId': agent_id}, data={'update': {'featuredCategories': featured_categories, 'isActive': is_active}, 'create': {'featuredCategories': featured_categories, 'isActive': is_active, 'agent': {'connect': {'id': agent_id}}}})\n    return featured\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nagent = await prisma.models.Agents.prisma().find_unique(where={'id': agent_id})\nnot agent"
    },
    {
      "id": "n41",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Agent with ID {agent_id} not found.')"
      ],
      "code": "raise AgentQueryError(f'Agent with ID {agent_id} not found.')"
    },
    {
      "id": "n42",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n43",
      "type": "block",
      "statements": [
        "featured = await prisma.models.FeaturedAgent.prisma().upsert(where={'agentId': agent_id}, data={'update': {'featuredCategories': featured_categories, 'isActive': is_active}, 'create': {'featuredCategories': featured_categories, 'isActive': is_active, 'agent': {'connect': {'id': agent_id}}}})",
        "return featured"
      ],
      "code": "featured = await prisma.models.FeaturedAgent.prisma().upsert(where={'agentId': agent_id}, data={'update': {'featuredCategories': featured_categories, 'isActive': is_active}, 'create': {'featuredCategories': featured_categories, 'isActive': is_active, 'agent': {'connect': {'id': agent_id}}}})\nreturn featured"
    },
    {
      "id": "n44",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def get_featured_agents(category: str='featured', page: int=1, page_size: int=10, submission_status: prisma.enums.SubmissionStatus=prisma.enums.SubmissionStatus.APPROVED) -> FeaturedAgentResponse:\n    \"\"\"Retrieve a list of featured agents from the database based on the provided category.\n\n    Args:\n        category (str, optional): The category of featured agents to retrieve. Defaults to \"featured\".\n        page (int, optional): The page number to retrieve. Defaults to 1.\n        page_size (int, optional): The number of agents per page. Defaults to 10.\n\n    Returns:\n        dict: A dictionary containing the list of featured agents, total count, current page number, page size, and total number of pages.\n    \"\"\"\n    try:\n        skip = (page - 1) * page_size\n        try:\n            featured_agents = await prisma.models.FeaturedAgent.prisma().find_many(where={'featuredCategories': {'has': category}, 'isActive': True, 'agent': {'is': {'submissionStatus': submission_status}}}, include={'agent': {'include': {'AnalyticsTracker': True}}}, skip=skip, take=page_size)\n        except prisma.errors.PrismaError as e:\n            raise AgentQueryError(f'Database query failed: {str(e)}')\n        total_count = len(featured_agents)\n        return FeaturedAgentResponse(featured_agents=featured_agents, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\n    except AgentQueryError as e:\n        raise e from e\n    except ValueError as e:\n        raise AgentQueryError(f'Invalid input parameter: {str(e)}') from e\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e",
        "'Retrieve a list of featured agents from the database based on the provided category.\\n\\n    Args:\\n        category (str, optional): The category of featured agents to retrieve. Defaults to \"featured\".\\n        page (int, optional): The page number to retrieve. Defaults to 1.\\n        page_size (int, optional): The number of agents per page. Defaults to 10.\\n\\n    Returns:\\n        dict: A dictionary containing the list of featured agents, total count, current page number, page size, and total number of pages.\\n    '",
        "try:\n    skip = (page - 1) * page_size\n    try:\n        featured_agents = await prisma.models.FeaturedAgent.prisma().find_many(where={'featuredCategories': {'has': category}, 'isActive': True, 'agent': {'is': {'submissionStatus': submission_status}}}, include={'agent': {'include': {'AnalyticsTracker': True}}}, skip=skip, take=page_size)\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    total_count = len(featured_agents)\n    return FeaturedAgentResponse(featured_agents=featured_agents, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\nexcept AgentQueryError as e:\n    raise e from e\nexcept ValueError as e:\n    raise AgentQueryError(f'Invalid input parameter: {str(e)}') from e\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e",
        "skip = (page - 1) * page_size",
        "try:\n    featured_agents = await prisma.models.FeaturedAgent.prisma().find_many(where={'featuredCategories': {'has': category}, 'isActive': True, 'agent': {'is': {'submissionStatus': submission_status}}}, include={'agent': {'include': {'AnalyticsTracker': True}}}, skip=skip, take=page_size)\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')",
        "featured_agents = await prisma.models.FeaturedAgent.prisma().find_many(where={'featuredCategories': {'has': category}, 'isActive': True, 'agent': {'is': {'submissionStatus': submission_status}}}, include={'agent': {'include': {'AnalyticsTracker': True}}}, skip=skip, take=page_size)",
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "total_count = len(featured_agents)",
        "return FeaturedAgentResponse(featured_agents=featured_agents, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)"
      ],
      "code": "raise AgentQueryError(f'Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def get_featured_agents(category: str='featured', page: int=1, page_size: int=10, submission_status: prisma.enums.SubmissionStatus=prisma.enums.SubmissionStatus.APPROVED) -> FeaturedAgentResponse:\n    \"\"\"Retrieve a list of featured agents from the database based on the provided category.\n\n    Args:\n        category (str, optional): The category of featured agents to retrieve. Defaults to \"featured\".\n        page (int, optional): The page number to retrieve. Defaults to 1.\n        page_size (int, optional): The number of agents per page. Defaults to 10.\n\n    Returns:\n        dict: A dictionary containing the list of featured agents, total count, current page number, page size, and total number of pages.\n    \"\"\"\n    try:\n        skip = (page - 1) * page_size\n        try:\n            featured_agents = await prisma.models.FeaturedAgent.prisma().find_many(where={'featuredCategories': {'has': category}, 'isActive': True, 'agent': {'is': {'submissionStatus': submission_status}}}, include={'agent': {'include': {'AnalyticsTracker': True}}}, skip=skip, take=page_size)\n        except prisma.errors.PrismaError as e:\n            raise AgentQueryError(f'Database query failed: {str(e)}')\n        total_count = len(featured_agents)\n        return FeaturedAgentResponse(featured_agents=featured_agents, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\n    except AgentQueryError as e:\n        raise e from e\n    except ValueError as e:\n        raise AgentQueryError(f'Invalid input parameter: {str(e)}') from e\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e\n'Retrieve a list of featured agents from the database based on the provided category.\\n\\n    Args:\\n        category (str, optional): The category of featured agents to retrieve. Defaults to \"featured\".\\n        page (int, optional): The page number to retrieve. Defaults to 1.\\n        page_size (int, optional): The number of agents per page. Defaults to 10.\\n\\n    Returns:\\n        dict: A dictionary containing the list of featured agents, total count, current page number, page size, and total number of pages.\\n    '\ntry:\n    skip = (page - 1) * page_size\n    try:\n        featured_agents = await prisma.models.FeaturedAgent.prisma().find_many(where={'featuredCategories': {'has': category}, 'isActive': True, 'agent': {'is': {'submissionStatus': submission_status}}}, include={'agent': {'include': {'AnalyticsTracker': True}}}, skip=skip, take=page_size)\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    total_count = len(featured_agents)\n    return FeaturedAgentResponse(featured_agents=featured_agents, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)\nexcept AgentQueryError as e:\n    raise e from e\nexcept ValueError as e:\n    raise AgentQueryError(f'Invalid input parameter: {str(e)}') from e\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e\nskip = (page - 1) * page_size\ntry:\n    featured_agents = await prisma.models.FeaturedAgent.prisma().find_many(where={'featuredCategories': {'has': category}, 'isActive': True, 'agent': {'is': {'submissionStatus': submission_status}}}, include={'agent': {'include': {'AnalyticsTracker': True}}}, skip=skip, take=page_size)\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nfeatured_agents = await prisma.models.FeaturedAgent.prisma().find_many(where={'featuredCategories': {'has': category}, 'isActive': True, 'agent': {'is': {'submissionStatus': submission_status}}}, include={'agent': {'include': {'AnalyticsTracker': True}}}, skip=skip, take=page_size)\nraise AgentQueryError(f'Database query failed: {str(e)}')\ntotal_count = len(featured_agents)\nreturn FeaturedAgentResponse(featured_agents=featured_agents, total_count=total_count, page=page, page_size=page_size, total_pages=(total_count + page_size - 1) // page_size)"
    },
    {
      "id": "n45",
      "type": "block",
      "statements": [
        "raise e from e",
        "raise AgentQueryError(f'Invalid input parameter: {str(e)}') from e",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e",
        "async def remove_featured_category(agent_id: str, category: str) -> prisma.models.FeaturedAgent | None:\n    \"\"\"Adds a featured category to an agent.\n\n    Args:\n        agent_id (str): The ID of the agent.\n        category (str): The category to add to the agent.\n\n    Returns:\n        FeaturedAgentResponse: The updated list of featured agents.\n    \"\"\"\n    try:\n        featured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id}, include={'agent': True})\n        if not featured_agent:\n            raise AgentQueryError(f'Agent with ID {agent_id} not found.')\n        featured_agent.featuredCategories.remove(category)\n        featured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': featured_agent.featuredCategories})\n        return featured_agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "'Adds a featured category to an agent.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n        category (str): The category to add to the agent.\\n\\n    Returns:\\n        FeaturedAgentResponse: The updated list of featured agents.\\n    '",
        "try:\n    featured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id}, include={'agent': True})\n    if not featured_agent:\n        raise AgentQueryError(f'Agent with ID {agent_id} not found.')\n    featured_agent.featuredCategories.remove(category)\n    featured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': featured_agent.featuredCategories})\n    return featured_agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "featured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id}, include={'agent': True})",
        "not featured_agent"
      ],
      "code": "raise e from e\nraise AgentQueryError(f'Invalid input parameter: {str(e)}') from e\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}') from e\nasync def remove_featured_category(agent_id: str, category: str) -> prisma.models.FeaturedAgent | None:\n    \"\"\"Adds a featured category to an agent.\n\n    Args:\n        agent_id (str): The ID of the agent.\n        category (str): The category to add to the agent.\n\n    Returns:\n        FeaturedAgentResponse: The updated list of featured agents.\n    \"\"\"\n    try:\n        featured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id}, include={'agent': True})\n        if not featured_agent:\n            raise AgentQueryError(f'Agent with ID {agent_id} not found.')\n        featured_agent.featuredCategories.remove(category)\n        featured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': featured_agent.featuredCategories})\n        return featured_agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n'Adds a featured category to an agent.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n        category (str): The category to add to the agent.\\n\\n    Returns:\\n        FeaturedAgentResponse: The updated list of featured agents.\\n    '\ntry:\n    featured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id}, include={'agent': True})\n    if not featured_agent:\n        raise AgentQueryError(f'Agent with ID {agent_id} not found.')\n    featured_agent.featuredCategories.remove(category)\n    featured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': featured_agent.featuredCategories})\n    return featured_agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nfeatured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id}, include={'agent': True})\nnot featured_agent"
    },
    {
      "id": "n46",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Agent with ID {agent_id} not found.')"
      ],
      "code": "raise AgentQueryError(f'Agent with ID {agent_id} not found.')"
    },
    {
      "id": "n47",
      "type": "block",
      "statements": [],
      "code": ""
    },
    {
      "id": "n48",
      "type": "block",
      "statements": [
        "featured_agent.featuredCategories.remove(category)",
        "featured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': featured_agent.featuredCategories})",
        "return featured_agent"
      ],
      "code": "featured_agent.featuredCategories.remove(category)\nfeatured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': featured_agent.featuredCategories})\nreturn featured_agent"
    },
    {
      "id": "n49",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def add_featured_category(agent_id: str, category: str) -> prisma.models.FeaturedAgent | None:\n    \"\"\"Removes a featured category from an agent.\n\n    Args:\n        agent_id (str): The ID of the agent.\n        category (str): The category to remove from the agent.\n\n    Returns:\n        FeaturedAgentResponse: The updated list of featured agents.\n    \"\"\"\n    try:\n        featured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': {'push': [category]}})\n        return featured_agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "'Removes a featured category from an agent.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n        category (str): The category to remove from the agent.\\n\\n    Returns:\\n        FeaturedAgentResponse: The updated list of featured agents.\\n    '",
        "try:\n    featured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': {'push': [category]}})\n    return featured_agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "featured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': {'push': [category]}})",
        "return featured_agent"
      ],
      "code": "raise AgentQueryError(f'Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def add_featured_category(agent_id: str, category: str) -> prisma.models.FeaturedAgent | None:\n    \"\"\"Removes a featured category from an agent.\n\n    Args:\n        agent_id (str): The ID of the agent.\n        category (str): The category to remove from the agent.\n\n    Returns:\n        FeaturedAgentResponse: The updated list of featured agents.\n    \"\"\"\n    try:\n        featured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': {'push': [category]}})\n        return featured_agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n'Removes a featured category from an agent.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n        category (str): The category to remove from the agent.\\n\\n    Returns:\\n        FeaturedAgentResponse: The updated list of featured agents.\\n    '\ntry:\n    featured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': {'push': [category]}})\n    return featured_agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nfeatured_agent = await prisma.models.FeaturedAgent.prisma().update(where={'agentId': agent_id}, data={'featuredCategories': {'push': [category]}})\nreturn featured_agent"
    },
    {
      "id": "n50",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def get_agent_featured(agent_id: str) -> prisma.models.FeaturedAgent | None:\n    \"\"\"Retrieve an agent's featured categories from the database.\n\n    Args:\n        agent_id (str): The ID of the agent.\n\n    Returns:\n        FeaturedAgentResponse: The list of featured agents.\n    \"\"\"\n    try:\n        featured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id})\n        return featured_agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "\"Retrieve an agent's featured categories from the database.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n\\n    Returns:\\n        FeaturedAgentResponse: The list of featured agents.\\n    \"",
        "try:\n    featured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id})\n    return featured_agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "featured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id})",
        "return featured_agent"
      ],
      "code": "raise AgentQueryError(f'Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def get_agent_featured(agent_id: str) -> prisma.models.FeaturedAgent | None:\n    \"\"\"Retrieve an agent's featured categories from the database.\n\n    Args:\n        agent_id (str): The ID of the agent.\n\n    Returns:\n        FeaturedAgentResponse: The list of featured agents.\n    \"\"\"\n    try:\n        featured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id})\n        return featured_agent\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n\"Retrieve an agent's featured categories from the database.\\n\\n    Args:\\n        agent_id (str): The ID of the agent.\\n\\n    Returns:\\n        FeaturedAgentResponse: The list of featured agents.\\n    \"\ntry:\n    featured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id})\n    return featured_agent\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nfeatured_agent = await prisma.models.FeaturedAgent.prisma().find_unique(where={'agentId': agent_id})\nreturn featured_agent"
    },
    {
      "id": "n51",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def get_not_featured_agents(page: int=1, page_size: int=10) -> typing.List[prisma.models.Agents]:\n    \"\"\"\n    Retrieve a list of not featured agents from the database.\n    \"\"\"\n    try:\n        agents = await prisma.client.get_client().query_raw(query=f\"\"\"\\n            SELECT \\n                \"market\".\"Agents\".id, \\n                \"market\".\"Agents\".\"createdAt\", \\n                \"market\".\"Agents\".\"updatedAt\", \\n                \"market\".\"Agents\".version, \\n                \"market\".\"Agents\".name, \\n                LEFT(\"market\".\"Agents\".description, 500) AS description, \\n                \"market\".\"Agents\".author, \\n                \"market\".\"Agents\".keywords, \\n                \"market\".\"Agents\".categories, \\n                \"market\".\"Agents\".graph,\\n                \"market\".\"Agents\".\"submissionStatus\",\\n                \"market\".\"Agents\".\"submissionDate\",\\n                \"market\".\"Agents\".search::text AS search\\n            FROM \"market\".\"Agents\"\\n            LEFT JOIN \"market\".\"FeaturedAgent\" ON \"market\".\"Agents\".\"id\" = \"market\".\"FeaturedAgent\".\"agentId\"\\n            WHERE (\"market\".\"FeaturedAgent\".\"agentId\" IS NULL OR \"market\".\"FeaturedAgent\".\"featuredCategories\" = '{{}}')\\n                AND \"market\".\"Agents\".\"submissionStatus\" = 'APPROVED'\\n            ORDER BY \"market\".\"Agents\".\"createdAt\" DESC\\n            LIMIT {page_size} OFFSET {page_size * (page - 1)}\\n            \"\"\", model=prisma.models.Agents)\n        return agents\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "'\\n    Retrieve a list of not featured agents from the database.\\n    '",
        "try:\n    agents = await prisma.client.get_client().query_raw(query=f\"\"\"\\n            SELECT \\n                \"market\".\"Agents\".id, \\n                \"market\".\"Agents\".\"createdAt\", \\n                \"market\".\"Agents\".\"updatedAt\", \\n                \"market\".\"Agents\".version, \\n                \"market\".\"Agents\".name, \\n                LEFT(\"market\".\"Agents\".description, 500) AS description, \\n                \"market\".\"Agents\".author, \\n                \"market\".\"Agents\".keywords, \\n                \"market\".\"Agents\".categories, \\n                \"market\".\"Agents\".graph,\\n                \"market\".\"Agents\".\"submissionStatus\",\\n                \"market\".\"Agents\".\"submissionDate\",\\n                \"market\".\"Agents\".search::text AS search\\n            FROM \"market\".\"Agents\"\\n            LEFT JOIN \"market\".\"FeaturedAgent\" ON \"market\".\"Agents\".\"id\" = \"market\".\"FeaturedAgent\".\"agentId\"\\n            WHERE (\"market\".\"FeaturedAgent\".\"agentId\" IS NULL OR \"market\".\"FeaturedAgent\".\"featuredCategories\" = '{{}}')\\n                AND \"market\".\"Agents\".\"submissionStatus\" = 'APPROVED'\\n            ORDER BY \"market\".\"Agents\".\"createdAt\" DESC\\n            LIMIT {page_size} OFFSET {page_size * (page - 1)}\\n            \"\"\", model=prisma.models.Agents)\n    return agents\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "agents = await prisma.client.get_client().query_raw(query=f\"\"\"\\n            SELECT \\n                \"market\".\"Agents\".id, \\n                \"market\".\"Agents\".\"createdAt\", \\n                \"market\".\"Agents\".\"updatedAt\", \\n                \"market\".\"Agents\".version, \\n                \"market\".\"Agents\".name, \\n                LEFT(\"market\".\"Agents\".description, 500) AS description, \\n                \"market\".\"Agents\".author, \\n                \"market\".\"Agents\".keywords, \\n                \"market\".\"Agents\".categories, \\n                \"market\".\"Agents\".graph,\\n                \"market\".\"Agents\".\"submissionStatus\",\\n                \"market\".\"Agents\".\"submissionDate\",\\n                \"market\".\"Agents\".search::text AS search\\n            FROM \"market\".\"Agents\"\\n            LEFT JOIN \"market\".\"FeaturedAgent\" ON \"market\".\"Agents\".\"id\" = \"market\".\"FeaturedAgent\".\"agentId\"\\n            WHERE (\"market\".\"FeaturedAgent\".\"agentId\" IS NULL OR \"market\".\"FeaturedAgent\".\"featuredCategories\" = '{{}}')\\n                AND \"market\".\"Agents\".\"submissionStatus\" = 'APPROVED'\\n            ORDER BY \"market\".\"Agents\".\"createdAt\" DESC\\n            LIMIT {page_size} OFFSET {page_size * (page - 1)}\\n            \"\"\", model=prisma.models.Agents)",
        "return agents"
      ],
      "code": "raise AgentQueryError(f'Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def get_not_featured_agents(page: int=1, page_size: int=10) -> typing.List[prisma.models.Agents]:\n    \"\"\"\n    Retrieve a list of not featured agents from the database.\n    \"\"\"\n    try:\n        agents = await prisma.client.get_client().query_raw(query=f\"\"\"\\n            SELECT \\n                \"market\".\"Agents\".id, \\n                \"market\".\"Agents\".\"createdAt\", \\n                \"market\".\"Agents\".\"updatedAt\", \\n                \"market\".\"Agents\".version, \\n                \"market\".\"Agents\".name, \\n                LEFT(\"market\".\"Agents\".description, 500) AS description, \\n                \"market\".\"Agents\".author, \\n                \"market\".\"Agents\".keywords, \\n                \"market\".\"Agents\".categories, \\n                \"market\".\"Agents\".graph,\\n                \"market\".\"Agents\".\"submissionStatus\",\\n                \"market\".\"Agents\".\"submissionDate\",\\n                \"market\".\"Agents\".search::text AS search\\n            FROM \"market\".\"Agents\"\\n            LEFT JOIN \"market\".\"FeaturedAgent\" ON \"market\".\"Agents\".\"id\" = \"market\".\"FeaturedAgent\".\"agentId\"\\n            WHERE (\"market\".\"FeaturedAgent\".\"agentId\" IS NULL OR \"market\".\"FeaturedAgent\".\"featuredCategories\" = '{{}}')\\n                AND \"market\".\"Agents\".\"submissionStatus\" = 'APPROVED'\\n            ORDER BY \"market\".\"Agents\".\"createdAt\" DESC\\n            LIMIT {page_size} OFFSET {page_size * (page - 1)}\\n            \"\"\", model=prisma.models.Agents)\n        return agents\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\n'\\n    Retrieve a list of not featured agents from the database.\\n    '\ntry:\n    agents = await prisma.client.get_client().query_raw(query=f\"\"\"\\n            SELECT \\n                \"market\".\"Agents\".id, \\n                \"market\".\"Agents\".\"createdAt\", \\n                \"market\".\"Agents\".\"updatedAt\", \\n                \"market\".\"Agents\".version, \\n                \"market\".\"Agents\".name, \\n                LEFT(\"market\".\"Agents\".description, 500) AS description, \\n                \"market\".\"Agents\".author, \\n                \"market\".\"Agents\".keywords, \\n                \"market\".\"Agents\".categories, \\n                \"market\".\"Agents\".graph,\\n                \"market\".\"Agents\".\"submissionStatus\",\\n                \"market\".\"Agents\".\"submissionDate\",\\n                \"market\".\"Agents\".search::text AS search\\n            FROM \"market\".\"Agents\"\\n            LEFT JOIN \"market\".\"FeaturedAgent\" ON \"market\".\"Agents\".\"id\" = \"market\".\"FeaturedAgent\".\"agentId\"\\n            WHERE (\"market\".\"FeaturedAgent\".\"agentId\" IS NULL OR \"market\".\"FeaturedAgent\".\"featuredCategories\" = '{{}}')\\n                AND \"market\".\"Agents\".\"submissionStatus\" = 'APPROVED'\\n            ORDER BY \"market\".\"Agents\".\"createdAt\" DESC\\n            LIMIT {page_size} OFFSET {page_size * (page - 1)}\\n            \"\"\", model=prisma.models.Agents)\n    return agents\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nagents = await prisma.client.get_client().query_raw(query=f\"\"\"\\n            SELECT \\n                \"market\".\"Agents\".id, \\n                \"market\".\"Agents\".\"createdAt\", \\n                \"market\".\"Agents\".\"updatedAt\", \\n                \"market\".\"Agents\".version, \\n                \"market\".\"Agents\".name, \\n                LEFT(\"market\".\"Agents\".description, 500) AS description, \\n                \"market\".\"Agents\".author, \\n                \"market\".\"Agents\".keywords, \\n                \"market\".\"Agents\".categories, \\n                \"market\".\"Agents\".graph,\\n                \"market\".\"Agents\".\"submissionStatus\",\\n                \"market\".\"Agents\".\"submissionDate\",\\n                \"market\".\"Agents\".search::text AS search\\n            FROM \"market\".\"Agents\"\\n            LEFT JOIN \"market\".\"FeaturedAgent\" ON \"market\".\"Agents\".\"id\" = \"market\".\"FeaturedAgent\".\"agentId\"\\n            WHERE (\"market\".\"FeaturedAgent\".\"agentId\" IS NULL OR \"market\".\"FeaturedAgent\".\"featuredCategories\" = '{{}}')\\n                AND \"market\".\"Agents\".\"submissionStatus\" = 'APPROVED'\\n            ORDER BY \"market\".\"Agents\".\"createdAt\" DESC\\n            LIMIT {page_size} OFFSET {page_size * (page - 1)}\\n            \"\"\", model=prisma.models.Agents)\nreturn agents"
    },
    {
      "id": "n52",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "async def get_all_categories() -> market.model.CategoriesResponse:\n    \"\"\"\n    Retrieve all unique categories from the database.\n\n    Returns:\n        CategoriesResponse: A list of unique categories.\n    \"\"\"\n    try:\n        agents = await prisma.models.Agents.prisma().find_many(distinct=['categories'])\n        all_categories = set()\n        for agent in agents:\n            all_categories.update(agent.categories)\n        unique_categories = sorted(list(all_categories))\n        return market.model.CategoriesResponse(unique_categories=unique_categories)\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception:\n        return market.model.CategoriesResponse(unique_categories=[])",
        "'\\n    Retrieve all unique categories from the database.\\n\\n    Returns:\\n        CategoriesResponse: A list of unique categories.\\n    '",
        "try:\n    agents = await prisma.models.Agents.prisma().find_many(distinct=['categories'])\n    all_categories = set()\n    for agent in agents:\n        all_categories.update(agent.categories)\n    unique_categories = sorted(list(all_categories))\n    return market.model.CategoriesResponse(unique_categories=unique_categories)\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception:\n    return market.model.CategoriesResponse(unique_categories=[])",
        "agents = await prisma.models.Agents.prisma().find_many(distinct=['categories'])",
        "all_categories = set()"
      ],
      "code": "raise AgentQueryError(f'Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nasync def get_all_categories() -> market.model.CategoriesResponse:\n    \"\"\"\n    Retrieve all unique categories from the database.\n\n    Returns:\n        CategoriesResponse: A list of unique categories.\n    \"\"\"\n    try:\n        agents = await prisma.models.Agents.prisma().find_many(distinct=['categories'])\n        all_categories = set()\n        for agent in agents:\n            all_categories.update(agent.categories)\n        unique_categories = sorted(list(all_categories))\n        return market.model.CategoriesResponse(unique_categories=unique_categories)\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception:\n        return market.model.CategoriesResponse(unique_categories=[])\n'\\n    Retrieve all unique categories from the database.\\n\\n    Returns:\\n        CategoriesResponse: A list of unique categories.\\n    '\ntry:\n    agents = await prisma.models.Agents.prisma().find_many(distinct=['categories'])\n    all_categories = set()\n    for agent in agents:\n        all_categories.update(agent.categories)\n    unique_categories = sorted(list(all_categories))\n    return market.model.CategoriesResponse(unique_categories=unique_categories)\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception:\n    return market.model.CategoriesResponse(unique_categories=[])\nagents = await prisma.models.Agents.prisma().find_many(distinct=['categories'])\nall_categories = set()"
    },
    {
      "id": "n53",
      "type": "block",
      "statements": [
        "agent",
        "agents"
      ],
      "code": "agent\nagents"
    },
    {
      "id": "n54",
      "type": "block",
      "statements": [
        "all_categories.update(agent.categories)"
      ],
      "code": "all_categories.update(agent.categories)"
    },
    {
      "id": "n55",
      "type": "block",
      "statements": [
        "unique_categories = sorted(list(all_categories))",
        "return market.model.CategoriesResponse(unique_categories=unique_categories)"
      ],
      "code": "unique_categories = sorted(list(all_categories))\nreturn market.model.CategoriesResponse(unique_categories=unique_categories)"
    },
    {
      "id": "n56",
      "type": "block",
      "statements": [
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "return market.model.CategoriesResponse(unique_categories=[])"
      ],
      "code": "raise AgentQueryError(f'Database query failed: {str(e)}')\nreturn market.model.CategoriesResponse(unique_categories=[])"
    },
    {
      "id": "n57",
      "type": "block",
      "statements": [
        "async def create_agent_installed_event(event_data: market.model.AgentInstalledFromMarketplaceEventData):\n    try:\n        await prisma.models.InstallTracker.prisma().create(data={'installedAgentId': event_data.installed_agent_id, 'marketplaceAgentId': event_data.marketplace_agent_id, 'installationLocation': prisma.enums.InstallationLocation(event_data.installation_location.name)})\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "try:\n    await prisma.models.InstallTracker.prisma().create(data={'installedAgentId': event_data.installed_agent_id, 'marketplaceAgentId': event_data.marketplace_agent_id, 'installationLocation': prisma.enums.InstallationLocation(event_data.installation_location.name)})\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')",
        "await prisma.models.InstallTracker.prisma().create(data={'installedAgentId': event_data.installed_agent_id, 'marketplaceAgentId': event_data.marketplace_agent_id, 'installationLocation': prisma.enums.InstallationLocation(event_data.installation_location.name)})",
        "raise AgentQueryError(f'Database query failed: {str(e)}')",
        "raise AgentQueryError(f'Unexpected error occurred: {str(e)}')"
      ],
      "code": "async def create_agent_installed_event(event_data: market.model.AgentInstalledFromMarketplaceEventData):\n    try:\n        await prisma.models.InstallTracker.prisma().create(data={'installedAgentId': event_data.installed_agent_id, 'marketplaceAgentId': event_data.marketplace_agent_id, 'installationLocation': prisma.enums.InstallationLocation(event_data.installation_location.name)})\n    except prisma.errors.PrismaError as e:\n        raise AgentQueryError(f'Database query failed: {str(e)}')\n    except Exception as e:\n        raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\ntry:\n    await prisma.models.InstallTracker.prisma().create(data={'installedAgentId': event_data.installed_agent_id, 'marketplaceAgentId': event_data.marketplace_agent_id, 'installationLocation': prisma.enums.InstallationLocation(event_data.installation_location.name)})\nexcept prisma.errors.PrismaError as e:\n    raise AgentQueryError(f'Database query failed: {str(e)}')\nexcept Exception as e:\n    raise AgentQueryError(f'Unexpected error occurred: {str(e)}')\nawait prisma.models.InstallTracker.prisma().create(data={'installedAgentId': event_data.installed_agent_id, 'marketplaceAgentId': event_data.marketplace_agent_id, 'installationLocation': prisma.enums.InstallationLocation(event_data.installation_location.name)})\nraise AgentQueryError(f'Database query failed: {str(e)}')\nraise AgentQueryError(f'Unexpected error occurred: {str(e)}')"
    }
  ],
  "edges": [
    {
      "source": "n54",
      "target": "n53"
    },
    {
      "source": "n52",
      "target": "n53"
    },
    {
      "source": "n6",
      "target": "n7"
    },
    {
      "source": "n14",
      "target": "n15"
    },
    {
      "source": "n23",
      "target": "n25"
    },
    {
      "source": "n53",
      "target": "n54"
    },
    {
      "source": "n22",
      "target": "n23"
    },
    {
      "source": "n17",
      "target": "n19"
    },
    {
      "source": "n19",
      "target": "n21"
    },
    {
      "source": "n40",
      "target": "n41"
    },
    {
      "source": "n38",
      "target": "n35"
    },
    {
      "source": "n17",
      "target": "n20"
    },
    {
      "source": "n21",
      "target": "n16"
    },
    {
      "source": "n16",
      "target": "n17"
    },
    {
      "source": "n8",
      "target": "n9"
    },
    {
      "source": "n34",
      "target": "n37"
    },
    {
      "source": "n16",
      "target": "n18"
    },
    {
      "source": "n3",
      "target": "n4"
    },
    {
      "source": "n53",
      "target": "n55"
    },
    {
      "source": "n33",
      "target": "n35"
    },
    {
      "source": "n4",
      "target": "n6"
    },
    {
      "source": "n42",
      "target": "n43"
    },
    {
      "source": "n12",
      "target": "n13"
    },
    {
      "source": "n24",
      "target": "n25"
    },
    {
      "source": "n34",
      "target": "n36"
    },
    {
      "source": "n47",
      "target": "n48"
    },
    {
      "source": "n29",
      "target": "n30"
    },
    {
      "source": "n12",
      "target": "n14"
    },
    {
      "source": "n9",
      "target": "n11"
    },
    {
      "source": "n18",
      "target": "n15"
    },
    {
      "source": "n41",
      "target": "n43"
    },
    {
      "source": "n32",
      "target": "n33"
    },
    {
      "source": "n20",
      "target": "n21"
    },
    {
      "source": "n36",
      "target": "n38"
    },
    {
      "source": "n46",
      "target": "n48"
    },
    {
      "source": "n9",
      "target": "n10"
    },
    {
      "source": "n31",
      "target": "n32"
    },
    {
      "source": "n45",
      "target": "n47"
    },
    {
      "source": "n10",
      "target": "n12"
    },
    {
      "source": "n11",
      "target": "n12"
    },
    {
      "source": "n45",
      "target": "n46"
    },
    {
      "source": "n7",
      "target": "n9"
    },
    {
      "source": "n37",
      "target": "n38"
    },
    {
      "source": "n5",
      "target": "n6"
    },
    {
      "source": "n29",
      "target": "n31"
    },
    {
      "source": "n25",
      "target": "n26"
    },
    {
      "source": "n40",
      "target": "n42"
    },
    {
      "source": "n26",
      "target": "n28"
    },
    {
      "source": "n27",
      "target": "n28"
    },
    {
      "source": "n25",
      "target": "n27"
    },
    {
      "source": "n3",
      "target": "n5"
    },
    {
      "source": "n13",
      "target": "n16"
    },
    {
      "source": "n22",
      "target": "n24"
    },
    {
      "source": "n32",
      "target": "n34"
    },
    {
      "source": "n6",
      "target": "n8"
    },
    {
      "source": "n30",
      "target": "n32"
    }
  ]
}