{
    "type": "ErrorNode",
    "code": "import logging\nimport os\n\nfrom dotenv import load_dotenv\nfrom redis import Redis\nfrom redis.asyncio import Redis as AsyncRedis\n\nfrom backend.util.retry import conn_retry\n\nload_dotenv()\n\nHOST = os.getenv(\"REDIS_HOST\", \"localhost\")\nPORT = int(os.getenv(\"REDIS_PORT\", \"6379\"))\nPASSWORD = os.getenv(\"REDIS_PASSWORD\", \"password\")\n\nlogger = logging.getLogger(__name__)\nconnection: Redis | None = None\nconnection_async: AsyncRedis | None = None\n\n\n@conn_retry(\"Redis\", \"Acquiring connection\")\ndef connect() -> Redis:\n    global connection\n    if connection:\n        return connection\n\n    c = Redis(\n        host=HOST,\n        port=PORT,\n        password=PASSWORD,\n        decode_responses=True,\n    )\n    c.ping()\n    connection = c\n    return connection\n\n\n@conn_retry(\"Redis\", \"Releasing connection\")\ndef disconnect():\n    global connection\n    if connection:\n        connection.close()\n    connection = None\n\n\ndef get_redis(auto_connect: bool = True) -> Redis:\n    if connection:\n        return connection\n    if auto_connect:\n        return connect()\n    raise RuntimeError(\"Redis connection is not established\")\n\n\n@conn_retry(\"AsyncRedis\", \"Acquiring connection\")\nasync def connect_async() -> AsyncRedis:\n    global connection_async\n    if connection_async:\n        return connection_async\n\n    c = AsyncRedis(\n        host=HOST,\n        port=PORT,\n        password=PASSWORD,\n        decode_responses=True,\n    )\n    await c.ping()\n    connection_async = c\n    return connection_async\n\n\n@conn_retry(\"AsyncRedis\", \"Releasing connection\")\nasync def disconnect_async():\n    global connection_async\n    if connection_async:\n        await connection_async.close()\n    connection_async = None\n\n\nasync def get_redis_async(auto_connect: bool = True) -> AsyncRedis:\n    if connection_async:\n        return connection_async\n    if auto_connect:\n        return await connect_async()\n    raise RuntimeError(\"AsyncRedis connection is not established\")\n",
    "children": []
}